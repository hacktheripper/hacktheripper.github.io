

<!DOCTYPE html>
<html lang="ko-KR" data-default-color-scheme="&#34;auto&#34;">



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" type="image/png" href="/img/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="hack &amp; life">
  <meta name="author" content="j0dev, y2sman">
  <meta name="keywords" content>
  <meta name="google-site-verification" content="DXkyiaX95-ws53Tyt0m91_umRf4gfV2qJIQZ5zQDIO4">

  <meta property="og:type" content="website"> 
  <meta property="og:title" content="[Research] 악성코드 분석용 VM 세팅을 자동화해보자! - hackyboiz">
  <meta property="og:description" content="hack &amp; life">
  <meta property="og:image" content="/img/favicon.ico">
  <meta property="og:url" content="https://hackyboiz.github.io/">

  <link rel="canonical" href="https://hackyboiz.github.io/2021/06/06/idioth/setting_malware_vm/">

  <title>[Research] 악성코드 분석용 VM 세팅을 자동화해보자! - hackyboiz</title>

  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css">


  <link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css">
  <link rel="stylesheet" href="/lib/hint/hint.min.css">

  
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css">
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_6peoq002giu.css">
<link rel="stylesheet" href="/.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">
<link rel="stylesheet" href="/.css">


<link rel="stylesheet" href="/css/main.css">

<!-- 自定义样式保持在最底部 -->


  <script src="/js/utils.js"></script>
  <script src="/js/color-schema.js"></script>

<meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/rss2.xml" title="hackyboiz" type="application/rss+xml">
</head>

<body>
  <header style="height: 40vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>Hackyboiz</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-addrcard"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/author/">
                <i class="iconfont icon-user-fill"></i>
                Author
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax="true" style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2021-06-06 18:00" pubdate>
      2021년 6월 6일 오후
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.5k 자
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      49
       분
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2">
      <script data-ad-client="ca-pub-3672652207808168" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    </div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">[Research] 악성코드 분석용 VM 세팅을 자동화해보자!</h1>
            
            <div class="markdown-body" id="post-body">
              <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
              <!-- hackyboiz_horizen_index -->
              <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3672652207808168" data-ad-slot="8887862313" data-ad-format="auto" data-full-width-responsive="true"></ins>
              <script>
                   (adsbygoogle = window.adsbygoogle || []).push({});
              </script>
              <h1 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h1><p>안녕하세요. idioth입니다. 오늘 가져온 주제는 “악성코드 분석용 가상 머신 설정 자동화”입니다.</p>
<p>닝겐은 귀찮은 행동을 하기 싫어합니다.(저만 그런 건 아니겠죠?) 보통 악성코드 분석은 가상 머신에서 수행하고, 또 분석용 VM을 여러 개 들고 있거나 아니면 다른 PC에 설치해야 할 일 등이 있죠. 예를 들어 저 같은 경우는 집에 있는 데스크톱과 학교나 카페 등에서 사용하는 노트북으로 나뉘어 있습니다.</p>
<p>Windows 가상 머신에다가 이런저런 도구들을 설정하면 용량이 커져서 압축하거나 옮기는 데에도 시간이 꽤 걸립니다. 밖에 있는데 노트북을 포맷하거나 하는 상황이 발생하면 Windows 가상 머신을 새로 만들어서 설정을 쭉 해야 하죠.</p>
<p>포너블을 공부할 때 사용하는 우분투에서는 제가 사용하는 툴 등을 쉘 스크립트로 다운로드 및 설정하게 만들어서 리눅스를 사용할 때 쉘 스크립트만 실행하고 딴짓을 하다 오면 세팅이 다 되는데 Windows도 가능할까?라는 생각에서 시작했습니다.</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/fireeye/flare-vm">FireEye에서 배포하는 FlareVM</a>도 존재하지만 모든 툴을 다 다운로드하기도 하고 오래 걸리면 하루 종일 걸리는 경우도 있더라고요… 그래서 거기서 영감을 얻어서 제가 자주 사용하는 툴들로 구성하여 작성을 해보았습니다.(FlareVM에서 가져온 코드도 있습니다 😂)</p>
<p>본래 SSG 동아리 내부에서 악성코드 관련 스터디 등을 할 때 스크립트 주면서 이거 실행하면 될 거야~ 했는데 그걸 그대로 블로그에 올리기에는 코드가 너무 처참해서… (매우 더럽습니다.) 이번 기회에 깔끔하게 작성했습니다.(물론 제 기준에서만 깔끔할 수도 있어요! 양해 바랍니다. 🙂   </p>
<p>파트는 크게 두 가지로 나뉠 예정입니다. 첫 번째 파트에서는 Windows 설정에 대한 스크립트를 작성할 예정이고, 두 번째 파트에서는 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://chocolatey.org/">chocolatey</a>를 활용한 툴들을 설치할 겁니다!</p>
<h1 id="무엇을-설정해야-할까"><a href="#무엇을-설정해야-할까" class="headerlink" title="무엇을 설정해야 할까?"></a>무엇을 설정해야 할까?</h1><p>가장 먼저 스크립트를 통해서 무엇을 해야 할지 정리를 하고 시작합시다. 아무래도 악성코드 분석을 해야 하므로 Windows Defender와 Windows Update는 꺼놓는 것이 좋겠죠? 시작 프로그램에 등록되었을 때 복잡하게 하지 않기 위해서 시작 프로그램도 정리하고… 사용하지 않는 기본 앱 삭제 등… 제가 생각나는 대로 간단하게 정리해보았습니다.</p>
<ol>
<li>사용하지 않는 기본 앱 삭제</li>
<li>방화벽 비활성화</li>
<li>Windows Update 비활성화</li>
<li>Windows Defender 비활성화</li>
<li>보안유지 정책 알림 비활성화</li>
<li>작업 스케줄러 삭제</li>
<li>시작 프로그램 삭제</li>
<li>숨김 파일 표시</li>
</ol>
<p>Windows에서 쉘 스크립트로 한 번에 설정을 한다고? 뭔가 낯설게 느껴지시는 분들도 계시겠지만 Windows에는 Powershell이 존재합니다. Powershell을 사용해서 위의 작업들을 하나하나 진행해봅시다!</p>
<h1 id="사용하지-않는-기본-앱-삭제"><a href="#사용하지-않는-기본-앱-삭제" class="headerlink" title="사용하지 않는 기본 앱 삭제"></a>사용하지 않는 기본 앱 삭제</h1><p>처음 Windows를 설치하면 3D 뷰어나, BingFinance, OfficeHub 등등 악성코드 분석에는 활용되지 않는 애플리케이션들이 많이 설치되어 있습니다. 이런 앱을 손수 지울 수도 있으나 <code>Remove-AppxPackage</code> 명령어를 통해서 삭제할 수 있습니다.</p>
<pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Windows\system32&gt; <span class="hljs-built_in">Get-AppxPackage</span> Microsoft.XboxApp

Name              : Microsoft.XboxApp
Publisher         : CN=Microsoft Corporation, O=Microsoft Corporation, L=Redmond, S=Washington, C=US
Architecture      : X64
ResourceId        :
Version           : <span class="hljs-number">48.76</span>.<span class="hljs-number">8001.0</span>
PackageFullName   : Microsoft.XboxApp_48.<span class="hljs-number">76.8001</span>.<span class="hljs-number">0</span>_x64__8wekyb3d8bbwe
InstallLocation   : C:\Program Files\WindowsApps\Microsoft.XboxApp_48.<span class="hljs-number">76.8001</span>.<span class="hljs-number">0</span>_x64__8wekyb3d8bbwe
IsFramework       : False
PackageFamilyName : Microsoft.XboxApp_8wekyb3d8bbwe
PublisherId       : <span class="hljs-number">8</span>wekyb3d8bbwe
IsResourcePackage : False
IsBundle          : False
IsDevelopmentMode : False
NonRemovable      : False
Dependencies      : &#123;Microsoft.NET.Native.Framework.<span class="hljs-number">1.7</span>_1.<span class="hljs-number">7.27413</span>.<span class="hljs-number">0</span>_x64__8wekyb3d8bbwe, Microsoft.NET.Native.Runtime.<span class="hljs-number">1.7</span>_1.<span class="hljs-number">7.27422</span>.<span class="hljs-number">0</span>_x64__8wekyb3d8bbwe, Microsoft.VCLibs.<span class="hljs-number">140.00</span>_14.<span class="hljs-number">0.29231</span>.<span class="hljs-number">0</span>_x64__8wekyb3d8bbwe, Microsoft.VCLibs.<span class="hljs-number">140.00</span>.UWPDesktop_14.<span class="hljs-number">0.29231</span>.<span class="hljs-number">0</span>_x64__8wekyb3
                    d8bbwe...&#125;
IsPartiallyStaged : False
SignatureKind     : Store
Status            : Ok</code></pre>

<p>예를 들어 XboxApp의 경우 분석에서는 아예 사용하지 않겠죠? <code>Get-AppxPackage</code>를 통해 패키지의 정보를 가져올 수 있고, 파이프라인으로 <code>Remove-AppxPackage</code>를 사용하면 해당 패키지가 삭제됩니다.</p>
<p>이를 토대로 작성한 소스 코드는 아래와 같습니다.</p>
<pre><code class="hljs powershell"><span class="hljs-variable">$packages</span> = <span class="hljs-selector-tag">@</span>(
    <span class="hljs-string">&quot;7EE7776C.LinkedInforWindows&quot;</span>
    <span class="hljs-string">&quot;C27EB4BA.DropboxOEM&quot;</span>
    <span class="hljs-string">&quot;Microsoft.3DBuilder&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Microsoft3DViewer&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Advertising.Xaml&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Appconnector&quot;</span>
    <span class="hljs-string">&quot;Microsoft.BingFinance&quot;</span>
    <span class="hljs-string">&quot;Microsoft.BingFoodAndDrink&quot;</span>
    <span class="hljs-string">&quot;Microsoft.BingHealthAndFitness&quot;</span>
    <span class="hljs-string">&quot;Microsoft.BingNews&quot;</span>
    <span class="hljs-string">&quot;Microsoft.BingSports&quot;</span>
    <span class="hljs-string">&quot;Microsoft.BingTravel&quot;</span>
    <span class="hljs-string">&quot;Microsoft.BingWeather&quot;</span>
    <span class="hljs-string">&quot;Microsoft.CommsPhone&quot;</span>
    <span class="hljs-string">&quot;Microsoft.ConnectivityStore&quot;</span>
    <span class="hljs-string">&quot;Microsoft.DesktopAppInstaller&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Getstarted&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Messaging&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Microsoft3DViewer&quot;</span>
    <span class="hljs-string">&quot;Microsoft.MicrosoftOfficeHub&quot;</span>
    <span class="hljs-string">&quot;Microsoft.MicrosoftSolitaireCollection&quot;</span>
    <span class="hljs-string">&quot;Microsoft.MixedReality.Portal&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Netflix&quot;</span>
    <span class="hljs-string">&quot;Microsoft.NetworkSpeedTest&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Office.Desktop&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Office.OneNote&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Office.Sway&quot;</span>
    <span class="hljs-string">&quot;Microsoft.OfficeLens&quot;</span>
    <span class="hljs-string">&quot;Microsoft.OneConnect&quot;</span>
    <span class="hljs-string">&quot;Microsoft.OneDrive&quot;</span>
    <span class="hljs-string">&quot;Microsoft.People&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Print3D&quot;</span>
    <span class="hljs-string">&quot;Microsoft.RemoteDesktop&quot;</span>
    <span class="hljs-string">&quot;Microsoft.SkypeApp&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Wallet&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Windows.CloudExperienceHost&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Windows.NarratorQuickStart&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Windows.PeopleExperienceHost&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Windows.Photos&quot;</span>
    <span class="hljs-string">&quot;Microsoft.WindowsAlarms&quot;</span>
    <span class="hljs-string">&quot;Microsoft.WindowsCamera&quot;</span>
    <span class="hljs-string">&quot;Microsoft.windowscommunicationsapps&quot;</span>
    <span class="hljs-string">&quot;Microsoft.WindowsFeedbackHub&quot;</span>
    <span class="hljs-string">&quot;Microsoft.WindowsMaps&quot;</span>
    <span class="hljs-string">&quot;Microsoft.WindowsPhone&quot;</span>
    <span class="hljs-string">&quot;Microsoft.WindowsReadingList&quot;</span>
    <span class="hljs-string">&quot;Microsoft.WindowsSoundRecorder&quot;</span>
    <span class="hljs-string">&quot;Microsoft.Xbox.TCUI&quot;</span>
    <span class="hljs-string">&quot;Microsoft.XboxApp&quot;</span>
    <span class="hljs-string">&quot;Microsoft.XboxGameCallableUI&quot;</span>
    <span class="hljs-string">&quot;Microsoft.XboxGameOverlay&quot;</span>
    <span class="hljs-string">&quot;Microsoft.XboxGamingOverlay&quot;</span>
    <span class="hljs-string">&quot;Microsoft.XboxIdentityProvider&quot;</span>
    <span class="hljs-string">&quot;Microsoft.XboxLive&quot;</span>
    <span class="hljs-string">&quot;Microsoft.XboxSpeechToTextOverlay&quot;</span>
    <span class="hljs-string">&quot;Microsoft.YourPhone&quot;</span>
    <span class="hljs-string">&quot;Microsoft.ZuneMusic&quot;</span>
    <span class="hljs-string">&quot;Microsoft.ZuneVideo&quot;</span>
    <span class="hljs-string">&quot;Windows.CBSPreview&quot;</span>
)

<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$name</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$packages</span>)
&#123;
    <span class="hljs-built_in">Get-AppxPackage</span> <span class="hljs-variable">$name</span> | <span class="hljs-built_in">Remove-AppxPackage</span>
&#125;</code></pre>

<p><code>$packages</code>에 있는 패키지 이름을 하나씩 가져와서 삭제를 하는 부분입니다. 추가되어 있지 않은 애플리케이션도 존재하기 때문에 혹시 본인이 삭제하고 싶지 않거나 삭제하고 싶은 프로그램이 있으면 추가를 하시면 됩니다.</p>
<p><img src="/2021/06/06/idioth/setting_malware_vm/Untitled.png" srcset="/img/loading.gif"></p>
<p>삭제하고 싶은 앱이 있는데 패키지 이름을 모르시겠다고요? 걱정하지 마세요! 깔려있는 패키지를 이름으로 정렬해서 확인할 수 있습니다!</p>
<pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Windows\system32&gt; <span class="hljs-built_in">Get-AppxPackage</span> | <span class="hljs-built_in">Select</span> Name

Name
----
windows.immersivecontrolpanel
Microsoft.VCLibs.<span class="hljs-number">140.00</span>
Microsoft.UI.Xaml.<span class="hljs-number">2.0</span>
Windows.PrintDialog
Microsoft.Wallet
Microsoft.VCLibs.<span class="hljs-number">140.00</span>
Microsoft.VCLibs.<span class="hljs-number">140.00</span>
RealtekSemiconductorCorp.RealtekAudioControl
Microsoft.VCLibs.<span class="hljs-number">140.00</span>.UWPDesktop
Microsoft.VCLibs.<span class="hljs-number">140.00</span>.UWPDesktop
AdvancedMicroDevicesInc<span class="hljs-literal">-2</span>.AMDRadeonSoftware
Microsoft.XboxSpeechToTextOverlay
Microsoft.XboxGameOverlay
Microsoft.NET.Native.Runtime.<span class="hljs-number">2.2</span>
Microsoft.NET.Native.Runtime.<span class="hljs-number">2.2</span>
Microsoft.NET.Native.Framework.<span class="hljs-number">2.2</span>
Microsoft.NET.Native.Framework.<span class="hljs-number">2.2</span>
Microsoft.Xbox.TCUI
Microsoft.UI.Xaml.<span class="hljs-number">2.4</span>
Microsoft.UI.Xaml.<span class="hljs-number">2.4</span>
Microsoft.UI.Xaml.<span class="hljs-number">2.0</span>
Microsoft.UI.Xaml.<span class="hljs-number">2.1</span>
Microsoft.UI.Xaml.<span class="hljs-number">2.1</span>
Microsoft.NET.Native.Framework.<span class="hljs-number">1.7</span>
Microsoft.NET.Native.Framework.<span class="hljs-number">1.7</span>
Microsoft.NET.Native.Runtime.<span class="hljs-number">1.7</span>
Microsoft.NET.Native.Runtime.<span class="hljs-number">1.7</span>
Microsoft.UI.Xaml.<span class="hljs-number">2.3</span>
Microsoft.UI.Xaml.<span class="hljs-number">2.3</span>
Microsoft.UI.Xaml.<span class="hljs-number">2.5</span>
Microsoft.UI.Xaml.<span class="hljs-number">2.5</span>
Microsoft.<span class="hljs-number">549981</span>C3F5F10
Microsoft.StorePurchaseApp
Microsoft.LanguageExperiencePackko<span class="hljs-literal">-KR</span>
Microsoft.WinDbg
microsoft.windowscommunicationsapps
Microsoft.WebpImageExtension
Microsoft.XboxIdentityProvider
Microsoft.DesktopAppInstaller
Microsoft.Windows.Photos
Microsoft.WebMediaExtensions
Microsoft.XboxApp
Microsoft.MixedReality.Portal
Microsoft.People
Microsoft.WindowsStore
Microsoft.ZuneVideo
Microsoft.Microsoft3DViewer
Microsoft.WindowsFeedbackHub
Microsoft.MicrosoftStickyNotes
Microsoft.WindowsAlarms
Microsoft.GetHelp
Microsoft.BingWeather
Microsoft.WindowsCamera
Microsoft.ScreenSketch
Microsoft.WindowsMaps
Microsoft.WindowsCalculator
Microsoft.WindowsSoundRecorder
Microsoft.ZuneMusic
Microsoft.BioEnrollment
Microsoft.Windows.CloudExperienceHost
Microsoft.Windows.OOBENetworkConnectionFlow
Microsoft.AAD.BrokerPlugin
Microsoft.Windows.OOBENetworkCaptivePortal
MicrosoftWindows.UndockedDevKit
Microsoft.Windows.StartMenuExperienceHost
Microsoft.Windows.ShellExperienceHost
Microsoft.Windows.Search
Microsoft.MicrosoftEdge
Microsoft.Windows.ContentDeliveryManager
MicrosoftWindows.Client.CBS
Windows.CBSPreview
NcsiUwpApp
Microsoft.XboxGameCallableUI
Microsoft.Windows.XGpuEjectDialog
Microsoft.Windows.SecureAssessmentBrowser
Microsoft.Windows.SecHealthUI
Microsoft.Windows.PinningConfirmationDialog
Microsoft.Windows.PeopleExperienceHost
Microsoft.Windows.ParentalControls
Microsoft.Windows.NarratorQuickStart
Microsoft.Windows.CapturePicker
Microsoft.Windows.CallingShellApp
Microsoft.Windows.AssignedAccessLockApp
Microsoft.Windows.Apprep.ChxApp
Microsoft.Win32WebViewHost
Microsoft.MicrosoftEdgeDevToolsClient
Microsoft.LockApp
Microsoft.ECApp
Microsoft.CredDialogHost
Microsoft.AsyncTextService
Microsoft.AccountsControl
Microsoft.VP9VideoExtensions
Microsoft.XboxGamingOverlay
Microsoft.HEIFImageExtension
Microsoft.MSPaint
<span class="hljs-number">91750</span>D7E.Slack
Microsoft.MicrosoftEdge.Stable
Microsoft.Getstarted
Microsoft.YourPhone</code></pre>

<p>이름을 찾았는데 <code>Xbox</code>처럼 여러 개가 있는데 적기가 너무 귀찮다. 나는 한 번에 해치우고 싶다! 하시는 분은 <code>Microsoft.Xbox*</code>하시면 리눅스와 같이 <code>Microsoft.Xbox1</code> 등 뒤에 추가되어 있는(?) 뭐라 말해야 하지… 생각이 안 나네요! 아무튼! 저 문자열로 시작하는 친구들을 모두 삭제해줍니다!</p>
<p>그럼 이제 방화벽을 비활성화하러 가볼까요?</p>
<h1 id="방화벽-비활성화"><a href="#방화벽-비활성화" class="headerlink" title="방화벽 비활성화"></a>방화벽 비활성화</h1><p>방화벽 비활성화는 굉장히<del>~</del> 코드가 간단합니다.</p>
<p>도메인, 공용, 개인에 대한 방화벽 모두를 비활성화하면 되는데 요거는 PowerShell을 통해 한번에 작업할 수 있습니다. XD</p>
<pre><code class="hljs powershell"><span class="hljs-built_in">Set-NetFirewallProfile</span> <span class="hljs-literal">-Profile</span> Domain, Public, Private <span class="hljs-literal">-Enabled</span> False</code></pre>

<h1 id="Windows-Update-비활성화"><a href="#Windows-Update-비활성화" class="headerlink" title="Windows Update 비활성화"></a>Windows Update 비활성화</h1><p>Windows Update를 비활성화하기 위해서는 WindowsUpdate 레지스트리에 <code>NoAutoUpdate</code>를 설정해주면 됩니다.</p>
<pre><code class="hljs powershell"><span class="hljs-built_in">New-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;WindowsUpdate&quot;</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
<span class="hljs-built_in">New-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;AU&quot;</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
<span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;NoAutoUpdate&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span></code></pre>

<h1 id="Windows-Defender-비활성화"><a href="#Windows-Defender-비활성화" class="headerlink" title="Windows Defender 비활성화"></a>Windows Defender 비활성화</h1><p>방화벽 비활성화는 Windows Defender 레지스트리에 <code>DisableAntiSpyware</code>만 추가를 해놓았었는데, flare-vm에서 사용하는 코드를 그대로 가져왔습니다.</p>
<pre><code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">disable_defender</span><span class="hljs-params">()</span></span>
&#123;
    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;[*] Disable Windows Defender&quot;</span>

    <span class="hljs-keyword">try</span>
    &#123;
        <span class="hljs-built_in">Get-Service</span> WinDefend | <span class="hljs-built_in">Stop-Service</span> <span class="hljs-literal">-Force</span>
        <span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SYSTEM\CurrentControlSet\Services\WinDefend&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;Start&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">4</span> <span class="hljs-literal">-Type</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
    &#125;
    <span class="hljs-keyword">catch</span>
    &#123;
        <span class="hljs-built_in">Write-Error</span> <span class="hljs-string">&quot;Failed disable WinDefend Service&quot;</span>
    &#125;

    <span class="hljs-built_in">New-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;Windows Defender&quot;</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
    <span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;DisableAntiSpyware&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
    <span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;DisableRoutinelyTakingAction&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>

    <span class="hljs-built_in">New-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;Spynet&quot;</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
    <span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;SpyNetReporting&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">0</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
    <span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;SubmitSamplesConsent&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">0</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>

    <span class="hljs-built_in">New-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;MRT&quot;</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
    <span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\MRT&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;DontReportInfectionInformation&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>

    <span class="hljs-keyword">if</span>(<span class="hljs-operator">-Not</span> ((<span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-Class</span> Win32_OperatingSystem).Version <span class="hljs-operator">-eq</span> <span class="hljs-string">&quot;6.1.7601&quot;</span>))
    &#123;
        <span class="hljs-built_in">Add-MpPreference</span> <span class="hljs-literal">-ExclusionPath</span> <span class="hljs-string">&quot;C:\&quot;</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableArchiveScanning</span> <span class="hljs-variable">$true</span>  <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableBehaviorMonitoring</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableBlockAtFirstSeen</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableCatchupFullScan</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableCatchupQuickScan</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableIntrusionPreventionSystem</span> <span class="hljs-variable">$true</span>  <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableIOAVProtection</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableRealtimeMonitoring</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableRemovableDriveScanning</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableRestorePoint</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableScanningMappedNetworkDrivesForFullScan</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableScanningNetworkFiles</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableScriptScanning</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-EnableControlledFolderAccess</span> Disabled <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-EnableNetworkProtection</span> AuditMode <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-MAPSReporting</span> Disabled <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-SubmitSamplesConsent</span> NeverSend <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-PUAProtection</span> Disabled <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>    
    &#125;

&#125;</code></pre>

<p>WinDefend Service의 경우 에러가 뜨는 경우가 많아 try-catch 처리를 하였고, 마이크로소프트에 리포트를 보내는 것, 그리고 OS 버전이 6.1.7601 (Windows 7 Service Pack 1)이 아닐 경우 (Windows 10일 경우인 것 같습니다.) Defender에 추가된 다른 설정들을 비활성화해줍니다.</p>
<p>소스 코드를 가져와서 읽으면서 느낀 건 Windows 7 Service Pack 1로 검사하는 게 아니라 Windows 10과 Server 2019에 대한 Defender 명령어인 것 같은데 <code>[System.Envrionment]::OSVersion.Version.Major -eq 10</code>으로 Windows 10인지 확인하면 되지 않나? 싶었습니다.</p>
<p>사실상 저는 Windows 10 기준으로 스크립트를 작성했지만요.</p>
<h1 id="보안-유지-정책-알림-비활성화"><a href="#보안-유지-정책-알림-비활성화" class="headerlink" title="보안 유지 정책 알림 비활성화"></a>보안 유지 정책 알림 비활성화</h1><p>보안 유지 정책 알림 아이콘 비활성화입니다. 이건 굳이 필요 없어 보이긴 하지만 저는 빨간 불이 떠있다거나 느낌표가 떠있다거나 하면 신경이 굉장히 많이 쓰이는 사람이기에…</p>
<p><img src="/2021/06/06/idioth/setting_malware_vm/Untitled%201.png" srcset="/img/loading.gif"></p>
<pre><code class="hljs powershell"><span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;HideSCAHealth&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span></code></pre>

<p>찾아보았더니 Microsoft Policies에 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.TaskBar2::HideSCAHealth">HideSCAHealth 레지스트리</a>에 해당 부분을 비활성화할 수 있다는 사실을 알았습니다! 오예 바로 설정하죠! <code>HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer</code>에 <code>HideSCAHealth</code>의 값을 1로 하면 해당 플래그가 설정되어 보안 알림 설정이 숨겨집니다!</p>
<h1 id="작업-스케줄러-삭제"><a href="#작업-스케줄러-삭제" class="headerlink" title="작업 스케줄러 삭제"></a>작업 스케줄러 삭제</h1><p>이제 Windows에 기본적으로 설정되어 있거나, 다른 애플리케이션을 추가하면서 등록된 불필요한 작업 스케줄러를 삭제할 시간입니다.</p>
<p><img src="/2021/06/06/idioth/setting_malware_vm/Untitled%202.png" srcset="/img/loading.gif"></p>
<p>작업 스케줄러에 표시된 이 녀석들을 삭제를 하는 거죠. 이 작업엔 비하인드 에피소드가 있습니다. Task 리스트를 가져와서 모두 삭제를 해버리면 될 거라 생각했어요. 저 부분에 있는 친구들만 가져온다고 생각했습니다.</p>
<p>근데 테스트를 하는데… Windows 기능이 정상적으로 동작 안 하는 게 있는 거에요… 검색이 안 되고… 왜 이러지? 왜 이러지? 어디가 문제지? 하면서 함수 호출을 하나하나 주석 처리하다가 발견했습니다.</p>
<pre><code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove_task</span><span class="hljs-params">()</span></span>
&#123;
    <span class="hljs-variable">$TS</span> = <span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> Schedule.Service
    <span class="hljs-variable">$TS</span>.Connect(<span class="hljs-variable">$env:COMPUTERNAME</span>)
    <span class="hljs-variable">$TaskFolder</span> = <span class="hljs-variable">$TS</span>.GetFolder(<span class="hljs-string">&#x27;\&#x27;</span>)
    <span class="hljs-variable">$Tasks</span> = <span class="hljs-variable">$TaskFolder</span>.GetTasks(<span class="hljs-number">1</span>)

    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$Task</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$Tasks</span>)
    &#123;
        <span class="hljs-variable">$TaskFolder</span>.DeleteTask(<span class="hljs-variable">$Task</span>.Name, <span class="hljs-number">0</span>)
    &#125;

&#125;</code></pre>

<p>remove task는 ComObject를 통해 Schedule.Service에서 Task 리스트를 가져와서 삭제를 해줍니다. 시스템 스케줄까지 모두 삭제해버려서 발생한 해프닝이었습니다. ㅜ.ㅜ</p>
<h1 id="시작-프로그램-삭제"><a href="#시작-프로그램-삭제" class="headerlink" title="시작 프로그램 삭제"></a>시작 프로그램 삭제</h1><p>악성코드를 실행하고, 어떤 것들이 autorun 되는지 확인할 때 여러 잡다한 프로그램들이 실행되면 보기 힘들겠죠? 그래서 이것 또한 지워버립시다!</p>
<pre><code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">disable_startup</span><span class="hljs-params">()</span></span>
&#123;
    <span class="hljs-variable">$user</span> = <span class="hljs-built_in">New-Object</span> System.Security.Principal.NTAccount(<span class="hljs-variable">$env:username</span>)
    <span class="hljs-variable">$sid</span> = (<span class="hljs-variable">$user</span>.Translate([<span class="hljs-type">System.Security.Principal.SecurityIdentifier</span>])).Value

    <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\*&quot;</span> <span class="hljs-literal">-Recurse</span>
    <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;Registry::HKEY_USERS\S-1-5-19\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\*&quot;</span> <span class="hljs-literal">-Recurse</span>
    <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;Registry::HKEY_USERS\S-1-5-20\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\*&quot;</span> <span class="hljs-literal">-Recurse</span>
    <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;Registry::HKEY_USERS\<span class="hljs-variable">$sid</span>\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\*&quot;</span> <span class="hljs-literal">-Recurse</span>
&#125;</code></pre>

<p>특정 사용자에 한해 등록된 시작 프로그램은 그 사용자의 SID 경로를 통해 저장이 됩니다. 따라서 사용자에 따른 SID 값을 가져와서 삭제를 해주는 거죠! 일단은… 저렇게 지정을 했는데 안 지워지는 것들이 있더라구요…??? 이유를… 못 찾겠어서 남아있는 거는 손으로 지웠습니다.</p>
<p><img src="/2021/06/06/idioth/setting_malware_vm/Untitled%203.png" srcset="/img/loading.gif"></p>
<p>최종본을 가져올 때는 꼭 수정해서 가져올게요! 이번만 너그러이 봐주시면…</p>
<h1 id="숨김-파일-표시"><a href="#숨김-파일-표시" class="headerlink" title="숨김 파일 표시"></a>숨김 파일 표시</h1><p>이제 숨김 파일과 시스템 숨김 파일들을 표시해봅시다. 설치하고 숨김 파일을 체크하고 하는 것 또한 레지스트리를 통해서 작업할 수 있어요. Windows는 레지스트리를 통해서 이것저것 설정하니까요.</p>
<pre><code class="hljs powershell"><span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;Hidden&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>
<span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;ShowSuperHidden&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span></code></pre>

<p><code>Hidden</code>과 <code>ShowSuperHidden</code>의 값을 1로 설정해주면 끝입니다! 이제 기본적인 설정은 완료되었어요.</p>
<h1 id="마치며"><a href="#마치며" class="headerlink" title="마치며"></a>마치며</h1><p>간단한 Windows 설정을 스크립트로 작성해보았습니다. 손으로 해도 얼마 안 걸리지만, 가끔 몇 개 까먹을 때도 있고 귀찮잖아요? 스크립트로 작성하면 실행만 하면 이 모든 것들을 <del>무료!</del> 까먹은 거 없이 설정할 수 있습니다.</p>
<p>다음 파트에서 chocolatey를 통해서 여러 가지 툴들을 설치하고 개인의 입맛에 맞게 작업 표시줄에 추가, 바탕화면 바로가기 만들기 등에 대해서 알아봅시다. 다음 파트가 모두 진행되고 나면 전체 소스 코드를 github에 올려서 링크를 걸어드리겠습니다! 마지막으로 해당 기능들을 구현할 때 참고 링크들을 작성하며 이만 물러가도록 하겠습니다. 그럼 안뇽~</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p>disable security maintenance icon: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.TaskBar2::HideSCAHealth">https://admx.help/?Category=Windows_10_2016&amp;Policy=Microsoft.Policies.TaskBar2::HideSCAHealth</a></p>
<p>show hidden files: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.python2.net/questions-1237399.htm">https://www.python2.net/questions-1237399.htm</a></p>
<p>remove app list: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://community.spiceworks.com/topic/2230169-powershell-script-to-remove-xbox-gamebar-from-the-app-list">https://community.spiceworks.com/topic/2230169-powershell-script-to-remove-xbox-gamebar-from-the-app-list</a></p>
<p>disable windows defender: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/fireeye/flare-vm/blob/master/install.ps1">https://github.com/fireeye/flare-vm/blob/master/install.ps1</a></p>
<p>disable windows update: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://social.technet.microsoft.com/Forums/lync/en-US/abde2699-0d5a-49ad-bfda-e87d903dd865/disable-windows-update-via-powershell?forum=winserverpowershell">https://social.technet.microsoft.com/Forums/lync/en-US/abde2699-0d5a-49ad-bfda-e87d903dd865/disable-windows-update-via-powershell?forum=winserverpowershell</a></p>
<p>get specific sid: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://techexpert.tips/powershell/powershell-get-user-sid/">https://techexpert.tips/powershell/powershell-get-user-sid/</a></p>
<p>remove all registry key under specific key: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.microsoft.com/ko-kr/powershell/scripting/samples/working-with-registry-keys?view=powershell-7.1#removing-all-keys-under-a-specific-key">https://docs.microsoft.com/ko-kr/powershell/scripting/samples/working-with-registry-keys?view=powershell-7.1#removing-all-keys-under-a-specific-key</a></p>
<p>remove task: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://community.spiceworks.com/how_to/159324-delete-scheduled-task-with-powershell">https://community.spiceworks.com/how_to/159324-delete-scheduled-task-with-powershell</a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                <div class="post-meta mr-3">
                  <i class="iconfont icon-category"></i>
                  
                  <a class="hover-with-bg" href="/categories/Research/">Research</a>
                  
                </div>
                
                
                <div class="post-meta">
                  <i class="iconfont icon-tags"></i>
                  
                  <a class="hover-with-bg" href="/tags/idioth/">idioth</a>
                  
                  <a class="hover-with-bg" href="/tags/malware/">malware</a>
                  
                  <a class="hover-with-bg" href="/tags/powershell/">powershell</a>
                  
                  <a class="hover-with-bg" href="/tags/automated/">automated</a>
                  
                  <a class="hover-with-bg" href="/tags/virtual-machine/">virtual machine</a>
                  
                </div>
                
              </div>

              <div class="post-metas mb-3">
                <a class="hover-with-bg" style="display: flex;" href="/author">
                  <div class="link-avatar-page">
                    <img src="/img/profile_idioth.jpg" srcset="/img/loading.gif" alt="idioth">
                  </div>

                  <div class="link-text">
                    <div class="link-title">idioth</div>
                  </div>
                </a>
                <div class="link-text">
                  <div class="link-more">
                    <a href="/tags/idioth">
                      Read more
                      <i class="iconfont icon-arrowdown"></i>
                    </a>
                  </div>
                </div>
              </div>

              <hr>

              <script data-ad-client="ca-pub-3672652207808168" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
              
              <!--  -->
              <p class="note note-warning">본 글은 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.ko" rel="external nofollow noopener noreferrer">CC BY-SA 4.0</a> 라이선스로 배포됩니다. 공유 또는 변경 시 반드시 출처를 남겨주시기 바랍니다.</p>
              
              
              
              <div class="post-prevnext row">
                <article class="post-prev col-6">
                  
                  
                  <a href="/2021/06/07/idioth/2021-06-07/">
                    <i class="iconfont icon-arrowleft"></i>
                    <span class="hidden-mobile">[하루한줄] 간단한 Defender 우회 방법</span>
                    <span class="visible-mobile">Previous</span>
                  </a>
                  
                </article>
                <article class="post-next col-6">
                  
                  
                  <a href="/2021/06/06/j0ker/2021-06-06/">
                    <span class="hidden-mobile">[하루한줄] Windows: Out-of-bounds write in WindowsCodecsRaw!COlympusE300LoadRaw</span>
                    <span class="visible-mobile">Next</span>
                    <i class="iconfont icon-arrowright"></i>
                  </a>
                  
                </article>
              </div>
              
            </div>

            
            <!-- Comments -->
            <article class="comments" id="comments">
              
              
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'https://hackyboiz.github.io/2021/06/06/idioth/setting_malware_vm/';
        this.page.identifier = '/2021/06/06/idioth/setting_malware_vm/';
      };
      function loadDisqus() {
        (function () {
          var d = document,
            s = d.createElement('script');
          s.src = '//' + 'hackyboiz' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        })();
      }
      waitElementVisible('disqus_thread', loadDisqus);
    </script>
    <noscript>Please enable JavaScript to view the
      <a target="_blank" href="https://disqus.com/?ref_noscript" rel="external nofollow noopener noreferrer">comments powered by Disqus.</a>
    </noscript>
  </div>


            </article>
            
          </article>
        </div>
      </div>
    </div>
    
    <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
      <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

    </div>
    
  </div>
</div>

<!-- Custom -->

    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="external nofollow noopener noreferrer"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="external nofollow noopener noreferrer">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="/js/debouncer.js"></script>
<script src="/js/main.js"></script>

<!-- Plugins -->


  
    <script src="/js/lazyload.js"></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>
  <script src="/js/clipboard-use.js"></script>







  <script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "[Research] 악성코드 분석용 VM 세팅을 자동화해보자!&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js"></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css">

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>

















  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'UA-177243668-2', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src="https://www.google-analytics.com/analytics.js"></script>
  

  
    <!-- Google gtag.js -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-177243668-2"></script>
    <script defer>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-177243668-2');
    </script>
  

  

  

  





</body>
</html>
